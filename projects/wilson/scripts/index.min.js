import { showPage } from "/scripts/src/load-page.mjs"
!function(){"use strict";var e=`
		precision highp float;
		
		varying vec2 uv;
		
		uniform float aspectRatio;
		
		uniform float worldCenterX;
		uniform float worldCenterY;
		uniform float worldSize;
		
		uniform float a;
		uniform float b;
		uniform float brightnessScale;
		
		
		
		void main(void)
		{
			vec2 z;
			
			if (aspectRatio >= 1.0)
			{
				z = vec2(uv.x * aspectRatio * worldSize + worldCenterX, uv.y * worldSize + worldCenterY);
			}
			
			else
			{
				z = vec2(uv.x * worldSize + worldCenterX, uv.y / aspectRatio * worldSize + worldCenterY);
			}
			
			vec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));
			float brightness = exp(-length(z));
			
			
			
			vec2 c = vec2(a, b);
			
			for (int iteration = 0; iteration < 100; iteration++)
			{
				if (iteration == 99)
				{
					gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
					return;
				}
				
				if (length(z) >= 10.0)
				{
					break;
				}
				
				z = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;
				
				brightness += exp(-length(z));
			}
			
			
			gl_FragColor = vec4(brightness / brightnessScale * color, 1.0);
		}
	`,t={renderer:"gpu",shader:e,canvasWidth:1e3,canvasHeight:1e3,worldWidth:4,worldHeight:4,worldCenterX:0,worldCenterY:0,useDraggables:!0,draggablesMousemoveCallback:F,draggablesTouchmoveCallback:F,useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:P,mousedownCallback:X,touchstartCallback:X,mousedragCallback:Y,touchmoveCallback:Y,mouseupCallback:x,touchendCallback:x,wheelCallback:function(e,t,r,n){w=e,u=t,Math.abs(r/100)<.3?(l+=r/100,l=Math.min(l,1)):v+=.05*Math.sign(r);y()},pinchCallback:function(e,t,r,n){m=1<=i?(l-=r/a.worldWidth*10,-r/a.worldWidth*10):(l-=r/a.worldHeight*10,-r/a.worldHeight*10);l=Math.min(l,1),w=e,u=t,y()}},e={renderer:"gpu",shader:e,canvasWidth:100,canvasHeight:100};let a=new Wilson($("#output-canvas"),t);a.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","a","b","brightnessScale"]);a.draggables.add(0,1);let o=new Wilson($("#hidden-canvas"),e),i=(o.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","a","b","brightnessScale"]),a.canvas.parentNode.parentNode.style.setProperty("margin-bottom",0,"important"),o.canvas.parentNode.parentNode.style.setProperty("margin-top",0,"important"),1),l=0,d=0,s=1,r=1e3,c=100,w=0,u=0,g=0,h=0,m=0,f=0,p=0,v=0;const C=.96,n=.005,b=5e-4,M=.93,z=.01,k=.001;let S=-1,W=$("#resolution-input");function F(e,t,r,n){d=t,s=r,window.requestAnimationFrame(H)}function X(e,t,r){f=0,p=0,v=0,g=0,h=0,m=0}function Y(e,t,r,n,o){a.worldCenterX-=r,a.worldCenterY-=n,g=-r,h=-n,a.worldCenterX=Math.min(Math.max(a.worldCenterX,-2),2),a.worldCenterY=Math.min(Math.max(a.worldCenterY,-2),2),window.requestAnimationFrame(H),a.draggables.recalculateLocations()}function x(e,t,r){Math.sqrt(g*g+h*h)>=n*Math.min(a.worldWidth,a.worldHeight)&&(f=g,p=h),Math.abs(m)>=z&&(v=m),window.requestAnimationFrame(H)}function y(){var e;1<=i?(e=a.input.getZoomedWorldCenter(w,u,4*Math.pow(2,l)*i,4*Math.pow(2,l)),a.worldWidth=4*Math.pow(2,l)*i,a.worldHeight=4*Math.pow(2,l),a.worldCenterX=e[0],a.worldCenterY=e[1]):(e=a.input.getZoomedWorldCenter(w,u,4*Math.pow(2,l),4*Math.pow(2,l)/i),a.worldWidth=4*Math.pow(2,l),a.worldHeight=4*Math.pow(2,l)/i,a.worldCenterX=e[0],a.worldCenterY=e[1]),window.requestAnimationFrame(H),a.draggables.recalculateLocations()}function H(e){var t=e-S;if(S=e,0!=t){o.gl.uniform1f(o.uniforms.worldCenterX,a.worldCenterX),o.gl.uniform1f(o.uniforms.worldCenterY,a.worldCenterY),o.gl.uniform1f(o.uniforms.worldSize,Math.min(a.worldHeight,a.worldWidth)/2),o.gl.uniform1f(o.uniforms.a,d),o.gl.uniform1f(o.uniforms.b,s),o.gl.uniform1f(o.uniforms.brightnessScale,20),o.render.drawFrame();var r=o.render.getPixelData(),n=new Array(c*c);for(let e=0;e<c*c;e++)n[e]=r[4*e]+r[4*e+1]+r[4*e+2];n.sort((e,t)=>e-t);e=n[Math.floor(c*c*.98)]/255*18,e=Math.max(e,.1);a.gl.uniform1f(a.uniforms.aspectRatio,i),a.gl.uniform1f(a.uniforms.worldCenterX,a.worldCenterX),a.gl.uniform1f(a.uniforms.worldCenterY,a.worldCenterY),a.gl.uniform1f(a.uniforms.worldSize,Math.min(a.worldHeight,a.worldWidth)/2),a.gl.uniform1f(a.uniforms.a,d),a.gl.uniform1f(a.uniforms.b,s),a.gl.uniform1f(a.uniforms.brightnessScale,e),a.render.drawFrame(),0===f&&0===p&&0===v||(a.worldCenterX+=f,a.worldCenterY+=p,a.worldCenterX=Math.min(Math.max(a.worldCenterX,-2),2),a.worldCenterY=Math.min(Math.max(a.worldCenterY,-2),2),f*=C,p*=C,Math.sqrt(f*f+p*p)<b*Math.min(a.worldWidth,a.worldHeight)&&(f=0,p=0),l+=v,l=Math.min(l,1),y(w,u),v*=M,Math.abs(v)<k&&(v=0),window.requestAnimationFrame(H),a.draggables.recalculateLocations())}}function P(){a.fullscreen.currentlyFullscreen?1<=(i=window.innerWidth/window.innerHeight)?(a.changeCanvasSize(r,Math.floor(r/i)),a.worldWidth=4*Math.pow(2,l)*i,a.worldHeight=4*Math.pow(2,l)):(a.changeCanvasSize(Math.floor(r*i),r),a.worldWidth=4*Math.pow(2,l),a.worldHeight=4*Math.pow(2,l)/i):(i=1,a.changeCanvasSize(r,r),a.worldWidth=4*Math.pow(2,l),a.worldHeight=4*Math.pow(2,l)),window.requestAnimationFrame(H)}W.addEventListener("input",()=>{r=parseInt(W.value||1e3),a.changeCanvasSize(r,r)}),a.gl.uniform1f(a.uniforms.aspectRatio,1),o.gl.uniform1f(o.uniforms.aspectRatio,1),window.requestAnimationFrame(H),window.addEventListener("resize",P),Page.temporaryHandlers.resize.push(P),$("#part-1-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/1-getting-started/")}),$("#part-2-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/2-draggables/")}),$("#part-3-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/3-parallelizing/")}),$("#part-4-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/4-hidden-canvases/")}),$("#part-5-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/5-fullscreen/")}),$("#part-6-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/guide/6-interactivity/")}),$("#docs-button").addEventListener("click",()=>{Page.Navigation.redirect("/projects/wilson/docs/")}),$("#download-button").addEventListener("click",()=>{Page.Navigation.redirect("https://github.com/cruzgodar/wilson/releases",!0)}),showPage()}();