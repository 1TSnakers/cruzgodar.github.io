import{showPage}from"/scripts/src/load-page.min.mjs";import{$,$$}from"/scripts/src/main.min.mjs";import{Wilson}from"/scripts/wilson.min.mjs";!function(){"use strict";var elements=$$("pre code");for(let i=0;i<elements.length;i++)elements[i].classList.add("highlightable");hljs.highlightAll();var fragShaderSource=`
		precision highp float;
		
		varying vec2 uv;
		
		uniform float a;
		uniform float b;
		uniform float brightnessScale;
		
		
		
		void main(void)
		{
			vec2 z = vec2(uv.x * 2.0, uv.y * 2.0);
			vec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));
			float brightness = exp(-length(z));
			
			
			
			vec2 c = vec2(a, b);
			
			for (int iteration = 0; iteration < 100; iteration++)
			{
				if (iteration == 99)
				{
					gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
					return;
				}
				
				if (length(z) >= 10.0)
				{
					break;
				}
				
				z = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;
				
				brightness += exp(-length(z));
			}
			
			
			gl_FragColor = vec4(brightness / brightnessScale * color, 1.0);
		}
	`,options={renderer:"gpu",shader:fragShaderSource,canvasWidth:1e3,canvasHeight:1e3,worldWidth:4,worldHeight:4,worldCenterX:0,worldCenterY:0,useDraggables:!0,draggablesMousemoveCallback:onDrag,draggablesTouchmoveCallback:onDrag},fragShaderSource={renderer:"gpu",shader:fragShaderSource,canvasWidth:100,canvasHeight:100};let wilson=new Wilson($("#output-canvas"),options);wilson.render.initUniforms(["a","b","brightnessScale"]);wilson.draggables.add(0,1);let wilsonHidden=new Wilson($("#hidden-canvas"),fragShaderSource),a=(wilsonHidden.render.initUniforms(["a","b","brightnessScale"]),wilson.canvas.parentNode.parentNode.style.setProperty("margin-bottom",0,"important"),wilsonHidden.canvas.parentNode.parentNode.style.setProperty("margin-top",0,"important"),0),b=1,resolution,resolutionHidden=100,lastTimestamp=-1,resolutionInputElement=$("#resolution-input");function onDrag(activeDraggable,x,y,event){a=x,b=y,window.requestAnimationFrame(drawJuliaSet)}function drawJuliaSet(timestamp){var timeElapsed=timestamp-lastTimestamp;if(lastTimestamp=timestamp,0!=timeElapsed){wilsonHidden.gl.uniform1f(wilsonHidden.uniforms.a,a),wilsonHidden.gl.uniform1f(wilsonHidden.uniforms.b,b),wilsonHidden.gl.uniform1f(wilsonHidden.uniforms.brightnessScale,20),wilsonHidden.render.drawFrame();var pixelData=wilsonHidden.render.getPixelData(),brightnesses=new Array(resolutionHidden*resolutionHidden);for(let i=0;i<resolutionHidden*resolutionHidden;i++)brightnesses[i]=pixelData[4*i]+pixelData[4*i+1]+pixelData[4*i+2];brightnesses.sort((a,b)=>a-b);timestamp=brightnesses[Math.floor(resolutionHidden*resolutionHidden*.98)]/255*18,timestamp=Math.max(timestamp,.1);wilson.gl.uniform1f(wilson.uniforms.a,a),wilson.gl.uniform1f(wilson.uniforms.b,b),wilson.gl.uniform1f(wilson.uniforms.brightnessScale,timestamp),wilson.render.drawFrame()}}resolutionInputElement.addEventListener("input",()=>{resolution=parseInt(resolutionInputElement.value||1e3),wilson.changeCanvasSize(resolution,resolution)}),$("#download-button").addEventListener("click",()=>{wilson.downloadFrame("a-julia-set.png")}),window.requestAnimationFrame(drawJuliaSet),showPage()}();