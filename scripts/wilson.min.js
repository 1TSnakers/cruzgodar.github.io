class Wilson{canvas=null;ctx=null;gl=null;shaderPrograms=[];uniforms={};canvasWidth=null;canvasHeight=null;worldWidth=2;worldHeight=2;worldCenterX=0;worldCenterY=0;outputCanvasContainer=null;useDraggables=!1;topPadding=0;leftPadding=0;topBorder=0;leftBorder=0;constructor(b,a){this.canvas=b;this.canvasWidth="undefined"===typeof a.canvasWidth?parseInt(this.canvas.getAttribute("width")):a.canvasWidth;this.canvasHeight="undefined"===typeof a.canvasHeight?parseInt(this.canvas.getAttribute("height")):a.canvasHeight;
this.canvas.setAttribute("width",this.canvasWidth);this.canvas.setAttribute("height",this.canvasHeight);b=window.getComputedStyle(this.canvas);this.topPadding=parseFloat(b.paddingTop);this.leftPadding=parseFloat(b.paddingLeft);this.topBorder=parseFloat(b.borderTopWidth);this.leftBorder=parseFloat(b.borderLeftWidth);this.utils.interpolate.parent=this;this.render.parent=this;this.draggables.parent=this;this.fullscreen.parent=this;this.input.parent=this;""!==this.canvas.id?console.log(`[Wilson] Registered a ${this.canvasWidth}x${this.canvasHeight} canvas with ID ${this.canvas.id}`):
console.log(`[Wilson] Registered a ${this.canvasWidth}x${this.canvasHeight} canvas`);"undefined"===typeof a.canvasesToResize&&(a.canvasesToResize=[this.canvas]);"undefined"!==typeof a.worldWidth&&(this.worldWidth=a.worldWidth);"undefined"!==typeof a.worldHeight&&(this.worldHeight=a.worldHeight);"undefined"!==typeof a.worldCenterX&&(this.worldCenterX=a.worldCenterX);"undefined"!==typeof a.worldCenterY&&(this.worldCenterY=a.worldCenterY);this.render.renderType="undefined"===typeof a.renderer||"hybrid"===
a.renderer?1:"cpu"===a.renderer?0:2;if(0===this.render.renderType)this.ctx=this.canvas.getContext("2d",{colorSpace:"display-p3"}),this.render.imgData=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.render.drawFrame=this.render.drawFrameCpu;else if(1===this.render.renderType){this.render.initWebglHybrid();this.render.drawFrame=this.render.drawFrameHybrid;try{this.gl.getExtension("OES_texture_float")}catch(c){console.log("[Wilson] Could not load float textures")}}else{try{this.render.loadNewShader(a.shader)}catch(c){console.error("[Wilson] Error loading shader")}this.render.drawFrame=
this.render.drawFrameGpu;try{this.gl.getExtension("OES_texture_float")}catch(c){console.log("[Wilson] Could not load float textures")}}("undefined"===typeof a.autoArrangeCanvases||a.autoArrangeCanvases)&&this.arrangeCanvases(a);this.input.mousedownCallback="undefined"===typeof a.mousedownCallback?null:a.mousedownCallback;this.input.mouseupCallback="undefined"===typeof a.mouseupCallback?null:a.mouseupCallback;this.input.mousemoveCallback="undefined"===typeof a.mousemoveCallback?null:a.mousemoveCallback;
this.input.mousedragCallback="undefined"===typeof a.mousedragCallback?null:a.mousedragCallback;this.input.touchstartCallback="undefined"===typeof a.touchstartCallback?null:a.touchstartCallback;this.input.touchendCallback="undefined"===typeof a.touchendCallback?null:a.touchendCallback;this.input.touchmoveCallback="undefined"===typeof a.touchmoveCallback?null:a.touchmoveCallback;this.input.pinchCallback="undefined"===typeof a.pinchCallback?null:a.pinchCallback;this.input.wheelCallback="undefined"===
typeof a.wheelCallback?null:a.wheelCallback;this.input.init();this.useDraggables=!0;this.draggables.static="undefined"===typeof a.draggablesStatic?!1:a.draggablesStatic;this.draggables.mousedownCallback="undefined"===typeof a.draggablesMousedownCallback?null:a.draggablesMousedownCallback;this.draggables.mouseupCallback="undefined"===typeof a.draggablesMouseupCallback?null:a.draggablesMouseupCallback;this.draggables.mousemoveCallback="undefined"===typeof a.draggablesMousemoveCallback?null:a.draggablesMousemoveCallback;
this.draggables.touchstartCallback="undefined"===typeof a.draggablesTouchstartCallback?null:a.draggablesTouchstartCallback;this.draggables.touchendCallback="undefined"===typeof a.draggablesTouchendCallback?null:a.draggablesTouchendCallback;this.draggables.touchmoveCallback="undefined"===typeof a.draggablesTouchmoveCallback?null:a.draggablesTouchmoveCallback;this.draggables.init();"undefined"!==typeof a.useFullscreen&&a.useFullscreen&&(this.fullscreen.trueFullscreen="undefined"===typeof a.trueFullscreen?
!1:a.trueFullscreen,this.fullscreen.useFullscreenButton="undefined"===typeof a.useFullscreenButton?!1:a.useFullscreenButton,this.fullscreen.useFullscreenButton&&"undefined"===typeof a.enterFullscreenButtonIconPath&&console.error("Missing path to Enter Fullscreen button image"),this.fullscreen.useFullscreenButton&&"undefined"===typeof a.exitFullscreenButtonIconPath&&console.error("Missing path to Exit Fullscreen button image"),this.fullscreen.enterFullscreenButtonIconPath=a.enterFullscreenButtonIconPath,
this.fullscreen.exitFullscreenButtonIconPath=a.exitFullscreenButtonIconPath,this.fullscreen.switchFullscreenCallback="undefined"===typeof a.switchFullscreenCallback?!1:a.switchFullscreenCallback,"undefined"===typeof a.canvasesToResize&&console.error("Missing canvases to resize"),this.fullscreen.canvasesToResize=a.canvasesToResize,this.fullscreen.init())}arrangeCanvases(b){if(0===document.querySelectorAll("#wilson-style").length){var a=document.createElement("style");a.textContent="\n\t\t\t\t.wilson-output-canvas-container\n\t\t\t\t{\n\t\t\t\t\tposition: relative;\n\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\tuser-select: none;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.wilson-applet-canvas-container\n\t\t\t\t{\n\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\tuser-select: none;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.wilson-center-content\n\t\t\t\t{\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t}\n\t\t\t";
a.id="wilson-style";document.head.appendChild(a)}a=document.createElement("div");a.classList.add("wilson-applet-canvas-container");a.classList.add("wilson-center-content");this.canvas.parentNode.insertBefore(a,this.canvas);this.outputCanvasContainer=document.createElement("div");this.outputCanvasContainer.classList.add("wilson-output-canvas-container");a.appendChild(this.outputCanvasContainer);for(var c=0;c<b.canvasesToResize.length;c++)a.appendChild(b.canvasesToResize[c]);this.outputCanvasContainer.appendChild(this.canvas);
this.draggables.container=document.createElement("div");this.draggables.container.classList.add("wilson-draggables-container");a.appendChild(this.draggables.container);this.fullscreen.canvasesToResize.push(this.draggables.container);b=window.getComputedStyle(this.canvas);c=this.canvas.clientWidth-parseFloat(b.paddingLeft)-parseFloat(b.paddingRight);let d=this.canvas.clientHeight-parseFloat(b.paddingTop)-parseFloat(b.paddingBottom);this.draggables.container.style.width=c+2*this.draggables.draggableRadius+
"px";this.draggables.container.style.height=d+2*this.draggables.draggableRadius+"px";this.draggables.containerWidth=c+2*this.draggables.draggableRadius;this.draggables.containerHeight=d+2*this.draggables.draggableRadius;this.draggables.restrictedWidth=c;this.draggables.restrictedHeight=d;this.draggables.container.style.marginTop=parseFloat(b.borderTopWidth)+parseFloat(b.paddingTop)-this.draggables.draggableRadius+"px";this.fullscreen.fullscreenComponentsContainer=document.createElement("div");this.fullscreen.fullscreenComponentsContainer.classList.add("wilson-fullscreen-components-container");
a.parentNode.insertBefore(this.fullscreen.fullscreenComponentsContainer,a);this.fullscreen.fullscreenComponentsContainer.appendChild(a);this.fullscreen.fullscreenComponentsContainerLocation=document.createElement("div");this.fullscreen.fullscreenComponentsContainer.parentNode.insertBefore(this.fullscreen.fullscreenComponentsContainerLocation,this.fullscreen.fullscreenComponentsContainer);this.fullscreen.fullscreenComponentsContainerLocation.appendChild(this.fullscreen.fullscreenComponentsContainer);
for(a=0;a<this.fullscreen.canvasesToResize.length;a++)this.fullscreen.canvasesToResize[a].addEventListener("gesturestart",e=>e.preventDefault()),this.fullscreen.canvasesToResize[a].addEventListener("gesturechange",e=>e.preventDefault()),this.fullscreen.canvasesToResize[a].addEventListener("gestureend",e=>e.preventDefault()),this.fullscreen.canvasesToResize[a].addEventListener("click",e=>e.preventDefault())}utils={interpolate:{canvasToWorld(b,a){return[(a/this.parent.canvasWidth-.5)*this.parent.worldWidth+
this.parent.worldCenterX,(.5-b/this.parent.canvasHeight)*this.parent.worldHeight+this.parent.worldCenterY]},worldToCanvas(b,a){return[Math.floor((.5-(a-this.parent.worldCenterY)/this.parent.worldHeight)*this.parent.canvasHeight),Math.floor(((b-this.parent.worldCenterX)/this.parent.worldWidth+.5)*this.parent.canvasWidth)]}},hsvToRgb(b,a,c){function d(e){e=(e+6*b)%6;return c-c*a*Math.max(0,Math.min(e,Math.min(4-e,1)))}return[255*d(5),255*d(3),255*d(1)]}};render={drawFrame:null,renderType:null,lastImage:null,
imgData:null,shaderProgram:null,shaderPrograms:[],texture:null,framebuffers:[],drawFrameCpu(b){this.parent.ctx.putImageData(new ImageData(b,this.parent.canvasWidth,this.parent.canvasHeight),0,0)},drawFrameHybrid(b){this.lastImage=b;this.parent.gl.texImage2D(this.parent.gl.TEXTURE_2D,0,this.parent.gl.RGBA,this.parent.canvasWidth,this.parent.canvasHeight,0,this.parent.gl.RGBA,this.parent.gl.UNSIGNED_BYTE,b);this.parent.gl.drawArrays(this.parent.gl.TRIANGLE_STRIP,0,4)},drawFrameGpu(){this.parent.gl.drawArrays(this.parent.gl.TRIANGLE_STRIP,
0,4)},initWebglHybrid(){function b(d,e,f){e=d.createShader(e);d.shaderSource(e,f);d.compileShader(e);d.getShaderParameter(e,d.COMPILE_STATUS)||(console.error(`[Wilson] Couldn't load shader: ${d.getProgramInfoLog(shaderProgram)}`),d.deleteShader(e));return e}this.parent.gl=this.parent.canvas.getContext("webgl");var a=b(this.parent.gl,this.parent.gl.VERTEX_SHADER,"\n\t\t\t\tattribute vec3 position;\n\t\t\t\tvarying vec2 uv;\n\n\t\t\t\tvoid main(void)\n\t\t\t\t{\n\t\t\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\t\t\tuv = position.xy;\n\t\t\t\t}\n\t\t\t");
let c=b(this.parent.gl,this.parent.gl.FRAGMENT_SHADER,"\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tvarying vec2 uv;\n\t\t\t\t\n\t\t\t\tuniform sampler2D uTexture;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvoid main(void)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0);\n\t\t\t\t}\n\t\t\t");this.shaderProgram=this.parent.gl.createProgram();this.parent.gl.attachShader(this.shaderProgram,a);this.parent.gl.attachShader(this.shaderProgram,c);this.parent.gl.linkProgram(this.shaderProgram);
this.parent.gl.getProgramParameter(this.shaderProgram,this.parent.gl.LINK_STATUS)||(console.error(`[Wilson] Couldn't link shader program: ${this.parent.gl.getShaderInfoLog(shader)}`),this.parent.gl.deleteProgram(this.shaderProgram));this.parent.gl.useProgram(this.shaderProgram);a=this.parent.gl.createBuffer();this.parent.gl.bindBuffer(this.parent.gl.ARRAY_BUFFER,a);this.parent.gl.bufferData(this.parent.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),this.parent.gl.STATIC_DRAW);this.shaderProgram.positionAttribute=
this.parent.gl.getAttribLocation(this.shaderProgram,"position");this.parent.gl.enableVertexAttribArray(this.shaderProgram.positionAttribute);this.parent.gl.vertexAttribPointer(this.shaderProgram.positionAttribute,3,this.parent.gl.FLOAT,!1,0,0);this.parent.gl.viewport(0,0,this.parent.canvasWidth,this.parent.canvasHeight);this.parent.gl.pixelStorei(this.parent.gl.UNPACK_ALIGNMENT,1);this.parent.gl.pixelStorei(this.parent.gl.UNPACK_FLIP_Y_WEBGL,1);this.texture=this.parent.gl.createTexture();this.parent.gl.bindTexture(this.parent.gl.TEXTURE_2D,
this.texture);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_S,this.parent.gl.CLAMP_TO_EDGE);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_T,this.parent.gl.CLAMP_TO_EDGE);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MAG_FILTER,this.parent.gl.NEAREST);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MIN_FILTER,this.parent.gl.NEAREST);this.parent.gl.disable(this.parent.gl.DEPTH_TEST)},
loadNewShader(b){function a(d,e,f){e=d.createShader(e);d.shaderSource(e,f);d.compileShader(e);d.getShaderParameter(e,d.COMPILE_STATUS)||(console.log(`[Wilson] Couldn't load shader: ${d.getProgramInfoLog(shaderProgram)}`),d.deleteShader(e));return e}this.parent.gl=this.parent.canvas.getContext("webgl");var c=a(this.parent.gl,this.parent.gl.VERTEX_SHADER,"\n\t\t\t\tattribute vec3 position;\n\t\t\t\tvarying vec2 uv;\n\n\t\t\t\tvoid main(void)\n\t\t\t\t{\n\t\t\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\t\t\tuv = position.xy;\n\t\t\t\t}\n\t\t\t");
b=a(this.parent.gl,this.parent.gl.FRAGMENT_SHADER,b);this.shaderProgram=this.parent.gl.createProgram();this.parent.gl.attachShader(this.shaderProgram,c);this.parent.gl.attachShader(this.shaderProgram,b);this.parent.gl.linkProgram(this.shaderProgram);this.parent.gl.getProgramParameter(this.shaderProgram,this.parent.gl.LINK_STATUS)||(console.log(`[Wilson] Couldn't link shader program: ${this.gl.getShaderInfoLog(shader)}`),this.parent.gl.deleteProgram(this.shaderProgram));this.parent.gl.useProgram(this.shaderProgram);
c=this.parent.gl.createBuffer();this.parent.gl.bindBuffer(this.parent.gl.ARRAY_BUFFER,c);this.parent.gl.bufferData(this.parent.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),this.parent.gl.STATIC_DRAW);this.shaderProgram.positionAttribute=this.parent.gl.getAttribLocation(this.shaderProgram,"position");this.parent.gl.enableVertexAttribArray(this.shaderProgram.positionAttribute);this.parent.gl.vertexAttribPointer(this.shaderProgram.positionAttribute,3,this.parent.gl.FLOAT,!1,0,0);this.parent.gl.viewport(0,
0,this.parent.canvasWidth,this.parent.canvasHeight);this.shaderPrograms.push(this.shaderProgram)},createFramebufferTexturePair(b=this.parent.gl.FLOAT){let a=this.parent.gl.createFramebuffer(),c=this.parent.gl.createTexture();this.parent.gl.bindTexture(this.parent.gl.TEXTURE_2D,c);this.parent.gl.texImage2D(this.parent.gl.TEXTURE_2D,0,this.parent.gl.RGBA,this.parent.canvasWidth,this.parent.canvasHeight,0,this.parent.gl.RGBA,b,null);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MAG_FILTER,
this.parent.gl.NEAREST);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MIN_FILTER,this.parent.gl.NEAREST);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_S,this.parent.gl.CLAMP_TO_EDGE);this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_T,this.parent.gl.CLAMP_TO_EDGE);this.parent.gl.disable(this.parent.gl.DEPTH_TEST);this.parent.gl.bindFramebuffer(this.parent.gl.FRAMEBUFFER,a);this.parent.gl.framebufferTexture2D(this.parent.gl.FRAMEBUFFER,
this.parent.gl.COLOR_ATTACHMENT0,this.parent.gl.TEXTURE_2D,c,0);this.framebuffers.push({framebuffer:a,texture:c})},initUniforms(b,a=-1){if(-1===a)for(a=0;a<b.length;a++)this.parent.uniforms[b[a]]=this.parent.gl.getUniformLocation(this.shaderProgram,b[a]);else for(let c=0;c<b.length;c++)"undefined"===typeof this.parent.uniforms[b[c]]&&(this.parent.uniforms[b[c]]={}),this.parent.uniforms[b[c]][a]=this.parent.gl.getUniformLocation(this.shaderPrograms[a],b[c])},getPixelData(){let b=new Uint8Array(this.parent.canvasWidth*
this.parent.canvasHeight*4);this.parent.gl.readPixels(0,0,this.parent.canvasWidth,this.parent.canvasHeight,this.parent.gl.RGBA,this.parent.gl.UNSIGNED_BYTE,b);return b}};draggables={parent:null,container:null,containerWidth:null,containerHeight:null,restrictedWidth:null,restrictedHeight:null,draggables:[],worldCoordinates:[],autoAddContainer:!0,numDraggables:0,static:!1,draggableRadius:12,activeDraggable:-1,lastActiveDraggable:-1,mouseX:0,mouseY:0,mousedownCallback:null,mouseupCallback:null,mousemoveCallback:null,
touchstartCallback:null,touchendCallback:null,touchmoveCallback:null,init(){if(0===document.querySelectorAll("#wilson-draggables-style").length){var b=document.createElement("style");b.textContent="\n\t\t\t\t\t.wilson-output-canvas-container\n\t\t\t\t\t{\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\twidth: fit-content;\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-output-canvas-container.wilson-fullscreen\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.wilson-draggables-container\n\t\t\t\t\t{\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-draggable\n\t\t\t\t\t{\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\n\t\t\t\t\t\twidth: 20px;\n\t\t\t\t\t\theight: 20px;\n\t\t\t\t\t\t\n\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\ttop: 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbackground-color: rgb(255, 255, 255);\n\t\t\t\t\t\tborder: 2px solid rgb(64, 64, 64);\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\t\n\t\t\t\t\t\ttouch-action: none;\n\t\t\t\t\t\t-webkit-touch-callout: none;\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t\t\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\n\t\t\t\t\t\ttransition: width .125s ease-in-out, height .125s ease-in-out, top .125s ease-in-out, left .125s ease-in-out;\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-draggable:active\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 16px;\n\t\t\t\t\t\theight: 16px;\n\t\t\t\t\t\t\n\t\t\t\t\t\tleft: 2px;\n\t\t\t\t\t\ttop: 2px;\n\t\t\t\t\t}\n\t\t\t\t";
b.id="wilson-draggables-style";document.head.appendChild(b)}this.containerWidth=this.container.offsetWidth;this.containerHeight=this.container.offsetHeight;b=this.handleTouchstartEvent.bind(this);let a=this.handleTouchendEvent.bind(this),c=this.handleTouchmoveEvent.bind(this),d=this.handleMousedownEvent.bind(this),e=this.handleMouseupEvent.bind(this),f=this.handleMousemoveEvent.bind(this),g=this.onResize.bind(this);this.static?console.log("[Wilson] Using non-draggable draggables -- is this really what you want to do?"):
(document.documentElement.addEventListener("touchstart",b,!1),document.documentElement.addEventListener("touchmove",c,!1),document.documentElement.addEventListener("touchend",a,!1),document.documentElement.addEventListener("mousedown",d,!1),document.documentElement.addEventListener("mousemove",f,!1),document.documentElement.addEventListener("mouseup",e,!1),window.addEventListener("resize",g),Page.temporaryHandlers.resize.push(g))},add(b,a){let c=Math.floor(this.restrictedHeight*(1-((a-this.parent.worldCenterY)/
this.parent.worldHeight+.5)))+this.draggableRadius,d=Math.floor(this.restrictedWidth*((b-this.parent.worldCenterX)/this.parent.worldWidth+.5))+this.draggableRadius;c<this.draggableRadius&&(c=this.draggableRadius);c>this.containerHeight-this.draggableRadius&&(c=this.containerHeight-this.draggableRadius);d<this.draggableRadius&&(d=this.draggableRadius);d>this.containerWidth-this.draggableRadius&&(d=this.containerWidth-this.draggableRadius);let e=document.createElement("div");e.classList.add("wilson-draggable");
e.classList.add(`wilson-draggable-${this.numDraggables}`);e.style.transform=`translate3d(${d-this.draggableRadius}px, ${c-this.draggableRadius}px, 0)`;this.numDraggables++;this.draggables.push(e);this.worldCoordinates.push([b,a]);this.container.appendChild(e);return e},handleMousedownEvent(b){this.activeDraggable=-1;for(let a=0;a<this.numDraggables;a++)if(b.target.classList.contains(`wilson-draggable-${a}`)&&b.target.parentNode===this.container){b.preventDefault();this.activeDraggable=a;this.currentlyDragging=
!0;this.mouseX=b.clientX;this.mouseY=b.clientY;try{this.mousedownCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],b)}catch(c){}break}},handleMouseupEvent(b){if(-1!==this.activeDraggable){document.body.style.WebkitUserSelect="";this.lastActiveDraggable=this.activeDraggable;try{this.mouseupCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],b)}catch(a){}}this.activeDraggable=-1;this.currentlyDragging=!1},handleMousemoveEvent(b){if(this.currentlyDragging&&
-1!==this.activeDraggable){b.preventDefault();var a=b.clientY;this.mouseX=b.clientX;this.mouseY=a;var c=this.container.getBoundingClientRect();a=b.clientY-c.top;c=b.clientX-c.left;a<this.draggableRadius&&(a=this.draggableRadius);a>this.containerHeight-this.draggableRadius&&(a=this.containerHeight-this.draggableRadius);c<this.draggableRadius&&(c=this.draggableRadius);c>this.containerWidth-this.draggableRadius&&(c=this.containerWidth-this.draggableRadius);this.draggables[this.activeDraggable].style.transform=
`translate3d(${c-this.draggableRadius}px, ${a-this.draggableRadius}px, 0)`;c=(c-this.draggableRadius-this.restrictedWidth/2)/this.restrictedWidth*this.parent.worldWidth+this.parent.worldCenterX;a=-(a-this.draggableRadius-this.restrictedHeight/2)/this.restrictedHeight*this.parent.worldHeight+this.parent.worldCenterY;this.worldCoordinates[this.activeDraggable][0]=c;this.worldCoordinates[this.activeDraggable][1]=a;try{this.mousemoveCallback(this.activeDraggable,c,a,b)}catch(d){}}},handleTouchstartEvent(b){this.activeDraggable=
-1;for(let a=0;a<this.numDraggables;a++)if(b.target.classList.contains(`wilson-draggable-${a}`)&&b.target.parentNode===this.container){b.preventDefault();this.activeDraggable=a;this.currentlyDragging=!0;this.mouseX=b.touches[0].clientX;this.mouseY=b.touches[0].clientY;try{this.touchstartCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],b)}catch(c){}break}},handleTouchendEvent(b){if(-1!==this.activeDraggable){document.body.style.WebkitUserSelect="";this.lastActiveDraggable=
this.activeDraggable;try{this.touchendCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],b)}catch(a){}}this.activeDraggable=-1;this.currentlyDragging=!1},handleTouchmoveEvent(b){if(this.currentlyDragging&&-1!==this.activeDraggable){b.preventDefault();this.mouseX=b.touches[0].clientX;this.mouseY=b.touches[0].clientY;var a=this.container.getBoundingClientRect(),c=this.mouseY-a.top;a=this.mouseX-a.left;c<this.draggableRadius&&(c=this.draggableRadius);c>this.containerHeight-
this.draggableRadius&&(c=this.containerHeight-this.draggableRadius);a<this.draggableRadius&&(a=this.draggableRadius);a>this.containerWidth-this.draggableRadius&&(a=this.containerWidth-this.draggableRadius);this.draggables[this.activeDraggable].style.transform=`translate3d(${a-this.draggableRadius}px, ${c-this.draggableRadius}px, 0)`;a=(a-this.draggableRadius-this.restrictedWidth/2)/this.restrictedWidth*this.parent.worldWidth+this.parent.worldCenterX;c=-(c-this.draggableRadius-this.restrictedHeight/
2)/this.restrictedHeight*this.parent.worldHeight+this.parent.worldCenterY;this.worldCoordinates[this.activeDraggable][0]=a;this.worldCoordinates[this.activeDraggable][1]=c;try{this.touchmoveCallback(this.activeDraggable,a,c,b)}catch(d){}}},recalculateLocations(){for(let b=0;b<this.numDraggables;b++){let a=Math.floor(this.restrictedHeight*(1-((this.worldCoordinates[b][1]-this.parent.worldCenterY)/this.parent.worldHeight+.5)))+this.draggableRadius,c=Math.floor(this.restrictedWidth*((this.worldCoordinates[b][0]-
this.parent.worldCenterX)/this.parent.worldWidth+.5))+this.draggableRadius;a<this.draggableRadius&&(a=this.draggableRadius);a>this.containerHeight-this.draggableRadius&&(a=this.containerHeight-this.draggableRadius);c<this.draggableRadius&&(c=this.draggableRadius);c>this.containerWidth-this.draggableRadius&&(c=this.containerWidth-this.draggableRadius);this.draggables[b].style.transform=`translate3d(${c-this.draggableRadius}px, ${a-this.draggableRadius}px, 0)`}},onResize(){let b=window.getComputedStyle(this.parent.canvas),
a=this.parent.canvas.clientWidth-parseFloat(b.paddingLeft)-parseFloat(b.paddingRight),c=this.parent.canvas.clientHeight-parseFloat(b.paddingTop)-parseFloat(b.paddingBottom);this.container.style.width=a+2*this.draggableRadius+"px";this.container.style.height=c+2*this.draggableRadius+"px";this.containerWidth=a+2*this.draggableRadius;this.containerHeight=c+2*this.draggableRadius;this.restrictedWidth=a;this.restrictedHeight=c;this.container.style.marginTop=parseFloat(b.borderTopWidth)+parseFloat(b.paddingTop)-
this.draggableRadius+"px";this.recalculateLocations()}};fullscreen={currentlyFullscreen:!1,currentlyAnimating:!1,canvasesToResize:[],trueFullscreen:!1,switchFullscreenCallback:null,fullscreenOldScroll:0,oldFooterButtonOffset:0,enterFullscreenButton:null,exitFullscreenButton:null,useFullscreenButton:!1,enterFullscreenButtonIconPath:null,exitFullscreenButtonIconPath:null,fullscreenComponentsContainerLocation:null,fullscreenComponentsContainer:null,init(){if(this.useFullscreenButton&&0===document.querySelectorAll("#wilson-fullscreen-button-style").length){var b=
document.createElement("style");b.textContent="\n\t\t\t\t\t\t.wilson-enter-fullscreen-button, .wilson-exit-fullscreen-button\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidth: 15px;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbackground-color: rgb(255, 255, 255);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tborder: 2px solid rgb(127, 127, 127);\n\t\t\t\t\t\t\tborder-radius: 25%;\n\t\t\t\t\t\t\tpadding: 5px;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\toutline: none;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.wilson-enter-fullscreen-button\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tright: 10px;\n\t\t\t\t\t\t\ttop: 10px;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tz-index: 100;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.wilson-exit-fullscreen-button\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tright: 10px;\n\t\t\t\t\t\t\ttop: 10px;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tz-index: 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t";
b.id="wilson-fullscreen-button-style";document.head.appendChild(b)}0===document.querySelectorAll("#wilson-fullscreen-style").length&&(b=document.createElement("style"),b.textContent="\n\t\t\t\t\t.wilson-fullscreen-components-container.wilson-fullscreen\n\t\t\t\t\t{\n\t\t\t\t\t\tposition: fixed !important;\n\t\t\t\t\t\ttop: 0 !important;\n\t\t\t\t\t\tleft: 0 !important;\n\t\t\t\t\t\t\n\t\t\t\t\t\tz-index: 100 !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.wilson-fullscreen-components-container.wilson-fullscreen .wilson-applet-canvas-container\n\t\t\t\t\t{\n\t\t\t\t\t\tmargin-top: 0 !important;\n\t\t\t\t\t\tmargin-bottom: 0 !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.wilson-fullscreen-components-container.wilson-fullscreen:not(.wilson-true-fullscreen-canvas) .wilson-output-canvas-container\n\t\t\t\t\t{\n\t\t\t\t\t\tmargin-left: calc(50vw - 50vmin) !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.wilson-true-fullscreen-canvas\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 100vw !important;\n\t\t\t\t\t\theight: calc(100% + 4px) !important;\n\t\t\t\t\t\t\n\t\t\t\t\t\tborder: none !important;\n\t\t\t\t\t\tborder-radius: 0 !important;\n\t\t\t\t\t\tpadding: 0 !important;\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-letterboxed-fullscreen-canvas\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 100vmin !important;\n\t\t\t\t\t\theight: calc(100vmin + 4px) !important;\n\t\t\t\t\t\t\n\t\t\t\t\t\tborder: none !important;\n\t\t\t\t\t\tborder-radius: 0 !important;\n\t\t\t\t\t\tpadding: 0 !important;\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-letterboxed-canvas-background\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 100vw;\n\t\t\t\t\t\theight: calc((100vh - 100vmin) / 2 + 4px);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbackground-color: rgb(0, 0, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\t.wilson-black-background\n\t\t\t\t\t{\n\t\t\t\t\t\twidth: 100vw !important;\n\t\t\t\t\t\theight: calc(100% + 4px) !important;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbackground-color: rgb(0, 0, 0) !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.wilson-center-content\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t}\n\t\t\t\t",
b.id="wilson-fullscreen-style",document.head.appendChild(b));this.useFullscreenButton&&(this.enterFullscreenButton=document.createElement("input"),this.enterFullscreenButton.type="image",this.enterFullscreenButton.classList.add("wilson-enter-fullscreen-button"),this.enterFullscreenButton.src=this.enterFullscreenButtonIconPath,this.enterFullscreenButton.alt="Enter Fullscreen",this.enterFullscreenButton.setAttribute("tabindex","-1"),this.parent.canvas.parentNode.appendChild(this.enterFullscreenButton),
Page.Load.HoverEvents.addWithScale(this.enterFullscreenButton,1.1),this.enterFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()}));b=this.onResize.bind(this);window.addEventListener("resize",b);Page.temporaryHandlers.resize.push(b);b=this.onScroll.bind(this);window.addEventListener("scroll",b);Page.temporaryHandlers.scroll.push(b);b=this.onKeypress.bind(this);document.documentElement.addEventListener("keydown",b);Page.temporaryHandlers.keydown.push(b)},switchFullscreen(){this.currentlyFullscreen?
this.currentlyAnimating||(this.currentlyFullscreen=!1,this.currentlyAnimating=!0,anime({targets:Site.Settings.metaThemeColorElement,content:this.oldMetaThemeColor,duration:Site.opacityAnimationTime,easing:"cubicBezier(.42, 0, .58, 1)"}),Page.Animate.changeOpacity(document.body,0,Site.opacityAnimationTime),setTimeout(()=>{this.fullscreenComponentsContainerLocation.appendChild(this.fullscreenComponentsContainer);try{document.body.querySelector("#header").style.zIndex=110,document.body.querySelector("#header-container").style.zIndex=
105}catch(b){}this.parent.canvas.classList.remove("wilson-fullscreen");this.parent.canvas.parentNode.classList.remove("wilson-fullscreen");this.fullscreenComponentsContainer.classList.remove("wilson-fullscreen");document.documentElement.style.overflowY="visible";document.body.style.overflowY="visible";document.body.style.width="";document.body.style.height="";document.documentElement.style.userSelect="auto";document.documentElement.style.WebkitUserSelect="auto";document.removeEventListener("gesturestart",
this.preventGestures);document.removeEventListener("gesturechange",this.preventGestures);document.removeEventListener("gestureend",this.preventGestures);try{this.exitFullscreenButton.remove()}catch(b){}this.useFullscreenButton&&(this.enterFullscreenButton=document.createElement("input"),this.enterFullscreenButton.type="image",this.enterFullscreenButton.classList.add("wilson-enter-fullscreen-button"),this.enterFullscreenButton.src=this.enterFullscreenButtonIconPath,this.enterFullscreenButton.alt="Enter Fullscreen",
this.enterFullscreenButton.setAttribute("tabindex","-1"),this.parent.canvas.parentNode.appendChild(this.enterFullscreenButton),Page.Load.HoverEvents.addWithScale(this.enterFullscreenButton,1.1),this.enterFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()}));this.fullscreenComponentsContainer.classList.remove("wilson-true-fullscreen-canvas");for(let b=0;b<this.canvasesToResize.length;b++){this.canvasesToResize[b].classList.remove("wilson-true-fullscreen-canvas");this.canvasesToResize[b].classList.remove("wilson-letterboxed-fullscreen-canvas");
this.parent.canvas.parentNode.parentNode.classList.remove("wilson-black-background");try{let a=document.querySelectorAll(".wilson-letterboxed-canvas-background");for(let c=0;c<a.length;c++)a[c].remove()}catch(a){}try{this.switchFullscreenCallback()}catch(a){}this.parent.draggables.onResize()}if(this.parent.useDraggables)this.parent.draggables.onResize();setTimeout(()=>{window.scroll(0,this.fullscreenOldScroll);Page.Animate.changeOpacity(document.body,1,Site.opacityAnimationTime);setTimeout(()=>{this.currentlyAnimating=
!1},Site.opacityAnimationTime)},10)},Site.opacityAnimationTime)):this.currentlyAnimating||(this.currentlyAnimating=this.currentlyFullscreen=!0,this.fullscreenOldScroll=window.scrollY,Page.Animate.changeOpacity(document.body,0,Site.opacityAnimationTime),setTimeout(()=>{document.body.appendChild(this.fullscreenComponentsContainer);try{document.body.querySelector("#header").style.zIndex=90,document.body.querySelector("#header-container").style.zIndex=90}catch(a){}this.parent.canvas.classList.add("wilson-fullscreen");
this.parent.canvas.parentNode.classList.add("wilson-fullscreen");this.fullscreenComponentsContainer.classList.add("wilson-fullscreen");try{this.enterFullscreenButton.remove()}catch(a){}this.useFullscreenButton&&(this.exitFullscreenButton=document.createElement("input"),this.exitFullscreenButton.type="image",this.exitFullscreenButton.classList.add("wilson-exit-fullscreen-button"),this.exitFullscreenButton.src=this.exitFullscreenButtonIconPath,this.exitFullscreenButton.alt="Exit Fullscreen",this.exitFullscreenButton.setAttribute("tabindex",
"-1"),document.body.appendChild(this.exitFullscreenButton),Page.Load.HoverEvents.addWithScale(this.exitFullscreenButton,1.1),this.exitFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()}));this.oldMetaThemeColor=Site.Settings.metaThemeColorElement.getAttribute("content");document.documentElement.style.overflowY="hidden";document.body.style.overflowY="hidden";document.body.style.width="100vw";document.body.style.height="100%";document.documentElement.style.userSelect="none";document.documentElement.style.WebkitUserSelect=
"none";document.addEventListener("gesturestart",this.preventGestures);document.addEventListener("gesturechange",this.preventGestures);document.addEventListener("gestureend",this.preventGestures);anime({targets:Site.Settings.metaThemeColorElement,content:"#000000",duration:Site.opacityAnimationTime,easing:"cubicBezier(.42, 0, .58, 1)"});if(this.trueFullscreen){this.fullscreenComponentsContainer.classList.add("wilson-true-fullscreen-canvas");for(var b=0;b<this.canvasesToResize.length;b++){this.canvasesToResize[b].classList.add("wilson-true-fullscreen-canvas");
this.parent.canvas.parentNode.parentNode.classList.add("wilson-black-background");try{this.switchFullscreenCallback()}catch(a){}this.parent.draggables.onResize()}window.scroll(0,0)}else{for(b=0;b<this.canvasesToResize.length;b++){this.canvasesToResize[b].classList.add("wilson-letterboxed-fullscreen-canvas");try{this.switchFullscreenCallback()}catch(a){}this.parent.draggables.onResize()}this.parent.canvas.parentNode.parentNode.insertAdjacentHTML("beforebegin",'<div class="wilson-letterboxed-canvas-background"></div>');
this.parent.canvas.parentNode.parentNode.insertAdjacentHTML("afterend",'<div class="wilson-letterboxed-canvas-background"></div>');this.parent.canvas.parentNode.parentNode.classList.add("wilson-black-background");this.onResize()}if(this.parent.useDraggables)this.parent.draggables.onResize();Page.Animate.changeOpacity(document.body,1,Site.opacityAnimationTime);setTimeout(()=>{this.currentlyAnimating=!1;this.onResize()},Site.opacityAnimationTime)},Site.opacityAnimationTime))},onResize(){this.currentlyFullscreen&&
(window.scroll(0,0),setTimeout(()=>{window.scroll(0,0)},500))},onScroll(){this.currentlyFullscreen&&window.scroll(0,this.fullscreenLockedScroll)},onKeypress(b){27===b.keyCode&&this.currentlyFullscreen&&this.switchFullscreen()},preventGestures(b){b.preventDefault()}};input={mouseX:null,mouseY:null,lastRow1:-1,lastCol1:-1,lastRow2:-1,lastCol2:-1,currentlyDragging:!1,wasPinching:!1,mousedownCallback:null,mouseupCallback:null,mousemoveCallback:null,mousedragCallback:null,touchstartCallback:null,touchupCallback:null,
touchmoveCallback:null,pinchCallback:null,wheelCallback:null,onMousedownBound:null,onMouseupBound:null,onMousemoveBound:null,onTouchstartBound:null,onTouchupBound:null,onTouchmoveBound:null,onWheelBound:null,init(){for(let b=0;b<this.parent.fullscreen.canvasesToResize.length;b++)this.onMousedownBound=this.onMousedown.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("mousedown",this.onMousedownBound),this.onMouseupBound=this.onMouseup.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("mouseup",
this.onMouseupBound),this.onMousemoveBound=this.onMousemove.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("mousemove",this.onMousemoveBound),this.onTouchstartBound=this.onTouchstart.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("touchstart",this.onTouchstartBound),this.onTouchendBound=this.onTouchend.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("touchend",this.onTouchendBound),this.onTouchmoveBound=this.onTouchmove.bind(this),
this.parent.fullscreen.canvasesToResize[b].addEventListener("touchmove",this.onTouchmoveBound),this.onWheelBound=this.onWheel.bind(this),this.parent.fullscreen.canvasesToResize[b].addEventListener("wheel",this.onWheelBound),this.parent.fullscreen.canvasesToResize[b].addEventListener("mouseleave",a=>{let c=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);if(this.currentlyDragging){this.currentlyDragging=!1;try{this.mouseupCallback(...c,a)}catch(d){}}})},onMousedown(b){if(!b.target.classList.contains("wilson-draggable")){this.mouseX=
b.clientX;this.mouseY=b.clientY;this.currentlyDragging=!0;var a=this.parent.canvas.getBoundingClientRect(),c=(this.mouseY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;a=(this.mouseX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth;var d=this.parent.utils.interpolate.canvasToWorld(c,a);this.lastRow1=c;this.lastCol1=a;null!==this.mousedownCallback&&(b.preventDefault(),
this.mousedownCallback(...d,b))}},onMouseup(b){if(!b.target.classList.contains("wilson-draggable")&&(b.preventDefault(),this.mouseX=b.clientX,this.mouseY=b.clientY,this.currentlyDragging=!1,null!==this.mouseupCallback)){var a=this.parent.canvas.getBoundingClientRect(),c=(this.mouseY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;a=(this.mouseX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth;
var d=this.parent.utils.interpolate.canvasToWorld(c,a);this.mouseupCallback(...d,b);this.lastRow1=c;this.lastCol1=a}},onMousemove(b){if(!b.target.classList.contains("wilson-draggable")){b.preventDefault();this.mouseX=b.clientX;this.mouseY=b.clientY;var a=this.parent.canvas.getBoundingClientRect(),c=(this.mouseY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;a=(this.mouseX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/
this.parent.draggables.restrictedWidth;var d=this.parent.utils.interpolate.canvasToWorld(c,a),e=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);null!==this.mousedragCallback&&this.currentlyDragging?this.mousedragCallback(...d,d[0]-e[0],d[1]-e[1],b):null===this.mousemoveCallback||this.currentlyDragging||this.mousemoveCallback(...d,d[0]-e[0],d[1]-e[1],b);this.lastRow1=c;this.lastCol1=a}},onTouchstart(b){if(!b.target.classList.contains("wilson-draggable")){this.mouseX=b.touches[0].clientX;
this.mouseY=b.touches[0].clientY;var a=this.parent.canvas.getBoundingClientRect(),c=(this.mouseY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;a=(this.mouseX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth;var d=this.parent.utils.interpolate.canvasToWorld(c,a);this.lastRow1=c;this.lastCol1=a;null!==this.touchstartCallback&&(b.preventDefault(),this.touchstartCallback(...d,
b))}},onTouchend(b){if(!b.target.classList.contains("wilson-draggable")&&(b.preventDefault(),this.lastCol2=this.lastRow2=this.touchDistance=-1,0===b.touches.length&&(this.wasPinching=!1),null!==this.touchendCallback&&-1!==this.lastRow1)){let a=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);this.touchendCallback(...a,b)}},onTouchmove(b){if(!b.target.classList.contains("wilson-draggable")){b.preventDefault();var a=this.parent.canvas.getBoundingClientRect();if(2<=b.touches.length&&
null!==this.pinchCallback){this.wasPinching=!0;var c=(b.touches[1].clientY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,d=(b.touches[1].clientX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,e=this.parent.utils.interpolate.canvasToWorld((b.touches[0].clientY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,
(b.touches[0].clientX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth),f=this.parent.utils.interpolate.canvasToWorld(c,d);c=e[0]-f[0];d=e[1]-f[1];c=Math.sqrt(c*c+d*d);d=(e[0]+f[0])/2;e=(e[1]+f[1])/2;var g=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1),h=this.parent.utils.interpolate.canvasToWorld(this.lastRow2,this.lastCol2);f=g[0]-h[0];g=g[1]-h[1];f=Math.sqrt(f*f+g*g);-1!==this.lastRow2&&this.pinchCallback(d,
e,c-f,b)}else if(this.wasPinching)return;this.mouseX=b.touches[0].clientX;this.mouseY=b.touches[0].clientY;if(null!==this.touchmoveCallback){c=(this.mouseY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;d=(this.mouseX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth;e=this.parent.utils.interpolate.canvasToWorld(c,d);g=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,
this.lastCol1);if(1===b.touches.length)this.touchmoveCallback(...e,e[0]-g[0],e[1]-g[1],b);else{f=e[0]-g[0];g=e[1]-g[1];h=(b.touches[1].clientY-a.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight;a=(b.touches[1].clientX-a.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth;let l=this.parent.utils.interpolate.canvasToWorld(h,a);var k=this.parent.utils.interpolate.canvasToWorld(this.lastRow2,
this.lastCol2);let m=l[0]-k[0];k=l[1]-k[1];.005>Math.abs(f-m)/this.parent.worldWidth&&.005>Math.abs(g-k)/this.parent.worldHeight&&this.touchmoveCallback((e[0]+l[0])/2,(e[1]+l[1])/2,(f+m)/2,(g+k)/2,b);this.lastRow2=h;this.lastCol2=a}this.lastRow1=c;this.lastCol1=d}}},onWheel(b){if(null!==this.wheelCallback&&(b.preventDefault(),-1!==this.lastRow1)){let a=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);this.wheelCallback(...a,b.deltaY,b)}},getZoomedWorldCenter(b,a,c,d){return[b-
(b-this.parent.worldCenterX)/this.parent.worldWidth*c,a-(a-this.parent.worldCenterY)/this.parent.worldHeight*d]}};changeCanvasSize(b,a){this.canvasWidth=b;this.canvasHeight=a;this.canvas.setAttribute("width",b);this.canvas.setAttribute("height",a);0!==this.render.renderType&&this.gl.viewport(0,0,b,a);b=window.getComputedStyle(this.canvas);this.topPadding=parseFloat(b.paddingTop);this.leftPadding=parseFloat(b.paddingLeft);this.topBorder=parseFloat(b.borderTopWidth);this.leftBorder=parseFloat(b.borderLeftWidth)}downloadFrame(b){1===
this.render.renderType?this.render.drawFrame(this.render.lastImage):2===this.render.renderType&&this.render.drawFrame();this.canvas.toBlob(a=>{let c=document.createElement("a");c.download=b;c.href=window.URL.createObjectURL(a);c.click();c.remove()})}};
