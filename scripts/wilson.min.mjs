import anime from"./anime.min.js";import{changeOpacity,opacityAnimationTime}from"/scripts/src/animation.min.mjs";import{addHoverEventWithScale}from"/scripts/src/hover-events.min.mjs";import{addTemporaryListener}from"/scripts/src/main.min.mjs";import{metaThemeColorElement}from"/scripts/src/settings.min.mjs";class Wilson{canvas=null;ctx=null;gl=null;shaderPrograms=[];uniforms={};canvasWidth=null;canvasHeight=null;worldWidth=2;worldHeight=2;worldCenterX=0;worldCenterY=0;outputCanvasContainer=null;useDraggables=!1;topPadding=0;leftPadding=0;topBorder=0;leftBorder=0;constructor(canvas,options){this.canvas=canvas,this.canvasWidth=void 0===options.canvasWidth?parseInt(this.canvas.getAttribute("width")):options.canvasWidth,this.canvasHeight=void 0===options.canvasHeight?parseInt(this.canvas.getAttribute("height")):options.canvasHeight,this.canvas.setAttribute("width",this.canvasWidth),this.canvas.setAttribute("height",this.canvasHeight);canvas=window.getComputedStyle(this.canvas);if(this.topPadding=parseFloat(canvas.paddingTop),this.leftPadding=parseFloat(canvas.paddingLeft),this.topBorder=parseFloat(canvas.borderTopWidth),this.leftBorder=parseFloat(canvas.borderLeftWidth),""!==(((((this.utils.interpolate.parent=this).render.parent=this).draggables.parent=this).fullscreen.parent=this).input.parent=this).canvas.id?console.log(`[Wilson] Registered a ${this.canvasWidth}x${this.canvasHeight} canvas with ID `+this.canvas.id):console.log(`[Wilson] Registered a ${this.canvasWidth}x${this.canvasHeight} canvas`),void 0===options.canvasesToResize&&(options.canvasesToResize=[this.canvas]),void 0!==options.worldWidth&&(this.worldWidth=options.worldWidth),void 0!==options.worldHeight&&(this.worldHeight=options.worldHeight),void 0!==options.worldCenterX&&(this.worldCenterX=options.worldCenterX),void 0!==options.worldCenterY&&(this.worldCenterY=options.worldCenterY),void 0===options.renderer||"hybrid"===options.renderer?this.render.renderType=1:"cpu"===options.renderer?this.render.renderType=0:this.render.renderType=2,0===this.render.renderType)this.ctx=this.canvas.getContext("2d",{colorSpace:"display-p3"}),this.render.imgData=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.render.drawFrame=this.render.drawFrameCpu;else if(1===this.render.renderType){this.render.initWebglHybrid(),this.render.drawFrame=this.render.drawFrameHybrid;try{this.gl.getExtension("OES_texture_float")}catch(ex){console.log("[Wilson] Could not load float textures: "+ex)}}else{try{this.render.loadNewShader(options.shader)}catch(ex){console.error("[Wilson] Error loading shader: "+ex)}this.render.drawFrame=this.render.drawFrameGpu;try{this.gl.getExtension("OES_texture_float")}catch(ex){console.log("[Wilson] Could not load float textures: "+ex)}}void 0!==options.autoArrangeCanvases&&!options.autoArrangeCanvases||this.arrangeCanvases(options),this.input.mousedownCallback=void 0===options.mousedownCallback?null:options.mousedownCallback,this.input.mouseupCallback=void 0===options.mouseupCallback?null:options.mouseupCallback,this.input.mousemoveCallback=void 0===options.mousemoveCallback?null:options.mousemoveCallback,this.input.mousedragCallback=void 0===options.mousedragCallback?null:options.mousedragCallback,this.input.touchstartCallback=void 0===options.touchstartCallback?null:options.touchstartCallback,this.input.touchendCallback=void 0===options.touchendCallback?null:options.touchendCallback,this.input.touchmoveCallback=void 0===options.touchmoveCallback?null:options.touchmoveCallback,this.input.pinchCallback=void 0===options.pinchCallback?null:options.pinchCallback,this.input.wheelCallback=void 0===options.wheelCallback?null:options.wheelCallback,this.input.init(),this.useDraggables=!0,this.draggables.static=void 0!==options.draggablesStatic&&options.draggablesStatic,this.draggables.mousedownCallback=void 0===options.draggablesMousedownCallback?null:options.draggablesMousedownCallback,this.draggables.mouseupCallback=void 0===options.draggablesMouseupCallback?null:options.draggablesMouseupCallback,this.draggables.mousemoveCallback=void 0===options.draggablesMousemoveCallback?null:options.draggablesMousemoveCallback,this.draggables.touchstartCallback=void 0===options.draggablesTouchstartCallback?null:options.draggablesTouchstartCallback,this.draggables.touchendCallback=void 0===options.draggablesTouchendCallback?null:options.draggablesTouchendCallback,this.draggables.touchmoveCallback=void 0===options.draggablesTouchmoveCallback?null:options.draggablesTouchmoveCallback,this.draggables.init(),void 0!==options.useFullscreen&&options.useFullscreen&&(this.fullscreen.trueFullscreen=void 0!==options.trueFullscreen&&options.trueFullscreen,this.fullscreen.useFullscreenButton=void 0!==options.useFullscreenButton&&options.useFullscreenButton,this.fullscreen.useFullscreenButton&&void 0===options.enterFullscreenButtonIconPath&&console.error("Missing path to Enter Fullscreen button image"),this.fullscreen.useFullscreenButton&&void 0===options.exitFullscreenButtonIconPath&&console.error("Missing path to Exit Fullscreen button image"),this.fullscreen.enterFullscreenButtonIconPath=options.enterFullscreenButtonIconPath,this.fullscreen.exitFullscreenButtonIconPath=options.exitFullscreenButtonIconPath,this.fullscreen.switchFullscreenCallback=void 0!==options.switchFullscreenCallback&&options.switchFullscreenCallback,void 0===options.canvasesToResize&&console.error("Missing canvases to resize"),this.fullscreen.canvasesToResize=options.canvasesToResize,this.fullscreen.init())}arrangeCanvases(options){0===document.querySelectorAll("#wilson-style").length&&((element=document.createElement("style")).textContent=`
				.wilson-output-canvas-container
				{
					position: relative;
					-webkit-user-select: none;
					user-select: none;
				}
				
				.wilson-applet-canvas-container
				{
					-webkit-user-select: none;
					user-select: none;
				}
				
				.wilson-center-content
				{
					display: flex;
					justify-content: center;
					margin: 0 auto;
				}
			`,element.id="wilson-style",document.head.appendChild(element));var appletCanvasContainer=document.createElement("div");appletCanvasContainer.classList.add("wilson-applet-canvas-container"),appletCanvasContainer.classList.add("wilson-center-content"),this.canvas.parentNode.insertBefore(appletCanvasContainer,this.canvas),this.outputCanvasContainer=document.createElement("div"),this.outputCanvasContainer.classList.add("wilson-output-canvas-container"),appletCanvasContainer.appendChild(this.outputCanvasContainer);for(let i=0;i<options.canvasesToResize.length;i++)appletCanvasContainer.appendChild(options.canvasesToResize[i]);this.outputCanvasContainer.appendChild(this.canvas),this.draggables.container=document.createElement("div"),this.draggables.container.classList.add("wilson-draggables-container"),appletCanvasContainer.appendChild(this.draggables.container),this.fullscreen.canvasesToResize.push(this.draggables.container);var element=window.getComputedStyle(this.canvas),width=this.canvas.clientWidth-parseFloat(element.paddingLeft)-parseFloat(element.paddingRight),height=this.canvas.clientHeight-parseFloat(element.paddingTop)-parseFloat(element.paddingBottom);this.draggables.container.style.width=width+2*this.draggables.draggableRadius+"px",this.draggables.container.style.height=height+2*this.draggables.draggableRadius+"px",this.draggables.containerWidth=width+2*this.draggables.draggableRadius,this.draggables.containerHeight=height+2*this.draggables.draggableRadius,this.draggables.restrictedWidth=width,this.draggables.restrictedHeight=height,this.draggables.container.style.marginTop=parseFloat(element.borderTopWidth)+parseFloat(element.paddingTop)-this.draggables.draggableRadius+"px",this.fullscreen.fullscreenComponentsContainer=document.createElement("div"),this.fullscreen.fullscreenComponentsContainer.classList.add("wilson-fullscreen-components-container"),appletCanvasContainer.parentNode.insertBefore(this.fullscreen.fullscreenComponentsContainer,appletCanvasContainer),this.fullscreen.fullscreenComponentsContainer.appendChild(appletCanvasContainer),this.fullscreen.fullscreenComponentsContainerLocation=document.createElement("div"),this.fullscreen.fullscreenComponentsContainer.parentNode.insertBefore(this.fullscreen.fullscreenComponentsContainerLocation,this.fullscreen.fullscreenComponentsContainer),this.fullscreen.fullscreenComponentsContainerLocation.appendChild(this.fullscreen.fullscreenComponentsContainer);for(let i=0;i<this.fullscreen.canvasesToResize.length;i++)this.fullscreen.canvasesToResize[i].addEventListener("gesturestart",e=>e.preventDefault()),this.fullscreen.canvasesToResize[i].addEventListener("gesturechange",e=>e.preventDefault()),this.fullscreen.canvasesToResize[i].addEventListener("gestureend",e=>e.preventDefault()),this.fullscreen.canvasesToResize[i].addEventListener("click",e=>e.preventDefault())}utils={interpolate:{canvasToWorld(row,col){return[(col/this.parent.canvasWidth-.5)*this.parent.worldWidth+this.parent.worldCenterX,(.5-row/this.parent.canvasHeight)*this.parent.worldHeight+this.parent.worldCenterY]},worldToCanvas(x,y){return[Math.floor((.5-(y-this.parent.worldCenterY)/this.parent.worldHeight)*this.parent.canvasHeight),Math.floor(((x-this.parent.worldCenterX)/this.parent.worldWidth+.5)*this.parent.canvasWidth)]}},hsvToRgb(h,s,v){function f(n){n=(n+6*h)%6;return v-v*s*Math.max(0,Math.min(n,Math.min(4-n,1)))}return[255*f(5),255*f(3),255*f(1)]}};render={drawFrame:null,renderType:null,lastImage:null,imgData:null,shaderProgram:null,shaderPrograms:[],texture:null,framebuffers:[],drawFrameCpu(image){this.parent.ctx.putImageData(new ImageData(image,this.parent.canvasWidth,this.parent.canvasHeight),0,0)},drawFrameHybrid(image){this.lastImage=image,this.parent.gl.texImage2D(this.parent.gl.TEXTURE_2D,0,this.parent.gl.RGBA,this.parent.canvasWidth,this.parent.canvasHeight,0,this.parent.gl.RGBA,this.parent.gl.UNSIGNED_BYTE,image),this.parent.gl.drawArrays(this.parent.gl.TRIANGLE_STRIP,0,4)},drawFrameGpu(){this.parent.gl.drawArrays(this.parent.gl.TRIANGLE_STRIP,0,4)},initWebglHybrid(){this.parent.gl=this.parent.canvas.getContext("webgl2");var vertexShader=loadShader(this.parent.gl,this.parent.gl.VERTEX_SHADER,`
				attribute vec3 position;
				varying vec2 uv;

				void main(void)
				{
					gl_Position = vec4(position, 1.0);

					//Interpolate quad coordinates in the fragment shader.
					uv = position.xy;
				}
			`),fragShader=loadShader(this.parent.gl,this.parent.gl.FRAGMENT_SHADER,`
				precision highp float;
				
				varying vec2 uv;
				
				uniform sampler2D uTexture;
				
				
				
				void main(void)
				{
					gl_FragColor = texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0);
				}
			`),vertexShader=(this.shaderProgram=this.parent.gl.createProgram(),this.parent.gl.attachShader(this.shaderProgram,vertexShader),this.parent.gl.attachShader(this.shaderProgram,fragShader),this.parent.gl.linkProgram(this.shaderProgram),this.parent.gl.getProgramParameter(this.shaderProgram,this.parent.gl.LINK_STATUS)||(console.error("[Wilson] Couldn't link shader program: "+this.parent.gl.getShaderInfoLog(fragShader)),this.parent.gl.deleteProgram(this.shaderProgram)),this.parent.gl.useProgram(this.shaderProgram),this.parent.gl.createBuffer());function loadShader(gl,type,source){type=gl.createShader(type);return gl.shaderSource(type,source),gl.compileShader(type),gl.getShaderParameter(type,gl.COMPILE_STATUS)||(console.error("[Wilson] Couldn't load shader: "+gl.getShaderInfoLog(type)),gl.deleteShader(type)),type}this.parent.gl.bindBuffer(this.parent.gl.ARRAY_BUFFER,vertexShader),this.parent.gl.bufferData(this.parent.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),this.parent.gl.STATIC_DRAW),this.shaderProgram.positionAttribute=this.parent.gl.getAttribLocation(this.shaderProgram,"position"),this.parent.gl.enableVertexAttribArray(this.shaderProgram.positionAttribute),this.parent.gl.vertexAttribPointer(this.shaderProgram.positionAttribute,3,this.parent.gl.FLOAT,!1,0,0),this.parent.gl.viewport(0,0,this.parent.canvasWidth,this.parent.canvasHeight),this.parent.gl.pixelStorei(this.parent.gl.UNPACK_ALIGNMENT,1),this.parent.gl.pixelStorei(this.parent.gl.UNPACK_FLIP_Y_WEBGL,1),this.texture=this.parent.gl.createTexture(),this.parent.gl.bindTexture(this.parent.gl.TEXTURE_2D,this.texture),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_S,this.parent.gl.CLAMP_TO_EDGE),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_T,this.parent.gl.CLAMP_TO_EDGE),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MAG_FILTER,this.parent.gl.NEAREST),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MIN_FILTER,this.parent.gl.NEAREST),this.parent.gl.disable(this.parent.gl.DEPTH_TEST)},loadNewShader(fragShaderSource){this.parent.gl=this.parent.canvas.getContext("webgl");var vertexShader=loadShader(this.parent.gl,this.parent.gl.VERTEX_SHADER,`
				attribute vec3 position;
				varying vec2 uv;

				void main(void)
				{
					gl_Position = vec4(position, 1.0);

					//Interpolate quad coordinates in the fragment shader.
					uv = position.xy;
				}
			`),fragShaderSource=loadShader(this.parent.gl,this.parent.gl.FRAGMENT_SHADER,fragShaderSource),vertexShader=(this.shaderProgram=this.parent.gl.createProgram(),this.parent.gl.attachShader(this.shaderProgram,vertexShader),this.parent.gl.attachShader(this.shaderProgram,fragShaderSource),this.parent.gl.linkProgram(this.shaderProgram),this.parent.gl.getProgramParameter(this.shaderProgram,this.parent.gl.LINK_STATUS)||(console.log("[Wilson] Couldn't link shader program: "+this.gl.getShaderInfoLog(fragShaderSource)),this.parent.gl.deleteProgram(this.shaderProgram)),this.parent.gl.useProgram(this.shaderProgram),this.parent.gl.createBuffer());function loadShader(gl,type,source){type=gl.createShader(type);return gl.shaderSource(type,source),gl.compileShader(type),gl.getShaderParameter(type,gl.COMPILE_STATUS)||(console.log("[Wilson] Couldn't load shader: "+gl.getProgramInfoLog(type)),gl.deleteShader(type)),type}this.parent.gl.bindBuffer(this.parent.gl.ARRAY_BUFFER,vertexShader),this.parent.gl.bufferData(this.parent.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),this.parent.gl.STATIC_DRAW),this.shaderProgram.positionAttribute=this.parent.gl.getAttribLocation(this.shaderProgram,"position"),this.parent.gl.enableVertexAttribArray(this.shaderProgram.positionAttribute),this.parent.gl.vertexAttribPointer(this.shaderProgram.positionAttribute,3,this.parent.gl.FLOAT,!1,0,0),this.parent.gl.viewport(0,0,this.parent.canvasWidth,this.parent.canvasHeight),this.shaderPrograms.push(this.shaderProgram)},createFramebufferTexturePair(type=this.parent.gl.FLOAT){var framebuffer=this.parent.gl.createFramebuffer(),texture=this.parent.gl.createTexture();this.parent.gl.bindTexture(this.parent.gl.TEXTURE_2D,texture),this.parent.gl.texImage2D(this.parent.gl.TEXTURE_2D,0,this.parent.gl.RGBA,this.parent.canvasWidth,this.parent.canvasHeight,0,this.parent.gl.RGBA,type,null),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MAG_FILTER,this.parent.gl.NEAREST),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_MIN_FILTER,this.parent.gl.NEAREST),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_S,this.parent.gl.CLAMP_TO_EDGE),this.parent.gl.texParameteri(this.parent.gl.TEXTURE_2D,this.parent.gl.TEXTURE_WRAP_T,this.parent.gl.CLAMP_TO_EDGE),this.parent.gl.disable(this.parent.gl.DEPTH_TEST),this.parent.gl.bindFramebuffer(this.parent.gl.FRAMEBUFFER,framebuffer),this.parent.gl.framebufferTexture2D(this.parent.gl.FRAMEBUFFER,this.parent.gl.COLOR_ATTACHMENT0,this.parent.gl.TEXTURE_2D,texture,0),this.framebuffers.push({framebuffer:framebuffer,texture:texture})},initUniforms(variableNames,shaderProgramIndex=-1){if(-1===shaderProgramIndex)for(let i=0;i<variableNames.length;i++)this.parent.uniforms[variableNames[i]]=this.parent.gl.getUniformLocation(this.shaderProgram,variableNames[i]);else for(let i=0;i<variableNames.length;i++)void 0===this.parent.uniforms[variableNames[i]]&&(this.parent.uniforms[variableNames[i]]={}),this.parent.uniforms[variableNames[i]][shaderProgramIndex]=this.parent.gl.getUniformLocation(this.shaderPrograms[shaderProgramIndex],variableNames[i])},getPixelData(){var pixels=new Uint8Array(this.parent.canvasWidth*this.parent.canvasHeight*4);return this.parent.gl.readPixels(0,0,this.parent.canvasWidth,this.parent.canvasHeight,this.parent.gl.RGBA,this.parent.gl.UNSIGNED_BYTE,pixels),pixels}};draggables={parent:null,container:null,containerWidth:null,containerHeight:null,restrictedWidth:null,restrictedHeight:null,draggables:[],worldCoordinates:[],autoAddContainer:!0,numDraggables:0,static:!1,draggableRadius:12,activeDraggable:-1,lastActiveDraggable:-1,mouseX:0,mouseY:0,mousedownCallback:null,mouseupCallback:null,mousemoveCallback:null,touchstartCallback:null,touchendCallback:null,touchmoveCallback:null,init(){0===document.querySelectorAll("#wilson-draggables-style").length&&((element=document.createElement("style")).textContent=`
					.wilson-output-canvas-container
					{
						position: relative;
						width: fit-content;
					}

					.wilson-output-canvas-container.wilson-fullscreen
					{
						width: 100%;
					}
					
					.wilson-draggables-container
					{
						position: absolute;
						
						-webkit-user-select: none;
						user-select: none;
					}

					.wilson-draggable
					{
						position: absolute;
						
						width: 20px;
						height: 20px;
						
						left: 0;
						top: 0;
						
						background-color: rgb(255, 255, 255);
						border: 2px solid rgb(64, 64, 64);
						border-radius: 50%;
						
						touch-action: none;
						-webkit-touch-callout: none;
						-webkit-user-select: none;
						user-select: none;
						
						cursor: pointer;
						
						transition: width .125s ease-in-out, height .125s ease-in-out, top .125s ease-in-out, left .125s ease-in-out;
					}

					.wilson-draggable:active
					{
						width: 16px;
						height: 16px;
						
						left: 2px;
						top: 2px;
					}
				`,element.id="wilson-draggables-style",document.head.appendChild(element)),this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.offsetHeight;var element=this.handleTouchstartEvent.bind(this),handleTouchendEventBound=this.handleTouchendEvent.bind(this),handleTouchmoveEventBound=this.handleTouchmoveEvent.bind(this),handleMousedownEventBound=this.handleMousedownEvent.bind(this),handleMouseupEventBound=this.handleMouseupEvent.bind(this),handleMousemoveEventBound=this.handleMousemoveEvent.bind(this),onResizeBound=this.onResize.bind(this);this.static||(addTemporaryListener({object:document.documentElement,event:"touchstart",callback:element}),addTemporaryListener({object:document.documentElement,event:"touchmove",callback:handleTouchmoveEventBound}),addTemporaryListener({object:document.documentElement,event:"touchend",callback:handleTouchendEventBound}),addTemporaryListener({object:document.documentElement,event:"mousedown",callback:handleMousedownEventBound}),addTemporaryListener({object:document.documentElement,event:"mousemove",callback:handleMousemoveEventBound}),addTemporaryListener({object:document.documentElement,event:"mouseup",callback:handleMouseupEventBound}),addTemporaryListener({object:window,event:"resize",callback:onResizeBound}))},add(x,y){let row=Math.floor(this.restrictedHeight*(1-((y-this.parent.worldCenterY)/this.parent.worldHeight+.5)))+this.draggableRadius,col=Math.floor(this.restrictedWidth*((x-this.parent.worldCenterX)/this.parent.worldWidth+.5))+this.draggableRadius;(row=row<this.draggableRadius?this.draggableRadius:row)>this.containerHeight-this.draggableRadius&&(row=this.containerHeight-this.draggableRadius),(col=col<this.draggableRadius?this.draggableRadius:col)>this.containerWidth-this.draggableRadius&&(col=this.containerWidth-this.draggableRadius);var element=document.createElement("div");return element.classList.add("wilson-draggable"),element.classList.add("wilson-draggable-"+this.numDraggables),element.style.transform=`translate3d(${col-this.draggableRadius}px, ${row-this.draggableRadius}px, 0)`,this.numDraggables++,this.draggables.push(element),this.worldCoordinates.push([x,y]),this.container.appendChild(element),element},handleMousedownEvent(e){this.activeDraggable=-1;for(let i=0;i<this.numDraggables;i++)if(e.target.classList.contains("wilson-draggable-"+i)&&e.target.parentNode===this.container){e.preventDefault(),this.activeDraggable=i,this.currentlyDragging=!0,this.mouseX=e.clientX,this.mouseY=e.clientY;try{this.mousedownCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],e)}catch(ex){}break}},handleMouseupEvent(e){if(-1!==this.activeDraggable){document.body.style.WebkitUserSelect="",this.lastActiveDraggable=this.activeDraggable;try{this.mouseupCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],e)}catch(ex){}}this.activeDraggable=-1,this.currentlyDragging=!1},handleMousemoveEvent(e){if(this.currentlyDragging&&-1!==this.activeDraggable){e.preventDefault();var newMouseX=e.clientX,newMouseY=e.clientY,newMouseX=(this.mouseX=newMouseX,this.mouseY=newMouseY,this.container.getBoundingClientRect());let row=e.clientY-newMouseX.top,col=e.clientX-newMouseX.left;(row=row<this.draggableRadius?this.draggableRadius:row)>this.containerHeight-this.draggableRadius&&(row=this.containerHeight-this.draggableRadius),(col=col<this.draggableRadius?this.draggableRadius:col)>this.containerWidth-this.draggableRadius&&(col=this.containerWidth-this.draggableRadius),this.draggables[this.activeDraggable].style.transform=`translate3d(${col-this.draggableRadius}px, ${row-this.draggableRadius}px, 0)`;newMouseY=(col-this.draggableRadius-this.restrictedWidth/2)/this.restrictedWidth*this.parent.worldWidth+this.parent.worldCenterX,newMouseX=-(row-this.draggableRadius-this.restrictedHeight/2)/this.restrictedHeight*this.parent.worldHeight+this.parent.worldCenterY;this.worldCoordinates[this.activeDraggable][0]=newMouseY,this.worldCoordinates[this.activeDraggable][1]=newMouseX;try{this.mousemoveCallback(this.activeDraggable,newMouseY,newMouseX,e)}catch(ex){}}},handleTouchstartEvent(e){this.activeDraggable=-1;for(let i=0;i<this.numDraggables;i++)if(e.target.classList.contains("wilson-draggable-"+i)&&e.target.parentNode===this.container){e.preventDefault(),this.activeDraggable=i,this.currentlyDragging=!0,this.mouseX=e.touches[0].clientX,this.mouseY=e.touches[0].clientY;try{this.touchstartCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],e)}catch(ex){}break}},handleTouchendEvent(e){if(-1!==this.activeDraggable){document.body.style.WebkitUserSelect="",this.lastActiveDraggable=this.activeDraggable;try{this.touchendCallback(this.activeDraggable,...this.worldCoordinates[this.activeDraggable],e)}catch(ex){}}this.activeDraggable=-1,this.currentlyDragging=!1},handleTouchmoveEvent(e){if(this.currentlyDragging&&-1!==this.activeDraggable){e.preventDefault(),this.mouseX=e.touches[0].clientX,this.mouseY=e.touches[0].clientY;var rect=this.container.getBoundingClientRect();let row=this.mouseY-rect.top,col=this.mouseX-rect.left;(row=row<this.draggableRadius?this.draggableRadius:row)>this.containerHeight-this.draggableRadius&&(row=this.containerHeight-this.draggableRadius),(col=col<this.draggableRadius?this.draggableRadius:col)>this.containerWidth-this.draggableRadius&&(col=this.containerWidth-this.draggableRadius),this.draggables[this.activeDraggable].style.transform=`translate3d(${col-this.draggableRadius}px, ${row-this.draggableRadius}px, 0)`;var rect=(col-this.draggableRadius-this.restrictedWidth/2)/this.restrictedWidth*this.parent.worldWidth+this.parent.worldCenterX,y=-(row-this.draggableRadius-this.restrictedHeight/2)/this.restrictedHeight*this.parent.worldHeight+this.parent.worldCenterY;this.worldCoordinates[this.activeDraggable][0]=rect,this.worldCoordinates[this.activeDraggable][1]=y;try{this.touchmoveCallback(this.activeDraggable,rect,y,e)}catch(ex){}}},recalculateLocations(){for(let i=0;i<this.numDraggables;i++){let row=Math.floor(this.restrictedHeight*(1-((this.worldCoordinates[i][1]-this.parent.worldCenterY)/this.parent.worldHeight+.5)))+this.draggableRadius,col=Math.floor(this.restrictedWidth*((this.worldCoordinates[i][0]-this.parent.worldCenterX)/this.parent.worldWidth+.5))+this.draggableRadius;(row=row<this.draggableRadius?this.draggableRadius:row)>this.containerHeight-this.draggableRadius&&(row=this.containerHeight-this.draggableRadius),(col=col<this.draggableRadius?this.draggableRadius:col)>this.containerWidth-this.draggableRadius&&(col=this.containerWidth-this.draggableRadius),this.draggables[i].style.transform=`translate3d(${col-this.draggableRadius}px, ${row-this.draggableRadius}px, 0)`}},onResize(){var computedStyle=window.getComputedStyle(this.parent.canvas),width=this.parent.canvas.clientWidth-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight),height=this.parent.canvas.clientHeight-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom);this.container.style.width=width+2*this.draggableRadius+"px",this.container.style.height=height+2*this.draggableRadius+"px",this.containerWidth=width+2*this.draggableRadius,this.containerHeight=height+2*this.draggableRadius,this.restrictedWidth=width,this.restrictedHeight=height,this.container.style.marginTop=parseFloat(computedStyle.borderTopWidth)+parseFloat(computedStyle.paddingTop)-this.draggableRadius+"px",this.recalculateLocations()}};fullscreen={currentlyFullscreen:!1,currentlyAnimating:!1,canvasesToResize:[],trueFullscreen:!1,switchFullscreenCallback:null,fullscreenOldScroll:0,oldFooterButtonOffset:0,enterFullscreenButton:null,exitFullscreenButton:null,useFullscreenButton:!1,enterFullscreenButtonIconPath:null,exitFullscreenButtonIconPath:null,fullscreenComponentsContainerLocation:null,fullscreenComponentsContainer:null,init(){if(this.useFullscreenButton&&0===document.querySelectorAll("#wilson-fullscreen-button-style").length&&((element=document.createElement("style")).textContent=`
						.wilson-enter-fullscreen-button, .wilson-exit-fullscreen-button
						{
							width: 15px;
							
							background-color: rgb(255, 255, 255);
							
							border: 2px solid rgb(127, 127, 127);
							border-radius: 25%;
							padding: 5px;
							
							cursor: pointer;
							outline: none;
						}

						.wilson-enter-fullscreen-button
						{
							position: absolute;
							
							right: 10px;
							top: 10px;
							
							z-index: 100;
						}

						.wilson-exit-fullscreen-button
						{
							position: fixed;
							
							right: 10px;
							top: 10px;
							
							z-index: 100;
						}
					`,element.id="wilson-fullscreen-button-style",document.head.appendChild(element)),0===document.querySelectorAll("#wilson-fullscreen-style").length){const element=document.createElement("style");element.textContent=`
					.wilson-fullscreen-components-container.wilson-fullscreen
					{
						position: fixed !important;
						top: 0 !important;
						left: 0 !important;
						
						z-index: 100 !important;
					}
					
					.wilson-fullscreen-components-container.wilson-fullscreen .wilson-applet-canvas-container
					{
						margin-top: 0 !important;
						margin-bottom: 0 !important;
					}
					
					.wilson-fullscreen-components-container.wilson-fullscreen:not(.wilson-true-fullscreen-canvas) .wilson-output-canvas-container
					{
						margin-left: calc(50vw - 50vmin) !important;
					}
					
					.wilson-true-fullscreen-canvas
					{
						width: 100vw !important;
						height: calc(100% + 4px) !important;
						
						border: none !important;
						border-radius: 0 !important;
						padding: 0 !important;
					}

					.wilson-letterboxed-fullscreen-canvas
					{
						width: 100vmin !important;
						height: calc(100vmin + 4px) !important;
						
						border: none !important;
						border-radius: 0 !important;
						padding: 0 !important;
					}

					.wilson-letterboxed-canvas-background
					{
						width: 100vw;
						height: calc((100vh - 100vmin) / 2 + 4px);
						
						background-color: rgb(0, 0, 0);
					}

					.wilson-black-background
					{
						width: 100vw !important;
						height: calc(100% + 4px) !important;
						
						background-color: rgb(0, 0, 0) !important;
					}
					
					.wilson-center-content
					{
						display: flex;
						justify-content: center;
						margin: 0 auto;
					}
				`,element.id="wilson-fullscreen-style",document.head.appendChild(element)}this.useFullscreenButton&&(this.enterFullscreenButton=document.createElement("input"),this.enterFullscreenButton.type="image",this.enterFullscreenButton.classList.add("wilson-enter-fullscreen-button"),this.enterFullscreenButton.src=this.enterFullscreenButtonIconPath,this.enterFullscreenButton.alt="Enter Fullscreen",this.enterFullscreenButton.setAttribute("tabindex","-1"),this.parent.canvas.parentNode.appendChild(this.enterFullscreenButton),addHoverEventWithScale(this.enterFullscreenButton,1.1),this.enterFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()}));var element=this.onResize.bind(this),element=(addTemporaryListener({object:window,event:"resize",callback:element}),this.onScroll.bind(this)),element=(addTemporaryListener({object:window,event:"scroll",callback:element}),this.onKeypress.bind(this));addTemporaryListener({object:document.documentElement,event:"keydown",callback:element})},switchFullscreen(){this.currentlyFullscreen?this.currentlyAnimating||(this.currentlyFullscreen=!1,this.currentlyAnimating=!0,anime({targets:metaThemeColorElement,content:this.oldMetaThemeColor,duration:opacityAnimationTime,easing:"cubicBezier(.42, 0, .58, 1)"}),changeOpacity(document.body,0),setTimeout(()=>{this.fullscreenComponentsContainerLocation.appendChild(this.fullscreenComponentsContainer);var header=document.body.querySelector("#header"),headerContainer=document.body.querySelector("#header-container");header&&headerContainer&&(header.style.zIndex=110,headerContainer.style.zIndex=105),this.parent.canvas.classList.remove("wilson-fullscreen"),this.parent.canvas.parentNode.classList.remove("wilson-fullscreen"),this.fullscreenComponentsContainer.classList.remove("wilson-fullscreen"),document.documentElement.style.overflowY="visible",document.body.style.overflowY="visible",document.body.style.width="",document.body.style.height="",document.documentElement.style.userSelect="auto",document.documentElement.style.WebkitUserSelect="auto",document.removeEventListener("gesturestart",this.preventGestures),document.removeEventListener("gesturechange",this.preventGestures),document.removeEventListener("gestureend",this.preventGestures),this.exitFullscreenButton&&this.exitFullscreenButton.remove(),this.useFullscreenButton&&(this.enterFullscreenButton=document.createElement("input"),this.enterFullscreenButton.type="image",this.enterFullscreenButton.classList.add("wilson-enter-fullscreen-button"),this.enterFullscreenButton.src=this.enterFullscreenButtonIconPath,this.enterFullscreenButton.alt="Enter Fullscreen",this.enterFullscreenButton.setAttribute("tabindex","-1"),this.parent.canvas.parentNode.appendChild(this.enterFullscreenButton),addHoverEventWithScale(this.enterFullscreenButton,1.1),this.enterFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()})),this.fullscreenComponentsContainer.classList.remove("wilson-true-fullscreen-canvas");for(let i=0;i<this.canvasesToResize.length;i++){this.canvasesToResize[i].classList.remove("wilson-true-fullscreen-canvas"),this.canvasesToResize[i].classList.remove("wilson-letterboxed-fullscreen-canvas"),this.parent.canvas.parentNode.parentNode.classList.remove("wilson-black-background");var elements=document.querySelectorAll(".wilson-letterboxed-canvas-background");for(let i=0;i<elements.length;i++)elements[i]&&elements[i].remove();try{this.switchFullscreenCallback()}catch(ex){}this.parent.draggables.onResize()}this.parent.useDraggables&&this.parent.draggables.onResize(),setTimeout(()=>{window.scroll(0,this.fullscreenOldScroll),changeOpacity(document.body,1),setTimeout(()=>{this.currentlyAnimating=!1},opacityAnimationTime)},10)},opacityAnimationTime)):this.currentlyAnimating||(this.currentlyFullscreen=!0,this.currentlyAnimating=!0,this.fullscreenOldScroll=window.scrollY,changeOpacity(document.body,0),setTimeout(()=>{document.body.appendChild(this.fullscreenComponentsContainer);var header=document.body.querySelector("#header"),headerContainer=document.body.querySelector("#header-container");if(header&&headerContainer&&(header.style.zIndex=90,headerContainer.style.zIndex=90),this.parent.canvas.classList.add("wilson-fullscreen"),this.parent.canvas.parentNode.classList.add("wilson-fullscreen"),this.fullscreenComponentsContainer.classList.add("wilson-fullscreen"),this.enterFullscreenButton&&this.enterFullscreenButton.remove(),this.useFullscreenButton&&(this.exitFullscreenButton=document.createElement("input"),this.exitFullscreenButton.type="image",this.exitFullscreenButton.classList.add("wilson-exit-fullscreen-button"),this.exitFullscreenButton.src=this.exitFullscreenButtonIconPath,this.exitFullscreenButton.alt="Exit Fullscreen",this.exitFullscreenButton.setAttribute("tabindex","-1"),document.body.appendChild(this.exitFullscreenButton),addHoverEventWithScale(this.exitFullscreenButton,1.1),this.exitFullscreenButton.addEventListener("click",()=>{this.switchFullscreen()})),this.oldMetaThemeColor=metaThemeColorElement.getAttribute("content"),document.documentElement.style.overflowY="hidden",document.body.style.overflowY="hidden",document.body.style.width="100vw",document.body.style.height="100%",document.documentElement.style.userSelect="none",document.documentElement.style.WebkitUserSelect="none",document.addEventListener("gesturestart",this.preventGestures),document.addEventListener("gesturechange",this.preventGestures),document.addEventListener("gestureend",this.preventGestures),anime({targets:metaThemeColorElement,content:"#000000",duration:opacityAnimationTime,easing:"cubicBezier(.42, 0, .58, 1)"}),this.trueFullscreen){this.fullscreenComponentsContainer.classList.add("wilson-true-fullscreen-canvas");for(let i=0;i<this.canvasesToResize.length;i++){this.canvasesToResize[i].classList.add("wilson-true-fullscreen-canvas"),this.parent.canvas.parentNode.parentNode.classList.add("wilson-black-background");try{this.switchFullscreenCallback()}catch(ex){}this.parent.draggables.onResize()}window.scroll(0,0)}else{for(let i=0;i<this.canvasesToResize.length;i++){this.canvasesToResize[i].classList.add("wilson-letterboxed-fullscreen-canvas");try{this.switchFullscreenCallback()}catch(ex){}this.parent.draggables.onResize()}this.parent.canvas.parentNode.parentNode.insertAdjacentHTML("beforebegin","<div class='wilson-letterboxed-canvas-background'></div>"),this.parent.canvas.parentNode.parentNode.insertAdjacentHTML("afterend","<div class='wilson-letterboxed-canvas-background'></div>"),this.parent.canvas.parentNode.parentNode.classList.add("wilson-black-background"),this.onResize()}this.parent.useDraggables&&this.parent.draggables.onResize(),changeOpacity(document.body,1),setTimeout(()=>{this.currentlyAnimating=!1,this.onResize()},opacityAnimationTime)},opacityAnimationTime))},onResize(){this.currentlyFullscreen&&(window.scroll(0,0),setTimeout(()=>{window.scroll(0,0)},500))},onScroll(){this.currentlyFullscreen&&window.scroll(0,this.fullscreenLockedScroll)},onKeypress(e){"Escape"===e.key&&this.currentlyFullscreen&&this.switchFullscreen()},preventGestures(e){e.preventDefault()}};input={mouseX:null,mouseY:null,lastRow1:-1,lastCol1:-1,lastRow2:-1,lastCol2:-1,currentlyDragging:!1,wasPinching:!1,mousedownCallback:null,mouseupCallback:null,mousemoveCallback:null,mousedragCallback:null,touchstartCallback:null,touchupCallback:null,touchmoveCallback:null,pinchCallback:null,wheelCallback:null,onMousedownBound:null,onMouseupBound:null,onMousemoveBound:null,onTouchstartBound:null,onTouchupBound:null,onTouchmoveBound:null,onWheelBound:null,init(){for(let i=0;i<this.parent.fullscreen.canvasesToResize.length;i++)this.onMousedownBound=this.onMousedown.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("mousedown",this.onMousedownBound),this.onMouseupBound=this.onMouseup.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("mouseup",this.onMouseupBound),this.onMousemoveBound=this.onMousemove.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("mousemove",this.onMousemoveBound),this.onTouchstartBound=this.onTouchstart.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("touchstart",this.onTouchstartBound),this.onTouchendBound=this.onTouchend.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("touchend",this.onTouchendBound),this.onTouchmoveBound=this.onTouchmove.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("touchmove",this.onTouchmoveBound),this.onWheelBound=this.onWheel.bind(this),this.parent.fullscreen.canvasesToResize[i].addEventListener("wheel",this.onWheelBound),this.parent.fullscreen.canvasesToResize[i].addEventListener("mouseleave",e=>{var lastWorldCoordinates=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);if(this.currentlyDragging){this.currentlyDragging=!1;try{this.mouseupCallback(...lastWorldCoordinates,e)}catch(ex){}}})},onMousedown(e){var row,rect,worldCoordinates;e.target.classList.contains("wilson-draggable")||(this.mouseX=e.clientX,this.mouseY=e.clientY,this.currentlyDragging=!0,rect=this.parent.canvas.getBoundingClientRect(),row=(this.mouseY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,rect=(this.mouseX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,worldCoordinates=this.parent.utils.interpolate.canvasToWorld(row,rect),this.lastRow1=row,this.lastCol1=rect,null!==this.mousedownCallback&&(e.preventDefault(),this.mousedownCallback(...worldCoordinates,e)))},onMouseup(e){var row,rect,worldCoordinates;e.target.classList.contains("wilson-draggable")||(e.preventDefault(),this.mouseX=e.clientX,this.mouseY=e.clientY,this.currentlyDragging=!1,null!==this.mouseupCallback&&(rect=this.parent.canvas.getBoundingClientRect(),row=(this.mouseY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,rect=(this.mouseX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,worldCoordinates=this.parent.utils.interpolate.canvasToWorld(row,rect),this.mouseupCallback(...worldCoordinates,e),this.lastRow1=row,this.lastCol1=rect))},onMousemove(e){var row,rect,worldCoordinates,lastWorldCoordinates;e.target.classList.contains("wilson-draggable")||(e.preventDefault(),this.mouseX=e.clientX,this.mouseY=e.clientY,rect=this.parent.canvas.getBoundingClientRect(),row=(this.mouseY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,rect=(this.mouseX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,worldCoordinates=this.parent.utils.interpolate.canvasToWorld(row,rect),lastWorldCoordinates=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1),null!==this.mousedragCallback&&this.currentlyDragging?this.mousedragCallback(...worldCoordinates,worldCoordinates[0]-lastWorldCoordinates[0],worldCoordinates[1]-lastWorldCoordinates[1],e):null===this.mousemoveCallback||this.currentlyDragging||this.mousemoveCallback(...worldCoordinates,worldCoordinates[0]-lastWorldCoordinates[0],worldCoordinates[1]-lastWorldCoordinates[1],e),this.lastRow1=row,this.lastCol1=rect)},onTouchstart(e){var row,rect,worldCoordinates;e.target.classList.contains("wilson-draggable")||(this.mouseX=e.touches[0].clientX,this.mouseY=e.touches[0].clientY,rect=this.parent.canvas.getBoundingClientRect(),row=(this.mouseY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,rect=(this.mouseX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,worldCoordinates=this.parent.utils.interpolate.canvasToWorld(row,rect),this.lastRow1=row,this.lastCol1=rect,null!==this.touchstartCallback&&(e.preventDefault(),this.touchstartCallback(...worldCoordinates,e)))},onTouchend(e){var lastWorldCoordinates;e.target.classList.contains("wilson-draggable")||(e.preventDefault(),this.touchDistance=-1,this.lastRow2=-1,this.lastCol2=-1,0===e.touches.length&&(this.wasPinching=!1),null!==this.touchendCallback&&-1!==this.lastRow1&&(lastWorldCoordinates=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1),this.touchendCallback(...lastWorldCoordinates,e)))},onTouchmove(e){if(!e.target.classList.contains("wilson-draggable")){e.preventDefault();var rect=this.parent.canvas.getBoundingClientRect();if(2<=e.touches.length&&null!==this.pinchCallback){this.wasPinching=!0;var row1=(e.touches[0].clientY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,col1=(e.touches[0].clientX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,row2=(e.touches[1].clientY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,col2=(e.touches[1].clientX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,row1=this.parent.utils.interpolate.canvasToWorld(row1,col1),col1=this.parent.utils.interpolate.canvasToWorld(row2,col2),row2=row1[0]-col1[0],col2=row1[1]-col1[1],row2=Math.sqrt(row2*row2+col2*col2),col2=(row1[0]+col1[0])/2,row1=(row1[1]+col1[1])/2,col1=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1),lastWorldCoordinates2=this.parent.utils.interpolate.canvasToWorld(this.lastRow2,this.lastCol2),lastXDistance=col1[0]-lastWorldCoordinates2[0],col1=col1[1]-lastWorldCoordinates2[1],lastWorldCoordinates2=Math.sqrt(lastXDistance*lastXDistance+col1*col1);-1!==this.lastRow2&&this.pinchCallback(col2,row1,row2-lastWorldCoordinates2,e)}else if(this.wasPinching)return;if(this.mouseX=e.touches[0].clientX,this.mouseY=e.touches[0].clientY,null!==this.touchmoveCallback){var lastXDistance=(this.mouseY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,col1=(this.mouseX-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,row1=this.parent.utils.interpolate.canvasToWorld(lastXDistance,col1),lastWorldCoordinates=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1);if(1===e.touches.length)this.touchmoveCallback(...row1,row1[0]-lastWorldCoordinates[0],row1[1]-lastWorldCoordinates[1],e);else{var xDelta1=row1[0]-lastWorldCoordinates[0],lastWorldCoordinates=row1[1]-lastWorldCoordinates[1],mouseX2=e.touches[1].clientX;const row2=(e.touches[1].clientY-rect.top-this.parent.topBorder-this.parent.topPadding)*this.parent.canvasHeight/this.parent.draggables.restrictedHeight,col2=(mouseX2-rect.left-this.parent.leftBorder-this.parent.leftPadding)*this.parent.canvasWidth/this.parent.draggables.restrictedWidth,worldCoordinates2=this.parent.utils.interpolate.canvasToWorld(row2,col2),lastWorldCoordinates2=this.parent.utils.interpolate.canvasToWorld(this.lastRow2,this.lastCol2);mouseX2=worldCoordinates2[0]-lastWorldCoordinates2[0],rect=worldCoordinates2[1]-lastWorldCoordinates2[1];Math.abs(xDelta1-mouseX2)/this.parent.worldWidth<.005&&Math.abs(lastWorldCoordinates-rect)/this.parent.worldHeight<.005&&this.touchmoveCallback((row1[0]+worldCoordinates2[0])/2,(row1[1]+worldCoordinates2[1])/2,(xDelta1+mouseX2)/2,(lastWorldCoordinates+rect)/2,e),this.lastRow2=row2,this.lastCol2=col2}this.lastRow1=lastXDistance,this.lastCol1=col1}}},onWheel(e){var lastWorldCoordinates;null!==this.wheelCallback&&(e.preventDefault(),-1!==this.lastRow1)&&(lastWorldCoordinates=this.parent.utils.interpolate.canvasToWorld(this.lastRow1,this.lastCol1),this.wheelCallback(...lastWorldCoordinates,e.deltaY,e))},getZoomedWorldCenter(fixedPointX,fixedPointY,newWorldWidth,newWorldHeight){return[fixedPointX-(fixedPointX-this.parent.worldCenterX)/this.parent.worldWidth*newWorldWidth,fixedPointY-(fixedPointY-this.parent.worldCenterY)/this.parent.worldHeight*newWorldHeight]}};changeCanvasSize(width,height){this.canvasWidth=width,this.canvasHeight=height,this.canvas.setAttribute("width",width),this.canvas.setAttribute("height",height),0!==this.render.renderType&&this.gl.viewport(0,0,width,height);width=window.getComputedStyle(this.canvas);this.topPadding=parseFloat(width.paddingTop),this.leftPadding=parseFloat(width.paddingLeft),this.topBorder=parseFloat(width.borderTopWidth),this.leftBorder=parseFloat(width.borderLeftWidth)}downloadFrame(filename){1===this.render.renderType?this.render.drawFrame(this.render.lastImage):2===this.render.renderType&&this.render.drawFrame(),this.canvas.toBlob(blob=>{var link=document.createElement("a");link.download=filename,link.href=window.URL.createObjectURL(blob),link.click(),link.remove()})}}export{Wilson};