import{addHoverEventWithScale}from"./hoverEvents.min.js";import{InputElement}from"./inputElement.min.js";import{currentlyTouchDevice}from"./interaction.min.js";import{addTemporaryListener,addTemporaryParam,pageUrl}from"./main.min.js";class Slider extends InputElement{trackElement;subtextElement;valueElement;value;displayValue;min;max;logMin;logMax;snapPoints;snapThreshhold;precision;logarithmic;integer;persistState;thumbSize;currentlyDragging=!1;dragOffset;onInput;constructor({element,name,value,min,max,snapThreshhold=1/75,snapPoints=[],logarithmic=!1,integer=!1,persistState=!0,onInput=()=>{}}){super({element:element,name:name}),this.subtextElement=this.element.nextElementSibling,this.trackElement=this.element.previousElementSibling,this.logarithmic=logarithmic,this.integer=integer,this.value=parseFloat(value),this.min=parseFloat(min),this.max=parseFloat(max),this.logMin=Math.log(this.min),this.logMax=Math.log(this.max),this.snapPoints=snapPoints,this.snapThreshhold=snapThreshhold,this.persistState=persistState,this.onInput=onInput,this.precision=Math.max(0,3-Math.floor(Math.log10(this.max-this.min))),this.value=this.integer?Math.round(this.value):this.value,this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.subtextElement.textContent=name+": ",this.valueElement=document.createElement("span"),this.valueElement.textContent=this.displayValue,this.subtextElement.appendChild(this.valueElement),this.value=parseFloat(this.value),this.thumbSize=currentlyTouchDevice?26:18,this.element.style.width=this.thumbSize+"px",this.element.style.height=this.thumbSize+"px",this.element.style.top=`-${this.thumbSize/2+1.25}px`,this.subtextElement.style.marginTop=currentlyTouchDevice?"16px":"12px",addHoverEventWithScale({element:this.element,scale:1.1}),this.element.addEventListener("pointerdown",e=>{this.currentlyDragging=!0,this.dragOffset=e.clientX-this.element.getBoundingClientRect().left-1.25}),addTemporaryListener({object:document.documentElement,event:"touchend",callback:this.onEndDrag.bind(this)}),addTemporaryListener({object:document.documentElement,event:"mouseup",callback:this.onEndDrag.bind(this)}),addTemporaryListener({object:document.documentElement,event:"mousemove",callback:e=>{var t,i;this.currentlyDragging&&(e.preventDefault(),t=this.trackElement.getBoundingClientRect(),i=e.clientX-t.left-this.dragOffset,t=t.width-this.thumbSize-5,i=Math.min(Math.max(i,0),t),this.element.style.left=i+"px",this.setRawValue(i/t))}}),addTemporaryListener({object:document.documentElement,event:"touchmove",callback:e=>{var t,i;this.currentlyDragging&&(e.preventDefault(),t=this.trackElement.getBoundingClientRect(),i=e.touches[0].clientX-t.left-this.dragOffset,t=t.width-this.thumbSize-5,i=Math.min(Math.max(i,0),t),this.element.style.left=i+"px",this.setRawValue(i/t))}}),setTimeout(()=>{var t;this.persistState?((t=new URLSearchParams(window.location.search).get(this.element.id))?this.setValue(parseFloat(decodeURIComponent(t)),!0):this.setValue(this.value),addTemporaryParam(this.element.id)):this.setValue(this.value),this.loadResolve()},10)}onEndDrag(){var t;this.currentlyDragging&&(this.currentlyDragging=!1,this.persistState)&&(t=new URLSearchParams(window.location.search),void 0!==this.value&&t.set(this.element.id,encodeURIComponent(this.value)),t=t.toString(),window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(t?"?"+t:"")))}setRawValue(newValue){var t=this.value;this.value=this.logarithmic?Math.exp(parseFloat(this.logMin+newValue*(this.logMax-this.logMin))):parseFloat(this.min+newValue*(this.max-this.min));for(let i=0;i<this.snapPoints.length;i++){var e=this.logarithmic?(Math.log(this.snapPoints[i])-this.logMin)/(this.logMax-this.logMin):(this.snapPoints[i]-this.min)/(this.max-this.min);if(Math.abs(e-newValue)<this.snapThreshhold){this.value=this.snapPoints[i];break}}this.value=this.integer?Math.round(this.value):this.value,this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.valueElement.textContent=this.displayValue,this.value=parseFloat(this.value),this.setValue(this.value,t!==this.value)}setValue(newValue,callOnInput=!1){this.value=newValue;var t=this.logarithmic?(Math.log(this.value)-this.logMin)/(this.logMax-this.logMin):(this.value-this.min)/(this.max-this.min),t=Math.min(Math.max(t,0),1),e=this.trackElement.getBoundingClientRect().width-this.thumbSize-5;this.element.style.left=t*e+"px",this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.valueElement.textContent=this.displayValue,callOnInput&&this.onInput()}setBounds({min=this.min,max=this.max,callOnInput=!1}){if(max<min)throw new Error(`Minimum slider value of ${min} is larger than maximum of ${max}!`);this.min=min,this.max=max,this.logMin=Math.log(this.min),this.logMax=Math.log(this.max),this.precision=Math.max(0,3-Math.floor(Math.log10(this.max-this.min))),this.value>this.max?this.setValue(this.max,callOnInput):this.value<this.min&&this.setValue(this.min,callOnInput)}}export{Slider};