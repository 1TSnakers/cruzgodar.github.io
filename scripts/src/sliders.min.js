import{addHoverEventWithScale}from"./hoverEvents.min.js";import{InputElement}from"./inputElement.min.js";import{currentlyTouchDevice}from"./interaction.min.js";import{addTemporaryListener,addTemporaryParam,pageUrl}from"./main.min.js";class Slider extends InputElement{trackElement;subtextElement;valueElement;value;displayValue;min;max;snapPoints;snapThreshhold;precision;logarithmic;integer;persistState;setSearchParamsTimeoutId;thumbSize;currentlyDragging=!1;dragOffset;onInput;constructor({element,name,value,min,max,snapThreshhold=(max-min)/80,snapPoints=[],logarithmic=!1,integer=!1,persistState=!0,onInput=()=>{}}){if(super({element:element,name:name}),this.subtextElement=this.element.nextElementSibling.firstElementChild,this.trackElement=this.element.previousElementSibling,this.logarithmic=logarithmic,this.integer=integer,this.value=parseFloat(value),this.min=parseFloat(min),this.max=parseFloat(max),this.snapPoints=snapPoints,this.snapThreshhold=snapThreshhold,this.logarithmic&&(this.value=Math.log10(this.value),this.min=Math.log10(this.min),this.max=Math.log10(this.max),this.snapThreshhold=(this.max-this.min)/80),this.persistState=persistState,this.onInput=onInput,this.precision=Math.max(0,3-Math.floor(Math.log10((this.logarithmic?10**this.max:this.max)-(this.logarithmic?10**this.min:this.min)))),this.value=this.logarithmic?10**this.value:this.value,this.value=this.integer?Math.round(this.value):this.value,this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.subtextElement.textContent=name+": ",this.valueElement=document.createElement("span"),this.valueElement.textContent=this.displayValue,this.subtextElement.appendChild(this.valueElement),this.value=parseFloat(this.value),this.thumbSize=currentlyTouchDevice?28:18,this.element.style.width=this.thumbSize+"px",this.element.style.height=this.thumbSize+"px",this.element.style.top=`-${this.thumbSize/2+1.25}px`,addHoverEventWithScale({element:this.element,scale:1.1}),this.element.addEventListener("pointerdown",e=>{this.currentlyDragging=!0,this.dragOffset=e.clientX-this.element.getBoundingClientRect().left-1.25}),addTemporaryListener({object:document.documentElement,event:"pointerup",callback:()=>this.currentlyDragging=!1}),addTemporaryListener({object:document.documentElement,event:"pointermove",callback:e=>{var t,i;this.currentlyDragging&&(t=this.trackElement.getBoundingClientRect(),i=e.clientX-t.left-this.dragOffset,t=t.width-this.thumbSize-5,i=Math.min(Math.max(i,0),t),this.element.style.left=i+"px",this.setRawValue(i/t))}}),this.persistState){const value=new URLSearchParams(window.location.search).get(this.element.id);value?setTimeout(()=>{this.setValue(parseFloat(decodeURIComponent(value)),!0),this.loadResolve()},10):this.loadResolve(),addTemporaryParam(this.element.id)}else this.loadResolve()}setRawValue(newValue){var t=this.value,e=this.min+newValue*(this.max-this.min);this.value=this.logarithmic?10**parseFloat(e):parseFloat(e);for(let i=0;i<this.snapPoints.length;i++)(this.logarithmic?Math.abs(Math.log10(this.value)-Math.log10(this.snapPoints[i])):Math.abs(this.value-this.snapPoints[i]))<this.snapThreshhold&&(this.value=this.snapPoints[i]);this.value=this.integer?Math.round(this.value):this.value,this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.valueElement.textContent=this.displayValue,this.value=parseFloat(this.value),this.setValue(this.value,t!==this.value)}setValue(newValue,callOnInput=!1){this.value=newValue;var t=((this.logarithmic?Math.log10(this.value):this.value)-this.min)/(this.max-this.min),e=this.trackElement.getBoundingClientRect().width-this.thumbSize-5;if(this.element.style.left=t*e+"px",this.displayValue=this.integer?this.value:this.value.toFixed(this.precision),this.valueElement.textContent=this.displayValue,this.persistState){t=new URLSearchParams(window.location.search);void 0!==this.element.value&&t.set(this.element.id,encodeURIComponent(this.value));const i=t.toString();void 0!==this.setSearchParamsTimeoutId&&clearTimeout(this.setSearchParamsTimeoutId),this.setSearchParamsTimeoutId=setTimeout(()=>{window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(i?"?"+i:""))},100)}callOnInput&&this.onInput()}setBounds({min=this.min,max=this.max,callOnInput=!1}){if(max<min)throw new Error(`Minimum slider value of ${min} is larger than maximum of ${max}!`);this.min=min,this.max=max,this.precision=Math.max(0,3-Math.floor(Math.log10((this.logarithmic?10**this.max:this.max)-(this.logarithmic?10**this.min:this.min)))),this.element.setAttribute("min",this.min),this.element.setAttribute("max",this.max),this.value>this.max?this.setValue(this.max,callOnInput):this.value<this.min&&this.setValue(this.min,callOnInput)}}export{Slider};