import{fadeDownOut,fadeLeftOut,fadeOut,fadeRightOut,fadeUpOut}from"./animation.min.mjs";import{Applet}from"./applets.min.mjs";import{bannerElement,bannerOnScroll,loadBanner}from"./banners.min.mjs";import{cardIsOpen,hideCard}from"./cards.min.mjs";import{clearDesmosGraphs,desmosGraphs}from"./desmos.min.mjs";import{loadPage}from"./load-page.min.mjs";import{clearTemporaryIntervals,clearTemporaryListeners,clearTemporaryWorkers,pageElement,pageUrl,setPageScroll,setPageUrl,temporaryIntervals,temporaryListeners,temporaryWorkers}from"./main.min.mjs";import{forceThemePages,preventThemeChangePages,setForcedTheme,setRevertThemeTo,siteSettings,toggleDarkTheme}from"./settings.min.mjs";import{sitemap}from"./sitemap.min.mjs";let currentlyRedirecting=!1,lastPageScroll=0,navigationTransitionType=0;async function redirect({url:r,inNewTab:e=!1,noStatePush:a=!1,restoreScroll:n=!1,noFadeOut:t=!1}){if(!currentlyRedirecting)if(e||-1!==r.indexOf("."))window.open(r,"_blank");else{cardIsOpen&&await hideCard(),currentlyRedirecting=!0;const o=window.scrollY;navigationTransitionType=getTransitionType(r);document.documentElement.style.backgroundColor;await fadeOutPage({url:r,noFadeOut:t}),Promise.all([fetch(r+"index.html"),loadBanner()]).then(e=>{if(e[0].ok)return e[0].text();window.location.replace("/404.html")}).then(e=>{unloadPage();var t=e.indexOf("</head>"),t=(e=(e=-1!==t?e.slice(t+7):e).slice(e.indexOf("<body>")+6,e.indexOf("</body>")),document.body.firstElementChild.insertAdjacentHTML("beforebegin",`<div class="page" style="opacity: 0">${e}</div>`),currentlyRedirecting=!1,setPageUrl(r),loadPage(),r.replace(/\/home\//,"/"));a?history.replaceState({url:r},document.title,t):history.pushState({url:r},document.title,t),document.documentElement.style.overflowY="visible",document.body.style.overflowY="visible",document.body.style.userSelect="auto",document.body.style.WebkitUserSelect="auto",n?(window.scrollTo(0,lastPageScroll),bannerOnScroll(lastPageScroll)):(window.scrollTo(0,0),setPageScroll(0)),lastPageScroll=o})}}function getTransitionType(e){if(!(e in sitemap)||e===pageUrl)return 0;let t=pageUrl;for(;""!==t;)if(e===(t=sitemap[t].parent))return-1;for(t=e;""!==t;)if(t=sitemap[t].parent,pageUrl===t)return 1;if(sitemap[e].parent!==sitemap[pageUrl].parent)return 0;{const t=sitemap[e].parent;return sitemap[t].children.indexOf(e)>sitemap[t].children.indexOf(pageUrl)?2:-2}}async function fadeOutPage({url:e,noFadeOut:t}){void 0===forceThemePages[e]||siteSettings.darkTheme===forceThemePages[e]||preventThemeChangePages.includes(pageUrl)||(setRevertThemeTo(siteSettings.darkTheme),setForcedTheme(!0),toggleDarkTheme({force:!0})),t?pageElement.style.opacity=0:await(1===navigationTransitionType?bannerElement?Promise.all([fadeUpOut(pageElement),fadeUpOut(bannerElement)]):fadeUpOut(pageElement):-1===navigationTransitionType?bannerElement?Promise.all([fadeDownOut(bannerElement),fadeDownOut(pageElement)]):fadeDownOut(pageElement):2===navigationTransitionType?bannerElement?Promise.all([fadeLeftOut(bannerElement),fadeLeftOut(pageElement)]):fadeLeftOut(pageElement):-2===navigationTransitionType?bannerElement?Promise.all([fadeRightOut(bannerElement),fadeRightOut(pageElement)]):fadeRightOut(pageElement):bannerElement?Promise.all([fadeOut(bannerElement),fadeOut(pageElement)]):fadeOut(pageElement))}function unloadPage(){for(var e in document.querySelectorAll("script, .temporary-style").forEach(e=>e.remove()),temporaryListeners.forEach(e=>{e[0].removeEventListener(e[1],e[2])}),clearTemporaryListeners(),temporaryIntervals.forEach(e=>clearInterval(e)),clearTemporaryIntervals(),temporaryWorkers)try{temporaryWorkers[e].terminate()}catch(e){}for(var t in clearTemporaryWorkers(),desmosGraphs)desmosGraphs[t].destroy();clearDesmosGraphs();try{Applet.current.forEach(e=>e.destroy()),Applet.current=[]}catch(e){}pageElement.remove()}export{navigationTransitionType,redirect};