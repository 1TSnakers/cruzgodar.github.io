import{fadeUpOut,fadeDownOut,fadeLeftOut,fadeRightOut,fadeOut}from"./animation.min.mjs";import{loadBanner,bannerOnScroll,bannerElement}from"./banners.min.mjs";import{cardIsOpen,hideCard}from"./cards.min.mjs";import{loadPage}from"./load-page.min.mjs";let currentlyRedirecting=!1,lastPageScroll=0,navigationTransitionType=0;async function redirect({url:n,inNewTab:e=!1,noStatePush:a=!1,restoreScroll:i=!1,noFadeOut:t=!1}){if(!currentlyRedirecting)if(e||-1!==n.indexOf("."))window.open(n,"_blank");else{cardIsOpen&&await hideCard(),currentlyRedirecting=!0;const r=window.scrollY;navigationTransitionType=getTransitionType(n),Page.url=n,Page.parentFolder=n.slice(0,n.length);document.documentElement.style.backgroundColor;await fadeOutPage({url:n,noFadeOut:t}),Promise.all([fetch(n+"index.html"),loadBanner()]).then(e=>{if(e[0].ok)return e[0].text();window.location.replace("/404.html")}).then(e=>{unloadPage();var t=e.indexOf("</head>"),t=(e=(e=-1!==t?e.slice(t+7):e).slice(e.indexOf("<body>")+6,e.indexOf("</body>")),document.body.firstElementChild.insertAdjacentHTML("beforebegin",`<div class="page" style="${Site.showingPresentation?"display: none; ":""}opacity: 0">${e}</div>`),currentlyRedirecting=!1,loadPage(),n.replace(/\/home\//,"/"));a?history.replaceState({url:n},document.title,t):history.pushState({url:n},document.title,t),document.documentElement.style.overflowY="visible",document.body.style.overflowY="visible",document.body.style.userSelect="auto",document.body.style.WebkitUserSelect="auto",i?(window.scrollTo(0,lastPageScroll),bannerOnScroll(lastPageScroll)):(window.scrollTo(0,0),Page.scroll=0),lastPageScroll=r}).catch(e=>{console.error(e.message),console.error("Failed to load new page :(")})}}function getTransitionType(e){if(!(e in Site.sitemap)||e===Page.url)return 0;let t=Page.url;for(;""!==t;)if(e===(t=Site.sitemap[t].parent))return-1;for(t=e;""!==t;)if(t=Site.sitemap[t].parent,Page.url===t)return 1;if(Site.sitemap[e].parent!==Site.sitemap[Page.url].parent)return 0;{const t=Site.sitemap[e].parent;return Site.sitemap[t].children.indexOf(e)>Site.sitemap[t].children.indexOf(Page.url)?2:-2}}async function fadeOutPage({url:e,noFadeOut:t}){Site.forceDarkThemePages.includes(e)&&1!==Site.Settings.urlVars.theme&&(Site.Settings.revertTheme=0,Site.Settings.forcedTheme=!0,Site.Settings.toggleTheme(!1,!0)),t?Page.element.style.opacity=0:(await(1===navigationTransitionType?bannerElement?Promise.all([fadeUpOut(Page.element,Site.pageAnimationTime),fadeUpOut(bannerElement,2*Site.pageAnimationTime)]):fadeUpOut(Page.element,Site.pageAnimationTime):-1===navigationTransitionType?bannerElement?Promise.all([fadeDownOut(bannerElement,2*Site.pageAnimationTime),fadeDownOut(Page.element,Site.pageAnimationTime)]):fadeDownOut(Page.element,Site.pageAnimationTime):2===navigationTransitionType?bannerElement?Promise.all([fadeLeftOut(bannerElement,2*Site.pageAnimationTime),fadeLeftOut(Page.element,Site.pageAnimationTime)]):fadeLeftOut(Page.element,Site.pageAnimationTime):-2===navigationTransitionType?bannerElement?Promise.all([fadeRightOut(bannerElement,2*Site.pageAnimationTime),fadeRightOut(Page.element,Site.pageAnimationTime)]):fadeRightOut(Page.element,Site.pageAnimationTime):bannerElement?Promise.all([fadeOut(bannerElement,2*Site.pageAnimationTime),fadeOut(Page.element,Site.pageAnimationTime)]):fadeOut(Page.element,Site.pageAnimationTime)),Page.backgroundColorChanged&&(document.documentElement.classList.add("background-transition"),document.body.classList.add("background-transition"),e=1===Site.Settings.urlVars.theme?"rgb(24, 24, 24)":"rgb(255, 255, 255)",document.documentElement.style.backgroundColor=e,document.body.style.backgroundColor=e,anime({targets:Site.Settings.metaThemeColorElement,content:1===Site.Settings.urlVars.theme?"#181818":"#ffffff",duration:Site.backgroundColorAnimationTime,easing:"cubicBezier(.42, 0, .58, 1)",complete:()=>{document.body.style.backgroundColor="",document.documentElement.classList.remove("background-transition"),document.body.classList.remove("background-transition")}})))}function unloadPage(){for(var t in document.querySelectorAll("script, style.temporary-style, link.temporary-style").forEach(e=>e.remove()),Page.temporaryHandlers)for(let e=0;e<Page.temporaryHandlers[t].length;e++)window.removeEventListener(t,Page.temporaryHandlers[t][e]),document.documentElement.removeEventListener(t,Page.temporaryHandlers[t][e]);for(var e in Page.temporaryIntervals.forEach(e=>clearInterval(e)),Page.temporaryIntervals=[],Page.temporaryWebWorkers.forEach(e=>e.terminate()),Page.temporaryWebWorkers=[],Page.desmosGraphs)Page.desmosGraphs[e].destroy();try{Applet.current.forEach(e=>e.destroy()),Applet.current=[]}catch(e){}Page.element.remove()}export{navigationTransitionType,redirect};