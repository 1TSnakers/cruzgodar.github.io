import{fadeDownOut,fadeLeftOut,fadeOut,fadeRightOut,fadeUpOut,opacityAnimationTime}from"./animation.min.mjs";import{Applet}from"./applets.min.mjs";import{bannerElement,bannerOnScroll,loadBanner,setScrollButtonExists}from"./banners.min.mjs";import{cardIsOpen,hideCard}from"./cards.min.mjs";import{clearDesmosGraphs,desmosGraphs}from"./desmos.min.mjs";import{loadPage}from"./load-page.min.mjs";import{clearTemporaryIntervals,clearTemporaryListeners,clearTemporaryWorkers,pageElement,pageUrl,setPageScroll,setPageUrl,temporaryIntervals,temporaryListeners,temporaryWorkers}from"./main.min.mjs";import{forceThemePages,getQueryParams,preventThemeChangePages,setForcedTheme,setRevertThemeTo,siteSettings,toggleDarkTheme}from"./settings.min.mjs";import{sitemap}from"./sitemap.min.mjs";let currentlyRedirecting=!1;function setCurrentlyRedirecting(newCurrentlyRedirecting){currentlyRedirecting=newCurrentlyRedirecting}let lastPageScroll=0,navigationTransitionType=0;async function redirect({url,inNewTab=!1,noStatePush=!1,restoreScroll=!1,noFadeOut=!1}){if(!currentlyRedirecting)if(inNewTab||-1!==url.indexOf("."))window.open(url,"_blank");else{currentlyRedirecting=!0,cardIsOpen&&await hideCard();const e=window.scrollY;navigationTransitionType=getTransitionType(url),await fadeOutPage({url:url,noFadeOut:noFadeOut}),Promise.all([fetch(url+"data.html"),loadBanner()]).then(response=>{if(response[0].ok)return response[0].text();window.location.replace("/404.html")}).then(data=>{unloadPage(),document.body.firstElementChild.insertAdjacentHTML("beforebegin",`<div class="page" style="opacity: 0">${data}</div>`),setPageUrl(url),loadPage(),noStatePush?history.replaceState({url:url},document.title,getDisplayUrl()):history.pushState({url:url},document.title,getDisplayUrl()),document.documentElement.style.overflowY="scroll",document.body.style.overflowY="visible",document.body.style.userSelect="auto",document.body.style.WebkitUserSelect="auto",restoreScroll?(window.scrollTo(0,lastPageScroll),bannerOnScroll(lastPageScroll)):(window.scrollTo(0,0),setPageScroll(0)),lastPageScroll=e})}}function getTransitionType(url){if(!(url in sitemap)||url===pageUrl)return 0;let e=pageUrl;for(;""!==e;)if(url===(e=sitemap[e].parent))return-1;for(e=url;""!==e;)if(e=sitemap[e].parent,pageUrl===e)return 1;if(sitemap[url].parent!==sitemap[pageUrl].parent)return 0;{const e=sitemap[url].parent;return sitemap[e].children.indexOf(url)>sitemap[e].children.indexOf(pageUrl)?2:-2}}function getDisplayUrl(){return pageUrl.replace(/\/home\//,"/")+getQueryParams()}async function fadeOutPage({url,noFadeOut}){void 0===forceThemePages[url]||siteSettings.darkTheme===forceThemePages[url]||preventThemeChangePages.includes(pageUrl)||(setRevertThemeTo(siteSettings.darkTheme),setForcedTheme(!0),toggleDarkTheme({force:!0})),noFadeOut?pageElement.style.opacity=0:await(1===navigationTransitionType?bannerElement?Promise.all([fadeUpOut(pageElement),fadeUpOut(bannerElement,opacityAnimationTime,!0)]):fadeUpOut(pageElement):-1===navigationTransitionType?bannerElement?Promise.all([fadeDownOut(bannerElement,opacityAnimationTime,!0),fadeDownOut(pageElement)]):fadeDownOut(pageElement):2===navigationTransitionType?bannerElement?Promise.all([fadeLeftOut(bannerElement,opacityAnimationTime,!0),fadeLeftOut(pageElement)]):fadeLeftOut(pageElement):-2===navigationTransitionType?bannerElement?Promise.all([fadeRightOut(bannerElement,opacityAnimationTime,!0),fadeRightOut(pageElement)]):fadeRightOut(pageElement):bannerElement?Promise.all([fadeOut(bannerElement,opacityAnimationTime,!0),fadeOut(pageElement)]):fadeOut(pageElement))}function unloadPage(){document.querySelectorAll("script, .temporary-style").forEach(element=>element.remove()),temporaryListeners.forEach(temporaryListener=>{temporaryListener[0].removeEventListener(temporaryListener[1],temporaryListener[2])}),clearTemporaryListeners(),temporaryIntervals.forEach(refreshId=>clearInterval(refreshId)),clearTemporaryIntervals();for(const e in temporaryWorkers)temporaryWorkers[e]?.terminate&&temporaryWorkers[e].terminate();clearTemporaryWorkers();for(const t in desmosGraphs)desmosGraphs[t].destroy();clearDesmosGraphs(),Applet.current.forEach(applet=>{applet?.destroy&&applet.destroy()}),Applet.current=[],setScrollButtonExists(!1),pageElement.remove()}export{setCurrentlyRedirecting,navigationTransitionType,redirect,getDisplayUrl};