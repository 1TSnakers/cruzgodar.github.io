import anime from"../anime.min.js";import{cardAnimationTime}from"./animation.min.js";import{addHoverEventWithScale}from"./hoverEvents.min.js";import{$,$$,pageElement}from"./main.min.js";const contentsSelector=".notes-title:not(.notes-pf-title), .section-text, .heading-text";let contentsContainerElement,contentsElement,indicatorElement,contentsShown=!1,contentsAnimating=!1;function setUpPageContents(){const t=$(".nav-buttons");t&&(prepareContents(),t.lastElementChild.insertAdjacentHTML("afterend",`
		<div class="focus-on-child contents-button-container" tabindex="1">
			<button class="text-button linked-text-button" type="button" tabindex="-1">Contents</button>
		</div>
	`),t.classList.add("contents-container"),setTimeout(()=>{var n=t.lastElementChild.firstElementChild;addHoverEventWithScale(n,1.075),n.addEventListener("click",showContents)}))}function prepareContents(){(contentsContainerElement=document.createElement("div")).id="contents-container",pageElement.appendChild(contentsContainerElement),(contentsElement=document.createElement("div")).id="contents",contentsContainerElement.append(contentsElement),$$(contentsSelector).forEach(element=>{var n,t=element.cloneNode(!0);t.classList.contains("heading-text")&&-1!==(n=t.textContent.indexOf(":"))&&(t.textContent=t.textContent.slice(n+2)),contentsElement.appendChild(t),t.addEventListener("click",()=>{element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),window.innerWidth<1e3&&hideContents()}),addHoverEventWithScale(t,1.025)}),contentsContainerElement.style.opacity=0,contentsContainerElement.style.marginRight="-32px",contentsContainerElement.style.display="none",(indicatorElement=document.createElement("img")).id="contents-indicator",indicatorElement.src="/graphics/general-icons/contents-indicator.png",pageElement.appendChild(indicatorElement),addHoverEventWithScale(indicatorElement,1.1),indicatorElement.addEventListener("click",showContents)}async function showContents(){contentsShown||contentsAnimating||(contentsAnimating=!0,contentsShown=!0,contentsContainerElement.style.display="flex",await Promise.all([anime({targets:contentsContainerElement,opacity:1,marginRight:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),document.documentElement.addEventListener("click",handleClickEvent),contentsAnimating=!1)}async function hideContents(){contentsShown&&!contentsAnimating&&(contentsAnimating=!0,contentsShown=!1,document.documentElement.removeEventListener("click",handleClickEvent),await Promise.all([anime({targets:contentsContainerElement,opacity:0,marginRight:"-32px",duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:1,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),contentsContainerElement.style.display="none",contentsAnimating=!1)}function handleClickEvent(e){let n=e.target;for(;n!==pageElement;){if(n===contentsElement)return;n=n.parentElement}hideContents()}export{setUpPageContents};