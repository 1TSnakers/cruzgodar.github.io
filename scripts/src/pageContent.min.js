import anime from"../anime.min.js";import{cardAnimationTime}from"./animation.min.js";import{addHoverEventWithScale}from"./hoverEvents.min.js";import{$,$$,pageElement}from"./main.min.js";const contentsSelector=".notes-title, .section-text, .heading-text";let contentsContainerElement,contentsElement,indicatorElement,contentsShown=!1,contentsAnimating=!1;function initPageContents(){const t=$(".nav-buttons");t&&(prepareContents(),t.insertAdjacentHTML("afterend",`
		<div class="text-buttons nav-buttons contents-button-container" style="grid-template-columns: repeat(auto-fit, 88px);">
			<div class="focus-on-child" tabindex="1">
				<button class="text-button linked-text-button" type="button" tabindex="-1">Contents</button>
			</div>
		</div>
	`),t.classList.add("contents-container"),setTimeout(()=>{var n=t.nextElementSibling.firstElementChild;addHoverEventWithScale({element:n,scale:1.075,addBounceOnTouch:!1}),n.addEventListener("click",showContents)}))}function prepareContents(){(contentsContainerElement=document.createElement("div")).id="contents-container",pageElement.appendChild(contentsContainerElement),(contentsElement=document.createElement("div")).id="contents",contentsContainerElement.append(contentsElement),$$(contentsSelector).forEach(element=>{var n,t=element.cloneNode(!0);t.classList.contains("heading-text")&&-1!==(n=t.textContent.indexOf(":"))&&(t.textContent=t.textContent.slice(n+2)),contentsElement.appendChild(t),t.addEventListener("click",()=>{element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),window.innerWidth<1e3&&hideContents()}),addHoverEventWithScale({element:t,scale:1.025,addBounceOnTouch:!1})}),contentsContainerElement.style.opacity=0,contentsContainerElement.style.marginRight=window.reduceMotion?0:"-32px",contentsContainerElement.style.display="none",(indicatorElement=document.createElement("img")).id="contents-indicator",indicatorElement.src="/graphics/general-icons/contents-indicator.png",pageElement.appendChild(indicatorElement),addHoverEventWithScale({element:indicatorElement,scale:1.1,addBounceOnTouch:!1}),indicatorElement.addEventListener("click",showContents)}async function showContents(){contentsShown||contentsAnimating||(contentsAnimating=!0,contentsShown=!0,contentsContainerElement.style.display="flex",await Promise.all([anime({targets:contentsContainerElement,opacity:1,marginRight:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),document.documentElement.addEventListener("click",handleClickEvent),contentsAnimating=!1)}async function hideContents(){contentsShown&&!contentsAnimating&&(contentsAnimating=!0,contentsShown=!1,document.documentElement.removeEventListener("click",handleClickEvent),await Promise.all([anime({targets:contentsContainerElement,opacity:0,marginRight:window.reduceMotion?0:"-32px",duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:1,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),contentsContainerElement.style.display="none",contentsAnimating=!1)}function handleClickEvent(e){let n=e.target;for(;n!==pageElement;){if(n===contentsElement)return;n=n.parentElement}hideContents()}export{initPageContents};