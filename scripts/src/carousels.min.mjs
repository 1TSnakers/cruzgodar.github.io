import anime from"../anime.min.js";import{carouselFillAnimationTime,carouselSwitchAnimationTime}from"./animation.min.mjs";import{$$,addTemporaryListener}from"./main.min.mjs";const dotSize=8,expandedDotWidth=128;class Carousel{element;children;dots;activeChild=-1;currentFillAnimation;permanentlyPaused=!1;constructor(element){this.element=element,this.children=element.firstElementChild.children,this.dots=Array.from(element.lastElementChild.children),this.dots.forEach((dot,index)=>{dot.addEventListener("click",()=>{index!==this.activeChild&&(this.permanentlyPaused=!0,this.advance(index))})}),this.element.addEventListener("mouseenter",()=>{this.currentFillAnimation&&!this.permanentlyPaused&&this.currentFillAnimation.pause()}),this.element.addEventListener("mouseleave",()=>{this.currentFillAnimation&&!this.permanentlyPaused&&this.currentFillAnimation.play()});var i=()=>{var i,e;this.currentFillAnimation&&!this.permanentlyPaused&&(e=(i=this.element.getBoundingClientRect()).top,-i.height<=e&&e<window.innerHeight?this.currentFillAnimation.play():this.currentFillAnimation.pause())};addTemporaryListener({object:window,event:"scroll",callback:i}),i(),this.advance(0)}async advance(newActiveChild=(this.activeChild+1)%this.children.length){this.currentFillAnimation&&this.currentFillAnimation.pause();var i=this.activeChild,e=(this.dots[newActiveChild].classList.add("active"),await new Promise(resolve=>setTimeout(resolve,10)),-1!==this.activeChild?this.dots[this.activeChild]:void 0),t=e?[anime({targets:e,width:dotSize,duration:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished,anime({targets:e.firstElementChild,opacity:0,duration:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished,anime({targets:this.children[this.activeChild],opacity:0,duration:carouselSwitchAnimationTime,easing:"easeInQuad"}).finished]:[],n=(this.activeChild=newActiveChild,this.dots[newActiveChild]),a=(this.permanentlyPaused&&(n.firstElementChild.style.width=expandedDotWidth/5+4+"px"),[anime({targets:n,width:this.permanentlyPaused?expandedDotWidth/5:expandedDotWidth,duration:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished,anime({targets:n.firstElementChild,opacity:1,duration:this.permanentlyPaused?0:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished]);await Promise.all(t.concat(a)),e&&(e.firstElementChild.style.width=dotSize+4+"px",this.children[i].style.display="none",this.dots[i].classList.remove("active")),this.children[newActiveChild].style.display="block",this.permanentlyPaused?await anime({targets:this.children[this.activeChild],opacity:1,duration:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished:(this.currentFillAnimation=anime({targets:n.firstElementChild,width:expandedDotWidth+4,duration:carouselFillAnimationTime,easing:"linear",endDelay:carouselSwitchAnimationTime}),window.dispatchEvent(new Event("scroll")),await Promise.all([this.currentFillAnimation.finished,anime({targets:this.children[this.activeChild],opacity:1,duration:carouselSwitchAnimationTime,easing:"easeInOutQuad"}).finished]),this.advance())}}function setUpCarousels(){$$(".carousel").forEach(element=>new Carousel(element))}export{setUpCarousels};