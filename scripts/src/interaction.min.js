import{currentlyLoadedApplets}from"../applets/applet.min.js";import{removeHoverEvents}from"./hoverEvents.min.js";import{addTemporaryListener}from"./main.min.js";let currentlyTouchDevice="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,lastMousemoveEvent=0;function initInteractionListeners(){var e=handleTouchEvent.bind(this);document.documentElement.addEventListener("touchstart",e,!1),document.documentElement.addEventListener("touchmove",e,!1),document.documentElement.addEventListener("mousemove",()=>{var e;currentlyTouchDevice&&(e=Date.now()-lastMousemoveEvent,lastMousemoveEvent=Date.now(),3<=e)&&e<=50&&33!=e&&(currentlyTouchDevice=!1,updateTapClickElements())}),document.documentElement.addEventListener("keydown",e=>{"Enter"!==e.key||"BUTTON"===document.activeElement.tagName||"INPUT"===document.activeElement.tagName&&"button"!==document.activeElement.getAttribute("type")||document.activeElement.click()})}function handleTouchEvent(){"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&"SELECT"!==document.activeElement.tagName&&"true"!==document.activeElement.getAttribute("contenteditable")&&document.activeElement.blur(),currentlyTouchDevice||(removeHoverEvents(),currentlyTouchDevice=!0,updateTapClickElements())}function updateTapClickElements(){for(const e of Array.from(document.body.querySelectorAll("span.click-tap")))currentlyTouchDevice?(e.firstElementChild.style.display="none",e.lastElementChild.style.display="inline"):(e.firstElementChild.style.display="inline",e.lastElementChild.style.display="none")}function handleFullscreenButtonPress(){let e=1/0,t=0;for(let l=0;l<currentlyLoadedApplets.length;l++){var n=currentlyLoadedApplets[l];if(n.allowFullscreenWithKeyboard){const o=n.wilsonForFullscreen??n.wilson;if(o.currentlyFullscreen)return void o.exitFullscreen();n=n.canvas.getBoundingClientRect(),n=n.top+n.height/2,n=Math.abs(window.innerHeight/2-n);n<e&&(e=n,t=l)}}if(currentlyLoadedApplets[t].allowFullscreenWithKeyboard){const o=currentlyLoadedApplets[t].wilsonForFullscreen??currentlyLoadedApplets[t].wilson;o.enterFullscreen()}}function handleResetButtonPress(){let e=1/0,t=0;for(let o=0;o<currentlyLoadedApplets.length;o++){var n=currentlyLoadedApplets[o];n.allowResetWithKeyboard&&(n=(n=n.canvas.getBoundingClientRect()).top+n.height/2,(n=Math.abs(window.innerHeight/2-n))<e)&&(e=n,t=o)}var l;currentlyLoadedApplets[t].allowResetWithKeyboard&&((l=currentlyLoadedApplets[t].wilsonForReset??currentlyLoadedApplets[t].wilson).resetWorldCoordinates(),l.resetDraggables(),l.onReset())}function listenForWilsonButtons(){addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||("f"===e.key&&handleFullscreenButtonPress(),"r"===e.key&&handleResetButtonPress())}})}export{currentlyTouchDevice,initInteractionListeners,updateTapClickElements,listenForWilsonButtons};