import{currentlyLoadedApplets}from"../applets/applet.min.js";import{removeHoverEvents}from"./hoverEvents.min.js";import{addTemporaryListener}from"./main.min.js";let currentlyTouchDevice="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,lastMousemoveEvent=0;function initInteractionListeners(){var e=handleTouchEvent.bind(this);document.documentElement.addEventListener("touchstart",e,!1),document.documentElement.addEventListener("touchmove",e,!1),document.documentElement.addEventListener("mousemove",()=>{var e;currentlyTouchDevice&&(e=Date.now()-lastMousemoveEvent,lastMousemoveEvent=Date.now(),3<=e)&&e<=50&&33!=e&&(currentlyTouchDevice=!1,updateTapClickElements())}),document.documentElement.addEventListener("keydown",e=>{"Enter"!==e.key||"BUTTON"===document.activeElement.tagName||"INPUT"===document.activeElement.tagName&&"button"!==document.activeElement.getAttribute("type")||document.activeElement.click()})}function handleTouchEvent(){"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&"SELECT"!==document.activeElement.tagName&&"true"!==document.activeElement.getAttribute("contenteditable")&&document.activeElement.blur(),currentlyTouchDevice||(removeHoverEvents(),currentlyTouchDevice=!0,updateTapClickElements())}function updateTapClickElements(){for(const e of Array.from(document.body.querySelectorAll("span.click-tap")))currentlyTouchDevice?(e.firstElementChild.style.display="none",e.lastElementChild.style.display="inline"):(e.firstElementChild.style.display="inline",e.lastElementChild.style.display="none")}function listenForFullscreenKey(){addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{if("f"===e.key&&!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey)&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName){let e=1/0,t=0;for(let n=0;n<currentlyLoadedApplets.length;n++){var l=currentlyLoadedApplets[n];if(l.allowFullscreenWithKeyboard){var o=l.wilsonForFullscreen??l.wilson;if(o.currentlyFullscreen)return void o.exitFullscreen();o=l.canvas.getBoundingClientRect(),l=o.top+o.height/2,o=Math.abs(window.innerHeight/2-l);o<e&&(e=o,t=n)}}currentlyLoadedApplets[t].allowFullscreenWithKeyboard&&(currentlyLoadedApplets[t].wilsonForFullscreen??currentlyLoadedApplets[t].wilson).enterFullscreen()}}})}export{currentlyTouchDevice,initInteractionListeners,updateTapClickElements,listenForFullscreenKey};