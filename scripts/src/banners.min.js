import{changeOpacity}from"./animation.min.js";import{headerElement}from"./header.min.js";import{likelyWindowChromeHeight,onResize,viewportHeight}from"./layout.min.js";import{$,addStyle,addTemporaryListener,asyncFetch,pageElement,pageUrl}from"./main.min.js";let bannerElement,contentElement,bannerMaxScroll;function setBannerMaxScroll(newBannerMaxScroll){bannerMaxScroll=newBannerMaxScroll}let nameTextOpacity=1,lastBannerChangeTimestamp=-1,overflowScrollTimeoutId;function setOverflowScrollTimeoutId(newOverflowScrollTimeoutId){overflowScrollTimeoutId=newOverflowScrollTimeoutId}function updateBanner(timestamp){var e,n,t;bannerElement&&contentElement&&timestamp!==lastBannerChangeTimestamp&&-1!==lastBannerChangeTimestamp?(lastBannerChangeTimestamp=timestamp,e=Math.min(Math.max(window.scrollY/bannerMaxScroll*1.35,0),1),e=.5+.5*Math.sin(Math.PI*(Math.pow(e,.5)-.5)),nameTextOpacity=1-Math.min(1.5*e,1),bannerElement.style.opacity=1-e,n=window.innerWidth<=500?8:16,t=Math.min(Math.max((window.innerWidth-900-2*n)/2,n),16),contentElement.style.paddingLeft=n+e*t+"px",contentElement.style.paddingRight=n+e*t+"px",contentElement.style.paddingTop=n+e*n+"px",contentElement.parentElement.style.marginLeft=`-${n+t*e}px`,contentElement.parentElement.style.marginRight=`-${n+t*e}px`,contentElement.offsetHeight<viewportHeight-headerElement.offsetHeight-32?(contentElement.parentElement.style.marginBottom=(viewportHeight-headerElement.offsetHeight-contentElement.offsetHeight)/2+"px",setTimeout(()=>onResize(),16)):contentElement.parentElement.style.marginBottom=0,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*(1-e)})`):lastBannerChangeTimestamp=timestamp,requestAnimationFrame(updateBanner)}requestAnimationFrame(updateBanner);let bannerFilename="",bannerFilepath="";const bannerPages=["/home/","/about/","/writing/mist/","/writing/desolation-point/","/debug/htmdl-test/"],multibannerPages={"/home/":{currentBanner:Math.floor(10*Math.random())+1,numBanners:10}};async function loadBanner(large=!1){if(bannerPages.includes(pageUrl)){bannerElement=$("#banner"),(contentElement=$("#content")).parentElement.style.marginTop=`calc(100vh - ${likelyWindowChromeHeight+40}px)`,bannerFilename=`${large?"large":"small"}.webp`,bannerFilepath=pageUrl+"banners/",pageUrl in multibannerPages&&(bannerFilepath+=multibannerPages[pageUrl].currentBanner+"/"),addStyle(`
		#banner-small
		{
			background: url(${bannerFilepath}small.webp) no-repeat center center;
			background-size: cover;
		}
		
		#banner-large
		{
			background: url(${bannerFilepath}large.webp) no-repeat center center;
			background-size: cover;
		}
	`),await asyncFetch(bannerFilepath+bannerFilename);const n=new Image;var e=new Promise(resolve=>{n.onload=()=>{n.remove(),resolve()}});n.style.opacity=0,n.style.position="fixed",n.style.top="-100vh",n.style.left="-100vw",pageElement.appendChild(n),setTimeout(()=>{n.src=bannerFilepath+bannerFilename},20),await e}}function initBanner(){bannerPages.includes(pageUrl)&&loadBanner(!0).then(()=>{changeOpacity({element:$("#banner-small"),opacity:0,duration:700}).then(()=>$("#banner-small").remove())}),addTemporaryListener({object:window,event:"scroll",callback:()=>{clearTimeout(overflowScrollTimeoutId),window.scrollY<=0?overflowScrollTimeoutId=setTimeout(()=>{document.documentElement.style.overscrollBehaviorY="none"},800):document.documentElement.style.overscrollBehaviorY="auto"}})}export{bannerElement,contentElement,setBannerMaxScroll,nameTextOpacity,overflowScrollTimeoutId,setOverflowScrollTimeoutId,updateBanner,bannerPages,multibannerPages,loadBanner,initBanner};