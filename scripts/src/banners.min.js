import anime from"../anime.min.js";import{changeOpacity}from"./animation.min.js";import{headerElement}from"./header.min.js";import{likelyWindowChromeHeight,onResize,pageWidth,viewportHeight}from"./layout.min.js";import{$,addStyle,asyncFetch,pageElement,pageUrl}from"./main.min.js";import{siteSettings}from"./settings.min.js";let bannerElement,contentElement,bannerMaxScroll;function setBannerMaxScroll(newBannerMaxScroll){bannerMaxScroll=newBannerMaxScroll}let nameTextOpacity=1,lastBannerChangeTimestamp=-1,lastT=0,lastT0=0;function easeInOutQuad(x){return x<.5?2*x*x:1-Math.pow(-2*x+2,2)/2}function updateBanner(timestamp){if(bannerElement&&contentElement&&timestamp!==lastBannerChangeTimestamp&&-1!==lastBannerChangeTimestamp){lastBannerChangeTimestamp=timestamp;var e=window.innerWidth<=500?8:16,n=Math.min(Math.max((window.innerWidth-pageWidth-2*e)/2,e),16),t=Math.min(Math.max(window.scrollY/bannerMaxScroll*1.3,0),1),a=easeInOutQuad(t);if(siteSettings.reduceMotion){var r=e+n;if(contentElement.style.paddingLeft=r+"px",contentElement.style.paddingRight=r+"px",contentElement.style.paddingTop=r+"px",contentElement.parentElement.style.marginLeft=`-${r}px`,contentElement.parentElement.style.marginRight=`-${r}px`,.8<=a&&lastT<.8){const l={t:0};anime({targets:l,t:1,duration:300,easing:"easeInOutSine",update:()=>{bannerElement.style.opacity=1-l.t,nameTextOpacity=1-l.t,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*(1-l.t)})`}})}else if(a<.8&&.8<=lastT){const i={t:0};anime({targets:i,t:1,duration:300,easing:"easeInOutSine",update:()=>{bannerElement.style.opacity=i.t,nameTextOpacity=i.t,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*i.t})`}})}}else contentElement.style.paddingLeft=e+a*n+"px",contentElement.style.paddingRight=e+a*n+"px",contentElement.style.paddingTop=e+a*e+"px",contentElement.parentElement.style.marginLeft=`-${e+n*a}px`,contentElement.parentElement.style.marginRight=`-${e+n*a}px`,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*(1-a)})`,bannerElement.style.opacity=1-a,nameTextOpacity=1-Math.min(1.5*a,1);contentElement.offsetHeight<viewportHeight-headerElement.offsetHeight-32?(contentElement.parentElement.style.marginBottom=(viewportHeight-headerElement.offsetHeight-contentElement.offsetHeight)/2+"px",setTimeout(()=>onResize(),16)):contentElement.parentElement.style.marginBottom=0,lastT=a,lastT0=isNaN(t)?0:t}else lastBannerChangeTimestamp=timestamp;requestAnimationFrame(updateBanner)}requestAnimationFrame(updateBanner);let bannerFilename="",bannerFilepath="";const bannerPages=["/home/","/about/","/writing/mist/","/writing/desolation-point/","/debug/htmdl-test/"],multibannerPages={"/home/":{currentBanner:Math.floor(10*Math.random())+1,numBanners:10}};async function loadBanner(large=!1){if(bannerPages.includes(pageUrl)){bannerElement=$("#banner"),(contentElement=$("#content")).parentElement.style.marginTop=`calc(100vh - ${likelyWindowChromeHeight+40}px)`,bannerFilename=`${large?"large":"small"}.webp`,bannerFilepath=pageUrl+"banners/",pageUrl in multibannerPages&&(bannerFilepath+=multibannerPages[pageUrl].currentBanner+"/"),addStyle(`
		#banner-small
		{
			background: url(${bannerFilepath}small.webp) no-repeat center center;
			background-size: cover;
		}
		
		#banner-large
		{
			background: url(${bannerFilepath}large.webp) no-repeat center center;
			background-size: cover;
		}
	`),await asyncFetch(bannerFilepath+bannerFilename);const n=new Image;var e=new Promise(resolve=>{n.onload=()=>{n.remove(),resolve()}});n.style.opacity=0,n.style.position="fixed",n.style.top="-100vh",n.style.left="-100vw",pageElement.appendChild(n),setTimeout(()=>{n.src=bannerFilepath+bannerFilename},20),await e}}function initBanner(){bannerPages.includes(pageUrl)&&loadBanner(!0).then(()=>{changeOpacity({element:$("#banner-small"),opacity:0,duration:700}).then(()=>$("#banner-small").remove())})}export{bannerElement,contentElement,setBannerMaxScroll,nameTextOpacity,updateBanner,bannerPages,multibannerPages,loadBanner,initBanner};