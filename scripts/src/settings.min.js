import{opacityAnimationTime}from"./animation.min.js";import{cardIsOpen}from"./cards.min.js";import{recreateDesmosGraphs}from"./desmos.min.js";import{$,addStyle,pageUrl}from"./main.min.js";import{getDisplayUrl}from"./navigation.min.js";import anime from"/scripts/anime.min.js";const forceThemePages={"/gallery/":!0,"/slides/oral-exam/":!0},preventThemeChangePages=["/gallery/","/slides/oral-exam/","/writing/caracore/","/writing/caligo/"],rootElement=document.querySelector(":root"),metaThemeColorElement=document.querySelector("#theme-color-meta");let themeToggles=0;const params=new URLSearchParams(window.location.search),darkTheme=null===params.get("theme")?window.matchMedia("(prefers-color-scheme: dark)").matches:"1"===params.get("theme"),siteSettings={darkTheme:darkTheme,card:params.get("card"),condensedApplets:"1"===params.get("condensedapplets")};function getQueryParams(){var e=[];return siteSettings.darkTheme&&!window.matchMedia("(prefers-color-scheme: dark)").matches?e.push("theme=1"):!siteSettings.darkTheme&&window.matchMedia("(prefers-color-scheme: dark)").matches&&e.push("theme=0"),siteSettings.card&&e.push("card="+siteSettings.card),window.DEBUG&&e.push("debug=1"),0!==e.length?"?"+e.join("&"):""}let revertThemeTo=null;function setRevertThemeTo(newRevertThemeTo){revertThemeTo=newRevertThemeTo}let forcedTheme=!1;function setForcedTheme(newForcedTheme){forcedTheme=newForcedTheme}function initDarkTheme(){window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{cardIsOpen||(e.matches&&!siteSettings.darkTheme||!e.matches&&siteSettings.darkTheme)&&toggleDarkTheme({})}),void 0!==forceThemePages[pageUrl]?(siteSettings.darkTheme=forceThemePages[pageUrl],toggleDarkTheme({noAnimation:!(siteSettings.darkTheme=!1),force:!0})):siteSettings.darkTheme&&toggleDarkTheme({noAnimation:!(siteSettings.darkTheme=!1)})}function revertTheme(){forcedTheme?forcedTheme=!1:null!==revertThemeTo&&(revertThemeTo=null,siteSettings.darkTheme!==revertThemeTo)&&toggleDarkTheme({})}async function toggleDarkTheme({noAnimation=!1,force=!1}){if((force||!preventThemeChangePages.includes(pageUrl))&&!handleEasterEgg())if(siteSettings.darkTheme=!siteSettings.darkTheme,recreateDesmosGraphs(),history.replaceState({url:pageUrl},document.title,getDisplayUrl()),noAnimation)metaThemeColorElement.setAttribute("content",siteSettings.darkTheme?"#181818":"#ffffff"),rootElement.style.setProperty("--theme",siteSettings.darkTheme?1:0);else{var e=addStyle(`
			*:not(.page, #banner, .desmos-container)
			{
				transition: none !important;
			}
		`);const t={t:siteSettings.darkTheme?0:1};await Promise.all([anime({targets:metaThemeColorElement,content:siteSettings.darkTheme?"#181818":"#ffffff",duration:2*opacityAnimationTime,easing:"cubicBezier(.25, .1, .25, 1)"}).finished,anime({targets:t,t:siteSettings.darkTheme?1:0,duration:2*opacityAnimationTime,easing:"cubicBezier(.25, .1, .25, 1)",update:()=>{rootElement.style.setProperty("--theme",t.t)},complete:()=>{rootElement.style.setProperty("--theme",siteSettings.darkTheme?1:0)}}).finished]),e.remove()}}function condenseApplet(){addStyle(`
		p:not(.text-box-subtext, .checkbox-subtext, .radio-button-subtext, .slider-subtext), h1, h2, header, footer, br
		{
			display: none;
		}
		
		section:first-of-type
		{
			margin-top: 0 !important;
			margin-bottom: 0 !important;
		}
		
		body
		{
			margin-top: -5vh;
		}

		#canvas-landscape
		{
			flex-direction: column !important;
		}

		#canvas-landscape-left, #canvas-landscape-middle, #canvas-landscape-right
		{
			width: 80% !important;
		}
	`);var e=$("#download-button");e?.parentNode?.parentNode&&(e.parentNode.parentNode.style.display="none")}let timeoutId,shownEasterEgg=!1;function handleEasterEgg(){if(themeToggles++,clearTimeout(timeoutId),timeoutId=setTimeout(()=>themeToggles=0,300),8<=themeToggles&&!shownEasterEgg){shownEasterEgg=!0,clearTimeout(timeoutId),document.body.querySelector("#header-theme-button").innerHTML="boo",addStyle(`
			#banner, img, canvas
			{
				filter: brightness(max(calc(var(--extra-brightness) / 10), 1)) saturate(var(--extra-brightness)) contrast(var(--extra-brightness)) hue-rotate(calc(var(--extra-brightness) * 5deg));
			}
		`,!1);const e={t:1},t=siteSettings.darkTheme?"lch(8.25% 0 0)":"lch(100% 0 0)",r=siteSettings.darkTheme?"lch(100% 23.2 0)":"lch(0% 0 0)",a=siteSettings.darkTheme?"lch(83.48% 0 0)":"lch(27.09% 0 0)",o=siteSettings.darkTheme?"lch(74.78% 0 0)":"lch(40.73% 0 0)";document.documentElement.style.filter="brightness(1)",anime({targets:e,t:0,duration:2e3,easing:"easeOutQuad",update:()=>{rootElement.style.setProperty("--background",`color-mix(in lch, ${t} ${100*e.t}%, lch(46.62% 108.32 40.84))`),rootElement.style.setProperty("--high-contrast",`color-mix(in lch, ${r} ${100*e.t}%, lch(79.24% 134.33 134.57))`),rootElement.style.setProperty("--normal-contrast",`color-mix(in lch, ${a} ${100*e.t}%, lch(79.24% 134.33 134.57))`),rootElement.style.setProperty("--low-contrast",`color-mix(in lch, ${o} ${100*e.t}%, lch(79.24% 134.33 134.57))`),rootElement.style.setProperty("--extra-brightness",10*(1-e.t)+1)}})}return shownEasterEgg}export{forceThemePages,preventThemeChangePages,metaThemeColorElement,siteSettings,getQueryParams,setRevertThemeTo,setForcedTheme,initDarkTheme,revertTheme,toggleDarkTheme,condenseApplet};