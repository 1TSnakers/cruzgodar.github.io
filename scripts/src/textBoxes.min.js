import{CappedInputElement,uncapEverything}from"./cappedInputElement.min.js";import{addTemporaryParam,pageUrl}from"./main.min.js";import{siteSettings}from"./settings.min.js";class TextBox extends CappedInputElement{defaultValue;valueTypeIsString=!1;persistState;constructor({element,name,value,maxValue=1/0,minValue=-1/0,persistState=!0,onInput=()=>{},onEnter=()=>{}}){if(super({element:element,name:name,max:maxValue,min:minValue,labelElement:element.nextElementSibling,capClassElement:element}),this.value=value,this.defaultValue=this.value,this.onInput=onInput,this.onEnter=onEnter,this.persistState=persistState,this.element.value=this.value,this.element.nextElementSibling.textContent=this.name,"string"==typeof this.value&&(this.valueTypeIsString=!0,this.disableCaps=!0),this.element.addEventListener("input",()=>this.setValue(this.element.value,!0)),this.element.addEventListener("focusout",()=>{""===this.element.value&&(this.element.value=this.defaultValue,this.setValue(this.element.value,!1)),this.updateCaps()}),this.element.addEventListener("keydown",e=>{"Enter"!==e.key||this.disabled||(""===this.element.value&&(this.element.value=this.defaultValue,this.setValue(this.element.value,!1)),this.updateCaps(),this.onEnter())}),this.valueTypeIsString||this.setCap(),this.name.toLowerCase().includes("resolution")&&1!==siteSettings.resolutionMultiplier&&setTimeout(()=>this.onInput()),this.persistState){const value=new URLSearchParams(window.location.search).get(this.element.id);value?setTimeout(()=>{this.setValue(decodeURIComponent(value),!0),this.updateCaps(),this.loadResolve()},10):this.loadResolve(),addTemporaryParam(this.element.id)}else this.loadResolve()}setValue(newValue,callOnInput=!1){var e;this.disabled||(this.element.value=newValue,this.value=this.valueTypeIsString?newValue||this.defaultValue:parseFloat(newValue||this.defaultValue),this.valueTypeIsString||(this.value>=this.max&&!uncapEverything?this.value=this.max:this.value<=this.min&&!uncapEverything?this.value=this.min:(this.capClassElement.classList.remove("capped-input-max"),this.capClassElement.classList.remove("capped-input-min"))),this.persistState&&(e=new URLSearchParams(window.location.search),void 0!==this.value&&e.set(this.element.id,encodeURIComponent(this.value)),e=e.toString(),window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(e?"?"+e:""))),callOnInput&&this.onInput())}}export{TextBox};