import anime from"../anime.min.js";import{opacityAnimationTime}from"./animation.min.js";import{headerElement}from"./header.min.js";import{addHoverEvent}from"./hover-events.min.js";import{$$}from"./main.min.js";const maxSingleColumnOptions=7;function setUpDropdown(selectElement){let d=!1,a=0,s=1;const r=selectElement.previousElementSibling,m=(r.innerHTML="",r.parentNode.parentNode.style.gridTemplateColumns="repeat(auto-fit, 100%)",document.createElement("div")),c=(m.classList.add("option-container"),selectElement.querySelectorAll("option").length>maxSingleColumnOptions&&m.classList.add("two-column"),r.appendChild(m),[]),o=[];async function p(e){document.documentElement.removeEventListener("click",p),d=!1,r.classList.remove("expanded");var t=a;let n=document.elementFromPoint(e.clientX,e.clientY);for(;!n.hasAttribute("data-option-index")&&"HTML"!==n.tagName;)n=n.parentNode;a=parseInt(n.getAttribute("data-option-index")??a)||a,selectElement.value=o[a].value,t!==a&&selectElement.dispatchEvent(new Event("input"));t=c.slice(0,a).map(element=>element.getBoundingClientRect().height/s);let i=0;t.forEach(height=>i-=height),i-=10,await Promise.all([anime({targets:[r,r.parentNode.parentNode],height:c[a].getBoundingClientRect().height/s+4,width:c[a].getBoundingClientRect().width/s+16,translateY:0,scale:1,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:m,translateY:i,easing:"easeOutQuad",duration:opacityAnimationTime}).finished])}selectElement.querySelectorAll("option").forEach((option,index)=>{var e=document.createElement("div");e.textContent=option.textContent,e.setAttribute("data-option-index",index),c.push(e),m.appendChild(e),o.push(option)}),setTimeout(()=>{c.slice(1).forEach(element=>{addHoverEvent(element)}),c[0].innerHTML+=' <span style="font-size: 12px; margin-right: -2px">&#x25BC;</span>',r.style.height=1.075*c[a].getBoundingClientRect().height+"px",r.style.width=c[a].getBoundingClientRect().width+16+"px",r.parentNode.parentNode.style.height=1.075*c[a].getBoundingClientRect().height+"px",r.parentNode.parentNode.style.width=c[a].getBoundingClientRect().width+16+"px",m.style.transform="translateY(-10px)"},16),r.addEventListener("click",()=>{d||!async function(){d=!0,r.classList.add("expanded");let e=0;c.forEach(element=>{e=Math.max(e,element.getBoundingClientRect().width)});var t=m.getBoundingClientRect().height+4,n=headerElement.getBoundingClientRect().height,i=window.innerHeight-n-20,i=t*(s=Math.min(i/t,1)),a=(o=r.getBoundingClientRect()).top+o.height/2-i/2,o=o.bottom-o.height/2+i/2;let l=0;o>window.innerHeight-10?l=window.innerHeight-10-o:a<10+n&&(l=10+n-a),await Promise.all([anime({targets:r,height:t,width:e+29.75-14,translateY:l,scale:s,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:m,translateY:0,easing:"easeOutQuad",duration:opacityAnimationTime}).finished]),document.documentElement.addEventListener("click",p)}()})}function setUpDropdowns(){$$("select").forEach(element=>setUpDropdown(element))}export{setUpDropdowns};