import anime from"../anime.min.js";import{opacityAnimationTime}from"./animation.min.js";import{headerElement}from"./header.min.js";import{addHoverEvent}from"./hoverEvents.min.js";import{$$}from"./main.min.js";const maxSingleColumnOptions=7;function setUpDropdown(selectElement){let h=!1,o=0,p=1;const g=selectElement.previousElementSibling,u=(g.innerHTML="",g.parentNode.parentNode.style.gridTemplateColumns="repeat(auto-fit, 100%)",document.createElement("div")),w=(u.classList.add("option-container"),selectElement.querySelectorAll("option").length>maxSingleColumnOptions&&u.classList.add("two-column"),g.appendChild(u),[]),d=[];async function x(e){document.documentElement.removeEventListener("click",x),h=!1,g.classList.remove("expanded");var t=o;let n=document.elementFromPoint(e.clientX,e.clientY);for(;!n.hasAttribute("data-option-index")&&"HTML"!==n.tagName;)n=n.parentNode;o=parseInt(n.getAttribute("data-option-index")??o)||o,selectElement.value=d[o].value,t!==o&&selectElement.dispatchEvent(new Event("input"));var t=u.children[0].getBoundingClientRect(),i=u.children[o].getBoundingClientRect(),a=(t.top-i.top)/p-10,t=-(-t.width/2+i.left-t.left+i.width/2)/p;await Promise.all([anime({targets:[g,g.parentNode.parentNode],height:w[o].getBoundingClientRect().height/p+4,width:w[o].getBoundingClientRect().width/p+16,translateY:0,translateX:0,scale:1,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:u,translateY:a,translateX:t,easing:"easeOutQuad",duration:opacityAnimationTime}).finished])}selectElement.querySelectorAll("option").forEach((option,index)=>{var e=document.createElement("div");e.textContent=option.textContent,e.setAttribute("data-option-name",option.getAttribute("value")),e.setAttribute("data-option-index",index),w.push(e),u.appendChild(e),d.push(option)}),setTimeout(()=>{w.slice(1).forEach(element=>{addHoverEvent(element)}),w[0].innerHTML+=' <span style="font-size: 12px; margin-right: -2px">&#x25BC;</span>',g.style.height=1.075*w[o].getBoundingClientRect().height+"px",g.style.width=w[o].getBoundingClientRect().width+16+"px",g.parentNode.parentNode.style.height=1.075*w[o].getBoundingClientRect().height+"px",g.parentNode.parentNode.style.width=w[o].getBoundingClientRect().width+16+"px",u.style.transform="translateY(-10px)"},16),g.addEventListener("click",()=>{h||!async function(){h=!0,g.classList.add("expanded");let e=0,t=0;w.forEach((element,index)=>{index%2==0?e=Math.max(e,element.getBoundingClientRect().width):t=Math.max(t,element.getBoundingClientRect().width)});var n=u.classList.contains("two-column")?e+t:Math.max(e,t),i=u.getBoundingClientRect().height+4,a=headerElement.getBoundingClientRect().height,o=window.innerHeight-a-20,n=n+28,d=window.innerWidth-20,d=i*(p=Math.min(d/n,Math.min(o/i,1))),o=n*p,l=(s=g.getBoundingClientRect()).top+s.height/2-d/2,d=s.bottom-s.height/2+d/2,r=s.left+s.width/2-o/2,s=s.right-s.width/2+o/2;let m=0,c=(d>window.innerHeight-10?m=window.innerHeight-10-d:l<10+a&&(m=10+a-l),0);s>window.innerWidth-10?c=window.innerWidth-10-s:r<10&&(c=10-r),await Promise.all([anime({targets:g,height:i,width:n,translateY:m,translateX:c,scale:p,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:u,translateY:0,translateX:0,easing:"easeOutQuad",duration:opacityAnimationTime}).finished]),document.documentElement.addEventListener("click",x)}()})}function setUpDropdowns(){$$("select").forEach(element=>setUpDropdown(element))}export{setUpDropdowns};