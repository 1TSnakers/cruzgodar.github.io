import anime from"../anime.min.js";import{opacityAnimationTime}from"./animation.min.js";import{headerElement}from"./header.min.js";import{addHoverEvent}from"./hover-events.min.js";import{$$}from"./main.min.js";const maxSingleColumnOptions=7;function setUpDropdown(selectElement){let c=!1,o=0,h=1;const p=selectElement.previousElementSibling,g=(p.innerHTML="",p.parentNode.parentNode.style.gridTemplateColumns="repeat(auto-fit, 100%)",document.createElement("div")),u=(g.classList.add("option-container"),selectElement.querySelectorAll("option").length>maxSingleColumnOptions&&g.classList.add("two-column"),p.appendChild(g),[]),d=[];async function w(e){document.documentElement.removeEventListener("click",w),c=!1,p.classList.remove("expanded");var t=o;let n=document.elementFromPoint(e.clientX,e.clientY);for(;!n.hasAttribute("data-option-index")&&"HTML"!==n.tagName;)n=n.parentNode;o=parseInt(n.getAttribute("data-option-index")??o)||o,selectElement.value=d[o].value,t!==o&&selectElement.dispatchEvent(new Event("input"));var t=g.children[0].getBoundingClientRect(),i=g.children[o].getBoundingClientRect(),a=(t.top-i.top)/h-10,t=-(-t.width/2+i.left-t.left+i.width/2)/h;await Promise.all([anime({targets:[p,p.parentNode.parentNode],height:u[o].getBoundingClientRect().height/h+4,width:u[o].getBoundingClientRect().width/h+16,translateY:0,translateX:0,scale:1,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:g,translateY:a,translateX:t,easing:"easeOutQuad",duration:opacityAnimationTime}).finished])}selectElement.querySelectorAll("option").forEach((option,index)=>{var e=document.createElement("div");e.textContent=option.textContent,e.setAttribute("data-option-index",index),u.push(e),g.appendChild(e),d.push(option)}),setTimeout(()=>{u.slice(1).forEach(element=>{addHoverEvent(element)}),u[0].innerHTML+=' <span style="font-size: 12px; margin-right: -2px">&#x25BC;</span>',p.style.height=1.075*u[o].getBoundingClientRect().height+"px",p.style.width=u[o].getBoundingClientRect().width+16+"px",p.parentNode.parentNode.style.height=1.075*u[o].getBoundingClientRect().height+"px",p.parentNode.parentNode.style.width=u[o].getBoundingClientRect().width+16+"px",g.style.transform="translateY(-10px)"},16),p.addEventListener("click",()=>{c||!async function(){c=!0,p.classList.add("expanded");let e=0;u.forEach(element=>{e=Math.max(e,element.getBoundingClientRect().width)}),g.classList.contains("two-column")&&(e*=2);var t=g.getBoundingClientRect().height+4,n=headerElement.getBoundingClientRect().height,i=window.innerHeight-n-20,a=e+29.75-14,o=window.innerWidth-20,o=t*(h=Math.min(o/a,Math.min(i/t,1))),i=a*h,d=(s=p.getBoundingClientRect()).top+s.height/2-o/2,o=s.bottom-s.height/2+o/2,l=s.left+s.width/2-i/2,s=s.right-s.width/2+i/2;let r=0,m=(o>window.innerHeight-10?r=window.innerHeight-10-o:d<10+n&&(r=10+n-d),0);s>window.innerWidth-10?m=window.innerWidth-10-s:l<10&&(m=10-l),await Promise.all([anime({targets:p,height:t,width:a,translateY:r,translateX:m,scale:h,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:g,translateY:0,translateX:0,easing:"easeOutQuad",duration:opacityAnimationTime}).finished]),document.documentElement.addEventListener("click",w)}()})}function setUpDropdowns(){$$("select").forEach(element=>setUpDropdown(element))}export{setUpDropdowns};