import anime from"../anime.min.js";import{opacityAnimationTime}from"./animation.min.js";import{headerElement}from"./header.min.js";import{addHoverEvent}from"./hover-events.min.js";import{$$}from"./main.min.js";const maxSingleColumnOptions=7;function setUpDropdown(selectElement){let c=!1,o=0,p=1;const h=selectElement.previousElementSibling,g=(h.innerHTML="",h.parentNode.parentNode.style.gridTemplateColumns="repeat(auto-fit, 100%)",document.createElement("div")),u=(g.classList.add("option-container"),selectElement.querySelectorAll("option").length>maxSingleColumnOptions&&g.classList.add("two-column"),h.appendChild(g),[]),d=[];async function w(e){document.documentElement.removeEventListener("click",w),c=!1,h.classList.remove("expanded");var t=o;let n=document.elementFromPoint(e.clientX,e.clientY);for(;!n.hasAttribute("data-option-index")&&"HTML"!==n.tagName;)n=n.parentNode;o=parseInt(n.getAttribute("data-option-index")??o)||o,selectElement.value=d[o].value,t!==o&&selectElement.dispatchEvent(new Event("input"));var t=g.children[0].getBoundingClientRect(),i=g.children[o].getBoundingClientRect(),a=(t.top-i.top)/p-10,t=-(-t.width/2+i.left-t.left+i.width/2)/p;await Promise.all([anime({targets:[h,h.parentNode.parentNode],height:u[o].getBoundingClientRect().height/p+4,width:u[o].getBoundingClientRect().width/p+16,translateY:0,translateX:0,scale:1,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:g,translateY:a,translateX:t,easing:"easeOutQuad",duration:opacityAnimationTime}).finished])}selectElement.querySelectorAll("option").forEach((option,index)=>{var e=document.createElement("div");e.textContent=option.textContent,e.setAttribute("data-option-name",option.getAttribute("value")),e.setAttribute("data-option-index",index),u.push(e),g.appendChild(e),d.push(option)}),setTimeout(()=>{u.slice(1).forEach(element=>{addHoverEvent(element)}),u[0].innerHTML+=' <span style="font-size: 12px; margin-right: -2px">&#x25BC;</span>',h.style.height=1.075*u[o].getBoundingClientRect().height+"px",h.style.width=u[o].getBoundingClientRect().width+16+"px",h.parentNode.parentNode.style.height=1.075*u[o].getBoundingClientRect().height+"px",h.parentNode.parentNode.style.width=u[o].getBoundingClientRect().width+16+"px",g.style.transform="translateY(-10px)"},16),h.addEventListener("click",()=>{c||!async function(){c=!0,h.classList.add("expanded");let e=0;u.forEach(element=>{e=Math.max(e,element.getBoundingClientRect().width)}),g.classList.contains("two-column")&&(e*=2);var t=g.getBoundingClientRect().height+4,n=headerElement.getBoundingClientRect().height,i=window.innerHeight-n-20,a=e+8,o=window.innerWidth-20,o=t*(p=Math.min(o/a,Math.min(i/t,1))),i=a*p,d=(r=h.getBoundingClientRect()).top+r.height/2-o/2,o=r.bottom-r.height/2+o/2,l=r.left+r.width/2-i/2,r=r.right-r.width/2+i/2;let s=0,m=(o>window.innerHeight-10?s=window.innerHeight-10-o:d<10+n&&(s=10+n-d),0);r>window.innerWidth-10?m=window.innerWidth-10-r:l<10&&(m=10-l),await Promise.all([anime({targets:h,height:t,width:a,translateY:s,translateX:m,scale:p,easing:"easeOutQuad",duration:opacityAnimationTime}).finished,anime({targets:g,translateY:0,translateX:0,easing:"easeOutQuad",duration:opacityAnimationTime}).finished]),document.documentElement.addEventListener("click",w)}()})}function setUpDropdowns(){$$("select").forEach(element=>setUpDropdown(element))}export{setUpDropdowns};