import{fadeDownIn,fadeIn,fadeLeftIn,fadeRightIn,fadeUpIn,opacityAnimationTime}from"./animation.min.js";import{bannerElement,initBanner}from"./banners.min.js";import{Button,initNavButtons,initTextButtons}from"./buttons.min.js";import{initCards}from"./cards.min.js";import{initCarousels}from"./carousels.min.js";import{initFocusEvents,initHoverEvents}from"./hoverEvents.min.js";import{loadImages}from"./images.min.js";import{listenForFullscreenKey}from"./interaction.min.js";import{equalizeAppletColumns,onResize}from"./layout.min.js";import{$,$$,pageElement,pageUrl,updatePageElement}from"./main.min.js";import{typesetMath}from"./math.min.js";import{navigationTransitionType,redirect,setCurrentlyRedirecting}from"./navigation.min.js";import{initPageContents}from"./pageContent.min.js";import{siteSettings}from"./settings.min.js";import{sitemap}from"./sitemap.min.js";import{animate,asyncFetch,sleep}from"./utils.min.js";let pageShown=!0;async function loadPage(){pageShown=!1,window.dispatchEvent(new Event("scroll")),updatePageElement();var e=document.head.querySelector("title");e&&(e.textContent=sitemap[pageUrl].title),initBanner(),await loadCustomStyle(),loadCustomScripts(),setLinks(),disableLinks(),initSolutions(),initHoverEvents(),initTextButtons(),initNavButtons(),initPageContents(),initCarousels(),loadImages(),typesetMath(),initCards(),onResize(),listenForFullscreenKey(),setTimeout(initFocusEvents,50),setTimeout(equalizeAppletColumns,50),setTimeout(equalizeAppletColumns,100),window.scrollTo(0,0)}async function showPage(){await fadeInPage(),setCurrentlyRedirecting(!1)}async function loadCustomStyle(){var e;sitemap[pageUrl].customStyle&&((e=document.createElement("style")).textContent=await asyncFetch(pageUrl+"/style/index."+(window.DEBUG?"css":"min.css")),e.classList.add("temporary-style"),document.head.insertBefore(e,document.head.firstChild))}function loadCustomScripts(){sitemap[pageUrl].customScript?import(pageUrl+"/scripts/index."+(window.DEBUG?"js":"min.js")).then(Module=>Module.default()):requestAnimationFrame(showPage)}async function fadeInPage(){siteSettings.reduceMotion?(document.querySelector("#header").style.opacity=1,document.querySelector("#header-container").style.opacity=1,bannerElement&&(bannerElement.style.opacity=1),pageElement.style.opacity=1):(fadeIn({element:document.querySelector("#header")}),document.querySelector("#header-container").style.opacity=1,setTimeout(()=>pageShown=!0,10),opacityAnimationTime?await(1===navigationTransitionType?bannerElement?Promise.all([fadeUpIn({element:bannerElement}),fadeUpIn({element:pageElement})]):fadeUpIn({element:pageElement}):-1===navigationTransitionType?bannerElement?Promise.all([fadeDownIn({element:bannerElement}),fadeDownIn({element:pageElement})]):fadeDownIn({element:pageElement}):2===navigationTransitionType?bannerElement?Promise.all([fadeLeftIn({element:bannerElement}),fadeLeftIn({element:pageElement})]):fadeLeftIn({element:pageElement}):-2===navigationTransitionType?bannerElement?Promise.all([fadeRightIn({element:bannerElement}),fadeRightIn({element:pageElement})]):fadeRightIn({element:pageElement}):bannerElement?Promise.all([fadeIn({element:bannerElement}),fadeIn({element:pageElement})]):fadeIn({element:pageElement})):(pageElement.style.opacity=1,bannerElement&&(bannerElement.style.opacity=1)))}function setLinks(){$$("a:not([data-card-id])").forEach(link=>{link.addEventListener("click",e=>{var t,n=link.getAttribute("href");n&&(t=!("https"!==n.slice(0,5)&&"data"!==n.slice(0,4)&&1!=link.getAttribute("data-in-new-tab")),redirect({url:n,inNewTab:t||e.metaKey}))})}),$$("a[data-card-id]").forEach(link=>{link.addEventListener("click",e=>{var t;e.metaKey&&(t=link.getAttribute("href"))&&redirect({url:t,inNewTab:!0})})})}function disableLinks(){$$("a:not(.real-link)").forEach(link=>{link.addEventListener("click",e=>e.preventDefault())})}function packageSolution(solutionElement,showButton=!0){for(;solutionElement.nextElementSibling;)solutionElement.appendChild(solutionElement.nextElementSibling);if(solutionElement.style.position="fixed",solutionElement.style.top="0",solutionElement.style.left="0",solutionElement.style.opacity=0,solutionElement.style.zIndex=-100,showButton){const o=document.createElement("div");o.classList.add("text-buttons"),o.style.marginBottom="16px",solutionElement.parentElement.appendChild(o);var e=document.createElement("div"),n=(e.classList.add("focus-on-child"),e.tabIndex=1,e.style.margin="0px auto",o.appendChild(e),document.createElement("button"));n.classList.add("text-button"),n.type="button",n.tabIndex=-1,e.appendChild(n),new Button({element:n,name:"Show Solution",linked:!1,onClick:async()=>{solutionElement.style.height="auto",solutionElement.style.width=solutionElement.parentElement.getBoundingClientRect().width-12+"px",await sleep(10);const e=solutionElement.getBoundingClientRect().height,n=o.getBoundingClientRect().height,i=parseFloat(window.getComputedStyle(o).marginTop);solutionElement.style.height=0,solutionElement.style.position="relative",await animate(t=>{solutionElement.style.height=e*t+"px",o.style.height=n*(1-t)+"px",o.style.marginTop=i*(1-t)+"px",o.style.opacity=1-t,solutionElement.style.opacity=t},450,"easeOutQuint"),solutionElement.style.height="auto",solutionElement.style.width="auto",o.remove()}})}}function initSolutions(){$$(".notes-ex .solution").forEach(e=>e.remove());const t=$("#show-solutions");$$(".notes-exc .solution").forEach(e=>{packageSolution(e,null!==t||window.DEBUG)})}export{pageShown,loadPage,showPage,disableLinks};