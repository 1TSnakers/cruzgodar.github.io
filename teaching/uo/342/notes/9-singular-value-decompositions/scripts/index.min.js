import{eigendata,uVectors}from"./data.min.js";import{VSingularValues,VU,VW}from"./vData.min.js";import{showPage}from"/scripts/src/loadPage.min.js";import{$}from"/scripts/src/main.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{WilsonCPU}from"/scripts/wilson.min.js";export default function(){{const o=new WilsonCPU($("#v-canvas"),{canvasWidth:400}),s=new Array(o.canvasHeight);for(let e=0;e<o.canvasHeight;e++)s[e]=new Array(o.canvasWidth);const t=new Slider({element:$("#depth-slider"),name:"Depth",value:100,min:1,max:200,integer:!0,logarithmic:!0,onInput:function(){a(t.value)}});function a(depth=200){for(let n=0;n<o.canvasHeight;n++)for(let a=0;a<o.canvasWidth;a++)for(let e=s[n][a]=0;e<depth;e++)s[n][a]+=VSingularValues[e]*VU[n][e]*VW[a][e];var a=s,t=new Uint8ClampedArray(o.canvasWidth*o.canvasHeight*4);for(let i=0;i<o.canvasHeight;i++)for(let e=0;e<o.canvasWidth;e++){var r=4*(o.canvasWidth*i+e);t[r]=a[i][e],t[1+r]=a[i][e],t[2+r]=a[i][e],t[3+r]=255}o.drawFrame(t)}a()}{const v=44,i=new WilsonCPU($("#eigenface-canvas"),{canvasWidth:100}),d=i.canvasHeight*i.canvasWidth*4,f=new Array(v),u=new Slider({element:$("#index-slider"),name:"Face",value:0,min:0,max:v-1,onInput:e}),p=new Slider({element:$("#depth-2-slider"),name:"Depth",value:1,min:1,max:v,onInput:e}),g=!1;function e(){if(g){var a=uVectors[Math.floor(u.value)],t=uVectors[Math.ceil(u.value)],r=u.value-Math.floor(u.value),n=new Array(d);for(let e=0;e<d;e++)n[e]=(1-r)*a[e]+r*t[e];m(n)}else{var i,[o,s=v]=[u.value,p.value],l=new Array(d),c=new Array(v),h=Math.floor(o);for(let e=0;e<v;e++)c[e]=(1-(o-h))*Math.sqrt(eigendata[e][0])*eigendata[e][1][h]/v,o<v-1&&(c[e]+=(o-h)*Math.sqrt(eigendata[e][0])*eigendata[e][1][h+1]/v);for(let a=0;a<d;a++){for(let e=l[a]=0;e<Math.floor(s);e++)l[a]+=c[e]*uVectors[e][a]/f[e];s<v-1&&(i=Math.floor(s),l[a]+=(s-i)*c[i]*uVectors[i][a]/f[i])}m(l)}}function m(vec){var e=[...vec];let a=0,t=0;for(let r=0;r<e.length;r+=4)a=Math.max(a,e[r]),a=Math.max(a,e[r+1]),a=Math.max(a,e[r+2]),t=Math.min(t,e[r]),t=Math.min(t,e[r+1]),t=Math.min(t,e[r+2]);for(let n=0;n<e.length;n+=4)e[n]=(e[n]-t)/(a-t)*255,e[n+1]=(e[n+1]-t)/(a-t)*255,e[n+2]=(e[n+2]-t)/(a-t)*255,e[n+3]=255;i.drawFrame(new Uint8ClampedArray(e))}setTimeout(()=>e(),100);for(let t=0;t<v;t++){let e=0;for(let a=0;a<d;a++)e+=uVectors[t][a]*uVectors[t][a];f[t]=Math.sqrt(e)}}showPage()}