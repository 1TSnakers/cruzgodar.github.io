import{A,eigendata,uVectors}from"./data.min.js";import{DownloadButton}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{showPage}from"/scripts/src/loadPage.min.js";import{$}from"/scripts/src/main.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{Wilson}from"/scripts/wilson.min.js";async function load(){const s=new Wilson($("#output-canvas"),{renderer:"cpu",canvasWidth:162,canvasHeight:200}),i=s.canvasHeight*s.canvasWidth*4,c=new Array(21),e=(new DownloadButton({element:$("#download-button"),wilson:s,filename:"eigenface.png"}),new Checkbox({element:$("#eigenface-checkbox"),name:"Show eigenface",onInput:t})),l=new Slider({element:$("#index-slider"),name:"Face",value:0,min:0,max:20,integer:!0,onInput:t}),m=new Slider({element:$("#depth-slider"),name:"Depth",value:1,min:1,max:21,integer:!0,onInput:t});function t(){if(e.checked)h(uVectors[l.value]);else{var[a,n=21]=[l.value,m.value],r=new Array(i),o=new Array(21);for(let e=0;e<21;e++)o[e]=Math.sqrt(eigendata[e][0])*eigendata[e][1][a]/21;for(let t=0;t<i;t++)for(let e=r[t]=0;e<n;e++)r[t]+=o[e]*uVectors[e][t]/c[e];h(r)}}function h(vec){var e=[...vec];let t=0,a=0;for(let r=0;r<e.length;r+=4)t=Math.max(t,e[r]),t=Math.max(t,e[r+1]),t=Math.max(t,e[r+2]),a=Math.min(a,e[r]),a=Math.min(a,e[r+1]),a=Math.min(a,e[r+2]);for(let o=0;o<e.length;o+=4)e[o]=(e[o]-a)/(t-a)*255,e[o+1]=(e[o+1]-a)/(t-a)*255,e[o+2]=(e[o+2]-a)/(t-a)*255,e[o+3]=255;var n=new ImageData(new Uint8ClampedArray(e),s.canvasWidth,s.canvasHeight);s.ctx.putImageData(n,0,0)}showPage(),setTimeout(()=>t(),100);for(let a=0;a<21;a++){let e=0;for(let t=0;t<i;t++)e+=uVectors[a][t]*uVectors[a][t];c[a]=Math.sqrt(e)}}export{load};