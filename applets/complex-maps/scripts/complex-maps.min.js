!async function(){"use strict";Site.scripts_loaded.glsl||await Site.load_glsl();let t=null,e=1,n=1,r=[],a=500,o=1,l=1,i=0,c=0,_=0,d=0,s=0,w=0,u=0,h=0;const g=.96,m=.0025,f=25e-5,p=.93,v=.01,b=.001;let y=-1,x=!1;const z=10,M=4e3;let k=Page.element.querySelector("#code-textarea");k.value="cexp(cinv(z))",k.addEventListener("keydown",t=>{13===t.keyCode&&(t.preventDefault(),E(),r=[],n=-.585)}),Page.element.querySelector("#generate-button").addEventListener("click",()=>{E(),r=[],n=-.585});let q=Page.element.querySelector("#selector-mode-button");q.addEventListener("click",()=>{x=!0}),Page.element.querySelector("#benchmark-button").addEventListener("click",function(){t.change_canvas_size(M,M);let e=Date.now(),n=new Uint8Array(4);for(let e=0;e<z;e++)t.render.draw_frame(),t.gl.readPixels(0,0,1,1,t.gl.RGBA,t.gl.UNSIGNED_BYTE,n);let r=(Date.now()-e)/z;console.log(`Finished benchmark --- average time to draw a ${M}x${M} frame is ${r}ms`),t.change_canvas_size(a,a)}),DEBUG||q.parentNode.parentNode.remove();let S=Page.element.querySelector("#resolution-input");S.addEventListener("input",()=>{a=parseInt(S.value||500),t.change_canvas_size(a,a),window.requestAnimationFrame(U)});let A=Page.element.querySelector("#black-point-input");A.addEventListener("input",()=>{o=parseFloat(A.value||1),window.requestAnimationFrame(U)});let F=Page.element.querySelector("#white-point-input");F.addEventListener("input",()=>{l=parseFloat(F.value||1),window.requestAnimationFrame(U)}),Page.element.querySelector("#download-button").addEventListener("click",()=>{t.download_frame("a-complex-map.png")});let P=Page.element.querySelector("#canvas-location");Page.element.querySelector("#hidden-canvas-location");function E(e=!1,n=2,r=2,a=0,o=0){let l=k.value||"cexp(cinv(z))",i="";e&&(i="\n\t\t\t\timage_z.x += 127.0;\n\t\t\t\timage_z.y += 127.0;\n\t\t\t\t\n\t\t\t\tfloat whole_1 = floor(image_z.x);\n\t\t\t\tfloat whole_2 = floor(image_z.y);\n\t\t\t\t\n\t\t\t\tfloat fract_1 = (image_z.x - whole_1);\n\t\t\t\tfloat fract_2 = (image_z.y - whole_2);\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(whole_1 / 256.0, fract_1, whole_2 / 256.0, fract_2);\n\t\t\t\t\n\t\t\t\treturn;\n\t\t\t");let c={renderer:"gpu",shader:`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float world_center_x;\n\t\t\tuniform float world_center_y;\n\t\t\tuniform float world_size;\n\t\t\t\n\t\t\tuniform float black_point;\n\t\t\tuniform float white_point;\n\t\t\t\n\t\t\tuniform vec2 draggable_arg;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t${Site.get_glsl_bundle(l)}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvec3 hsv2rgb(vec3 c)\n\t\t\t{\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns f(z) for a polynomial f with given roots.\n\t\t\tvec2 f(vec2 z)\n\t\t\t{\n\t\t\t\treturn ${l};\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z;\n\t\t\t\t\n\t\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 image_z = f(z);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t${i}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfloat modulus = length(image_z);\n\t\t\t\t\n\t\t\t\tfloat h = atan(image_z.y, image_z.x) / 6.283;\n\t\t\t\tfloat s = clamp(1.0 / (1.0 + .01 * (modulus / white_point / white_point)), 0.0, 1.0);\n\t\t\t\tfloat v = clamp(1.0 / (1.0 + .01 / (modulus * black_point * black_point)), 0.0, 1.0);\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(hsv2rgb(vec3(h, s, v)), 1.0);\n\t\t\t}\n\t\t`,canvas_width:500,canvas_height:500,world_width:n,world_height:r,world_center_x:a,world_center_y:o,use_draggables:!0,draggables_mousemove_callback:K,draggables_touchmove_callback:K,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:T,mousedown_callback:$,touchstart_callback:$,mousedrag_callback:L,touchmove_callback:L,mouseup_callback:N,touchend_callback:N,wheel_callback:D,pinch_callback:B};try{t.output_canvas_container.parentNode.remove(),P.insertAdjacentHTML("beforebegin",'\n\t\t\t\t<div>\n\t\t\t\t\t<canvas id="output-canvas" class="output-canvas"></canvas>\n\t\t\t\t</div>\n\t\t\t')}catch(t){}(t=new Wilson(Page.element.querySelector("#output-canvas"),c)).render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","black_point","white_point","draggable_arg"]),t.gl.uniform1f(t.uniforms.aspect_ratio,1),-1!==l.indexOf("draggable_arg")&&(t.draggables.add(0,0),t.gl.uniform2f(t.uniforms.draggable_arg,0,0)),window.requestAnimationFrame(U),_=0,d=0,s=0,w=0,u=0,h=0}function $(e,n,r){w=0,u=0,h=0,_=0,d=0,s=0,x&&(E(!0,t.world_width,t.world_height,t.world_center_x,t.world_center_y),setTimeout(()=>{t.render.draw_frame();let r=t.utils.interpolate.world_to_canvas(e,n),a=new Uint8Array(4);t.gl.readPixels(r[1],t.canvas_height-r[0],1,1,t.gl.RGBA,t.gl.UNSIGNED_BYTE,a);let o=a[0]-127+a[1]/256,l=a[2]-127+a[3]/256,i="+";n<0&&(i="-");let c="+";l<0&&(c="-"),console.log(`${e} ${i} ${Math.abs(n)}i |---\x3e ${o} ${c} ${Math.abs(l)}i`),E(!1,t.world_width,t.world_height,t.world_center_x,t.world_center_y),x=!1},20))}function L(e,n,r,a,o){t.world_center_x-=r,t.world_center_y-=a,_=-r/t.world_width,d=-a/t.world_height;try{t.draggables.recalculate_locations()}catch(t){}window.requestAnimationFrame(U)}function N(t,e,n){Math.sqrt(_*_+d*d)>=m&&(w=_,u=d),Math.abs(s)>=v&&(h=s),window.requestAnimationFrame(U)}function D(t,e,r,a){i=t,c=e,Math.abs(r/100)<.3?n+=r/100:h+=.05*Math.sign(r),G()}function B(r,a,o,l){e>=1?(n-=o/t.world_width*10,s=-o/t.world_width*10):(n-=o/t.world_height*10,s=-o/t.world_height*10),i=r,c=a,G()}function G(){if(e>=1){let r=t.input.get_zoomed_world_center(i,c,3*Math.pow(2,n)*e,3*Math.pow(2,n));t.world_width=3*Math.pow(2,n)*e,t.world_height=3*Math.pow(2,n),t.world_center_x=r[0],t.world_center_y=r[1]}else{let r=t.input.get_zoomed_world_center(i,c,3*Math.pow(2,n),3*Math.pow(2,n)/e);t.world_width=3*Math.pow(2,n),t.world_height=3*Math.pow(2,n)/e,t.world_center_x=r[0],t.world_center_y=r[1]}try{t.draggables.recalculate_locations()}catch(t){}window.requestAnimationFrame(U)}function K(e,n,r,a){t.gl.uniform2f(t.uniforms.draggable_arg,n,r),window.requestAnimationFrame(U)}function U(r){let a=r-y;y=r,0!==a&&(t.gl.uniform1f(t.uniforms.aspect_ratio,e),t.gl.uniform1f(t.uniforms.world_center_x,t.world_center_x),t.gl.uniform1f(t.uniforms.world_center_y,t.world_center_y),t.gl.uniform1f(t.uniforms.world_size,Math.min(t.world_height,t.world_width)/2),t.gl.uniform1f(t.uniforms.black_point,o),t.gl.uniform1f(t.uniforms.white_point,l),t.render.draw_frame(),a>=50&&(w=0,u=0,h=0,_=0,d=0,s=0),0===w&&0===u&&0===h||(t.world_center_x+=w*t.world_width,t.world_center_y+=u*t.world_height,w*=g,u*=g,Math.sqrt(w*w+u*u)<f&&(w=0,u=0),n+=h,G(),h*=p,Math.abs(h)<b&&(h=0),window.requestAnimationFrame(U)))}function T(){t.fullscreen.currently_fullscreen?(e=window.innerWidth/window.innerHeight)>=1?(t.change_canvas_size(a,Math.floor(a/e)),t.world_width=3*Math.pow(2,n)*e,t.world_height=3*Math.pow(2,n)):(t.change_canvas_size(Math.floor(a*e),a),t.world_width=3*Math.pow(2,n),t.world_height=3*Math.pow(2,n)/e):(e=1,t.change_canvas_size(a,a),t.world_width=3*Math.pow(2,n),t.world_height=3*Math.pow(2,n)),window.requestAnimationFrame(U)}E(),r=[],n=-.585,Page.show(),window.addEventListener("resize",T),Page.temporary_handlers.resize.push(T)}();