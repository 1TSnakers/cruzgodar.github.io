!async function(){"use strict";await Site.load_glsl();let e=null,t=1,r=1,o=[],l=500,n=1,a=1,i=0,c=0,d=0,s=0,u=0,$=0,w=0,g=0,m=-1,f=!1,h=Page.element.querySelector("#code-textarea");h.value="cexp(cinv(z))",h.addEventListener("keydown",e=>{13===e.keyCode&&(e.preventDefault(),S(),o=[],r=-.585)});let p=Page.element.querySelector("#generate-button");p.addEventListener("click",()=>{S(),o=[],r=-.585});let v=Page.element.querySelector("#selector-mode-button");v.addEventListener("click",()=>{f=!0});let _=Page.element.querySelector("#benchmark-button");_.addEventListener("click",function t(){e.change_canvas_size(4e3,4e3);let r=Date.now(),o=new Uint8Array(4);for(let n=0;n<10;n++)e.render.draw_frame(),e.gl.readPixels(0,0,1,1,e.gl.RGBA,e.gl.UNSIGNED_BYTE,o);let a=(Date.now()-r)/10;console.log(`Finished benchmark --- average time to draw a 4000x4000 frame is ${a}ms`),e.change_canvas_size(l,l)}),DEBUG||v.parentNode.parentNode.remove();let b=Page.element.querySelector("#resolution-input");b.addEventListener("input",()=>{l=parseInt(b.value||500),e.change_canvas_size(l,l),window.requestAnimationFrame(C)});let y=Page.element.querySelector("#black-point-input");y.addEventListener("input",()=>{n=parseFloat(y.value||1),window.requestAnimationFrame(C)});let z=Page.element.querySelector("#white-point-input");z.addEventListener("input",()=>{a=parseFloat(z.value||1),window.requestAnimationFrame(C)});let x=Page.element.querySelector("#download-button");x.addEventListener("click",()=>{e.download_frame("a-complex-map.png")});let k={none:"",trig:"csin(z)",poles:"cinv(cmul(csub(cpow(z, 6.0), 1.0), csub(cpow(z, 3.0), 1.0)))",es:"cexp(cinv(z))",tet:"ctet(z, 100.0)",lattices:"wp(z, draggable_arg)"},q=Page.element.querySelector("#example-selector-dropdown");q.addEventListener("input",()=>{"none"!==q.value&&(h.value=k[q.value],S())});let E=Page.element.querySelector("#canvas-location");function S(t=!1,r=2,o=2,l=0,n=0){let a=h.value||"cexp(cinv(z))",i="";t&&(i=`
    image_z.x += 127.0;
    image_z.y += 127.0;
    
    float whole_1 = floor(image_z.x);
    float whole_2 = floor(image_z.y);
    
    float fract_1 = (image_z.x - whole_1);
    float fract_2 = (image_z.y - whole_2);
    
    gl_FragColor = vec4(whole_1 / 256.0, fract_1, whole_2 / 256.0, fract_2);
    
    return;
   `);let c=`
   precision highp float;
   
   varying vec2 uv;
   
   uniform float aspect_ratio;
   
   uniform float world_center_x;
   uniform float world_center_y;
   uniform float world_size;
   
   uniform float black_point;
   uniform float white_point;
   
   uniform vec2 draggable_arg;
   
   
   
   ${Site.get_glsl_bundle(a)}
   
   
   
   vec3 hsv2rgb(vec3 c)
   {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
   }
   
   
   
   //Returns f(z) for a polynomial f with given roots.
   vec2 f(vec2 z)
   {
    return ${a};
   }
   
   
   
   void main(void)
   {
    vec2 z;
    
    if (aspect_ratio >= 1.0)
    {
     z = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);
    }
    
    else
    {
     z = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);
    }
    
    
    
    vec2 image_z = f(z);
    
    
    
    ${i}
    
    
    
    float modulus = length(image_z);
    
    float h = atan(image_z.y, image_z.x) / 6.283;
    float s = clamp(1.0 / (1.0 + .01 * (modulus / white_point / white_point)), 0.0, 1.0);
    float v = clamp(1.0 / (1.0 + .01 / (modulus * black_point * black_point)), 0.0, 1.0);
    
    gl_FragColor = vec4(hsv2rgb(vec3(h, s, v)), 1.0);
   }
  `;try{e.output_canvas_container.parentNode.remove(),E.insertAdjacentHTML("beforebegin",`
    <div>
     <canvas id="output-canvas" class="output-canvas"></canvas>
    </div>
   `)}catch(m){}(e=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"gpu",shader:c,canvas_width:500,canvas_height:500,world_width:r,world_height:o,world_center_x:l,world_center_y:n,use_draggables:!0,draggables_mousemove_callback:G,draggables_touchmove_callback:G,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:D,mousedown_callback:A,touchstart_callback:A,mousedrag_callback:F,touchmove_callback:F,mouseup_callback:L,touchend_callback:L,wheel_callback:N,pinch_callback:K})).render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","black_point","white_point","draggable_arg"]),e.gl.uniform1f(e.uniforms.aspect_ratio,1),-1!==a.indexOf("draggable_arg")&&(e.draggables.add(0,0),e.gl.uniform2f(e.uniforms.draggable_arg,0,0)),window.requestAnimationFrame(C),d=0,s=0,u=0,$=0,w=0,g=0}function A(t,r,o){$=0,w=0,g=0,d=0,s=0,u=0,f&&(S(!0,e.world_width,e.world_height,e.world_center_x,e.world_center_y),setTimeout(()=>{e.render.draw_frame();let o=e.utils.interpolate.world_to_canvas(t,r),l=new Uint8Array(4);e.gl.readPixels(o[1],e.canvas_height-o[0],1,1,e.gl.RGBA,e.gl.UNSIGNED_BYTE,l);let n=l[0]-127+l[1]/256,a=l[2]-127+l[3]/256,i="+";r<0&&(i="-");let c="+";a<0&&(c="-"),console.log(`${t} ${i} ${Math.abs(r)}i |---> ${n} ${c} ${Math.abs(a)}i`),S(!1,e.world_width,e.world_height,e.world_center_x,e.world_center_y),f=!1},20))}function F(t,r,o,l,n){e.world_center_x-=o,e.world_center_y-=l,d=-o/e.world_width,s=-l/e.world_height;try{e.draggables.recalculate_locations()}catch(a){}window.requestAnimationFrame(C)}function L(e,t,r){Math.sqrt(d*d+s*s)>=.0025&&($=d,w=s),Math.abs(u)>=.01&&(g=u),window.requestAnimationFrame(C)}function N(e,t,o,l){i=e,c=t,.3>Math.abs(o/100)?r+=o/100:g+=.05*Math.sign(o),B()}function K(o,l,n,a){t>=1?(r-=n/e.world_width*10,u=-n/e.world_width*10):(r-=n/e.world_height*10,u=-n/e.world_height*10),i=o,c=l,B()}function B(){if(t>=1){let o=e.input.get_zoomed_world_center(i,c,3*Math.pow(2,r)*t,3*Math.pow(2,r));e.world_width=3*Math.pow(2,r)*t,e.world_height=3*Math.pow(2,r),e.world_center_x=o[0],e.world_center_y=o[1]}else{let l=e.input.get_zoomed_world_center(i,c,3*Math.pow(2,r),3*Math.pow(2,r)/t);e.world_width=3*Math.pow(2,r),e.world_height=3*Math.pow(2,r)/t,e.world_center_x=l[0],e.world_center_y=l[1]}try{e.draggables.recalculate_locations()}catch(n){}window.requestAnimationFrame(C)}function G(t,r,o,l){e.gl.uniform2f(e.uniforms.draggable_arg,r,o),window.requestAnimationFrame(C)}function C(o){let l=o-m;m=o,0!==l&&(e.gl.uniform1f(e.uniforms.aspect_ratio,t),e.gl.uniform1f(e.uniforms.world_center_x,e.world_center_x),e.gl.uniform1f(e.uniforms.world_center_y,e.world_center_y),e.gl.uniform1f(e.uniforms.world_size,Math.min(e.world_height,e.world_width)/2),e.gl.uniform1f(e.uniforms.black_point,n),e.gl.uniform1f(e.uniforms.white_point,a),e.render.draw_frame(),l>=50&&($=0,w=0,g=0,d=0,s=0,u=0),(0!==$||0!==w||0!==g)&&(e.world_center_x+=$*e.world_width,e.world_center_y+=w*e.world_height,25e-5>Math.sqrt(($*=.96)*$+(w*=.96)*w)&&($=0,w=0),r+=g,B(i,c),.001>Math.abs(g*=.93)&&(g=0),window.requestAnimationFrame(C)))}function D(){e.fullscreen.currently_fullscreen?(t=window.innerWidth/window.innerHeight)>=1?(e.change_canvas_size(l,Math.floor(l/t)),e.world_width=3*Math.pow(2,r)*t,e.world_height=3*Math.pow(2,r)):(e.change_canvas_size(Math.floor(l*t),l),e.world_width=3*Math.pow(2,r),e.world_height=3*Math.pow(2,r)/t):(t=1,e.change_canvas_size(l,l),e.world_width=3*Math.pow(2,r),e.world_height=3*Math.pow(2,r)),window.requestAnimationFrame(C)}Page.element.querySelector("#hidden-canvas-location"),S(),o=[],r=-.585,Page.show(),window.addEventListener("resize",D),Page.temporary_handlers.resize.push(D)}();