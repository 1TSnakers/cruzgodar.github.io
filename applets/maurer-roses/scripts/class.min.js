import{AnimationFrameApplet}from"/scripts/applets/animationFrameApplet.min.js";import{hsvToRgb}from"/scripts/applets/applet.min.js";import{convertColor}from"/scripts/src/browser.min.js";import{WilsonCPU}from"/scripts/wilson.min.js";class MaurerRoses extends AnimationFrameApplet{resolution=2e3;thetaFactor=2;pointFactor=1;numPoints=4e3;numPointsPerFrame=30;numPointsPerLine=60;curveThickness=1;lineThickness=1;drawLinesSequentially=!1;points=[];lines=[];drawPosition=0;constructor({canvas}){super(canvas);var t={canvasWidth:this.resolution,worldWidth:2.1,worldHeight:2.1,fullscreenOptions:{useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"}};this.wilson=new WilsonCPU(canvas,t)}run({resolution=2e3,thetaFactor=2,pointFactor=1,animate=!1}){this.resolution=resolution,this.thetaFactor=thetaFactor,this.pointFactor=pointFactor,this.animate=animate,this.wilson.resizeCanvas({width:this.resolution}),this.numPoints=3e4,this.numPointsPerFrame=this.numPoints/(300*this.thetaFactor),this.numPointsPerLine=120*this.numPointsPerFrame,this.drawPosition=this.animate?0:this.numPoints+this.numPointsPerLine,this.linesPerFrame=this.animate?1:360,this.curveThickness=Math.max(this.resolution/500,1),this.lineThickness=Math.max(this.resolution/500,1),this.wilson.ctx.lineWidth=this.lineThickness,this.points=[],this.lines=[];for(let r=0;r<this.numPoints;r++){var t=r/this.numPoints*2*Math.PI,i=Math.sin(t*this.thetaFactor),s=i*Math.cos(t),i=i*Math.sin(t);this.points.push(this.wilson.interpolateWorldToCanvas([s,i]))}for(let h=0;h<360;h++){var n=h/360*2*Math.PI*this.pointFactor,e=Math.sin(n*this.thetaFactor),o=e*Math.cos(n),e=e*Math.sin(n),[n,o]=this.wilson.interpolateWorldToCanvas([o,e]),e=hsvToRgb(h/360,1,1);this.lines.push([n,o,e])}this.lines.push([this.lines[0][0],this.lines[0][1],[...this.lines[0][2]]]),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.resume()}drawFrame(){for(let a=0;a<360;a++){var t,i,s,n,e,o=Math.min(Math.max((this.drawPosition-a*(this.drawLinesSequentially?this.pointFactor:1)%360/360*this.numPoints)/this.numPointsPerLine,0),1);0<o&&([t,i,s]=this.lines[a],[e,n]=this.lines[a+1],e=t+o*(e-t),o=i+o*(n-i),this.wilson.ctx.strokeStyle=convertColor(...s),this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(t,i),this.wilson.ctx.lineTo(e,o),this.wilson.ctx.stroke())}this.wilson.ctx.fillStyle="rgb(255, 255, 255)";for(let l=0;l<this.numPoints&&!(l>=this.drawPosition);l++){var[r,h]=this.points[l];this.wilson.ctx.beginPath(),this.wilson.ctx.arc(r,h,this.curveThickness,0,2*Math.PI),this.wilson.ctx.fill()}this.drawPosition+=this.numPointsPerFrame,this.drawPosition<this.numPoints+this.numPointsPerLine&&(this.needNewFrame=!0)}}export{MaurerRoses};