"use strict";onmessage=function(e){grid_size=e.data[0],generate_magic_carpet()};let grid_size=null,cages=[],cages_by_location=[],num_solutions_found=0;function generate_magic_carpet(){for(cages=[],cages_by_location=[],initialize_grid(),JSON.parse(JSON.stringify(cages)),JSON.parse(JSON.stringify(cages_by_location));;){let e=!1,a=shuffle_array([...Array(cages.length).keys()]);a.sort((e,a)=>cages[e][2]*cages[e][3]-cages[a][2]*cages[a][3]);for(let i=0;i<a.length;i++){let c=a[i];if(expand_cage(c)){e=!0;for(let t=0;t<a.length;t++)a[t]>=cages.length&&a[t]--}postMessage([cages,cages_by_location])}if(!e)return}}function initialize_grid(){cages=Array(grid_size*grid_size),cages_by_location=Array(grid_size);let e=0;for(let a=0;a<grid_size;a++){cages_by_location[a]=Array(grid_size);for(let i=0;i<grid_size;i++)cages[e]=[a,i,1,1],cages_by_location[a][i]=e,e++}}function shuffle_array(e){let a=e.length;for(;0!==a;){let i=Math.floor(Math.random()*a);a--;let c=e[a];e[a]=e[i],e[i]=c}return e}function expand_cage(e){let a=cages[e],i=a[0],c=a[1],t=a[2],g=a[3],s=[];if(0!==i){let o=cages[cages_by_location[i-1][c]];o[1]===c&&o[3]===g&&s.push([1,0])}if(0!==c){let n=cages[cages_by_location[i][c-1]];n[0]===i&&n[2]===t&&s.push([0,1])}if(0===s.length)return!1;let l=s[Math.floor(2*Math.random())],r=cages_by_location[i-l[0]][c-l[1]];cages[r][2]+=t*l[0],cages[r][3]+=g*l[1],cages.splice(e,1);for(let f=0;f<grid_size;f++)for(let $=0;$<grid_size;$++)cages_by_location[f][$]===e&&(cages_by_location[f][$]=r),cages_by_location[f][$]>e&&cages_by_location[f][$]--;return!0}