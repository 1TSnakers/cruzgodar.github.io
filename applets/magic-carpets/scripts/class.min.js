"use strict";class MagicCarpet extends Applet{grid_size=null;max_cage_size=null;cages=[];web_worker=null;constructor(i){super(i);let s={renderer:"cpu",canvas_width:500,canvas_height:500};this.wilson=new Wilson(i,s)}async run(i,s){this.grid_size=i,this.max_cage_size=s;let t=200*this.grid_size+9;this.wilson.change_canvas_size(t,t),this.wilson.ctx.clearRect(0,0,t,t);try{this.web_worker.terminate()}catch(e){}this.web_worker=new Worker(`/applets/magic-carpets/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.web_worker),this.web_worker.onmessage=i=>{this.cages=i.data[0],this.draw_grid(!1)},this.web_worker.postMessage([this.grid_size,this.max_cage_size])}draw_grid(i){let s=200*this.grid_size+9;i?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,s,s),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,s,s),1===Site.Settings.url_vars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let t=0;t<=this.grid_size;t++)this.wilson.ctx.fillRect(200*t+4,0,2,s+9),this.wilson.ctx.fillRect(0,200*t+4,s+9,2);this.wilson.ctx.fillRect(0,0,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,200*this.grid_size,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,0,10,200*this.grid_size+10),this.wilson.ctx.fillRect(200*this.grid_size,0,10,200*this.grid_size+10),this.wilson.ctx.font="120px sans-serif";for(let e=0;e<this.cages.length;e++){let l=this.cages[e][0]+this.cages[e][4],$=this.cages[e][1]+this.cages[e][5],r=` ${this.cages[e][2]*this.cages[e][3]} `;3===r.length?this.wilson.ctx.fillText(r,200*$+39,200*l+146):this.wilson.ctx.fillText(r,200*$,200*l+146)}}}