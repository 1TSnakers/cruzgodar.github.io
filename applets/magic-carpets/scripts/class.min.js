"use strict";class MagicCarpet extends Applet{grid_size=null;max_cage_size=null;cages=[];currently_drawing=!1;web_worker=null;constructor(i){super(i);let s={renderer:"cpu",canvas_width:500,canvas_height:500};this.wilson=new Wilson(i,s),this.run()}async run(i=6,s=12){if(this.currently_drawing)return;this.currently_drawing=!0,this.grid_size=i,this.max_cage_size=s;let t=200*this.grid_size+9;this.wilson.change_canvas_size(t,t),this.wilson.ctx.clearRect(0,0,t,t);try{this.web_worker.terminate()}catch(e){}this.web_worker=new Worker(`/applets/magic-carpets/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.web_worker),this.web_worker.onmessage=i=>{this.cages=i.data[0],this.draw_grid(!1)},this.web_worker.postMessage([this.grid_size,this.max_cage_size])}draw_grid(i=!1){let s=200*this.grid_size+9;i?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,s,s),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,s,s),this.wilson.ctx.fillStyle=1===Site.Settings.url_vars.theme?"rgb(255, 255, 255)":"rgb(0, 0, 0)");for(let t=0;t<=this.grid_size;t++)this.wilson.ctx.fillRect(200*t+4,0,2,s+9),this.wilson.ctx.fillRect(0,200*t+4,s+9,2);this.wilson.ctx.fillRect(0,0,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,200*this.grid_size,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,0,10,200*this.grid_size+10),this.wilson.ctx.fillRect(200*this.grid_size,0,10,200*this.grid_size+10),this.wilson.ctx.font="120px sans-serif";for(let e=0;e<this.cages.length;e++)this.draw_number(e);this.currently_drawing=!1}draw_number(i){let s=this.cages[i][0]+this.cages[i][4],t=this.cages[i][1]+this.cages[i][5],e=` ${this.cages[i][2]*this.cages[i][3]} `;3===e.length?this.wilson.ctx.fillText(e,200*t+39,200*s+146):this.wilson.ctx.fillText(e,200*t,200*s+146)}draw_solution(i=!1){if(this.currently_drawing)return;this.view_mode=-1;let s=200*this.grid_size+9;this.wilson.ctx.clearRect(0,0,s,s),i||this.draw_grid();let t=500/this.cages.length;this.draw_cage(0,t)}draw_cage(i,s,t){if(i===this.cages.length){this.wilson.ctx.fillStyle=1===Site.Settings.url_vars.theme?"rgb(24, 24, 24)":"rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,200*this.grid_size,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,0,10,200*this.grid_size+10),this.wilson.ctx.fillRect(200*this.grid_size,0,10,200*this.grid_size+10),this.currently_drawing=!1;return}let e=this.wilson.utils.hsv_to_rgb(i/this.cages.length*6/7,1,1);this.wilson.ctx.fillStyle=`rgba(${e[0]}, ${e[1]}, ${e[2]}, .2)`;let $=200*this.cages[i][0],l=200*this.cages[i][1],h=200*this.cages[i][2],r=200*this.cages[i][3];this.wilson.ctx.fillRect(l+10,$+10,r-10,h-10),e=this.wilson.utils.hsv_to_rgb(i/this.cages.length*6/7,1,.9),this.wilson.ctx.fillStyle=`rgba(${e[0]}, ${e[1]}, ${e[2]}, 1)`;let c=0===this.cages[i][0]?0:5,g=0===this.cages[i][1]?0:5,a=this.cages[i][0]+this.cages[i][2]===this.grid_size||0===this.cages[i][0]?0:5,n=this.cages[i][1]+this.cages[i][3]===this.grid_size||0===this.cages[i][1]?0:5,w=this.cages[i][0]+this.cages[i][2]===this.grid_size&&0===this.cages[i][0]?5:0,_=this.cages[i][1]+this.cages[i][3]===this.grid_size&&0===this.cages[i][1]?5:0;this.wilson.ctx.fillRect(l+10-g,$+10-c,r-5+n-_,10),this.wilson.ctx.fillRect(l+10-g,$+10-c,10,h-5+a-w),this.wilson.ctx.fillRect(l+r-5-g+n-_,$+10-c,10,h-5+a-w),this.wilson.ctx.fillRect(l+10-g+n,$+h-5-c+a-w,r-5-_,10),setTimeout(()=>this.draw_cage(i+1,s),s)}}