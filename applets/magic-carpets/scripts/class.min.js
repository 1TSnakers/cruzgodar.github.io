"use strict";class MagicCarpet extends Applet{grid_size=null;max_cage_size=null;cages=[];web_worker=null;constructor(s){super(s);let i={renderer:"cpu",canvas_width:500,canvas_height:500};this.wilson=new Wilson(s,i)}async run(s,i){this.grid_size=s,this.max_cage_size=i;let t=200*this.grid_size+9;this.wilson.change_canvas_size(t,t),this.wilson.ctx.clearRect(0,0,t,t);try{this.web_worker.terminate()}catch(e){}this.web_worker=new Worker(`/applets/magic-carpets/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.web_worker),this.web_worker.onmessage=s=>{this.cages=s.data[0],this.draw_grid(!1)},this.web_worker.postMessage([this.grid_size,this.max_cage_size])}draw_grid(s){let i=200*this.grid_size+9;s?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,i,i),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,i,i),1===Site.Settings.url_vars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let t=0;t<=this.grid_size;t++)this.wilson.ctx.fillRect(200*t+4,0,2,i+9),this.wilson.ctx.fillRect(0,200*t+4,i+9,2);this.wilson.ctx.fillRect(0,0,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,200*this.grid_size,200*this.grid_size+10,10),this.wilson.ctx.fillRect(0,0,10,200*this.grid_size+10),this.wilson.ctx.fillRect(200*this.grid_size,0,10,200*this.grid_size+10),this.wilson.ctx.font="120px sans-serif";for(let e=0;e<this.cages.length;e++)this.draw_number(e)}draw_number(s){let i=this.cages[s][0]+this.cages[s][4],t=this.cages[s][1]+this.cages[s][5],e=` ${this.cages[s][2]*this.cages[s][3]} `;3===e.length?this.wilson.ctx.fillText(e,200*t+39,200*i+146):this.wilson.ctx.fillText(e,200*t,200*i+146)}draw_solution(){let s=1e3/this.cages.length;this.draw_cage(0,s)}draw_cage(s,i){if(s===this.cages.length)return;let t=this.wilson.utils.hsv_to_rgb(s/this.cages.length*6/7,1,.95);this.wilson.ctx.fillStyle=`rgba(${t[0]}, ${t[1]}, ${t[2]}, .1)`;let e=200*this.cages[s][0],l=200*this.cages[s][1],$=200*this.cages[s][2],h=200*this.cages[s][3];this.wilson.ctx.fillRect(l+5,e+5,h,$),t=this.wilson.utils.hsv_to_rgb(s/this.cages.length*6/7,1,.7),this.wilson.ctx.fillStyle=`rgba(${t[0]}, ${t[1]}, ${t[2]}, 1)`;let c=0===this.cages[s][0]?0:5,r=0===this.cages[s][1]?0:5,g=this.cages[s][0]+this.cages[s][2]===this.grid_size||0===this.cages[s][0]?0:5,a=this.cages[s][1]+this.cages[s][3]===this.grid_size||0===this.cages[s][1]?0:5,n=this.cages[s][0]+this.cages[s][2]===this.grid_size&&0===this.cages[s][0]?5:0,w=this.cages[s][1]+this.cages[s][3]===this.grid_size&&0===this.cages[s][1]?5:0;this.wilson.ctx.fillRect(l+10-r,e+10-c,h-5+a-w,10),this.wilson.ctx.fillRect(l+10-r,e+10-c,10,$-5+g-n),this.wilson.ctx.fillRect(l+h-5-r+a-w,e+10-c,10,$-5+g-n),this.wilson.ctx.fillRect(l+10-r+a,e+$-5-c+g-n,h-5-w,10),1===Site.Settings.url_vars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)",this.draw_number(s),setTimeout(()=>this.draw_cage(s+1,i),i)}}