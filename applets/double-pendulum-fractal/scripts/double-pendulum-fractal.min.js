!function(){"use strict";let t=1000,e=.01,n=!1,a=!1,r={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"},s=new Wilson(document.querySelector("#output-canvas"),r);s.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\tconst float dt = .01;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * (3.14159265358 * 2.0);\n\t\t\t\n\t\t\tfloat denom = 16.0 - 9.0 * cos(state.x - state.y) * cos(state.x - state.y);\n\t\t\t\n\t\t\tvec4 d_state = vec4(6.0 * (2.0 * state.z - 3.0 * cos(state.x - state.y) * state.w) / denom, 6.0 * (8.0 * state.w - 3.0 * cos(state.x - state.y) * state.z) / denom, 0.0, 0.0);\n\t\t\t\n\t\t\td_state.z = -(d_state.x * d_state.y * sin(state.x - state.y) + 3.0 * sin(state.x)) / 2.0;\n\t\t\t\n\t\t\td_state.w = (d_state.x * d_state.y * sin(state.x - state.y) - sin(state.y)) / 2.0;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tstate = ((dt * d_state + state) / (3.14159265358 * 2.0)) + vec4(.5, .5, .5, .5);\n\t\t\t\n\t\t\tstate.xy = fract(state.xy);\n\t\t\t\n\t\t\tgl_FragColor = state;\n\t\t}\n\t"),s.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\t\n\t\t\n\t\tvec3 hsv2rgb(vec3 c)\n\t\t{\n\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));\n\t\t\t\n\t\t\tfloat h = atan(state.y, state.x) / 3.14159265258 + 1.0;\n\t\t\t\n\t\t\tfloat s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);\n\t\t\t\n\t\t\tfloat v_add = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));\n\t\t\t\n\t\t\tfloat v = min(sqrt(state.z * state.z + state.w * state.w) + v_add, 1.0);\n\t\t\t\n\t\t\tvec3 rgb = hsv2rgb(vec3(h, s, v));\n\t\t\t\n\t\t\tgl_FragColor = vec4(rgb, 1.0);\n\t\t}\n\t"),s.render.create_framebuffer_texture_pair(),s.render.create_framebuffer_texture_pair();let o=document.querySelector("#resolution-input");document.querySelector("#generate-button").addEventListener("click",()=>{n=!1,t=parseInt(o.value||1000),s.change_canvas_size(t,t),s.gl.bindTexture(s.gl.TEXTURE_2D,s.render.framebuffers[0].texture),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.canvas_width,s.canvas_height,0,s.gl.RGBA,s.gl.FLOAT,null),s.gl.bindTexture(s.gl.TEXTURE_2D,s.render.framebuffers[1].texture),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.canvas_width,s.canvas_height,0,s.gl.RGBA,s.gl.FLOAT,null),s.gl.useProgram(s.render.shader_programs[0]),s.gl.bindTexture(s.gl.TEXTURE_2D,s.render.framebuffers[0].texture),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,s.render.framebuffers[0].framebuffer),s.render.draw_frame(),window.requestAnimationFrame(i),n=!0});let c=document.querySelector("#switch-pendulum-drawer-canvas-button");function i(t){let e=t-M;M=t,0!==e&&(s.gl.useProgram(s.render.shader_programs[1]),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,s.render.framebuffers[1].framebuffer),s.render.draw_frame(),s.gl.useProgram(s.render.shader_programs[2]),s.gl.bindTexture(s.gl.TEXTURE_2D,s.render.framebuffers[1].texture),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),s.render.draw_frame(),s.gl.useProgram(s.render.shader_programs[1]),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,s.render.framebuffers[0].framebuffer),s.render.draw_frame(),s.gl.useProgram(s.render.shader_programs[2]),s.gl.bindTexture(s.gl.TEXTURE_2D,s.render.framebuffers[0].texture),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),s.render.draw_frame(),a||window.requestAnimationFrame(i))}c.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",c.addEventListener("click",()=>{a?(w(),window.requestAnimationFrame(w),c.style.opacity=0,setTimeout(()=>{c.textContent="Pick Pendulum",c.style.opacity=1},250)):(a=!0,c.style.opacity=0,setTimeout(()=>{c.textContent="Return to Fractal",c.style.opacity=1},250))}),document.querySelector("#download-button").addEventListener("click",()=>{s.download_frame("the-double-pendulum-fractal.png")});let l=2e3,u=0,d={renderer:"cpu",canvas_width:l,canvas_height:l,mousemove_callback:p,touchmove_callback:p,mousedown_callback:y,touchend_callback:y},h=new Wilson(document.querySelector("#pendulum-drawer-canvas"),d),f=0,m=0,g=0,v=0,_=0,x=0,b=0,M=-1;function p(t,e,r,s,o){a&&(0===u&&function(){if(!n)return;a=!0,h.canvas.style.opacity=.5,u=1}(),2!==u&&(f=t*Math.PI,m=e*Math.PI,g=0,v=0,window.requestAnimationFrame(F)))}function y(t,e,a){1===u&&(x=f,b=m,g=0,v=0,_=0,function(){if(!n)return;h.canvas.style.opacity=1,u=2,window.requestAnimationFrame(F)}())}function w(){n&&(a=!1,window.requestAnimationFrame(i),h.canvas.style.opacity=0,u=0)}function F(t){let n=t-M;if(M=t,0===n)return;_++,h.ctx.fillRect(0,0,l,l);let a=f/Math.PI,r=m/Math.PI,s=g/Math.PI,o=v/Math.PI,c=Math.atan2(r,a)/Math.PI+1,i=Math.min(Math.min(50*(a*a+r*r),5*(1-Math.max(Math.abs(a),Math.abs(r)))),1),d=.9*((1-x/(2*Math.PI))*(1-x/(2*Math.PI))+(1-b/(2*Math.PI))*(1-b/(2*Math.PI)))*4,p=function(t,e,n){let a,r,s,o,c,i,l,u;switch(o=Math.floor(6*t),i=n*(1-e),l=n*(1-(c=6*t-o)*e),u=n*(1-(1-c)*e),o%6){case 0:a=n,r=u,s=i;break;case 1:a=l,r=n,s=i;break;case 2:a=i,r=n,s=u;break;case 3:a=i,r=l,s=n;break;case 4:a=u,r=i,s=n;break;case 5:a=n,r=i,s=l}return[Math.round(255*a),Math.round(255*r),Math.round(255*s)]}(c,i,Math.min(Math.pow(s*s+o*o,.5)+d,1));h.ctx.strokeStyle=`rgb(${p[0]}, ${p[1]}, ${p[2]})`,h.ctx.beginPath(),h.ctx.moveTo(l/2,l/2),h.ctx.lineTo(l/2+l/6*Math.sin(f),l/2+l/6*Math.cos(f)),h.ctx.stroke(),h.ctx.beginPath(),h.ctx.moveTo(l/2+(l/6-l/200)*Math.sin(f),l/2+(l/6-l/200)*Math.cos(f)),h.ctx.lineTo(l/2+l/6*Math.sin(f)+l/6*Math.sin(m),l/2+l/6*Math.cos(f)+l/6*Math.cos(m)),h.ctx.stroke(),2===u&&(!function(){let t=6*(2*g-3*Math.cos(f-m)*v)/(16-9*Math.pow(Math.cos(f-m),2)),n=6*(8*v-3*Math.cos(f-m)*g)/(16-9*Math.pow(Math.cos(f-m),2)),a=-(t*n*Math.sin(f-m)+3*Math.sin(f))/2,r=(t*n*Math.sin(f-m)-Math.sin(m))/2;m+=n*e*2.5,g+=a*e*2.5,v+=r*e*2.5,(f+=t*e*2.5)>=Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI);m>=Math.PI?m-=2*Math.PI:m<-Math.PI&&(m+=2*Math.PI)}(),window.requestAnimationFrame(F))}h.ctx.lineWidth=l/100,h.ctx.strokeStyle="rgb(127, 0, 255)",h.ctx.fillStyle="rgb(0, 0, 0)",h.draggables.container.addEventListener("mouseleave",()=>{(1===u||_<3)&&(h.canvas.style.opacity=0,u=0)})}();