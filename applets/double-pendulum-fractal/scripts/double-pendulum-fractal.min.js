!function(){"use strict";let t=1e3,e=.01,a=!1,n=!1,r=null,s={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"},o=new Wilson(Page.element.querySelector("#output-canvas"),s);o.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\tconst float dt = .01;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * (3.14159265358 * 2.0);\n\t\t\t\n\t\t\tfloat denom = 16.0 - 9.0 * cos(state.x - state.y) * cos(state.x - state.y);\n\t\t\t\n\t\t\tvec4 d_state = vec4(6.0 * (2.0 * state.z - 3.0 * cos(state.x - state.y) * state.w) / denom, 6.0 * (8.0 * state.w - 3.0 * cos(state.x - state.y) * state.z) / denom, 0.0, 0.0);\n\t\t\t\n\t\t\td_state.z = -(d_state.x * d_state.y * sin(state.x - state.y) + 3.0 * sin(state.x)) / 2.0;\n\t\t\t\n\t\t\td_state.w = (d_state.x * d_state.y * sin(state.x - state.y) - sin(state.y)) / 2.0;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tstate = ((dt * d_state + state) / (3.14159265358 * 2.0)) + vec4(.5, .5, .5, .5);\n\t\t\t\n\t\t\tstate.xy = fract(state.xy);\n\t\t\t\n\t\t\tgl_FragColor = state;\n\t\t}\n\t"),o.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\t\n\t\t\n\t\tvec3 hsv2rgb(vec3 c)\n\t\t{\n\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));\n\t\t\t\n\t\t\tfloat h = atan(state.y, state.x) / 3.14159265258 + 1.0;\n\t\t\t\n\t\t\tfloat s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);\n\t\t\t\n\t\t\tfloat v_add = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));\n\t\t\t\n\t\t\tfloat v = min(sqrt(state.z * state.z + state.w * state.w) + v_add, 1.0);\n\t\t\t\n\t\t\tvec3 rgb = hsv2rgb(vec3(h, s, v));\n\t\t\t\n\t\t\tgl_FragColor = vec4(rgb, 1.0);\n\t\t}\n\t"),o.render.create_framebuffer_texture_pair(),o.render.create_framebuffer_texture_pair();let i=Page.element.querySelector("#resolution-input");Page.element.querySelector("#generate-button").addEventListener("click",()=>{a=!1,r=Site.applet_process_id,t=parseInt(i.value||1e3),o.change_canvas_size(t,t),o.gl.bindTexture(o.gl.TEXTURE_2D,o.render.framebuffers[0].texture),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,o.canvas_width,o.canvas_height,0,o.gl.RGBA,o.gl.FLOAT,null),o.gl.bindTexture(o.gl.TEXTURE_2D,o.render.framebuffers[1].texture),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,o.canvas_width,o.canvas_height,0,o.gl.RGBA,o.gl.FLOAT,null),o.gl.useProgram(o.render.shader_programs[0]),o.gl.bindTexture(o.gl.TEXTURE_2D,o.render.framebuffers[0].texture),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,o.render.framebuffers[0].framebuffer),o.render.draw_frame(),window.requestAnimationFrame(c),a=!0});let l=Page.element.querySelector("#switch-pendulum-drawer-canvas-button");function c(t){let e=t-M;M=t,0!==e&&(o.gl.useProgram(o.render.shader_programs[1]),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,o.render.framebuffers[1].framebuffer),o.render.draw_frame(),o.gl.useProgram(o.render.shader_programs[2]),o.gl.bindTexture(o.gl.TEXTURE_2D,o.render.framebuffers[1].texture),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),o.render.draw_frame(),o.gl.useProgram(o.render.shader_programs[1]),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,o.render.framebuffers[0].framebuffer),o.render.draw_frame(),o.gl.useProgram(o.render.shader_programs[2]),o.gl.bindTexture(o.gl.TEXTURE_2D,o.render.framebuffers[0].texture),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),o.render.draw_frame(),r===Site.applet_process_id?n||window.requestAnimationFrame(c):console.log("Terminated applet process"))}l.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",l.addEventListener("click",()=>{n?(P(),window.requestAnimationFrame(P),l.style.opacity=0,setTimeout(()=>{l.textContent="Pick Pendulum",l.style.opacity=1},250)):(n=!0,l.style.opacity=0,setTimeout(()=>{l.textContent="Return to Fractal",l.style.opacity=1},250))}),Page.element.querySelector("#download-button").addEventListener("click",()=>{o.download_frame("the-double-pendulum-fractal.png")});let u=2e3,d=0,h={renderer:"cpu",canvas_width:u,canvas_height:u,mousemove_callback:y,touchmove_callback:y,mousedown_callback:w,touchend_callback:w},g=new Wilson(Page.element.querySelector("#pendulum-drawer-canvas"),h),f=0,m=0,_=0,v=0,x=0,p=0,b=0,M=-1;function y(t,e,r,s,o){n&&(0===d&&function(){if(!a)return;n=!0,g.canvas.style.opacity=.5,d=1}(),2!==d&&(f=t*Math.PI,m=e*Math.PI,_=0,v=0,window.requestAnimationFrame(F)))}function w(t,e,n){1===d&&(p=f,b=m,_=0,v=0,x=0,function(){if(!a)return;g.canvas.style.opacity=1,d=2,window.requestAnimationFrame(F)}())}function P(){a&&(n=!1,window.requestAnimationFrame(c),g.canvas.style.opacity=0,d=0)}function F(t){let a=t-M;if(M=t,0===a)return;x++,g.ctx.fillRect(0,0,u,u);let n=f/Math.PI,r=m/Math.PI,s=_/Math.PI,o=v/Math.PI,i=Math.atan2(r,n)/Math.PI+1,l=Math.min(Math.min(50*(n*n+r*r),5*(1-Math.max(Math.abs(n),Math.abs(r)))),1),c=.9*((1-p/(2*Math.PI))*(1-p/(2*Math.PI))+(1-b/(2*Math.PI))*(1-b/(2*Math.PI)))*4,h=function(t,e,a){let n,r,s,o,i,l,c,u;switch(o=Math.floor(6*t),l=a*(1-e),c=a*(1-(i=6*t-o)*e),u=a*(1-(1-i)*e),o%6){case 0:n=a,r=u,s=l;break;case 1:n=c,r=a,s=l;break;case 2:n=l,r=a,s=u;break;case 3:n=l,r=c,s=a;break;case 4:n=u,r=l,s=a;break;case 5:n=a,r=l,s=c}return[Math.round(255*n),Math.round(255*r),Math.round(255*s)]}(i,l,Math.min(Math.pow(s*s+o*o,.5)+c,1));g.ctx.strokeStyle=`rgb(${h[0]}, ${h[1]}, ${h[2]})`,g.ctx.beginPath(),g.ctx.moveTo(u/2,u/2),g.ctx.lineTo(u/2+u/6*Math.sin(f),u/2+u/6*Math.cos(f)),g.ctx.stroke(),g.ctx.beginPath(),g.ctx.moveTo(u/2+(u/6-u/200)*Math.sin(f),u/2+(u/6-u/200)*Math.cos(f)),g.ctx.lineTo(u/2+u/6*Math.sin(f)+u/6*Math.sin(m),u/2+u/6*Math.cos(f)+u/6*Math.cos(m)),g.ctx.stroke(),2===d&&(!function(){let t=6*(2*_-3*Math.cos(f-m)*v)/(16-9*Math.pow(Math.cos(f-m),2)),a=6*(8*v-3*Math.cos(f-m)*_)/(16-9*Math.pow(Math.cos(f-m),2)),n=-(t*a*Math.sin(f-m)+3*Math.sin(f))/2,r=(t*a*Math.sin(f-m)-Math.sin(m))/2;m+=a*e*2.5,_+=n*e*2.5,v+=r*e*2.5,(f+=t*e*2.5)>=Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI);m>=Math.PI?m-=2*Math.PI:m<-Math.PI&&(m+=2*Math.PI)}(),window.requestAnimationFrame(F))}g.ctx.lineWidth=u/100,g.ctx.strokeStyle="rgb(127, 0, 255)",g.ctx.fillStyle="rgb(0, 0, 0)",g.draggables.container.addEventListener("mouseleave",()=>{(1===d||x<3)&&(g.canvas.style.opacity=0,d=0)})}();