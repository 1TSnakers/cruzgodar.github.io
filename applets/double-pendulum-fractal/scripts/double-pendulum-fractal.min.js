!function(){"use strict";let t=500,e=null,a=null,n=.01,o=!1,c=!1,i={renderer:"hybrid",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"},r=new Wilson(document.querySelector("#output-canvas"),i),s=document.querySelector("#resolution-input");document.querySelector("#generate-button").addEventListener("click",()=>{o=!1,function(){t=parseInt(s.value||500),a=new Array(t*t*2),e=new Uint8ClampedArray(t*t*4),r.change_canvas_size(t,t);for(let n=0;n<t/2;n++)for(let o=0;o<t;o++){let c=4*(t*n+o);e[c]=0,e[c+1]=0,e[c+2]=0,e[c+3]=255,a[c]=2*(o/t-.5)*Math.PI,a[c+1]=2*(n/t-.5)*Math.PI,a[c+2]=0,a[c+3]=0;let i=4*(t*(t-n-1)+(t-o-1));e[i]=0,e[i+1]=0,e[i+2]=0,e[i+3]=255}window.requestAnimationFrame(l),o=!0}()});let h=document.querySelector("#switch-pendulum-drawer-canvas-button");function l(o){let i=o-_;if(_=o,0!==i){for(let o=0;o<t/2;o++)for(let c=0;c<t;c++){let i=4*(t*o+c),r=6*(2*a[i+2]-3*Math.cos(a[i]-a[i+1])*a[i+3])/(16-9*Math.pow(Math.cos(a[i]-a[i+1]),2)),s=6*(8*a[i+3]-3*Math.cos(a[i]-a[i+1])*a[i+2])/(16-9*Math.pow(Math.cos(a[i]-a[i+1]),2)),h=-(r*s*Math.sin(a[i]-a[i+1])+3*Math.sin(a[i]))/2,l=(r*s*Math.sin(a[i]-a[i+1])-Math.sin(a[i+1]))/2;a[i]+=r*n,a[i+1]+=s*n,a[i+2]+=h*n,a[i+3]+=l*n;let u=a[i]/Math.PI,M=a[i+1]/Math.PI,d=a[i+2]/Math.PI,m=a[i+3]/Math.PI,w=Math.atan2(M,u)/Math.PI+1,f=Math.min(100*(u*u+M*M),1),p=.9*(1-4*((o/t-.5)*(o/t-.5)+(c/t-.5)*(c/t-.5))),y=q(w,f,Math.min(Math.pow(d*d+m*m,.5)+p,1));e[i]=y[0],e[i+1]=y[1],e[i+2]=y[2];let P=4*(t*(t-o-1)+(t-c-1));e[P]=y[0],e[P+1]=y[1],e[P+2]=y[2],e[P+3]=255}r.render.draw_frame(e),c||window.requestAnimationFrame(l)}}h.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",h.addEventListener("click",()=>{c?(x(),window.requestAnimationFrame(x),h.style.opacity=0,setTimeout(()=>{h.textContent="Pick Pendulum",h.style.opacity=1},250)):(c=!0,h.style.opacity=0,setTimeout(()=>{h.textContent="Return to Fractal",h.style.opacity=1},250))}),document.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("the-double-pendulum-fractal.png")});let u=2e3,M=0,d={renderer:"cpu",canvas_width:u,canvas_height:u,mousemove_callback:v,touchmove_callback:v,mousedown_callback:g,touchend_callback:g},m=new Wilson(document.querySelector("#pendulum-drawer-canvas"),d),w=0,f=0,p=0,y=0,P=0,I=0,b=0,_=-1;function v(t,e,a,n,i){c&&(0===M&&function(){if(!o)return;c=!0,m.canvas.style.opacity=.5,M=1}(),2!==M&&(w=t*Math.PI,f=e*Math.PI,p=0,y=0,window.requestAnimationFrame(k)))}function g(t,e,a){1===M&&(I=w,b=f,p=0,y=0,P=0,function(){if(!o)return;m.canvas.style.opacity=1,M=2,window.requestAnimationFrame(k)}())}function x(){o&&(c=!1,window.requestAnimationFrame(l),m.canvas.style.opacity=0,M=0)}function k(t){let e=t-_;if(_=t,0===e)return;P++,m.ctx.fillRect(0,0,u,u);let a=w/Math.PI,o=f/Math.PI,c=p/Math.PI,i=y/Math.PI,r=Math.atan2(o,a)/Math.PI+1,s=Math.min(Math.min(50*(a*a+o*o),5*(1-Math.max(Math.abs(a),Math.abs(o)))),1),h=.9*((1-I/(2*Math.PI))*(1-I/(2*Math.PI))+(1-b/(2*Math.PI))*(1-b/(2*Math.PI)))*4,l=q(r,s,Math.min(Math.pow(c*c+i*i,.5)+h,1));m.ctx.strokeStyle=`rgb(${l[0]}, ${l[1]}, ${l[2]})`,m.ctx.beginPath(),m.ctx.moveTo(u/2,u/2),m.ctx.lineTo(u/2+u/6*Math.sin(w),u/2+u/6*Math.cos(w)),m.ctx.stroke(),m.ctx.beginPath(),m.ctx.moveTo(u/2+(u/6-u/200)*Math.sin(w),u/2+(u/6-u/200)*Math.cos(w)),m.ctx.lineTo(u/2+u/6*Math.sin(w)+u/6*Math.sin(f),u/2+u/6*Math.cos(w)+u/6*Math.cos(f)),m.ctx.stroke(),2===M&&(!function(){let t=6*(2*p-3*Math.cos(w-f)*y)/(16-9*Math.pow(Math.cos(w-f),2)),e=6*(8*y-3*Math.cos(w-f)*p)/(16-9*Math.pow(Math.cos(w-f),2)),a=-(t*e*Math.sin(w-f)+3*Math.sin(w))/2,o=(t*e*Math.sin(w-f)-Math.sin(f))/2;f+=e*n*2.5,p+=a*n*2.5,y+=o*n*2.5,(w+=t*n*2.5)>=Math.PI?w-=2*Math.PI:w<-Math.PI&&(w+=2*Math.PI);f>=Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI)}(),window.requestAnimationFrame(k))}function q(t,e,a){let n,o,c,i,r,s,h,l;switch(s=a*(1-e),h=a*(1-(r=6*t-(i=Math.floor(6*t)))*e),l=a*(1-(1-r)*e),i%6){case 0:n=a,o=l,c=s;break;case 1:n=h,o=a,c=s;break;case 2:n=s,o=a,c=l;break;case 3:n=s,o=h,c=a;break;case 4:n=l,o=s,c=a;break;case 5:n=a,o=s,c=h}return[Math.round(255*n),Math.round(255*o),Math.round(255*c)]}m.ctx.lineWidth=u/100,m.ctx.strokeStyle="rgb(127, 0, 255)",m.ctx.fillStyle="rgb(0, 0, 0)",m.draggables.container.addEventListener("mouseleave",()=>{(1===M||P<3)&&(m.canvas.style.opacity=0,M=0)})}();