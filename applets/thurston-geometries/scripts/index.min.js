import{showPage}from"../../../scripts/src/loadPage.min.js";import{ThurstonGeometry,makeAnimation}from"./class.min.js";import{E3Rooms}from"./geometries/e3.min.js";import{H2xERooms}from"./geometries/h2xe.min.js";import{H3Rooms}from"./geometries/h3.min.js";import{NilRooms}from"./geometries/nil.min.js";import{E3S2Demo,S2xES2Demo}from"./geometries/s2.min.js";import{S2xERooms}from"./geometries/s2xe.min.js";import{S3Rooms}from"./geometries/s3.min.js";import{SL2RRooms}from"./geometries/sl2r.min.js";import{SolRooms}from"./geometries/sol.min.js";import{DownloadButton,ToggleButton}from"/scripts/src/buttons.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{currentlyTouchDevice}from"/scripts/src/interaction.min.js";import{equalizeAppletColumns}from"/scripts/src/layout.min.js";import{$,$$}from"/scripts/src/main.min.js";import{typesetMath}from"/scripts/src/math.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";export default function(){const s=new ThurstonGeometry({canvas:$("#output-canvas")}),e=new TextBox({element:$("#resolution-input"),name:"Resolution",value:500,minValue:100,maxValue:1e3,onInput:function(){s.needNewFrame=!0,s.changeResolution(e.value)}}),n=new Slider({element:$("#wall-thickness-slider"),name:"Wall Thickness",value:0,min:0,max:1,onInput:u}),t=new Slider({element:$("#fov-slider"),name:"FOV",value:100,min:80,max:120,snapPoints:[100],onInput:u}),o=new ToggleButton({element:$("#switch-scene-button"),name0:"Switch to Spheres",name1:"Switch to Rooms",onClick0:()=>s.switchScene(),onClick1:()=>s.switchScene()}),a=$("#demo-canvas"),r=$("#demo-canvas-container");let m;const l={s2:E3S2Demo,e3:E3Rooms,s3:S3Rooms,h3:H3Rooms,s2xe:S2xERooms,h2xe:H2xERooms,nil:NilRooms,sl2r:SL2RRooms,sol:SolRooms},i=new Dropdown({element:$("#geometries-dropdown"),name:"Geometries",options:{s2:"$S^2$",e3:"$\\mathbb{E}^3$",s3:"$S^3$",h3:"$\\mathbb{H}^3$",s2xe:"$S^2 \\times \\mathbb{E}$",h2xe:"$\\mathbb{H}^2 \\times \\mathbb{E}$",nil:"Nil",sl2r:"$\\widetilde{\\operatorname{SL}}(2, \\mathbb{R})$",sol:"Sol"},onInput:function(){o.state&&o.setState(0);c()}});function c(){s.setState("geometry",i.value||"s2");var e,t="#fov-slider, #download-button",o=($$(`.info-text:not(#${s.state.geometry}-text)`).forEach(element=>element.style.display="none"),$$(`#${s.state.geometry}-text`).forEach(element=>element.style.display="block"),l[s.state.geometry]);o===E3S2Demo?(s,$(".sliders").style.display="none",$$(".text-buttons")[1].style.display="none",e=new E3S2Demo,void 0===m?(m=new ThurstonGeometry({canvas:a}),$$(".wilson-enter-fullscreen-button")[1].remove()):(m.animationPaused=!1,m.drawFrame()),e.handleMovingCallback=(movingAmount,timeElapsed)=>{m.handleMoving(movingAmount,timeElapsed),m.needNewFrame=!0},s.run(e),s.restrictCamera=!1,s.wilson.worldCenterY=Math.PI/4.5,s.wilson.worldCenterX=3*Math.PI/4,(e=new S2xES2Demo).drawFrameCallback=()=>{s.geometryData.cameraDotPos=[...m.geometryData.cameraPos];for(let t=0;t<s.geometryData.numRays;t++){var e=(t-Math.floor(s.geometryData.numRays/2))/s.geometryData.numRays*1.87;[s.geometryData.rayDirs[t],s.geometryData.testVecs[t]]=ThurstonGeometry.rotateVectors(m.geometryData.forwardVec,m.geometryData.rightVec,e),[s.geometryData.rayLengths,s.geometryData.rayColors]=m.geometryData.getRayData(s.geometryData.rayDirs)}s.needNewFrame=!0},m.run(e),m.wilson.worldCenterX=Math.PI/4,r.style.display="",r.querySelector(".wilson-applet-canvas-container").style.setProperty("margin-top","4px","important")):(s.restrictCamera=!0,e=new o,o=Array.from(e.uiElementsUsed?$$(t+","+e.uiElementsUsed):$$(t)).map(element=>element.parentNode),t=Array.from(e.uiElementsUsed?$$(`
					.slider-container > input:not(${t}, ${e.uiElementsUsed}),
					.text-button:not(.dropdown, ${t}, ${e.uiElementsUsed})
				`):$$(`
					.slider-container > input:not(${t}),
					.text-button:not(.dropdown, ${t})
				`)).map(element=>element.parentNode),o.forEach(element=>element.style.display=""),$(".sliders").style.display="","sl2r"===s.state.geometry?$$(".text-buttons")[1].style.display="none":$$(".text-buttons")[1].style.display="",t.forEach(element=>element.style.display="none"),setTimeout(()=>equalizeAppletColumns(),0),r.style.display="none",m&&(m.animationPaused=!0),e.wallThicknessData&&(n.setBounds({min:e.wallThicknessData[1],max:e.wallThicknessData[2]}),n.setValue(e.wallThicknessData[0]),e.sliderValues.wallThickness=e.wallThicknessData[0]),s.run(e))}function u(){s.geometryData.sliderValues.wallThickness=parseFloat(n.value),s.fov=Math.tan(t.value/2*Math.PI/180),s.needNewFrame=!0}s.initState(),s.state.geometry&&i.setValue(s.state.geometry),typesetMath().then(()=>{setTimeout(()=>{s.state.geometry&&i.setValue(s.state.geometry)},100)}),$(currentlyTouchDevice?"#controls-text-wasd":"#controls-text-touch").remove(),$$(".slider-container").forEach(element=>element.style.display="none"),new DownloadButton({element:$("#download-button"),wilson:s.wilson,filename:"a-thurston-geometry.png"}),makeAnimation||c(),showPage()}