import{showPage}from"../../../scripts/src/loadPage.min.js";import{ThurstonGeometry}from"./class.min.js";import{E3Axes,E3Rooms}from"./geometries/e3.min.js";import{H2xEAxes,H2xERooms}from"./geometries/h2xe.min.js";import{H3Axes,H3Rooms,H3Spheres}from"./geometries/h3.min.js";import{NilAxes,NilRooms}from"./geometries/nil.min.js";import{E3S2Demo,S2xES2Demo}from"./geometries/s2.min.js";import{S2xEAxes,S2xERooms}from"./geometries/s2xe.min.js";import{S3Axes,S3HopfFibration,S3Rooms}from"./geometries/s3.min.js";import{SL2RAxes,SL2RRooms}from"./geometries/sl2r.min.js";import{SolAxes,SolRooms}from"./geometries/sol.min.js";import anime from"/scripts/anime.min.js";import{DownloadButton,ToggleButton}from"/scripts/src/buttons.min.js";import{currentlyTouchDevice}from"/scripts/src/interaction.min.js";import{equalizeAppletColumns}from"/scripts/src/layout.min.js";import{$,$$}from"/scripts/src/main.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";function load(){const r=new ThurstonGeometry({canvas:$("#output-canvas")}),e=new TextBox({element:$("#resolution-input"),name:"Resolution",value:500,maxValue:1e3,onInput:function(){r.needNewFrame=!0,r.changeResolution(e.value)}}),a=$("#demo-canvas"),n=$("#demo-canvas-container");let i;const m={s2:E3S2Demo,"e3-axes":E3Axes,e3:E3Rooms,"s3-axes":S3Axes,s3:S3Rooms,"s3-hopf-fibration":S3HopfFibration,"h3-axes":H3Axes,h3:H3Rooms,"h3-spheres":H3Spheres,"s2xe-axes":S2xEAxes,s2xe:S2xERooms,"h2xe-axes":H2xEAxes,h2xe:H2xERooms,"sl2r-axes":SL2RAxes,sl2r:SL2RRooms,"nil-axes":NilAxes,nil:NilRooms,"sol-axes":SolAxes,sol:SolRooms},l=$("#scene-selector-dropdown");function t(){var e,t="none"===l.value?"s2":l.value,o="#fov-slider, #download-button",s=($$(`.info-text:not(#${t}-text)`).forEach(element=>element.style.display="none"),$$(`#${t}-text`).forEach(element=>element.style.display="block"),m[t]);s===E3S2Demo?(r,$(".sliders").style.display="none",$$(".text-buttons")[1].style.display="none",e=new E3S2Demo,void 0===i?(i=new ThurstonGeometry({canvas:a}),$$(".wilson-enter-fullscreen-button")[1].remove()):(i.animationPaused=!1,i.drawFrame()),e.handleMovingCallback=(movingAmount,timeElapsed)=>{i.handleMoving(movingAmount,timeElapsed),i.needNewFrame=!0},r.run(e),r.restrictCamera=!1,r.wilson.worldCenterY=Math.PI/4.5,r.wilson.worldCenterX=3*Math.PI/4,(e=new S2xES2Demo).drawFrameCallback=()=>{r.geometryData.cameraDotPos=[...i.geometryData.cameraPos];for(let t=0;t<r.geometryData.numRays;t++){var e=(t-Math.floor(r.geometryData.numRays/2))/r.geometryData.numRays*1.87;[r.geometryData.rayDirs[t],r.geometryData.testVecs[t]]=ThurstonGeometry.rotateVectors(i.geometryData.forwardVec,i.geometryData.rightVec,e),[r.geometryData.rayLengths,r.geometryData.rayColors]=i.geometryData.getRayData(r.geometryData.rayDirs)}r.needNewFrame=!0},i.run(e),i.wilson.worldCenterX=Math.PI/4,n.style.display="",n.querySelector(".wilson-applet-canvas-container").style.setProperty("margin-top","4px","important")):(r.restrictCamera=!0,e=new s,s=Array.from(e.uiElementsUsed?$$(o+","+e.uiElementsUsed):$$(o)).map(element=>element.parentNode),o=Array.from(e.uiElementsUsed?$$(`
					.slider-container > input:not(${o}, ${e.uiElementsUsed}),
					.text-button:not(.dropdown, ${o}, ${e.uiElementsUsed})
				`):$$(`
					.slider-container > input:not(${o}),
					.text-button:not(.dropdown, ${o})
				`)).map(element=>element.parentNode),s.forEach(element=>element.style.display=""),$(".sliders").style.display="",$$(".text-buttons")[1].style.display="h3"===t||"h2xe"===t||"sl2r"===t?"none":"",o.forEach(element=>element.style.display="none"),setTimeout(()=>equalizeAppletColumns(),0),n.style.display="none",i&&(i.animationPaused=!0),r.run(e),e.initUI())}l.addEventListener("input",t),window.DEBUG||$$("[data-option-name$=axes], [data-option-name=s3-hopf-fibration]").forEach(element=>element.style.display="none"),$(currentlyTouchDevice?"#controls-text-wasd":"#controls-text-touch").remove();const o={wallThickness:[$("#wall-thickness-slider"),$("#wall-thickness-slider-value")],fiberThickness:[$("#fiber-thickness-slider"),$("#fiber-thickness-slider-value")]};for(const u in o)o[u][0].addEventListener("input",()=>{r.geometryData.sliderValues[u]=parseFloat(o[u][1].textContent),r.needNewFrame=!0});var s=$("#fov-slider");const c=$("#fov-slider-value");function d(){var e=0===r.geometryData.sliderValues.sceneTransition;const t=r.geometryData.sliderValues.sceneTransition,o=e?1:0,s=[...r.geometryData.cameraPos],a=o?r.geometryData.getNearestCorner():r.geometryData.getNearestCenter(),n={t:0};anime({targets:n,t:1,duration:500,easing:"easeInOutSine",update:()=>{r.geometryData.cameraPos=r.geometryData.correctPosition([(1-n.t)*s[0]+n.t*a[0],(1-n.t)*s[1]+n.t*a[1],(1-n.t)*s[2]+n.t*a[2],(1-n.t)*s[3]+n.t*a[3]]),r.geometryData.normalVec=r.geometryData.getNormalVec(r.geometryData.cameraPos),r.geometryData.correctVectors(),r.needNewFrame=!0}}),anime({targets:n,t:1,duration:500,easing:"easeInOutQuad",update:()=>{r.geometryData.sliderValues.sceneTransition=(1-n.t)*t+n.t*o}}),anime({targets:r.geometryData.cameraPos,duration:500,easing:"easeInOutSine"})}s.addEventListener("input",()=>{r.fov=Math.tan(parseFloat(c.textContent)/2*Math.PI/180),r.needNewFrame=!0}),$$(".slider-container").forEach(element=>element.style.display="none"),new ToggleButton({element:$("#switch-scene-button"),name0:"Switch to Spheres",name1:"Switch to Rooms",onClick0:d,onClick1:d}),new DownloadButton({element:$("#download-button"),wilson:r.wilson,filename:"a-thurston-geometry.png"}),t(),showPage()}export{load};