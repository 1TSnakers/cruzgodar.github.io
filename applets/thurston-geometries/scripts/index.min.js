import{showPage}from"../../../scripts/src/loadPage.min.js";import{ThurstonGeometry,makeAnimation,rotateVectors}from"./class.min.js";import{E3Rooms}from"./geometries/e3.min.js";import{H2xERooms}from"./geometries/h2xe.min.js";import{H3Rooms}from"./geometries/h3.min.js";import{NilRooms}from"./geometries/nil.min.js";import{E3S2Demo,S2xES2Demo}from"./geometries/s2.min.js";import{S2xERooms}from"./geometries/s2xe.min.js";import{S3Rooms}from"./geometries/s3.min.js";import{SL2RRooms}from"./geometries/sl2r.min.js";import{SolRooms}from"./geometries/sol.min.js";import{DownloadButton,ToggleButton}from"/scripts/src/buttons.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{equalizeAppletColumns}from"/scripts/src/layout.min.js";import{$,$$}from"/scripts/src/main.min.js";import{typesetMath}from"/scripts/src/math.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";export default function(){const a=new ThurstonGeometry({canvas:$("#output-canvas")}),e=new TextBox({element:$("#resolution-input"),name:"Resolution",value:500,minValue:100,maxValue:1e3,onInput:function(){a.needNewFrame=!0,a.changeResolution(e.value*siteSettings.resolutionMultiplier)}}),n=new Slider({element:$("#wall-thickness-slider"),name:"Wall Thickness",value:0,min:0,max:1,onInput:u}),r=new Slider({element:$("#clip-distance-slider"),name:"Clip Distance",value:0,min:0,max:10,onInput:u}),t=new Slider({element:$("#fov-slider"),name:"FOV",value:100,min:80,max:120,snapPoints:[100],onInput:u}),o=new ToggleButton({element:$("#switch-scene-button"),name0:"Switch to Spheres",name1:"Switch to Rooms",onClick0:()=>a.switchScene(),onClick1:()=>a.switchScene()}),m=$("#demo-canvas"),l=$("#demo-canvas-container");let i;const p={s2:E3S2Demo,e3:E3Rooms,s3:S3Rooms,h3:H3Rooms,s2xe:S2xERooms,h2xe:H2xERooms,nil:NilRooms,sl2r:SL2RRooms,sol:SolRooms},c=new Dropdown({element:$("#geometries-dropdown"),name:"Geometries",options:{s2:"$S^2$",e3:"$\\mathbb{E}^3$",s3:"$S^3$",h3:"$\\mathbb{H}^3$",s2xe:"$S^2 \\times \\mathbb{E}$",h2xe:"$\\mathbb{H}^2 \\times \\mathbb{E}$",nil:"Nil",sl2r:"$\\widetilde{\\operatorname{SL}}(2, \\mathbb{R})$",sol:"Sol"},onInput:function(){o.state&&o.setState(0);s()}});function s(){var e,t=c.value||"s2",o="#fov-slider, #download-button",s=($$(`.info-text:not(#${t}-text)`).forEach(element=>element.style.display="none"),$$(`#${t}-text`).forEach(element=>element.style.display="block"),p[t]);s===E3S2Demo?(a,$(".sliders").style.display="none",$$(".text-buttons")[1].style.display="none",e=new E3S2Demo,void 0===i?((i=new ThurstonGeometry({canvas:m})).allowFullscreenWithKeyboard=!1,$$(".wilson-enter-fullscreen-button")[1].remove()):(i.animationPaused=!1,i.drawFrame()),e.handleMovingCallback=(movingAmount,timeElapsed)=>{i.handleMoving(movingAmount,timeElapsed),i.needNewFrame=!0},a.run(e),a.restrictCamera=!1,a.wilson.worldCenterY=Math.PI/4.5,a.wilson.worldCenterX=3*Math.PI/4,(e=new S2xES2Demo).drawFrameCallback=()=>{a.geometryData.cameraDotPos=[...i.geometryData.cameraPos];for(let t=0;t<a.geometryData.numRays;t++){var e=(t-Math.floor(a.geometryData.numRays/2))/a.geometryData.numRays*1.87;[a.geometryData.rayDirs[t],a.geometryData.testVecs[t]]=rotateVectors(i.geometryData.forwardVec,i.geometryData.rightVec,e),[a.geometryData.rayLengths,a.geometryData.rayColors]=i.geometryData.getRayData(a.geometryData.rayDirs)}a.needNewFrame=!0},i.run(e),i.wilson.worldCenterX=Math.PI/4,l.style.display="",l.querySelector(".wilson-applet-canvas-container").style.setProperty("margin-top","4px","important")):(a.restrictCamera=!0,e=new s,s=Array.from(e.uiElementsUsed?$$(o+","+e.uiElementsUsed):$$(o)).map(element=>element.parentNode),o=Array.from(e.uiElementsUsed?$$(`
					.slider-container > input:not(${o}, ${e.uiElementsUsed}),
					.text-button:not(.dropdown, ${o}, ${e.uiElementsUsed})
				`):$$(`
					.slider-container > input:not(${o}),
					.text-button:not(.dropdown, ${o})
				`)).map(element=>element.parentNode),s.forEach(element=>element.style.display=""),$(".sliders").style.display="",$$(".text-buttons")[1].style.display="sl2r"===t?"none":"",o.forEach(element=>element.style.display="none"),setTimeout(()=>equalizeAppletColumns(),0),l.style.display="none",i&&(i.animationPaused=!0),e.wallThicknessData&&(n.setBounds({min:e.wallThicknessData[1],max:e.wallThicknessData[2]}),n.setValue(e.wallThicknessData[0]),e.sliderValues.wallThickness=e.wallThicknessData[0]),e.maxClipDistance&&(console.log(e.maxClipDistance),r.setBounds({min:0,max:e.maxClipDistance}),r.setValue(Math.min(e.maxClipDistance,r.value)),e.sliderValues.clipDistance=r.value),a.run(e))}function u(){a.geometryData.sliderValues.wallThickness=parseFloat(n.value),a.geometryData.sliderValues.clipDistance=parseFloat(r.value),a.fov=Math.tan(t.value/2*Math.PI/180),a.needNewFrame=!0}typesetMath(),$$(".slider-container").forEach(element=>element.style.display="none"),new DownloadButton({element:$("#download-button"),applet:a,filename:"a-thurston-geometry.png"}),makeAnimation||s(),showPage()}