import{ThurstonGeometries,rotateVectors}from"./class.min.js";import{E3Rooms}from"./geometries/e3.min.js";import{H2xERooms}from"./geometries/h2xe.min.js";import{H3Rooms}from"./geometries/h3.min.js";import{NilRooms}from"./geometries/nil.min.js";import{E3S2Demo,S2xES2Demo}from"./geometries/s2.min.js";import{S2xERooms}from"./geometries/s2xe.min.js";import{S3Rooms}from"./geometries/s3.min.js";import{SL2RRooms}from"./geometries/sl2r.min.js";import{SolRooms}from"./geometries/sol.min.js";import{DownloadButton,ToggleButton}from"/scripts/src/buttons.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{equalizeAppletColumns}from"/scripts/src/layout.min.js";import{$,$$}from"/scripts/src/main.min.js";import{typesetMath}from"/scripts/src/math.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";export default function(){const l=new ThurstonGeometries({canvas:$("#output-canvas")}),e=new TextBox({element:$("#resolution-input"),name:"Resolution",value:500,minValue:100,maxValue:1e3,onInput:function(){l.needNewFrame=!0,l.wilson.resizeCanvas({width:e.value*siteSettings.resolutionMultiplier})}}),m=new Slider({element:$("#wall-thickness-slider"),name:"Wall Thickness",value:0,min:0,max:1,onInput:n}),p=new Slider({element:$("#clip-distance-slider"),name:"Clip Distance",value:0,min:0,max:10,onInput:n}),t=new Slider({element:$("#fov-slider"),name:"FOV",value:100,min:80,max:120,snapPoints:[100],onInput:n}),o=new ToggleButton({element:$("#switch-scene-button"),name0:"Switch to Spheres",name1:"Switch to Rooms",onClick0:instant=>setTimeout(()=>l.switchScene({duration:instant?0:500}),instant?100:0),onClick1:instant=>setTimeout(()=>l.switchScene({duration:instant?0:500}),instant?100:0)}),c=$("#demo-canvas"),u=$("#demo-canvas-container");let d;const y={s2:E3S2Demo,e3:E3Rooms,s3:S3Rooms,h3:H3Rooms,s2xe:S2xERooms,h2xe:H2xERooms,nil:NilRooms,sl2r:SL2RRooms,sol:SolRooms},w=new Dropdown({element:$("#geometries-dropdown"),name:"Geometries",options:{s2:"$S^2$",e3:"$\\mathbb{E}^3$",s3:"$S^3$",h3:"$\\mathbb{H}^3$",s2xe:"$S^2 \\times \\mathbb{E}$",h2xe:"$\\mathbb{H}^2 \\times \\mathbb{E}$",nil:"Nil",sl2r:"$\\widetilde{\\operatorname{SL}}(2, \\mathbb{R})$",sol:"Sol"},onInput:function(fromOnClickHandler){o.state&&fromOnClickHandler&&o.setState({newState:!1});s()}});function s(){var e=w.value||"s2",t="#fov-slider, #download-button";for(const n of $$(`.info-text:not(#${e}-text)`))n.style.display="none";for(const a of $$(`#${e}-text`))a.style.display="block";var o=y[e];if(o===E3S2Demo)l,$(".sliders").style.display="none",$$(".text-buttons")[1].style.display="none",s=new E3S2Demo,u.style.display="",void 0===d?((d=new ThurstonGeometries({canvas:c})).allowFullscreenWithKeyboard=!1,$$(".WILSON_enter-fullscreen-button")[1].remove(),setTimeout(()=>{$$(".wilson-help-button")[1].remove()},50)):(d.animationPaused=!1,d.needNewFrame=!0,d.drawFrame()),s.handleMovingCallback=(movingAmount,timeElapsed)=>{d.handleMoving(movingAmount,timeElapsed),d.needNewFrame=!0},l.run(s),l.restrictCamera=!1,l.wilson.resizeWorld({centerX:3*Math.PI/4,centerY:Math.PI/4.5}),(s=new S2xES2Demo).drawFrameCallback=()=>{l.geometryData.cameraDotPos=[...d.geometryData.cameraPos];for(let t=0;t<l.geometryData.numRays;t++){var e=(t-Math.floor(l.geometryData.numRays/2))/l.geometryData.numRays*1.87;[l.geometryData.rayDirs[t],l.geometryData.testVecs[t]]=rotateVectors(d.geometryData.forwardVec,d.geometryData.rightVec,e),[l.geometryData.rayLengths,l.geometryData.rayColors]=d.geometryData.getRayData(l.geometryData.rayDirs)}l.needNewFrame=!0},d.run(s),d.wilson.resizeWorld({centerX:Math.PI/4}),u.style.display="",u.querySelector(".WILSON_applet-container").style.setProperty("margin-top","4px","important");else{l.restrictCamera=!0;var s=new o,o=Array.from(s.uiElementsUsed?$$(t+","+s.uiElementsUsed):$$(t)).map(element=>element.parentNode),t=Array.from(s.uiElementsUsed?$$(`
					.slider-container > input:not(${t}, ${s.uiElementsUsed}),
					.text-button:not(.dropdown, ${t}, ${s.uiElementsUsed})
				`):$$(`
					.slider-container > input:not(${t}),
					.text-button:not(.dropdown, ${t})
				`)).map(element=>element.parentNode);for(const r of o)r.style.display="";$(".sliders").style.display="",$$(".text-buttons")[1].style.display="sl2r"===e?"none":"";for(const i of t)i.style.display="none";setTimeout(()=>equalizeAppletColumns(),0),u.style.display="none",d&&(d.animationPaused=!0),s.wallThicknessData&&(m.setBounds({min:s.wallThicknessData[1],max:s.wallThicknessData[2]}),m.setValue(s.wallThicknessData[0]),s.sliderValues.wallThickness=s.wallThicknessData[0]),s.maxClipDistance&&(p.setBounds({min:0,max:s.maxClipDistance}),p.setValue(Math.min(s.maxClipDistance,p.value)),s.sliderValues.clipDistance=parseFloat(p.value)),l.run(s)}}typesetMath();for(const a of $$(".slider-container"))a.style.display="none";function n(){l.geometryData.sliderValues.wallThickness=parseFloat(m.value),l.geometryData.sliderValues.clipDistance=parseFloat(p.value),l.fov=Math.tan(t.value/2*Math.PI/180),l.needNewFrame=!0}new DownloadButton({element:$("#download-button"),applet:l,filename:()=>"a-thurston-geometry.png"}),s()}