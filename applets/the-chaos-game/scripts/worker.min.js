"use strict";onmessage=async function(e){num_vertices=e.data[0],grid_size=e.data[1],await draw_chaos_game()};let num_vertices=null,grid_size=null,image=[],vertices=[],center_row=null,center_col=null,current_row=null,current_col=null,num_pixels_at_max=0;function draw_chaos_game(){return new Promise((e,r)=>{image=new Uint8ClampedArray(grid_size*grid_size*4);for(let e=0;e<grid_size;e++)for(let r=0;r<grid_size;r++)image[4*(grid_size*e+r)]=0,image[4*(grid_size*e+r)+1]=0,image[4*(grid_size*e+r)+2]=0,image[4*(grid_size*e+r)+3]=255;let i=2*Math.floor(num_vertices/2)*Math.PI/num_vertices,t=grid_size/2-grid_size/2.5,_=grid_size/2-grid_size/2.5*Math.cos(i),s=t+(grid_size-_);center_row=Math.floor(s/2+grid_size/2.5),center_col=Math.floor(grid_size/2),current_row=center_row,current_col=center_col,vertices=[];for(let e=0;e<num_vertices;e++){let r=e/num_vertices*2*Math.PI,i=Math.floor(-Math.cos(r)*grid_size/2.5+center_row),t=Math.floor(Math.sin(r)*grid_size/2.5+center_col);vertices.push([i,t])}let a=0;for(;;){a%(100*grid_size)==0&&postMessage([image]);let r=Math.floor(Math.random()*num_vertices);current_row=Math.floor((current_row+vertices[r][0])/2),current_col=Math.floor((current_col+vertices[r][1])/2);let i=HSVtoRGB((Math.atan2(current_col-grid_size/2,current_row-grid_size/2)+Math.PI)/(2*Math.PI),((current_row-grid_size/2)*(current_row-grid_size/2)+(current_col-grid_size/2)*(current_col-grid_size/2))/(grid_size*grid_size/13),1);i[0]/=255,i[1]/=255,i[2]/=255;for(let r=0;r<3;r++)if(image[4*(grid_size*current_row+current_col)+r]+=8*i[r],image[4*(grid_size*current_row+current_col)+r]>=255&&(num_pixels_at_max++,image[4*(grid_size*current_row+current_col)+r]=255,num_pixels_at_max/(grid_size*grid_size)>.004))return postMessage([image]),void e();a++}postMessage([image]),e()})}function HSVtoRGB(e,r,i){let t,_,s,a,c,o,n,g;switch(o=i*(1-r),n=i*(1-(c=6*e-(a=Math.floor(6*e)))*r),g=i*(1-(1-c)*r),a%6){case 0:t=i,_=g,s=o;break;case 1:t=n,_=i,s=o;break;case 2:t=o,_=i,s=g;break;case 3:t=o,_=n,s=i;break;case 4:t=g,_=o,s=i;break;case 5:t=i,_=o,s=n}return[Math.round(255*t),Math.round(255*_),Math.round(255*s)]}