!function(){"use strict";let e=new Wilson(document.querySelector("#output-canvas"),{renderer:"cpu",canvas_width:1e3,canvas_height:1e3,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"}),t=!0,l=!0,n=!1,r=null,o=null,c=null,i=null,u=[],a=[],s=[],d=[],f=[],h=0,g=0,x=[],p=1,k=1,y=0,m=null;document.querySelector("#generate-button").addEventListener("click",E);let b=document.querySelector("#resolution-input"),w=document.querySelector("#grid-size-input"),v=document.querySelector("#row-prob-input"),_=document.querySelector("#col-prob-input");b.addEventListener("keydown",e=>{13===e.keyCode&&E()}),w.addEventListener("keydown",e=>{13===e.keyCode&&E()}),v.addEventListener("keydown",e=>{13===e.keyCode&&E()}),_.addEventListener("keydown",e=>{13===e.keyCode&&E()});let S=document.querySelector("#toggle-draw-boundaries-checkbox"),q=document.querySelector("#toggle-draw-regions-checkbox"),A=document.querySelector("#toggle-maximum-speed-checkbox");function E(){r=parseInt(b.value||2e3),o=parseInt(w.value||50),c=parseFloat(v.value||.5),i=parseFloat(_.value||.5),e.change_canvas_size(r,r),e.ctx.fillStyle="rgb(0, 0, 0)",e.ctx.fillRect(0,0,r,r),e.ctx.strokeStyle="rgb(127, 127, 127)",m=r/o/20,e.ctx.lineWidth=m,t=S.checked,l=q.checked,n=A.checked,u=new Array(o+1),a=new Array(o+1),s=new Array(o),d=[],f=[],h=0,x=new Array(o+1);for(let e=0;e<o+1;e++){u[e]=new Array(o+1),a[e]=new Array(o+1);for(let t=0;t<o+1;t++)u[e][t]=0,a[e][t]=0}for(let e=0;e<o;e++){s[e]=new Array(o);for(let t=0;t<o;t++)s[e][t]=-1}for(let e=0;e<o+1;e++)x[e]=[];let E=Math.floor(o/2);for(let e=0;e<o;e++)for(let t=0;t<o;t++)x[Math.abs(e-E)+Math.abs(t-E)].push([e,t]);for(let e=0;e<o+1;e++){let t=0;Math.random()<c&&(t=1);for(let l=t;l<o;l+=2)u[e][l]=1}for(let e=0;e<o+1;e++){let t=0;Math.random()<i&&(t=1);for(let l=t;l<o;l+=2)a[l][e]=1}n?(t&&function(){for(let t=1;t<o;t++)for(let l=0;l<o;l++)u[t][l]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*l,r/o*t),e.ctx.lineTo(r/o*(l+1),r/o*t),e.ctx.stroke());for(let t=0;t<o;t++)for(let l=1;l<o;l++)a[t][l]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*l,r/o*t),e.ctx.lineTo(r/o*l,r/o*(t+1)),e.ctx.stroke())}(),l&&(T(),function(){e.ctx.fillStyle="rgb(0, 0, 0)",e.ctx.fillRect(0,0,r,r);for(let t=0;t<h;t++){let l=d[t].length,n=t%(2*o)/(2*o),c=Math.sqrt(f.indexOf(l)/(g-2));1===l&&(c=.5);let i=e.utils.hsv_to_rgb(n,1,c);e.ctx.fillStyle=`rgb(${i[0]}, ${i[1]}, ${i[2]})`;for(let n=0;n<l;n++){let l=d[t][n][0],c=d[t][n][1];e.ctx.fillRect(r/o*c+m/2,r/o*l+m/2,r/o-m,r/o-m)}}}())):t?(p=1,k=1,L()):l&&(T(),y=0,F())}function L(){for(let t=0;t<o;t++)u[p][t]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*t,r/o*p),e.ctx.lineTo(r/o*(t+1),r/o*p),e.ctx.stroke());++p<o?window.requestAnimationFrame(L):window.requestAnimationFrame(M)}function M(){for(let t=0;t<o;t++)a[t][k]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*k,r/o*t),e.ctx.lineTo(r/o*k,r/o*(t+1)),e.ctx.stroke());++k<o?window.requestAnimationFrame(M):l&&(T(),y=0,F())}function T(){let e=0,t=0;for(;;){let l=[[e,t]];for(s[e][t]=h,d.push([[e,t]]);0!==l.length;){let e=l.length;for(let t=0;t<e;t++){let e=l[t][0],n=l[t][1];e>0&&-1===s[e-1][n]&&!u[e][n]&&(l.push([e-1,n]),s[e-1][n]=h,d[h].push([e-1,n])),e<o-1&&-1===s[e+1][n]&&!u[e+1][n]&&(l.push([e+1,n]),s[e+1][n]=h,d[h].push([e+1,n])),n>0&&-1===s[e][n-1]&&!a[e][n]&&(l.push([e,n-1]),s[e][n-1]=h,d[h].push([e,n-1])),n<o-1&&-1===s[e][n+1]&&!a[e][n+1]&&(l.push([e,n+1]),s[e][n+1]=h,d[h].push([e,n+1]))}l.splice(0,e)}f.push(d[h].length);let n=!1;for(let l=0;l<=o;l++){for(let r=0;r<x[l].length;r++){let o=x[l][r][0],c=x[l][r][1];if(-1===s[o][c]){e=o,t=c,n=!0;break}}if(n)break}if(h++,!n)break}(f=[...new Set(f)]).sort((e,t)=>t-e),g=f.length}function F(){for(let t=0;t<Math.ceil(o/50);t++){let t=d[y].length,l=y%(2*o)/(2*o),n=Math.sqrt(f.indexOf(t)/(g-2));1===t&&(n=.5);let c=e.utils.hsv_to_rgb(l,1,n);e.ctx.fillStyle="rgb(0, 0, 0)";for(let l=0;l<t;l++){let t=d[y][l][0],n=d[y][l][1];e.ctx.fillRect(r/o*n,r/o*t,r/o,r/o)}e.ctx.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`;for(let l=0;l<t;l++){let t=d[y][l][0],n=d[y][l][1];e.ctx.fillRect(r/o*n+m/2,r/o*t+m/2,r/o-m,r/o-m)}if(++y===h)return}y<h&&window.requestAnimationFrame(F)}S.checked=!0,S.addEventListener("input",()=>{S.checked||q.checked||(q.checked=!0)}),q.addEventListener("input",()=>{S.checked||q.checked||(S.checked=!0)}),document.querySelector("#download-button").addEventListener("click",()=>{e.download_frame("a-hitomezashi-pattern.png")})}();