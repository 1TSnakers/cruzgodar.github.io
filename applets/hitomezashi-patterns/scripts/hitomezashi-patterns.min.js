!function(){"use strict";let e=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"cpu",canvas_width:1e3,canvas_height:1e3,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"}),t=!0,l=!0,n=!1,r=null,o=null,c=null,a=null,i=[],u=[],s=[],f=[],h=[],d=0,g=0,x=[],p=1,k=1,y=0,m=null;Page.element.querySelector("#generate-button").addEventListener("click",A);let b=Page.element.querySelector("#resolution-input"),w=Page.element.querySelector("#grid-size-input"),v=Page.element.querySelector("#row-prob-input"),_=Page.element.querySelector("#col-prob-input");b.addEventListener("keydown",e=>{13===e.keyCode&&A()}),w.addEventListener("keydown",e=>{13===e.keyCode&&A()}),v.addEventListener("keydown",e=>{13===e.keyCode&&A()}),_.addEventListener("keydown",e=>{13===e.keyCode&&A()});let S=Page.element.querySelector("#toggle-draw-boundaries-checkbox"),q=Page.element.querySelector("#toggle-draw-regions-checkbox"),P=Page.element.querySelector("#toggle-maximum-speed-checkbox");function A(){r=parseInt(b.value||2e3),o=parseInt(w.value||50),c=parseFloat(v.value||.5),a=parseFloat(_.value||.5),e.change_canvas_size(r,r),e.ctx.fillStyle="rgb(0, 0, 0)",e.ctx.fillRect(0,0,r,r),e.ctx.strokeStyle="rgb(127, 127, 127)",m=r/o/20,e.ctx.lineWidth=m,t=S.checked,l=q.checked,n=P.checked,i=new Array(o+1),u=new Array(o+1),s=new Array(o),f=[],h=[],d=0,x=new Array(o+1);for(let e=0;e<o+1;e++){i[e]=new Array(o+1),u[e]=new Array(o+1);for(let t=0;t<o+1;t++)i[e][t]=0,u[e][t]=0}for(let e=0;e<o;e++){s[e]=new Array(o);for(let t=0;t<o;t++)s[e][t]=-1}for(let e=0;e<o+1;e++)x[e]=[];let A=Math.floor(o/2);for(let e=0;e<o;e++)for(let t=0;t<o;t++)x[Math.abs(e-A)+Math.abs(t-A)].push([e,t]);for(let e=0;e<o+1;e++){let t=0;Math.random()<c&&(t=1);for(let l=t;l<o;l+=2)i[e][l]=1}for(let e=0;e<o+1;e++){let t=0;Math.random()<a&&(t=1);for(let l=t;l<o;l+=2)u[l][e]=1}n?(t&&function(){for(let t=1;t<o;t++)for(let l=0;l<o;l++)i[t][l]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*l,r/o*t),e.ctx.lineTo(r/o*(l+1),r/o*t),e.ctx.stroke());for(let t=0;t<o;t++)for(let l=1;l<o;l++)u[t][l]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*l,r/o*t),e.ctx.lineTo(r/o*l,r/o*(t+1)),e.ctx.stroke())}(),l&&(L(),function(){e.ctx.fillStyle="rgb(0, 0, 0)",e.ctx.fillRect(0,0,r,r);for(let t=0;t<d;t++){let l=f[t].length,n=t%(2*o)/(2*o),c=Math.sqrt(h.indexOf(l)/(g-2));1===l&&(c=.5);let a=e.utils.hsv_to_rgb(n,1,c);e.ctx.fillStyle=`rgb(${a[0]}, ${a[1]}, ${a[2]})`;for(let n=0;n<l;n++){let l=f[t][n][0],c=f[t][n][1];e.ctx.fillRect(r/o*c+m/2,r/o*l+m/2,r/o-m,r/o-m)}}}())):t?(p=1,k=1,T()):l&&(L(),y=0,M())}function T(){for(let t=0;t<o;t++)i[p][t]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*t,r/o*p),e.ctx.lineTo(r/o*(t+1),r/o*p),e.ctx.stroke());++p<o?window.requestAnimationFrame(T):window.requestAnimationFrame(E)}function E(){for(let t=0;t<o;t++)u[t][k]&&(e.ctx.beginPath(),e.ctx.moveTo(r/o*k,r/o*t),e.ctx.lineTo(r/o*k,r/o*(t+1)),e.ctx.stroke());++k<o?window.requestAnimationFrame(E):l&&(L(),y=0,setTimeout(M,1e3))}function L(){let e=0,t=0;for(;;){let l=[[e,t]];for(s[e][t]=d,f.push([[e,t]]);0!==l.length;){let e=l.length;for(let t=0;t<e;t++){let e=l[t][0],n=l[t][1];e>0&&-1===s[e-1][n]&&!i[e][n]&&(l.push([e-1,n]),s[e-1][n]=d,f[d].push([e-1,n])),e<o-1&&-1===s[e+1][n]&&!i[e+1][n]&&(l.push([e+1,n]),s[e+1][n]=d,f[d].push([e+1,n])),n>0&&-1===s[e][n-1]&&!u[e][n]&&(l.push([e,n-1]),s[e][n-1]=d,f[d].push([e,n-1])),n<o-1&&-1===s[e][n+1]&&!u[e][n+1]&&(l.push([e,n+1]),s[e][n+1]=d,f[d].push([e,n+1]))}l.splice(0,e)}h.push(f[d].length);let n=!1;for(let l=0;l<=o;l++){for(let r=0;r<x[l].length;r++){let o=x[l][r][0],c=x[l][r][1];if(-1===s[o][c]){e=o,t=c,n=!0;break}}if(n)break}if(d++,!n)break}(h=[...new Set(h)]).sort((e,t)=>t-e),g=h.length}function M(){for(let t=0;t<Math.ceil(o/50);t++){let t=f[y].length,l=y%(2*o)/(2*o),n=Math.sqrt(h.indexOf(t)/(g-2));1===t&&(n=.5);let c=e.utils.hsv_to_rgb(l,1,n);e.ctx.fillStyle="rgb(0, 0, 0)";for(let l=0;l<t;l++){let t=f[y][l][0],n=f[y][l][1];e.ctx.fillRect(r/o*n,r/o*t,r/o,r/o)}e.ctx.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`;for(let l=0;l<t;l++){let t=f[y][l][0],n=f[y][l][1];e.ctx.fillRect(r/o*n+m/2,r/o*t+m/2,r/o-m,r/o-m)}if(++y===d)return}y<d&&window.requestAnimationFrame(M)}S.checked=!0,q.checked=!0,S.addEventListener("input",()=>{S.checked||q.checked||(q.checked=!0)}),q.addEventListener("input",()=>{S.checked||q.checked||(S.checked=!0)}),Page.element.querySelector("#download-button").addEventListener("click",()=>{e.download_frame("a-hitomezashi-pattern.png")})}();