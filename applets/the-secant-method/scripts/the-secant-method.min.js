!function(){"use strict";let t="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float world_center_x;\n\t\tuniform float world_center_y;\n\t\tuniform float world_size;\n\t\t\n\t\tuniform int num_roots;\n\t\t\n\t\tuniform vec2 roots[8];\n\t\t\n\t\tuniform vec3 colors[8];\n\t\t\n\t\tuniform vec2 a;\n\t\tuniform vec2 c;\n\t\t\n\t\tuniform float brightness_scale;\n\t\t\n\t\tconst float threshhold = .05;\n\t\t\n\t\t\n\t\t\n\t\t//Returns z_1 * z_2.\n\t\tvec2 cmul(vec2 z_1, vec2 z_2)\n\t\t{\n\t\t\treturn vec2(z_1.x * z_2.x - z_1.y * z_2.y, z_1.x * z_2.y + z_1.y * z_2.x);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns 1/z.\n\t\tvec2 cinv(vec2 z)\n\t\t{\n\t\t\tfloat magnitude = z.x*z.x + z.y*z.y;\n\t\t\t\n\t\t\treturn vec2(z.x / magnitude, -z.y / magnitude);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns f(z) for a polynomial f with given roots.\n\t\tvec2 cpoly(vec2 z)\n\t\t{\n\t\t\tvec2 result = vec2(1.0, 0.0);\n\t\t\t\n\t\t\tfor (int i = 0; i <= 8; i++)\n\t\t\t{\n\t\t\t\tif (i == num_roots)\n\t\t\t\t{\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tresult = cmul(result, z - roots[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Approximates f'(z) for a polynomial f with given roots.\n\t\tvec2 cderiv(vec2 z)\n\t\t{\n\t\t\treturn 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z;\n\t\t\tvec2 last_z = vec2(0.0, 0.0);\n\t\t\t\n\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tvec2 temp = cmul(cmul(cpoly(z), cmul(z - last_z, cinv(cpoly(z) - cpoly(last_z)))), a) + c;\n\t\t\t\t\n\t\t\t\tlast_z = z;\n\t\t\t\t\n\t\t\t\tz -= temp;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int i = 0; i <= 8; i++)\n\t\t\t\t{\n\t\t\t\t\tif (i == num_roots)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfloat d_0 = length(z - roots[i]);\n\t\t\t\t\t\n\t\t\t\t\tif (d_0 < threshhold)\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat d_1 = length(last_z - roots[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness_adjust = (log(threshhold) - log(d_0)) / (log(d_1) - log(d_0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness = 1.0 - (float(iteration) - brightness_adjust) / brightness_scale;\n\t\t\t\t\t\t\n\t\t\t\t\t\tgl_FragColor = vec4(colors[i] * brightness, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t",e={renderer:"gpu",shader:t,canvas_width:500,canvas_height:500,world_width:3,world_height:3,world_center_x:0,world_center_y:0,use_draggables:!0,draggables_mousemove_callback:G,draggables_touchmove_callback:G,draggables_mouseup_callback:J,draggables_touchend_callback:J,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:N,mousedown_callback:H,touchstart_callback:H,mousedrag_callback:T,touchmove_callback:T,mouseup_callback:B,touchend_callback:B,wheel_callback:function(t,e,n,r){m=t,w=e,Math.abs(n/100)<.3?d+=n/100:y+=.05*Math.sign(n);D()},pinch_callback:function(t,e,n,o){_>=1?(d-=n/r.world_width*10,v=-n/r.world_width*10):(d-=n/r.world_height*10,v=-n/r.world_height*10);m=t,w=e,D()}},n={renderer:"gpu",shader:t,canvas_width:100,canvas_height:100},r=new Wilson(Page.element.querySelector("#output-canvas"),e);r.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let o=new Wilson(Page.element.querySelector("#hidden-canvas"),n);o.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let a=[1,0],l=[0,0],i=[],s=0,c=0,_=1,d=0,u=[],h=500,g=100,m=0,w=0,f=0,p=0,v=0,b=0,z=0,y=0;const M=.96,x=.0025,q=25e-5,k=.93,F=.01,P=.001;let A=-1,S=r.draggables.add(1,0);S.classList.add("a-marker"),(S=r.draggables.add(0,0)).classList.add("c-marker"),W(),W(),W(),j();let L=Page.element.querySelector("#resolution-input");L.addEventListener("input",()=>{h=parseInt(L.value||500),r.change_canvas_size(h,h),window.requestAnimationFrame(K)}),Page.element.querySelector("#add-root-button").addEventListener("click",W),Page.element.querySelector("#remove-root-button").addEventListener("click",function(){if(1===c)return;c--,i.pop(),i.pop(),r.draggables.draggables[c+2].remove(),r.draggables.draggables.pop(),r.draggables.world_coordinates.pop(),r.draggables.num_draggables--,window.requestAnimationFrame(K)}),Page.element.querySelector("#spread-roots-button").addEventListener("click",j),Page.element.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("newtons-method.png")});let E=Page.element.querySelector("#root-a-input"),I=Page.element.querySelector("#root-b-input");E.addEventListener("input",C),I.addEventListener("input",C);let R=Page.element.querySelector("#root-setter");function W(){if(8===c)return;let t=3*Math.random()-1.5,e=3*Math.random()-1.5;r.draggables.add(t,e),i.push(t),i.push(e),c++,window.requestAnimationFrame(K)}function j(){for(let t=0;t<c;t++)t<c/2||c%2==1?(i[2*t]=Math.cos(2*Math.PI*2*t/c),i[2*t+1]=Math.sin(2*Math.PI*2*t/c)):(i[2*t]=Math.cos(2*Math.PI*(2*t+1)/c),i[2*t+1]=Math.sin(2*Math.PI*(2*t+1)/c)),r.draggables.world_coordinates[t+2]=[i[2*t],i[2*t+1]];window.requestAnimationFrame(K),r.draggables.recalculate_locations()}function C(){0===s?(a[0]=parseFloat(E.value||1),a[1]=parseFloat(I.value||0),r.draggables.world_coordinates[0]=[a[0],a[1]]):1===s?(l[0]=10*parseFloat(E.value||0),l[1]=10*parseFloat(I.value||0),r.draggables.world_coordinates[1]=[l[0],l[1]]):(i[2*(s-2)]=parseFloat(E.value||0),i[2*(s-2)+1]=parseFloat(I.value||0),r.draggables.world_coordinates[s-2]=[i[2*(s-2)],i[2*(s-2)+1]]),window.requestAnimationFrame(K),r.draggables.recalculate_locations()}function H(t,e,n){b=0,z=0,y=0,f=0,p=0,v=0}function T(t,e,n,o,a){r.world_center_x-=n,r.world_center_y-=o,f=-n/r.world_width,p=-o/r.world_height,window.requestAnimationFrame(K),r.draggables.recalculate_locations()}function B(t,e,n){Math.sqrt(f*f+p*p)>=x&&(b=f,z=p),Math.abs(v)>=F&&(y=v),window.requestAnimationFrame(K)}function D(){if(_>=1){let t=r.input.get_zoomed_world_center(m,w,3*Math.pow(2,d)*_,3*Math.pow(2,d));r.world_width=3*Math.pow(2,d)*_,r.world_height=3*Math.pow(2,d),r.world_center_x=t[0],r.world_center_y=t[1]}else{let t=r.input.get_zoomed_world_center(m,w,3*Math.pow(2,d),3*Math.pow(2,d)/_);r.world_width=3*Math.pow(2,d),r.world_height=3*Math.pow(2,d)/_,r.world_center_x=t[0],r.world_center_y=t[1]}window.requestAnimationFrame(K),r.draggables.recalculate_locations()}function G(t,e,n,r){0===t?a=[e,n]:1===t?l=[e,n]:(i[2*(t-2)]=e,i[2*(t-2)+1]=n),window.requestAnimationFrame(K)}function J(t,e,n,r){R.style.opacity=0,setTimeout(()=>{0===(s=t)?(E.value=Math.round(1e3*a[0])/1e3,I.value=Math.round(1e3*a[1])/1e3):1===s?(E.value=Math.round(1e3*l[0])/1e4,I.value=Math.round(1e3*l[1])/1e4):(E.value=Math.round(1e3*i[2*(s-2)])/1e3,I.value=Math.round(1e3*i[2*(s-2)+1])/1e3),R.style.opacity=1},Site.opacity_animation_time)}function K(t){let e=t-A;if(A=t,0===e)return;o.gl.uniform1f(o.uniforms.aspect_ratio,_),o.gl.uniform1f(o.uniforms.world_center_x,r.world_center_x),o.gl.uniform1f(o.uniforms.world_center_y,r.world_center_y),o.gl.uniform1f(o.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),o.gl.uniform1i(o.uniforms.num_roots,c),o.gl.uniform2fv(o.uniforms.roots,i),o.gl.uniform2fv(o.uniforms.a,a),o.gl.uniform2f(o.uniforms.c,l[0]/10,l[1]/10),o.gl.uniform1f(o.uniforms.brightness_scale,30),o.render.draw_frame();let n=o.render.get_pixel_data(),s=new Array(g*g);for(let t=0;t<g*g;t++)s[t]=Math.max(Math.max(n[4*t],n[4*t+1]),n[4*t+2]);s.sort((t,e)=>t-e);let h=Math.min(1e4/(s[Math.floor(g*g*.96)]+s[Math.floor(g*g*.98)]),200);u.push(h);let m=u.length;m>10&&u.shift(),h=Math.max(u.reduce((t,e)=>t+e)/m,.5),r.gl.uniform1f(r.uniforms.aspect_ratio,_),r.gl.uniform1f(r.uniforms.world_center_x,r.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,r.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),r.gl.uniform1i(r.uniforms.num_roots,c),r.gl.uniform2fv(r.uniforms.roots,i),r.gl.uniform2fv(r.uniforms.a,a),r.gl.uniform2f(r.uniforms.c,l[0]/10,l[1]/10),r.gl.uniform1f(r.uniforms.brightness_scale,h),r.render.draw_frame(),e>=50&&(b=0,z=0,y=0,f=0,p=0,v=0),0===b&&0===z&&0===y||(r.world_center_x+=b*r.world_width,r.world_center_y+=z*r.world_height,b*=M,z*=M,Math.sqrt(b*b+z*z)<q&&(b=0,z=0),d+=y,D(),y*=k,Math.abs(y)<P&&(y=0),window.requestAnimationFrame(K),r.draggables.recalculate_locations())}function N(){r.fullscreen.currently_fullscreen?(_=window.innerWidth/window.innerHeight)>=1?(r.change_canvas_size(h,Math.floor(h/_)),r.world_width=3*Math.pow(2,d)*_,r.world_height=3*Math.pow(2,d)):(r.change_canvas_size(Math.floor(h*_),h),r.world_width=3*Math.pow(2,d),r.world_height=3*Math.pow(2,d)/_):(_=1,r.change_canvas_size(h,h),r.world_width=3*Math.pow(2,d),r.world_height=3*Math.pow(2,d)),window.requestAnimationFrame(K)}r.gl.uniform1f(r.uniforms.aspect_ratio,1),r.gl.uniform3fv(r.uniforms.colors,[1,0,0,0,1,0,0,0,1,0,1,1,1,0,1,1,1,0,.5,0,1,1,.5,0]),o.gl.uniform3fv(o.uniforms.colors,[1,0,0,0,1,0,0,0,1,0,1,1,1,0,1,1,1,0,.5,0,1,1,.5,0]),window.requestAnimationFrame(K),Page.show(),window.addEventListener("resize",N),Page.temporary_handlers.resize.push(N)}();