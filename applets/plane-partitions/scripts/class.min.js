import anime from"/scripts/anime.min.js";import{changeOpacity}from"/scripts/src/animation.min.js";import{Applet}from"/scripts/src/applets.min.js";import{$$}from"/scripts/src/main.min.js";import*as THREE from"/scripts/three.js";import{Wilson}from"/scripts/wilson.min.js";class PlanePartitions extends Applet{wilsonNumbers=null;wilsonHidden=null;wilsonHidden2=null;wilsonHidden3=null;wilsonHidden4=null;useFullscreenButton=!1;backgroundColor=0;resolution=2e3;animationTime=600;asymptoteLightness=.6;cubeLightness=.4;floorLightness=.4;infiniteHeight=100;addWalls=!0;wallWidth=20;wallHeight=20;scene=null;orthographicCamera=null;renderer=null;loader=null;cubeTexture=null;cubeTexture2=null;floorTexture=null;floorTexture2=null;cubeGeometry=null;floorGeometry=null;wallLeftGeometry=null;wallRightGeometry=null;ambientLight=null;dimersShown=!1;pointLight=null;rotationY=0;rotationYVelocity=0;nextRotationYVelocity=0;lastRotationYVelocities=[];rotationYVelocityFriction=.94;rotationYVelocityStartThreshhold=.005;rotationYVelocityStopThreshhold=5e-4;in2dView=!1;inExactHexView=!0;currentlyAnimatingCamera=!1;currentlyRunningAlgorithm=!1;needDownload=!1;fontSize=10;arrays=[];totalArrayFootprint=0;totalArrayHeight=0;totalArraySize=0;hexViewCameraPos=[15,15,15];_2dViewCameraPos=[0,20,0];algorithmData={hillmanGrassl:{method:this.hillmanGrassl,inputType:["pp"]},hillmanGrasslInverse:{method:this.hillmanGrasslInverse,inputType:["tableau"]},pak:{method:this.pak,inputType:["pp"]},pakInverse:{method:this.pakInverse,inputType:["tableau"]},sulzgruber:{method:this.sulzgruber,inputType:["pp"]},sulzgruberInverse:{method:this.sulzgruberInverse,inputType:["tableau"]},rsk:{method:this.rsk,inputType:["ssyt","ssyt"],sameShape:!0},rskInverse:{method:this.rskInverse,inputType:["tableau"]},godar1:{method:this.godar1,inputType:["pp"]},godar1Inverse:{method:this.godar1Inverse,inputType:["pp","pp"]}};constructor({canvas,numbersCanvas,useFullscreenButton=!0}){super(canvas),this.useFullscreenButton=useFullscreenButton;var t=this.createHiddenCanvas(),e=this.createHiddenCanvas(),i=this.createHiddenCanvas(),a=this.createHiddenCanvas(),r={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!1,mousedownCallback:this.onGrabCanvas.bind(this),touchstartCallback:this.onGrabCanvas.bind(this),mousedragCallback:this.onDragCanvas.bind(this),touchmoveCallback:this.onDragCanvas.bind(this),mouseupCallback:this.onReleaseCanvas.bind(this),touchendCallback:this.onReleaseCanvas.bind(this)},r=(this.wilsonNumbers=new Wilson(numbersCanvas,r),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),$$(".wilson-applet-canvas-container").forEach(element=>element.style.setProperty("background-color","rgba(0, 0, 0, 0)","important")),{canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:this.useFullscreenButton,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:this.switchFullscreen.bind(this)}),r=(this.wilson=new Wilson(canvas,r),{renderer:"cpu",canvasWidth:64,canvasHeight:64});this.wilsonHidden=new Wilson(t,r),this.wilsonHidden2=new Wilson(e,r),this.wilsonHidden3=new Wilson(i,r),this.wilsonHidden4=new Wilson(a,r),this.wilsonHidden.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden.ctx._alpha=1,this.wilsonHidden.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.lineWidth=6,this.wilsonHidden2.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden2.ctx._alpha=1,this.wilsonHidden2.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.lineWidth=6,this.wilsonHidden3.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden3.ctx._alpha=1,this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?1:0})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?1:0})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.lineWidth=6,this.wilsonHidden4.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden4.ctx._alpha=1,this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?1:0})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?1:0})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.lineWidth=6,this.scene=new THREE.Scene,this.scene.background=new THREE.Color(this.backgroundColor),this.orthographicCamera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0}),this.renderer.setSize(this.resolution,this.resolution,!1),this.renderer.useLegacyLights=!0,this.loader=new THREE.TextureLoader,this.cubeTexture=new THREE.CanvasTexture(this.wilsonHidden.canvas),this.cubeTexture.minFilter=THREE.LinearFilter,this.cubeTexture.magFilter=THREE.NearestFilter,this.cubeTexture2=new THREE.CanvasTexture(this.wilsonHidden2.canvas),this.cubeTexture2.minFilter=THREE.LinearFilter,this.cubeTexture2.magFilter=THREE.NearestFilter,this.floorTexture=new THREE.CanvasTexture(this.wilsonHidden3.canvas),this.floorTexture.minFilter=THREE.LinearFilter,this.floorTexture.magFilter=THREE.NearestFilter,this.floorTexture2=new THREE.CanvasTexture(this.wilsonHidden4.canvas),this.floorTexture2.minFilter=THREE.LinearFilter,this.floorTexture2.magFilter=THREE.NearestFilter,this.cubeGeometry=new THREE.BoxGeometry,this.dimersShown=!1,this.floorGeometry=new THREE.BoxGeometry(1,.001,1),this.wallLeftGeometry=new THREE.BoxGeometry(.001,1,1),this.wallRightGeometry=new THREE.BoxGeometry(1,1,.001),this.ambientLight=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,3,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.drawFrame()}onGrabCanvas(){this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0]}onDragCanvas(x,y,xDelta){this.in2dView||(this.rotationY+=xDelta,this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.scene.children.forEach(object=>object.rotation.y=this.rotationY),this.nextRotationYVelocity=xDelta)}onReleaseCanvas(){if(!this.in2dView){let t=0;if(this.lastRotationYVelocities.forEach((velocity,index)=>{Math.abs(velocity)>this.rotationYVelocity&&(this.rotationYVelocity=Math.abs(velocity),t=index)}),this.rotationYVelocity<this.rotationYVelocityStartThreshhold)return void(this.rotationYVelocity=0);this.rotationYVelocity=this.lastRotationYVelocities[t]}this.lastRotationYVelocities=[0,0,0,0]}drawFrame(){this.renderer.render(this.scene,this.orthographicCamera),this.lastRotationYVelocities.push(this.nextRotationYVelocity),this.lastRotationYVelocities.shift(),(this.nextRotationYVelocity=0)!==this.rotationYVelocity&&(this.rotationY+=this.rotationYVelocity,this.scene.children.forEach(object=>object.rotation.y=this.rotationY),this.rotationYVelocity*=this.rotationYVelocityFriction,Math.abs(this.rotationYVelocity)<this.rotationYVelocityStopThreshhold)&&(this.rotationYVelocity=0),this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.needDownload&&(this.needDownload=!1,this.wilson.canvas.toBlob(blob=>{var t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(blob),t.click(),t.remove()})),window.requestAnimationFrame(this.drawFrame.bind(this))}switchFullscreen(){var t;this.useFullscreenButton&&(t=document.body.querySelector(".wilson-exit-fullscreen-button"))&&t.style.setProperty("z-index","300","important"),this.in2dView||this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.wilsonNumbers.fullscreen.switchFullscreen()}static generateRandomPlanePartition(){var e=Math.floor(3*Math.random())+5,t=Math.floor(5*Math.random())+10,i=new Array(e);for(let a=0;a<e;a++)i[a]=new Array(e);i[0][0]=t;for(let r=1;r<e;r++)i[0][r]=Math.max(i[0][r-1]-Math.floor(4*Math.random()),0);for(let s=1;s<e;s++){i[s][0]=Math.max(i[s-1][0]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++)i[s][t]=Math.max(Math.min(i[s][t-1],i[s-1][t])-Math.floor(4*Math.random()),0)}for(let n=0;n<e;n++)i[e-1][n]=0,i[n][e-1]=0;return i}static generateRandomTableau(){var e=Math.floor(3*Math.random())+5,i=new Array(e);for(let a=0;a<e;a++){i[a]=new Array(e);for(let t=0;t<e;t++)Math.random()<.75/e?i[a][t]=Math.floor(3*Math.random())+1:i[a][t]=0}for(let t=0;t<e;t++)i[t][e-1]=0,i[e-1][t]=0;return i}static generateRandomSsyt(){var e=Math.floor(3*Math.random())+2,i=new Array(e);for(let t=0;t<e;t++)i[t]=new Array(e);i[0][0]=Math.floor(2*Math.random());for(let a=1;a<e;a++)i[0][a]=i[0][a-1]+Math.floor(2*Math.random());for(let r=1;r<e;r++){i[r][0]=i[r-1][0]+1+Math.floor(2*Math.random());for(let t=1;t<e;t++)i[r][t]=Math.max(i[r][t-1],i[r-1][t]+1)+Math.floor(2*Math.random())}return i}static parseArray(data){var e=data.split("\n");let t=e.length;var i=new Array(e.length);for(let n=0;n<i.length;n++){i[n]=e[n].split(" ");for(let t=0;t<i[n].length;t++)""===i[n][t]&&(i[n].splice(t,1),t--)}let a=i[0].length;if(-1===data.indexOf(">")){for(let t=0;t<i.length;t++)i[t].push("0");a++}-1===data.indexOf("v")&&(i.push(["0"]),t++);var r=Math.max(t,a),s=new Array(r);for(let o=0;o<t;o++){s[o]=new Array(r);for(let t=0;t<i[o].length;t++)"^"===i[o][t]?s[o][t]=1/0:">"===i[o][t]?s[o][t]=s[o][t-1]:"v"===i[o][t]?s[o][t]=s[o-1][t]:s[o][t]=parseInt(i[o][t]);for(let e=i[o].length;e<r;e++)s[o][e]=0}for(let l=t;l<r;l++){s[l]=new Array(r);for(let t=0;t<r;t++)s[l][t]=0}return s}static arrayToAscii(numbers){let i=1;for(let e=0;e<numbers.length;e++)for(let t=0;t<numbers.length;t++)numbers[e][t]!==1/0&&(i=Math.max(i,(""+numbers[e][t]).length));i++;let a="";for(let s=0;s<numbers.length-1;s++){for(let e=0;e<numbers.length-1;e++)if(numbers[s][e]===1/0){for(let t=0;t<i-1-(0===e);t++)a+=" ";a+="^"}else{var r=(""+numbers[s][e]).length;for(let t=0;t<i-r-(0===e);t++)a+=" ";a+=numbers[s][e]}if(0!==numbers[s][numbers.length-1]){for(let t=0;t<i-1;t++)a+=" ";a+=">"}s!==numbers.length-2&&(a+="\n")}if(0!==numbers[numbers.length-1][0]){a+="\n";for(let e=0;e<numbers.length-1;e++)if(0!==numbers[numbers.length-1][e]){for(let t=0;t<i-1-(0===e);t++)a+=" ";a+="v"}}return a}static verifyPp(planePartition){for(let e=0;e<planePartition.length-1;e++)for(let t=0;t<planePartition[e].length-1;t++)if(planePartition[e][t]<planePartition[e+1][t]||planePartition[e][t]<planePartition[e][t+1])return!1;return!0}static verifySsyt(ssyt){for(let e=0;e<ssyt.length-1;e++)for(let t=0;t<ssyt[e].length-1;t++)if(0!==ssyt[e+1][t]&&ssyt[e][t]>=ssyt[e+1][t]||0!==ssyt[e][t+1]&&ssyt[e][t]>ssyt[e][t+1])return!1;return!0}async addNewArray(index,numbers,keepNumbersCanvasVisible=!1,horizontalLegs=!0){if(!this.currentlyAnimating){var r={numbers:numbers,cubes:[],floor:[],leftWall:[],rightWall:[],cubeGroup:null,centerOffset:0,partialFootprintSum:0,footprint:0,height:0,size:0};this.in2dView&&!keepNumbersCanvasVisible&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.arrays.splice(index,0,r),r.footprint=r.numbers.length;for(let t=index;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,t!==index&&(this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}));r.cubeGroup=new THREE.Object3D,this.scene.add(r.cubeGroup),this.addWalls?(this.arrays.length,r.cubeGroup.position.set(0,0,0)):this.in2dView?r.cubeGroup.position.set(r.centerOffset,0,0):r.cubeGroup.position.set(r.centerOffset,0,-r.centerOffset),r.cubeGroup.rotation.y=this.rotationY,r.cubes=new Array(r.footprint),r.floor=new Array(r.footprint);for(let a=0;a<r.footprint;a++){r.cubes[a]=new Array(r.footprint),r.floor[a]=new Array(r.footprint);for(let i=0;i<r.footprint;i++)if(r.numbers[a][i]!==1/0)if(r.cubes[a][i]=new Array(r.numbers[a][i]),r.numbers[a][i]>r.height&&(r.height=r.numbers[a][i]),r.floor[a][i]=this.addFloor(r,i,a),horizontalLegs){var s=Math.max(r.numbers[a][r.footprint-1],r.numbers[r.footprint-1][i]);for(let t=0;t<s;t++)r.cubes[a][i][t]=this.addCube(r,i,t,a,0,0,this.asymptoteLightness);for(let e=s;e<r.numbers[a][i];e++)r.cubes[a][i][e]=this.addCube(r,i,e,a)}else for(let t=0;t<r.numbers[a][i];t++)r.cubes[a][i][t]=this.addCube(r,i,t,a);else{r.cubes[a][i]=new Array(this.infiniteHeight),r.floor[a][i]=this.addFloor(r,i,a);for(let t=0;t<this.infiniteHeight;t++)r.cubes[a][i][t]=this.addCube(r,i,t,a,0,0,this.asymptoteLightness)}}if(this.addWalls){r.leftWall=new Array(this.wallWidth),r.rightWall=new Array(this.wallWidth);for(let t=0;t<this.wallWidth;t++)r.leftWall[t]=new Array(this.wallHeight),r.rightWall[t]=new Array(this.wallHeight);for(let e=0;e<this.wallWidth;e++)for(let t=0;t<this.wallHeight;t++)r.leftWall[e][t]=this.addLeftWall(r,t,e),r.rightWall[e][t]=this.addRightWall(r,e,t)}r.size=Math.max(r.footprint,r.height),this.totalArrayFootprint+=r.footprint+1,this.totalArrayHeight=Math.max(this.totalArrayHeight,r.height),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),1!==this.arrays.length||keepNumbersCanvasVisible?this.addWalls||keepNumbersCanvasVisible||this.updateCameraHeight(!0):(this.hexViewCameraPos=[this.totalArraySize,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize],this._2dViewCameraPos=[0,this.totalArraySize+10,0],this.in2dView&&!keepNumbersCanvasVisible?this.updateCameraHeight(!0):(this.orthographicCamera.left=-this.totalArraySize,this.orthographicCamera.right=this.totalArraySize,this.orthographicCamera.top=this.totalArraySize,this.orthographicCamera.bottom=-this.totalArraySize,this.orthographicCamera.position.set(this.hexViewCameraPos[0],this.hexViewCameraPos[1],this.hexViewCameraPos[2]),this.orthographicCamera.rotation.set(-.785398163,.615479709,.523598775),this.orthographicCamera.updateProjectionMatrix())),index!==this.arrays.length-1&&await new Promise(resolve=>setTimeout(resolve,this.animationTime));const e=[];return r.cubeGroup.traverse(node=>{node.material&&node.material.forEach(material=>e.push(material))}),await anime({targets:e,opacity:1,duration:this.animationTime/2,easing:"easeOutQuad"}).finished,this.in2dView&&!keepNumbersCanvasVisible&&this.drawAll2dViewText(),r}}async editArray(index,numbers){this.currentlyAnimating||(index>=this.arrays.length||index<0?this.displayError("No array at index "+index):(await this.removeArray(index),await this.addNewArray(index,numbers),this.in2dView||this.updateCameraHeight()))}async trimArray(index){if(!this.currentlyAnimating)if(index>=this.arrays.length||index<0)this.displayError("No array at index "+index);else{var r=this.arrays[index].numbers;let e=0;for(let i=0;i<r.length;i++)for(let t=0;t<r.length;t++)0!==r[i][t]&&(e=Math.max(e,Math.max(i+1,t+1)));var s=new Array(e);for(let a=0;a<e;a++){s[a]=new Array(e);for(let t=0;t<e;t++)s[a][t]=r[a][t]}await this.removeArray(index),await this.addNewArray(index,s),this.in2dView||this.updateCameraHeight()}}async removeArray(index,keepNumbersCanvasVisible=!1){if(!this.currentlyAnimating)if(index>=this.arrays.length||index<0)this.displayError("No array at index "+index);else{this.in2dView&&!keepNumbersCanvasVisible&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5);const e=[];this.arrays[index].cubeGroup.traverse(node=>{node.material&&node.material.forEach(material=>e.push(material))}),await anime({targets:e,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad"}).finished;for(let i=0;i<this.arrays[index].cubes.length;i++)for(let e=0;e<this.arrays[index].cubes[i].length;e++)if(this.arrays[index].cubes[i][e])for(let t=0;t<this.arrays[index].cubes[i][e].length;t++)this.arrays[index].cubes[i][e][t]&&this.arrays[index].cubes[i][e][t].material.forEach(material=>material.dispose());this.scene.remove(this.arrays[index].cubeGroup),this.totalArrayFootprint-=this.arrays[index].footprint+1,this.arrays.splice(index,1);for(let t=index;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"});0===this.arrays.length||keepNumbersCanvasVisible||this.updateCameraHeight(!0)}}addCube(array,x,y,z,h=0,s=0,v=this.cubeLightness){var t=[new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0})],t=(t.forEach(material=>material.color.setHSL(h,s,v)),new THREE.Mesh(this.cubeGeometry,t));return array.cubeGroup.add(t),this.addWalls?t.position.set(x,y,z):t.position.set(x-(array.footprint-1)/2,y,z-(array.footprint-1)/2),t}addFloor(array,x,z,h=0,s=0,v=this.floorLightness){var t=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],t=(t.forEach(material=>material.color.setHSL(h,s,v)),new THREE.Mesh(this.floorGeometry,t));return array.cubeGroup.add(t),this.addWalls?t.position.set(x,-.5005,z):t.position.set(x-(array.footprint-1)/2,-.5005,z-(array.footprint-1)/2),t}addLeftWall(array,y,z,h=0,s=0,v=this.floorLightness){var t=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],t=(t.forEach(material=>material.color.setHSL(h,s,v)),new THREE.Mesh(this.wallLeftGeometry,t));return array.cubeGroup.add(t),this.addWalls?t.position.set(-.5005,y,z):t.position.set(-.5005-(array.footprint-1)/2,y,z-(array.footprint-1)/2),t}addRightWall(array,x,y,h=0,s=0,v=this.floorLightness){var t=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],t=(t.forEach(material=>material.color.setHSL(h,s,v)),new THREE.Mesh(this.wallRightGeometry,t));return array.cubeGroup.add(t),this.addWalls?t.position.set(x,y,-.5005):t.position.set(x-(array.footprint-1)/2,y,-.5005-(array.footprint-1)/2),t}async showHexView(){this.currentlyAnimatingCamera||(this.currentlyAnimatingCamera=!0,this.in2dView&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.in2dView=!1,this.inExactHexView=!0,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),await Promise.all([anime({targets:this.orthographicCamera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:this.animationTime,easing:"easeInOutQuad"}).finished].concat(this.arrays.map(array=>anime({targets:array.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished),this.arrays.map(array=>anime({targets:array.cubeGroup.position,x:array.centerOffset,y:0,z:-array.centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}).finished))),this.currentlyAnimatingCamera=!1,this.rotationY=0)}async show2dView(){this.currentlyAnimatingCamera||this.in2dView||(this.dimersShown&&await this.hideDimers(),this.currentlyAnimatingCamera=!0,this.in2dView=!0,this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),await Promise.all([anime({targets:this.orthographicCamera.rotation,x:-1.570796327,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished].concat(this.arrays.map(array=>anime({targets:array.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished),this.arrays.map(array=>anime({targets:array.cubeGroup.position,x:array.centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished))),this.drawAll2dViewText(),await changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5),this.currentlyAnimatingCamera=!1,this.rotationY=0)}async updateCameraHeight(force=!1){if(!force){if(this.currentlyAnimatingCamera)return;this.currentlyAnimatingCamera=!0}for(let e=this.totalArrayHeight=0;e<this.arrays.length;e++)this.totalArrayHeight=Math.max(this.totalArrayHeight,this.arrays[e].height);this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight);var t=(-this.arrays[0].footprint/2+this.arrays[this.arrays.length-1].centerOffset+this.arrays[this.arrays.length-1].footprint/2)/2;this.hexViewCameraPos=[this.totalArraySize+t,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize-t],this.addWalls&&(this.hexViewCameraPos[0]+=10,this.hexViewCameraPos[1]+=10,this.hexViewCameraPos[2]+=10),this._2dViewCameraPos=[t,this.totalArraySize+10,0],this.in2dView?(await Promise.all([anime({targets:this.orthographicCamera.position,x:this._2dViewCameraPos[0],y:this._2dViewCameraPos[1],z:this._2dViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}).finished,anime({targets:this.orthographicCamera,left:-(this.totalArrayFootprint/2+.5),right:this.totalArrayFootprint/2+.5,top:this.totalArrayFootprint/2+.5,bottom:-(this.totalArrayFootprint/2+.5),duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix()}).finished]),this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1,this.drawAll2dViewText(),changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5)):(await Promise.all([anime({targets:this.orthographicCamera.position,x:this.hexViewCameraPos[0],y:this.hexViewCameraPos[1],z:this.hexViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}).finished,anime({targets:this.orthographicCamera,left:-this.totalArraySize,right:this.totalArraySize,top:this.totalArraySize,bottom:-this.totalArraySize,duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix()}).finished]),this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1)}async showDimers(){if(!this.currentlyAnimatingCamera){this.dimersShown=!0,this.inExactHexView||await this.showHexView(),this.currentlyAnimatingCamera=!0;const a=[];this.arrays.forEach(array=>{for(let i=0;i<array.footprint;i++)for(let e=0;e<array.footprint;e++){for(let t=0;t<array.cubes[i][e].length;t++)t<array.cubes[i][e].length-1&&a.push(array.cubes[i][e][t].material[2]),i<array.footprint-1&&array.cubes[i+1][e].length>=t+1&&a.push(array.cubes[i][e][t].material[4]),e<array.footprint-1&&array.cubes[i][e+1].length>=t+1&&a.push(array.cubes[i][e][t].material[0]),a.push(array.cubes[i][e][t].material[1]),a.push(array.cubes[i][e][t].material[3]),a.push(array.cubes[i][e][t].material[5]),this.addWalls&&0===i&&a.push(array.rightWall[e][t].material[4]),this.addWalls&&0===e&&a.push(array.leftWall[i][t].material[0]);0!==array.cubes[i][e].length&&a.push(array.floor[i][e].material[2])}}),a.forEach(material=>material.opacity=0),await anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:this.animationTime/2,easing:"easeOutQuad",update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}}).finished,this.currentlyAnimatingCamera=!1}}async hideDimers(){if(!this.currentlyAnimatingCamera){this.dimersShown=!1;const a=[];this.arrays.forEach(array=>{for(let i=0;i<array.footprint;i++)for(let e=0;e<array.footprint;e++){for(let t=0;t<array.cubes[i][e].length;t++)t<array.cubes[i][e].length-1&&a.push(array.cubes[i][e][t].material[2]),i<array.footprint-1&&array.cubes[i+1][e].length>=t+1&&a.push(array.cubes[i][e][t].material[4]),e<array.footprint-1&&array.cubes[i][e+1].length>=t+1&&a.push(array.cubes[i][e][t].material[0]),a.push(array.cubes[i][e][t].material[1]),a.push(array.cubes[i][e][t].material[3]),a.push(array.cubes[i][e][t].material[5]);0!==array.cubes[i][e].length&&a.push(array.floor[i][e].material[2])}if(this.addWalls)for(let e=0;e<this.wallWidth;e++)for(let t=0;t<this.wallHeight;t++)a.push(array.leftWall[e][t].material[0]),a.push(array.rightWall[e][t].material[4])}),await anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:this.animationTime/2,easing:"easeOutQuad",update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}}).finished,a.forEach(material=>material.opacity=1),this.currentlyAnimatingCamera=!1}}async showFloor(opacity=1){const t=[];return this.arrays.forEach(array=>{array.floor.forEach(row=>{row.forEach(floor=>{floor.material.forEach(material=>t.push(material))})})}),anime({targets:t,opacity:opacity,duration:this.animationTime/2,easing:"easeOutQuad"}).finished}hideFloor(){return this.showFloor(0)}removeOutsideFloor(array){const e=[];var i=[];for(let a=0;a<array.footprint;a++)for(let t=array.footprint-1;0<=t&&0===array.numbers[a][t];t--)array.floor[a][t].material.forEach(material=>e.push(material)),i.push([a,t]);i.forEach(coordinates=>{array.floor[coordinates[0]][coordinates[1]].material.forEach(material=>material.dispose()),array.cubeGroup.remove(array.floor[coordinates[0]][coordinates[1]]),array.floor[coordinates[0]][coordinates[1]]=null}),this.in2dView&&this.drawAll2dViewText()}recalculateHeights(array){array.height=0,array.numbers.forEach(row=>{row.forEach(entry=>{entry!==1/0&&(array.height=Math.max(entry,array.height))})}),array.size=Math.max(array.footprint,array.height),this.totalArrayHeight=0,this.arrays.forEach(array=>this.totalArrayHeight=Math.max(array.height,this.totalArrayHeight)),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),this.totalArrayHeight!==this.oldTotalArrayHeight&&this.updateCameraHeight()}drawAll2dViewText(){this.fontSize=this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1);var t=Math.max((""+this.totalArrayHeight).length,2);this.wilsonNumbers.ctx.font=this.fontSize/t+"px monospace",this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.arrays.forEach(array=>{for(let e=0;e<array.footprint;e++)for(let t=0;t<array.footprint;t++)null!==array.floor[e][t]&&this.drawSingleCell2dViewText(array,e,t)})}drawSingleCell2dViewText(array,row,col){var t,e=(this.totalArrayFootprint-array.footprint-1)/2,i=array.partialFootprintSum-array.footprint;this.wilsonNumbers.ctx.clearRect(this.fontSize*(col+i+1),this.fontSize*(row+e+1),this.fontSize,this.fontSize),array.numbers[row][col]===1/0||0===array.numbers[row][col]&&0===this.floorLightness||(t=this.wilsonNumbers.ctx.measureText(array.numbers[row][col]),this.wilsonNumbers.ctx.fillText(array.numbers[row][col],this.fontSize*(col+i+1)+(this.fontSize-t.width)/2,this.fontSize*(row+e+1)+(this.fontSize+t.actualBoundingBoxAscent-t.actualBoundingBoxDescent)/2))}async colorCubes(array,coordinates,hue){if(0!==coordinates.length){const i=[];coordinates.forEach(xyz=>{array.cubes[xyz[0]][xyz[1]][xyz[2]].material.forEach(material=>i.push(material.color))}),i.forEach(color=>color.getRGB(color));var t=this.cubeLightness+ +Math.min(this.cubeLightness,1-this.cubeLightness),e=0===t?0:2*(1-this.cubeLightness/t),e=this.wilson.utils.hsvToRgb(hue,e,t);await anime({targets:i,r:e[0]/255,g:e[1]/255,b:e[2]/255,duration:this.animationTime,delay:(element,index)=>Math.floor(index/6)*this.animationTime/10,easing:"easeOutQuad",update:()=>i.forEach(color=>color.setRGB(color.r,color.g,color.b))}).finished}}async uncolorCubes(array,coordinates){const t=[];coordinates.forEach(xyz=>{array.cubes[xyz[0]][xyz[1]][xyz[2]].material.forEach(material=>t.push(material.color))}),t.forEach(color=>color.getHSL(color)),await anime({targets:t,s:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>t.forEach(color=>color.setHSL(color.h,color.s,this.cubeLightness))}).finished}async raiseCubes(array,coordinates,height){var t=this.in2dView?0:this.animationTime;const e=[];coordinates.forEach(xyz=>{e.push(array.cubes[xyz[0]][xyz[1]][xyz[2]].position),array.numbers[xyz[0]][xyz[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),await anime({targets:e,y:height,duration:t,easing:"easeInOutQuad"}).finished}async lowerCubes(array,coordinates){var t=this.in2dView?0:this.animationTime;const e=[];coordinates.forEach(xyz=>{e.push(array.cubes[xyz[0]][xyz[1]][xyz[2]].position),array.numbers[xyz[0]][xyz[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),await anime({targets:e,y:(element,index)=>array.numbers[coordinates[index][0]][coordinates[index][1]],duration:t,easing:"easeInOutQuad"}).finished,coordinates.forEach(xyz=>{array.cubes[xyz[0]][xyz[1]][array.numbers[xyz[0]][xyz[1]]]=array.cubes[xyz[0]][xyz[1]][xyz[2]],array.cubes[xyz[0]][xyz[1]][xyz[2]]=null})}async moveCubes(sourceArray,sourceCoordinates,targetArray,targetCoordinates,updateCubeArray=!0){const t=[];if(sourceCoordinates.forEach(xyz=>{t.push(sourceArray.cubes[xyz[0]][xyz[1]][xyz[2]].position),targetArray.cubeGroup.attach(sourceArray.cubes[xyz[0]][xyz[1]][xyz[2]]),sourceArray.numbers[xyz[0]][xyz[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),await anime({targets:t,x:(element,index)=>targetCoordinates[index][1]-(targetArray.footprint-1)/2,y:(element,index)=>targetCoordinates[index][2],z:(element,index)=>targetCoordinates[index][0]-(targetArray.footprint-1)/2,duration:this.animationTime,easing:"easeInOutQuad"}).finished,updateCubeArray){const i=sourceCoordinates.map(xyz=>sourceArray.cubes[xyz[0]][xyz[1]][xyz[2]]);sourceCoordinates.forEach(xyz=>sourceArray.cubes[xyz[0]][xyz[1]][xyz[2]]=null),targetCoordinates.forEach((xyz,index)=>{targetArray.numbers[xyz[0]][xyz[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),targetArray.cubes[xyz[0]][xyz[1]][xyz[2]]&&!sourceCoordinates.some(e=>e[0]===xyz[0]&&e[1]===xyz[1]&&e[2]===xyz[2])&&console.warn(`Moving a cube to a location that's already occupied: ${xyz}. This is probably not what you want to do.`),targetArray.cubes[xyz[0]][xyz[1]][xyz[2]]=i[index]})}}async revealCubes(array,coordinates){if(0!==coordinates.length){const t=[];coordinates.forEach(xyz=>{array.cubes[xyz[0]][xyz[1]][xyz[2]].material.forEach(material=>t.push(material)),array.numbers[xyz[0]][xyz[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),await anime({targets:t,opacity:1,duration:this.animationTime/2,delay:(element,index)=>Math.floor(index/6)*this.animationTime/10,easing:"easeOutQuad"}).finished}}async deleteCubes(array,coordinates,instant=!1,noAnimation=!1){const t=[];coordinates.forEach(xyz=>{array.cubes[xyz[0]][xyz[1]][xyz[2]].material.forEach(material=>t.push(material))}),await anime({targets:t,opacity:0,duration:this.animationTime/2*!noAnimation,delay:(element,index)=>!instant*Math.floor(index/6)*this.animationTime/10,easing:"easeOutQuad"}).finished,t.forEach(material=>material.dispose()),coordinates.forEach(xyz=>{array.cubeGroup.remove(array.cubes[xyz[0]][xyz[1]][xyz[2]]),array.cubes[xyz[0]][xyz[1]][xyz[2]]=null})}async deleteFloor(array,coordinates){const t=[];coordinates.forEach(xyz=>{array.floor[xyz[0]][xyz[1]].material.forEach(material=>t.push(material))}),await anime({targets:t,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad"}).finished,t.forEach(material=>material.dispose()),coordinates.forEach(xyz=>{array.cubeGroup.remove(array.floor[xyz[0]][xyz[1]]),array.cubes[xyz[0]][xyz[1]]=null})}async runExample(index){if(1===index||2===index){for(;1<this.arrays.length;)await this.removeArray(1),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2));var t;0===this.arrays.length?(t=PlanePartitions.parseArray(PlanePartitions.generateRandomPlanePartition()),await this.addNewArray(this.arrays.length,t)):PlanePartitions.verifyPp(this.arrays[0].numbers)||(await this.removeArray(0),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),t=PlanePartitions.parseArray(PlanePartitions.generateRandomPlanePartition()),await this.addNewArray(this.arrays.length,t)),1===index?(await this.runAlgorithm("hillmanGrassl",0),await new Promise(resolve=>setTimeout(resolve,3*this.animationTime)),await this.runAlgorithm("hillmanGrasslInverse",0)):(await this.runAlgorithm("pak",0),await new Promise(resolve=>setTimeout(resolve,3*this.animationTime)),await this.showHexView(),await new Promise(resolve=>setTimeout(resolve,this.animationTime)),await this.runAlgorithm("sulzgruberInverse",0))}else if(3===index){for(;0<this.arrays.length;)await this.removeArray(0),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2));await this.addNewArray(this.arrays.length,PlanePartitions.generateRandomTableau()),await this.show2dView(),await new Promise(resolve=>setTimeout(resolve,this.animationTime)),await this.runAlgorithm("rskInverse",0),await new Promise(resolve=>setTimeout(resolve,3*this.animationTime)),await this.runAlgorithm("rsk",0)}}async runAlgorithm(name,index,subAlgorithm=!1){if(subAlgorithm||!this.currentlyRunningAlgorithm){this.currentlyRunningAlgorithm=!0;var i=this.algorithmData[name],r=i.inputType.length;if(index>this.arrays.length-1||index<0)console.log(`No array at index ${index}!`),this.currentlyRunningAlgorithm=!1;else if(1<r&&index>this.arrays.length-r)console.log(`No array at index ${index+r-1}! (This algorithm needs ${r} arrays)`),this.currentlyRunningAlgorithm=!1;else{for(let t=0;t<r;t++){var a=i.inputType[t];if("pp"===a&&!PlanePartitions.verifyPp(this.arrays[index+t].numbers))return console.log(`Array at index ${index+t} is not a plane partition!`),void(this.currentlyRunningAlgorithm=!1);if("ssyt"===a&&!PlanePartitions.verifySsyt(this.arrays[index+t].numbers))return console.log(`Array at index ${index+t} is not an SSYT!`),void(this.currentlyRunningAlgorithm=!1)}if(1<r&&void 0!==i.sameShape&&i.sameShape){var s=new Array(r);let i=0;for(let t=0;t<r;t++)i=Math.max(i,this.arrays[index+t].numbers.length);for(let a=0;a<r;a++){s[a]=new Array(i);for(let t=0;t<i;t++)s[a][t]=0;for(let e=0;e<this.arrays[index+a].numbers.length;e++){let t=0;for(;t<this.arrays[index+a].numbers[e].length&&0!==this.arrays[index+a].numbers[e][t];)t++;s[a][e]=t}}for(let e=1;e<r;e++)for(let t=0;t<i;t++)if(s[e][t]!==s[0][t])return this.displayError("Arrays are not the same shape!"),void(this.currentlyRunningAlgorithm=!1)}for(let e=0;e<r;e++){var n=[],o=this.arrays[index+e].numbers;for(let i=0;i<o.length;i++)for(let e=0;e<o.length;e++)if(o[i][e]!==1/0)for(let t=0;t<o[i][e];t++)n.push([i,e,t]);this.uncolorCubes(this.arrays[index+e],n)}await i.method.bind(this)(index),this.subAlgorithm||(this.currentlyRunningAlgorithm=!1)}}}async hillmanGrassl(index){var n=this.arrays[index],r=structuredClone(n.numbers),o=new Array(r.length);for(let i=0;i<r.length;i++){let t=0;for(;t<r.length&&r[t][i]===1/0;)t++;o[i]=t}var l=new Array(r.length);for(let a=0;a<r.length;a++){let t=0;for(;t<r.length&&r[a][t]===1/0;)t++;l[a]=t}for(var h=[];;){let t=r[0].length-1;for(;0<=t&&o[t]<r.length&&0===r[o[t]][t];)t--;if(t<0||o[t]===r.length)break;let e=o[t],i=t;for(var s=[[e,i,r[e][i]-1]];;){if(e<r.length-1&&r[e+1][i]===r[e][i])e++;else{if(!(0<i&&r[e][i-1]!==1/0))break;i--}s.push([e,i,r[e][i]-1])}for(let a=0;a<s.length;a++)r[s[a][0]][s[a][1]]--;h.push(s)}var e=new Array(r.length);for(let y=0;y<r.length;y++){e[y]=new Array(r.length);for(let t=0;t<r.length;t++)e[y][t]=r[y][t]===1/0?1/0:0}var d=await this.addNewArray(index+1,e);await new Promise(resolve=>setTimeout(resolve,this.animationTime));for(let f=0;f<h.length;f++){var c=f/h.length*6/7;await this.colorCubes(n,h[f],c),await this.raiseCubes(n,h[f],n.height);for(let e=0;e<h[f].length;e++)n.numbers[h[f][e][0]][h[f][e][1]]--,this.in2dView&&this.drawSingleCell2dViewText(n,h[f][e][0],h[f][e][1]);this.recalculateHeights(n),await new Promise(resolve=>setTimeout(resolve,this.animationTime/5));var u=[h[f][h[f].length-1][0],h[f][0][1]];let t=[];var m=d.height+1;for(let i=o[u[1]];i<=u[0];i++)t.push([i,u[1],m]);c=t[t.length-1];for(let a=u[1]-1;a>=l[u[0]];a--)t.push([u[0],a,m]);await this.moveCubes(n,h[f],d,t),t=[];for(let r=u[0]-1;r>=o[u[1]];r--)t.push([r,u[1],m]);this.deleteCubes(d,t),t=[];for(let s=u[1]-1;s>=l[u[0]];s--)t.push([u[0],s,m]);this.deleteCubes(d,t),await this.lowerCubes(d,[c]),d.numbers[c[0]][c[1]]++,this.recalculateHeights(d),this.in2dView&&this.drawSingleCell2dViewText(d,c[0],c[1]),d.height=Math.max(d.height,d.numbers[c[0]][c[1]]),d.size=Math.max(d.size,d.height),await new Promise(resolve=>setTimeout(resolve,this.animationTime))}await this.removeArray(index)}async hillmanGrasslInverse(index){var o=this.arrays[index],r=structuredClone(o.numbers),l=[],h=new Array(r.length);for(let i=0;i<r.length;i++){let t=0;for(;t<r.length&&r[t][i]===1/0;)t++;h[i]=t}var d=new Array(r.length);for(let a=0;a<r.length;a++){let t=0;for(;t<r.length&&r[a][t]===1/0;)t++;d[a]=t}var e=new Array(r.length);for(let g=0;g<r.length;g++){e[g]=new Array(r.length);for(let t=0;t<r.length;t++)e[g][t]=r[g][t]===1/0?1/0:0}var s=structuredClone(e);const c=await this.addNewArray(index+1,e);for(let x=0;x<r.length;x++)for(let e=r.length-1;e>=h[x];e--)for(;0!==r[e][x];){var n=[];let i=e,a=d[e];for(;0<=i;){let t=a;if(0!==i)for(;s[i][t]!==s[i-1][t]&&t<x;)t++;else t=x;for(let e=a;e<=t;e++)n.push([i,e,s[i][e]]);if(!(i-1>=h[t]))break;i--,a=t}for(let t=0;t<n.length;t++)s[n[t][0]][n[t][1]]++;l.push([n,[e,x,r[e][x]-1]]),r[e][x]--}await new Promise(resolve=>setTimeout(resolve,this.animationTime/2));for(let p=0;p<l.length;p++){const b=p/l.length*6/7;await this.colorCubes(o,[l[p][1]],b);var u=l[p][1][0],m=l[p][1][1],y=o.size;for(let e=h[m];e<u;e++)o.cubes[e][m][y]=this.addCube(o,m,y,e),o.cubes[e][m][y].material.forEach(material=>material.color.setHSL(b,1,this.cubeLightness));for(let i=d[u];i<m;i++)o.cubes[u][i][y]=this.addCube(o,i,y,u),o.cubes[u][i][y].material.forEach(material=>material.color.setHSL(b,1,this.cubeLightness));await this.raiseCubes(o,[l[p][1]],y);let t=[];for(let a=u-1;a>=h[m];a--)t.push([a,m,y]);var f=this.revealCubes(o,t);t=[];for(let r=m-1;r>=d[u];r--)t.push([u,r,y]);var w=this.revealCubes(o,t);await Promise.all([f,w]),t=[];for(let s=d[u];s<m;s++)t.push([u,s,y]);t.push([u,m,o.numbers[u][m]-1]);for(let n=u-1;n>=h[m];n--)t.push([n,m,y]);f=l[p][0];const v=c.height+1;f.forEach(entry=>entry[2]=v),o.numbers[u][m]--,this.recalculateHeights(o),this.in2dView&&this.drawSingleCell2dViewText(o,u,m),await this.moveCubes(o,t,c,f),await this.lowerCubes(c,f),f.forEach(entry=>{c.numbers[entry[0]][entry[1]]++}),this.recalculateHeights(c),this.in2dView&&f.forEach(entry=>this.drawSingleCell2dViewText(c,entry[0],entry[1])),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2))}await this.removeArray(index)}async pak(index){const n=this.arrays[index],o=n.numbers;this.in2dView||await this.show2dView();let e=0,i=0;for(;e<n.footprint&&0!==n.numbers[e][n.footprint-1];)e++;for(;i<n.footprint&&0!==n.numbers[n.footprint-1][i];)i++;e=0;let l=i=0;for(let a=n.footprint-1-i;0<=a;a--)for(let t=n.footprint-1-e;0<=t;t--)o[a][t]!==1/0&&l++;let h=0;for(let m=0;m<n.footprint-i;m++)for(let s=0;s<n.footprint-e;s++)if(o[m][s]!==1/0){var d=[];let e=0;for(;m+e<n.footprint&&s+e<n.footprint;)d.push([m+e,s+e,o[m+e][s+e]-1]),e++;e=d[0][0];let i=d[0][1],t=[];for(let a=o[e][i]-2;0<=a;a--)t.push([e,i,a]);this.colorCubes(n,t,h/l*6/7),t=[],d.forEach(coordinate=>{0<=coordinate[2]&&t.push(coordinate)}),await this.colorCubes(n,t,h/l*6/7);const y=new Array(d.length);d.forEach((coordinate,index)=>{var t=coordinate[0],e=coordinate[1];let i=0,a=0;t<n.footprint-1&&(i=o[t+1][e]),e<n.footprint-1&&(a=o[t][e+1]),y[index]=Math.max(i,a),0<index?(i=o[t-1][e],a=o[t][e-1],y[index]+=Math.min(i,a)-o[t][e]):y[index]=o[t][e]-y[index]});for(let r=0;r<d.length;r++){if(e=d[r][0],i=d[r][1],y[r]>o[e][i]){var c=[];for(let t=o[e][i];t<y[r];t++)n.cubes[e][i][t]=this.addCube(n,i,t,e),c.push([e,i,t]);this.in2dView?this.revealCubes(n,c):await this.revealCubes(n,c)}else if(y[r]<o[e][i]){var u=[];for(let t=o[e][i]-1;t>=y[r];t--)u.push([e,i,t]);this.in2dView?this.deleteCubes(n,u):await this.deleteCubes(n,u)}o[e][i]=y[r],this.in2dView&&this.drawSingleCell2dViewText(n,e,i)}const f=[];t.forEach((coordinate,index)=>{0!==index&&coordinate[2]<o[coordinate[0]][coordinate[1]]&&f.push(coordinate)}),this.in2dView?this.uncolorCubes(n,f):await this.uncolorCubes(n,f),h++,this.recalculateHeights(n),0!==t.length&&await new Promise(resolve=>setTimeout(resolve,this.animationTime))}this.updateCameraHeight(!0)}async pakInverse(index,rightLegSize=0,bottomLegSize=0){const s=this.arrays[index],n=s.numbers;this.in2dView||await this.show2dView();let o=0;for(let e=s.footprint-1-bottomLegSize;0<=e;e--)for(let t=s.footprint-1-rightLegSize;0<=t;t--)n[e][t]!==1/0&&o++;let l=0;for(let m=s.footprint-1-bottomLegSize;0<=m;m--)for(let t=s.footprint-1-rightLegSize;0<=t;t--)if(n[m][t]!==1/0){var h=[];let e=0;for(;m+e<s.footprint&&t+e<s.footprint;)h.push([m+e,t+e,n[m+e][t+e]-1]),e++;e=h[0][0];let i=h[0][1];const y=new Array(h.length);let r=!1;if(h.forEach((coordinate,index)=>{var t=coordinate[0],e=coordinate[1];let i=0,a=0;t<s.footprint-1&&(i=n[t+1][e]),e<s.footprint-1&&(a=n[t][e+1]),y[index]=Math.max(i,a),0<index?(i=n[t-1][e],a=n[t][e-1],y[index]+=Math.min(i,a)-n[t][e]):y[index]+=n[t][e],r||y[index]===n[t][e]||(r=!0)}),0!==n[e][i]){var d=[];for(let t=n[e][i]-1;0<=t;t--)d.push([e,i,t]);this.colorCubes(s,d,l/o*6/7)}else if(0!==y[0])s.cubes[e][i][0]=this.addCube(s,i,0,e,l/o*6/7,1,this.cubeLightness),n[e][i]=1,this.revealCubes(s,[[e,i,0]]);else if(!r){l++;continue}await new Promise(resolve=>setTimeout(resolve,this.animationTime));for(let a=0;a<h.length;a++){if(e=h[a][0],i=h[a][1],y[a]>n[e][i]){var c=[];for(let t=n[e][i];t<y[a];t++)s.cubes[e][i][t]=this.addCube(s,i,t,e,l/o*6/7,1,this.cubeLightness),c.push([e,i,t]);this.in2dView?this.revealCubes(s,c):await this.revealCubes(s,c)}else if(y[a]<n[e][i]){var u=[];for(let t=n[e][i]-1;t>=y[a];t--)u.push([e,i,t]);this.in2dView?this.deleteCubes(s,u):await this.deleteCubes(s,u)}n[e][i]=y[a],this.in2dView&&this.drawSingleCell2dViewText(s,e,i)}l++,this.recalculateHeights(s),await new Promise(resolve=>setTimeout(resolve,this.animationTime))}this.updateCameraHeight(!0)}async sulzgruber(index){const s=this.arrays[index],n=structuredClone(s.numbers);var o=new Array(n.length);for(let r=0;r<n.length;r++){let t=0;for(;t<n.length&&n[t][r]===1/0;)t++;o[r]=t}var l=new Array(n.length);for(let p=0;p<n.length;p++){let t=0;for(;t<n.length&&n[p][t]===1/0;)t++;l[p]=t}var i,a,h={},d={};for(let t=0;t<n.length;t++)d[-t]=[t,0];for(let b=1;b<n.length;b++)d[b]=[0,b];for(let v=1-n.length;v<n.length;v++){let t=d[v][0],e=d[v][1];for(;t<n.length&&e<n.length&&n[t][e]===1/0;)t++,e++;d[v]=[t,e],t===n.length||e===n.length?h[v]=-1:(i=0===e||n[t][e-1]===1/0,a=0===t||n[t-1][e]===1/0,h[v]=i&&a?0:i?3:a?2:1)}var c=[];for(let T=1-n.length;T<n.length;T++)if(1!==h[T]&&3!==h[T]){let a=d[T][0],r=d[T][1];if(0!==n[a][r])for(;;){let t=!1;for(;a<n.length&&r<n.length&&0!==n[a][r];){if((r<n.length-1&&n[a][r]>n[a][r+1]||r===n.length-1&&0<n[a][r])&&(0===h[T]||2===h[T]&&(a<n.length-1&&n[a][r]>n[a+1][r]||a===n.length-1&&0<n[a][r]))){t=!0;break}a++,r++}if(!t)break;let e=a,i=r;for(var u=[[e,i,n[e][i]-1]];;){var m=i-e;if(e<n.length-1&&n[e][i]===n[e+1][i]&&(0===h[m]||3===h[m]))e++;else{if(!(i>l[e]&&(e===n.length-1||e<n.length-1&&n[e][i]>n[e+1][i])))break;i--}u.push([e,i,n[e][i]-1])}u.forEach(box=>n[box[0]][box[1]]--),c.push(u)}}var e=new Array(n.length);for(let H=0;H<n.length;H++){e[H]=new Array(n.length);for(let t=0;t<n.length;t++)e[H][t]=n[H][t]===1/0?1/0:0}var y=await this.addNewArray(index+1,e);await new Promise(resolve=>setTimeout(resolve,this.animationTime));for(let A=0;A<c.length;A++){var f=A/c.length*6/7,w=(await this.colorCubes(s,c[A],f),await this.raiseCubes(s,c[A],s.height+1),c[A].forEach(box=>{s.numbers[box[0]][box[1]]--,this.in2dView&&this.drawSingleCell2dViewText(s,box[0],box[1])}),this.recalculateHeights(s),await new Promise(resolve=>setTimeout(resolve,this.animationTime/5)),c[A][c[A].length-1][0]),g=d[c[A][c[A].length-1][1]-w+c[A].length-1][1];let t=[];var x=Math.max(s.height+1,y.height+1);for(let e=o[g];e<=w;e++)t.push([e,g,x]);for(let i=g-1;i>=l[w];i--)t.push([w,i,x]);await this.moveCubes(s,c[A],y,t),t=[];for(let a=w-1;a>=o[g];a--)t.push([a,g,x]);this.deleteCubes(y,t),t=[];for(let r=g-1;r>=l[w];r--)t.push([w,r,x]);this.deleteCubes(y,t),await this.lowerCubes(y,[[w,g,x]]),y.numbers[w][g]++,this.in2dView&&this.drawSingleCell2dViewText(y,w,g),this.recalculateHeights(y),await new Promise(resolve=>setTimeout(resolve,this.animationTime))}await this.removeArray(index)}async sulzgruberInverse(index){var c=this.arrays[index],u=c.numbers,m=new Array(u.length);for(let i=0;i<u.length;i++){let t=0;for(;t<u.length&&u[t][i]===1/0;)t++;m[i]=t}var y=new Array(u.length);for(let a=0;a<u.length;a++){let t=0;for(;t<u.length&&u[a][t]===1/0;)t++;y[a]=t}var f={};for(let t=0;t<u.length;t++)f[-t]=[t,0];for(let r=1;r<u.length;r++)f[r]=[0,r];for(let s=1-u.length;s<u.length;s++){let t=f[s][0],e=f[s][1];for(;t<u.length&&e<u.length&&u[t][e]===1/0;)t++,e++;f[s]=[t,e]}let w=0;var e=new Array(u.length);for(let n=0;n<u.length;n++){e[n]=new Array(u.length);for(let t=0;t<u.length;t++)u[n][t]===1/0?e[n][t]=1/0:(e[n][t]=0,w+=u[n][t])}const g=await this.addNewArray(index+1,e);let x=0;for(let S=u.length-1;0<=S;S--)for(let d=u.length-1;0<=d;d--)if(u[d][S]!==1/0)for(;0!==u[d][S];){const R=x/w*6/7;var p=Math.max(c.size+1,g.size+1),b=(await this.colorCubes(c,[[d,S,u[d][S]-1]],R),await this.raiseCubes(c,[[d,S,u[d][S]-1]],p),d),v=S;for(let t=m[v];t<b;t++)c.cubes[t][v][p]=this.addCube(c,v,p,t),c.cubes[t][v][p].material.forEach(material=>material.color.setHSL(R,1,this.cubeLightness));for(let e=y[b];e<v;e++)c.cubes[b][e][p]=this.addCube(c,e,p,b),c.cubes[b][e][p].material.forEach(material=>material.color.setHSL(R,1,this.cubeLightness));let a=[];for(let i=b-1;i>=m[v];i--)a.push([i,v,p]);var T=this.revealCubes(c,a);a=[];for(let n=v-1;n>=y[b];n--)a.push([b,n,p]);var H=this.revealCubes(c,a);await Promise.all([T,H]),a=[];for(let o=y[b];o<v;o++)a.push([b,o,p]);a.push([b,v,c.numbers[b][v]-1]);for(let l=b-1;l>=m[v];l--)a.push([l,v,p]);var T=y[b]-b,A=T+a.length-1,C=[];for(let h=T;h<=A;h++)C.push(structuredClone(f[h]));u[b][v]--,this.recalculateHeights(c),this.in2dView&&this.drawSingleCell2dViewText(c,b,v),await this.moveCubes(c,a,g,C);let r=0,s=g.numbers[C[0][0]][C[0][1]];for(;;){let t=r;for(;t<C.length&&C[t][0]===C[r][0];)t++;a=C.slice(r,t);let e=!0;for(let i=0;i<a.length;i++)if(g.numbers[a[i][0]][a[i][1]]!==s){e=!1;break}if(e)await this.lowerCubes(g,a),a.forEach(coordinate=>{g.numbers[coordinate[0]][coordinate[1]]++}),this.recalculateHeights(g),this.in2dView&&a.forEach(entry=>{this.drawSingleCell2dViewText(g,entry[0],entry[1])}),r=t;else{var E=structuredClone(C.slice(r));for(let t=r;t<C.length;t++)if(C[t][0]++,C[t][1]++,C[t][0]>g.footprint||C[t][1]>g.footprint)return void console.error("Insertion failed!");var z=C.slice(r);await this.moveCubes(g,E,g,z),s=g.numbers[C[r][0]][C[r][1]]}if(r===C.length)break}x++,await new Promise(resolve=>setTimeout(resolve,this.animationTime/2))}await this.removeArray(index)}async rsk(index){var u=this.arrays[index],m=this.arrays[index+1],y=u.numbers,f=m.numbers;let i=0,w=0;for(let e=0;e<y.length;e++)for(let t=0;t<y.length;t++){if(y[e][t]===1/0||f[e][t]===1/0)return this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),void(this.currentlyRunningAlgorithm=!1);0!==y[e][t]&&w++,i=Math.max(Math.max(i,y[e][t]),f[e][t])}if(0===i)this.displayError("The SSYT are empty!"),this.currentlyRunningAlgorithm=!1;else{var g=new Array(i);for(let e=0;e<i;e++){g[e]=new Array(i);for(let t=0;t<i;t++)g[e][t]=0}var x=await this.addNewArray(index+2,g);let c=0;for(;0!==f[0][0];){var p=c/w*6/7;let e=0,i=0,a=0;for(let o=0;o<f.length;o++){let t=f.length-1;for(;0<=t&&0===f[o][t];)t--;0<=t&&(e=Math.max(e,f[o][t]))}for(let l=0;l<f.length;l++){let t=f.length-1;for(;0<=t&&0===f[l][t];)t--;if(f[l][t]===e){i=l,a=t;break}}var b=[],v=[],T=[],H=[],A=[],C=[];let r=i,s=a,n=y[r][s];for(var E=f[r][s],z=[[r,s]];0!==r;){let t=y.length-1;for(;0===y[r-1][t]||n<=y[r-1][t];)t--;for(let e=0;e<n;e++)b.push([r,s,e]),v.push([r-1,t,e]);r--,s=t,n=y[r][s],z.push([r,s])}var S=x.height+1;for(let t=0;t<n;t++)T.push([r,s,t]),H.push([E-1,t,S]);for(let h=0;h<E-1;h++)A.push([i,a,h]),C.push([h,n-1,S]);this.colorCubes(m,A.concat([[i,a,E-1]]),p),this.colorCubes(u,b,p),await this.colorCubes(u,T,p),f[i][a]=0;for(let d=z.length-1;0<d;d--)y[z[d][0]][z[d][1]]=y[z[d-1][0]][z[d-1][1]];if(y[i][a]=0,this.in2dView){this.drawSingleCell2dViewText(u,i,a);for(let t=z.length-1;0<t;t--)this.drawSingleCell2dViewText(u,z[t][0],z[t][1]);this.drawSingleCell2dViewText(m,i,a)}await Promise.all([this.moveCubes(m,A,x,C),this.moveCubes(u,T,x,H),this.moveCubes(u,b,u,v),this.moveCubes(m,[[i,a,E-1]],x,[[E-1,n-1,S]],!1)]),this.uncolorCubes(u,v),x.cubeGroup.remove(m.cubes[i][a][E-1]),this.deleteCubes(m,[[i,a,E-1]],!0,!0),H.reverse(),C.reverse(),this.deleteCubes(x,H.slice(1)),this.deleteCubes(x,C),await this.lowerCubes(x,[[E-1,n-1,S]]),g[E-1][n-1]++,this.in2dView&&this.drawSingleCell2dViewText(x,E-1,n-1),this.recalculateHeights(x),c++,await new Promise(resolve=>setTimeout(resolve,this.animationTime/2))}await this.removeArray(index),await new Promise(resolve=>setTimeout(resolve,this.animationTime)),await this.removeArray(index)}}async rskInverse(index){var h=this.arrays[index],r=structuredClone(h.numbers);let d=0,c=(r.forEach(row=>row.forEach(entry=>d+=entry)),new Array(d)),u=new Array(d);for(let i=0;i<d;i++){c[i]=new Array(d),u[i]=new Array(d);for(let t=0;t<d;t++)c[i][t]=0,u[i][t]=0}var s=new Array(r.length);for(let t=0;t<r.length;t++)s[t]=0;let n=0;var m=[],y=[],f=[];for(let P=0;P<r.length;P++)for(let a=0;a<r.length;a++)for(;0!==r[P][a];){r[P][a]--;let t=a+1,e=0,i=0;for(var o=[];;){for(i=s[e];0!==i&&c[e][i-1]>t;)i--;if(i===s[e]){c[e][i]=t,s[e]++,0===i&&n++,o.push([e,i]);break}var l=c[e][i];c[e][i]=t,t=l,o.push([e,i]),e++}m.push(o),y.push([e,i]),f.push([P,a]),u[e][i]=P+1}var e=Math.max(s[0],n);c=new Array(e),u=new Array(e);for(let a=0;a<e;a++){c[a]=new Array(e),u[a]=new Array(e);for(let t=0;t<e;t++)c[a][t]=0,u[a][t]=0}var w=await this.addNewArray(index+1,c),g=(await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),await this.addNewArray(index+2,u));await new Promise(resolve=>setTimeout(resolve,this.animationTime/2));let x=0;for(let N=0;N<f.length;N++){var p=f[N][0],b=f[N][1],v=h.height+1;const F=x/d*6/7;for(let e=b;0<=e;e--)h.cubes[p][e][v]=this.addCube(h,e,v,p),h.cubes[p][e][v].material.forEach(material=>material.color.setHSL(F,1,this.cubeLightness));for(let i=p-1;0<=i;i--)h.cubes[i][b][v]=this.addCube(h,b,v,i),h.cubes[i][b][v].material.forEach(material=>material.color.setHSL(F,1,this.cubeLightness));h.cubes[p][b][v+1]=this.addCube(h,b,v,p),h.cubes[p][b][v+1].material.forEach(material=>material.color.setHSL(F,1,this.cubeLightness)),await this.colorCubes(h,[[p,b,h.numbers[p][b]-1]],F),await this.raiseCubes(h,[[p,b,h.numbers[p][b]-1]],v);var T=this.revealCubes(h,[[p,b,v+1]]);let t=[];for(let a=b-1;0<=a;a--)t.push([p,a,v]);var H=this.revealCubes(h,t);t=[];for(let r=p-1;0<=r;r--)t.push([r,b,v]);var A=this.revealCubes(h,t),C=(await Promise.all([T,H,A]),m[x]),E=[],z=[],S=[[p,b,h.numbers[p][b]-1]],R=[[C[0][0],C[0][1],b]],V=[[p,b,v+1]],M=[[y[x][0],y[x][1],p]];for(let s=b-1;0<=s;s--)S.push([p,s,v]),R.push([C[0][0],C[0][1],s]);for(let n=0;n<C.length-1;n++)for(let t=0;t<c[C[n][0]][C[n][1]];t++)E.push([C[n][0],C[n][1],t]),z.push([C[n+1][0],C[n+1][1],t]);for(let o=p-1;0<=o;o--)V.push([o,b,v]),M.push([y[x][0],y[x][1],o]);await this.colorCubes(w,E,F);for(let l=C.length-1;0<l;l--)c[C[l][0]][C[l][1]]=c[C[l-1][0]][C[l-1][1]];0!==C.length&&(c[C[0][0]][C[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==E.length&&await this.moveCubes(w,E,w,z),h.numbers[p][b]--,this.in2dView&&this.drawAll2dViewText(),await Promise.all([this.moveCubes(h,S,w,R),this.moveCubes(h,V,g,M)]),c[C[0][0]][C[0][1]]=b+1,u[y[x][0]][y[x][1]]=p+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(h),this.recalculateHeights(w),this.recalculateHeights(g),x++,await new Promise(resolve=>setTimeout(resolve,this.animationTime/2))}await this.removeArray(index)}async godar1(index){var t;let i=this.arrays[index].numbers;var a=new Array(2*i.length),e=new Array(2*i.length);for(let H=0;H<i.length;H++){let t=0;for(;t<i.length&&i[H][t]===1/0;)t++;for(a[H]=t,t=0;t<i.length&&i[t][H]===1/0;)t++;e[H]=t}for(let A=i.length;A<2*i.length;A++)a[A]=0,e[A]=0;var r=Math.max(a[0],e[0]),s=new Array(i.length);for(let C=0;C<i.length;C++){s[C]=new Array(i.length);for(let t=0;t<i.length;t++)i[C][t]===1/0?s[C][t]=this.infiniteHeight:s[C][t]=i[C][t]}await this.addNewArray(index+1,s),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),await this.removeArray(index),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),t=this.arrays[index],i=t.numbers;let n=0,o=0;for(;n<i.length&&0!==i[n][i.length-1];)n++;for(;o<i.length&&0!==i[i.length-1][o];)o++;await this.runAlgorithm("pak",index,!0),await new Promise(resolve=>setTimeout(resolve,2*this.animationTime)),t=this.arrays[index],i=t.numbers;var W=Math.max(n,o),l=new Array(i.length-W+1),L=[];for(let E=0;E<l.length-1;E++){l[E]=new Array(l.length);for(let e=0;e<l.length-1;e++){l[E][e]=i[E][e];for(let t=0;t<i[E][e];t++)L.push([E,e,t]);i[E][e]=0}l[E][l.length-1]=0}l[l.length-1]=new Array(l.length);for(let z=0;z<l.length;z++)l[l.length-1][z]=0;this.deleteCubes(t,L,!0,!0),await this.addNewArray(index,l),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),await this.runAlgorithm("pakInverse",index,!0),await new Promise(resolve=>setTimeout(resolve,2*this.animationTime));var k=2*i.length-a[i.length-1]-e[i.length-1],O=a[0]+e[0],h=new Array(4*i.length),d=new Array(O),c=new Array(4*i.length);for(let S=0;S<4*i.length;S++)h[S]=new Array;for(let R=0;R<O;R++)d[R]=new Array;for(let Y=0;Y<4*i.length;Y++)c[Y]=new Array;let u=1;for(let V=0;V<2*i.length;V++)for(let t=0;t<2*i.length;t++)t>=a[V]?h[V+t+1-a[V]-e[t]].push([V,t]):d[a[V]+e[t]-V-t-1].unshift([r-V-1,r-t-1]),c[V+t+1].push([V,t]);var m=new Array(2*i.length);for(let $=0;$<2*i.length;$++)m[$]=new Array(2*i.length);for(let M=1;M<k;M++){var y=[];for(let t=0;t<h[M].length;t++){var f=h[M][t][0],w=h[M][t][1];if(f<i.length-o&&w<i.length-n)for(let t=0;t<this.arrays[index].numbers[f][w];t++)y.push([f,w,t]);t<c[M].length?(m[f][w]=[1,c[M][t]],f<i.length&&w<i.length&&0<this.arrays[index].numbers[f][w]&&(u=Math.max(Math.max(u,c[M][t][0]+1),c[M][t][1]+1))):m[f][w]=[0,d[M][t-c[M].length]]}0!==y.length&&this.colorCubes(this.arrays[index],y,(M-1)/(k-1)*6/7)}await new Promise(resolve=>setTimeout(resolve,3*this.animationTime));var g=new Array(r);for(let P=0;P<r;P++){g[P]=new Array(r);for(let t=0;t<r;t++)t<r-a[r-P-1]?g[P][t]=1/0:g[P][t]=0}let G=null;0<r&&(G=await this.addNewArray(index+1,g),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)));var x=new Array(u);for(let N=0;N<u;N++){x[N]=new Array(u);for(let t=0;t<u;t++)x[N][t]=0}var I=await this.addNewArray(index+2,x);for(let F=0;F<i.length-o;F++)for(let e=a[F];e<i.length-n;e++)if(0<this.arrays[index].numbers[F][e]){var p=[],b=[],v=m[F][e][1][0],T=m[F][e][1][1];for(let t=0;t<this.arrays[index].numbers[F][e];t++)p.push([F,e,t]),b.push([v,T,t]);0===m[F][e][0]?(await this.moveCubes(this.arrays[index],p,G,b),g[v][T]=this.arrays[index].numbers[F][e]):(await this.moveCubes(this.arrays[index],p,I,b),x[v][T]=this.arrays[index].numbers[F][e]),this.arrays[index].numbers[F][e]=0,this.in2dView&&this.drawAll2dViewText()}await new Promise(resolve=>setTimeout(resolve,3*this.animationTime)),await this.runAlgorithm("pakInverse",index,!0),0<r&&await this.runAlgorithm("hillmanGrasslInverse",index+1,!0)}async godar1Inverse(index){var i=this.arrays[index+1].numbers,a=this.arrays[index].numbers,e=new Array(i.length+2*a.length),r=new Array(i.length+2*a.length);for(let b=0;b<i.length+2*a.length;b++)e[b]=0,r[b]=0;for(let v=0;v<a.length;v++){let t=a.length-1;for(;0<=t&&a[v][t]!==1/0;)t--;for(e[a.length-v-1]=a.length-t-1,t=a.length-1;0<=t&&a[t][v]!==1/0;)t--;r[a.length-v-1]=a.length-t-1}await this.runAlgorithm("pak",index,!0),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),await this.runAlgorithm("pak",index+1,!0),await new Promise(resolve=>setTimeout(resolve,3*this.animationTime));let s=[],n=this.arrays[index].numbers;for(let T=0;T<n.length;T++)for(let e=0;e<n.length;e++)if(n[T][e]!==1/0)for(let t=0;t<n[T][e];t++)s.push([T,e,t]);this.uncolorCubes(this.arrays[index],s),s=[],n=this.arrays[index+1].numbers;for(let H=0;H<n.length;H++)for(let e=0;e<n.length;e++)if(n[H][e]!==1/0)for(let t=0;t<n[H][e];t++)s.push([H,e,t]);await this.uncolorCubes(this.arrays[index+1],s);let o=Math.max(e[0],r[0])+2*i.length-1;var t=2*o,l=e[0]+r[0],h=2*i.length,d=new Array(t),c=new Array(l),u=new Array(h);for(let A=0;A<t;A++)d[A]=new Array;for(let C=0;C<l;C++)c[C]=new Array;for(let E=0;E<h;E++){u[E]=new Array(E);for(let t=0;t<E;t++)u[E][t]=-1}for(;e.length<o;)e.push(0);for(;r.length<o;)r.push(0);for(let z=0;z<o;z++)for(let t=0;t<o;t++)t>=e[z]?d[z+t+1-e[z]-r[t]].push([z,t]):c[e[z]+r[t]-z-t-1].unshift([a.length-z-1,a.length-t-1]),z<i.length&&t<i.length&&(u[z+t+1][z]=[z,t]);var m=new Array(i.length);for(let S=0;S<i.length;S++)m[S]=new Array(i.length);var y=new Array(a.length);for(let R=0;R<a.length;R++)y[R]=new Array(a.length);for(let V=o=1;V<l;V++){const s=[];for(let e=0;e<c[V].length;e++){var f=c[V][e][0],w=c[V][e][1];for(let t=0;t<this.arrays[index].numbers[f][w];t++)s.push([f,w,t]);y[f][w]=d[V][e+u[V].length],0!==this.arrays[index].numbers[f][w]&&(o=Math.max(Math.max(o,y[f][w][0]+1),y[f][w][1]+1))}0!==s.length&&this.colorCubes(this.arrays[index],s,(V-1)/(l-1)*6/7)}for(let M=1;M<h;M++){const s=[];for(let e=0;e<u[M].length;e++)if(-1!==u[M][e]){var g=u[M][e][0],x=u[M][e][1];for(let t=0;t<this.arrays[index+1].numbers[g][x];t++)s.push([g,x,t]);m[g][x]=d[M][e],0!==this.arrays[index+1].numbers[g][x]&&(o=Math.max(Math.max(o,m[g][x][0]+1),m[g][x][1]+1))}0!==s.length&&this.colorCubes(this.arrays[index+1],s,(M-1)/(h-1)*6/7)}await new Promise(resolve=>setTimeout(resolve,3*this.animationTime));var p=new Array(o);for(let P=0;P<o;P++){p[P]=new Array(o);for(let t=0;t<o;t++)t<e[P]?p[P][t]=1/0:p[P][t]=0}var W=await this.addNewArray(index+2,p);await new Promise(resolve=>setTimeout(resolve,this.animationTime/2));for(let N=0;N<a.length;N++)for(let e=0;e<a.length;e++)if(0<this.arrays[index].numbers[N][e]&&this.arrays[index].numbers[N][e]!==1/0){var L=[],k=[],O=y[N][e][0],G=y[N][e][1];for(let t=0;t<this.arrays[index].numbers[N][e];t++)L.push([N,e,t]),k.push([O,G,t]);await this.moveCubes(this.arrays[index],L,W,k),p[O][G]=this.arrays[index].numbers[N][e],this.arrays[index].numbers[N][e]=0,this.in2dView&&this.drawAll2dViewText()}for(let F=0;F<i.length;F++)for(let e=0;e<i.length;e++)if(0<this.arrays[index+1].numbers[F][e]&&this.arrays[index+1].numbers[F][e]!==1/0){var I=[],Y=[],$=m[F][e][0],B=m[F][e][1];for(let t=0;t<this.arrays[index+1].numbers[F][e];t++)I.push([F,e,t]),Y.push([$,B,t]);await this.moveCubes(this.arrays[index+1],I,W,Y),p[$][B]=this.arrays[index+1].numbers[F][e],this.arrays[index+1].numbers[F][e]=0,this.in2dView&&this.drawAll2dViewText()}await this.removeArray(index),await new Promise(resolve=>setTimeout(resolve,this.animationTime/2)),await this.removeArray(index),await new Promise(resolve=>setTimeout(resolve,3*this.animationTime)),await this.runAlgorithm("pakInverse",index,!0),await new Promise(resolve=>setTimeout(resolve,this.animationTime))}async drawBoundary(index,n){this.in2dView||await this.show2dView(),"0"!==this.wilsonNumbers.canvas.style.opacity&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/3),this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight);const t=this.arrays[index];var e,i=t.numbers,a=[];let r=0,s=0;for(let h=t.footprint-1;0<=h;h--){for(;s<t.footprint&&i[h][s]===1/0;)h!==t.footprint-1&&i[h+1][s]===1/0||(e=r%n/n,e=this.wilson.utils.hsvToRgb(e,1,1),a.push([h,s,!0,`rgba(${e[0]}, ${e[1]}, ${e[2]}, `]),r++),s++;var o=r%n/n,o=this.wilson.utils.hsvToRgb(o,1,1);a.push([h,s,!1,`rgba(${o[0]}, ${o[1]}, ${o[2]}, `]),r++}for(var l;s<t.footprint;)-1!=t.footprint-1&&i[0][s]===1/0||(l=r%n/n,l=this.wilson.utils.hsvToRgb(l,1,1),a.push([-1,s,!0,`rgba(${l[0]}, ${l[1]}, ${l[2]}, `]),r++),s++;return a.forEach(rect=>{this.drawBoundaryRect(t,rect[0],rect[1],rect[2],rect[3]+" 1)")}),await changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/3),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",a}async drawNQuotient(index,n,m,rects){const i=this.arrays[index],e={t:1};await anime({targets:e,t:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{var t=index%n===m?1:e.t;this.drawBoundaryRect(i,rect[0],rect[1],rect[2],rect[3]+` ${t})`)})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{var t=index%n===m?1:0;this.drawBoundaryRect(i,rect[0],rect[1],rect[2],rect[3]+` ${t})`)});var t=(rects=rects.filter((rect,index)=>index%n===m)).filter(rect=>!rect[2]).length;const a=new Array(rects.length);let r=t-1,s=0;rects.forEach((rect,index)=>{a[index]=[r,s],rect[2]?s++:r--}),e.t=0,await anime({targets:e,t:1,duration:this.animationTime,easing:"easeInOutQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{this.drawBoundaryRect(i,(1-e.t)*rect[0]+e.t*a[index][0],(1-e.t)*rect[1]+e.t*a[index][1],rect[2],rect[3]+" 1)")})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{this.drawBoundaryRect(i,a[index][0],a[index][1],rect[2],rect[3]+" 1)")});const o=[],l=(a.forEach((rect,index)=>{if(!rects[index][2])for(let e=rect[1];e<i.footprint;e++)if(i.numbers[rect[0]][e]===1/0)for(let t=0;t<this.infiniteHeight;t++)o.push([rect[0],e,t])}),this.deleteCubes(i,o,!0),[]);for(let h=i.footprint-1;h>a[0][0];h--)l.push([h,0,!1]);for(let d=a[a.length-1][1];d<i.footprint;d++)l.push([-1,d,!0]);e.t=0,await anime({targets:e,t:1,duration:this.animationTime/2,easing:"easeInQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{this.drawBoundaryRect(i,a[index][0],a[index][1],rect[2],rect[3]+" 1)")}),l.forEach(rect=>{this.drawBoundaryRect(i,rect[0],rect[1],rect[2],`${rects[0][3]} ${e.t})`)})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),rects.forEach((rect,index)=>{this.drawBoundaryRect(i,a[index][0],a[index][1],rect[2],rect[3]+" 1)")}),l.forEach(rect=>{this.drawBoundaryRect(i,rect[0],rect[1],rect[2],rects[0][3]+" 1)")}),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)"}drawBoundaryRect(array,i,j,horizontal,rgba){var t=(this.totalArrayFootprint-array.footprint-1)/2,e=array.partialFootprintSum-array.footprint;this.wilsonNumbers.ctx.fillStyle=rgba,horizontal?this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(j+e+1)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(i+t+1+.9375)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(1/16)/(this.totalArrayFootprint+1)):this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(j+e+.9375)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(i+t+1)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth*(1/16)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight/(this.totalArrayFootprint+1))}}export{PlanePartitions};