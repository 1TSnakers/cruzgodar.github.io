import{getMinimalABConfig,isValidABConfig,iterateThroughEntries,printABConfig}from"./abConfigs.min.js";import{addCube,addFloor,addLeftWall,addRightWall}from"./addGeometry.min.js";import{godar1,godar1Inverse}from"./algorithms/goder1.min.js";import{hillmanGrassl,hillmanGrasslInverse}from"./algorithms/hillmanGrassl.min.js";import{pak,pakInverse}from"./algorithms/pak.min.js";import{rsk,rskInverse}from"./algorithms/rsk.min.js";import{sulzgruber,sulzgruberInverse}from"./algorithms/sulzgruber.min.js";import{hideDimers,show2dView,showDimers,showHexView,updateCameraHeight}from"./cameraControls.min.js";import{addNewArray,editArray,removeArray,trimArray}from"./editArrays.min.js";import{generateRandomPlanePartition,generateRandomSsyt,generateRandomTableau}from"./generateRandomData.min.js";import{drawAll2dViewText,drawSingleCell2dViewText,hideFloor,recalculateHeights,removeOutsideFloor,showFloor}from"./miscUtils.min.js";import{drawBoundary,drawBoundaryRect,drawNQuotient}from"./nQuotients.min.js";import{arrayToAscii,parseArray,verifyPp,verifySsyt}from"./parseAndVerify.min.js";import{runAlgorithm,runExample}from"./runAlgorithm.min.js";import{colorCubes,deleteCubes,deleteFloor,lowerCubes,moveCubes,raiseCubes,revealCubes,uncolorCubes}from"./styleCubes.min.js";import{AnimationFrameApplet}from"/scripts/applets/animationFrameApplet.min.js";import{convertColor}from"/scripts/src/browser.min.js";import{$$}from"/scripts/src/main.min.js";import*as THREE from"/scripts/three.js";import{Wilson}from"/scripts/wilson.min.js";class PlanePartitions extends AnimationFrameApplet{wilsonNumbers;wilsonHidden;wilsonHidden2;wilsonHidden3;wilsonHidden4;useFullscreenButton=!1;backgroundColor=0;resolution=2e3;animationTime=600;asymptoteLightness=.6;cubeLightness=.4;floorLightness=.4;infiniteHeight=100;addWalls=!1;wallWidth=17;wallHeight=17;scene;orthographicCamera;renderer;loader;cubeTexture;cubeTexture2;floorTexture;floorTexture2;cubeGeometry;floorGeometry;wallLeftGeometry;wallRightGeometry;ambientLight;dimersShown=!1;pointLight;rotationY=0;rotationYVelocity=0;nextRotationYVelocity=0;lastRotationYVelocities=[];rotationYVelocityFriction=.94;rotationYVelocityStartThreshhold=.005;rotationYVelocityStopThreshhold=5e-4;in2dView=!1;inExactHexView=!0;currentlyAnimatingCamera=!1;currentlyRunningAlgorithm=!1;needDownload=!1;fontSize=10;arrays=[];totalArrayFootprint=0;totalArrayHeight=0;totalArraySize=0;hexViewCameraPos=[15,15,15];_2dViewCameraPos=[0,20,0];constructor({canvas,numbersCanvas,useFullscreenButton=!0}){super(canvas),this.useFullscreenButton=useFullscreenButton;var e=this.createHiddenCanvas(),t=this.createHiddenCanvas(),i=this.createHiddenCanvas(),r=this.createHiddenCanvas(),s={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!1,mousedownCallback:this.onGrabCanvas.bind(this),touchstartCallback:this.onGrabCanvas.bind(this),mousedragCallback:this.onDragCanvas.bind(this),touchmoveCallback:this.onDragCanvas.bind(this),mouseupCallback:this.onReleaseCanvas.bind(this),touchendCallback:this.onReleaseCanvas.bind(this)},s=(this.wilsonNumbers=new Wilson(numbersCanvas,s),this.wilsonNumbers.ctx.fillStyle=convertColor(255,255,255),document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),$$(".wilson-applet-canvas-container").forEach(element=>element.style.setProperty("background-color",convertColor(0,0,0,0),"important")),{renderer:"gpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:this.useFullscreenButton,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:this.switchFullscreen.bind(this)}),s=(this.wilson=new Wilson(canvas,s),{renderer:"cpu",canvasWidth:64,canvasHeight:64});this.wilsonHidden=new Wilson(e,s),this.wilsonHidden2=new Wilson(t,s),this.wilsonHidden3=new Wilson(i,s),this.wilsonHidden4=new Wilson(r,s),this.wilsonHidden.ctx.strokeStyle="rgba(255, 255, 255, 0)",this.wilsonHidden.ctx._alpha=1,this.wilsonHidden.ctx.fillStyle=convertColor(64,64,64),this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=convertColor(128,128,128),this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.lineWidth=6,this.wilsonHidden2.ctx.strokeStyle="rgba(255, 255, 255, 0)",this.wilsonHidden2.ctx._alpha=1,this.wilsonHidden2.ctx.fillStyle=convertColor(64,64,64),this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=convertColor(128,128,128),this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.lineWidth=6,this.wilsonHidden3.ctx.strokeStyle="rgba(255, 255, 255, 0)",this.wilsonHidden3.ctx._alpha=1,this.wilsonHidden3.ctx.fillStyle=convertColor(32,32,32,this.addWalls?1:0),this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=convertColor(64,64,64,this.addWalls?1:0),this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.lineWidth=6,this.wilsonHidden4.ctx.strokeStyle="rgba(255, 255, 255, 0)",this.wilsonHidden4.ctx._alpha=1,this.wilsonHidden4.ctx.fillStyle=convertColor(32,32,32,this.addWalls?1:0),this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=convertColor(64,64,64,this.addWalls?1:0),this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.lineWidth=6,this.scene=new THREE.Scene,this.scene.background=new THREE.Color(this.backgroundColor),this.orthographicCamera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0,context:this.wilson.gl}),this.renderer.setSize(this.resolution,this.resolution,!1),this.renderer.useLegacyLights=!0,this.loader=new THREE.TextureLoader,this.cubeTexture=new THREE.CanvasTexture(this.wilsonHidden.canvas),this.cubeTexture.minFilter=THREE.LinearFilter,this.cubeTexture.magFilter=THREE.NearestFilter,this.cubeTexture2=new THREE.CanvasTexture(this.wilsonHidden2.canvas),this.cubeTexture2.minFilter=THREE.LinearFilter,this.cubeTexture2.magFilter=THREE.NearestFilter,this.floorTexture=new THREE.CanvasTexture(this.wilsonHidden3.canvas),this.floorTexture.minFilter=THREE.LinearFilter,this.floorTexture.magFilter=THREE.NearestFilter,this.floorTexture2=new THREE.CanvasTexture(this.wilsonHidden4.canvas),this.floorTexture2.minFilter=THREE.LinearFilter,this.floorTexture2.magFilter=THREE.NearestFilter,this.cubeGeometry=new THREE.BoxGeometry,this.dimersShown=!1,this.floorGeometry=new THREE.BoxGeometry(1,.001,1),this.wallLeftGeometry=new THREE.BoxGeometry(.001,1,1),this.wallRightGeometry=new THREE.BoxGeometry(1,1,.001),this.ambientLight=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,3,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.resume()}onGrabCanvas(){this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.needNewFrame=!0}onDragCanvas(x,y,xDelta){this.in2dView||(this.rotationY+=xDelta,this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.scene.children.forEach(object=>object.rotation.y=this.rotationY),this.nextRotationYVelocity=xDelta,this.needNewFrame=!0)}onReleaseCanvas(){if(!this.in2dView){let e=0;if(this.lastRotationYVelocities.forEach((velocity,index)=>{Math.abs(velocity)>this.rotationYVelocity&&(this.rotationYVelocity=Math.abs(velocity),e=index)}),this.rotationYVelocity<this.rotationYVelocityStartThreshhold)return void(this.rotationYVelocity=0);this.rotationYVelocity=this.lastRotationYVelocities[e]}this.lastRotationYVelocities=[0,0,0,0]}prepareFrame(){this.lastRotationYVelocities.push(this.nextRotationYVelocity),this.lastRotationYVelocities.shift(),(this.nextRotationYVelocity=0)!==this.rotationYVelocity&&(this.rotationY+=this.rotationYVelocity,this.scene.children.forEach(object=>object.rotation.y=this.rotationY),this.rotationYVelocity*=this.rotationYVelocityFriction,Math.abs(this.rotationYVelocity)<this.rotationYVelocityStopThreshhold?this.rotationYVelocity=0:this.needNewFrame=!0),this.currentlyAnimatingCamera&&(this.needNewFrame=!0)}drawFrame(){this.renderer.render(this.scene,this.orthographicCamera),this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.needDownload&&(this.needDownload=!1,this.wilson.canvas.toBlob(blob=>{var e=document.createElement("a");e.download="a-plane-partition.png",e.href=window.URL.createObjectURL(blob),e.click(),e.remove()}))}switchFullscreen(){var e;this.useFullscreenButton&&(e=document.body.querySelector(".wilson-exit-fullscreen-button"))&&e.style.setProperty("z-index","300","important"),this.in2dView||this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.wilsonNumbers.fullscreen.switchFullscreen()}static generateRandomPlanePartition=generateRandomPlanePartition;static generateRandomTableau=generateRandomTableau;static generateRandomSsyt=generateRandomSsyt;static parseArray=parseArray;static arrayToAscii=arrayToAscii;static verifyPp=verifyPp;static verifySsyt=verifySsyt;isValidABConfig=isValidABConfig;getMinimalABConfig=getMinimalABConfig;iterateThroughEntries=iterateThroughEntries;printABConfig=printABConfig;addNewArray=addNewArray;editArray=editArray;trimArray=trimArray;removeArray=removeArray;addCube=addCube;addFloor=addFloor;addLeftWall=addLeftWall;addRightWall=addRightWall;showHexView=showHexView;show2dView=show2dView;updateCameraHeight=updateCameraHeight;showDimers=showDimers;hideDimers=hideDimers;showFloor=showFloor;hideFloor=hideFloor;removeOutsideFloor=removeOutsideFloor;recalculateHeights=recalculateHeights;drawAll2dViewText=drawAll2dViewText;drawSingleCell2dViewText=drawSingleCell2dViewText;colorCubes=colorCubes;uncolorCubes=uncolorCubes;raiseCubes=raiseCubes;lowerCubes=lowerCubes;moveCubes=moveCubes;revealCubes=revealCubes;deleteCubes=deleteCubes;deleteFloor=deleteFloor;drawBoundary=drawBoundary;drawNQuotient=drawNQuotient;drawBoundaryRect=drawBoundaryRect;runExample=runExample;runAlgorithm=runAlgorithm;hillmanGrassl=hillmanGrassl;hillmanGrasslInverse=hillmanGrasslInverse;pak=pak;pakInverse=pakInverse;sulzgruber=sulzgruber;sulzgruberInverse=sulzgruberInverse;rsk=rsk;rskInverse=rskInverse;godar1=godar1;godar1Inverse=godar1Inverse;algorithmData={hillmanGrassl:{method:this.hillmanGrassl,inputType:["pp"]},hillmanGrasslInverse:{method:this.hillmanGrasslInverse,inputType:["tableau"]},pak:{method:this.pak,inputType:["pp"]},pakInverse:{method:this.pakInverse,inputType:["tableau"]},sulzgruber:{method:this.sulzgruber,inputType:["pp"]},sulzgruberInverse:{method:this.sulzgruberInverse,inputType:["tableau"]},rsk:{method:this.rsk,inputType:["ssyt","ssyt"],sameShape:!0},rskInverse:{method:this.rskInverse,inputType:["tableau"]},godar1:{method:this.godar1,inputType:["pp"]},godar1Inverse:{method:this.godar1Inverse,inputType:["pp","pp"]}}}export{PlanePartitions};