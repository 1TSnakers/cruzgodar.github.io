"use strict";class PlanePartitions extends Applet{loadPromise=null;wilsonNumbers=null;wilsonHidden=null;wilsonHidden2=null;wilsonHidden3=null;wilsonHidden4=null;useFullscreenButton=!1;resolution=2e3;animationTime=600;asymptoteLightness=.6;cubeLightness=.4;floorLightness=.4;infiniteHeight=100;addWalls=!1;wallSize=30;scene=null;orthographicCamera=null;renderer=null;loader=null;cubeTexture=null;cubeTexture2=null;floorTexture=null;floorTexture2=null;cubeGeometry=null;floorGeometry=null;wallLeftGeometry=null;wallRightGeometry=null;ambientLight=null;dimersShown=!1;ambientLight=null;pointLight=null;rotationY=0;rotationYVelocity=0;nextRotationYVelocity=0;lastRotationYVelocities=[];rotationYVelocityFriction=.94;rotationYVelocityStartThreshhold=.005;rotationYVelocityStopThreshhold=5e-4;in2dView=!1;inExactHexView=!0;currentlyAnimatingCamera=!1;currentlyRunningAlgorithm=!1;needDownload=!1;fontSize=10;arrays=[];totalArrayFootprint=0;totalArrayHeight=0;totalArraySize=0;hexViewCameraPos=[15,15,15];_2dViewCameraPos=[0,20,0];algorithmData={hillmanGrassl:{method:this.hillmanGrassl,inputType:["pp"]},hillmanGrasslInverse:{method:this.hillmanGrasslInverse,inputType:["tableau"]},pak:{method:this.pak,inputType:["pp"]},pakInverse:{method:this.pakInverse,inputType:["tableau"]},sulzgruber:{method:this.sulzgruber,inputType:["pp"]},sulzgruberInverse:{method:this.sulzgruberInverse,inputType:["tableau"]},rsk:{method:this.rsk,inputType:["ssyt","ssyt"],sameShape:!0},rskInverse:{method:this.rskInverse,inputType:["tableau"]},godar1:{method:this.godar1,inputType:["pp"]},godar1Inverse:{method:this.godar1Inverse,inputType:["pp","pp"]}};constructor(t,e,i=!0){super(t),this.useFullscreenButton=i;let s=this.createHiddenCanvas(),a=this.createHiddenCanvas(),r=this.createHiddenCanvas(),n=this.createHiddenCanvas(),l={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!1,mousedownCallback:this.onGrabCanvas.bind(this),touchstartCallback:this.onGrabCanvas.bind(this),mousedragCallback:this.onDragCanvas.bind(this),touchmoveCallback:this.onDragCanvas.bind(this),mouseupCallback:this.onReleaseCanvas.bind(this),touchendCallback:this.onReleaseCanvas.bind(this)};this.wilsonNumbers=new Wilson(e,l),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),Page.setElementStyles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0);let o={canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:this.useFullscreenButton,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:this.switchFullscreen.bind(this)};this.wilson=new Wilson(t,o);let h={renderer:"cpu",canvasWidth:64,canvasHeight:64};this.wilsonHidden=new Wilson(s,h),this.wilsonHidden2=new Wilson(a,h),this.wilsonHidden3=new Wilson(r,h),this.wilsonHidden4=new Wilson(n,h),this.wilsonHidden.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden.ctx.Alpha=1,this.wilsonHidden.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.lineWidth=6,this.wilsonHidden2.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden2.ctx.Alpha=1,this.wilsonHidden2.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.lineWidth=6,this.wilsonHidden3.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden3.ctx.Alpha=1,this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.lineWidth=6,this.wilsonHidden4.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden4.ctx.Alpha=1,this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.lineWidth=6,this.loadPromise=new Promise(async(t,e)=>{Site.scriptsLoaded.three||(await Site.loadScript("/scripts/three.min.js"),Site.scriptsLoaded.three=!0),Site.scriptsLoaded.lodash||(await Site.loadScript("/scripts/lodash.min.js"),Site.scriptsLoaded.lodash=!0),this.scene=new THREE.Scene,this.scene.background=new THREE.Color(0),this.orthographicCamera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0}),this.renderer.setSize(this.resolution,this.resolution,!1),this.loader=new THREE.TextureLoader,this.cubeTexture=new THREE.CanvasTexture(this.wilsonHidden.canvas),this.cubeTexture.minFilter=THREE.LinearFilter,this.cubeTexture.magFilter=THREE.NearestFilter,this.cubeTexture2=new THREE.CanvasTexture(this.wilsonHidden2.canvas),this.cubeTexture2.minFilter=THREE.LinearFilter,this.cubeTexture2.magFilter=THREE.NearestFilter,this.floorTexture=new THREE.CanvasTexture(this.wilsonHidden3.canvas),this.floorTexture.minFilter=THREE.LinearFilter,this.floorTexture.magFilter=THREE.NearestFilter,this.floorTexture2=new THREE.CanvasTexture(this.wilsonHidden4.canvas),this.floorTexture2.minFilter=THREE.LinearFilter,this.floorTexture2.magFilter=THREE.NearestFilter,this.cubeGeometry=new THREE.BoxGeometry,this.dimersShown=!1,this.floorGeometry=new THREE.BoxGeometry(1,.001,1),this.wallLeftGeometry=new THREE.BoxGeometry(.001,1,1),this.wallRightGeometry=new THREE.BoxGeometry(1,1,.001),this.ambientLight=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,3,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.drawFrame(),t()})}onGrabCanvas(t,e,i){this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0]}onDragCanvas(t,e,i,s,a){!this.in2dView&&(this.rotationY+=i,this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.nextRotationYVelocity=i)}onReleaseCanvas(t,e,i){if(!this.in2dView){let s=0;if(this.lastRotationYVelocities.forEach((t,e)=>{Math.abs(t)>this.rotationYVelocity&&(this.rotationYVelocity=Math.abs(t),s=e)}),this.rotationYVelocity<this.rotationYVelocityStartThreshhold){this.rotationYVelocity=0;return}this.rotationYVelocity=this.lastRotationYVelocities[s]}this.lastRotationYVelocities=[0,0,0,0]}drawFrame(){this.renderer.render(this.scene,this.orthographicCamera),this.lastRotationYVelocities.push(this.nextRotationYVelocity),this.lastRotationYVelocities.shift(),this.nextRotationYVelocity=0,0!==this.rotationYVelocity&&(this.rotationY+=this.rotationYVelocity,this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.rotationYVelocity*=this.rotationYVelocityFriction,Math.abs(this.rotationYVelocity)<this.rotationYVelocityStopThreshhold&&(this.rotationYVelocity=0)),this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.needDownload&&(this.needDownload=!1,this.wilson.canvas.toBlob(t=>{let e=document.createElement("a");e.download="a-plane-partition.png",e.href=window.URL.createObjectURL(t),e.click(),e.remove()})),window.requestAnimationFrame(this.drawFrame.bind(this))}switchFullscreen(){if(this.useFullscreenButton)try{document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(t){}this.in2dView||this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.wilsonNumbers.fullscreen.switchFullscreen()}generateRandomPlanePartition(){let t=Math.floor(3*Math.random())+5,e=Array(t);for(let i=0;i<t;i++)e[i]=Array(t);e[0][0]=Math.floor(5*Math.random())+10;for(let s=1;s<t;s++)e[0][s]=Math.max(e[0][s-1]-Math.floor(4*Math.random()),0);for(let a=1;a<t;a++){e[a][0]=Math.max(e[a-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<t;r++)e[a][r]=Math.max(Math.min(e[a][r-1],e[a-1][r])-Math.floor(4*Math.random()),0)}for(let n=0;n<t;n++)e[t-1][n]=0,e[n][t-1]=0;return e}generateRandomTableau(){let t=Math.floor(3*Math.random())+5,e=Array(t);for(let i=0;i<t;i++){e[i]=Array(t);for(let s=0;s<t;s++)Math.random()<.75/t?e[i][s]=Math.floor(3*Math.random())+1:e[i][s]=0}for(let a=0;a<t;a++)e[a][t-1]=0,e[t-1][a]=0;return e}generateRandomSsyt(){let t=Math.floor(3*Math.random())+2,e=Array(t);for(let i=0;i<t;i++)e[i]=Array(t);e[0][0]=Math.floor(2*Math.random());for(let s=1;s<t;s++)e[0][s]=e[0][s-1]+Math.floor(2*Math.random());for(let a=1;a<t;a++){e[a][0]=e[a-1][0]+1+Math.floor(2*Math.random());for(let r=1;r<t;r++)e[a][r]=Math.max(e[a][r-1],e[a-1][r]+1)+Math.floor(2*Math.random())}return e}parseArray(t){let e=t.split("\n"),i=e.length,s=Array(e.length);for(let a=0;a<s.length;a++){s[a]=e[a].split(" ");for(let r=0;r<s[a].length;r++)""===s[a][r]&&(s[a].splice(r,1),r--)}let n=s[0].length;if(-1===t.indexOf(">")){for(let l=0;l<s.length;l++)s[l].push("0");n++}-1===t.indexOf("v")&&(s.push(["0"]),i++);let o=Math.max(i,n),h=Array(o);for(let u=0;u<i;u++){h[u]=Array(o);for(let $=0;$<s[u].length;$++)"^"===s[u][$]?h[u][$]=1/0:">"===s[u][$]?h[u][$]=h[u][$-1]:"v"===s[u][$]?h[u][$]=h[u-1][$]:h[u][$]=parseInt(s[u][$]);for(let c=s[u].length;c<o;c++)h[u][c]=0}for(let d=i;d<o;d++){h[d]=Array(o);for(let f=0;f<o;f++)h[d][f]=0}return h}arrayToAscii(t){let e=1;for(let i=0;i<t.length;i++)for(let s=0;s<t.length;s++)t[i][s]!==1/0&&(e=Math.max(e,`${t[i][s]}`.length));e++;let a="";for(let r=0;r<t.length-1;r++){for(let n=0;n<t.length-1;n++)if(t[r][n]===1/0){for(let l=0;l<e-1-(0===n);l++)a+=" ";a+="^"}else{let o=`${t[r][n]}`.length;for(let h=0;h<e-o-(0===n);h++)a+=" ";a+=t[r][n]}if(0!==t[r][t.length-1]){for(let u=0;u<e-1;u++)a+=" ";a+=">"}r!==t.length-2&&(a+="\n")}if(0!==t[t.length-1][0]){a+="\n";for(let $=0;$<t.length-1;$++)if(0!==t[t.length-1][$]){for(let c=0;c<e-1-(0===$);c++)a+=" ";a+="v"}}return a}verifyPp(t){for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++)if(t[e][i]<t[e+1][i]||t[e][i]<t[e][i+1])return!1;return!0}verifySsyt(t){for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++)if(0!==t[e+1][i]&&t[e][i]>=t[e+1][i]||0!==t[e][i+1]&&t[e][i]>t[e][i+1])return!1;return!0}displayError(t){}addNewArray(t,e,i=!1,s=!0){return new Promise(async(a,r)=>{if(this.currentlyAnimating){a();return}let n={numbers:e,cubes:[],floor:[],leftWall:[],rightWall:[],cubeGroup:null,centerOffset:0,partialFootprintSum:0,footprint:0,height:0,size:0};this.in2dView&&!i&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.arrays.splice(t,0,n),n.footprint=n.numbers.length;for(let l=t;l<this.arrays.length;l++)this.arrays[l].partialFootprintSum=this.arrays[l].footprint,0!==l?(this.arrays[l].centerOffset=this.arrays[l-1].centerOffset+this.arrays[l-1].footprint/2+this.arrays[l].footprint/2+1,this.arrays[l].partialFootprintSum+=this.arrays[l-1].partialFootprintSum+1):this.arrays[l].centerOffset=0,l!==t&&(this.in2dView?anime({targets:this.arrays[l].cubeGroup.position,x:this.arrays[l].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[l].cubeGroup.position,x:this.arrays[l].centerOffset,y:0,z:-this.arrays[l].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}));n.cubeGroup=new THREE.Object3D,this.scene.add(n.cubeGroup),this.addWalls||(this.in2dView?n.cubeGroup.position.set(n.centerOffset,0,0):n.cubeGroup.position.set(n.centerOffset,0,-n.centerOffset)),n.cubeGroup.rotation.y=this.rotationY,n.cubes=Array(n.footprint),n.floor=Array(n.footprint);for(let o=0;o<n.footprint;o++){n.cubes[o]=Array(n.footprint),n.floor[o]=Array(n.footprint);for(let h=0;h<n.footprint;h++)if(n.numbers[o][h]!==1/0){if(n.cubes[o][h]=Array(n.numbers[o][h]),n.numbers[o][h]>n.height&&(n.height=n.numbers[o][h]),n.floor[o][h]=this.addFloor(n,h,o),s){let u=Math.max(n.numbers[o][n.footprint-1],n.numbers[n.footprint-1][h]);for(let $=0;$<u;$++)n.cubes[o][h][$]=this.addCube(n,h,$,o,0,0,this.asymptoteLightness);for(let c=u;c<n.numbers[o][h];c++)n.cubes[o][h][c]=this.addCube(n,h,c,o)}else for(let d=0;d<n.numbers[o][h];d++)n.cubes[o][h][d]=this.addCube(n,h,d,o)}else{n.cubes[o][h]=Array(this.infiniteHeight),n.floor[o][h]=this.addFloor(n,h,o);for(let f=0;f<this.infiniteHeight;f++)n.cubes[o][h][f]=this.addCube(n,h,f,o,0,0,this.asymptoteLightness)}}if(this.addWalls){n.leftWall=Array(this.wallSize),n.rightWall=Array(this.wallSize);for(let m=0;m<this.wallSize;m++)n.leftWall[m]=Array(2*this.wallSize),n.rightWall[m]=Array(2*this.wallSize);for(let w=0;w<this.wallSize;w++)for(let g=0;g<2*this.wallSize;g++)n.leftWall[w][g]=this.addLeftWall(n,g,w),n.rightWall[w][g]=this.addRightWall(n,w,g)}n.size=Math.max(n.footprint,n.height),this.totalArrayFootprint+=n.footprint+1,this.totalArrayHeight=Math.max(this.totalArrayHeight,n.height),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),1!==this.arrays.length||i?this.addWalls||i||this.updateCameraHeight(!0):(this.hexViewCameraPos=[this.totalArraySize,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize],this._2dViewCameraPos=[0,this.totalArraySize+10,0],this.in2dView&&!i?this.updateCameraHeight(!0):(this.orthographicCamera.left=-this.totalArraySize,this.orthographicCamera.right=this.totalArraySize,this.orthographicCamera.top=this.totalArraySize,this.orthographicCamera.bottom=-this.totalArraySize,this.orthographicCamera.position.set(this.hexViewCameraPos[0],this.hexViewCameraPos[1],this.hexViewCameraPos[2]),this.orthographicCamera.rotation.set(-.785398163,.615479709,.523598775),this.orthographicCamera.updateProjectionMatrix())),t!==this.arrays.length-1&&await new Promise((t,e)=>setTimeout(t,this.animationTime));let p=[];n.cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>p.push(t))}),await new Promise(async(t,e)=>{anime({targets:p,opacity:1,duration:this.animationTime/2,easing:"easeOutQuad",complete:t})}),this.in2dView&&!i&&this.drawAll2dViewText(),a(n)})}editArray(t,e){return new Promise(async(i,s)=>{if(this.currentlyAnimating){i();return}if(t>=this.arrays.length||t<0){this.displayError(`No array at index ${t}`);return}await this.removeArray(t),await this.addNewArray(t,e),this.in2dView||this.updateCameraHeight(),i()})}trimArray(t){return new Promise(async(e,i)=>{if(this.currentlyAnimating){e();return}if(t>=this.arrays.length||t<0){this.displayError(`No array at index ${t}`);return}let s=arrays[t].numbers,a=0;for(let r=0;r<s.length;r++)for(let n=0;n<s.length;n++)0!==s[r][n]&&(a=Math.max(a,Math.max(r+1,n+1)));let l=Array(a);for(let o=0;o<a;o++){l[o]=Array(a);for(let h=0;h<a;h++)l[o][h]=s[o][h]}await this.removeArray(t),await this.addNewArray(t,l),this.in2dView||this.updateCameraHeight(),e()})}removeArray(t,e=!1){return new Promise(async(i,s)=>{if(this.currentlyAnimating){i();return}if(t>=this.arrays.length||t<0){this.displayError(`No array at index ${t}`);return}this.in2dView&&!e&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),await new Promise((e,i)=>{let s=[];this.arrays[t].cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>s.push(t))}),anime({targets:s,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad",complete:e})});for(let a=0;a<this.arrays[t].cubes.length;a++)for(let r=0;r<this.arrays[t].cubes[a].length;r++)if(this.arrays[t].cubes[a][r])for(let n=0;n<this.arrays[t].cubes[a][r].length;n++)this.arrays[t].cubes[a][r][n]&&this.arrays[t].cubes[a][r][n].material.forEach(t=>t.dispose());this.scene.remove(this.arrays[t].cubeGroup),this.totalArrayFootprint-=this.arrays[t].footprint+1,this.arrays.splice(t,1);for(let l=t;l<this.arrays.length;l++)this.arrays[l].partialFootprintSum=this.arrays[l].footprint,0!==l?(this.arrays[l].centerOffset=this.arrays[l-1].centerOffset+this.arrays[l-1].footprint/2+this.arrays[l].footprint/2+1,this.arrays[l].partialFootprintSum+=this.arrays[l-1].partialFootprintSum+1):this.arrays[l].centerOffset=0,this.in2dView?anime({targets:this.arrays[l].cubeGroup.position,x:this.arrays[l].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[l].cubeGroup.position,x:this.arrays[l].centerOffset,y:0,z:-this.arrays[l].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"});0===this.arrays.length||e||this.updateCameraHeight(!0),i()})}addCube(t,e,i,s,a=0,r=0,n=this.cubeLightness){let l=[new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0})];l.forEach(t=>t.color.setHSL(a,r,n));let o=new THREE.Mesh(this.cubeGeometry,l);return t.cubeGroup.add(o),this.addWalls?o.position.set(e,i,s):o.position.set(e-(t.footprint-1)/2,i,s-(t.footprint-1)/2),o}addFloor(t,e,i,s=0,a=0,r=this.floorLightness){let n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(s,a,r));let l=new THREE.Mesh(this.floorGeometry,n);return t.cubeGroup.add(l),this.addWalls?l.position.set(e,-.5005,i):l.position.set(e-(t.footprint-1)/2,-.5005,i-(t.footprint-1)/2),l}addLeftWall(t,e,i,s=0,a=0,r=this.floorLightness){let n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(s,a,r));let l=new THREE.Mesh(this.wallLeftGeometry,n);return t.cubeGroup.add(l),this.addWalls?l.position.set(-.5005,e-this.wallSize,i):l.position.set(-.5005-(t.footprint-1)/2,e,i-(t.footprint-1)/2),l}addRightWall(t,e,i,s=0,a=0,r=this.floorLightness){let n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(s,a,r));let l=new THREE.Mesh(this.wallRightGeometry,n);return t.cubeGroup.add(l),this.addWalls?l.position.set(e,i-this.wallSize,-.5005):l.position.set(e-(t.footprint-1)/2,i,-.5005-(t.footprint-1)/2),l}showHexView(){return new Promise(async(t,e)=>{if(this.currentlyAnimatingCamera){t();return}this.currentlyAnimatingCamera=!0,this.in2dView&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.in2dView=!1,this.inExactHexView=!0,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),anime({targets:this.orthographicCamera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:this.animationTime,easing:"easeInOutQuad",complete:()=>{this.currentlyAnimatingCamera=!1,t()}}),this.arrays.forEach(t=>{anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:-t.centerOffset,duration:this.animationTime,easing:"easeInOutQuad"})}),this.rotationY=0})}show2dView(){return new Promise(async(t,e)=>{if(this.currentlyAnimatingCamera||this.in2dView){t();return}this.dimersShown&&await this.hideDimers(),this.currentlyAnimatingCamera=!0,this.in2dView=!0,this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),anime({targets:this.orthographicCamera.rotation,x:-1.570796327,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}),this.arrays.forEach(t=>{anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"})}),setTimeout(()=>{this.drawAll2dViewText(),Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5).then(()=>{this.currentlyAnimatingCamera=!1,this.rotationY=0,t()})},this.animationTime)})}updateCameraHeight(t=!1){if(!t){if(this.currentlyAnimatingCamera)return;this.currentlyAnimatingCamera=!0}this.totalArrayHeight=0;for(let e=0;e<this.arrays.length;e++)this.totalArrayHeight=Math.max(this.totalArrayHeight,this.arrays[e].height);this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight);let i=(-this.arrays[0].footprint/2+this.arrays[this.arrays.length-1].centerOffset+this.arrays[this.arrays.length-1].footprint/2)/2;this.hexViewCameraPos=[this.totalArraySize+i,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize-i],this.addWalls&&(this.hexViewCameraPos[0]+=10,this.hexViewCameraPos[1]+=10,this.hexViewCameraPos[2]+=10),this._2dViewCameraPos=[i,this.totalArraySize+10,0],this.in2dView?(anime({targets:this.orthographicCamera.position,x:this._2dViewCameraPos[0],y:this._2dViewCameraPos[1],z:this._2dViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:this.orthographicCamera,left:-(this.totalArrayFootprint/2+.5),right:this.totalArrayFootprint/2+.5,top:this.totalArrayFootprint/2+.5,bottom:-(this.totalArrayFootprint/2+.5),duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix(),complete:()=>{this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1}}),setTimeout(()=>{this.drawAll2dViewText(),Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5)},this.animationTime)):(anime({targets:this.orthographicCamera.position,x:this.hexViewCameraPos[0],y:this.hexViewCameraPos[1],z:this.hexViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:this.orthographicCamera,left:-this.totalArraySize,right:this.totalArraySize,top:this.totalArraySize,bottom:-this.totalArraySize,duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix(),complete:()=>{this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1}}))}showDimers(){return new Promise(async(t,e)=>{if(this.currentlyAnimatingCamera){t();return}this.dimersShown=!0,this.inExactHexView||await this.showHexView(),this.currentlyAnimatingCamera=!0;let i=[];this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let s=0;s<t.footprint;s++){for(let a=0;a<t.cubes[e][s].length;a++)a<t.cubes[e][s].length-1&&i.push(t.cubes[e][s][a].material[2]),e<t.footprint-1&&t.cubes[e+1][s].length>=a+1&&i.push(t.cubes[e][s][a].material[4]),s<t.footprint-1&&t.cubes[e][s+1].length>=a+1&&i.push(t.cubes[e][s][a].material[0]),i.push(t.cubes[e][s][a].material[1]),i.push(t.cubes[e][s][a].material[3]),i.push(t.cubes[e][s][a].material[5]);0!==t.cubes[e][s].length&&i.push(t.floor[e][s].material[2])}if(this.addWalls)for(let r=0;r<this.wallSize;r++)for(let n=0;n<2*this.wallSize;n++)i.push(t.rightWall[r][n].material[0]),i.push(t.leftWall[r][n].material[4])}),i.forEach(t=>t.opacity=0),await new Promise((t,e)=>{anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",Alpha:0,duration:this.animationTime/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}})}),this.currentlyAnimatingCamera=!1,t()})}hideDimers(){return new Promise(async(t,e)=>{if(this.currentlyAnimatingCamera){t();return}this.dimersShown=!1;let i=[];this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let s=0;s<t.footprint;s++){for(let a=0;a<t.cubes[e][s].length;a++)a<t.cubes[e][s].length-1&&i.push(t.cubes[e][s][a].material[2]),e<t.footprint-1&&t.cubes[e+1][s].length>=a+1&&i.push(t.cubes[e][s][a].material[4]),s<t.footprint-1&&t.cubes[e][s+1].length>=a+1&&i.push(t.cubes[e][s][a].material[0]),i.push(t.cubes[e][s][a].material[1]),i.push(t.cubes[e][s][a].material[3]),i.push(t.cubes[e][s][a].material[5]);0!==t.cubes[e][s].length&&i.push(t.floor[e][s].material[2])}if(this.addWalls)for(let r=0;r<this.wallSize;r++)for(let n=0;n<2*this.wallSize;n++)i.push(t.leftWall[r][n].material[0]),i.push(t.rightWall[r][n].material[4])}),await new Promise((t,e)=>{anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",Alpha:1,duration:this.animationTime/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}})}),i.forEach(t=>t.opacity=1),this.currentlyAnimatingCamera=!1,t()})}showFloor(t=1){return new Promise(async(e,i)=>{let s=[];this.arrays.forEach(t=>{t.floor.forEach(t=>{t.forEach(t=>{t.material.forEach(t=>s.push(t))})})}),anime({targets:s,opacity:t,duration:this.animationTime/2,easing:"easeOutQuad",complete(){e()}})})}hideFloor(){return this.showFloor(0)}removeOutsideFloor(t){let e=[],i=[];for(let s=0;s<t.footprint;s++)for(let a=t.footprint-1;a>=0&&0===t.numbers[s][a];a--)t.floor[s][a].material.forEach(t=>e.push(t)),i.push([s,a]);i.forEach(e=>{t.floor[e[0]][e[1]].material.forEach(t=>t.dispose()),t.cubeGroup.remove(t.floor[e[0]][e[1]]),t.floor[e[0]][e[1]]=null}),this.in2dView&&this.drawAll2dViewText()}recalculateHeights(t){t.height=0,t.numbers.forEach(e=>{e.forEach(e=>{e!==1/0&&(t.height=Math.max(e,t.height))})}),t.size=Math.max(t.footprint,t.height),this.totalArrayHeight,this.totalArrayHeight=0,this.arrays.forEach(t=>this.totalArrayHeight=Math.max(t.height,this.totalArrayHeight)),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),this.totalArrayHeight!==this.oldTotalArrayHeight&&this.updateCameraHeight()}drawAll2dViewText(){this.fontSize=this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1);let t=Math.max(`${this.totalArrayHeight}`.length,2);this.wilsonNumbers.ctx.font=`${this.fontSize/t}px monospace`,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let i=0;i<t.footprint;i++)null!==t.floor[e][i]&&this.drawSingleCell2dViewText(t,e,i)})}drawSingleCell2dViewText(t,e,i){let s=(this.totalArrayFootprint-t.footprint-1)/2,a=t.partialFootprintSum-t.footprint;if(this.wilsonNumbers.ctx.clearRect(this.fontSize*(i+a+1),this.fontSize*(e+s+1),this.fontSize,this.fontSize),t.numbers[e][i]!==1/0&&(0!==t.numbers[e][i]||0!==this.floorLightness)){let r=this.wilsonNumbers.ctx.measureText(t.numbers[e][i]);this.wilsonNumbers.ctx.fillText(t.numbers[e][i],this.fontSize*(i+a+1)+(this.fontSize-r.width)/2,this.fontSize*(e+s+1)+(this.fontSize+r.actualBoundingBoxAscent-r.actualBoundingBoxDescent)/2)}}colorCubes(t,e,i){return new Promise((s,a)=>{if(0===e.length){s();return}let r=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>r.push(t.color))}),r.forEach(t=>t.getRGB(t));let n=this.cubeLightness+1*Math.min(this.cubeLightness,1-this.cubeLightness),l=0===n?0:2*(1-this.cubeLightness/n),o=r.map(t=>this.wilson.utils.hsvToRgb(i,l,n));anime({targets:r,r:(t,e)=>o[e][0]/255,g:(t,e)=>o[e][1]/255,b:(t,e)=>o[e][2]/255,duration:this.animationTime,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",update:()=>r.forEach(t=>t.setRGB(t.r,t.g,t.b)),complete:s})})}uncolorCubes(t,e){return new Promise((i,s)=>{let a=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>a.push(t.color))}),a.forEach(t=>t.getHSL(t)),anime({targets:a,s:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>a.forEach(t=>t.setHSL(t.h,t.s,this.cubeLightness)),complete:i})})}raiseCubes(t,e,i){return new Promise((s,a)=>{let r=this.in2dView?0:this.animationTime,n=[];e.forEach(e=>{n.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),anime({targets:n,y:i,duration:r,easing:"easeInOutQuad",complete:s})})}lowerCubes(t,e){return new Promise((i,s)=>{let a=this.in2dView?0:this.animationTime,r=[];e.forEach(e=>{r.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),anime({targets:r,y:(i,s)=>t.numbers[e[s][0]][e[s][1]],duration:a,easing:"easeInOutQuad",complete(){e.forEach(e=>{t.cubes[e[0]][e[1]][t.numbers[e[0]][e[1]]]=t.cubes[e[0]][e[1]][e[2]],t.cubes[e[0]][e[1]][e[2]]=null}),i()}})})}moveCubes(t,e,i,s,a=!0){return new Promise((r,n)=>{let l=[];e.forEach(e=>{l.push(t.cubes[e[0]][e[1]][e[2]].position),i.cubeGroup.attach(t.cubes[e[0]][e[1]][e[2]]),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),anime({targets:l,x:(t,e)=>s[e][1]-(i.footprint-1)/2,y:(t,e)=>s[e][2],z:(t,e)=>s[e][0]-(i.footprint-1)/2,duration:this.animationTime,easing:"easeInOutQuad",complete(){if(a){let n=e.map(e=>t.cubes[e[0]][e[1]][e[2]]);e.forEach(e=>t.cubes[e[0]][e[1]][e[2]]=null),s.forEach((t,s)=>{i.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),i.cubes[t[0]][t[1]][t[2]]&&!e.some(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])&&console.warn(`Moving a cube to a location that's already occupied: ${t}. This is probably not what you want to do.`),i.cubes[t[0]][t[1]][t[2]]=n[s]})}r()}})})}revealCubes(t,e){return new Promise((i,s)=>{if(0===e.length){i();return}let a=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>a.push(t)),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),anime({targets:a,opacity:1,duration:this.animationTime/2,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",complete:i})})}deleteCubes(t,e,i=!1,s=!1){return new Promise((a,r)=>{let n=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>n.push(t))}),anime({targets:n,opacity:0,duration:this.animationTime/2*!s,delay:(t,e)=>!i*Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",complete(){n.forEach(t=>t.dispose()),e.forEach(e=>{t.cubeGroup.remove(t.cubes[e[0]][e[1]][e[2]]),t.cubes[e[0]][e[1]][e[2]]=null}),a()}})})}deleteFloor(t,e){return new Promise((i,s)=>{let a=[];e.forEach(e=>{t.floor[e[0]][e[1]].material.forEach(t=>a.push(t))}),anime({targets:a,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad",complete(){a.forEach(t=>t.dispose()),e.forEach(e=>{t.cubeGroup.remove(t.floor[e[0]][e[1]]),t.cubes[e[0]][e[1]]=null}),i()}})})}runExample(t){return new Promise(async(e,i)=>{if(1===t||2===t){for(;this.arrays.length>1;)await this.removeArray(1),await new Promise((t,e)=>setTimeout(t,this.animationTime/2));if(0===this.arrays.length){let s=this.parseArray(this.generateRandomPlanePartition());await this.addNewArray(this.arrays.length,s)}else if(!this.verifyPp(this.arrays[0].numbers)){await this.removeArray(0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2));let a=this.parseArray(this.generateRandomPlanePartition());await addNewArray(this.arrays.length,a)}1===t?(await this.runAlgorithm("hillmanGrassl",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("hillmanGrasslInverse",0)):(await this.runAlgorithm("pak",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.showHexView(),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.runAlgorithm("sulzgruberInverse",0)),e()}else if(3===t){for(;this.arrays.length>0;)await this.removeArray(0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2));await this.addNewArray(this.arrays.length,this.generateRandomTableau()),await this.show2dView(),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.runAlgorithm("rskInverse",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("rsk",0),e()}})}runAlgorithm(t,e,i=!1){return new Promise(async(s,a)=>{if(!i&&this.currentlyRunningAlgorithm){s();return}this.currentlyRunningAlgorithm=!0;let r=this.algorithmData[t],n=r.inputType.length;if(e>this.arrays.length-1||e<0){console.log(`No array at index ${e}!`),this.currentlyRunningAlgorithm=!1,s();return}if(n>1&&e>this.arrays.length-n){console.log(`No array at index ${e+n-1}! (This algorithm needs ${n} arrays)`),this.currentlyRunningAlgorithm=!1,s();return}for(let l=0;l<n;l++){let o=r.inputType[l];if("pp"===o&&!this.verifyPp(this.arrays[e+l].numbers)){console.log(`Array at index ${e+l} is not a plane partition!`),this.currentlyRunningAlgorithm=!1,a();return}if("ssyt"===o&&!this.verifySsyt(this.arrays[e+l].numbers)){console.log(`Array at index ${e+l} is not an SSYT!`),this.currentlyRunningAlgorithm=!1,s();return}}if(n>1&&void 0!==r.sameShape&&r.sameShape){let h=Array(n),u=0;for(let $=0;$<n;$++)u=Math.max(u,this.arrays[e+$].numbers.length);for(let c=0;c<n;c++){h[c]=Array(u);for(let d=0;d<u;d++)h[c][d]=0;for(let f=0;f<this.arrays[e+c].numbers.length;f++){let m=0;for(;m<this.arrays[e+c].numbers[f].length&&0!==this.arrays[e+c].numbers[f][m];)m++;h[c][f]=m}}for(let w=1;w<n;w++)for(let g=0;g<u;g++)if(h[w][g]!==h[0][g]){this.displayError("Arrays are not the same shape!"),this.currentlyRunningAlgorithm=!1,s();return}}for(let p=0;p<n;p++){let b=[],y=this.arrays[e+p].numbers;for(let x=0;x<y.length;x++)for(let H=0;H<y.length;H++)if(y[x][H]!==1/0)for(let T=0;T<y[x][H];T++)b.push([x,H,T]);this.uncolorCubes(this.arrays[e+p],b)}let C=r.method.bind(this);await C(e),this.subAlgorithm||(this.currentlyRunningAlgorithm=!1),s()})}hillmanGrassl(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=_.cloneDeep(s.numbers),r=Array(a.length);for(let n=0;n<a.length;n++){let l=0;for(;l<a.length&&a[l][n]===1/0;)l++;r[n]=l}let o=Array(a.length);for(let h=0;h<a.length;h++){let u=0;for(;u<a.length&&a[h][u]===1/0;)u++;o[h]=u}let $=[];for(;;){let c=a[0].length-1;for(;c>=0&&r[c]<a.length&&0===a[r[c]][c];)c--;if(c<0||r[c]===a.length)break;let d=r[c],f=c,m=[[d,f,a[d][f]-1]];for(;;){if(d<a.length-1&&a[d+1][f]===a[d][f])d++;else if(f>0&&a[d][f-1]!==1/0)f--;else break;m.push([d,f,a[d][f]-1])}for(let w=0;w<m.length;w++)a[m[w][0]][m[w][1]]--;$.push(m)}let g=Array(a.length);for(let p=0;p<a.length;p++){g[p]=Array(a.length);for(let b=0;b<a.length;b++)g[p][b]=a[p][b]===1/0?1/0:0}let y=await this.addNewArray(t+1,g);await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let x=0;x<$.length;x++){await this.colorCubes(s,$[x],x/$.length*6/7),await this.raiseCubes(s,$[x],s.height);for(let H=0;H<$[x].length;H++)s.numbers[$[x][H][0]][$[x][H][1]]--,this.in2dView&&this.drawSingleCell2dViewText(s,$[x][H][0],$[x][H][1]);this.recalculateHeights(s),await new Promise((t,e)=>setTimeout(t,this.animationTime/5));let T=[$[x][$[x].length-1][0],$[x][0][1]],C=[],A=y.height+1;for(let v=r[T[1]];v<=T[0];v++)C.push([v,T[1],A]);let S=C[C.length-1];for(let V=T[1]-1;V>=o[T[0]];V--)C.push([T[0],V,A]);await this.moveCubes(s,$[x],y,C),C=[];for(let R=T[0]-1;R>=r[T[1]];R--)C.push([R,T[1],A]);this.deleteCubes(y,C),C=[];for(let E=T[1]-1;E>=o[T[0]];E--)C.push([T[0],E,A]);this.deleteCubes(y,C),await this.lowerCubes(y,[S]),y.numbers[S[0]][S[1]]++,this.recalculateHeights(y),this.in2dView&&this.drawSingleCell2dViewText(y,S[0],S[1]),y.height=Math.max(y.height,y.numbers[S[0]][S[1]]),y.size=Math.max(y.size,y.height),await new Promise((t,e)=>setTimeout(t,this.animationTime))}await this.removeArray(t),e()})}hillmanGrasslInverse(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=_.cloneDeep(s.numbers),r=[],n=Array(a.length);for(let l=0;l<a.length;l++){let o=0;for(;o<a.length&&a[o][l]===1/0;)o++;n[l]=o}let h=Array(a.length);for(let u=0;u<a.length;u++){let $=0;for(;$<a.length&&a[u][$]===1/0;)$++;h[u]=$}let c=Array(a.length);for(let d=0;d<a.length;d++){c[d]=Array(a.length);for(let f=0;f<a.length;f++)c[d][f]=a[d][f]===1/0?1/0:0}let m=_.cloneDeep(c),w=await this.addNewArray(t+1,c);for(let g=0;g<a.length;g++)for(let p=a.length-1;p>=n[g];p--)for(;0!==a[p][g];){let b=[],y=p,x=h[p];for(;y>=0;){let H=x;if(0!==y)for(;m[y][H]!==m[y-1][H]&&H<g;)H++;else H=g;for(let T=x;T<=H;T++)b.push([y,T,m[y][T]]);if(y-1>=n[H])y--,x=H;else break}for(let C=0;C<b.length;C++)m[b[C][0]][b[C][1]]++;r.push([b,[p,g,a[p][g]-1]]),a[p][g]--}await new Promise((t,e)=>setTimeout(t,this.animationTime/2));for(let A=0;A<r.length;A++){let v=A/r.length*6/7;await this.colorCubes(s,[r[A][1]],v);let S=r[A][1][0],V=r[A][1][1],R=s.size;for(let E=n[V];E<S;E++)s.cubes[E][V][R]=this.addCube(s,V,R,E),s.cubes[E][V][R].material.forEach(t=>t.color.setHSL(v,1,this.cubeLightness));for(let N=h[S];N<V;N++)s.cubes[S][N][R]=this.addCube(s,N,R,S),s.cubes[S][N][R].material.forEach(t=>t.color.setHSL(v,1,this.cubeLightness));await this.raiseCubes(s,[r[A][1]],R);let z=[];for(let F=S-1;F>=n[V];F--)z.push([F,V,R]);let L=this.revealCubes(s,z);z=[];for(let O=V-1;O>=h[S];O--)z.push([S,O,R]);await Promise.all([L,this.revealCubes(s,z)]),z=[];for(let W=h[S];W<V;W++)z.push([S,W,R]);z.push([S,V,s.numbers[S][V]-1]);for(let M=S-1;M>=n[V];M--)z.push([M,V,R]);let G=r[A][0],k=w.height+1;G.forEach(t=>t[2]=k),s.numbers[S][V]--,this.recalculateHeights(s),this.in2dView&&this.drawSingleCell2dViewText(s,S,V),await this.moveCubes(s,z,w,G),await this.lowerCubes(w,G),G.forEach(t=>{w.numbers[t[0]][t[1]]++}),this.recalculateHeights(w),this.in2dView&&G.forEach(t=>this.drawSingleCell2dViewText(w,t[0],t[1])),await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(t),e()})}pak(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=s.numbers;this.in2dView||await this.show2dView();let r=0,n=0;for(;r<s.footprint&&0!==s.numbers[r][s.footprint-1];)r++;for(;n<s.footprint&&0!==s.numbers[s.footprint-1][n];)n++;r=0,n=0;let l=0;for(let o=s.footprint-1-n;o>=0;o--)for(let h=s.footprint-1-r;h>=0;h--)a[o][h]!==1/0&&l++;let u=0;for(let $=0;$<s.footprint-n;$++)for(let c=0;c<s.footprint-r;c++){if(a[$][c]===1/0)continue;let d=[],f=0;for(;$+f<s.footprint&&c+f<s.footprint;)d.push([$+f,c+f,a[$+f][c+f]-1]),f++;f=d[0][0];let m=d[0][1],w=[];for(let g=a[f][m]-2;g>=0;g--)w.push([f,m,g]);this.colorCubes(s,w,u/l*6/7),w=[],d.forEach(t=>{t[2]>=0&&w.push(t)}),await this.colorCubes(s,w,u/l*6/7);let p=Array(d.length);d.forEach((t,e)=>{let i=t[0],r=t[1],n=0,l=0;i<s.footprint-1&&(n=a[i+1][r]),r<s.footprint-1&&(l=a[i][r+1]),p[e]=Math.max(n,l),e>0?(n=a[i-1][r],l=a[i][r-1],p[e]+=Math.min(n,l)-a[i][r]):p[e]=a[i][r]-p[e]});for(let b=0;b<d.length;b++){if(f=d[b][0],m=d[b][1],p[b]>a[f][m]){let y=[];for(let x=a[f][m];x<p[b];x++)s.cubes[f][m][x]=this.addCube(s,m,x,f),y.push([f,m,x]);this.in2dView?this.revealCubes(s,y):await this.revealCubes(s,y)}else if(p[b]<a[f][m]){let H=[];for(let T=a[f][m]-1;T>=p[b];T--)H.push([f,m,T]);this.in2dView?this.deleteCubes(s,H):await this.deleteCubes(s,H)}a[f][m]=p[b],this.in2dView&&this.drawSingleCell2dViewText(s,f,m)}let C=[];w.forEach((t,e)=>{0!==e&&t[2]<a[t[0]][t[1]]&&C.push(t)}),this.in2dView?this.uncolorCubes(s,C):await this.uncolorCubes(s,C),u++,this.recalculateHeights(s),0!==w.length&&await new Promise((t,e)=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0),e()})}pakInverse(t,e=0,i=0){return new Promise(async(s,a)=>{let r=this.arrays[t],n=r.numbers;this.in2dView||await this.show2dView();let l=0;for(let o=r.footprint-1-i;o>=0;o--)for(let h=r.footprint-1-e;h>=0;h--)n[o][h]!==1/0&&l++;let u=0;for(let $=r.footprint-1-i;$>=0;$--)for(let c=r.footprint-1-e;c>=0;c--){if(n[$][c]===1/0)continue;let d=[],f=0;for(;$+f<r.footprint&&c+f<r.footprint;)d.push([$+f,c+f,n[$+f][c+f]-1]),f++;f=d[0][0];let m=d[0][1],w=Array(d.length),g=!1;if(d.forEach((t,e)=>{let i=t[0],s=t[1],a=0,l=0;i<r.footprint-1&&(a=n[i+1][s]),s<r.footprint-1&&(l=n[i][s+1]),w[e]=Math.max(a,l),e>0?(a=n[i-1][s],l=n[i][s-1],w[e]+=Math.min(a,l)-n[i][s]):w[e]+=n[i][s],g||w[e]===n[i][s]||(g=!0)}),0!==n[f][m]){let p=[];for(let b=n[f][m]-1;b>=0;b--)p.push([f,m,b]);this.colorCubes(r,p,u/l*6/7)}else if(0!==w[0])r.cubes[f][m][0]=this.addCube(r,m,0,f,u/l*6/7,1,this.cubeLightness),n[f][m]=1,this.revealCubes(r,[[f,m,0]]);else if(!g){u++;continue}await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let y=0;y<d.length;y++){if(f=d[y][0],m=d[y][1],w[y]>n[f][m]){let x=[];for(let H=n[f][m];H<w[y];H++)r.cubes[f][m][H]=this.addCube(r,m,H,f,u/l*6/7,1,this.cubeLightness),x.push([f,m,H]);this.in2dView?this.revealCubes(r,x):await this.revealCubes(r,x)}else if(w[y]<n[f][m]){let T=[];for(let C=n[f][m]-1;C>=w[y];C--)T.push([f,m,C]);this.in2dView?this.deleteCubes(r,T):await this.deleteCubes(r,T)}n[f][m]=w[y],this.in2dView&&this.drawSingleCell2dViewText(r,f,m)}u++,this.recalculateHeights(r),await new Promise((t,e)=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0),s()})}sulzgruber(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=_.cloneDeep(s.numbers),r=Array(a.length);for(let n=0;n<a.length;n++){let l=0;for(;l<a.length&&a[l][n]===1/0;)l++;r[n]=l}let o=Array(a.length);for(let h=0;h<a.length;h++){let u=0;for(;u<a.length&&a[h][u]===1/0;)u++;o[h]=u}let $={},c={};for(let d=0;d<a.length;d++)c[-d]=[d,0];for(let f=1;f<a.length;f++)c[f]=[0,f];for(let m=-a.length+1;m<a.length;m++){let w=c[m][0],g=c[m][1];for(;w<a.length&&g<a.length&&a[w][g]===1/0;)w++,g++;if(c[m]=[w,g],w===a.length||g===a.length){$[m]=-1;continue}let p=0===g||a[w][g-1]===1/0,b=0===w||a[w-1][g]===1/0;p&&b?$[m]=0:p?$[m]=3:b?$[m]=2:$[m]=1}let y=[];for(let x=-a.length+1;x<a.length;x++){if(1===$[x]||3===$[x])continue;let H=c[x][0],T=c[x][1];if(0!==a[H][T])for(;;){let C=!1;for(;H<a.length&&T<a.length&&0!==a[H][T];){if((T<a.length-1&&a[H][T]>a[H][T+1]||T===a.length-1&&a[H][T]>0)&&(0===$[x]||2===$[x]&&(H<a.length-1&&a[H][T]>a[H+1][T]||H===a.length-1&&a[H][T]>0))){C=!0;break}H++,T++}if(!C)break;let A=H,v=T,S=[[A,v,a[A][v]-1]];for(;;){let V=v-A;if(A<a.length-1&&a[A][v]===a[A+1][v]&&(0===$[V]||3===$[V]))A++;else if(v>o[A]&&(A===a.length-1||A<a.length-1&&a[A][v]>a[A+1][v]))v--;else break;S.push([A,v,a[A][v]-1])}S.forEach(t=>a[t[0]][t[1]]--),y.push(S)}}let R=Array(a.length);for(let E=0;E<a.length;E++){R[E]=Array(a.length);for(let N=0;N<a.length;N++)R[E][N]=a[E][N]===1/0?1/0:0}let z=await this.addNewArray(t+1,R);await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let F=0;F<y.length;F++){await this.colorCubes(s,y[F],F/y.length*6/7),await this.raiseCubes(s,y[F],s.height+1),y[F].forEach(t=>{s.numbers[t[0]][t[1]]--,this.in2dView&&this.drawSingleCell2dViewText(s,t[0],t[1])}),this.recalculateHeights(s),await new Promise((t,e)=>setTimeout(t,this.animationTime/5));let L=y[F][y[F].length-1][0],O=c[y[F][y[F].length-1][1]-L+y[F].length-1][1],W=[],M=Math.max(s.height+1,z.height+1);for(let G=r[O];G<=L;G++)W.push([G,O,M]);for(let k=O-1;k>=o[L];k--)W.push([L,k,M]);await this.moveCubes(s,y[F],z,W),W=[];for(let I=L-1;I>=r[O];I--)W.push([I,O,M]);this.deleteCubes(z,W),W=[];for(let Y=O-1;Y>=o[L];Y--)W.push([L,Y,M]);this.deleteCubes(z,W),await this.lowerCubes(z,[[L,O,M]]),z.numbers[L][O]++,this.in2dView&&this.drawSingleCell2dViewText(z,L,O),this.recalculateHeights(z),await new Promise((t,e)=>setTimeout(t,this.animationTime))}await this.removeArray(t),e()})}sulzgruberInverse(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=s.numbers,r=Array(a.length);for(let n=0;n<a.length;n++){let l=0;for(;l<a.length&&a[l][n]===1/0;)l++;r[n]=l}let o=Array(a.length);for(let h=0;h<a.length;h++){let u=0;for(;u<a.length&&a[h][u]===1/0;)u++;o[h]=u}let $={};for(let c=0;c<a.length;c++)$[-c]=[c,0];for(let d=1;d<a.length;d++)$[d]=[0,d];for(let f=-a.length+1;f<a.length;f++){let m=$[f][0],w=$[f][1];for(;m<a.length&&w<a.length&&a[m][w]===1/0;)m++,w++;$[f]=[m,w]}let g=0,p=Array(a.length);for(let b=0;b<a.length;b++){p[b]=Array(a.length);for(let y=0;y<a.length;y++)a[b][y]===1/0?p[b][y]=1/0:(p[b][y]=0,g+=a[b][y])}let x=await this.addNewArray(t+1,p);x.numbers;let H=0;for(let T=a.length-1;T>=0;T--)for(let C=a.length-1;C>=0;C--)if(a[C][T]!==1/0)for(;0!==a[C][T];){let A=H/g*6/7,v=Math.max(s.size+1,x.size+1);await this.colorCubes(s,[[C,T,a[C][T]-1]],A),await this.raiseCubes(s,[[C,T,a[C][T]-1]],v);let S=C,V=T;for(let R=r[V];R<S;R++)s.cubes[R][V][v]=this.addCube(s,V,v,R),s.cubes[R][V][v].material.forEach(t=>t.color.setHSL(A,1,this.cubeLightness));for(let E=o[S];E<V;E++)s.cubes[S][E][v]=this.addCube(s,E,v,S),s.cubes[S][E][v].material.forEach(t=>t.color.setHSL(A,1,this.cubeLightness));let N=[];for(let z=S-1;z>=r[V];z--)N.push([z,V,v]);let F=this.revealCubes(s,N);N=[];for(let L=V-1;L>=o[S];L--)N.push([S,L,v]);await Promise.all([F,this.revealCubes(s,N)]),N=[];for(let O=o[S];O<V;O++)N.push([S,O,v]);N.push([S,V,s.numbers[S][V]-1]);for(let W=S-1;W>=r[V];W--)N.push([W,V,v]);let M=o[S]-S,G=M+N.length-1,k=[];for(let I=M;I<=G;I++)k.push(_.clone($[I]));a[S][V]--,this.recalculateHeights(s),this.in2dView&&this.drawSingleCell2dViewText(s,S,V),await this.moveCubes(s,N,x,k);let Y=0,P=x.numbers[k[0][0]][k[0][1]];for(;;){let Q=Y;for(;Q<k.length&&k[Q][0]===k[Y][0];)Q++;N=k.slice(Y,Q);let B=!0;for(let D=0;D<N.length;D++)if(x.numbers[N[D][0]][N[D][1]]!==P){B=!1;break}if(B)await this.lowerCubes(x,N),N.forEach(t=>x.numbers[t[0]][t[1]]++),this.recalculateHeights(x),this.in2dView&&N.forEach(t=>{this.drawSingleCell2dViewText(x,t[0],t[1])}),Y=Q;else{let U=_.cloneDeep(k.slice(Y));for(let j=Y;j<k.length;j++)if(k[j][0]++,k[j][1]++,k[j][0]>x.footprint||k[j][1]>x.footprint){console.error("Insertion failed!");return}await this.moveCubes(x,U,x,k.slice(Y)),P=x.numbers[k[Y][0]][k[Y][1]]}if(Y===k.length)break}H++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(t),e()})}rsk(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=this.arrays[t+1],r=s.numbers,n=a.numbers,l=0,o=0;for(let h=0;h<r.length;h++)for(let u=0;u<r.length;u++){if(r[h][u]===1/0||n[h][u]===1/0){this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),this.currentlyRunningAlgorithm=!1,e();return}0!==r[h][u]&&o++,l=Math.max(Math.max(l,r[h][u]),n[h][u])}if(0===l){displayError("The SSYT are empty!"),currentlyRunningAlgorithm=!1,e();return}let $=Array(l);for(let c=0;c<l;c++){$[c]=Array(l);for(let d=0;d<l;d++)$[c][d]=0}let f=await this.addNewArray(t+2,$),m=0;for(;0!==n[0][0];){let w=m/o*6/7,g=0,p=0,b=0;for(let y=0;y<n.length;y++){let x=n.length-1;for(;x>=0&&0===n[y][x];)x--;x>=0&&(g=Math.max(g,n[y][x]))}for(let H=0;H<n.length;H++){let T=n.length-1;for(;T>=0&&0===n[H][T];)T--;if(n[H][T]===g){p=H,b=T;break}}let C=[],A=[],v=[],S=[],V=[],R=[],E=p,N=b,z=r[E][N],F=n[E][N],L=[[E,N]];for(;0!==E;){let O=r.length-1;for(;0===r[E-1][O]||z<=r[E-1][O];)O--;for(let W=0;W<z;W++)C.push([E,N,W]),A.push([E-1,O,W]);E--,N=O,z=r[E][N],L.push([E,N])}let M=f.height+1;for(let G=0;G<z;G++)v.push([E,N,G]),S.push([F-1,G,M]);for(let k=0;k<F-1;k++)V.push([p,b,k]),R.push([k,z-1,M]);this.colorCubes(a,V.concat([[p,b,F-1]]),w),this.colorCubes(s,C,w),await this.colorCubes(s,v,w),n[p][b]=0;for(let I=L.length-1;I>0;I--)r[L[I][0]][L[I][1]]=r[L[I-1][0]][L[I-1][1]];if(r[p][b]=0,this.in2dView){this.drawSingleCell2dViewText(s,p,b);for(let Y=L.length-1;Y>0;Y--)this.drawSingleCell2dViewText(s,L[Y][0],L[Y][1]);this.drawSingleCell2dViewText(a,p,b)}this.moveCubes(a,V,f,R),this.moveCubes(s,v,f,S),this.moveCubes(s,C,s,A),await this.moveCubes(a,[[p,b,F-1]],f,[[F-1,z-1,M]],!1),this.uncolorCubes(s,A),f.cubeGroup.remove(a.cubes[p][b][F-1]),this.deleteCubes(a,[[p,b,F-1]],!0,!0),S.reverse(),R.reverse(),this.deleteCubes(f,S.slice(1)),this.deleteCubes(f,R),await this.lowerCubes(f,[[F-1,z-1,M]]),$[F-1][z-1]++,this.in2dView&&this.drawSingleCell2dViewText(f,F-1,z-1),this.recalculateHeights(f),m++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(t),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.removeArray(t),e()})}rskInverse(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=_.cloneDeep(s.numbers),r=0;a.forEach(t=>t.forEach(t=>r+=t));let n=Array(r),l=Array(r);for(let o=0;o<r;o++){n[o]=Array(r),l[o]=Array(r);for(let h=0;h<r;h++)n[o][h]=0,l[o][h]=0}let u=Array(a.length);for(let $=0;$<a.length;$++)u[$]=0;let c=0,d=[],f=[],m=[];for(let w=0;w<a.length;w++)for(let g=0;g<a.length;g++)for(;0!==a[w][g];){a[w][g]--;let p=g+1,b=0,y=0,x=[];for(;;){for(y=u[b];0!==y&&n[b][y-1]>p;)y--;if(y===u[b]){n[b][y]=p,u[b]++,0===y&&c++,x.push([b,y]);break}let H=n[b][y];n[b][y]=p,p=H,x.push([b,y]),b++}d.push(x),f.push([b,y]),m.push([w,g]),l[b][y]=w+1}let T=Math.max(u[0],c);n=Array(T),l=Array(T);for(let C=0;C<T;C++){n[C]=Array(T),l[C]=Array(T);for(let A=0;A<T;A++)n[C][A]=0,l[C][A]=0}let v=await this.addNewArray(t+1,n);await new Promise((t,e)=>setTimeout(t,this.animationTime/2));let S=await this.addNewArray(t+2,l);await new Promise((t,e)=>setTimeout(t,this.animationTime/2));let V=0;for(let R=0;R<m.length;R++){let E=m[R][0],N=m[R][1],z=s.height+1,F=V/r*6/7;for(let L=N;L>=0;L--)s.cubes[E][L][z]=this.addCube(s,L,z,E),s.cubes[E][L][z].material.forEach(t=>t.color.setHSL(F,1,this.cubeLightness));for(let O=E-1;O>=0;O--)s.cubes[O][N][z]=this.addCube(s,N,z,O),s.cubes[O][N][z].material.forEach(t=>t.color.setHSL(F,1,this.cubeLightness));s.cubes[E][N][z+1]=this.addCube(s,N,z,E),s.cubes[E][N][z+1].material.forEach(t=>t.color.setHSL(F,1,this.cubeLightness)),await this.colorCubes(s,[[E,N,s.numbers[E][N]-1]],F),await this.raiseCubes(s,[[E,N,s.numbers[E][N]-1]],z);let W=this.revealCubes(s,[[E,N,z+1]]),M=[];for(let G=N-1;G>=0;G--)M.push([E,G,z]);let k=this.revealCubes(s,M);M=[];for(let I=E-1;I>=0;I--)M.push([I,N,z]);await Promise.all([W,k,this.revealCubes(s,M)]);let Y=d[V],P=[],Q=[],B=[[E,N,s.numbers[E][N]-1]],D=[[Y[0][0],Y[0][1],N]],U=[[E,N,z+1]],j=[[f[V][0],f[V][1],E]];for(let q=N-1;q>=0;q--)B.push([E,q,z]),D.push([Y[0][0],Y[0][1],q]);for(let K=0;K<Y.length-1;K++)for(let J=0;J<n[Y[K][0]][Y[K][1]];J++)P.push([Y[K][0],Y[K][1],J]),Q.push([Y[K+1][0],Y[K+1][1],J]);for(let X=E-1;X>=0;X--)U.push([X,N,z]),j.push([f[V][0],f[V][1],X]);await this.colorCubes(v,P,F);for(let Z=Y.length-1;Z>0;Z--)n[Y[Z][0]][Y[Z][1]]=n[Y[Z-1][0]][Y[Z-1][1]];0!==Y.length&&(n[Y[0][0]][Y[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==P.length&&await this.moveCubes(v,P,v,Q),s.numbers[E][N]--,this.in2dView&&this.drawAll2dViewText(),this.moveCubes(s,B,v,D),await this.moveCubes(s,U,S,j),n[Y[0][0]][Y[0][1]]=N+1,l[f[V][0]][f[V][1]]=E+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(s),this.recalculateHeights(v),this.recalculateHeights(S),V++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(t),e()})}godar1(t){return new Promise(async(e,i)=>{let s=this.arrays[t],a=s.numbers,r=Array(2*a.length),n=Array(2*a.length);for(let l=0;l<a.length;l++){let o=0;for(;o<a.length&&a[l][o]===1/0;)o++;for(r[l]=o,o=0;o<a.length&&a[o][l]===1/0;)o++;n[l]=o}for(let h=a.length;h<2*a.length;h++)r[h]=0,n[h]=0;let u=Math.max(r[0],n[0]),$=Array(a.length);for(let c=0;c<a.length;c++){$[c]=Array(a.length);for(let d=0;d<a.length;d++)a[c][d]===1/0?$[c][d]=this.infiniteHeight:$[c][d]=a[c][d]}await this.addNewArray(t+1,$),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.removeArray(t),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),a=(s=this.arrays[t]).numbers;let f=0,m=0;for(;f<a.length&&0!==a[f][a.length-1];)f++;for(;m<a.length&&0!==a[a.length-1][m];)m++;await this.runAlgorithm("pak",t,!0),await new Promise((t,e)=>setTimeout(t,2*this.animationTime)),a=(s=this.arrays[t]).numbers;let w=Math.max(f,m),g=Array(a.length-w+1),p=[];for(let b=0;b<g.length-1;b++){g[b]=Array(g.length);for(let y=0;y<g.length-1;y++){g[b][y]=a[b][y];for(let x=0;x<a[b][y];x++)p.push([b,y,x]);a[b][y]=0}g[b][g.length-1]=0}g[g.length-1]=Array(g.length);for(let H=0;H<g.length;H++)g[g.length-1][H]=0;this.deleteCubes(s,p,!0,!0),await this.addNewArray(t,g),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pakInverse",t,!0),await new Promise((t,e)=>setTimeout(t,2*this.animationTime));let T=2*a.length-r[a.length-1]-n[a.length-1],C=r[0]+n[0],A=Array(4*a.length),v=Array(C),S=Array(4*a.length);for(let V=0;V<4*a.length;V++)A[V]=[];for(let R=0;R<C;R++)v[R]=[];for(let E=0;E<4*a.length;E++)S[E]=[];let N=1;for(let z=0;z<2*a.length;z++)for(let F=0;F<2*a.length;F++)F>=r[z]?A[z+F+1-r[z]-n[F]].push([z,F]):v[r[z]+n[F]-z-F-1].unshift([u-z-1,u-F-1]),S[z+F+1].push([z,F]);let L=Array(2*a.length);for(let O=0;O<2*a.length;O++)L[O]=Array(2*a.length);for(let W=1;W<T;W++){let M=[];for(let G=0;G<A[W].length;G++){let k=A[W][G][0],I=A[W][G][1];if(k<a.length-m&&I<a.length-f)for(let Y=0;Y<this.arrays[t].numbers[k][I];Y++)M.push([k,I,Y]);G<S[W].length?(L[k][I]=[1,S[W][G]],k<a.length&&I<a.length&&this.arrays[t].numbers[k][I]>0&&(N=Math.max(Math.max(N,S[W][G][0]+1),S[W][G][1]+1))):L[k][I]=[0,v[W][G-S[W].length]]}0!==M.length&&this.colorCubes(this.arrays[t],M,(W-1)/(T-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animationTime));let P=Array(u);for(let Q=0;Q<u;Q++){P[Q]=Array(u);for(let B=0;B<u;B++)B<u-r[u-Q-1]?P[Q][B]=1/0:P[Q][B]=0}let D=null;u>0&&(D=await this.addNewArray(t+1,P),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)));let U=Array(N);for(let j=0;j<N;j++){U[j]=Array(N);for(let q=0;q<N;q++)U[j][q]=0}let K=await this.addNewArray(t+2,U);for(let J=0;J<a.length-m;J++)for(let X=r[J];X<a.length-f;X++)if(this.arrays[t].numbers[J][X]>0){let Z=[],tt=[],te=L[J][X][1][0],ti=L[J][X][1][1];for(let ts=0;ts<this.arrays[t].numbers[J][X];ts++)Z.push([J,X,ts]),tt.push([te,ti,ts]);0===L[J][X][0]?(await this.moveCubes(this.arrays[t],Z,D,tt),P[te][ti]=this.arrays[t].numbers[J][X],this.arrays[t].numbers[J][X]=0):(await this.moveCubes(this.arrays[t],Z,K,tt),U[te][ti]=this.arrays[t].numbers[J][X],this.arrays[t].numbers[J][X]=0),this.in2dView&&this.drawAll2dViewText()}await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",t,!0),u>0&&await this.runAlgorithm("hillmanGrasslInverse",t+1,!0),this.resolve()})}godar1Inverse(t){return new Promise(async(e,i)=>{let s=this.arrays[t+1].numbers,a=this.arrays[t].numbers,r=Array(s.length+2*a.length),n=Array(s.length+2*a.length);for(let l=0;l<s.length+2*a.length;l++)r[l]=0,n[l]=0;for(let o=0;o<a.length;o++){let h=a.length-1;for(;h>=0&&a[o][h]!==1/0;)h--;for(r[a.length-o-1]=a.length-h-1,h=a.length-1;h>=0&&a[h][o]!==1/0;)h--;n[a.length-o-1]=a.length-h-1}await this.runAlgorithm("pak",t,!0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pak",t+1,!0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime));let u=[],$=this.arrays[t].numbers;for(let c=0;c<$.length;c++)for(let d=0;d<$.length;d++)if($[c][d]!==1/0)for(let f=0;f<$[c][d];f++)u.push([c,d,f]);this.uncolorCubes(this.arrays[t],u),u=[],$=this.arrays[t+1].numbers;for(let m=0;m<$.length;m++)for(let w=0;w<$.length;w++)if($[m][w]!==1/0)for(let g=0;g<$[m][w];g++)u.push([m,w,g]);await this.uncolorCubes(arrays[t+1],u);let p=Math.max(r[0],n[0])+2*s.length-1,b=2*p,y=r[0]+n[0],x=2*s.length,H=Array(b),T=Array(y),C=Array(x);for(let A=0;A<b;A++)H[A]=[];for(let v=0;v<y;v++)T[v]=[];for(let S=0;S<x;S++){C[S]=Array(S);for(let V=0;V<S;V++)C[S][V]=-1}for(;r.length<p;)r.push(0);for(;n.length<p;)n.push(0);for(let R=0;R<p;R++)for(let E=0;E<p;E++)E>=r[R]?H[R+E+1-r[R]-n[E]].push([R,E]):T[r[R]+n[E]-R-E-1].unshift([a.length-R-1,a.length-E-1]),R<s.length&&E<s.length&&(C[R+E+1][R]=[R,E]);let N=Array(s.length);for(let z=0;z<s.length;z++)N[z]=Array(s.length);let F=Array(a.length);for(let L=0;L<a.length;L++)F[L]=Array(a.length);p=1;for(let O=1;O<y;O++){let W=[];for(let M=0;M<T[O].length;M++){let G=T[O][M][0],k=T[O][M][1];for(let I=0;I<arrays[t].numbers[G][k];I++)W.push([G,k,I]);F[G][k]=H[O][M+C[O].length],0!==this.arrays[t].numbers[G][k]&&(p=Math.max(Math.max(p,F[G][k][0]+1),F[G][k][1]+1))}0!==W.length&&this.colorCubes(this.arrays[t],W,(O-1)/(y-1)*6/7)}for(let Y=1;Y<x;Y++){let P=[];for(let Q=0;Q<C[Y].length;Q++){if(-1===C[Y][Q])continue;let B=C[Y][Q][0],D=C[Y][Q][1];for(let U=0;U<arrays[t+1].numbers[B][D];U++)P.push([B,D,U]);N[B][D]=H[Y][Q],0!==this.arrays[t+1].numbers[B][D]&&(p=Math.max(Math.max(p,N[B][D][0]+1),N[B][D][1]+1))}0!==P.length&&this.colorCubes(this.arrays[t+1],P,(Y-1)/(x-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animationTime));let j=Array(p);for(let q=0;q<p;q++){j[q]=Array(p);for(let K=0;K<p;K++)K<r[q]?j[q][K]=1/0:j[q][K]=0}let J=await this.addNewArray(t+2,j);await new Promise((t,e)=>setTimeout(t,this.animationTime/2));for(let X=0;X<a.length;X++)for(let Z=0;Z<a.length;Z++)if(arrays[t].numbers[X][Z]>0&&this.arrays[t].numbers[X][Z]!==1/0){let tt=[],te=[],ti=F[X][Z][0],ts=F[X][Z][1];for(let ta=0;ta<this.arrays[t].numbers[X][Z];ta++)tt.push([X,Z,ta]),te.push([ti,ts,ta]);await this.moveCubes(this.arrays[t],tt,J,te),j[ti][ts]=this.arrays[t].numbers[X][Z],this.arrays[t].numbers[X][Z]=0,this.in2dView&&this.drawAll2dViewText()}for(let tr=0;tr<s.length;tr++)for(let tn=0;tn<s.length;tn++)if(this.arrays[t+1].numbers[tr][tn]>0&&arrays[t+1].numbers[tr][tn]!==1/0){let tl=[],to=[],th=N[tr][tn][0],tu=N[tr][tn][1];for(let t$=0;t$<this.arrays[t+1].numbers[tr][tn];t$++)tl.push([tr,tn,t$]),to.push([th,tu,t$]);await this.moveCubes(this.arrays[t+1],tl,J,to),j[th][tu]=this.arrays[t+1].numbers[tr][tn],this.arrays[t+1].numbers[tr][tn]=0,this.in2dView&&this.drawAll2dViewText()}await this.removeArray(t),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.removeArray(t),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",t,!0),await new Promise((t,e)=>setTimeout(t,this.animationTime)),e()})}drawBoundary(t,e){return new Promise(async(i,s)=>{this.in2dView||await this.show2dView(),"0"!==this.wilsonNumbers.canvas.style.opacity&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/3),this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight);let a=this.arrays[t],r=a.numbers,n=[],l=0,o=0;for(let h=a.footprint-1;h>=0;h--){for(;o<a.footprint&&r[h][o]===1/0;){if(h===a.footprint-1||r[h+1][o]!==1/0){let u=l%e/e,$=this.wilson.utils.hsvToRgb(u,1,1);n.push([h,o,!0,`rgba(${$[0]}, ${$[1]}, ${$[2]}, `]),l++}o++}let c=l%e/e,d=this.wilson.utils.hsvToRgb(c,1,1);n.push([h,o,!1,`rgba(${d[0]}, ${d[1]}, ${d[2]}, `]),l++}for(;o<a.footprint;){if(-1==a.footprint-1||r[0][o]!==1/0){let f=l%e/e,m=this.wilson.utils.hsvToRgb(f,1,1);n.push([-1,o,!0,`rgba(${m[0]}, ${m[1]}, ${m[2]}, `]),l++}o++}n.forEach(t=>{this.drawBoundaryRect(a,t[0],t[1],t[2],`${t[3]} 1)`)}),await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/3),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",i(n)})}drawNQuotient(t,e,i,s){return new Promise(async(a,r)=>{let n=this.arrays[t],l={t:1};await new Promise((t,a)=>{anime({targets:l,t:0,duration:this.animationTime,easing:"easeOutQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,s)=>{this.drawBoundaryRect(n,t[0],t[1],t[2],`${t[3]} ${s%e===i?1:0})`)}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,s)=>{let a=s%e===i?1:l.t;this.drawBoundaryRect(n,t[0],t[1],t[2],`${t[3]} ${a})`)})}})});let o=(s=s.filter((t,s)=>s%e===i)).filter(t=>!t[2]).length,h=Array(s.length),u=o-1,$=0;s.forEach((t,e)=>{h[e]=[u,$],t[2]?$++:u--}),l.t=0,await new Promise((t,e)=>{anime({targets:l,t:1,duration:this.animationTime,easing:"easeInOutQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,e)=>{this.drawBoundaryRect(n,h[e][0],h[e][1],t[2],`${t[3]} 1)`)}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,e)=>{this.drawBoundaryRect(n,(1-l.t)*t[0]+l.t*h[e][0],(1-l.t)*t[1]+l.t*h[e][1],t[2],`${t[3]} 1)`)})}})});let c=[];h.forEach((t,e)=>{if(!s[e][2]){for(let i=t[1];i<n.footprint;i++)if(n.numbers[t[0]][i]===1/0)for(let a=0;a<this.infiniteHeight;a++)c.push([t[0],i,a])}}),this.deleteCubes(n,c,!0);let d=[];for(let f=n.footprint-1;f>h[0][0];f--)d.push([f,0,!1]);for(let m=h[h.length-1][1];m<n.footprint;m++)d.push([-1,m,!0]);l.t=0,await new Promise((t,e)=>{anime({targets:l,t:1,duration:this.animationTime/2,easing:"easeInQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,e)=>{this.drawBoundaryRect(n,h[e][0],h[e][1],t[2],`${t[3]} 1)`)}),d.forEach((t,e)=>{this.drawBoundaryRect(n,t[0],t[1],t[2],`${s[0][3]} 1)`)}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),s.forEach((t,e)=>{this.drawBoundaryRect(n,h[e][0],h[e][1],t[2],`${t[3]} 1)`)}),d.forEach((t,e)=>{this.drawBoundaryRect(n,t[0],t[1],t[2],`${s[0][3]} ${l.t})`)})}})}),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",a()})}drawBoundaryRect(t,e,i,s,a){let r=(this.totalArrayFootprint-t.footprint-1)/2,n=t.partialFootprintSum-t.footprint;this.wilsonNumbers.ctx.fillStyle=a,s?this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+n+1)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+r+1+15/16)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(1/16)/(this.totalArrayFootprint+1)):this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+n+15/16)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+r+1)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth*(1/16)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight/(this.totalArrayFootprint+1))}}