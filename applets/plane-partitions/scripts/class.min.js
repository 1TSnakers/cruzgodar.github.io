"use strict";class PlanePartitions extends Applet{load_promise=null;wilson_numbers=null;wilson_hidden=null;wilson_hidden_2=null;wilson_hidden_3=null;wilson_hidden_4=null;use_fullscreen_button=!1;resolution=2e3;animation_time=600;asymptote_lightness=.6;cube_lightness=.4;floor_lightness=.4;infinite_height=100;add_walls=!1;wall_size=30;scene=null;orthographic_camera=null;renderer=null;loader=null;cube_texture=null;cube_texture_2=null;floor_texture=null;floor_texture_2=null;cube_geometry=null;floor_geometry=null;wall_left_geometry=null;wall_right_geometry=null;ambient_light=null;dimers_shown=!1;ambient_light=null;point_light=null;rotation_y=0;rotation_y_velocity=0;next_rotation_y_velocity=0;last_rotation_y_velocities=[];rotation_y_velocity_friction=.94;rotation_y_velocity_start_threshhold=.005;rotation_y_velocity_stop_threshhold=5e-4;in_2d_view=!1;in_exact_hex_view=!0;currently_animating_camera=!1;currently_running_algorithm=!1;need_download=!1;font_size=10;arrays=[];total_array_footprint=0;total_array_height=0;total_array_size=0;hex_view_camera_pos=[15,15,15];_2d_view_camera_pos=[0,20,0];algorithm_data={hillman_grassl:{method:this.hillman_grassl,input_type:["pp"]},hillman_grassl_inverse:{method:this.hillman_grassl_inverse,input_type:["tableau"]},pak:{method:this.pak,input_type:["pp"]},pak_inverse:{method:this.pak_inverse,input_type:["tableau"]},sulzgruber:{method:this.sulzgruber,input_type:["pp"]},sulzgruber_inverse:{method:this.sulzgruber_inverse,input_type:["tableau"]},rsk:{method:this.rsk,input_type:["ssyt","ssyt"],same_shape:!0},rsk_inverse:{method:this.rsk_inverse,input_type:["tableau"]},godar_1:{method:this.godar_1,input_type:["pp"]},godar_1_inverse:{method:this.godar_1_inverse,input_type:["pp","pp"]}};constructor(t,e,i=!0){super(t),this.use_fullscreen_button=i;let a=document.createElement("canvas");a.classList.add("hidden-canvas"),this.hidden_canvases.push(a),Page.element.appendChild(a);let s=document.createElement("canvas");s.classList.add("hidden-canvas"),this.hidden_canvases.push(s),Page.element.appendChild(s);let r=document.createElement("canvas");r.classList.add("hidden-canvas"),this.hidden_canvases.push(r),Page.element.appendChild(r);let n=document.createElement("canvas");n.classList.add("hidden-canvas"),this.hidden_canvases.push(n),Page.element.appendChild(n);let h={renderer:"cpu",canvas_width:this.resolution,canvas_height:this.resolution,use_fullscreen:!0,use_fullscreen_button:!1,mousedown_callback:this.on_grab_canvas.bind(this),touchstart_callback:this.on_grab_canvas.bind(this),mousedrag_callback:this.on_drag_canvas.bind(this),touchmove_callback:this.on_drag_canvas.bind(this),mouseup_callback:this.on_release_canvas.bind(this),touchend_callback:this.on_release_canvas.bind(this)};this.wilson_numbers=new Wilson(e,h),this.wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),Page.set_element_styles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0);let l={canvas_width:this.resolution,canvas_height:this.resolution,use_fullscreen:!0,use_fullscreen_button:this.use_fullscreen_button,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:this.switch_fullscreen.bind(this)};this.wilson=new Wilson(t,l);let o={renderer:"cpu",canvas_width:64,canvas_height:64};this.wilson_hidden=new Wilson(a,o),this.wilson_hidden_2=new Wilson(s,o),this.wilson_hidden_3=new Wilson(r,o),this.wilson_hidden_4=new Wilson(n,o),this.wilson_hidden.ctx.strokeStyle="rgb(255, 255, 255)",this.wilson_hidden.ctx._alpha=1,this.wilson_hidden.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilson_hidden.ctx.fillRect(0,0,64,64),this.wilson_hidden.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilson_hidden.ctx.fillRect(4,4,56,56),this.wilson_hidden.ctx.lineWidth=6,this.wilson_hidden_2.ctx.strokeStyle="rgb(255, 255, 255)",this.wilson_hidden_2.ctx._alpha=1,this.wilson_hidden_2.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilson_hidden_2.ctx.fillRect(0,0,64,64),this.wilson_hidden_2.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilson_hidden_2.ctx.fillRect(4,4,56,56),this.wilson_hidden_2.ctx.lineWidth=6,this.wilson_hidden_3.ctx.strokeStyle="rgb(255, 255, 255)",this.wilson_hidden_3.ctx._alpha=1,this.wilson_hidden_3.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:1})`,this.wilson_hidden_3.ctx.fillRect(0,0,64,64),this.wilson_hidden_3.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:1})`,this.wilson_hidden_3.ctx.fillRect(4,4,56,56),this.wilson_hidden_3.ctx.lineWidth=6,this.wilson_hidden_4.ctx.strokeStyle="rgb(255, 255, 255)",this.wilson_hidden_4.ctx._alpha=1,this.wilson_hidden_4.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:1})`,this.wilson_hidden_4.ctx.fillRect(0,0,64,64),this.wilson_hidden_4.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:1})`,this.wilson_hidden_4.ctx.fillRect(4,4,56,56),this.wilson_hidden_4.ctx.lineWidth=6,this.load_promise=new Promise(async(t,e)=>{Site.scripts_loaded.three||(await Site.load_script("/scripts/three.min.js"),Site.scripts_loaded.three=!0),Site.scripts_loaded.lodash||(await Site.load_script("/scripts/lodash.min.js"),Site.scripts_loaded.lodash=!0),this.scene=new THREE.Scene,this.scene.background=new THREE.Color(0),this.orthographic_camera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0}),this.renderer.setSize(this.resolution,this.resolution,!1),this.loader=new THREE.TextureLoader,this.cube_texture=new THREE.CanvasTexture(this.wilson_hidden.canvas),this.cube_texture.minFilter=THREE.LinearFilter,this.cube_texture.magFilter=THREE.NearestFilter,this.cube_texture_2=new THREE.CanvasTexture(this.wilson_hidden_2.canvas),this.cube_texture_2.minFilter=THREE.LinearFilter,this.cube_texture_2.magFilter=THREE.NearestFilter,this.floor_texture=new THREE.CanvasTexture(this.wilson_hidden_3.canvas),this.floor_texture.minFilter=THREE.LinearFilter,this.floor_texture.magFilter=THREE.NearestFilter,this.floor_texture_2=new THREE.CanvasTexture(this.wilson_hidden_4.canvas),this.floor_texture_2.minFilter=THREE.LinearFilter,this.floor_texture_2.magFilter=THREE.NearestFilter,this.cube_geometry=new THREE.BoxGeometry,this.dimers_shown=!1,this.floor_geometry=new THREE.BoxGeometry(1,.001,1),this.wall_left_geometry=new THREE.BoxGeometry(.001,1,1),this.wall_right_geometry=new THREE.BoxGeometry(1,1,.001),this.ambient_light=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambient_light),this.point_light=new THREE.PointLight(16777215,3,1e4),this.point_light.position.set(750,1e3,500),this.scene.add(this.point_light),this.draw_frame(),t()})}on_grab_canvas(t,e,i){this.in_exact_hex_view=!1,this.rotation_y_velocity=0,this.last_rotation_y_velocities=[0,0,0,0]}on_drag_canvas(t,e,i,a,s){!this.in_2d_view&&(this.rotation_y+=i,this.rotation_y>Math.PI?this.rotation_y-=2*Math.PI:this.rotation_y<-Math.PI&&(this.rotation_y+=2*Math.PI),this.scene.children.forEach(t=>t.rotation.y=this.rotation_y),this.next_rotation_y_velocity=i)}on_release_canvas(t,e,i){if(!this.in_2d_view){let a=0;if(this.last_rotation_y_velocities.forEach((t,e)=>{Math.abs(t)>this.rotation_y_velocity&&(this.rotation_y_velocity=Math.abs(t),a=e)}),this.rotation_y_velocity<this.rotation_y_velocity_start_threshhold){this.rotation_y_velocity=0;return}this.rotation_y_velocity=this.last_rotation_y_velocities[a]}this.last_rotation_y_velocities=[0,0,0,0]}draw_frame(){this.renderer.render(this.scene,this.orthographic_camera),this.last_rotation_y_velocities.push(this.next_rotation_y_velocity),this.last_rotation_y_velocities.shift(),this.next_rotation_y_velocity=0,0!==this.rotation_y_velocity&&(this.rotation_y+=this.rotation_y_velocity,this.scene.children.forEach(t=>t.rotation.y=this.rotation_y),this.rotation_y_velocity*=this.rotation_y_velocity_friction,Math.abs(this.rotation_y_velocity)<this.rotation_y_velocity_stop_threshhold&&(this.rotation_y_velocity=0)),this.rotation_y>Math.PI?this.rotation_y-=2*Math.PI:this.rotation_y<-Math.PI&&(this.rotation_y+=2*Math.PI),this.need_download&&(this.need_download=!1,this.wilson.canvas.toBlob(t=>{let e=document.createElement("a");e.download="a-plane-partition.png",e.href=window.URL.createObjectURL(t),e.click(),e.remove()})),window.requestAnimationFrame(this.draw_frame.bind(this))}switch_fullscreen(){if(this.use_fullscreen_button)try{document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(t){}this.in_2d_view||this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),this.wilson_numbers.fullscreen.switch_fullscreen()}generate_random_plane_partition(){let t=Math.floor(3*Math.random())+5,e=Array(t);for(let i=0;i<t;i++)e[i]=Array(t);e[0][0]=Math.floor(5*Math.random())+10;for(let a=1;a<t;a++)e[0][a]=Math.max(e[0][a-1]-Math.floor(4*Math.random()),0);for(let s=1;s<t;s++){e[s][0]=Math.max(e[s-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<t;r++)e[s][r]=Math.max(Math.min(e[s][r-1],e[s-1][r])-Math.floor(4*Math.random()),0)}for(let n=0;n<t;n++)e[t-1][n]=0,e[n][t-1]=0;return e}generate_random_tableau(){let t=Math.floor(3*Math.random())+5,e=Array(t);for(let i=0;i<t;i++){e[i]=Array(t);for(let a=0;a<t;a++)Math.random()<.75/t?e[i][a]=Math.floor(3*Math.random())+1:e[i][a]=0}for(let s=0;s<t;s++)e[s][t-1]=0,e[t-1][s]=0;return e}generate_random_ssyt(){let t=Math.floor(3*Math.random())+2,e=Array(t);for(let i=0;i<t;i++)e[i]=Array(t);e[0][0]=Math.floor(2*Math.random());for(let a=1;a<t;a++)e[0][a]=e[0][a-1]+Math.floor(2*Math.random());for(let s=1;s<t;s++){e[s][0]=e[s-1][0]+1+Math.floor(2*Math.random());for(let r=1;r<t;r++)e[s][r]=Math.max(e[s][r-1],e[s-1][r]+1)+Math.floor(2*Math.random())}return e}parse_array(t){let e=t.split("\n"),i=e.length,a=Array(e.length);for(let s=0;s<a.length;s++){a[s]=e[s].split(" ");for(let r=0;r<a[s].length;r++)""===a[s][r]&&(a[s].splice(r,1),r--)}let n=a[0].length;if(-1===t.indexOf(">")){for(let h=0;h<a.length;h++)a[h].push("0");n++}-1===t.indexOf("v")&&(a.push(["0"]),i++);let l=Math.max(i,n),o=Array(l);for(let c=0;c<i;c++){o[c]=Array(l);for(let u=0;u<a[c].length;u++)"^"===a[c][u]?o[c][u]=1/0:">"===a[c][u]?o[c][u]=o[c][u-1]:"v"===a[c][u]?o[c][u]=o[c-1][u]:o[c][u]=parseInt(a[c][u]);for(let $=a[c].length;$<l;$++)o[c][$]=0}for(let d=i;d<l;d++){o[d]=Array(l);for(let f=0;f<l;f++)o[d][f]=0}return o}array_to_ascii(t){let e=1;for(let i=0;i<t.length;i++)for(let a=0;a<t.length;a++)t[i][a]!==1/0&&(e=Math.max(e,`${t[i][a]}`.length));e++;let s="";for(let r=0;r<t.length-1;r++){for(let n=0;n<t.length-1;n++)if(t[r][n]===1/0){for(let h=0;h<e-1-(0===n);h++)s+=" ";s+="^"}else{let l=`${t[r][n]}`.length;for(let o=0;o<e-l-(0===n);o++)s+=" ";s+=t[r][n]}if(0!==t[r][t.length-1]){for(let c=0;c<e-1;c++)s+=" ";s+=">"}r!==t.length-2&&(s+="\n")}if(0!==t[t.length-1][0]){s+="\n";for(let u=0;u<t.length-1;u++)if(0!==t[t.length-1][u]){for(let $=0;$<e-1-(0===u);$++)s+=" ";s+="v"}}return s}verify_pp(t){for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++)if(t[e][i]<t[e+1][i]||t[e][i]<t[e][i+1])return!1;return!0}verify_ssyt(t){for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++)if(0!==t[e+1][i]&&t[e][i]>=t[e+1][i]||0!==t[e][i+1]&&t[e][i]>t[e][i+1])return!1;return!0}display_error(t){}add_new_array(t,e,i=!1,a=!0){return new Promise(async(s,r)=>{if(this.currently_animating){s();return}let n={numbers:e,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};this.in_2d_view&&!i&&await Page.Animate.change_opacity(this.wilson_numbers.canvas,0,this.animation_time/5),this.arrays.splice(t,0,n),n.footprint=n.numbers.length;for(let h=t;h<this.arrays.length;h++)this.arrays[h].partial_footprint_sum=this.arrays[h].footprint,0!==h?(this.arrays[h].center_offset=this.arrays[h-1].center_offset+this.arrays[h-1].footprint/2+this.arrays[h].footprint/2+1,this.arrays[h].partial_footprint_sum+=this.arrays[h-1].partial_footprint_sum+1):this.arrays[h].center_offset=0,h!==t&&(this.in_2d_view?anime({targets:this.arrays[h].cube_group.position,x:this.arrays[h].center_offset,y:0,z:0,duration:this.animation_time,easing:"easeInOutQuad"}):anime({targets:this.arrays[h].cube_group.position,x:this.arrays[h].center_offset,y:0,z:-this.arrays[h].center_offset,duration:this.animation_time,easing:"easeInOutQuad"}));n.cube_group=new THREE.Object3D,this.scene.add(n.cube_group),this.add_walls||(this.in_2d_view?n.cube_group.position.set(n.center_offset,0,0):n.cube_group.position.set(n.center_offset,0,-n.center_offset)),n.cube_group.rotation.y=this.rotation_y,n.cubes=Array(n.footprint),n.floor=Array(n.footprint);for(let l=0;l<n.footprint;l++){n.cubes[l]=Array(n.footprint),n.floor[l]=Array(n.footprint);for(let o=0;o<n.footprint;o++)if(n.numbers[l][o]!==1/0){if(n.cubes[l][o]=Array(n.numbers[l][o]),n.numbers[l][o]>n.height&&(n.height=n.numbers[l][o]),n.floor[l][o]=this.add_floor(n,o,l),a){let c=Math.max(n.numbers[l][n.footprint-1],n.numbers[n.footprint-1][o]);for(let u=0;u<c;u++)n.cubes[l][o][u]=this.add_cube(n,o,u,l,0,0,this.asymptote_lightness);for(let $=c;$<n.numbers[l][o];$++)n.cubes[l][o][$]=this.add_cube(n,o,$,l)}else for(let d=0;d<n.numbers[l][o];d++)n.cubes[l][o][d]=this.add_cube(n,o,d,l)}else{n.cubes[l][o]=Array(this.infinite_height),n.floor[l][o]=this.add_floor(n,o,l);for(let f=0;f<this.infinite_height;f++)n.cubes[l][o][f]=this.add_cube(n,o,f,l,0,0,this.asymptote_lightness)}}if(this.add_walls){n.left_wall=Array(this.wall_size),n.right_wall=Array(this.wall_size);for(let w=0;w<this.wall_size;w++)n.left_wall[w]=Array(2*this.wall_size),n.right_wall[w]=Array(2*this.wall_size);for(let m=0;m<this.wall_size;m++)for(let g=0;g<2*this.wall_size;g++)n.left_wall[m][g]=this.add_left_wall(n,g,m),n.right_wall[m][g]=this.add_right_wall(n,m,g)}n.size=Math.max(n.footprint,n.height),this.total_array_footprint+=n.footprint+1,this.total_array_height=Math.max(this.total_array_height,n.height),this.total_array_size=Math.max(this.total_array_footprint,this.total_array_height),1!==this.arrays.length||i?this.add_walls||i||this.update_camera_height(!0):(this.hex_view_camera_pos=[this.total_array_size,this.total_array_size+this.total_array_height/3,this.total_array_size],this._2d_view_camera_pos=[0,this.total_array_size+10,0],this.in_2d_view&&!i?this.update_camera_height(!0):(this.orthographic_camera.left=-this.total_array_size,this.orthographic_camera.right=this.total_array_size,this.orthographic_camera.top=this.total_array_size,this.orthographic_camera.bottom=-this.total_array_size,this.orthographic_camera.position.set(this.hex_view_camera_pos[0],this.hex_view_camera_pos[1],this.hex_view_camera_pos[2]),this.orthographic_camera.rotation.set(-.785398163,.615479709,.523598775),this.orthographic_camera.updateProjectionMatrix())),t!==this.arrays.length-1&&await new Promise((t,e)=>setTimeout(t,this.animation_time));let p=[];n.cube_group.traverse(t=>{t.material&&t.material.forEach(t=>p.push(t))}),await new Promise(async(t,e)=>{anime({targets:p,opacity:1,duration:this.animation_time/2,easing:"easeOutQuad",complete:t})}),this.in_2d_view&&!i&&this.draw_all_2d_view_text(),s(n)})}edit_array(t,e){return new Promise(async(i,a)=>{if(this.currently_animating){i();return}if(t>=this.arrays.length||t<0){this.display_error(`No array at index ${t}`);return}await this.remove_array(t),await this.add_new_array(t,e),this.in_2d_view||this.update_camera_height(),i()})}trim_array(t){return new Promise(async(e,i)=>{if(this.currently_animating){e();return}if(t>=this.arrays.length||t<0){this.display_error(`No array at index ${t}`);return}let a=arrays[t].numbers,s=0;for(let r=0;r<a.length;r++)for(let n=0;n<a.length;n++)0!==a[r][n]&&(s=Math.max(s,Math.max(r+1,n+1)));let h=Array(s);for(let l=0;l<s;l++){h[l]=Array(s);for(let o=0;o<s;o++)h[l][o]=a[l][o]}await this.remove_array(t),await this.add_new_array(t,h),this.in_2d_view||this.update_camera_height(),e()})}remove_array(t,e=!1){return new Promise(async(i,a)=>{if(this.currently_animating){i();return}if(t>=this.arrays.length||t<0){this.display_error(`No array at index ${t}`);return}this.in_2d_view&&!e&&await Page.Animate.change_opacity(this.wilson_numbers.canvas,0,this.animation_time/5),await new Promise((e,i)=>{let a=[];this.arrays[t].cube_group.traverse(t=>{t.material&&t.material.forEach(t=>a.push(t))}),anime({targets:a,opacity:0,duration:this.animation_time/2,easing:"easeOutQuad",complete:e})});for(let s=0;s<this.arrays[t].cubes.length;s++)for(let r=0;r<this.arrays[t].cubes[s].length;r++)if(this.arrays[t].cubes[s][r])for(let n=0;n<this.arrays[t].cubes[s][r].length;n++)this.arrays[t].cubes[s][r][n]&&this.arrays[t].cubes[s][r][n].material.forEach(t=>t.dispose());this.scene.remove(this.arrays[t].cube_group),this.total_array_footprint-=this.arrays[t].footprint+1,this.arrays.splice(t,1);for(let h=t;h<this.arrays.length;h++)this.arrays[h].partial_footprint_sum=this.arrays[h].footprint,0!==h?(this.arrays[h].center_offset=this.arrays[h-1].center_offset+this.arrays[h-1].footprint/2+this.arrays[h].footprint/2+1,this.arrays[h].partial_footprint_sum+=this.arrays[h-1].partial_footprint_sum+1):this.arrays[h].center_offset=0,this.in_2d_view?anime({targets:this.arrays[h].cube_group.position,x:this.arrays[h].center_offset,y:0,z:0,duration:this.animation_time,easing:"easeInOutQuad"}):anime({targets:this.arrays[h].cube_group.position,x:this.arrays[h].center_offset,y:0,z:-this.arrays[h].center_offset,duration:this.animation_time,easing:"easeInOutQuad"});0===this.arrays.length||e||this.update_camera_height(!0),i()})}add_cube(t,e,i,a,s=0,r=0,n=this.cube_lightness){let h=[new THREE.MeshStandardMaterial({map:this.cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cube_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cube_texture_2,transparent:!0,opacity:0})];h.forEach(t=>t.color.setHSL(s,r,n));let l=new THREE.Mesh(this.cube_geometry,h);return t.cube_group.add(l),this.add_walls?l.position.set(e,i,a):l.position.set(e-(t.footprint-1)/2,i,a-(t.footprint-1)/2),l}add_floor(t,e,i,a=0,s=0,r=this.floor_lightness){let n=[new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(a,s,r));let h=new THREE.Mesh(this.floor_geometry,n);return t.cube_group.add(h),this.add_walls?h.position.set(e,-.5005,i):h.position.set(e-(t.footprint-1)/2,-.5005,i-(t.footprint-1)/2),h}add_left_wall(t,e,i,a=0,s=0,r=this.floor_lightness){let n=[new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(a,s,r));let h=new THREE.Mesh(this.wall_left_geometry,n);return t.cube_group.add(h),this.add_walls?h.position.set(-.5005,e-this.wall_size,i):h.position.set(-.5005-(t.footprint-1)/2,e,i-(t.footprint-1)/2),h}add_right_wall(t,e,i,a=0,s=0,r=this.floor_lightness){let n=[new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floor_texture_2,transparent:!0,opacity:0})];n.forEach(t=>t.color.setHSL(a,s,r));let h=new THREE.Mesh(this.wall_right_geometry,n);return t.cube_group.add(h),this.add_walls?h.position.set(e,i-this.wall_size,-.5005):h.position.set(e-(t.footprint-1)/2,i,-.5005-(t.footprint-1)/2),h}show_hex_view(){return new Promise(async(t,e)=>{if(this.currently_animating_camera){t();return}this.currently_animating_camera=!0,this.in_2d_view&&await Page.Animate.change_opacity(this.wilson_numbers.canvas,0,this.animation_time/5),this.in_2d_view=!1,this.in_exact_hex_view=!0,this.rotation_y_velocity=0,this.last_rotation_y_velocities=[0,0,0,0],this.update_camera_height(!0),anime({targets:this.orthographic_camera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:this.animation_time,easing:"easeInOutQuad",complete:()=>{this.currently_animating_camera=!1,t()}}),this.arrays.forEach(t=>{anime({targets:t.cube_group.rotation,y:0,duration:this.animation_time,easing:"easeInOutQuad"}),anime({targets:t.cube_group.position,x:t.center_offset,y:0,z:-t.center_offset,duration:this.animation_time,easing:"easeInOutQuad"})}),this.rotation_y=0})}show_2d_view(){return new Promise(async(t,e)=>{if(this.currently_animating_camera||this.in_2d_view){t();return}this.dimers_shown&&await this.hide_dimers(),this.currently_animating_camera=!0,this.in_2d_view=!0,this.in_exact_hex_view=!1,this.rotation_y_velocity=0,this.last_rotation_y_velocities=[0,0,0,0],this.update_camera_height(!0),anime({targets:this.orthographic_camera.rotation,x:-1.570796327,y:0,z:0,duration:this.animation_time,easing:"easeInOutQuad"}),this.arrays.forEach(t=>{anime({targets:t.cube_group.rotation,y:0,duration:this.animation_time,easing:"easeInOutQuad"}),anime({targets:t.cube_group.position,x:t.center_offset,y:0,z:0,duration:this.animation_time,easing:"easeInOutQuad"})}),setTimeout(()=>{this.draw_all_2d_view_text(),Page.Animate.change_opacity(this.wilson_numbers.canvas,1,this.animation_time/5).then(()=>{this.currently_animating_camera=!1,this.rotation_y=0,t()})},this.animation_time)})}update_camera_height(t=!1){if(!t){if(this.currently_animating_camera)return;this.currently_animating_camera=!0}this.total_array_height=0;for(let e=0;e<this.arrays.length;e++)this.total_array_height=Math.max(this.total_array_height,this.arrays[e].height);this.total_array_size=Math.max(this.total_array_footprint,this.total_array_height);let i=(-this.arrays[0].footprint/2+this.arrays[this.arrays.length-1].center_offset+this.arrays[this.arrays.length-1].footprint/2)/2;this.hex_view_camera_pos=[this.total_array_size+i,this.total_array_size+this.total_array_height/3,this.total_array_size-i],this.add_walls&&(this.hex_view_camera_pos[0]+=10,this.hex_view_camera_pos[1]+=10,this.hex_view_camera_pos[2]+=10),this._2d_view_camera_pos=[i,this.total_array_size+10,0],this.in_2d_view?(anime({targets:this.orthographic_camera.position,x:this._2d_view_camera_pos[0],y:this._2d_view_camera_pos[1],z:this._2d_view_camera_pos[2],duration:this.animation_time,easing:"easeInOutQuad"}),anime({targets:this.orthographic_camera,left:-(this.total_array_footprint/2+.5),right:this.total_array_footprint/2+.5,top:this.total_array_footprint/2+.5,bottom:-(this.total_array_footprint/2+.5),duration:this.animation_time,easing:"easeInOutQuad",update:()=>this.orthographic_camera.updateProjectionMatrix(),complete:()=>{this.orthographic_camera.updateProjectionMatrix(),this.currently_animating_camera=!1}}),setTimeout(()=>{this.draw_all_2d_view_text(),Page.Animate.change_opacity(this.wilson_numbers.canvas,1,this.animation_time/5)},this.animation_time)):(anime({targets:this.orthographic_camera.position,x:this.hex_view_camera_pos[0],y:this.hex_view_camera_pos[1],z:this.hex_view_camera_pos[2],duration:this.animation_time,easing:"easeInOutQuad"}),anime({targets:this.orthographic_camera,left:-this.total_array_size,right:this.total_array_size,top:this.total_array_size,bottom:-this.total_array_size,duration:this.animation_time,easing:"easeInOutQuad",update:()=>this.orthographic_camera.updateProjectionMatrix(),complete:()=>{this.orthographic_camera.updateProjectionMatrix(),this.currently_animating_camera=!1}}))}show_dimers(){return new Promise(async(t,e)=>{if(this.currently_animating_camera){t();return}this.dimers_shown=!0,this.in_exact_hex_view||await this.show_hex_view(),this.currently_animating_camera=!0;let i=[];this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let a=0;a<t.footprint;a++){for(let s=0;s<t.cubes[e][a].length;s++)s<t.cubes[e][a].length-1&&i.push(t.cubes[e][a][s].material[2]),e<t.footprint-1&&t.cubes[e+1][a].length>=s+1&&i.push(t.cubes[e][a][s].material[4]),a<t.footprint-1&&t.cubes[e][a+1].length>=s+1&&i.push(t.cubes[e][a][s].material[0]),i.push(t.cubes[e][a][s].material[1]),i.push(t.cubes[e][a][s].material[3]),i.push(t.cubes[e][a][s].material[5]);0!==t.cubes[e][a].length&&i.push(t.floor[e][a].material[2])}if(this.add_walls)for(let r=0;r<this.wall_size;r++)for(let n=0;n<2*this.wall_size;n++)i.push(t.right_wall[r][n].material[0]),i.push(t.left_wall[r][n].material[4])}),i.forEach(t=>t.opacity=0),await new Promise((t,e)=>{anime({targets:[this.wilson_hidden.ctx,this.wilson_hidden_2.ctx,this.wilson_hidden_3.ctx,this.wilson_hidden_4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:this.animation_time/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilson_hidden.ctx.clearRect(0,0,64,64),this.wilson_hidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilson_hidden.ctx._alpha})`,this.wilson_hidden.ctx.fillRect(0,0,64,64),this.wilson_hidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilson_hidden.ctx._alpha})`,this.wilson_hidden.ctx.fillRect(4,4,56,56),this.wilson_hidden.ctx.moveTo(42.7,21.3),this.wilson_hidden.ctx.lineTo(21.3,42.7),this.wilson_hidden.ctx.stroke(),this.cube_texture.needsUpdate=!0,this.wilson_hidden_2.ctx.clearRect(0,0,64,64),this.wilson_hidden_2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilson_hidden_2.ctx._alpha})`,this.wilson_hidden_2.ctx.fillRect(0,0,64,64),this.wilson_hidden_2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilson_hidden_2.ctx._alpha})`,this.wilson_hidden_2.ctx.fillRect(4,4,56,56),this.wilson_hidden_2.ctx.moveTo(21.3,21.3),this.wilson_hidden_2.ctx.lineTo(42.7,42.7),this.wilson_hidden_2.ctx.stroke(),this.cube_texture_2.needsUpdate=!0,this.wilson_hidden_3.ctx.clearRect(0,0,64,64),this.wilson_hidden_3.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:this.wilson_hidden_3.ctx._alpha})`,this.wilson_hidden_3.ctx.fillRect(0,0,64,64),this.wilson_hidden_3.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:this.wilson_hidden_3.ctx._alpha})`,this.wilson_hidden_3.ctx.fillRect(4,4,56,56),this.wilson_hidden_3.ctx.moveTo(42.7,21.3),this.wilson_hidden_3.ctx.lineTo(21.3,42.7),this.wilson_hidden_3.ctx.stroke(),this.floor_texture.needsUpdate=!0,this.wilson_hidden_4.ctx.clearRect(0,0,64,64),this.wilson_hidden_4.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:this.wilson_hidden_4.ctx._alpha})`,this.wilson_hidden_4.ctx.fillRect(0,0,64,64),this.wilson_hidden_4.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:this.wilson_hidden_4.ctx._alpha})`,this.wilson_hidden_4.ctx.fillRect(4,4,56,56),this.wilson_hidden_4.ctx.moveTo(21.3,21.3),this.wilson_hidden_4.ctx.lineTo(42.7,42.7),this.wilson_hidden_4.ctx.stroke(),this.floor_texture_2.needsUpdate=!0}})}),this.currently_animating_camera=!1,t()})}hide_dimers(){return new Promise(async(t,e)=>{if(this.currently_animating_camera){t();return}this.dimers_shown=!1;let i=[];this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let a=0;a<t.footprint;a++){for(let s=0;s<t.cubes[e][a].length;s++)s<t.cubes[e][a].length-1&&i.push(t.cubes[e][a][s].material[2]),e<t.footprint-1&&t.cubes[e+1][a].length>=s+1&&i.push(t.cubes[e][a][s].material[4]),a<t.footprint-1&&t.cubes[e][a+1].length>=s+1&&i.push(t.cubes[e][a][s].material[0]),i.push(t.cubes[e][a][s].material[1]),i.push(t.cubes[e][a][s].material[3]),i.push(t.cubes[e][a][s].material[5]);0!==t.cubes[e][a].length&&i.push(t.floor[e][a].material[2])}if(this.add_walls)for(let r=0;r<this.wall_size;r++)for(let n=0;n<2*this.wall_size;n++)i.push(t.left_wall[r][n].material[0]),i.push(t.right_wall[r][n].material[4])}),await new Promise((t,e)=>{anime({targets:[this.wilson_hidden.ctx,this.wilson_hidden_2.ctx,this.wilson_hidden_3.ctx,this.wilson_hidden_4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:this.animation_time/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilson_hidden.ctx.clearRect(0,0,64,64),this.wilson_hidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilson_hidden.ctx._alpha})`,this.wilson_hidden.ctx.fillRect(0,0,64,64),this.wilson_hidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilson_hidden.ctx._alpha})`,this.wilson_hidden.ctx.fillRect(4,4,56,56),this.wilson_hidden.ctx.moveTo(42.7,21.3),this.wilson_hidden.ctx.lineTo(21.3,42.7),this.wilson_hidden.ctx.stroke(),this.cube_texture.needsUpdate=!0,this.wilson_hidden_2.ctx.clearRect(0,0,64,64),this.wilson_hidden_2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilson_hidden_2.ctx._alpha})`,this.wilson_hidden_2.ctx.fillRect(0,0,64,64),this.wilson_hidden_2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilson_hidden_2.ctx._alpha})`,this.wilson_hidden_2.ctx.fillRect(4,4,56,56),this.wilson_hidden_2.ctx.moveTo(21.3,21.3),this.wilson_hidden_2.ctx.lineTo(42.7,42.7),this.wilson_hidden_2.ctx.stroke(),this.cube_texture_2.needsUpdate=!0,this.wilson_hidden_3.ctx.clearRect(0,0,64,64),this.wilson_hidden_3.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:this.wilson_hidden_3.ctx._alpha})`,this.wilson_hidden_3.ctx.fillRect(0,0,64,64),this.wilson_hidden_3.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:this.wilson_hidden_3.ctx._alpha})`,this.wilson_hidden_3.ctx.fillRect(4,4,56,56),this.wilson_hidden_3.ctx.moveTo(42.7,21.3),this.wilson_hidden_3.ctx.lineTo(21.3,42.7),this.wilson_hidden_3.ctx.stroke(),this.floor_texture.needsUpdate=!0,this.wilson_hidden_4.ctx.clearRect(0,0,64,64),this.wilson_hidden_4.ctx.fillStyle=`rgba(32, 32, 32, ${this.add_walls?0:this.wilson_hidden_4.ctx._alpha})`,this.wilson_hidden_4.ctx.fillRect(0,0,64,64),this.wilson_hidden_4.ctx.fillStyle=`rgba(64, 64, 64, ${this.add_walls?0:this.wilson_hidden_4.ctx._alpha})`,this.wilson_hidden_4.ctx.fillRect(4,4,56,56),this.wilson_hidden_4.ctx.moveTo(21.3,21.3),this.wilson_hidden_4.ctx.lineTo(42.7,42.7),this.wilson_hidden_4.ctx.stroke(),this.floor_texture_2.needsUpdate=!0}})}),i.forEach(t=>t.opacity=1),this.currently_animating_camera=!1,t()})}show_floor(t=1){return new Promise(async(e,i)=>{let a=[];this.arrays.forEach(t=>{t.floor.forEach(t=>{t.forEach(t=>{t.material.forEach(t=>a.push(t))})})}),anime({targets:a,opacity:t,duration:this.animation_time/2,easing:"easeOutQuad",complete(){e()}})})}hide_floor(){return this.show_floor(0)}remove_outside_floor(t){let e=[],i=[];for(let a=0;a<t.footprint;a++)for(let s=t.footprint-1;s>=0&&0===t.numbers[a][s];s--)t.floor[a][s].material.forEach(t=>e.push(t)),i.push([a,s]);i.forEach(e=>{t.floor[e[0]][e[1]].material.forEach(t=>t.dispose()),t.cube_group.remove(t.floor[e[0]][e[1]]),t.floor[e[0]][e[1]]=null}),this.in_2d_view&&this.draw_all_2d_view_text()}recalculate_heights(t){t.height=0,t.numbers.forEach(e=>{e.forEach(e=>{e!==1/0&&(t.height=Math.max(e,t.height))})}),t.size=Math.max(t.footprint,t.height),this.total_array_height,this.total_array_height=0,this.arrays.forEach(t=>this.total_array_height=Math.max(t.height,this.total_array_height)),this.total_array_size=Math.max(this.total_array_footprint,this.total_array_height),this.total_array_height!==this.old_total_array_height&&this.update_camera_height()}draw_all_2d_view_text(){this.font_size=this.wilson_numbers.canvas_width/(this.total_array_footprint+1);let t=Math.max(`${this.total_array_height}`.length,2);this.wilson_numbers.ctx.font=`${this.font_size/t}px monospace`,this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),this.arrays.forEach(t=>{for(let e=0;e<t.footprint;e++)for(let i=0;i<t.footprint;i++)null!==t.floor[e][i]&&this.draw_single_cell_2d_view_text(t,e,i)})}draw_single_cell_2d_view_text(t,e,i){let a=(this.total_array_footprint-t.footprint-1)/2,s=t.partial_footprint_sum-t.footprint;if(this.wilson_numbers.ctx.clearRect(this.font_size*(i+s+1),this.font_size*(e+a+1),this.font_size,this.font_size),t.numbers[e][i]!==1/0&&(0!==t.numbers[e][i]||0!==this.floor_lightness)){let r=this.wilson_numbers.ctx.measureText(t.numbers[e][i]);this.wilson_numbers.ctx.fillText(t.numbers[e][i],this.font_size*(i+s+1)+(this.font_size-r.width)/2,this.font_size*(e+a+1)+(this.font_size+r.actualBoundingBoxAscent-r.actualBoundingBoxDescent)/2)}}color_cubes(t,e,i){return new Promise((a,s)=>{if(0===e.length){a();return}let r=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>r.push(t.color))}),r.forEach(t=>t.getRGB(t));let n=this.cube_lightness+1*Math.min(this.cube_lightness,1-this.cube_lightness),h=0===n?0:2*(1-this.cube_lightness/n),l=r.map(t=>this.wilson.utils.hsv_to_rgb(i,h,n));anime({targets:r,r:(t,e)=>l[e][0]/255,g:(t,e)=>l[e][1]/255,b:(t,e)=>l[e][2]/255,duration:this.animation_time,delay:(t,e)=>Math.floor(e/6)*this.animation_time/10,easing:"easeOutQuad",update:()=>r.forEach(t=>t.setRGB(t.r,t.g,t.b)),complete:a})})}uncolor_cubes(t,e){return new Promise((i,a)=>{let s=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>s.push(t.color))}),s.forEach(t=>t.getHSL(t)),anime({targets:s,s:0,duration:this.animation_time,easing:"easeOutQuad",update:()=>s.forEach(t=>t.setHSL(t.h,t.s,this.cube_lightness)),complete:i})})}raise_cubes(t,e,i){return new Promise((a,s)=>{let r=this.in_2d_view?0:this.animation_time,n=[];e.forEach(e=>{n.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),anime({targets:n,y:i,duration:r,easing:"easeInOutQuad",complete:a})})}lower_cubes(t,e){return new Promise((i,a)=>{let s=this.in_2d_view?0:this.animation_time,r=[];e.forEach(e=>{r.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),anime({targets:r,y:(i,a)=>t.numbers[e[a][0]][e[a][1]],duration:s,easing:"easeInOutQuad",complete(){e.forEach(e=>{t.cubes[e[0]][e[1]][t.numbers[e[0]][e[1]]]=t.cubes[e[0]][e[1]][e[2]],t.cubes[e[0]][e[1]][e[2]]=null}),i()}})})}move_cubes(t,e,i,a,s=!0){return new Promise((r,n)=>{let h=[];e.forEach(e=>{h.push(t.cubes[e[0]][e[1]][e[2]].position),i.cube_group.attach(t.cubes[e[0]][e[1]][e[2]]),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),anime({targets:h,x:(t,e)=>a[e][1]-(i.footprint-1)/2,y:(t,e)=>a[e][2],z:(t,e)=>a[e][0]-(i.footprint-1)/2,duration:this.animation_time,easing:"easeInOutQuad",complete(){if(s){let n=e.map(e=>t.cubes[e[0]][e[1]][e[2]]);e.forEach(e=>t.cubes[e[0]][e[1]][e[2]]=null),a.forEach((t,a)=>{i.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),i.cubes[t[0]][t[1]][t[2]]&&!e.some(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])&&console.warn(`Moving a cube to a location that's already occupied: ${t}. This is probably not what you want to do.`),i.cubes[t[0]][t[1]][t[2]]=n[a]})}r()}})})}reveal_cubes(t,e){return new Promise((i,a)=>{if(0===e.length){i();return}let s=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>s.push(t)),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),anime({targets:s,opacity:1,duration:this.animation_time/2,delay:(t,e)=>Math.floor(e/6)*this.animation_time/10,easing:"easeOutQuad",complete:i})})}delete_cubes(t,e,i=!1,a=!1){return new Promise((s,r)=>{let n=[];e.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(t=>n.push(t))}),anime({targets:n,opacity:0,duration:this.animation_time/2*!a,delay:(t,e)=>!i*Math.floor(e/6)*this.animation_time/10,easing:"easeOutQuad",complete(){n.forEach(t=>t.dispose()),e.forEach(e=>{t.cube_group.remove(t.cubes[e[0]][e[1]][e[2]]),t.cubes[e[0]][e[1]][e[2]]=null}),s()}})})}delete_floor(t,e){return new Promise((i,a)=>{let s=[];e.forEach(e=>{t.floor[e[0]][e[1]].material.forEach(t=>s.push(t))}),anime({targets:s,opacity:0,duration:this.animation_time/2,easing:"easeOutQuad",complete(){s.forEach(t=>t.dispose()),e.forEach(e=>{t.cube_group.remove(t.floor[e[0]][e[1]]),t.cubes[e[0]][e[1]]=null}),i()}})})}run_example(t){return new Promise(async(e,i)=>{if(1===t||2===t){for(;this.arrays.length>1;)await this.remove_array(1),await new Promise((t,e)=>setTimeout(t,this.animation_time/2));if(0===this.arrays.length){let a=this.parse_array(this.generate_random_plane_partition());await this.add_new_array(this.arrays.length,a)}else if(!this.verify_pp(this.arrays[0].numbers)){await this.remove_array(0),await new Promise((t,e)=>setTimeout(t,this.animation_time/2));let s=this.parse_array(this.generate_random_plane_partition());await add_new_array(this.arrays.length,s)}1===t?(await this.run_algorithm("hillman_grassl",0),await new Promise((t,e)=>setTimeout(t,3*this.animation_time)),await this.run_algorithm("hillman_grassl_inverse",0)):(await this.run_algorithm("pak",0),await new Promise((t,e)=>setTimeout(t,3*this.animation_time)),await this.show_hex_view(),await new Promise((t,e)=>setTimeout(t,this.animation_time)),await this.run_algorithm("sulzgruber_inverse",0)),e()}else if(3===t){for(;this.arrays.length>0;)await this.remove_array(0),await new Promise((t,e)=>setTimeout(t,this.animation_time/2));await this.add_new_array(this.arrays.length,this.generate_random_tableau()),await this.show_2d_view(),await new Promise((t,e)=>setTimeout(t,this.animation_time)),await this.run_algorithm("rsk_inverse",0),await new Promise((t,e)=>setTimeout(t,3*this.animation_time)),await this.run_algorithm("rsk",0),e()}})}run_algorithm(t,e,i=!1){return new Promise(async(a,s)=>{if(!i&&this.currently_running_algorithm){a();return}this.currently_running_algorithm=!0;let r=this.algorithm_data[t],n=r.input_type.length;if(e>this.arrays.length-1||e<0){console.log(`No array at index ${e}!`),this.currently_running_algorithm=!1,a();return}if(n>1&&e>this.arrays.length-n){console.log(`No array at index ${e+n-1}! (This algorithm needs ${n} arrays)`),this.currently_running_algorithm=!1,a();return}for(let h=0;h<n;h++){let l=r.input_type[h];if("pp"===l&&!this.verify_pp(this.arrays[e+h].numbers)){console.log(`Array at index ${e+h} is not a plane partition!`),this.currently_running_algorithm=!1,s();return}if("ssyt"===l&&!this.verify_ssyt(this.arrays[e+h].numbers)){console.log(`Array at index ${e+h} is not an SSYT!`),this.currently_running_algorithm=!1,a();return}}if(n>1&&void 0!==r.same_shape&&r.same_shape){let o=Array(n),c=0;for(let u=0;u<n;u++)c=Math.max(c,this.arrays[e+u].numbers.length);for(let $=0;$<n;$++){o[$]=Array(c);for(let d=0;d<c;d++)o[$][d]=0;for(let f=0;f<this.arrays[e+$].numbers.length;f++){let w=0;for(;w<this.arrays[e+$].numbers[f].length&&0!==this.arrays[e+$].numbers[f][w];)w++;o[$][f]=w}}for(let m=1;m<n;m++)for(let g=0;g<c;g++)if(o[m][g]!==o[0][g]){this.display_error("Arrays are not the same shape!"),this.currently_running_algorithm=!1,a();return}}for(let p=0;p<n;p++){let y=[],b=this.arrays[e+p].numbers;for(let x=0;x<b.length;x++)for(let v=0;v<b.length;v++)if(b[x][v]!==1/0)for(let E=0;E<b[x][v];E++)y.push([x,v,E]);this.uncolor_cubes(this.arrays[e+p],y)}let S=r.method.bind(this);await S(e),this.sub_algorithm||(this.currently_running_algorithm=!1),a()})}hillman_grassl(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=_.cloneDeep(a.numbers),r=Array(s.length);for(let n=0;n<s.length;n++){let h=0;for(;h<s.length&&s[h][n]===1/0;)h++;r[n]=h}let l=Array(s.length);for(let o=0;o<s.length;o++){let c=0;for(;c<s.length&&s[o][c]===1/0;)c++;l[o]=c}let u=[];for(;;){let $=s[0].length-1;for(;$>=0&&r[$]<s.length&&0===s[r[$]][$];)$--;if($<0||r[$]===s.length)break;let d=r[$],f=$,w=[[d,f,s[d][f]-1]];for(;;){if(d<s.length-1&&s[d+1][f]===s[d][f])d++;else if(f>0&&s[d][f-1]!==1/0)f--;else break;w.push([d,f,s[d][f]-1])}for(let m=0;m<w.length;m++)s[w[m][0]][w[m][1]]--;u.push(w)}let g=Array(s.length);for(let p=0;p<s.length;p++){g[p]=Array(s.length);for(let y=0;y<s.length;y++)g[p][y]=s[p][y]===1/0?1/0:0}let b=await this.add_new_array(t+1,g);await new Promise((t,e)=>setTimeout(t,this.animation_time));for(let x=0;x<u.length;x++){await this.color_cubes(a,u[x],x/u.length*6/7),await this.raise_cubes(a,u[x],a.height);for(let v=0;v<u[x].length;v++)a.numbers[u[x][v][0]][u[x][v][1]]--,this.in_2d_view&&this.draw_single_cell_2d_view_text(a,u[x][v][0],u[x][v][1]);this.recalculate_heights(a),await new Promise((t,e)=>setTimeout(t,this.animation_time/5));let E=[u[x][u[x].length-1][0],u[x][0][1]],S=[],z=b.height+1;for(let M=r[E[1]];M<=E[0];M++)S.push([M,E[1],z]);let k=S[S.length-1];for(let R=E[1]-1;R>=l[E[0]];R--)S.push([E[0],R,z]);await this.move_cubes(a,u[x],b,S),S=[];for(let O=E[0]-1;O>=r[E[1]];O--)S.push([O,E[1],z]);this.delete_cubes(b,S),S=[];for(let Q=E[1]-1;Q>=l[E[0]];Q--)S.push([E[0],Q,z]);this.delete_cubes(b,S),await this.lower_cubes(b,[k]),b.numbers[k[0]][k[1]]++,this.recalculate_heights(b),this.in_2d_view&&this.draw_single_cell_2d_view_text(b,k[0],k[1]),b.height=Math.max(b.height,b.numbers[k[0]][k[1]]),b.size=Math.max(b.size,b.height),await new Promise((t,e)=>setTimeout(t,this.animation_time))}await this.remove_array(t),e()})}hillman_grassl_inverse(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=_.cloneDeep(a.numbers),r=[],n=Array(s.length);for(let h=0;h<s.length;h++){let l=0;for(;l<s.length&&s[l][h]===1/0;)l++;n[h]=l}let o=Array(s.length);for(let c=0;c<s.length;c++){let u=0;for(;u<s.length&&s[c][u]===1/0;)u++;o[c]=u}let $=Array(s.length);for(let d=0;d<s.length;d++){$[d]=Array(s.length);for(let f=0;f<s.length;f++)$[d][f]=s[d][f]===1/0?1/0:0}let w=_.cloneDeep($),m=await this.add_new_array(t+1,$);for(let g=0;g<s.length;g++)for(let p=s.length-1;p>=n[g];p--)for(;0!==s[p][g];){let y=[],b=p,x=o[p];for(;b>=0;){let v=x;if(0!==b)for(;w[b][v]!==w[b-1][v]&&v<g;)v++;else v=g;for(let E=x;E<=v;E++)y.push([b,E,w[b][E]]);if(b-1>=n[v])b--,x=v;else break}for(let S=0;S<y.length;S++)w[y[S][0]][y[S][1]]++;r.push([y,[p,g,s[p][g]-1]]),s[p][g]--}await new Promise((t,e)=>setTimeout(t,this.animation_time/2));for(let z=0;z<r.length;z++){let M=z/r.length*6/7;await this.color_cubes(a,[r[z][1]],M);let k=r[z][1][0],R=r[z][1][1],O=a.size;for(let Q=n[R];Q<k;Q++)a.cubes[Q][R][O]=this.add_cube(a,R,O,Q),a.cubes[Q][R][O].material.forEach(t=>t.color.setHSL(M,1,this.cube_lightness));for(let T=o[k];T<R;T++)a.cubes[k][T][O]=this.add_cube(a,T,O,k),a.cubes[k][T][O].material.forEach(t=>t.color.setHSL(M,1,this.cube_lightness));await this.raise_cubes(a,[r[z][1]],O);let I=[];for(let L=k-1;L>=n[R];L--)I.push([L,R,O]);let P=this.reveal_cubes(a,I);I=[];for(let F=R-1;F>=o[k];F--)I.push([k,F,O]);await Promise.all([P,this.reveal_cubes(a,I)]),I=[];for(let C=o[k];C<R;C++)I.push([k,C,O]);I.push([k,R,a.numbers[k][R]-1]);for(let A=k-1;A>=n[R];A--)I.push([A,R,O]);let H=r[z][0],B=m.height+1;H.forEach(t=>t[2]=B),a.numbers[k][R]--,this.recalculate_heights(a),this.in_2d_view&&this.draw_single_cell_2d_view_text(a,k,R),await this.move_cubes(a,I,m,H),await this.lower_cubes(m,H),H.forEach(t=>{m.numbers[t[0]][t[1]]++}),this.recalculate_heights(m),this.in_2d_view&&H.forEach(t=>this.draw_single_cell_2d_view_text(m,t[0],t[1])),await new Promise((t,e)=>setTimeout(t,this.animation_time/2))}await this.remove_array(t),e()})}pak(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=a.numbers;this.in_2d_view||await this.show_2d_view();let r=0,n=0;for(;r<a.footprint&&0!==a.numbers[r][a.footprint-1];)r++;for(;n<a.footprint&&0!==a.numbers[a.footprint-1][n];)n++;r=0,n=0;let h=0;for(let l=a.footprint-1-n;l>=0;l--)for(let o=a.footprint-1-r;o>=0;o--)s[l][o]!==1/0&&h++;let c=0;for(let u=0;u<a.footprint-n;u++)for(let $=0;$<a.footprint-r;$++){if(s[u][$]===1/0)continue;let d=[],f=0;for(;u+f<a.footprint&&$+f<a.footprint;)d.push([u+f,$+f,s[u+f][$+f]-1]),f++;f=d[0][0];let w=d[0][1],m=[];for(let g=s[f][w]-2;g>=0;g--)m.push([f,w,g]);this.color_cubes(a,m,c/h*6/7),m=[],d.forEach(t=>{t[2]>=0&&m.push(t)}),await this.color_cubes(a,m,c/h*6/7);let p=Array(d.length);d.forEach((t,e)=>{let i=t[0],r=t[1],n=0,h=0;i<a.footprint-1&&(n=s[i+1][r]),r<a.footprint-1&&(h=s[i][r+1]),p[e]=Math.max(n,h),e>0?(n=s[i-1][r],h=s[i][r-1],p[e]+=Math.min(n,h)-s[i][r]):p[e]=s[i][r]-p[e]});for(let y=0;y<d.length;y++){if(f=d[y][0],w=d[y][1],p[y]>s[f][w]){let b=[];for(let x=s[f][w];x<p[y];x++)a.cubes[f][w][x]=this.add_cube(a,w,x,f),b.push([f,w,x]);this.in_2d_view?this.reveal_cubes(a,b):await this.reveal_cubes(a,b)}else if(p[y]<s[f][w]){let v=[];for(let E=s[f][w]-1;E>=p[y];E--)v.push([f,w,E]);this.in_2d_view?this.delete_cubes(a,v):await this.delete_cubes(a,v)}s[f][w]=p[y],this.in_2d_view&&this.draw_single_cell_2d_view_text(a,f,w)}let S=[];m.forEach((t,e)=>{0!==e&&t[2]<s[t[0]][t[1]]&&S.push(t)}),this.in_2d_view?this.uncolor_cubes(a,S):await this.uncolor_cubes(a,S),c++,this.recalculate_heights(a),0!==m.length&&await new Promise((t,e)=>setTimeout(t,this.animation_time))}this.update_camera_height(!0),e()})}pak_inverse(t,e=0,i=0){return new Promise(async(a,s)=>{let r=this.arrays[t],n=r.numbers;this.in_2d_view||await this.show_2d_view();let h=0;for(let l=r.footprint-1-i;l>=0;l--)for(let o=r.footprint-1-e;o>=0;o--)n[l][o]!==1/0&&h++;let c=0;for(let u=r.footprint-1-i;u>=0;u--)for(let $=r.footprint-1-e;$>=0;$--){if(n[u][$]===1/0)continue;let d=[],f=0;for(;u+f<r.footprint&&$+f<r.footprint;)d.push([u+f,$+f,n[u+f][$+f]-1]),f++;f=d[0][0];let w=d[0][1],m=Array(d.length),g=!1;if(d.forEach((t,e)=>{let i=t[0],a=t[1],s=0,h=0;i<r.footprint-1&&(s=n[i+1][a]),a<r.footprint-1&&(h=n[i][a+1]),m[e]=Math.max(s,h),e>0?(s=n[i-1][a],h=n[i][a-1],m[e]+=Math.min(s,h)-n[i][a]):m[e]+=n[i][a],g||m[e]===n[i][a]||(g=!0)}),0!==n[f][w]){let p=[];for(let y=n[f][w]-1;y>=0;y--)p.push([f,w,y]);this.color_cubes(r,p,c/h*6/7)}else if(0!==m[0])r.cubes[f][w][0]=this.add_cube(r,w,0,f,c/h*6/7,1,this.cube_lightness),n[f][w]=1,this.reveal_cubes(r,[[f,w,0]]);else if(!g){c++;continue}await new Promise((t,e)=>setTimeout(t,this.animation_time));for(let b=0;b<d.length;b++){if(f=d[b][0],w=d[b][1],m[b]>n[f][w]){let x=[];for(let v=n[f][w];v<m[b];v++)r.cubes[f][w][v]=this.add_cube(r,w,v,f,c/h*6/7,1,this.cube_lightness),x.push([f,w,v]);this.in_2d_view?this.reveal_cubes(r,x):await this.reveal_cubes(r,x)}else if(m[b]<n[f][w]){let E=[];for(let S=n[f][w]-1;S>=m[b];S--)E.push([f,w,S]);this.in_2d_view?this.delete_cubes(r,E):await this.delete_cubes(r,E)}n[f][w]=m[b],this.in_2d_view&&this.draw_single_cell_2d_view_text(r,f,w)}c++,this.recalculate_heights(r),await new Promise((t,e)=>setTimeout(t,this.animation_time))}this.update_camera_height(!0),a()})}sulzgruber(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=_.cloneDeep(a.numbers),r=Array(s.length);for(let n=0;n<s.length;n++){let h=0;for(;h<s.length&&s[h][n]===1/0;)h++;r[n]=h}let l=Array(s.length);for(let o=0;o<s.length;o++){let c=0;for(;c<s.length&&s[o][c]===1/0;)c++;l[o]=c}let u={},$={};for(let d=0;d<s.length;d++)$[-d]=[d,0];for(let f=1;f<s.length;f++)$[f]=[0,f];for(let w=-s.length+1;w<s.length;w++){let m=$[w][0],g=$[w][1];for(;m<s.length&&g<s.length&&s[m][g]===1/0;)m++,g++;if($[w]=[m,g],m===s.length||g===s.length){u[w]=-1;continue}let p=0===g||s[m][g-1]===1/0,y=0===m||s[m-1][g]===1/0;p&&y?u[w]=0:p?u[w]=3:y?u[w]=2:u[w]=1}let b=[];for(let x=-s.length+1;x<s.length;x++){if(1===u[x]||3===u[x])continue;let v=$[x][0],E=$[x][1];if(0!==s[v][E])for(;;){let S=!1;for(;v<s.length&&E<s.length&&0!==s[v][E];){if((E<s.length-1&&s[v][E]>s[v][E+1]||E===s.length-1&&s[v][E]>0)&&(0===u[x]||2===u[x]&&(v<s.length-1&&s[v][E]>s[v+1][E]||v===s.length-1&&s[v][E]>0))){S=!0;break}v++,E++}if(!S)break;let z=v,M=E,k=[[z,M,s[z][M]-1]];for(;;){let R=M-z;if(z<s.length-1&&s[z][M]===s[z+1][M]&&(0===u[R]||3===u[R]))z++;else if(M>l[z]&&(z===s.length-1||z<s.length-1&&s[z][M]>s[z+1][M]))M--;else break;k.push([z,M,s[z][M]-1])}k.forEach(t=>s[t[0]][t[1]]--),b.push(k)}}let O=Array(s.length);for(let Q=0;Q<s.length;Q++){O[Q]=Array(s.length);for(let T=0;T<s.length;T++)O[Q][T]=s[Q][T]===1/0?1/0:0}let I=await this.add_new_array(t+1,O);await new Promise((t,e)=>setTimeout(t,this.animation_time));for(let L=0;L<b.length;L++){await this.color_cubes(a,b[L],L/b.length*6/7),await this.raise_cubes(a,b[L],a.height+1),b[L].forEach(t=>{a.numbers[t[0]][t[1]]--,this.in_2d_view&&this.draw_single_cell_2d_view_text(a,t[0],t[1])}),this.recalculate_heights(a),await new Promise((t,e)=>setTimeout(t,this.animation_time/5));let P=b[L][b[L].length-1][0],F=$[b[L][b[L].length-1][1]-P+b[L].length-1][1],C=[],A=Math.max(a.height+1,I.height+1);for(let H=r[F];H<=P;H++)C.push([H,F,A]);for(let B=F-1;B>=l[P];B--)C.push([P,B,A]);await this.move_cubes(a,b[L],I,C),C=[];for(let U=P-1;U>=r[F];U--)C.push([U,F,A]);this.delete_cubes(I,C),C=[];for(let j=F-1;j>=l[P];j--)C.push([P,j,A]);this.delete_cubes(I,C),await this.lower_cubes(I,[[P,F,A]]),I.numbers[P][F]++,this.in_2d_view&&this.draw_single_cell_2d_view_text(I,P,F),this.recalculate_heights(I),await new Promise((t,e)=>setTimeout(t,this.animation_time))}await this.remove_array(t),e()})}sulzgruber_inverse(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=a.numbers,r=Array(s.length);for(let n=0;n<s.length;n++){let h=0;for(;h<s.length&&s[h][n]===1/0;)h++;r[n]=h}let l=Array(s.length);for(let o=0;o<s.length;o++){let c=0;for(;c<s.length&&s[o][c]===1/0;)c++;l[o]=c}let u={};for(let $=0;$<s.length;$++)u[-$]=[$,0];for(let d=1;d<s.length;d++)u[d]=[0,d];for(let f=-s.length+1;f<s.length;f++){let w=u[f][0],m=u[f][1];for(;w<s.length&&m<s.length&&s[w][m]===1/0;)w++,m++;u[f]=[w,m]}let g=0,p=Array(s.length);for(let y=0;y<s.length;y++){p[y]=Array(s.length);for(let b=0;b<s.length;b++)s[y][b]===1/0?p[y][b]=1/0:(p[y][b]=0,g+=s[y][b])}let x=await this.add_new_array(t+1,p);x.numbers;let v=0;for(let E=s.length-1;E>=0;E--)for(let S=s.length-1;S>=0;S--)if(s[S][E]!==1/0)for(;0!==s[S][E];){let z=v/g*6/7,M=Math.max(a.size+1,x.size+1);await this.color_cubes(a,[[S,E,s[S][E]-1]],z),await this.raise_cubes(a,[[S,E,s[S][E]-1]],M);let k=S,R=E;for(let O=r[R];O<k;O++)a.cubes[O][R][M]=this.add_cube(a,R,M,O),a.cubes[O][R][M].material.forEach(t=>t.color.setHSL(z,1,this.cube_lightness));for(let Q=l[k];Q<R;Q++)a.cubes[k][Q][M]=this.add_cube(a,Q,M,k),a.cubes[k][Q][M].material.forEach(t=>t.color.setHSL(z,1,this.cube_lightness));let T=[];for(let I=k-1;I>=r[R];I--)T.push([I,R,M]);let L=this.reveal_cubes(a,T);T=[];for(let P=R-1;P>=l[k];P--)T.push([k,P,M]);await Promise.all([L,this.reveal_cubes(a,T)]),T=[];for(let F=l[k];F<R;F++)T.push([k,F,M]);T.push([k,R,a.numbers[k][R]-1]);for(let C=k-1;C>=r[R];C--)T.push([C,R,M]);let A=l[k]-k,H=A+T.length-1,B=[];for(let U=A;U<=H;U++)B.push(_.clone(u[U]));s[k][R]--,this.recalculate_heights(a),this.in_2d_view&&this.draw_single_cell_2d_view_text(a,k,R),await this.move_cubes(a,T,x,B);let j=0,N=x.numbers[B[0][0]][B[0][1]];for(;;){let D=j;for(;D<B.length&&B[D][0]===B[j][0];)D++;T=B.slice(j,D);let G=!0;for(let W=0;W<T.length;W++)if(x.numbers[T[W][0]][T[W][1]]!==N){G=!1;break}if(G)await this.lower_cubes(x,T),T.forEach(t=>x.numbers[t[0]][t[1]]++),this.recalculate_heights(x),this.in_2d_view&&T.forEach(t=>{this.draw_single_cell_2d_view_text(x,t[0],t[1])}),j=D;else{let q=_.cloneDeep(B.slice(j));for(let Y=j;Y<B.length;Y++)if(B[Y][0]++,B[Y][1]++,B[Y][0]>x.footprint||B[Y][1]>x.footprint){console.error("Insertion failed!");return}await this.move_cubes(x,q,x,B.slice(j)),N=x.numbers[B[j][0]][B[j][1]]}if(j===B.length)break}v++,await new Promise((t,e)=>setTimeout(t,this.animation_time/2))}await this.remove_array(t),e()})}rsk(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=this.arrays[t+1],r=a.numbers,n=s.numbers,h=0,l=0;for(let o=0;o<r.length;o++)for(let c=0;c<r.length;c++){if(r[o][c]===1/0||n[o][c]===1/0){this.display_error("The SSYT contain infinite values, which is not allowed in RSK!"),this.currently_running_algorithm=!1,e();return}0!==r[o][c]&&l++,h=Math.max(Math.max(h,r[o][c]),n[o][c])}if(0===h){display_error("The SSYT are empty!"),currently_running_algorithm=!1,e();return}let u=Array(h);for(let $=0;$<h;$++){u[$]=Array(h);for(let d=0;d<h;d++)u[$][d]=0}let f=await this.add_new_array(t+2,u),w=0;for(;0!==n[0][0];){let m=w/l*6/7,g=0,p=0,y=0;for(let b=0;b<n.length;b++){let x=n.length-1;for(;x>=0&&0===n[b][x];)x--;x>=0&&(g=Math.max(g,n[b][x]))}for(let v=0;v<n.length;v++){let E=n.length-1;for(;E>=0&&0===n[v][E];)E--;if(n[v][E]===g){p=v,y=E;break}}let S=[],z=[],M=[],k=[],R=[],O=[],Q=p,T=y,I=r[Q][T],L=n[Q][T],P=[[Q,T]];for(;0!==Q;){let F=r.length-1;for(;0===r[Q-1][F]||I<=r[Q-1][F];)F--;for(let C=0;C<I;C++)S.push([Q,T,C]),z.push([Q-1,F,C]);Q--,T=F,I=r[Q][T],P.push([Q,T])}let A=f.height+1;for(let H=0;H<I;H++)M.push([Q,T,H]),k.push([L-1,H,A]);for(let B=0;B<L-1;B++)R.push([p,y,B]),O.push([B,I-1,A]);this.color_cubes(s,R.concat([[p,y,L-1]]),m),this.color_cubes(a,S,m),await this.color_cubes(a,M,m),n[p][y]=0;for(let U=P.length-1;U>0;U--)r[P[U][0]][P[U][1]]=r[P[U-1][0]][P[U-1][1]];if(r[p][y]=0,this.in_2d_view){this.draw_single_cell_2d_view_text(a,p,y);for(let j=P.length-1;j>0;j--)this.draw_single_cell_2d_view_text(a,P[j][0],P[j][1]);this.draw_single_cell_2d_view_text(s,p,y)}this.move_cubes(s,R,f,O),this.move_cubes(a,M,f,k),this.move_cubes(a,S,a,z),await this.move_cubes(s,[[p,y,L-1]],f,[[L-1,I-1,A]],!1),this.uncolor_cubes(a,z),f.cube_group.remove(s.cubes[p][y][L-1]),this.delete_cubes(s,[[p,y,L-1]],!0,!0),k.reverse(),O.reverse(),this.delete_cubes(f,k.slice(1)),this.delete_cubes(f,O),await this.lower_cubes(f,[[L-1,I-1,A]]),u[L-1][I-1]++,this.in_2d_view&&this.draw_single_cell_2d_view_text(f,L-1,I-1),this.recalculate_heights(f),w++,await new Promise((t,e)=>setTimeout(t,this.animation_time/2))}await this.remove_array(t),await new Promise((t,e)=>setTimeout(t,this.animation_time)),await this.remove_array(t),e()})}rsk_inverse(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=_.cloneDeep(a.numbers),r=0;s.forEach(t=>t.forEach(t=>r+=t));let n=Array(r),h=Array(r);for(let l=0;l<r;l++){n[l]=Array(r),h[l]=Array(r);for(let o=0;o<r;o++)n[l][o]=0,h[l][o]=0}let c=Array(s.length);for(let u=0;u<s.length;u++)c[u]=0;let $=0,d=[],f=[],w=[];for(let m=0;m<s.length;m++)for(let g=0;g<s.length;g++)for(;0!==s[m][g];){s[m][g]--;let p=g+1,y=0,b=0,x=[];for(;;){for(b=c[y];0!==b&&n[y][b-1]>p;)b--;if(b===c[y]){n[y][b]=p,c[y]++,0===b&&$++,x.push([y,b]);break}let v=n[y][b];n[y][b]=p,p=v,x.push([y,b]),y++}d.push(x),f.push([y,b]),w.push([m,g]),h[y][b]=m+1}let E=Math.max(c[0],$);n=Array(E),h=Array(E);for(let S=0;S<E;S++){n[S]=Array(E),h[S]=Array(E);for(let z=0;z<E;z++)n[S][z]=0,h[S][z]=0}let M=await this.add_new_array(t+1,n);await new Promise((t,e)=>setTimeout(t,this.animation_time/2));let k=await this.add_new_array(t+2,h);await new Promise((t,e)=>setTimeout(t,this.animation_time/2));let R=0;for(let O=0;O<w.length;O++){let Q=w[O][0],T=w[O][1],I=a.height+1,L=R/r*6/7;for(let P=T;P>=0;P--)a.cubes[Q][P][I]=this.add_cube(a,P,I,Q),a.cubes[Q][P][I].material.forEach(t=>t.color.setHSL(L,1,this.cube_lightness));for(let F=Q-1;F>=0;F--)a.cubes[F][T][I]=this.add_cube(a,T,I,F),a.cubes[F][T][I].material.forEach(t=>t.color.setHSL(L,1,this.cube_lightness));a.cubes[Q][T][I+1]=this.add_cube(a,T,I,Q),a.cubes[Q][T][I+1].material.forEach(t=>t.color.setHSL(L,1,this.cube_lightness)),await this.color_cubes(a,[[Q,T,a.numbers[Q][T]-1]],L),await this.raise_cubes(a,[[Q,T,a.numbers[Q][T]-1]],I);let C=this.reveal_cubes(a,[[Q,T,I+1]]),A=[];for(let H=T-1;H>=0;H--)A.push([Q,H,I]);let B=this.reveal_cubes(a,A);A=[];for(let U=Q-1;U>=0;U--)A.push([U,T,I]);await Promise.all([C,B,this.reveal_cubes(a,A)]);let j=d[R],N=[],D=[],G=[[Q,T,a.numbers[Q][T]-1]],W=[[j[0][0],j[0][1],T]],q=[[Q,T,I+1]],Y=[[f[R][0],f[R][1],Q]];for(let K=T-1;K>=0;K--)G.push([Q,K,I]),W.push([j[0][0],j[0][1],K]);for(let J=0;J<j.length-1;J++)for(let V=0;V<n[j[J][0]][j[J][1]];V++)N.push([j[J][0],j[J][1],V]),D.push([j[J+1][0],j[J+1][1],V]);for(let X=Q-1;X>=0;X--)q.push([X,T,I]),Y.push([f[R][0],f[R][1],X]);await this.color_cubes(M,N,L);for(let Z=j.length-1;Z>0;Z--)n[j[Z][0]][j[Z][1]]=n[j[Z-1][0]][j[Z-1][1]];0!==j.length&&(n[j[0][0]][j[0][1]]=0),this.in_2d_view&&this.draw_all_2d_view_text(),0!==N.length&&await this.move_cubes(M,N,M,D),a.numbers[Q][T]--,this.in_2d_view&&this.draw_all_2d_view_text(),this.move_cubes(a,G,M,W),await this.move_cubes(a,q,k,Y),n[j[0][0]][j[0][1]]=T+1,h[f[R][0]][f[R][1]]=Q+1,this.in_2d_view&&this.draw_all_2d_view_text(),this.recalculate_heights(a),this.recalculate_heights(M),this.recalculate_heights(k),R++,await new Promise((t,e)=>setTimeout(t,this.animation_time/2))}await this.remove_array(t),e()})}godar_1(t){return new Promise(async(e,i)=>{let a=this.arrays[t],s=a.numbers,r=Array(2*s.length),n=Array(2*s.length);for(let h=0;h<s.length;h++){let l=0;for(;l<s.length&&s[h][l]===1/0;)l++;for(r[h]=l,l=0;l<s.length&&s[l][h]===1/0;)l++;n[h]=l}for(let o=s.length;o<2*s.length;o++)r[o]=0,n[o]=0;let c=Math.max(r[0],n[0]),u=Array(s.length);for(let $=0;$<s.length;$++){u[$]=Array(s.length);for(let d=0;d<s.length;d++)s[$][d]===1/0?u[$][d]=this.infinite_height:u[$][d]=s[$][d]}await this.add_new_array(t+1,u),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)),await this.remove_array(t),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)),s=(a=this.arrays[t]).numbers;let f=0,w=0;for(;f<s.length&&0!==s[f][s.length-1];)f++;for(;w<s.length&&0!==s[s.length-1][w];)w++;await this.run_algorithm("pak",t,!0),await new Promise((t,e)=>setTimeout(t,2*this.animation_time)),s=(a=this.arrays[t]).numbers;let m=Math.max(f,w),g=Array(s.length-m+1),p=[];for(let y=0;y<g.length-1;y++){g[y]=Array(g.length);for(let b=0;b<g.length-1;b++){g[y][b]=s[y][b];for(let x=0;x<s[y][b];x++)p.push([y,b,x]);s[y][b]=0}g[y][g.length-1]=0}g[g.length-1]=Array(g.length);for(let v=0;v<g.length;v++)g[g.length-1][v]=0;this.delete_cubes(a,p,!0,!0),await this.add_new_array(t,g),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)),await this.run_algorithm("pak_inverse",t,!0),await new Promise((t,e)=>setTimeout(t,2*this.animation_time));let E=2*s.length-r[s.length-1]-n[s.length-1],S=r[0]+n[0],z=Array(4*s.length),M=Array(S),k=Array(4*s.length);for(let R=0;R<4*s.length;R++)z[R]=[];for(let O=0;O<S;O++)M[O]=[];for(let Q=0;Q<4*s.length;Q++)k[Q]=[];let T=1;for(let I=0;I<2*s.length;I++)for(let L=0;L<2*s.length;L++)L>=r[I]?z[I+L+1-r[I]-n[L]].push([I,L]):M[r[I]+n[L]-I-L-1].unshift([c-I-1,c-L-1]),k[I+L+1].push([I,L]);let P=Array(2*s.length);for(let F=0;F<2*s.length;F++)P[F]=Array(2*s.length);for(let C=1;C<E;C++){let A=[];for(let H=0;H<z[C].length;H++){let B=z[C][H][0],U=z[C][H][1];if(B<s.length-w&&U<s.length-f)for(let j=0;j<this.arrays[t].numbers[B][U];j++)A.push([B,U,j]);H<k[C].length?(P[B][U]=[1,k[C][H]],B<s.length&&U<s.length&&this.arrays[t].numbers[B][U]>0&&(T=Math.max(Math.max(T,k[C][H][0]+1),k[C][H][1]+1))):P[B][U]=[0,M[C][H-k[C].length]]}0!==A.length&&this.color_cubes(this.arrays[t],A,(C-1)/(E-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animation_time));let N=Array(c);for(let D=0;D<c;D++){N[D]=Array(c);for(let G=0;G<c;G++)G<c-r[c-D-1]?N[D][G]=1/0:N[D][G]=0}let W=null;c>0&&(W=await this.add_new_array(t+1,N),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)));let q=Array(T);for(let Y=0;Y<T;Y++){q[Y]=Array(T);for(let K=0;K<T;K++)q[Y][K]=0}let J=await this.add_new_array(t+2,q);for(let V=0;V<s.length-w;V++)for(let X=r[V];X<s.length-f;X++)if(this.arrays[t].numbers[V][X]>0){let Z=[],tt=[],te=P[V][X][1][0],ti=P[V][X][1][1];for(let ta=0;ta<this.arrays[t].numbers[V][X];ta++)Z.push([V,X,ta]),tt.push([te,ti,ta]);0===P[V][X][0]?(await this.move_cubes(this.arrays[t],Z,W,tt),N[te][ti]=this.arrays[t].numbers[V][X],this.arrays[t].numbers[V][X]=0):(await this.move_cubes(this.arrays[t],Z,J,tt),q[te][ti]=this.arrays[t].numbers[V][X],this.arrays[t].numbers[V][X]=0),this.in_2d_view&&this.draw_all_2d_view_text()}await new Promise((t,e)=>setTimeout(t,3*this.animation_time)),await this.run_algorithm("pak_inverse",t,!0),c>0&&await this.run_algorithm("hillman_grassl_inverse",t+1,!0),this.resolve()})}godar_1_inverse(t){return new Promise(async(e,i)=>{let a=this.arrays[t+1].numbers,s=this.arrays[t].numbers,r=Array(a.length+2*s.length),n=Array(a.length+2*s.length);for(let h=0;h<a.length+2*s.length;h++)r[h]=0,n[h]=0;for(let l=0;l<s.length;l++){let o=s.length-1;for(;o>=0&&s[l][o]!==1/0;)o--;for(r[s.length-l-1]=s.length-o-1,o=s.length-1;o>=0&&s[o][l]!==1/0;)o--;n[s.length-l-1]=s.length-o-1}await this.run_algorithm("pak",t,!0),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)),await this.run_algorithm("pak",t+1,!0),await new Promise((t,e)=>setTimeout(t,3*this.animation_time));let c=[],u=this.arrays[t].numbers;for(let $=0;$<u.length;$++)for(let d=0;d<u.length;d++)if(u[$][d]!==1/0)for(let f=0;f<u[$][d];f++)c.push([$,d,f]);this.uncolor_cubes(this.arrays[t],c),c=[],u=this.arrays[t+1].numbers;for(let w=0;w<u.length;w++)for(let m=0;m<u.length;m++)if(u[w][m]!==1/0)for(let g=0;g<u[w][m];g++)c.push([w,m,g]);await this.uncolor_cubes(arrays[t+1],c);let p=Math.max(r[0],n[0])+2*a.length-1,y=2*p,b=r[0]+n[0],x=2*a.length,v=Array(y),E=Array(b),S=Array(x);for(let z=0;z<y;z++)v[z]=[];for(let M=0;M<b;M++)E[M]=[];for(let k=0;k<x;k++){S[k]=Array(k);for(let R=0;R<k;R++)S[k][R]=-1}for(;r.length<p;)r.push(0);for(;n.length<p;)n.push(0);for(let O=0;O<p;O++)for(let Q=0;Q<p;Q++)Q>=r[O]?v[O+Q+1-r[O]-n[Q]].push([O,Q]):E[r[O]+n[Q]-O-Q-1].unshift([s.length-O-1,s.length-Q-1]),O<a.length&&Q<a.length&&(S[O+Q+1][O]=[O,Q]);let T=Array(a.length);for(let I=0;I<a.length;I++)T[I]=Array(a.length);let L=Array(s.length);for(let P=0;P<s.length;P++)L[P]=Array(s.length);p=1;for(let F=1;F<b;F++){let C=[];for(let A=0;A<E[F].length;A++){let H=E[F][A][0],B=E[F][A][1];for(let U=0;U<arrays[t].numbers[H][B];U++)C.push([H,B,U]);L[H][B]=v[F][A+S[F].length],0!==this.arrays[t].numbers[H][B]&&(p=Math.max(Math.max(p,L[H][B][0]+1),L[H][B][1]+1))}0!==C.length&&this.color_cubes(this.arrays[t],C,(F-1)/(b-1)*6/7)}for(let j=1;j<x;j++){let N=[];for(let D=0;D<S[j].length;D++){if(-1===S[j][D])continue;let G=S[j][D][0],W=S[j][D][1];for(let q=0;q<arrays[t+1].numbers[G][W];q++)N.push([G,W,q]);T[G][W]=v[j][D],0!==this.arrays[t+1].numbers[G][W]&&(p=Math.max(Math.max(p,T[G][W][0]+1),T[G][W][1]+1))}0!==N.length&&this.color_cubes(this.arrays[t+1],N,(j-1)/(x-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animation_time));let Y=Array(p);for(let K=0;K<p;K++){Y[K]=Array(p);for(let J=0;J<p;J++)J<r[K]?Y[K][J]=1/0:Y[K][J]=0}let V=await this.add_new_array(t+2,Y);await new Promise((t,e)=>setTimeout(t,this.animation_time/2));for(let X=0;X<s.length;X++)for(let Z=0;Z<s.length;Z++)if(arrays[t].numbers[X][Z]>0&&this.arrays[t].numbers[X][Z]!==1/0){let tt=[],te=[],ti=L[X][Z][0],ta=L[X][Z][1];for(let ts=0;ts<this.arrays[t].numbers[X][Z];ts++)tt.push([X,Z,ts]),te.push([ti,ta,ts]);await this.move_cubes(this.arrays[t],tt,V,te),Y[ti][ta]=this.arrays[t].numbers[X][Z],this.arrays[t].numbers[X][Z]=0,this.in_2d_view&&this.draw_all_2d_view_text()}for(let tr=0;tr<a.length;tr++)for(let tn=0;tn<a.length;tn++)if(this.arrays[t+1].numbers[tr][tn]>0&&arrays[t+1].numbers[tr][tn]!==1/0){let th=[],tl=[],to=T[tr][tn][0],t8=T[tr][tn][1];for(let tc=0;tc<this.arrays[t+1].numbers[tr][tn];tc++)th.push([tr,tn,tc]),tl.push([to,t8,tc]);await this.move_cubes(this.arrays[t+1],th,V,tl),Y[to][t8]=this.arrays[t+1].numbers[tr][tn],this.arrays[t+1].numbers[tr][tn]=0,this.in_2d_view&&this.draw_all_2d_view_text()}await this.remove_array(t),await new Promise((t,e)=>setTimeout(t,this.animation_time/2)),await this.remove_array(t),await new Promise((t,e)=>setTimeout(t,3*this.animation_time)),await this.run_algorithm("pak_inverse",t,!0),await new Promise((t,e)=>setTimeout(t,this.animation_time)),e()})}draw_boundary(t,e){return new Promise(async(i,a)=>{this.in_2d_view||await this.show_2d_view(),"0"!==this.wilson_numbers.canvas.style.opacity&&await Page.Animate.change_opacity(this.wilson_numbers.canvas,0,this.animation_time/3),this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height);let s=this.arrays[t],r=s.numbers,n=[],h=0,l=0;for(let o=s.footprint-1;o>=0;o--){for(;l<s.footprint&&r[o][l]===1/0;){if(o===s.footprint-1||r[o+1][l]!==1/0){let c=h%e/e,u=this.wilson.utils.hsv_to_rgb(c,1,1);n.push([o,l,!0,`rgba(${u[0]}, ${u[1]}, ${u[2]}, `]),h++}l++}let $=h%e/e,d=this.wilson.utils.hsv_to_rgb($,1,1);n.push([o,l,!1,`rgba(${d[0]}, ${d[1]}, ${d[2]}, `]),h++}for(;l<s.footprint;){if(-1==s.footprint-1||r[0][l]!==1/0){let f=h%e/e,w=this.wilson.utils.hsv_to_rgb(f,1,1);n.push([-1,l,!0,`rgba(${w[0]}, ${w[1]}, ${w[2]}, `]),h++}l++}n.forEach(t=>{this.draw_boundary_rect(s,t[0],t[1],t[2],`${t[3]} 1)`)}),await Page.Animate.change_opacity(this.wilson_numbers.canvas,1,this.animation_time/3),this.wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",i(n)})}draw_n_quotient(t,e,i,a){return new Promise(async(s,r)=>{let n=this.arrays[t],h={t:1};await new Promise((t,s)=>{anime({targets:h,t:0,duration:this.animation_time,easing:"easeOutQuad",complete:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,a)=>{this.draw_boundary_rect(n,t[0],t[1],t[2],`${t[3]} ${a%e===i?1:0})`)}),t()},update:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,a)=>{let s=a%e===i?1:h.t;this.draw_boundary_rect(n,t[0],t[1],t[2],`${t[3]} ${s})`)})}})});let l=(a=a.filter((t,a)=>a%e===i)).filter(t=>!t[2]).length,o=Array(a.length),c=l-1,u=0;a.forEach((t,e)=>{o[e]=[c,u],t[2]?u++:c--}),h.t=0,await new Promise((t,e)=>{anime({targets:h,t:1,duration:this.animation_time,easing:"easeInOutQuad",complete:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,e)=>{this.draw_boundary_rect(n,o[e][0],o[e][1],t[2],`${t[3]} 1)`)}),t()},update:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,e)=>{this.draw_boundary_rect(n,(1-h.t)*t[0]+h.t*o[e][0],(1-h.t)*t[1]+h.t*o[e][1],t[2],`${t[3]} 1)`)})}})});let $=[];o.forEach((t,e)=>{if(!a[e][2]){for(let i=t[1];i<n.footprint;i++)if(n.numbers[t[0]][i]===1/0)for(let s=0;s<this.infinite_height;s++)$.push([t[0],i,s])}}),this.delete_cubes(n,$,!0);let d=[];for(let f=n.footprint-1;f>o[0][0];f--)d.push([f,0,!1]);for(let w=o[o.length-1][1];w<n.footprint;w++)d.push([-1,w,!0]);h.t=0,await new Promise((t,e)=>{anime({targets:h,t:1,duration:this.animation_time/2,easing:"easeInQuad",complete:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,e)=>{this.draw_boundary_rect(n,o[e][0],o[e][1],t[2],`${t[3]} 1)`)}),d.forEach((t,e)=>{this.draw_boundary_rect(n,t[0],t[1],t[2],`${a[0][3]} 1)`)}),t()},update:()=>{this.wilson_numbers.ctx.clearRect(0,0,this.wilson_numbers.canvas_width,this.wilson_numbers.canvas_height),a.forEach((t,e)=>{this.draw_boundary_rect(n,o[e][0],o[e][1],t[2],`${t[3]} 1)`)}),d.forEach((t,e)=>{this.draw_boundary_rect(n,t[0],t[1],t[2],`${a[0][3]} ${h.t})`)})}})}),this.wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",s()})}draw_boundary_rect(t,e,i,a,s){let r=(this.total_array_footprint-t.footprint-1)/2,n=t.partial_footprint_sum-t.footprint;this.wilson_numbers.ctx.fillStyle=s,a?this.wilson_numbers.ctx.fillRect(this.wilson_numbers.canvas_width*(i+n+1)/(this.total_array_footprint+1),this.wilson_numbers.canvas_height*(e+r+1+15/16)/(this.total_array_footprint+1)+1,this.wilson_numbers.canvas_width/(this.total_array_footprint+1),this.wilson_numbers.canvas_height*(1/16)/(this.total_array_footprint+1)):this.wilson_numbers.ctx.fillRect(this.wilson_numbers.canvas_width*(i+n+15/16)/(this.total_array_footprint+1),this.wilson_numbers.canvas_height*(e+r+1)/(this.total_array_footprint+1)+1,this.wilson_numbers.canvas_width*(1/16)/(this.total_array_footprint+1),this.wilson_numbers.canvas_height/(this.total_array_footprint+1))}}