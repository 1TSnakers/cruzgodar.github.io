!async function(){"use strict";Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then((()=>{Site.scripts_loaded.lodash=!0})).catch((e=>{console.error("Could not load Lodash")}));let e=2e3,t=600;const a=.4,r=100,n={hillman_grassl:{method:function(e){return new Promise((async(a,r)=>{let n=J[e],o=_.cloneDeep(n.numbers),l=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;l[e]=t}let i=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;i[e]=t}let s=[];for(;;){let e=o[0].length-1;for(;e>=0&&l[e]<o.length&&0===o[l[e]][e];)e--;if(e<0||l[e]===o.length)break;let t=l[e],a=e,r=[[t,a,o[t][a]-1]];for(;;){if(t<o.length-1&&o[t+1][a]===o[t][a])t++;else{if(!(a>0&&o[t][a-1]!==1/0))break;a--}r.push([t,a,o[t][a]-1])}for(let e=0;e<r.length;e++)o[r[e][0]][r[e][1]]--;s.push(r)}let c=new Array(o.length);for(let e=0;e<o.length;e++){c[e]=new Array(o.length);for(let t=0;t<o.length;t++)c[e][t]=o[e][t]===1/0?1/0:0}let u=await pe(e+1,c);await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<s.length;e++){let a=e/s.length*6/7;await Pe(n,s[e],a),await Te(n,s[e],n.height);let r=X-n.partial_footprint_sum-1,o=n.partial_footprint_sum-n.footprint;for(let t=0;t<s[e].length;t++)n.numbers[s[e][t][0]][s[e][t][1]]--,N&&ve(n,s[e][t][0],s[e][t][1],r,o);xe(n),await new Promise(((e,a)=>setTimeout(e,t/5)));let c=[s[e][s[e].length-1][0],s[e][0][1]],h=[],f=u.height+1;for(let e=l[c[1]];e<=c[0];e++)h.push([e,c[1],f]);let p=h[h.length-1];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);await Re(n,s[e],u,h),h=[];for(let e=c[0]-1;e>=l[c[1]];e--)h.push([e,c[1],f]);ke(u,h),h=[];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);ke(u,h),await Me(u,[p]),r=X-u.partial_footprint_sum-1,o=u.partial_footprint_sum-u.footprint,u.numbers[p[0]][p[1]]++,xe(u),N&&ve(u,p[0],p[1],r,o),u.height=Math.max(u.height,u.numbers[p[0]][p[1]]),u.size=Math.max(u.size,u.height),await new Promise(((e,a)=>setTimeout(e,t)))}await me(e),a()}))},input_type:["pp"]},hillman_grassl_inverse:{method:function(e){return new Promise((async(r,n)=>{let o=J[e],l=_.cloneDeep(o.numbers),i=[],s=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;s[e]=t}let c=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;c[e]=t}let u=new Array(l.length);for(let e=0;e<l.length;e++){u[e]=new Array(l.length);for(let t=0;t<l.length;t++)u[e][t]=l[e][t]===1/0?1/0:0}let h=_.cloneDeep(u),f=await pe(e+1,u);for(let e=0;e<l.length;e++)for(let t=l.length-1;t>=s[e];t--)for(;0!==l[t][e];){let a=[],r=t,n=c[t];for(;r>=0;){let t=n;if(0!==r)for(;h[r][t]!==h[r-1][t]&&t<e;)t++;else t=e;for(let e=n;e<=t;e++)a.push([r,e,h[r][e]]);if(!(r-1>=s[t]))break;r--,n=t}for(let e=0;e<a.length;e++)h[a[e][0]][a[e][1]]++;i.push([a,[t,e,l[t][e]-1]]),l[t][e]--}await new Promise(((e,a)=>setTimeout(e,t/2)));for(let e=0;e<i.length;e++){let r=e/i.length*6/7;await Pe(o,[i[e][1]],r);let n=i[e][1][0],l=i[e][1][1],u=o.size;for(let e=s[l];e<n;e++)o.cubes[e][l][u]=ge(o,l,u,e),o.cubes[e][l][u].material.forEach((e=>e.color.setHSL(r,1,a)));for(let e=c[n];e<l;e++)o.cubes[n][e][u]=ge(o,e,u,n),o.cubes[n][e][u].material.forEach((e=>e.color.setHSL(r,1,a)));await Te(o,[i[e][1]],u);let h=[];for(let e=n-1;e>=s[l];e--)h.push([e,l,u]);let p=Ae(o,h);h=[];for(let e=l-1;e>=c[n];e--)h.push([n,e,u]);let m=Ae(o,h);await Promise.all([p,m]),h=[];for(let e=c[n];e<l;e++)h.push([n,e,u]);h.push([n,l,o.numbers[n][l]-1]);for(let e=n-1;e>=s[l];e--)h.push([e,l,u]);let g=i[e][0],d=f.height+1;if(g.forEach((e=>e[2]=d)),o.numbers[n][l]--,xe(o),N){ve(o,n,l,X-o.partial_footprint_sum-1,o.partial_footprint_sum-o.footprint)}if(await Re(o,h,f,g),await Me(f,g),g.forEach((e=>{f.numbers[e[0]][e[1]]++})),xe(f),N){let e=X-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;g.forEach((a=>{ve(f,a[0],a[1],e,t)}))}await new Promise(((e,a)=>setTimeout(e,t/2)))}await me(e),r()}))},input_type:["tableau"]},pak:{method:function(e){return new Promise((async(a,r)=>{let n=J[e],o=n.numbers;N||await ye();let l=n.footprint*n.footprint,i=0;for(let e=0;e<n.footprint;e++)for(let a=0;a<n.footprint;a++){if(o[e][a]===1/0){let r=n.cubes[e][a].map(((t,r)=>[e,a,r]));await ke(n,r,!0),Le(n,[[e,a]]),n.cubes[e][a]=[],await new Promise(((e,a)=>setTimeout(e,t)));continue}let r=[],s=0;for(;e+s<n.footprint&&a+s<n.footprint;)r.push([e+s,a+s,o[e+s][a+s]-1]),s++;s=r[0][0];let c=r[0][1],u=[];for(let e=o[s][c]-2;e>=0;e--)u.push([s,c,e]);Pe(n,u,i/l*6/7),u=[],r.forEach((e=>{e[2]>=0&&u.push(e)})),await Pe(n,u,i/l*6/7);let h=new Array(r.length);r.forEach(((e,t)=>{let a=e[0],r=e[1],l=0,i=0;a<n.footprint-1&&(l=o[a+1][r]),r<n.footprint-1&&(i=o[a][r+1]),h[t]=Math.max(l,i),t>0?(l=o[a-1][r],i=o[a][r-1],h[t]+=Math.min(l,i)-o[a][r]):h[t]=o[a][r]-h[t]}));for(let e=0;e<r.length;e++){if(s=r[e][0],c=r[e][1],h[e]>o[s][c]){let t=[];for(let a=o[s][c];a<h[e];a++)n.cubes[s][c][a]=ge(n,c,a,s),t.push([s,c,a]);N?Ae(n,t):await Ae(n,t)}else if(h[e]<o[s][c]){let t=[];for(let a=o[s][c]-1;a>=h[e];a--)t.push([s,c,a]);N?ke(n,t):await ke(n,t)}if(o[s][c]=h[e],N){let e=X-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;ve(n,s,c,e,t)}}let f=[];u.forEach(((e,t)=>{0!==t&&e[2]<o[e[0]][e[1]]&&f.push(e)})),N?Se(n,f):await Se(n,f),i++,xe(n),0!==u.length&&await new Promise(((e,a)=>setTimeout(e,t)))}be(!0),a()}))},input_type:["pp"]},pak_inverse:{method:function(e){return new Promise((async(n,o)=>{let l=J[e],i=l.numbers;N||await ye();let s=l.footprint*l.footprint,c=0;for(let e=l.footprint-1;e>=0;e--)for(let n=l.footprint-1;n>=0;n--){if(i[e][n]===1/0){l.cubes[e][n]=new Array(r);let a=[];for(let t=0;t<r;t++)l.cubes[e][n][t]=ge(l,n,t,e,0,0,.6),l.cubes[e][n][t].material.forEach((e=>a.push(e)));l.floor[e][n]=de(l,n,e),l.floor[e][n].material.forEach((e=>a.push(e))),await new Promise(((e,r)=>{anime({targets:a,opacity:1,duration:t,easing:"easeOutQuad",complete:e})})),await new Promise(((e,a)=>setTimeout(e,t)));continue}let o=[],u=0;for(;e+u<l.footprint&&n+u<l.footprint;)o.push([e+u,n+u,i[e+u][n+u]-1]),u++;u=o[0][0];let h=o[0][1],f=new Array(o.length),p=!1;if(o.forEach(((e,t)=>{let a=e[0],r=e[1],n=0,o=0;a<l.footprint-1&&(n=i[a+1][r]),r<l.footprint-1&&(o=i[a][r+1]),f[t]=Math.max(n,o),t>0?(n=i[a-1][r],o=i[a][r-1],f[t]+=Math.min(n,o)-i[a][r]):f[t]+=i[a][r],p||f[t]===i[a][r]||(p=!0)})),0!==i[u][h]){let e=[];for(let t=i[u][h]-1;t>=0;t--)e.push([u,h,t]);Pe(l,e,c/s*6/7)}else if(0!==f[0])l.cubes[u][h][0]=ge(l,h,0,u,c/s*6/7,1,a),i[u][h]=1,Ae(l,[[u,h,0]]);else if(!p){c++;continue}await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<o.length;e++){if(u=o[e][0],h=o[e][1],f[e]>i[u][h]){let t=[];for(let r=i[u][h];r<f[e];r++)l.cubes[u][h][r]=ge(l,h,r,u,c/s*6/7,1,a),t.push([u,h,r]);N?Ae(l,t):await Ae(l,t)}else if(f[e]<i[u][h]){let t=[];for(let a=i[u][h]-1;a>=f[e];a--)t.push([u,h,a]);N?ke(l,t):await ke(l,t)}if(i[u][h]=f[e],N){let e=X-l.partial_footprint_sum-1,t=l.partial_footprint_sum-l.footprint;ve(l,u,h,e,t)}}c++,xe(l),await new Promise(((e,a)=>setTimeout(e,t)))}be(!0),n()}))},input_type:["tableau"]},sulzgruber:{method:function(e){return new Promise((async(a,r)=>{let n=J[e],o=_.cloneDeep(n.numbers),l=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;l[e]=t}let i=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;i[e]=t}let s={},c={};for(let e=0;e<o.length;e++)c[-e]=[e,0];for(let e=1;e<o.length;e++)c[e]=[0,e];for(let e=1-o.length;e<o.length;e++){let t=c[e][0],a=c[e][1];for(;t<o.length&&a<o.length&&o[t][a]===1/0;)t++,a++;if(c[e]=[t,a],t===o.length||a===o.length){s[e]=-1;continue}let r=0===a||o[t][a-1]===1/0,n=0===t||o[t-1][a]===1/0;s[e]=r&&n?0:r?3:n?2:1}let u=[];for(let e=1-o.length;e<o.length;e++){if(1===s[e]||3===s[e])continue;let t=c[e][0],a=c[e][1];if(0!==o[t][a])for(;;){let r=!1;for(;t<o.length&&a<o.length&&0!==o[t][a];){if((a<o.length-1&&o[t][a]>o[t][a+1]||a===o.length-1&&o[t][a]>0)&&(0===s[e]||2===s[e]&&(t<o.length-1&&o[t][a]>o[t+1][a]||t===o.length-1&&o[t][a]>0))){r=!0;break}t++,a++}if(!r)break;let n=t,l=a,c=[[n,l,o[n][l]-1]];for(;;){let e=l-n;if(n<o.length-1&&o[n][l]===o[n+1][l]&&(0===s[e]||3===s[e]))n++;else{if(!(l>i[n]&&(n===o.length-1||n<o.length-1&&o[n][l]>o[n+1][l])))break;l--}c.push([n,l,o[n][l]-1])}c.forEach((e=>o[e[0]][e[1]]--)),u.push(c)}}let h=new Array(o.length);for(let e=0;e<o.length;e++){h[e]=new Array(o.length);for(let t=0;t<o.length;t++)h[e][t]=o[e][t]===1/0?1/0:0}let f=await pe(e+1,h);await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<u.length;e++){let a=e/u.length*6/7;await Pe(n,u[e],a),await Te(n,u[e],n.height+1);let r=X-n.partial_footprint_sum-1,o=n.partial_footprint_sum-n.footprint;u[e].forEach((e=>{n.numbers[e[0]][e[1]]--,N&&ve(n,e[0],e[1],r,o)})),xe(n),await new Promise(((e,a)=>setTimeout(e,t/5)));let s=u[e][u[e].length-1][0],h=c[u[e][u[e].length-1][1]-s+u[e].length-1][1],p=[],m=Math.max(n.height+1,f.height+1);for(let e=l[h];e<=s;e++)p.push([e,h,m]);for(let e=h-1;e>=i[s];e--)p.push([s,e,m]);await Re(n,u[e],f,p),p=[];for(let e=s-1;e>=l[h];e--)p.push([e,h,m]);ke(f,p),p=[];for(let e=h-1;e>=i[s];e--)p.push([s,e,m]);ke(f,p),await Me(f,[[s,h,m]]),r=X-f.partial_footprint_sum-1,o=f.partial_footprint_sum-f.footprint,f.numbers[s][h]++,N&&ve(f,s,h,r,o),xe(f),await new Promise(((e,a)=>setTimeout(e,t)))}await me(e),a()}))},input_type:["pp"]},sulzgruber_inverse:{method:function(e){return new Promise((async(r,n)=>{let o=J[e],l=o.numbers,i=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;i[e]=t}let s=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;s[e]=t}let c={};for(let e=0;e<l.length;e++)c[-e]=[e,0];for(let e=1;e<l.length;e++)c[e]=[0,e];for(let e=1-l.length;e<l.length;e++){let t=c[e][0],a=c[e][1];for(;t<l.length&&a<l.length&&l[t][a]===1/0;)t++,a++;c[e]=[t,a]}let u=0,h=new Array(l.length);for(let e=0;e<l.length;e++){h[e]=new Array(l.length);for(let t=0;t<l.length;t++)l[e][t]===1/0?h[e][t]=1/0:(h[e][t]=0,u+=l[e][t])}let f=await pe(e+1,h),p=(f.numbers,0);for(let e=l.length-1;e>=0;e--)for(let r=l.length-1;r>=0;r--)if(l[r][e]!==1/0)for(;0!==l[r][e];){let n=p/u*6/7,h=Math.max(o.size+1,f.size+1);await Pe(o,[[r,e,l[r][e]-1]],n),await Te(o,[[r,e,l[r][e]-1]],h);let m=r,g=e;for(let e=i[g];e<m;e++)o.cubes[e][g][h]=ge(o,g,h,e),o.cubes[e][g][h].material.forEach((e=>e.color.setHSL(n,1,a)));for(let e=s[m];e<g;e++)o.cubes[m][e][h]=ge(o,e,h,m),o.cubes[m][e][h].material.forEach((e=>e.color.setHSL(n,1,a)));let d=[];for(let e=m-1;e>=i[g];e--)d.push([e,g,h]);let w=Ae(o,d);d=[];for(let e=g-1;e>=s[m];e--)d.push([m,e,h]);let y=Ae(o,d);await Promise.all([w,y]),d=[];for(let e=s[m];e<g;e++)d.push([m,e,h]);d.push([m,g,o.numbers[m][g]-1]);for(let e=m-1;e>=i[g];e--)d.push([e,g,h]);let b=s[m]-m,x=b+d.length-1,E=[];for(let e=b;e<=x;e++)E.push(_.clone(c[e]));if(l[m][g]--,xe(o),N){ve(o,m,g,X-o.partial_footprint_sum-1,o.partial_footprint_sum-o.footprint)}await Re(o,d,f,E);let v=0,P=f.numbers[E[0][0]][E[0][1]];for(;;){let e=v;for(;e<E.length&&E[e][0]===E[v][0];)e++;d=E.slice(v,e);let t=!0;for(let e=0;e<d.length;e++)if(f.numbers[d[e][0]][d[e][1]]!==P){t=!1;break}if(t){if(await Me(f,d),d.forEach((e=>f.numbers[e[0]][e[1]]++)),xe(f),N){let e=X-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;d.forEach((a=>{ve(f,a[0],a[1],e,t)}))}v=e}else{let e=_.cloneDeep(E.slice(v));for(let e=v;e<E.length;e++)if(E[e][0]++,E[e][1]++,E[e][0]>f.footprint||E[e][1]>f.footprint)return void console.error("Insertion failed!");let t=E.slice(v);await Re(f,e,f,t),P=f.numbers[E[v][0]][E[v][1]]}if(v===E.length)break}p++,await new Promise(((e,a)=>setTimeout(e,t/2)))}await me(e),r()}))},input_type:["tableau"]},rsk:{method:function(e){return new Promise((async(a,r)=>{let n=J[e],o=J[e+1],l=n.numbers,i=o.numbers,s=0,c=0;for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++){if(l[e][t]===1/0||i[e][t]===1/0)return fe("The SSYT contain infinite values, which is not allowed in RSK!"),V=!1,void r();0!==l[e][t]&&c++,s=Math.max(Math.max(s,l[e][t]),i[e][t])}if(0===s)return fe("The SSYT are empty!"),V=!1,void r();let u=new Array(s);for(let e=0;e<s;e++){u[e]=new Array(s);for(let t=0;t<s;t++)u[e][t]=0}let h=await pe(e+2,u),f=0;for(;0!==i[0][0];){let e=f/c*6/7,a=0,r=0,s=0;for(let e=0;e<i.length;e++){let t=i.length-1;for(;t>=0&&0===i[e][t];)t--;t>=0&&(a=Math.max(a,i[e][t]))}for(let e=0;e<i.length;e++){let t=i.length-1;for(;t>=0&&0===i[e][t];)t--;if(i[e][t]===a){r=e,s=t;break}}let p=[],m=[],g=[],d=[],w=[],y=[],b=r,_=s,x=l[b][_],E=i[b][_],v=[[b,_]];for(;0!==b;){let e=l.length-1;for(;0===l[b-1][e]||x<=l[b-1][e];)e--;for(let t=0;t<x;t++)p.push([b,_,t]),m.push([b-1,e,t]);b--,_=e,x=l[b][_],v.push([b,_])}let P=h.height+1;for(let e=0;e<x;e++)g.push([b,_,e]),d.push([E-1,e,P]);for(let e=0;e<E-1;e++)w.push([r,s,e]),y.push([e,x-1,P]);Pe(o,w.concat([[r,s,E-1]]),e),Pe(n,p,e),await Pe(n,g,e),i[r][s]=0;for(let e=v.length-1;e>0;e--)l[v[e][0]][v[e][1]]=l[v[e-1][0]][v[e-1][1]];if(l[r][s]=0,N){let e=X-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;ve(n,r,s,e,t);for(let a=v.length-1;a>0;a--)ve(n,v[a][0],v[a][1],e,t);e=X-o.partial_footprint_sum-1,t=o.partial_footprint_sum-o.footprint,ve(o,r,s,e,t)}if(Re(o,w,h,y),Re(n,g,h,d),Re(n,p,n,m),await Re(o,[[r,s,E-1]],h,[[E-1,x-1,P]],!1),Se(n,m),h.cube_group.remove(o.cubes[r][s][E-1]),ke(o,[[r,s,E-1]],!0,!0),d.reverse(),y.reverse(),ke(h,d.slice(1)),ke(h,y),await Me(h,[[E-1,x-1,P]]),u[E-1][x-1]++,N){ve(h,E-1,x-1,X-h.partial_footprint_sum-1,h.partial_footprint_sum-h.footprint)}xe(h),f++,await new Promise(((e,a)=>setTimeout(e,t/2)))}await me(e),await new Promise(((e,a)=>setTimeout(e,t))),await me(e),a()}))},input_type:["ssyt","ssyt"],same_shape:!0},rsk_inverse:{method:function(e){return new Promise((async(r,n)=>{let o=J[e],l=_.cloneDeep(o.numbers),i=0;l.forEach((e=>e.forEach((e=>i+=e))));let s=new Array(i),c=new Array(i);for(let e=0;e<i;e++){s[e]=new Array(i),c[e]=new Array(i);for(let t=0;t<i;t++)s[e][t]=0,c[e][t]=0}let u=new Array(l.length);for(let e=0;e<l.length;e++)u[e]=0;let h=0,f=[],p=[],m=[];for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++)for(;0!==l[e][t];){l[e][t]--;let a=t+1,r=0,n=0,o=[];for(;;){for(n=u[r];0!==n&&s[r][n-1]>a;)n--;if(n===u[r]){s[r][n]=a,u[r]++,0===n&&h++,o.push([r,n]);break}let e=s[r][n];s[r][n]=a,a=e,o.push([r,n]),r++}f.push(o),p.push([r,n]),m.push([e,t]),c[r][n]=e+1}let g=Math.max(u[0],h);s=new Array(g),c=new Array(g);for(let e=0;e<g;e++){s[e]=new Array(g),c[e]=new Array(g);for(let t=0;t<g;t++)s[e][t]=0,c[e][t]=0}let d=await pe(e+1,s);await new Promise(((e,a)=>setTimeout(e,t/2)));let w=await pe(e+2,c);await new Promise(((e,a)=>setTimeout(e,t/2)));let y=0;for(let e=0;e<m.length;e++){let r=m[e][0],n=m[e][1],l=o.height+1,u=y/i*6/7;for(let e=n;e>=0;e--)o.cubes[r][e][l]=ge(o,e,l,r),o.cubes[r][e][l].material.forEach((e=>e.color.setHSL(u,1,a)));for(let e=r-1;e>=0;e--)o.cubes[e][n][l]=ge(o,n,l,e),o.cubes[e][n][l].material.forEach((e=>e.color.setHSL(u,1,a)));o.cubes[r][n][l+1]=ge(o,n,l,r),o.cubes[r][n][l+1].material.forEach((e=>e.color.setHSL(u,1,a))),await Pe(o,[[r,n,o.numbers[r][n]-1]],u),await Te(o,[[r,n,o.numbers[r][n]-1]],l);let h=Ae(o,[[r,n,l+1]]),g=[];for(let e=n-1;e>=0;e--)g.push([r,e,l]);let b=Ae(o,g);g=[];for(let e=r-1;e>=0;e--)g.push([e,n,l]);let _=Ae(o,g);await Promise.all([h,b,_]);let x=f[y],E=[],v=[],P=[[r,n,o.numbers[r][n]-1]],S=[[x[0][0],x[0][1],n]],T=[[r,n,l+1]],M=[[p[y][0],p[y][1],r]];for(let e=n-1;e>=0;e--)P.push([r,e,l]),S.push([x[0][0],x[0][1],e]);for(let e=0;e<x.length-1;e++)for(let t=0;t<s[x[e][0]][x[e][1]];t++)E.push([x[e][0],x[e][1],t]),v.push([x[e+1][0],x[e+1][1],t]);for(let e=r-1;e>=0;e--)T.push([e,n,l]),M.push([p[y][0],p[y][1],e]);await Pe(d,E,u);for(let e=x.length-1;e>0;e--)s[x[e][0]][x[e][1]]=s[x[e-1][0]][x[e-1][1]];0!==x.length&&(s[x[0][0]][x[0][1]]=0),N&&Ee(),0!==E.length&&await Re(d,E,d,v),o.numbers[r][n]--,N&&Ee(),Re(o,P,d,S),await Re(o,T,w,M),s[x[0][0]][x[0][1]]=n+1,c[p[y][0]][p[y][1]]=r+1,N&&Ee(),xe(o),xe(d),xe(w),y++,await new Promise(((e,a)=>setTimeout(e,t/2)))}await me(e),r()}))},input_type:["tableau"]}};let o={renderer:"cpu",canvas_width:e,canvas_height:e,mousedown_callback:ne,touchstart_callback:ne,mousedrag_callback:oe,touchmove_callback:oe,mouseup_callback:le,touchend_callback:le},l=new Wilson(Page.element.querySelector("#numbers-canvas"),o);l.ctx.fillStyle="rgb(255, 255, 255)",Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important");let i={canvas_width:e,canvas_height:e},s=new Wilson(Page.element.querySelector("#output-canvas"),i),c=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});c.ctx.strokeStyle="rgb(255, 255, 255)",c.ctx._alpha=1,c.ctx.fillStyle="rgba(64, 64, 64, 1)",c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle="rgba(128, 128, 128, 1)",c.ctx.fillRect(4,4,56,56),c.ctx.lineWidth=6;let u=new Wilson(Page.element.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});u.ctx.strokeStyle="rgb(255, 255, 255)",u.ctx._alpha=1,u.ctx.fillStyle="rgba(64, 64, 64, 1)",u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle="rgba(128, 128, 128, 1)",u.ctx.fillRect(4,4,56,56),u.ctx.lineWidth=6;let h=new Wilson(Page.element.querySelector("#hidden-canvas-3"),{renderer:"cpu",canvas_width:64,canvas_height:64});h.ctx.strokeStyle="rgb(255, 255, 255)",h.ctx._alpha=1,h.ctx.fillStyle="rgba(32, 32, 32, 1)",h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle="rgba(64, 64, 64, 1)",h.ctx.fillRect(4,4,56,56),h.ctx.lineWidth=6;let f=new Wilson(Page.element.querySelector("#hidden-canvas-4"),{renderer:"cpu",canvas_width:64,canvas_height:64});f.ctx.strokeStyle="rgb(255, 255, 255)",f.ctx._alpha=1,f.ctx.fillStyle="rgb(32, 32, 32)",f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle="rgb(64, 64, 64)",f.ctx.fillRect(4,4,56,56),f.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then((()=>{Site.scripts_loaded.three=!0})).catch((e=>{console.error("Could not load THREE.js")}));let p=Page.element.querySelector("#numbers-canvas-container");const m={"view-controls":Page.element.querySelectorAll(".view-controls-section"),"add-array":Page.element.querySelectorAll(".add-array-section"),"edit-array":Page.element.querySelectorAll(".edit-array-section"),"remove-array":Page.element.querySelectorAll(".remove-array-section"),algorithms:Page.element.querySelectorAll(".algorithms-section"),examples:Page.element.querySelectorAll(".examples-section")},g=Page.element.querySelector("#category-holder"),d=Page.element.querySelector("#canvas-landscape-left");let w="view-controls";["view-controls","add-array","edit-array","remove-array","algorithms"].forEach((e=>{e!==w&&m[e].forEach((e=>{e.style.opacity=0}))})),m[w].forEach((e=>d.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let y=Page.element.querySelector("#category-selector-dropdown");y.addEventListener("input",(async()=>{if(await Promise.all(Array.from(m[w]).map((e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time)))),m[w].forEach((e=>g.appendChild(e))),m[w].forEach((e=>e.classList.remove("move-to-left"))),m[w].forEach((e=>e.classList.remove("move-to-right"))),w=y.value,m[w].forEach((e=>d.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===w){let e=parseInt(T.value||0);e<J.length&&e>=0&&(S.value=ce(J[e].numbers))}m[w].forEach((e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time)))}));let b=Page.element.querySelector("#resolution-input");b.addEventListener("input",(()=>{e=parseInt(b.value||2e3),H.setSize(e,e,!1)}));let x=Page.element.querySelector("#show-dimers-button");x.addEventListener("click",(()=>{C?_e():new Promise((async(e,a)=>{if(Y)return void a();C=!0,Page.Animate.change_opacity(x,0,Site.opacity_animation_time).then((()=>{x.textContent="Hide Dimers",Page.Animate.change_opacity(x,1,Site.opacity_animation_time)})),G||await we(),Y=!0;let r=[];J.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),r.forEach((e=>e.opacity=0)),await new Promise(((e,a)=>{anime({targets:[c.ctx,u.ctx,h.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(42.7,21.3),c.ctx.lineTo(21.3,42.7),c.ctx.stroke(),q.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(128, 128, 128, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(21.3,21.3),u.ctx.lineTo(42.7,42.7),u.ctx.stroke(),z.needsUpdate=!0,h.ctx.clearRect(0,0,64,64),h.ctx.fillStyle=`rgba(32, 32, 32, ${h.ctx._alpha})`,h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle=`rgba(64, 64, 64, ${h.ctx._alpha})`,h.ctx.fillRect(4,4,56,56),h.ctx.moveTo(42.7,21.3),h.ctx.lineTo(21.3,42.7),h.ctx.stroke(),$.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),O.needsUpdate=!0}})})),Y=!1,e()}))}));let E=Page.element.querySelector("#switch-view-button");E.addEventListener("click",(()=>{N?we():ye()}));let v=Page.element.querySelector("#maximum-speed-checkbox");v.addEventListener("input",(()=>{t=v.checked?60:600}));let P=Page.element.querySelector("#array-data-textarea");P.value=ie(),Page.element.querySelector("#add-array-button").addEventListener("click",(()=>{pe(J.length,se(P.value))}));let S=Page.element.querySelector("#edit-array-textarea"),T=Page.element.querySelector("#edit-array-index-input");T.addEventListener("input",(()=>{let e=parseInt(T.value||0);e>=J.length||e<0||(S.value=ce(J[e].numbers))})),Page.element.querySelector("#edit-array-button").addEventListener("click",(function(){return new Promise((async(e,t)=>{let a=parseInt(T.value);if(a>=J.length||a<0)return void fe(`No array at index ${a}`);J[a];let r=se(S.value);await me(a),await pe(a,r),N||be(),e()}))}));let M=Page.element.querySelector("#remove-array-index-input");Page.element.querySelector("#remove-array-button").addEventListener("click",(()=>{me(parseInt(M.value))}));let R=Page.element.querySelector("#algorithm-index-input");Page.element.querySelector("#hillman-grassl-button").addEventListener("click",(()=>qe("hillman_grassl"))),Page.element.querySelector("#hillman-grassl-inverse-button").addEventListener("click",(()=>qe("hillman_grassl_inverse"))),Page.element.querySelector("#pak-button").addEventListener("click",(()=>qe("pak"))),Page.element.querySelector("#pak-inverse-button").addEventListener("click",(()=>qe("pak_inverse"))),Page.element.querySelector("#sulzgruber-button").addEventListener("click",(()=>qe("sulzgruber"))),Page.element.querySelector("#sulzgruber-inverse-button").addEventListener("click",(()=>qe("sulzgruber_inverse"))),Page.element.querySelector("#rsk-button").addEventListener("click",(()=>qe("rsk"))),Page.element.querySelector("#rsk-inverse-button").addEventListener("click",(()=>qe("rsk_inverse"))),Page.element.querySelector("#example-1-button").addEventListener("click",(()=>{He(1)})),Page.element.querySelector("#example-2-button").addEventListener("click",(()=>{He(2)})),Page.element.querySelector("#example-3-button").addEventListener("click",(()=>{He(3)}));let A=!1;Page.element.querySelector("#download-button").addEventListener("click",(()=>{A=!0}));const k=new THREE.Scene,L=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),H=new THREE.WebGLRenderer({canvas:s.canvas,antialias:!0});H.setSize(e,e,!1);new THREE.TextureLoader;const q=new THREE.CanvasTexture(c.canvas);q.minFilter=THREE.LinearFilter,q.magFilter=THREE.NearestFilter;const z=new THREE.CanvasTexture(u.canvas);z.minFilter=THREE.LinearFilter,z.magFilter=THREE.NearestFilter;const $=new THREE.CanvasTexture(h.canvas);$.minFilter=THREE.LinearFilter,$.magFilter=THREE.NearestFilter;const O=new THREE.CanvasTexture(f.canvas);O.minFilter=THREE.LinearFilter,O.magFilter=THREE.NearestFilter;const Q=new THREE.BoxGeometry;let C=!1;const I=new THREE.BoxGeometry(1,.001,1),F=(new THREE.BoxGeometry(.001,1,1),new THREE.BoxGeometry(1,1,.001),new THREE.AmbientLight(16777215,.2));k.add(F);const B=new THREE.PointLight(16777215,3,1e4);B.position.set(750,1e3,500),k.add(B);let D=0,W=0,U=0,j=[];let N=!1,G=!0,Y=!1,V=!1,K=10,J=[],X=0,Z=0,ee=0,te=[15,15,15],ae=[0,20,0],re=se(P.value);function ne(e,t,a){G=!1,W=0,j=[0,0,0,0]}function oe(e,t,a,r,n){N||(D+=a,D>3.14159265?D-=6.283185301:D<-3.14159265&&(D+=6.283185301),k.children.forEach((e=>e.rotation.y=D)),U=a)}function le(e,t,a){if(!N){let e=0;if(j.forEach(((t,a)=>{Math.abs(t)>W&&(W=Math.abs(t),e=a)})),W<.005)return void(W=0);W=j[e]}j=[0,0,0,0]}function ie(){let e=Math.floor(3*Math.random())+4,t=Math.floor(5*Math.random())+10,a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);a[0][0]=t;for(let t=1;t<e;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++){a[t][0]=Math.max(a[t-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<e;r++)a[t][r]=Math.max(Math.min(a[t][r-1],a[t-1][r])-Math.floor(4*Math.random()),0)}let r="";for(let t=0;t<e;t++){for(let n=0;n<e;n++){let e=a[t][n];r+=0===e?"   ":e<10?` ${e} `:`${e} `}t!==e-1&&(r+="\n")}return r}function se(e){let t=e.split("\n"),a=t.length,r=new Array(t.length);for(let e=0;e<r.length;e++){r[e]=t[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let n=r[0].length,o=Math.max(a,n),l=new Array(o);for(let e=0;e<a;e++){l[e]=new Array(o);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?l[e][t]=1/0:l[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<o;t++)l[e][t]=0}for(let e=a;e<o;e++){l[e]=new Array(o);for(let t=0;t<o;t++)l[e][t]=0}return l}function ce(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let a="";for(let r=0;r<e.length;r++){for(let n=0;n<e.length;n++)if(e[r][n]===1/0){for(let e=0;e<t-1-(0===n);e++)a+=" ";a+="^"}else{let o=`${e[r][n]}`.length;for(let e=0;e<t-o-(0===n);e++)a+=" ";a+=e[r][n]}r!==e.length-1&&(a+="\n")}return a}function ue(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return!1;return!0}function he(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(0!==e[t+1][a]&&e[t][a]>=e[t+1][a]||0!==e[t][a+1]&&e[t][a]>e[t][a+1])return!1;return!0}function fe(e){Page.Footer.Floating.show_settings_text(e)}function pe(e,a){return new Promise((async(n,o)=>{let l={numbers:a,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};N&&await Page.Animate.change_opacity(p,0,t/5),J.splice(e,0,l),l.footprint=l.numbers.length;for(let a=e;a<J.length;a++)J[a].partial_footprint_sum=J[a].footprint,0!==a?(J[a].center_offset=J[a-1].center_offset+J[a-1].footprint/2+J[a].footprint/2+1,J[a].partial_footprint_sum+=J[a-1].partial_footprint_sum+1):J[a].center_offset=0,a!==e&&anime({targets:J[a].cube_group.position,x:J[a].center_offset,y:0,z:-J[a].center_offset,duration:t,easing:"easeInOutQuad"});l.cube_group=new THREE.Object3D,k.add(l.cube_group),l.cube_group.position.set(l.center_offset,0,-l.center_offset),l.cube_group.rotation.y=D,l.cubes=new Array(l.footprint),l.floor=new Array(l.footprint);for(let e=0;e<l.footprint;e++){l.cubes[e]=new Array(l.footprint),l.floor[e]=new Array(l.footprint);for(let t=0;t<l.footprint;t++)if(l.numbers[e][t]!==1/0){l.cubes[e][t]=new Array(l.numbers[e][t]),l.numbers[e][t]>l.height&&(l.height=l.numbers[e][t]),l.floor[e][t]=de(l,t,e);for(let a=0;a<l.numbers[e][t];a++)l.cubes[e][t][a]=ge(l,t,a,e)}else{l.cubes[e][t]=new Array(r),l.floor[e][t]=de(l,t,e);for(let a=0;a<r;a++)l.cubes[e][t][a]=ge(l,t,a,e,0,0,.6)}}l.size=Math.max(l.footprint,l.height),X+=l.footprint+1,Z=Math.max(Z,l.height),ee=Math.max(X,Z),1===J.length?(te=[ee,ee+Z/3,ee],ae=[0,ee+10,0],N?be(!0):(L.left=-ee,L.right=ee,L.top=ee,L.bottom=-ee,L.position.set(te[0],te[1],te[2]),L.rotation.set(-.785398163,.615479709,.523598775),L.updateProjectionMatrix())):be(!0),e!==J.length-1&&await new Promise(((e,a)=>setTimeout(e,t)));let i=[];l.cube_group.traverse((e=>{e.material&&e.material.forEach((e=>i.push(e)))})),await new Promise((async(e,a)=>{anime({targets:i,opacity:1,duration:t/2,easing:"easeOutQuad",complete:e})})),N&&Ee(),n(l)}))}function me(e){return new Promise((async(a,r)=>{if(e>=J.length||e<0)fe(`No array at index ${e}`);else{N&&await Page.Animate.change_opacity(p,0,t/5),await new Promise(((a,r)=>{let n=[];J[e].cube_group.traverse((e=>{e.material&&e.material.forEach((e=>n.push(e)))})),anime({targets:n,opacity:0,duration:t/2,easing:"easeOutQuad",complete:a})}));for(let t=0;t<J[e].cubes.length;t++)for(let a=0;a<J[e].cubes[t].length;a++)if(J[e].cubes[t][a])for(let r=0;r<J[e].cubes[t][a].length;r++)J[e].cubes[t][a][r]&&J[e].cubes[t][a][r].material.forEach((e=>e.dispose()));k.remove(J[e].cube_group),X-=J[e].footprint+1,J.splice(e,1);for(let a=e;a<J.length;a++)J[a].partial_footprint_sum=J[a].footprint,0!==a?(J[a].center_offset=J[a-1].center_offset+J[a-1].footprint/2+J[a].footprint/2+1,J[a].partial_footprint_sum+=J[a-1].partial_footprint_sum+1):J[a].center_offset=0,anime({targets:J[a].cube_group.position,x:J[a].center_offset,y:0,z:-J[a].center_offset,duration:t,easing:"easeInOutQuad"});0!==J.length&&be(!0),a()}}))}function ge(e,t,a,r,n=0,o=0,l=.4){const i=[new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:z,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:z,transparent:!0,opacity:0})];i.forEach((e=>e.color.setHSL(n,o,l)));const s=new THREE.Mesh(Q,i);return e.cube_group.add(s),s.position.set(t-(e.footprint-1)/2,a,r-(e.footprint-1)/2),s}function de(e,t,a,r=0,n=0,o=.4){const l=[new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:O,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:O,transparent:!0,opacity:0})];l.forEach((e=>e.color.setHSL(r,n,o)));const i=new THREE.Mesh(I,l);return e.cube_group.add(i),i.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),i}function we(){return new Promise((async(e,a)=>{Y?a():(Page.Animate.change_opacity(E,0,Site.opacity_animation_time).then((()=>{E.textContent="Show 2D View",Page.Animate.change_opacity(E,1,Site.opacity_animation_time)})),Y=!0,N&&await Page.Animate.change_opacity(p,0,t/5),N=!1,G=!0,W=0,j=[0,0,0,0],be(!0),anime({targets:L.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:t,easing:"easeInOutQuad",complete:()=>{Y=!1,e()}}),J.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),D=0)}))}function ye(){return new Promise((async(e,a)=>{Y||N?a():(Page.Animate.change_opacity(E,0,Site.opacity_animation_time).then((()=>{E.textContent="Show 3D View",Page.Animate.change_opacity(E,1,Site.opacity_animation_time)})),C&&await _e(),Y=!0,N=!0,G=!1,W=0,j=[0,0,0,0],be(!0),anime({targets:L.rotation,x:-1.570796327,y:0,z:0,duration:t,easing:"easeInOutQuad"}),J.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),setTimeout((()=>{Ee(),Page.Animate.change_opacity(p,1,t/5).then((()=>{Y=!1,D=0,e()}))}),t))}))}function be(e=!1){if(!e){if(Y)return;Y=!0}Z=0;for(let e=0;e<J.length;e++)Z=Math.max(Z,J[e].height);ee=Math.max(X,Z);let a=(-J[0].footprint/2+J[J.length-1].center_offset+J[J.length-1].footprint/2)/2;te=[ee+a,ee+Z/3,ee-a],ae=[a,ee+10,-a],N?(anime({targets:L.position,x:ae[0],y:ae[1],z:ae[2],duration:t,easing:"easeInOutQuad"}),anime({targets:L,left:-(X/2+.5),right:X/2+.5,top:X/2+.5,bottom:-(X/2+.5),duration:t,easing:"easeInOutQuad",update:()=>L.updateProjectionMatrix(),complete:()=>Y=!1}),setTimeout((()=>{Ee(),Page.Animate.change_opacity(p,1,t/5)}),t)):(anime({targets:L.position,x:te[0],y:te[1],z:te[2],duration:t,easing:"easeInOutQuad"}),anime({targets:L,left:-ee,right:ee,top:ee,bottom:-ee,duration:t,easing:"easeInOutQuad",update:()=>L.updateProjectionMatrix(),complete:()=>Y=!1}))}function _e(){return new Promise((async(e,a)=>{if(Y)return void a();C=!1,Page.Animate.change_opacity(x,0,Site.opacity_animation_time).then((()=>{x.textContent="Show Dimers",Page.Animate.change_opacity(x,1,Site.opacity_animation_time)})),Y=!0;let r=[];J.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),await new Promise(((e,a)=>{anime({targets:[c.ctx,u.ctx,h.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(42.7,21.3),c.ctx.lineTo(21.3,42.7),c.ctx.stroke(),q.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(128, 128, 128, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(21.3,21.3),u.ctx.lineTo(42.7,42.7),u.ctx.stroke(),z.needsUpdate=!0,h.ctx.clearRect(0,0,64,64),h.ctx.fillStyle=`rgba(32, 32, 32, ${h.ctx._alpha})`,h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle=`rgba(64, 64, 64, ${h.ctx._alpha})`,h.ctx.fillRect(4,4,56,56),h.ctx.moveTo(42.7,21.3),h.ctx.lineTo(21.3,42.7),h.ctx.stroke(),$.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),O.needsUpdate=!0}})})),r.forEach((e=>e.opacity=1)),Y=!1,e()}))}function xe(e){e.height=0,e.numbers.forEach((t=>{t.forEach((t=>{t!==1/0&&(e.height=Math.max(t,e.height))}))})),e.size=Math.max(e.footprint,e.height);let t=Z;Z=0,J.forEach((e=>Z=Math.max(e.height,Z))),ee=Math.max(X,Z),Z!==t&&be()}function Ee(){K=l.canvas_width/(X+1);let e=Math.max(`${Z}`.length,2);l.ctx.font=K/e+"px monospace",l.ctx.clearRect(0,0,l.canvas_width,l.canvas_height),J.forEach((e=>{let t=X-e.partial_footprint_sum-1,a=e.partial_footprint_sum-e.footprint;for(let r=0;r<e.footprint;r++)for(let n=0;n<e.footprint;n++)ve(e,r,n,t,a)}))}function ve(e,t,a,r,n){if(l.ctx.clearRect(K*(a+n+1),K*(t+r+1),K,K),e.numbers[t][a]!==1/0){let o=l.ctx.measureText(e.numbers[t][a]);l.ctx.fillText(e.numbers[t][a],K*(a+n+1)+(K-o.width)/2,K*(t+r+1)+(K+o.actualBoundingBoxAscent-o.actualBoundingBoxDescent)/2)}}function Pe(e,r,n){return new Promise(((o,l)=>{if(0===r.length)return void o();let i=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e.color)))})),i.forEach((e=>e.getRGB(e)));let c=a+1*Math.min(a,.6),u=0===c?0:2*(1-a/c),h=i.map((e=>s.utils.hsv_to_rgb(n,u,c)));anime({targets:i,r:(e,t)=>h[t][0]/255,g:(e,t)=>h[t][1]/255,b:(e,t)=>h[t][2]/255,duration:t,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",update:()=>i.forEach((e=>e.setRGB(e.r,e.g,e.b))),complete:o})}))}function Se(e,r){return new Promise(((n,o)=>{let l=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>l.push(e.color)))})),l.forEach((e=>e.getHSL(e))),anime({targets:l,s:0,duration:t,easing:"easeOutQuad",update:()=>l.forEach((e=>e.setHSL(e.h,e.s,a))),complete:n})}))}function Te(e,a,r){return new Promise(((n,o)=>{let l=N?0:t,i=[];a.forEach((t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")})),anime({targets:i,y:r,duration:l,easing:"easeInOutQuad",complete:n})}))}function Me(e,a){return new Promise(((r,n)=>{let o=N?0:t,l=[];a.forEach((t=>{l.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")})),anime({targets:l,y:(t,r)=>e.numbers[a[r][0]][a[r][1]],duration:o,easing:"easeInOutQuad",complete:()=>{a.forEach((t=>{e.cubes[t[0]][t[1]][e.numbers[t[0]][t[1]]]=e.cubes[t[0]][t[1]][t[2]],e.cubes[t[0]][t[1]][t[2]]=null})),r()}})}))}function Re(e,a,r,n,o=!0){return new Promise(((l,i)=>{let s=[];a.forEach((t=>{s.push(e.cubes[t[0]][t[1]][t[2]].position),r.cube_group.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")})),anime({targets:s,x:(e,t)=>n[t][1]-(r.footprint-1)/2,y:(e,t)=>n[t][2],z:(e,t)=>n[t][0]-(r.footprint-1)/2,duration:t,easing:"easeInOutQuad",complete:()=>{if(o){let t=a.map((t=>e.cubes[t[0]][t[1]][t[2]]));a.forEach((t=>e.cubes[t[0]][t[1]][t[2]]=null)),n.forEach(((e,n)=>{r.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[e[0]][e[1]][e[2]]&&!a.some((t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]))&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),r.cubes[e[0]][e[1]][e[2]]=t[n]}))}l()}})}))}function Ae(e,a){return new Promise(((r,n)=>{if(0===a.length)return void r();let o=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>o.push(e))),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")})),anime({targets:o,opacity:1,duration:t/2,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:r})}))}function ke(e,a,r=!1,n=!1){return new Promise(((o,l)=>{let i=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e)))})),anime({targets:i,opacity:0,duration:t/2*!n,delay:(e,a)=>!r*Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:()=>{i.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null})),o()}})}))}function Le(e,a){return new Promise(((r,n)=>{let o=[];a.forEach((t=>{e.floor[t[0]][t[1]].material.forEach((e=>o.push(e)))})),anime({targets:o,opacity:0,duration:t/2,easing:"easeOutQuad",complete:()=>{o.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null})),r()}})}))}function He(e){return new Promise((async(a,r)=>{if(1===e||2===e){for(;J.length>1;)await me(1),await new Promise(((e,a)=>setTimeout(e,t/2)));if(0===J.length){let e=se(ie());await pe(J.length,e)}else if(!ue(J[0].numbers)){await me(0),await new Promise(((e,a)=>setTimeout(e,t/2)));let e=se(ie());await pe(J.length,e)}1===e?(await qe("hillman_grassl",0),await new Promise(((e,a)=>setTimeout(e,3*t))),await qe("hillman_grassl_inverse",0)):(await qe("pak",0),await new Promise(((e,a)=>setTimeout(e,3*t))),await we(),await new Promise(((e,a)=>setTimeout(e,t))),await qe("sulzgruber_inverse",0)),a()}else if(3===e){for(;J.length>0;)await me(0),await new Promise(((e,a)=>setTimeout(e,t/2)));await pe(J.length,function(){let e=Math.floor(3*Math.random())+4,t=new Array(e);for(let a=0;a<e;a++){t[a]=new Array(e);for(let r=0;r<e;r++)Math.random()<.75/e?t[a][r]=Math.floor(3*Math.random())+1:t[a][r]=0}return t}()),await ye(),await new Promise(((e,a)=>setTimeout(e,t))),await qe("rsk_inverse",0),await new Promise(((e,a)=>setTimeout(e,3*t))),await qe("rsk",0),a()}}))}function qe(e,t,a=!1){return new Promise((async(r,o)=>{if(void 0===t&&(t=parseInt(R.value||0)),!a&&V)return void o();V=!0;let l=n[e],i=l.input_type.length;if(t>J.length-1||t<0)return fe(`No array at index ${t}!`),V=!1,void o();if(i>1&&t>J.length-i)return fe(`No array at index ${t+i-1}! (This algorithm needs ${i} arrays)`),V=!1,void o();for(let e=0;e<i;e++){let a=l.input_type[e];if("pp"===a&&!ue(J[t+e].numbers))return fe(`Array at index ${t+e} is not a plane partition!`),V=!1,void o();if("ssyt"===a&&!he(J[t+e].numbers))return fe(`Array at index ${t+e} is not an SSYT!`),V=!1,void o()}if(i>1&&void 0!==l.same_shape&&l.same_shape){let e=new Array(i),a=0;for(let e=0;e<i;e++)a=Math.max(a,J[t+e].numbers.length);for(let r=0;r<i;r++){e[r]=new Array(a);for(let t=0;t<a;t++)e[r][t]=0;for(let a=0;a<J[t+r].numbers.length;a++){let n=0;for(;n<J[t+r].numbers[a].length&&0!==J[t+r].numbers[a][n];)n++;e[r][a]=n}}for(let t=1;t<i;t++)for(let r=0;r<a;r++)if(e[t][r]!==e[0][r])return fe("Arrays are not the same shape!"),V=!1,void o()}for(let e=0;e<i;e++){let a=[],r=J[t+e].numbers;for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let n=0;n<r[e][t];n++)a.push([e,t,n]);Se(J[t+e],a)}await l.method(t),a||(V=!1),r()}))}S.value=P.value,pe(J.length,re),function e(){H.render(k,L),j.push(U),j.shift(),U=0,0!==W&&(D+=W,k.children.forEach((e=>e.rotation.y=D)),W*=.94,Math.abs(W)<5e-4&&(W=0));D>3.14159265?D-=6.283185301:D<-3.14159265&&(D+=6.283185301);A&&(A=!1,s.canvas.toBlob((e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()})));window.requestAnimationFrame(e)}(),Page.show()}();