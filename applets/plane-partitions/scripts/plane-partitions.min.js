!async function(){"use strict";const e=!0;Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then((()=>{Site.scripts_loaded.lodash=!0})).catch((e=>{console.error("Could not load Lodash")}));let t=2e3,a=600;const r=.4,n=100,l={hillman_grassl:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e],l=_.cloneDeep(n.numbers),o=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;o[e]=t}let i=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;i[e]=t}let s=[];for(;;){let e=l[0].length-1;for(;e>=0&&o[e]<l.length&&0===l[o[e]][e];)e--;if(e<0||o[e]===l.length)break;let t=o[e],a=e,r=[[t,a,l[t][a]-1]];for(;;){if(t<l.length-1&&l[t+1][a]===l[t][a])t++;else{if(!(a>0&&l[t][a-1]!==1/0))break;a--}r.push([t,a,l[t][a]-1])}for(let e=0;e<r.length;e++)l[r[e][0]][r[e][1]]--;s.push(r)}let c=new Array(l.length);for(let e=0;e<l.length;e++){c[e]=new Array(l.length);for(let t=0;t<l.length;t++)c[e][t]=l[e][t]===1/0?1/0:0}let u=await ke(e+1,c);await new Promise(((e,t)=>setTimeout(e,a)));for(let e=0;e<s.length;e++){let t=e/s.length*6/7;await De(n,s[e],t),await je(n,s[e],n.height);let r=we-n.partial_footprint_sum-1,l=n.partial_footprint_sum-n.footprint;for(let t=0;t<s[e].length;t++)n.numbers[s[e][t][0]][s[e][t][1]]--,ue&&Be(n,s[e][t][0],s[e][t][1],r,l);Ie(n),await new Promise(((e,t)=>setTimeout(e,a/5)));let c=[s[e][s[e].length-1][0],s[e][0][1]],h=[],f=u.height+1;for(let e=o[c[1]];e<=c[0];e++)h.push([e,c[1],f]);let m=h[h.length-1];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);await Ne(n,s[e],u,h),h=[];for(let e=c[0]-1;e>=o[c[1]];e--)h.push([e,c[1],f]);Ye(u,h),h=[];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);Ye(u,h),await Ue(u,[m]),r=we-u.partial_footprint_sum-1,l=u.partial_footprint_sum-u.footprint,u.numbers[m[0]][m[1]]++,Ie(u),ue&&Be(u,m[0],m[1],r,l),u.height=Math.max(u.height,u.numbers[m[0]][m[1]]),u.size=Math.max(u.size,u.height),await new Promise(((e,t)=>setTimeout(e,a)))}await qe(e),t()}))},input_type:["pp"]},hillman_grassl_inverse:{method:function(e){return new Promise((async(t,n)=>{let l=ge[e],o=_.cloneDeep(l.numbers),i=[],s=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;s[e]=t}let c=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;c[e]=t}let u=new Array(o.length);for(let e=0;e<o.length;e++){u[e]=new Array(o.length);for(let t=0;t<o.length;t++)u[e][t]=o[e][t]===1/0?1/0:0}let h=_.cloneDeep(u),f=await ke(e+1,u);for(let e=0;e<o.length;e++)for(let t=o.length-1;t>=s[e];t--)for(;0!==o[t][e];){let a=[],r=t,n=c[t];for(;r>=0;){let t=n;if(0!==r)for(;h[r][t]!==h[r-1][t]&&t<e;)t++;else t=e;for(let e=n;e<=t;e++)a.push([r,e,h[r][e]]);if(!(r-1>=s[t]))break;r--,n=t}for(let e=0;e<a.length;e++)h[a[e][0]][a[e][1]]++;i.push([a,[t,e,o[t][e]-1]]),o[t][e]--}await new Promise(((e,t)=>setTimeout(e,a/2)));for(let e=0;e<i.length;e++){let t=e/i.length*6/7;await De(l,[i[e][1]],t);let n=i[e][1][0],o=i[e][1][1],u=l.size;for(let e=s[o];e<n;e++)l.cubes[e][o][u]=He(l,o,u,e),l.cubes[e][o][u].material.forEach((e=>e.color.setHSL(t,1,r)));for(let e=c[n];e<o;e++)l.cubes[n][e][u]=He(l,e,u,n),l.cubes[n][e][u].material.forEach((e=>e.color.setHSL(t,1,r)));await je(l,[i[e][1]],u);let h=[];for(let e=n-1;e>=s[o];e--)h.push([e,o,u]);let m=Ge(l,h);h=[];for(let e=o-1;e>=c[n];e--)h.push([n,e,u]);let p=Ge(l,h);await Promise.all([m,p]),h=[];for(let e=c[n];e<o;e++)h.push([n,e,u]);h.push([n,o,l.numbers[n][o]-1]);for(let e=n-1;e>=s[o];e--)h.push([e,o,u]);let g=i[e][0],w=f.height+1;if(g.forEach((e=>e[2]=w)),l.numbers[n][o]--,Ie(l),ue){Be(l,n,o,we-l.partial_footprint_sum-1,l.partial_footprint_sum-l.footprint)}if(await Ne(l,h,f,g),await Ue(f,g),g.forEach((e=>{f.numbers[e[0]][e[1]]++})),Ie(f),ue){let e=we-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;g.forEach((a=>{Be(f,a[0],a[1],e,t)}))}await new Promise(((e,t)=>setTimeout(e,a/2)))}await qe(e),t()}))},input_type:["tableau"]},pak:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e],l=n.numbers;ue||await Oe();let o=n.footprint*n.footprint,i=0;for(let e=0;e<n.footprint;e++)for(let t=0;t<n.footprint;t++){if(l[e][t]===1/0){let r=n.cubes[e][t].map(((a,r)=>[e,t,r]));await Ye(n,r,!0),Ve(n,[[e,t]]),n.cubes[e][t]=[],await new Promise(((e,t)=>setTimeout(e,a)));continue}let r=[],s=0;for(;e+s<n.footprint&&t+s<n.footprint;)r.push([e+s,t+s,l[e+s][t+s]-1]),s++;s=r[0][0];let c=r[0][1],u=[];for(let e=l[s][c]-2;e>=0;e--)u.push([s,c,e]);De(n,u,i/o*6/7),u=[],r.forEach((e=>{e[2]>=0&&u.push(e)})),await De(n,u,i/o*6/7);let h=new Array(r.length);r.forEach(((e,t)=>{let a=e[0],r=e[1],o=0,i=0;a<n.footprint-1&&(o=l[a+1][r]),r<n.footprint-1&&(i=l[a][r+1]),h[t]=Math.max(o,i),t>0?(o=l[a-1][r],i=l[a][r-1],h[t]+=Math.min(o,i)-l[a][r]):h[t]=l[a][r]-h[t]}));for(let e=0;e<r.length;e++){if(s=r[e][0],c=r[e][1],h[e]>l[s][c]){let t=[];for(let a=l[s][c];a<h[e];a++)n.cubes[s][c][a]=He(n,c,a,s),t.push([s,c,a]);ue?Ge(n,t):await Ge(n,t)}else if(h[e]<l[s][c]){let t=[];for(let a=l[s][c]-1;a>=h[e];a--)t.push([s,c,a]);ue?Ye(n,t):await Ye(n,t)}if(l[s][c]=h[e],ue){let e=we-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;Be(n,s,c,e,t)}}let f=[];u.forEach(((e,t)=>{0!==t&&e[2]<l[e[0]][e[1]]&&f.push(e)})),ue?We(n,f):await We(n,f),i++,Ie(n),0!==u.length&&await new Promise(((e,t)=>setTimeout(e,a)))}Qe(!0),t()}))},input_type:["pp"]},pak_inverse:{method:function(e){return new Promise((async(t,l)=>{let o=ge[e],i=o.numbers;ue||await Oe();let s=o.footprint*o.footprint,c=0;for(let e=o.footprint-1;e>=0;e--)for(let t=o.footprint-1;t>=0;t--){if(i[e][t]===1/0){o.cubes[e][t]=new Array(n);let r=[];for(let a=0;a<n;a++)o.cubes[e][t][a]=He(o,t,a,e,0,0,.6),o.cubes[e][t][a].material.forEach((e=>r.push(e)));o.floor[e][t]=ze(o,t,e),o.floor[e][t].material.forEach((e=>r.push(e))),await new Promise(((e,t)=>{anime({targets:r,opacity:1,duration:a,easing:"easeOutQuad",complete:e})})),await new Promise(((e,t)=>setTimeout(e,a)));continue}let l=[],u=0;for(;e+u<o.footprint&&t+u<o.footprint;)l.push([e+u,t+u,i[e+u][t+u]-1]),u++;u=l[0][0];let h=l[0][1],f=new Array(l.length),m=!1;if(l.forEach(((e,t)=>{let a=e[0],r=e[1],n=0,l=0;a<o.footprint-1&&(n=i[a+1][r]),r<o.footprint-1&&(l=i[a][r+1]),f[t]=Math.max(n,l),t>0?(n=i[a-1][r],l=i[a][r-1],f[t]+=Math.min(n,l)-i[a][r]):f[t]+=i[a][r],m||f[t]===i[a][r]||(m=!0)})),0!==i[u][h]){let e=[];for(let t=i[u][h]-1;t>=0;t--)e.push([u,h,t]);De(o,e,c/s*6/7)}else if(0!==f[0])o.cubes[u][h][0]=He(o,h,0,u,c/s*6/7,1,r),i[u][h]=1,Ge(o,[[u,h,0]]);else if(!m){c++;continue}await new Promise(((e,t)=>setTimeout(e,a)));for(let e=0;e<l.length;e++){if(u=l[e][0],h=l[e][1],f[e]>i[u][h]){let t=[];for(let a=i[u][h];a<f[e];a++)o.cubes[u][h][a]=He(o,h,a,u,c/s*6/7,1,r),t.push([u,h,a]);ue?Ge(o,t):await Ge(o,t)}else if(f[e]<i[u][h]){let t=[];for(let a=i[u][h]-1;a>=f[e];a--)t.push([u,h,a]);ue?Ye(o,t):await Ye(o,t)}if(i[u][h]=f[e],ue){let e=we-o.partial_footprint_sum-1,t=o.partial_footprint_sum-o.footprint;Be(o,u,h,e,t)}}c++,Ie(o),await new Promise(((e,t)=>setTimeout(e,a)))}Qe(!0),t()}))},input_type:["tableau"]},sulzgruber:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e],l=_.cloneDeep(n.numbers),o=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;o[e]=t}let i=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;i[e]=t}let s={},c={};for(let e=0;e<l.length;e++)c[-e]=[e,0];for(let e=1;e<l.length;e++)c[e]=[0,e];for(let e=1-l.length;e<l.length;e++){let t=c[e][0],a=c[e][1];for(;t<l.length&&a<l.length&&l[t][a]===1/0;)t++,a++;if(c[e]=[t,a],t===l.length||a===l.length){s[e]=-1;continue}let r=0===a||l[t][a-1]===1/0,n=0===t||l[t-1][a]===1/0;s[e]=r&&n?0:r?3:n?2:1}let u=[];for(let e=1-l.length;e<l.length;e++){if(1===s[e]||3===s[e])continue;let t=c[e][0],a=c[e][1];if(0!==l[t][a])for(;;){let r=!1;for(;t<l.length&&a<l.length&&0!==l[t][a];){if((a<l.length-1&&l[t][a]>l[t][a+1]||a===l.length-1&&l[t][a]>0)&&(0===s[e]||2===s[e]&&(t<l.length-1&&l[t][a]>l[t+1][a]||t===l.length-1&&l[t][a]>0))){r=!0;break}t++,a++}if(!r)break;let n=t,o=a,c=[[n,o,l[n][o]-1]];for(;;){let e=o-n;if(n<l.length-1&&l[n][o]===l[n+1][o]&&(0===s[e]||3===s[e]))n++;else{if(!(o>i[n]&&(n===l.length-1||n<l.length-1&&l[n][o]>l[n+1][o])))break;o--}c.push([n,o,l[n][o]-1])}c.forEach((e=>l[e[0]][e[1]]--)),u.push(c)}}let h=new Array(l.length);for(let e=0;e<l.length;e++){h[e]=new Array(l.length);for(let t=0;t<l.length;t++)h[e][t]=l[e][t]===1/0?1/0:0}let f=await ke(e+1,h);await new Promise(((e,t)=>setTimeout(e,a)));for(let e=0;e<u.length;e++){let t=e/u.length*6/7;await De(n,u[e],t),await je(n,u[e],n.height+1);let r=we-n.partial_footprint_sum-1,l=n.partial_footprint_sum-n.footprint;u[e].forEach((e=>{n.numbers[e[0]][e[1]]--,ue&&Be(n,e[0],e[1],r,l)})),Ie(n),await new Promise(((e,t)=>setTimeout(e,a/5)));let s=u[e][u[e].length-1][0],h=c[u[e][u[e].length-1][1]-s+u[e].length-1][1],m=[],p=Math.max(n.height+1,f.height+1);for(let e=o[h];e<=s;e++)m.push([e,h,p]);for(let e=h-1;e>=i[s];e--)m.push([s,e,p]);await Ne(n,u[e],f,m),m=[];for(let e=s-1;e>=o[h];e--)m.push([e,h,p]);Ye(f,m),m=[];for(let e=h-1;e>=i[s];e--)m.push([s,e,p]);Ye(f,m),await Ue(f,[[s,h,p]]),r=we-f.partial_footprint_sum-1,l=f.partial_footprint_sum-f.footprint,f.numbers[s][h]++,ue&&Be(f,s,h,r,l),Ie(f),await new Promise(((e,t)=>setTimeout(e,a)))}await qe(e),t()}))},input_type:["pp"]},sulzgruber_inverse:{method:function(e){return new Promise((async(t,n)=>{let l=ge[e],o=l.numbers,i=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;i[e]=t}let s=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;s[e]=t}let c={};for(let e=0;e<o.length;e++)c[-e]=[e,0];for(let e=1;e<o.length;e++)c[e]=[0,e];for(let e=1-o.length;e<o.length;e++){let t=c[e][0],a=c[e][1];for(;t<o.length&&a<o.length&&o[t][a]===1/0;)t++,a++;c[e]=[t,a]}let u=0,h=new Array(o.length);for(let e=0;e<o.length;e++){h[e]=new Array(o.length);for(let t=0;t<o.length;t++)o[e][t]===1/0?h[e][t]=1/0:(h[e][t]=0,u+=o[e][t])}let f=await ke(e+1,h),m=(f.numbers,0);for(let e=o.length-1;e>=0;e--)for(let t=o.length-1;t>=0;t--)if(o[t][e]!==1/0)for(;0!==o[t][e];){let n=m/u*6/7,h=Math.max(l.size+1,f.size+1);await De(l,[[t,e,o[t][e]-1]],n),await je(l,[[t,e,o[t][e]-1]],h);let p=t,g=e;for(let e=i[g];e<p;e++)l.cubes[e][g][h]=He(l,g,h,e),l.cubes[e][g][h].material.forEach((e=>e.color.setHSL(n,1,r)));for(let e=s[p];e<g;e++)l.cubes[p][e][h]=He(l,e,h,p),l.cubes[p][e][h].material.forEach((e=>e.color.setHSL(n,1,r)));let w=[];for(let e=p-1;e>=i[g];e--)w.push([e,g,h]);let d=Ge(l,w);w=[];for(let e=g-1;e>=s[p];e--)w.push([p,e,h]);let y=Ge(l,w);await Promise.all([d,y]),w=[];for(let e=s[p];e<g;e++)w.push([p,e,h]);w.push([p,g,l.numbers[p][g]-1]);for(let e=p-1;e>=i[g];e--)w.push([e,g,h]);let b=s[p]-p,x=b+w.length-1,E=[];for(let e=b;e<=x;e++)E.push(_.clone(c[e]));if(o[p][g]--,Ie(l),ue){Be(l,p,g,we-l.partial_footprint_sum-1,l.partial_footprint_sum-l.footprint)}await Ne(l,w,f,E);let v=0,P=f.numbers[E[0][0]][E[0][1]];for(;;){let e=v;for(;e<E.length&&E[e][0]===E[v][0];)e++;w=E.slice(v,e);let t=!0;for(let e=0;e<w.length;e++)if(f.numbers[w[e][0]][w[e][1]]!==P){t=!1;break}if(t){if(await Ue(f,w),w.forEach((e=>f.numbers[e[0]][e[1]]++)),Ie(f),ue){let e=we-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;w.forEach((a=>{Be(f,a[0],a[1],e,t)}))}v=e}else{let e=_.cloneDeep(E.slice(v));for(let e=v;e<E.length;e++)if(E[e][0]++,E[e][1]++,E[e][0]>f.footprint||E[e][1]>f.footprint)return void console.error("Insertion failed!");let t=E.slice(v);await Ne(f,e,f,t),P=f.numbers[E[v][0]][E[v][1]]}if(v===E.length)break}m++,await new Promise(((e,t)=>setTimeout(e,a/2)))}await qe(e),t()}))},input_type:["tableau"]},rsk:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e],l=ge[e+1],o=n.numbers,i=l.numbers,s=0,c=0;for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++){if(o[e][t]===1/0||i[e][t]===1/0)return Re("The SSYT contain infinite values, which is not allowed in RSK!"),me=!1,void r();0!==o[e][t]&&c++,s=Math.max(Math.max(s,o[e][t]),i[e][t])}if(0===s)return Re("The SSYT are empty!"),me=!1,void r();let u=new Array(s);for(let e=0;e<s;e++){u[e]=new Array(s);for(let t=0;t<s;t++)u[e][t]=0}let h=await ke(e+2,u),f=0;for(;0!==i[0][0];){let e=f/c*6/7,t=0,r=0,s=0;for(let e=0;e<i.length;e++){let a=i.length-1;for(;a>=0&&0===i[e][a];)a--;a>=0&&(t=Math.max(t,i[e][a]))}for(let e=0;e<i.length;e++){let a=i.length-1;for(;a>=0&&0===i[e][a];)a--;if(i[e][a]===t){r=e,s=a;break}}let m=[],p=[],g=[],w=[],d=[],y=[],b=r,_=s,x=o[b][_],E=i[b][_],v=[[b,_]];for(;0!==b;){let e=o.length-1;for(;0===o[b-1][e]||x<=o[b-1][e];)e--;for(let t=0;t<x;t++)m.push([b,_,t]),p.push([b-1,e,t]);b--,_=e,x=o[b][_],v.push([b,_])}let P=h.height+1;for(let e=0;e<x;e++)g.push([b,_,e]),w.push([E-1,e,P]);for(let e=0;e<E-1;e++)d.push([r,s,e]),y.push([e,x-1,P]);De(l,d.concat([[r,s,E-1]]),e),De(n,m,e),await De(n,g,e),i[r][s]=0;for(let e=v.length-1;e>0;e--)o[v[e][0]][v[e][1]]=o[v[e-1][0]][v[e-1][1]];if(o[r][s]=0,ue){let e=we-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;Be(n,r,s,e,t);for(let a=v.length-1;a>0;a--)Be(n,v[a][0],v[a][1],e,t);e=we-l.partial_footprint_sum-1,t=l.partial_footprint_sum-l.footprint,Be(l,r,s,e,t)}if(Ne(l,d,h,y),Ne(n,g,h,w),Ne(n,m,n,p),await Ne(l,[[r,s,E-1]],h,[[E-1,x-1,P]],!1),We(n,p),h.cube_group.remove(l.cubes[r][s][E-1]),Ye(l,[[r,s,E-1]],!0,!0),w.reverse(),y.reverse(),Ye(h,w.slice(1)),Ye(h,y),await Ue(h,[[E-1,x-1,P]]),u[E-1][x-1]++,ue){Be(h,E-1,x-1,we-h.partial_footprint_sum-1,h.partial_footprint_sum-h.footprint)}Ie(h),f++,await new Promise(((e,t)=>setTimeout(e,a/2)))}await qe(e),await new Promise(((e,t)=>setTimeout(e,a))),await qe(e),t()}))},input_type:["ssyt","ssyt"],same_shape:!0},rsk_inverse:{method:function(e){return new Promise((async(t,n)=>{let l=ge[e],o=_.cloneDeep(l.numbers),i=0;o.forEach((e=>e.forEach((e=>i+=e))));let s=new Array(i),c=new Array(i);for(let e=0;e<i;e++){s[e]=new Array(i),c[e]=new Array(i);for(let t=0;t<i;t++)s[e][t]=0,c[e][t]=0}let u=new Array(o.length);for(let e=0;e<o.length;e++)u[e]=0;let h=0,f=[],m=[],p=[];for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)for(;0!==o[e][t];){o[e][t]--;let a=t+1,r=0,n=0,l=[];for(;;){for(n=u[r];0!==n&&s[r][n-1]>a;)n--;if(n===u[r]){s[r][n]=a,u[r]++,0===n&&h++,l.push([r,n]);break}let e=s[r][n];s[r][n]=a,a=e,l.push([r,n]),r++}f.push(l),m.push([r,n]),p.push([e,t]),c[r][n]=e+1}let g=Math.max(u[0],h);s=new Array(g),c=new Array(g);for(let e=0;e<g;e++){s[e]=new Array(g),c[e]=new Array(g);for(let t=0;t<g;t++)s[e][t]=0,c[e][t]=0}let w=await ke(e+1,s);await new Promise(((e,t)=>setTimeout(e,a/2)));let d=await ke(e+2,c);await new Promise(((e,t)=>setTimeout(e,a/2)));let y=0;for(let e=0;e<p.length;e++){let t=p[e][0],n=p[e][1],o=l.height+1,u=y/i*6/7;for(let e=n;e>=0;e--)l.cubes[t][e][o]=He(l,e,o,t),l.cubes[t][e][o].material.forEach((e=>e.color.setHSL(u,1,r)));for(let e=t-1;e>=0;e--)l.cubes[e][n][o]=He(l,n,o,e),l.cubes[e][n][o].material.forEach((e=>e.color.setHSL(u,1,r)));l.cubes[t][n][o+1]=He(l,n,o,t),l.cubes[t][n][o+1].material.forEach((e=>e.color.setHSL(u,1,r))),await De(l,[[t,n,l.numbers[t][n]-1]],u),await je(l,[[t,n,l.numbers[t][n]-1]],o);let h=Ge(l,[[t,n,o+1]]),g=[];for(let e=n-1;e>=0;e--)g.push([t,e,o]);let b=Ge(l,g);g=[];for(let e=t-1;e>=0;e--)g.push([e,n,o]);let _=Ge(l,g);await Promise.all([h,b,_]);let x=f[y],E=[],v=[],P=[[t,n,l.numbers[t][n]-1]],S=[[x[0][0],x[0][1],n]],T=[[t,n,o+1]],A=[[m[y][0],m[y][1],t]];for(let e=n-1;e>=0;e--)P.push([t,e,o]),S.push([x[0][0],x[0][1],e]);for(let e=0;e<x.length-1;e++)for(let t=0;t<s[x[e][0]][x[e][1]];t++)E.push([x[e][0],x[e][1],t]),v.push([x[e+1][0],x[e+1][1],t]);for(let e=t-1;e>=0;e--)T.push([e,n,o]),A.push([m[y][0],m[y][1],e]);await De(w,E,u);for(let e=x.length-1;e>0;e--)s[x[e][0]][x[e][1]]=s[x[e-1][0]][x[e-1][1]];0!==x.length&&(s[x[0][0]][x[0][1]]=0),ue&&Fe(),0!==E.length&&await Ne(w,E,w,v),l.numbers[t][n]--,ue&&Fe(),Ne(l,P,w,S),await Ne(l,T,d,A),s[x[0][0]][x[0][1]]=n+1,c[m[y][0]][m[y][1]]=t+1,ue&&Fe(),Ie(l),Ie(w),Ie(d),y++,await new Promise(((e,t)=>setTimeout(e,a/2)))}await qe(e),t()}))},input_type:["tableau"]},godar_1:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e].numbers,l=new Array(n.length),o=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;for(l[e]=t,t=0;t<n.length&&n[t][e]===1/0;)t++;o[e]=t}let i=Math.max(l[0],o[0]);await Je("hillman_grassl",e,!0),await new Promise(((e,t)=>setTimeout(e,3*a)));let s=[],c=ge[e].numbers;for(let e=0;e<c.length;e++)for(let t=0;t<c.length;t++)if(c[e][t]!==1/0)for(let a=0;a<c[e][t];a++)s.push([e,t,a]);await We(ge[e],s);let u=2*n.length-l[n.length-1]-o[n.length-1],h=l[0]+o[0],f=new Array(u),m=new Array(h),p=new Array(2*n.length);for(let e=0;e<u;e++)f[e]=new Array;for(let e=0;e<h;e++)m[e]=new Array;for(let e=0;e<2*n.length;e++)p[e]=new Array;for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++)t>=l[e]?f[e+t+1-l[e]-o[t]].push([e,t]):m[l[e]+o[t]-e-t-1].unshift([i-e-1,i-t-1]),p[e+t+1].push([e,t]);let g=new Array(n.length);for(let e=0;e<n.length;e++)g[e]=new Array(n.length);for(let t=1;t<u;t++){let a=[];for(let r=0;r<f[t].length;r++){for(let n=0;n<ge[e].numbers[f[t][r][0]][f[t][r][1]];n++)a.push([f[t][r][0],f[t][r][1],n]);r<p[t].length?g[f[t][r][0]][f[t][r][1]]=[1,p[t][r]]:g[f[t][r][0]][f[t][r][1]]=[0,m[t][r-p[t].length]]}0!==a.length&&De(ge[e],a,(t-1)/(u-1)*6/7)}await new Promise(((e,t)=>setTimeout(e,3*a)));let w=new Array(i);for(let e=0;e<i;e++){w[e]=new Array(i);for(let t=0;t<i;t++)t<i-l[i-e-1]?w[e][t]=1/0:w[e][t]=0}let d=null;i>0&&(d=await ke(e+1,w));let y=new Array(n.length);for(let e=0;e<n.length;e++){y[e]=new Array(n.length);for(let t=0;t<n.length;t++)y[e][t]=0}let b=await ke(e+2,y);for(let t=0;t<n.length;t++)for(let a=l[t];a<n.length;a++)if(ge[e].numbers[t][a]>0){let r=[],n=[],l=g[t][a][1][0],o=g[t][a][1][1];for(let i=0;i<ge[e].numbers[t][a];i++)r.push([t,a,i]),n.push([l,o,i]);0===g[t][a][0]?(await Ne(ge[e],r,d,n),w[l][o]=ge[e].numbers[t][a],ge[e].numbers[t][a]=0):(await Ne(ge[e],r,b,n),y[l][o]=ge[e].numbers[t][a],ge[e].numbers[t][a]=0),ue&&Fe()}await qe(e),await Le(e+1),await new Promise(((e,t)=>setTimeout(e,3*a))),await Je("hillman_grassl_inverse",e,!0),i>0&&await Je("hillman_grassl_inverse",e+1,!0),t()}))},input_type:["pp"]},godar_1_inverse:{method:function(e){return new Promise((async(t,r)=>{let n=ge[e+1].numbers,l=ge[e].numbers,o=new Array(n.length+2*l.length),i=new Array(n.length+2*l.length);for(let e=0;e<n.length+2*l.length;e++)o[e]=0,i[e]=0;for(let e=0;e<l.length;e++){let t=l.length-1;for(;t>=0&&l[e][t]!==1/0;)t--;for(o[l.length-e-1]=l.length-t-1,t=l.length-1;t>=0&&l[t][e]!==1/0;)t--;i[l.length-e-1]=l.length-t-1}await Je("hillman_grassl",e,!0),await Je("hillman_grassl",e+1,!0),await new Promise(((e,t)=>setTimeout(e,3*a)));let s=[],c=ge[e].numbers;for(let e=0;e<c.length;e++)for(let t=0;t<c.length;t++)if(c[e][t]!==1/0)for(let a=0;a<c[e][t];a++)s.push([e,t,a]);We(ge[e],s),s=[],c=ge[e+1].numbers;for(let e=0;e<c.length;e++)for(let t=0;t<c.length;t++)if(c[e][t]!==1/0)for(let a=0;a<c[e][t];a++)s.push([e,t,a]);await We(ge[e+1],s);let u=o[0]+i[0]+n.length,h=2*u,f=o[0]+i[0],m=2*n.length,p=new Array(h),g=new Array(f),w=new Array(m);for(let e=0;e<h;e++)p[e]=new Array;for(let e=0;e<f;e++)g[e]=new Array;for(let e=0;e<m;e++){w[e]=new Array(e);for(let t=0;t<e;t++)w[e][t]=-1}for(let e=0;e<u;e++)for(let t=0;t<u;t++)t>=o[e]?p[e+t+1-o[e]-i[t]].push([e,t]):g[o[e]+i[t]-e-t-1].unshift([l.length-e-1,l.length-t-1]),e<n.length&&t<n.length&&(w[e+t+1][e]=[e,t]);let d=new Array(n.length);for(let e=0;e<n.length;e++)d[e]=new Array(n.length);let y=new Array(l.length);for(let e=0;e<l.length;e++)y[e]=new Array(l.length);for(let t=1;t<f;t++){let a=[];for(let r=0;r<g[t].length;r++){for(let n=0;n<ge[e].numbers[g[t][r][0]][g[t][r][1]];n++)a.push([g[t][r][0],g[t][r][1],n]);y[g[t][r][0]][g[t][r][1]]=p[t][r+w[t].length]}0!==a.length&&De(ge[e],a,(t-1)/(f-1)*6/7)}for(let t=1;t<m;t++){let a=[];for(let r=0;r<w[t].length;r++)if(-1!==w[t][r]){for(let n=0;n<ge[e+1].numbers[w[t][r][0]][w[t][r][1]];n++)a.push([w[t][r][0],w[t][r][1],n]);d[w[t][r][0]][w[t][r][1]]=p[t][r]}0!==a.length&&De(ge[e+1],a,(t-1)/(m-1)*6/7)}await new Promise(((e,t)=>setTimeout(e,3*a)));let b=new Array(u);for(let e=0;e<u;e++){b[e]=new Array(u);for(let t=0;t<u;t++)t<o[e]?b[e][t]=1/0:b[e][t]=0}let _=await ke(e+2,b);await new Promise(((e,t)=>setTimeout(e,a/2)));for(let t=0;t<l.length;t++)for(let a=0;a<l.length;a++)if(ge[e].numbers[t][a]>0&&ge[e].numbers[t][a]!==1/0){let r=[],n=[],l=y[t][a][0],o=y[t][a][1];for(let i=0;i<ge[e].numbers[t][a];i++)r.push([t,a,i]),n.push([l,o,i]);await Ne(ge[e],r,_,n),b[l][o]=ge[e].numbers[t][a],ge[e].numbers[t][a]=0,ue&&Fe()}for(let t=0;t<n.length;t++)for(let a=0;a<n.length;a++)if(ge[e+1].numbers[t][a]>0&&ge[e+1].numbers[t][a]!==1/0){let r=[],n=[],l=d[t][a][0],o=d[t][a][1];for(let i=0;i<ge[e+1].numbers[t][a];i++)r.push([t,a,i]),n.push([l,o,i]);await Ne(ge[e+1],r,_,n),b[l][o]=ge[e+1].numbers[t][a],ge[e+1].numbers[t][a]=0,ue&&Fe()}await qe(e),await new Promise(((e,t)=>setTimeout(e,a/2))),await qe(e),await new Promise(((e,t)=>setTimeout(e,a))),await Le(e),await new Promise(((e,t)=>setTimeout(e,3*a))),await Je("hillman_grassl_inverse",e,!0),await new Promise(((e,t)=>setTimeout(e,a))),t()}))},input_type:["pp","pp"]}};let o={renderer:"cpu",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!1,mousedown_callback:xe,touchstart_callback:xe,mousedrag_callback:Ee,touchmove_callback:Ee,mouseup_callback:ve,touchend_callback:ve},i=new Wilson(Page.element.querySelector("#numbers-canvas"),o);i.ctx.fillStyle="rgb(255, 255, 255)",Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),Page.set_element_styles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0);let s={canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:e,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:function(){try{document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(e){}ue||i.ctx.clearRect(0,0,i.canvas_width,i.canvas_height);i.fullscreen.switch_fullscreen()}},c=new Wilson(Page.element.querySelector("#output-canvas"),s),u=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});u.ctx.strokeStyle="rgb(255, 255, 255)",u.ctx._alpha=1,u.ctx.fillStyle="rgba(64, 64, 64, 1)",u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle="rgba(128, 128, 128, 1)",u.ctx.fillRect(4,4,56,56),u.ctx.lineWidth=6;let h=new Wilson(Page.element.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});h.ctx.strokeStyle="rgb(255, 255, 255)",h.ctx._alpha=1,h.ctx.fillStyle="rgba(64, 64, 64, 1)",h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle="rgba(128, 128, 128, 1)",h.ctx.fillRect(4,4,56,56),h.ctx.lineWidth=6;let f=new Wilson(Page.element.querySelector("#hidden-canvas-3"),{renderer:"cpu",canvas_width:64,canvas_height:64});f.ctx.strokeStyle="rgb(255, 255, 255)",f.ctx._alpha=1,f.ctx.fillStyle="rgba(32, 32, 32, 1)",f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle="rgba(64, 64, 64, 1)",f.ctx.fillRect(4,4,56,56),f.ctx.lineWidth=6;let m=new Wilson(Page.element.querySelector("#hidden-canvas-4"),{renderer:"cpu",canvas_width:64,canvas_height:64});m.ctx.strokeStyle="rgb(255, 255, 255)",m.ctx._alpha=1,m.ctx.fillStyle="rgba(32, 32, 32, 1)",m.ctx.fillRect(0,0,64,64),m.ctx.fillStyle="rgba(64, 64, 64, 1)",m.ctx.fillRect(4,4,56,56),m.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then((()=>{Site.scripts_loaded.three=!0})).catch((e=>{console.error("Could not load THREE.js")}));let p=Page.element.querySelector("#numbers-canvas-container");const g={"view-controls":Page.element.querySelectorAll(".view-controls-section"),"add-array":Page.element.querySelectorAll(".add-array-section"),"edit-array":Page.element.querySelectorAll(".edit-array-section"),"remove-array":Page.element.querySelectorAll(".remove-array-section"),algorithms:Page.element.querySelectorAll(".algorithms-section"),examples:Page.element.querySelectorAll(".examples-section")},w=Page.element.querySelector("#category-holder"),d=Page.element.querySelector("#canvas-landscape-left");let y="view-controls";["view-controls","add-array","edit-array","remove-array","algorithms"].forEach((e=>{e!==y&&g[e].forEach((e=>{e.style.opacity=0}))})),g[y].forEach((e=>d.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let b=Page.element.querySelector("#category-selector-dropdown"),x=Page.element.querySelector("#resolution-input"),E=Page.element.querySelector("#show-dimers-button"),v=Page.element.querySelector("#switch-view-button"),P=Page.element.querySelector("#maximum-speed-checkbox"),S=Page.element.querySelector("#array-data-textarea"),T=Page.element.querySelector("#add-array-button"),A=Page.element.querySelector("#edit-array-textarea"),M=Page.element.querySelector("#edit-array-index-input"),R=Page.element.querySelector("#edit-array-button"),k=Page.element.querySelector("#remove-array-index-input"),L=Page.element.querySelector("#remove-array-button"),q=Page.element.querySelector("#algorithm-index-input"),H=Page.element.querySelector("#hillman-grassl-button"),z=Page.element.querySelector("#hillman-grassl-inverse-button"),$=Page.element.querySelector("#pak-button"),O=Page.element.querySelector("#pak-inverse-button"),Q=Page.element.querySelector("#sulzgruber-button"),C=Page.element.querySelector("#sulzgruber-inverse-button"),I=Page.element.querySelector("#rsk-button"),F=Page.element.querySelector("#rsk-inverse-button"),B=Page.element.querySelector("#godar-1-button"),D=Page.element.querySelector("#godar-1-inverse-button"),W=Page.element.querySelector("#example-1-button"),j=Page.element.querySelector("#example-2-button"),U=Page.element.querySelector("#example-3-button"),N=!1,G=Page.element.querySelector("#download-button");b.addEventListener("input",(async()=>{if(await Promise.all(Array.from(g[y]).map((e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time)))),g[y].forEach((e=>w.appendChild(e))),g[y].forEach((e=>e.classList.remove("move-to-left"))),g[y].forEach((e=>e.classList.remove("move-to-right"))),y=b.value,g[y].forEach((e=>d.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===y){let e=parseInt(M.value||0);e<ge.length&&e>=0&&(A.value=Te(ge[e].numbers))}g[y].forEach((e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time)))})),x.addEventListener("input",(()=>{t=parseInt(x.value||2e3),K.setSize(t,t,!1)})),E.addEventListener("click",(()=>{ae?Ce():new Promise((async(e,t)=>{if(fe)return void t();ae=!0,Page.Animate.change_opacity(E,0,Site.opacity_animation_time).then((()=>{E.textContent="Hide Dimers",Page.Animate.change_opacity(E,1,Site.opacity_animation_time)})),he||await $e(),fe=!0;let r=[];ge.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),r.forEach((e=>e.opacity=0)),await new Promise(((e,t)=>{anime({targets:[u.ctx,h.ctx,f.ctx,m.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:a/2,easing:"easeOutQuad",complete:e,update:()=>{u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(128, 128, 128, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),J.needsUpdate=!0,h.ctx.clearRect(0,0,64,64),h.ctx.fillStyle=`rgba(64, 64, 64, ${h.ctx._alpha})`,h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle=`rgba(128, 128, 128, ${h.ctx._alpha})`,h.ctx.fillRect(4,4,56,56),h.ctx.moveTo(21.3,21.3),h.ctx.lineTo(42.7,42.7),h.ctx.stroke(),X.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(42.7,21.3),f.ctx.lineTo(21.3,42.7),f.ctx.stroke(),Z.needsUpdate=!0,m.ctx.clearRect(0,0,64,64),m.ctx.fillStyle=`rgba(32, 32, 32, ${m.ctx._alpha})`,m.ctx.fillRect(0,0,64,64),m.ctx.fillStyle=`rgba(64, 64, 64, ${m.ctx._alpha})`,m.ctx.fillRect(4,4,56,56),m.ctx.moveTo(21.3,21.3),m.ctx.lineTo(42.7,42.7),m.ctx.stroke(),ee.needsUpdate=!0}})})),fe=!1,e()}))})),v.addEventListener("click",(()=>{ue?$e():Oe()})),P.addEventListener("input",(()=>{a=P.checked?60:600})),S.value=Pe(),T.addEventListener("click",(()=>{ke(ge.length,Se(S.value))})),M.addEventListener("input",(()=>{let e=parseInt(M.value||0);e>=ge.length||e<0||(A.value=Te(ge[e].numbers))})),R.addEventListener("click",(function(){return new Promise((async(e,t)=>{let a=parseInt(M.value);if(a>=ge.length||a<0)return void Re(`No array at index ${a}`);ge[a];let r=Se(A.value);await qe(a),await ke(a,r),ue||Qe(),e()}))})),L.addEventListener("click",(()=>{qe(parseInt(k.value))})),H.addEventListener("click",(()=>Je("hillman_grassl"))),z.addEventListener("click",(()=>Je("hillman_grassl_inverse"))),$.addEventListener("click",(()=>Je("pak"))),O.addEventListener("click",(()=>Je("pak_inverse"))),Q.addEventListener("click",(()=>Je("sulzgruber"))),C.addEventListener("click",(()=>Je("sulzgruber_inverse"))),I.addEventListener("click",(()=>Je("rsk"))),F.addEventListener("click",(()=>Je("rsk_inverse"))),B.addEventListener("click",(()=>Je("godar_1"))),D.addEventListener("click",(()=>Je("godar_1_inverse"))),W.addEventListener("click",(()=>Ke(1))),j.addEventListener("click",(()=>Ke(2))),U.addEventListener("click",(()=>Ke(3))),G.addEventListener("click",(()=>{N=!0}));const Y=new THREE.Scene,V=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),K=new THREE.WebGLRenderer({canvas:c.canvas,antialias:!0});K.setSize(t,t,!1);new THREE.TextureLoader;const J=new THREE.CanvasTexture(u.canvas);J.minFilter=THREE.LinearFilter,J.magFilter=THREE.NearestFilter;const X=new THREE.CanvasTexture(h.canvas);X.minFilter=THREE.LinearFilter,X.magFilter=THREE.NearestFilter;const Z=new THREE.CanvasTexture(f.canvas);Z.minFilter=THREE.LinearFilter,Z.magFilter=THREE.NearestFilter;const ee=new THREE.CanvasTexture(m.canvas);ee.minFilter=THREE.LinearFilter,ee.magFilter=THREE.NearestFilter;const te=new THREE.BoxGeometry;let ae=!1;const re=new THREE.BoxGeometry(1,.001,1),ne=(new THREE.BoxGeometry(.001,1,1),new THREE.BoxGeometry(1,1,.001),new THREE.AmbientLight(16777215,.2));Y.add(ne);const le=new THREE.PointLight(16777215,3,1e4);le.position.set(750,1e3,500),Y.add(le);let oe=0,ie=0,se=0,ce=[];let ue=!1,he=!0,fe=!1,me=!1,pe=10,ge=[],we=0,de=0,ye=0,be=[15,15,15],_e=[0,20,0];{let e=Se(S.value);A.value=S.value,ke(ge.length,e)}function xe(e,t,a){he=!1,ie=0,ce=[0,0,0,0]}function Ee(e,t,a,r,n){ue||(oe+=a,oe>3.14159265?oe-=6.283185301:oe<-3.14159265&&(oe+=6.283185301),Y.children.forEach((e=>e.rotation.y=oe)),se=a)}function ve(e,t,a){if(!ue){let e=0;if(ce.forEach(((t,a)=>{Math.abs(t)>ie&&(ie=Math.abs(t),e=a)})),ie<.005)return void(ie=0);ie=ce[e]}ce=[0,0,0,0]}function Pe(){let e=Math.floor(3*Math.random())+4,t=Math.floor(5*Math.random())+10,a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);a[0][0]=t;for(let t=1;t<e;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++){a[t][0]=Math.max(a[t-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<e;r++)a[t][r]=Math.max(Math.min(a[t][r-1],a[t-1][r])-Math.floor(4*Math.random()),0)}let r="";for(let t=0;t<e;t++){for(let n=0;n<e;n++){let e=a[t][n];r+=0===e?"   ":e<10?` ${e} `:`${e} `}t!==e-1&&(r+="\n")}return r}function Se(e){let t=e.split("\n"),a=t.length,r=new Array(t.length);for(let e=0;e<r.length;e++){r[e]=t[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let n=r[0].length,l=Math.max(a,n),o=new Array(l);for(let e=0;e<a;e++){o[e]=new Array(l);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?o[e][t]=1/0:o[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<l;t++)o[e][t]=0}for(let e=a;e<l;e++){o[e]=new Array(l);for(let t=0;t<l;t++)o[e][t]=0}return o}function Te(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let a="";for(let r=0;r<e.length;r++){for(let n=0;n<e.length;n++)if(e[r][n]===1/0){for(let e=0;e<t-1-(0===n);e++)a+=" ";a+="^"}else{let l=`${e[r][n]}`.length;for(let e=0;e<t-l-(0===n);e++)a+=" ";a+=e[r][n]}r!==e.length-1&&(a+="\n")}return a}function Ae(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return!1;return!0}function Me(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(0!==e[t+1][a]&&e[t][a]>=e[t+1][a]||0!==e[t][a+1]&&e[t][a]>e[t][a+1])return!1;return!0}function Re(e){Page.Footer.Floating.show_settings_text(e)}function ke(e,t){return new Promise((async(r,l)=>{let o={numbers:t,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};ue&&await Page.Animate.change_opacity(p,0,a/5),ge.splice(e,0,o),o.footprint=o.numbers.length;for(let t=e;t<ge.length;t++)ge[t].partial_footprint_sum=ge[t].footprint,0!==t?(ge[t].center_offset=ge[t-1].center_offset+ge[t-1].footprint/2+ge[t].footprint/2+1,ge[t].partial_footprint_sum+=ge[t-1].partial_footprint_sum+1):ge[t].center_offset=0,t!==e&&anime({targets:ge[t].cube_group.position,x:ge[t].center_offset,y:0,z:-ge[t].center_offset,duration:a,easing:"easeInOutQuad"});o.cube_group=new THREE.Object3D,Y.add(o.cube_group),o.cube_group.position.set(o.center_offset,0,-o.center_offset),o.cube_group.rotation.y=oe,o.cubes=new Array(o.footprint),o.floor=new Array(o.footprint);for(let e=0;e<o.footprint;e++){o.cubes[e]=new Array(o.footprint),o.floor[e]=new Array(o.footprint);for(let t=0;t<o.footprint;t++)if(o.numbers[e][t]!==1/0){o.cubes[e][t]=new Array(o.numbers[e][t]),o.numbers[e][t]>o.height&&(o.height=o.numbers[e][t]),o.floor[e][t]=ze(o,t,e);for(let a=0;a<o.numbers[e][t];a++)o.cubes[e][t][a]=He(o,t,a,e)}else{o.cubes[e][t]=new Array(n),o.floor[e][t]=ze(o,t,e);for(let a=0;a<n;a++)o.cubes[e][t][a]=He(o,t,a,e,0,0,.6)}}o.size=Math.max(o.footprint,o.height),we+=o.footprint+1,de=Math.max(de,o.height),ye=Math.max(we,de),1===ge.length?(be=[ye,ye+de/3,ye],_e=[0,ye+10,0],ue?Qe(!0):(V.left=-ye,V.right=ye,V.top=ye,V.bottom=-ye,V.position.set(be[0],be[1],be[2]),V.rotation.set(-.785398163,.615479709,.523598775),V.updateProjectionMatrix())):Qe(!0),e!==ge.length-1&&await new Promise(((e,t)=>setTimeout(e,a)));let i=[];o.cube_group.traverse((e=>{e.material&&e.material.forEach((e=>i.push(e)))})),await new Promise((async(e,t)=>{anime({targets:i,opacity:1,duration:a/2,easing:"easeOutQuad",complete:e})})),ue&&Fe(),r(o)}))}function Le(e){return new Promise((async(t,a)=>{if(e>=ge.length||e<0)return void Re(`No array at index ${e}`);let r=ge[e].numbers,n=0;for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)0!==r[e][t]&&(n=Math.max(n,Math.max(e+1,t+1)));let l=new Array(n);for(let e=0;e<n;e++){l[e]=new Array(n);for(let t=0;t<n;t++)l[e][t]=r[e][t]}await qe(e),await ke(e,l),ue||Qe(),t()}))}function qe(e){return new Promise((async(t,r)=>{if(e>=ge.length||e<0)Re(`No array at index ${e}`);else{ue&&await Page.Animate.change_opacity(p,0,a/5),await new Promise(((t,r)=>{let n=[];ge[e].cube_group.traverse((e=>{e.material&&e.material.forEach((e=>n.push(e)))})),anime({targets:n,opacity:0,duration:a/2,easing:"easeOutQuad",complete:t})}));for(let t=0;t<ge[e].cubes.length;t++)for(let a=0;a<ge[e].cubes[t].length;a++)if(ge[e].cubes[t][a])for(let r=0;r<ge[e].cubes[t][a].length;r++)ge[e].cubes[t][a][r]&&ge[e].cubes[t][a][r].material.forEach((e=>e.dispose()));Y.remove(ge[e].cube_group),we-=ge[e].footprint+1,ge.splice(e,1);for(let t=e;t<ge.length;t++)ge[t].partial_footprint_sum=ge[t].footprint,0!==t?(ge[t].center_offset=ge[t-1].center_offset+ge[t-1].footprint/2+ge[t].footprint/2+1,ge[t].partial_footprint_sum+=ge[t-1].partial_footprint_sum+1):ge[t].center_offset=0,anime({targets:ge[t].cube_group.position,x:ge[t].center_offset,y:0,z:-ge[t].center_offset,duration:a,easing:"easeInOutQuad"});0!==ge.length&&Qe(!0),t()}}))}function He(e,t,a,r,n=0,l=0,o=.4){const i=[new THREE.MeshStandardMaterial({map:J,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:J,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:J,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:J,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:X,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:X,transparent:!0,opacity:0})];i.forEach((e=>e.color.setHSL(n,l,o)));const s=new THREE.Mesh(te,i);return e.cube_group.add(s),s.position.set(t-(e.footprint-1)/2,a,r-(e.footprint-1)/2),s}function ze(e,t,a,r=0,n=0,l=.4){const o=[new THREE.MeshStandardMaterial({map:Z,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:Z,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:Z,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:Z,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:ee,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:ee,transparent:!0,opacity:0})];o.forEach((e=>e.color.setHSL(r,n,l)));const i=new THREE.Mesh(re,o);return e.cube_group.add(i),i.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),i}function $e(){return new Promise((async(e,t)=>{fe?t():(Page.Animate.change_opacity(v,0,Site.opacity_animation_time).then((()=>{v.textContent="Show 2D View",Page.Animate.change_opacity(v,1,Site.opacity_animation_time)})),fe=!0,ue&&await Page.Animate.change_opacity(p,0,a/5),ue=!1,he=!0,ie=0,ce=[0,0,0,0],Qe(!0),anime({targets:V.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:a,easing:"easeInOutQuad",complete:()=>{fe=!1,e()}}),ge.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:a,easing:"easeInOutQuad"})})),oe=0)}))}function Oe(){return new Promise((async(e,t)=>{fe||ue?t():(Page.Animate.change_opacity(v,0,Site.opacity_animation_time).then((()=>{v.textContent="Show 3D View",Page.Animate.change_opacity(v,1,Site.opacity_animation_time)})),ae&&await Ce(),fe=!0,ue=!0,he=!1,ie=0,ce=[0,0,0,0],Qe(!0),anime({targets:V.rotation,x:-1.570796327,y:0,z:0,duration:a,easing:"easeInOutQuad"}),ge.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:a,easing:"easeInOutQuad"})})),setTimeout((()=>{Fe(),Page.Animate.change_opacity(p,1,a/5).then((()=>{fe=!1,oe=0,e()}))}),a))}))}function Qe(e=!1){if(!e){if(fe)return;fe=!0}de=0;for(let e=0;e<ge.length;e++)de=Math.max(de,ge[e].height);ye=Math.max(we,de);let t=(-ge[0].footprint/2+ge[ge.length-1].center_offset+ge[ge.length-1].footprint/2)/2;be=[ye+t,ye+de/3,ye-t],_e=[t,ye+10,-t],ue?(anime({targets:V.position,x:_e[0],y:_e[1],z:_e[2],duration:a,easing:"easeInOutQuad"}),anime({targets:V,left:-(we/2+.5),right:we/2+.5,top:we/2+.5,bottom:-(we/2+.5),duration:a,easing:"easeInOutQuad",update:()=>V.updateProjectionMatrix(),complete:()=>{V.updateProjectionMatrix(),fe=!1}}),setTimeout((()=>{Fe(),Page.Animate.change_opacity(p,1,a/5)}),a)):(anime({targets:V.position,x:be[0],y:be[1],z:be[2],duration:a,easing:"easeInOutQuad"}),anime({targets:V,left:-ye,right:ye,top:ye,bottom:-ye,duration:a,easing:"easeInOutQuad",update:()=>V.updateProjectionMatrix(),complete:()=>{V.updateProjectionMatrix(),fe=!1}}))}function Ce(){return new Promise((async(e,t)=>{if(fe)return void t();ae=!1,Page.Animate.change_opacity(E,0,Site.opacity_animation_time).then((()=>{E.textContent="Show Dimers",Page.Animate.change_opacity(E,1,Site.opacity_animation_time)})),fe=!0;let r=[];ge.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),await new Promise(((e,t)=>{anime({targets:[u.ctx,h.ctx,f.ctx,m.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:a/2,easing:"easeOutQuad",complete:e,update:()=>{u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(128, 128, 128, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),J.needsUpdate=!0,h.ctx.clearRect(0,0,64,64),h.ctx.fillStyle=`rgba(64, 64, 64, ${h.ctx._alpha})`,h.ctx.fillRect(0,0,64,64),h.ctx.fillStyle=`rgba(128, 128, 128, ${h.ctx._alpha})`,h.ctx.fillRect(4,4,56,56),h.ctx.moveTo(21.3,21.3),h.ctx.lineTo(42.7,42.7),h.ctx.stroke(),X.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(42.7,21.3),f.ctx.lineTo(21.3,42.7),f.ctx.stroke(),Z.needsUpdate=!0,m.ctx.clearRect(0,0,64,64),m.ctx.fillStyle=`rgba(32, 32, 32, ${m.ctx._alpha})`,m.ctx.fillRect(0,0,64,64),m.ctx.fillStyle=`rgba(64, 64, 64, ${m.ctx._alpha})`,m.ctx.fillRect(4,4,56,56),m.ctx.moveTo(21.3,21.3),m.ctx.lineTo(42.7,42.7),m.ctx.stroke(),ee.needsUpdate=!0}})})),r.forEach((e=>e.opacity=1)),fe=!1,e()}))}function Ie(e){e.height=0,e.numbers.forEach((t=>{t.forEach((t=>{t!==1/0&&(e.height=Math.max(t,e.height))}))})),e.size=Math.max(e.footprint,e.height);let t=de;de=0,ge.forEach((e=>de=Math.max(e.height,de))),ye=Math.max(we,de),de!==t&&Qe()}function Fe(){pe=i.canvas_width/(we+1);let e=Math.max(`${de}`.length,2);i.ctx.font=pe/e+"px monospace",i.ctx.clearRect(0,0,i.canvas_width,i.canvas_height),ge.forEach((e=>{let t=we-e.partial_footprint_sum-1,a=e.partial_footprint_sum-e.footprint;for(let r=0;r<e.footprint;r++)for(let n=0;n<e.footprint;n++)Be(e,r,n,t,a)}))}function Be(e,t,a,r,n){if(i.ctx.clearRect(pe*(a+n+1),pe*(t+r+1),pe,pe),e.numbers[t][a]!==1/0){let l=i.ctx.measureText(e.numbers[t][a]);i.ctx.fillText(e.numbers[t][a],pe*(a+n+1)+(pe-l.width)/2,pe*(t+r+1)+(pe+l.actualBoundingBoxAscent-l.actualBoundingBoxDescent)/2)}}function De(e,t,n){return new Promise(((l,o)=>{if(0===t.length)return void l();let i=[];t.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e.color)))})),i.forEach((e=>e.getRGB(e)));let s=r+1*Math.min(r,.6),u=0===s?0:2*(1-r/s),h=i.map((e=>c.utils.hsv_to_rgb(n,u,s)));anime({targets:i,r:(e,t)=>h[t][0]/255,g:(e,t)=>h[t][1]/255,b:(e,t)=>h[t][2]/255,duration:a,delay:(e,t)=>Math.floor(t/6)*a/10,easing:"easeOutQuad",update:()=>i.forEach((e=>e.setRGB(e.r,e.g,e.b))),complete:l})}))}function We(e,t){return new Promise(((n,l)=>{let o=[];t.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>o.push(e.color)))})),o.forEach((e=>e.getHSL(e))),anime({targets:o,s:0,duration:a,easing:"easeOutQuad",update:()=>o.forEach((e=>e.setHSL(e.h,e.s,r))),complete:n})}))}function je(e,t,r){return new Promise(((n,l)=>{let o=ue?0:a,i=[];t.forEach((t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")})),anime({targets:i,y:r,duration:o,easing:"easeInOutQuad",complete:n})}))}function Ue(e,t){return new Promise(((r,n)=>{let l=ue?0:a,o=[];t.forEach((t=>{o.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")})),anime({targets:o,y:(a,r)=>e.numbers[t[r][0]][t[r][1]],duration:l,easing:"easeInOutQuad",complete:()=>{t.forEach((t=>{e.cubes[t[0]][t[1]][e.numbers[t[0]][t[1]]]=e.cubes[t[0]][t[1]][t[2]],e.cubes[t[0]][t[1]][t[2]]=null})),r()}})}))}function Ne(e,t,r,n,l=!0){return new Promise(((o,i)=>{let s=[];t.forEach((t=>{s.push(e.cubes[t[0]][t[1]][t[2]].position),r.cube_group.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")})),anime({targets:s,x:(e,t)=>n[t][1]-(r.footprint-1)/2,y:(e,t)=>n[t][2],z:(e,t)=>n[t][0]-(r.footprint-1)/2,duration:a,easing:"easeInOutQuad",complete:()=>{if(l){let a=t.map((t=>e.cubes[t[0]][t[1]][t[2]]));t.forEach((t=>e.cubes[t[0]][t[1]][t[2]]=null)),n.forEach(((e,n)=>{r.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[e[0]][e[1]][e[2]]&&!t.some((t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]))&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),r.cubes[e[0]][e[1]][e[2]]=a[n]}))}o()}})}))}function Ge(e,t){return new Promise(((r,n)=>{if(0===t.length)return void r();let l=[];t.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>l.push(e))),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")})),anime({targets:l,opacity:1,duration:a/2,delay:(e,t)=>Math.floor(t/6)*a/10,easing:"easeOutQuad",complete:r})}))}function Ye(e,t,r=!1,n=!1){return new Promise(((l,o)=>{let i=[];t.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e)))})),anime({targets:i,opacity:0,duration:a/2*!n,delay:(e,t)=>!r*Math.floor(t/6)*a/10,easing:"easeOutQuad",complete:()=>{i.forEach((e=>e.dispose())),t.forEach((t=>{e.cube_group.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null})),l()}})}))}function Ve(e,t){return new Promise(((r,n)=>{let l=[];t.forEach((t=>{e.floor[t[0]][t[1]].material.forEach((e=>l.push(e)))})),anime({targets:l,opacity:0,duration:a/2,easing:"easeOutQuad",complete:()=>{l.forEach((e=>e.dispose())),t.forEach((t=>{e.cube_group.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null})),r()}})}))}function Ke(e){return new Promise((async(t,r)=>{if(1===e||2===e){for(;ge.length>1;)await qe(1),await new Promise(((e,t)=>setTimeout(e,a/2)));if(0===ge.length){let e=Se(Pe());await ke(ge.length,e)}else if(!Ae(ge[0].numbers)){await qe(0),await new Promise(((e,t)=>setTimeout(e,a/2)));let e=Se(Pe());await ke(ge.length,e)}1===e?(await Je("hillman_grassl",0),await new Promise(((e,t)=>setTimeout(e,3*a))),await Je("hillman_grassl_inverse",0)):(await Je("pak",0),await new Promise(((e,t)=>setTimeout(e,3*a))),await $e(),await new Promise(((e,t)=>setTimeout(e,a))),await Je("sulzgruber_inverse",0)),t()}else if(3===e){for(;ge.length>0;)await qe(0),await new Promise(((e,t)=>setTimeout(e,a/2)));await ke(ge.length,function(){let e=Math.floor(3*Math.random())+4,t=new Array(e);for(let a=0;a<e;a++){t[a]=new Array(e);for(let r=0;r<e;r++)Math.random()<.75/e?t[a][r]=Math.floor(3*Math.random())+1:t[a][r]=0}return t}()),await Oe(),await new Promise(((e,t)=>setTimeout(e,a))),await Je("rsk_inverse",0),await new Promise(((e,t)=>setTimeout(e,3*a))),await Je("rsk",0),t()}}))}function Je(e,t,a=!1){return new Promise((async(r,n)=>{if(void 0===t&&(t=parseInt(q.value||0)),!a&&me)return void n();me=!0;let o=l[e],i=o.input_type.length;if(t>ge.length-1||t<0)return Re(`No array at index ${t}!`),me=!1,void n();if(i>1&&t>ge.length-i)return Re(`No array at index ${t+i-1}! (This algorithm needs ${i} arrays)`),me=!1,void n();for(let e=0;e<i;e++){let a=o.input_type[e];if("pp"===a&&!Ae(ge[t+e].numbers))return Re(`Array at index ${t+e} is not a plane partition!`),me=!1,void n();if("ssyt"===a&&!Me(ge[t+e].numbers))return Re(`Array at index ${t+e} is not an SSYT!`),me=!1,void n()}if(i>1&&void 0!==o.same_shape&&o.same_shape){let e=new Array(i),a=0;for(let e=0;e<i;e++)a=Math.max(a,ge[t+e].numbers.length);for(let r=0;r<i;r++){e[r]=new Array(a);for(let t=0;t<a;t++)e[r][t]=0;for(let a=0;a<ge[t+r].numbers.length;a++){let n=0;for(;n<ge[t+r].numbers[a].length&&0!==ge[t+r].numbers[a][n];)n++;e[r][a]=n}}for(let t=1;t<i;t++)for(let r=0;r<a;r++)if(e[t][r]!==e[0][r])return Re("Arrays are not the same shape!"),me=!1,void n()}for(let e=0;e<i;e++){let a=[],r=ge[t+e].numbers;for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let n=0;n<r[e][t];n++)a.push([e,t,n]);We(ge[t+e],a)}await o.method(t),a||(me=!1),r()}))}!function e(){K.render(Y,V),ce.push(se),ce.shift(),se=0,0!==ie&&(oe+=ie,Y.children.forEach((e=>e.rotation.y=oe)),ie*=.94,Math.abs(ie)<5e-4&&(ie=0));oe>3.14159265?oe-=6.283185301:oe<-3.14159265&&(oe+=6.283185301);N&&(N=!1,c.canvas.toBlob((e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()})));window.requestAnimationFrame(e)}(),Page.show()}();