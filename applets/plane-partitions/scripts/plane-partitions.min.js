!async function(){"use strict";Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then(()=>{Site.scripts_loaded.lodash=!0}).catch(e=>{console.error("Could not load Lodash")});let e=500;const t=.6,a=.4,r=.2,n=100;let o={renderer:"cpu",canvas_width:2e3,canvas_height:2e3,mousedown_callback:ae,touchstart_callback:ae,mousedrag_callback:re,touchmove_callback:re,mouseup_callback:ne,touchend_callback:ne},i=new Wilson(Page.element.querySelector("#numbers-canvas"),o);i.ctx.fillStyle="rgb(255, 255, 255)",Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important");let l={canvas_width:2e3,canvas_height:2e3},s=new Wilson(Page.element.querySelector("#output-canvas"),l),u=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});u.ctx.fillStyle="rgb(63, 63, 63)",u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle="rgb(127, 127, 127)",u.ctx.fillRect(4,4,56,56),u.ctx.lineWidth=6;let c=new Wilson(Page.element.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});c.ctx.fillStyle="rgb(63, 63, 63)",c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle="rgb(127, 127, 127)",c.ctx.fillRect(4,4,56,56),c.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then(()=>{Site.scripts_loaded.three=!0}).catch(e=>{console.error("Could not load THREE.js")});let h=Page.element.querySelector("#numbers-canvas-container");const f={"view-controls":Page.element.querySelectorAll(".view-controls-section"),"add-array":Page.element.querySelectorAll(".add-array-section"),"edit-array":Page.element.querySelectorAll(".edit-array-section"),"remove-array":Page.element.querySelectorAll(".remove-array-section"),algorithms:Page.element.querySelectorAll(".algorithms-section")},p=Page.element.querySelector("#category-holder"),g=Page.element.querySelector("#canvas-landscape-left");let m="view-controls";["view-controls","add-array","edit-array","remove-array","algorithms"].forEach(e=>{e!==m&&f[e].forEach(e=>{e.style.opacity=0})}),f[m].forEach(e=>g.appendChild(e)),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let d=Page.element.querySelector("#category-selector-dropdown");d.addEventListener("input",async()=>{if(await Promise.all(Array.from(f[m]).map(e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time))),f[m].forEach(e=>p.appendChild(e)),f[m].forEach(e=>e.classList.remove("move-to-left")),f[m].forEach(e=>e.classList.remove("move-to-right")),m=d.value,f[m].forEach(e=>g.appendChild(e)),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===m){let e=parseInt(x.value||0);e<J.length&&e>=0&&(v.value=ie(J[e].numbers))}f[m].forEach(e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time))});let y=Page.element.querySelector("#show-dimers-button");y.addEventListener("click",()=>{k?de():new Promise(async(t,a)=>{U?a():(k=!0,Page.Animate.change_opacity(y,0,Site.opacity_animation_time).then(()=>{y.textContent="Hide Dimers",Page.Animate.change_opacity(y,1,Site.opacity_animation_time)}),W||await pe(),U=!0,await new Promise((t,a)=>{let r={brightness:127};anime({targets:r,brightness:255,duration:e/2,easing:"easeOutQuad",complete:t,update:()=>{u.ctx.strokeStyle=`rgb(${r.brightness}, ${r.brightness}, ${r.brightness})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),R.needsUpdate=!0,c.ctx.strokeStyle=`rgb(${r.brightness}, ${r.brightness}, ${r.brightness})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(21.3,21.3),c.ctx.lineTo(42.7,42.7),c.ctx.stroke(),q.needsUpdate=!0}})}),U=!1,t())})});let w=Page.element.querySelector("#switch-view-button");w.addEventListener("click",()=>{j?pe():ge()});let b=Page.element.querySelector("#maximum-speed-checkbox");b.addEventListener("input",()=>{e=b.checked?50:500});let E=Page.element.querySelector("#array-data-textarea");E.value=function(){let e=Math.floor(3*Math.random())+4,t=Math.floor(5*Math.random())+10,a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);a[0][0]=t;for(let t=1;t<e;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++){a[t][0]=Math.max(a[t-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<e;r++)a[t][r]=Math.max(Math.min(a[t][r-1],a[t-1][r])-Math.floor(4*Math.random()),0)}let r="";for(let t=0;t<e;t++){for(let n=0;n<e;n++){let e=a[t][n];r+=0===e?"   ":e<10?` ${e} `:`${e} `}t!==e-1&&(r+="\n")}return r}(),Page.element.querySelector("#add-pp-button").addEventListener("click",()=>{let e=oe(E.value);le(e)&&ue(J.length,e,"pp")}),Page.element.querySelector("#add-tableau-button").addEventListener("click",()=>{let e=oe(E.value);ue(J.length,e,"tableau")});let v=Page.element.querySelector("#edit-array-textarea"),x=Page.element.querySelector("#edit-array-index-input");x.addEventListener("input",()=>{let e=parseInt(x.value||0);e>=J.length||e<0||(v.value=ie(J[e].numbers))}),Page.element.querySelector("#edit-array-button").addEventListener("click",function(){return new Promise(async(e,t)=>{let a=parseInt(x.value);if(a>=J.length||a<0)return void se(`No array at index ${a}`);let r=J[a],n=oe(v.value),o=r.type;("pp"!==o||le(n))&&(await ce(a),await ue(a,n,o),e())})});let P=Page.element.querySelector("#remove-array-index-input");Page.element.querySelector("#remove-array-button").addEventListener("click",()=>{ce(parseInt(P.value))});let S=Page.element.querySelector("#algorithm-index-input");Page.element.querySelector("#hillman-grassl-button").addEventListener("click",()=>{!async function(t){if(G)return;if(G=!0,t>=J.length||t<0)return se(`No array at index ${t}`),void(G=!1);let a=J[t];if("pp"!==a.type)return se(`Array at index ${t} is not a plane partition!`),void(G=!1);let r=_.cloneDeep(a.numbers),n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);Ee(a,n);let o=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;o[e]=t}let i=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;i[e]=t}let l=[];for(;;){let e=r[0].length-1;for(;e>=0&&o[e]<r.length&&0===r[o[e]][e];)e--;if(e<0||o[e]===r.length)break;let t=o[e],a=e,n=[[t,a,r[t][a]-1]];for(;;){if(t<r.length-1&&r[t+1][a]===r[t][a])t++;else{if(!(a>0&&r[t][a-1]!==1/0))break;a--}n.push([t,a,r[t][a]-1])}for(let e=0;e<n.length;e++)r[n[e][0]][n[e][1]]--;l.push(n)}let s=new Array(r.length);for(let e=0;e<r.length;e++){s[e]=new Array(r.length);for(let t=0;t<r.length;t++)s[e][t]=r[e][t]===1/0?1/0:0}let u=await ue(t+1,s,"tableau");await new Promise((t,a)=>setTimeout(t,e));for(let t=0;t<l.length;t++){let r=t/l.length*6/7;await _e(a,l[t],r),await ve(a,l[t],a.height);let n=K-a.partial_footprint_sum-1,s=a.partial_footprint_sum-a.footprint;for(let e=0;e<l[t].length;e++)a.numbers[l[t][e][0]][l[t][e][1]]--,j&&be(a,l[t][e][0],l[t][e][1],n,s);ye(a),await new Promise((t,a)=>setTimeout(t,e/5));let c=[l[t][l[t].length-1][0],l[t][0][1]],h=[],f=u.height+1;for(let e=o[c[1]];e<=c[0];e++)h.push([e,c[1],f]);let p=h[h.length-1];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);await Pe(a,l[t],u,h),h=[];for(let e=c[0]-1;e>=o[c[1]];e--)h.push([e,c[1],f]);Me(u,h),h=[];for(let e=c[1]-1;e>=i[c[0]];e--)h.push([c[0],e,f]);Me(u,h),await xe(u,[p]),n=K-u.partial_footprint_sum-1,s=u.partial_footprint_sum-u.footprint,u.numbers[p[0]][p[1]]++,ye(u),j&&be(u,p[0],p[1],n,s),u.height=Math.max(u.height,u.numbers[p[0]][p[1]]),u.size=Math.max(u.size,u.height),await new Promise((t,a)=>setTimeout(t,e))}ce(t),G=!1}(parseInt(S.value))}),Page.element.querySelector("#hillman-grassl-inverse-button").addEventListener("click",()=>{!async function(t){if(G)return;if(G=!0,t>=J.length||t<0)return se(`No array at index ${t}`),void(G=!1);let r=J[t];if("tableau"!==r.type)return se(`Array at index ${t} is not a tableau!`),void(G=!1);let n=_.cloneDeep(r.numbers),o=[],i=[];for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++)if(n[e][t]!==1/0)for(let a=0;a<n[e][t];a++)i.push([e,t,a]);Ee(r,i);let l=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;l[e]=t}let s=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;s[e]=t}let u=new Array(n.length);for(let e=0;e<n.length;e++){u[e]=new Array(n.length);for(let t=0;t<n.length;t++)u[e][t]=n[e][t]===1/0?1/0:0}let c=_.cloneDeep(u),h=await ue(t+1,u,"pp");for(let e=0;e<n.length;e++)for(let t=n.length-1;t>=l[e];t--)for(;0!==n[t][e];){let a=[],r=t,i=s[t];for(;r>=0;){let t=i;if(0!==r)for(;c[r][t]!==c[r-1][t]&&t<e;)t++;else t=e;for(let e=i;e<=t;e++)a.push([r,e,c[r][e]]);if(!(r-1>=l[t]))break;r--,i=t}for(let e=0;e<a.length;e++)c[a[e][0]][a[e][1]]++;o.push([a,[t,e,n[t][e]-1]]),n[t][e]--}await new Promise((t,a)=>setTimeout(t,e/2));for(let t=0;t<o.length;t++){let n=t/o.length*6/7;await _e(r,[o[t][1]],n);let i=o[t][1][0],u=o[t][1][1],c=r.size;for(let e=l[u];e<i;e++)r.cubes[e][u][c]=he(r,u,c,e),r.cubes[e][u][c].material.forEach(e=>e.color.setHSL(n,1,a));for(let e=s[i];e<u;e++)r.cubes[i][e][c]=he(r,e,c,i),r.cubes[i][e][c].material.forEach(e=>e.color.setHSL(n,1,a));await ve(r,[o[t][1]],c);let f=[];for(let e=i-1;e>=l[u];e--)f.push([e,u,c]);let p=Se(r,f);f=[];for(let e=u-1;e>=s[i];e--)f.push([i,e,c]);let g=Se(r,f);await Promise.all([p,g]),f=[];for(let e=s[i];e<u;e++)f.push([i,e,c]);f.push([i,u,r.numbers[i][u]-1]);for(let e=i-1;e>=l[u];e--)f.push([e,u,c]);let m=o[t][0],d=h.height+1;if(m.forEach(e=>e[2]=d),r.numbers[i][u]--,ye(r),j){let e=K-r.partial_footprint_sum-1,t=r.partial_footprint_sum-r.footprint;be(r,i,u,e,t)}if(await Pe(r,f,h,m),await xe(h,m),m.forEach(e=>{h.numbers[e[0]][e[1]]++}),ye(h),j){let e=K-h.partial_footprint_sum-1,t=h.partial_footprint_sum-h.footprint;m.forEach(a=>{be(h,a[0],a[1],e,t)})}await new Promise((t,a)=>setTimeout(t,e/2))}ce(t),G=!1,console.log("hi!")}(parseInt(S.value))}),Page.element.querySelector("#pak-button").addEventListener("click",()=>{!async function(t){if(G)return;if(G=!0,t>=J.length||t<0)return se(`No array at index ${t}`),void(G=!1);let a=J[t];if("pp"!==a.type)return se(`Array at index ${t} is not a plane partition!`),void(G=!1);let r=a.numbers;j||await ge();let n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);await Ee(a,n);let o=a.footprint*a.footprint,i=0;for(let t=0;t<a.footprint;t++)for(let n=0;n<a.footprint;n++){if(r[t][n]===1/0){let r=a.cubes[t][n].map((e,a)=>[t,n,a]);await Me(a,r,!0),Te(a,[[t,n]]),a.cubes[t][n]=[],await new Promise((t,a)=>setTimeout(t,e));continue}let l=[],s=0;for(;t+s<a.footprint&&n+s<a.footprint;)l.push([t+s,n+s,r[t+s][n+s]-1]),s++;s=l[0][0];let u=l[0][1],c=[];for(let e=r[s][u]-2;e>=0;e--)c.push([s,u,e]);_e(a,c,i/o*6/7),c=[],l.forEach(e=>{e[2]>=0&&c.push(e)}),await _e(a,c,i/o*6/7);let h=new Array(l.length);l.forEach((e,t)=>{let n=e[0],o=e[1],i=0,l=0;n<a.footprint-1&&(i=r[n+1][o]),o<a.footprint-1&&(l=r[n][o+1]),h[t]=Math.max(i,l),t>0?(i=r[n-1][o],l=r[n][o-1],h[t]+=Math.min(i,l)-r[n][o]):h[t]=r[n][o]-h[t]});for(let e=0;e<l.length;e++){if(s=l[e][0],u=l[e][1],h[e]>r[s][u]){let t=[];for(let n=r[s][u];n<h[e];n++)a.cubes[s][u][n]=he(a,u,n,s),t.push([s,u,n]);j?Se(a,t):await Se(a,t)}else if(h[e]<r[s][u]){let t=[];for(let a=r[s][u]-1;a>=h[e];a--)t.push([s,u,a]);j?Me(a,t):await Me(a,t)}if(r[s][u]=h[e],j){let e=K-a.partial_footprint_sum-1,t=a.partial_footprint_sum-a.footprint;be(a,s,u,e,t)}}let f=[];c.forEach((e,t)=>{0!==t&&e[2]<r[e[0]][e[1]]&&f.push(e)}),j?Ee(a,f):await Ee(a,f),i++,ye(a),0!==c.length&&await new Promise((t,a)=>setTimeout(t,e))}me(!0),a.type="tableau",G=!1}(parseInt(S.value))}),Page.element.querySelector("#pak-inverse-button").addEventListener("click",()=>{!async function(r){if(G)return;if(G=!0,r>=J.length||r<0)return se(`No array at index ${r}`),void(G=!1);let o=J[r];if("tableau"!==o.type)return se(`Array at index ${r} is not a tableau!`),void(G=!1);let i=o.numbers;j||await ge();let l=[];for(let e=0;e<i.length;e++)for(let t=0;t<i.length;t++)if(i[e][t]!==1/0)for(let a=0;a<i[e][t];a++)l.push([e,t,a]);await Ee(o,l);let s=o.footprint*o.footprint,u=0;for(let r=o.footprint-1;r>=0;r--)for(let l=o.footprint-1;l>=0;l--){if(i[r][l]===1/0){o.cubes[r][l]=new Array(n);let a=[];for(let e=0;e<n;e++)o.cubes[r][l][e]=he(o,l,e,r,0,0,t),o.cubes[r][l][e].material.forEach(e=>a.push(e));o.floor[r][l]=fe(o,l,r),o.floor[r][l].material.forEach(e=>a.push(e)),await new Promise((t,r)=>{anime({targets:a,opacity:1,duration:e,easing:"easeOutQuad",complete:t})}),await new Promise((t,a)=>setTimeout(t,e));continue}let c=[],h=0;for(;r+h<o.footprint&&l+h<o.footprint;)c.push([r+h,l+h,i[r+h][l+h]-1]),h++;h=c[0][0];let f=c[0][1],p=new Array(c.length),g=!1;if(c.forEach((e,t)=>{let a=e[0],r=e[1],n=0,l=0;a<o.footprint-1&&(n=i[a+1][r]),r<o.footprint-1&&(l=i[a][r+1]),p[t]=Math.max(n,l),t>0?(n=i[a-1][r],l=i[a][r-1],p[t]+=Math.min(n,l)-i[a][r]):p[t]+=i[a][r],g||p[t]===i[a][r]||(g=!0)}),0!==i[h][f]){let e=[];for(let t=i[h][f]-1;t>=0;t--)e.push([h,f,t]);_e(o,e,u/s*6/7)}else if(0!==p[0])o.cubes[h][f][0]=he(o,f,0,h,u/s*6/7,1,a),i[h][f]=1,Se(o,[[h,f,0]]);else if(!g){u++;continue}await new Promise((t,a)=>setTimeout(t,e));for(let e=0;e<c.length;e++){if(h=c[e][0],f=c[e][1],p[e]>i[h][f]){let t=[];for(let r=i[h][f];r<p[e];r++)o.cubes[h][f][r]=he(o,f,r,h,u/s*6/7,1,a),t.push([h,f,r]);j?Se(o,t):await Se(o,t)}else if(p[e]<i[h][f]){let t=[];for(let a=i[h][f]-1;a>=p[e];a--)t.push([h,f,a]);j?Me(o,t):await Me(o,t)}if(i[h][f]=p[e],j){let e=K-o.partial_footprint_sum-1,t=o.partial_footprint_sum-o.footprint;be(o,h,f,e,t)}}u++,ye(o),await new Promise((t,a)=>setTimeout(t,e))}me(!0),o.type="pp",G=!1}(parseInt(S.value))}),Page.element.querySelector("#sulzgruber-button").addEventListener("click",()=>{!async function(t){if(G)return;if(G=!0,t>=J.length||t<0)return se(`No array at index ${t}`),void(G=!1);let a=J[t];if("pp"!==a.type)return se(`Array at index ${t} is not a plane partition!`),void(G=!1);let r=_.cloneDeep(a.numbers),n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);Ee(a,n);let o=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;o[e]=t}let i=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;i[e]=t}let l={},s={};for(let e=0;e<r.length;e++)s[-e]=[e,0];for(let e=1;e<r.length;e++)s[e]=[0,e];for(let e=1-r.length;e<r.length;e++){let t=s[e][0],a=s[e][1];for(;t<r.length&&a<r.length&&r[t][a]===1/0;)t++,a++;if(s[e]=[t,a],t===r.length||a===r.length){l[e]=-1;continue}let n=0===a||r[t][a-1]===1/0,o=0===t||r[t-1][a]===1/0;l[e]=n&&o?0:n?3:o?2:1}let u=[];for(let e=1-r.length;e<r.length;e++){if(1===l[e]||3===l[e])continue;let t=s[e][0],a=s[e][1];if(0!==r[t][a])for(;;){let n=!1;for(;t<r.length&&a<r.length&&0!==r[t][a];){if((a<r.length-1&&r[t][a]>r[t][a+1]||a===r.length-1&&r[t][a]>0)&&(0===l[e]||2===l[e]&&(t<r.length-1&&r[t][a]>r[t+1][a]||t===r.length-1&&r[t][a]>0))){n=!0;break}t++,a++}if(!n)break;let o=t,s=a,c=[[o,s,r[o][s]-1]];for(;;){let e=s-o;if(o<r.length-1&&r[o][s]===r[o+1][s]&&(0===l[e]||3===l[e]))o++;else{if(!(s>i[o]&&(o===r.length-1||o<r.length-1&&r[o][s]>r[o+1][s])))break;s--}c.push([o,s,r[o][s]-1])}c.forEach(e=>r[e[0]][e[1]]--),u.push(c)}}let c=new Array(r.length);for(let e=0;e<r.length;e++){c[e]=new Array(r.length);for(let t=0;t<r.length;t++)c[e][t]=r[e][t]===1/0?1/0:0}let h=await ue(t+1,c,"tableau");await new Promise((t,a)=>setTimeout(t,e));for(let t=0;t<u.length;t++){let r=t/u.length*6/7;await _e(a,u[t],r),await ve(a,u[t],a.height+1);let n=K-a.partial_footprint_sum-1,l=a.partial_footprint_sum-a.footprint;u[t].forEach(e=>{a.numbers[e[0]][e[1]]--,j&&be(a,e[0],e[1],n,l)}),ye(a),await new Promise((t,a)=>setTimeout(t,e/5));let c=u[t][u[t].length-1][0],f=u[t][u[t].length-1][1]-c,p=f+u[t].length-1,g=s[p][1],m=[],d=Math.max(a.height+1,h.height+1);for(let e=o[g];e<=c;e++)m.push([e,g,d]);for(let e=g-1;e>=i[c];e--)m.push([c,e,d]);await Pe(a,u[t],h,m),m=[];for(let e=c-1;e>=o[g];e--)m.push([e,g,d]);Me(h,m),m=[];for(let e=g-1;e>=i[c];e--)m.push([c,e,d]);Me(h,m),await xe(h,[[c,g,d]]),n=K-h.partial_footprint_sum-1,l=h.partial_footprint_sum-h.footprint,h.numbers[c][g]++,j&&be(h,c,g,n,l),ye(h),await new Promise((t,a)=>setTimeout(t,e))}ce(t),G=!1}(parseInt(S.value))}),Page.element.querySelector("#sulzgruber-inverse-button").addEventListener("click",()=>{!async function(t){if(G)return;if(G=!0,t>=J.length||t<0)return se(`No array at index ${t}`),void(G=!1);let r=J[t];if("tableau"!==r.type)return se(`Array at index ${t} is not a tableau!`),void(G=!1);let n=r.numbers,o=[];for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++)if(n[e][t]!==1/0)for(let a=0;a<n[e][t];a++)o.push([e,t,a]);Ee(r,o);let i=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;i[e]=t}let l=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;l[e]=t}let s={};for(let e=0;e<n.length;e++)s[-e]=[e,0];for(let e=1;e<n.length;e++)s[e]=[0,e];for(let e=1-n.length;e<n.length;e++){let t=s[e][0],a=s[e][1];for(;t<n.length&&a<n.length&&n[t][a]===1/0;)t++,a++;s[e]=[t,a]}let u=0,c=new Array(n.length);for(let e=0;e<n.length;e++){c[e]=new Array(n.length);for(let t=0;t<n.length;t++)n[e][t]===1/0?c[e][t]=1/0:(c[e][t]=0,u+=n[e][t])}let h=await ue(t+1,c,"pp"),f=(h.numbers,0);for(let t=n.length-1;t>=0;t--)for(let o=n.length-1;o>=0;o--)if(n[o][t]!==1/0)for(;0!==n[o][t];){let c=f/u*6/7,p=Math.max(r.size+1,h.size+1);await _e(r,[[o,t,n[o][t]-1]],c),await ve(r,[[o,t,n[o][t]-1]],p);let g=o,m=t;for(let e=i[m];e<g;e++)r.cubes[e][m][p]=he(r,m,p,e),r.cubes[e][m][p].material.forEach(e=>e.color.setHSL(c,1,a));for(let e=l[g];e<m;e++)r.cubes[g][e][p]=he(r,e,p,g),r.cubes[g][e][p].material.forEach(e=>e.color.setHSL(c,1,a));let d=[];for(let e=g-1;e>=i[m];e--)d.push([e,m,p]);let y=Se(r,d);d=[];for(let e=m-1;e>=l[g];e--)d.push([g,e,p]);let w=Se(r,d);await Promise.all([y,w]),d=[];for(let e=l[g];e<m;e++)d.push([g,e,p]);d.push([g,m,r.numbers[g][m]-1]);for(let e=g-1;e>=i[m];e--)d.push([e,m,p]);let b=l[g]-g,E=b+d.length-1,v=[];for(let e=b;e<=E;e++)v.push(_.clone(s[e]));if(n[g][m]--,ye(r),j){let e=K-r.partial_footprint_sum-1,t=r.partial_footprint_sum-r.footprint;be(r,g,m,e,t)}await Pe(r,d,h,v);let x=0,P=h.numbers[v[0][0]][v[0][1]];for(;;){let e=x;for(;e<v.length&&v[e][0]===v[x][0];)e++;d=v.slice(x,e);let t=!0;for(let e=0;e<d.length;e++)if(h.numbers[d[e][0]][d[e][1]]!==P){t=!1;break}if(t){if(await xe(h,d),d.forEach(e=>h.numbers[e[0]][e[1]]++),ye(h),j){let e=K-h.partial_footprint_sum-1,t=h.partial_footprint_sum-h.footprint;d.forEach(a=>{be(h,a[0],a[1],e,t)})}x=e}else{let e=_.cloneDeep(v.slice(x));for(let e=x;e<v.length;e++)if(v[e][0]++,v[e][1]++,v[e][0]>h.footprint||v[e][1]>h.footprint)return void console.error("Insertion failed!");let t=v.slice(x);await Pe(h,e,h,t),P=h.numbers[v[x][0]][v[x][1]]}if(x===v.length)break}f++,await new Promise((t,a)=>setTimeout(t,e/2))}ce(t),G=!1}(parseInt(S.value))});let M=!1;Page.element.querySelector("#download-button").addEventListener("click",()=>{M=!0});const T=new THREE.Scene,A=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),L=new THREE.WebGLRenderer({canvas:s.canvas,antialias:!0});L.setSize(2e3,2e3,!1);new THREE.TextureLoader;const R=new THREE.CanvasTexture(u.canvas);R.minFilter=THREE.LinearFilter,R.magFilter=THREE.NearestFilter;const q=new THREE.CanvasTexture(c.canvas);q.minFilter=THREE.LinearFilter,q.magFilter=THREE.NearestFilter;const H=new THREE.BoxGeometry;let k=!1;const $=new THREE.BoxGeometry(1,.001,1),O=new THREE.AmbientLight(16777215,.2);T.add(O);const z=new THREE.PointLight(16777215,3,1e4);z.position.set(750,1e3,500),T.add(z);let I=0,Q=0,C=0,B=[];const D=.94,F=.005,N=5e-4;let j=!1,W=!0,U=!1,G=!1,V=10,J=[],K=0,X=0,Y=0,Z=[15,15,15],ee=[0,20,0],te=oe(E.value);function ae(e,t,a){W=!1,Q=0,B=[0,0,0,0]}function re(e,t,a,r,n){j||((I+=a)>3.14159265?I-=6.283185301:I<-3.14159265&&(I+=6.283185301),T.children.forEach(e=>e.rotation.y=I),C=a)}function ne(e,t,a){if(!j){let e=0;if(B.forEach((t,a)=>{Math.abs(t)>Q&&(Q=Math.abs(t),e=a)}),Q<F)return void(Q=0);Q=B[e]}B=[0,0,0,0]}function oe(e){let t=e.split("\n"),a=t.length,r=new Array(t.length);for(let e=0;e<r.length;e++){r[e]=t[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let n=r[0].length,o=Math.max(a,n),i=new Array(o);for(let e=0;e<a;e++){i[e]=new Array(o);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?i[e][t]=1/0:i[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<o;t++)i[e][t]=0}for(let e=a;e<o;e++){i[e]=new Array(o);for(let t=0;t<o;t++)i[e][t]=0}return i}function ie(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let a="";for(let r=0;r<e.length;r++){for(let n=0;n<e.length;n++)if(e[r][n]===1/0){for(let e=0;e<t-1-(0===n);e++)a+=" ";a+="^"}else{let o=`${e[r][n]}`.length;for(let e=0;e<t-o-(0===n);e++)a+=" ";a+=e[r][n]}r!==e.length-1&&(a+="\n")}return a}function le(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return se(`Not a valid plane partition! Wrong inequality at (${t}, ${a})`),!1;return!0}function se(e){Page.Footer.Floating.show_settings_text(e)}function ue(a,r,o){return new Promise(async(i,l)=>{let s={type:o,numbers:r,cubes:[],floor:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};j&&await Page.Animate.change_opacity(h,0,e/5),J.splice(a,0,s),s.footprint=s.numbers.length;for(let t=a;t<J.length;t++)J[t].partial_footprint_sum=J[t].footprint,0!==t?(J[t].center_offset=J[t-1].center_offset+J[t-1].footprint/2+J[t].footprint/2+1,J[t].partial_footprint_sum+=J[t-1].partial_footprint_sum+1):J[t].center_offset=0,t!==a&&anime({targets:J[t].cube_group.position,x:J[t].center_offset,y:0,z:-J[t].center_offset,duration:e,easing:"easeInOutQuad"});s.cube_group=new THREE.Object3D,T.add(s.cube_group),s.cube_group.position.set(s.center_offset,0,-s.center_offset),s.cube_group.rotation.y=I,s.cubes=new Array(s.footprint),s.floor=new Array(s.footprint);for(let e=0;e<s.footprint;e++){s.cubes[e]=new Array(s.footprint),s.floor[e]=new Array(s.footprint);for(let a=0;a<s.footprint;a++)if(s.numbers[e][a]!==1/0){s.cubes[e][a]=new Array(s.numbers[e][a]),s.numbers[e][a]>s.height&&(s.height=s.numbers[e][a]),s.floor[e][a]=fe(s,a,e);for(let t=0;t<s.numbers[e][a];t++)s.cubes[e][a][t]=he(s,a,t,e)}else if("tableau"!==o){s.cubes[e][a]=new Array(n),s.floor[e][a]=fe(s,a,e);for(let r=0;r<n;r++)s.cubes[e][a][r]=he(s,a,r,e,0,0,t)}}s.size=Math.max(s.footprint,s.height),K+=s.footprint+1,X=Math.max(X,s.height),Y=Math.max(K,X),1===J.length?(Z=[Y,Y+X/3,Y],ee=[0,Y+10,0],A.left=-Y,A.right=Y,A.top=Y,A.bottom=-Y,A.position.set(Z[0],Z[1],Z[2]),A.rotation.set(-.785398163,.615479709,.523598775),A.updateProjectionMatrix()):me(!0),a!==J.length-1&&await new Promise((t,a)=>setTimeout(t,e));let u=[];s.cube_group.traverse(e=>{e.material&&e.material.forEach(e=>u.push(e))}),await new Promise(async(t,a)=>{anime({targets:u,opacity:1,duration:e/2,easing:"easeOutQuad",complete:t})}),j&&(draw_all_2d_text(),await Page.Animate.change_opacity(h,1,e/5)),i(s)})}function ce(t){return new Promise(async(a,r)=>{if(t>=J.length||t<0)se(`No array at index ${t}`);else{j&&await Page.Animate.change_opacity(h,0,e/5),await new Promise((a,r)=>{let n=[];J[t].cube_group.traverse(e=>{e.material&&e.material.forEach(e=>n.push(e))}),anime({targets:n,opacity:0,duration:e/2,easing:"easeOutQuad",complete:a})});for(let e=0;e<J[t].cubes.length;e++)for(let a=0;a<J[t].cubes[e].length;a++)if(J[t].cubes[e][a])for(let r=0;r<J[t].cubes[e][a].length;r++)J[t].cubes[e][a][r]&&J[t].cubes[e][a][r].material.forEach(e=>e.dispose());T.remove(J[t].cube_group),K-=J[t].footprint+1,J.splice(t,1);for(let a=t;a<J.length;a++)J[a].partial_footprint_sum=J[a].footprint,0!==a?(J[a].center_offset=J[a-1].center_offset+J[a-1].footprint/2+J[a].footprint/2+1,J[a].partial_footprint_sum+=J[a-1].partial_footprint_sum+1):J[a].center_offset=0,anime({targets:J[a].cube_group.position,x:J[a].center_offset,y:0,z:-J[a].center_offset,duration:e,easing:"easeInOutQuad"});0!==J.length&&me(!0),a()}})}function he(e,t,r,n,o=0,i=0,l=a){const s=[new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0})];s.forEach(e=>e.color.setHSL(o,i,l));const u=new THREE.Mesh(H,s);return e.cube_group.add(u),u.position.set(t-(e.footprint-1)/2,r,n-(e.footprint-1)/2),u}function fe(e,t,a,n=0,o=0,i=r){const l=[new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:R,transparent:!0,opacity:0})];l.forEach(e=>e.color.setHSL(n,o,i));const s=new THREE.Mesh($,l);return e.cube_group.add(s),s.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),s}function pe(){return new Promise(async(t,a)=>{U?a():(Page.Animate.change_opacity(w,0,Site.opacity_animation_time).then(()=>{w.textContent="Show 2D View",Page.Animate.change_opacity(w,1,Site.opacity_animation_time)}),U=!0,j&&await Page.Animate.change_opacity(h,0,e/5),j=!1,W=!0,Q=0,B=[0,0,0,0],me(!0),anime({targets:A.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:e,easing:"easeInOutQuad",complete:()=>{U=!1,t()}}),J.forEach(t=>{anime({targets:t.cube_group.rotation,y:0,duration:e,easing:"easeInOutQuad"})}),I=0)})}function ge(){return new Promise(async(t,a)=>{U||j?a():(Page.Animate.change_opacity(w,0,Site.opacity_animation_time).then(()=>{w.textContent="Show 3D View",Page.Animate.change_opacity(w,1,Site.opacity_animation_time)}),k&&await de(),U=!0,j=!0,W=!1,Q=0,B=[0,0,0,0],me(!0),anime({targets:A.rotation,x:-1.570796327,y:0,z:0,duration:e,easing:"easeInOutQuad"}),J.forEach(t=>{anime({targets:t.cube_group.rotation,y:0,duration:e,easing:"easeInOutQuad"})}),setTimeout(()=>{we(),Page.Animate.change_opacity(h,1,e/5).then(()=>{U=!1,t()})},e))})}function me(t=!1){if(!t){if(U)return;U=!0}X=0;for(let e=0;e<J.length;e++)X=Math.max(X,J[e].height);Y=Math.max(K,X);let a=(-J[0].footprint/2+J[J.length-1].center_offset+J[J.length-1].footprint/2)/2;Z=[Y+a,Y+X/3,Y-a],ee=[a,Y+10,-a],j?(anime({targets:A.position,x:ee[0],y:ee[1],z:ee[2],duration:e,easing:"easeInOutQuad"}),anime({targets:A,left:-(K/2+.5),right:K/2+.5,top:K/2+.5,bottom:-(K/2+.5),duration:e,easing:"easeInOutQuad",update:()=>A.updateProjectionMatrix(),complete:()=>U=!1}),setTimeout(()=>{we(),Page.Animate.change_opacity(h,1,e/5)},e)):(anime({targets:A.position,x:Z[0],y:Z[1],z:Z[2],duration:e,easing:"easeInOutQuad"}),anime({targets:A,left:-Y,right:Y,top:Y,bottom:-Y,duration:e,easing:"easeInOutQuad",update:()=>A.updateProjectionMatrix(),complete:()=>U=!1}))}function de(){return new Promise(async(t,a)=>{U?a():(k=!1,Page.Animate.change_opacity(y,0,Site.opacity_animation_time).then(()=>{y.textContent="Show Dimers",Page.Animate.change_opacity(y,1,Site.opacity_animation_time)}),U=!0,await new Promise((t,a)=>{let r={brightness:255};anime({targets:r,brightness:127,duration:e/2,easing:"easeOutQuad",complete:t,update:()=>{u.ctx.strokeStyle=`rgb(${r.brightness}, ${r.brightness}, ${r.brightness})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),R.needsUpdate=!0,c.ctx.strokeStyle=`rgb(${r.brightness}, ${r.brightness}, ${r.brightness})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(21.3,21.3),c.ctx.lineTo(42.7,42.7),c.ctx.stroke(),q.needsUpdate=!0}})}),U=!1,t())})}function ye(e){e.height=0,e.numbers.forEach(t=>{t.forEach(t=>{t!==1/0&&(e.height=Math.max(t,e.height))})}),e.size=Math.max(e.footprint,e.height);let t=X;X=0,J.forEach(e=>X=Math.max(e.height,X)),Y=Math.max(K,X),X!==t&&me()}function we(){V=i.canvas_width/(K+1);let e=Math.max(`${X}`.length,2);i.ctx.font=`${V/e}px monospace`,i.ctx.clearRect(0,0,i.canvas_width,i.canvas_height),J.forEach(e=>{let t=K-e.partial_footprint_sum-1,a=e.partial_footprint_sum-e.footprint;for(let r=0;r<e.footprint;r++)for(let n=0;n<e.footprint;n++)be(e,r,n,t,a)})}function be(e,t,a,r,n){if(i.ctx.clearRect(V*(a+n+1),V*(t+r+1),V,V),e.numbers[t][a]!==1/0){let o=i.ctx.measureText(e.numbers[t][a]);i.ctx.fillText(e.numbers[t][a],V*(a+n+1)+(V-o.width)/2,V*(t+r+1)+(V+o.actualBoundingBoxAscent-o.actualBoundingBoxDescent)/2)}}function _e(t,r,n){return new Promise((o,i)=>{if(0===r.length)return void o();let l=[];r.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(e=>l.push(e.color))}),l.forEach(e=>e.getHSL(e)),anime({targets:l,s:1,duration:e,delay:(t,a)=>Math.floor(a/6)*e/10,easing:"easeOutQuad",update:()=>l.forEach(e=>e.setHSL(n,e.s,a)),complete:o})})}function Ee(t,r){return new Promise((n,o)=>{let i=[];r.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(e=>i.push(e.color))}),i.forEach(e=>e.getHSL(e)),anime({targets:i,s:0,duration:e,easing:"easeOutQuad",update:()=>i.forEach(e=>e.setHSL(e.h,e.s,a)),complete:n})})}function ve(t,a,r){return new Promise((n,o)=>{let i=j?0:e,l=[];a.forEach(e=>{l.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),anime({targets:l,y:r,duration:i,easing:"easeInOutQuad",complete:n})})}function xe(t,a){return new Promise((r,n)=>{let o=j?0:e,i=[];a.forEach(e=>{i.push(t.cubes[e[0]][e[1]][e[2]].position),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),anime({targets:i,y:(e,r)=>t.numbers[a[r][0]][a[r][1]],duration:o,easing:"easeInOutQuad",complete:()=>{a.forEach(e=>{t.cubes[e[0]][e[1]][t.numbers[e[0]][e[1]]]=t.cubes[e[0]][e[1]][e[2]],t.cubes[e[0]][e[1]][e[2]]=null}),r()}})})}function Pe(t,a,r,n){return new Promise((o,i)=>{let l=[];a.forEach(e=>{l.push(t.cubes[e[0]][e[1]][e[2]].position),r.cube_group.attach(t.cubes[e[0]][e[1]][e[2]]),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),anime({targets:l,x:(e,t)=>n[t][1]-(r.footprint-1)/2,y:(e,t)=>n[t][2],z:(e,t)=>n[t][0]-(r.footprint-1)/2,duration:e,easing:"easeInOutQuad",complete:()=>{n.forEach((e,n)=>{r.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[e[0]][e[1]][e[2]]&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),r.cubes[e[0]][e[1]][e[2]]=t.cubes[a[n][0]][a[n][1]][a[n][2]],t.cubes[a[n][0]][a[n][1]][a[n][2]]=null}),o()}})})}function Se(t,a){return new Promise((r,n)=>{if(0===a.length)return void r();let o=[];a.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(e=>o.push(e)),t.numbers[e[0]][e[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),anime({targets:o,opacity:1,duration:e/2,delay:(t,a)=>Math.floor(a/6)*e/10,easing:"easeOutQuad",complete:r})})}function Me(t,a,r=!1){return new Promise((n,o)=>{let i=[];a.forEach(e=>{t.cubes[e[0]][e[1]][e[2]].material.forEach(e=>i.push(e))}),anime({targets:i,opacity:0,duration:e/2,delay:(t,a)=>!r*Math.floor(a/6)*e/10,easing:"easeOutQuad",complete:()=>{i.forEach(e=>e.dispose()),a.forEach(e=>{t.cube_group.remove(t.cubes[e[0]][e[1]][e[2]]),t.cubes[e[0]][e[1]][e[2]]=null}),n()}})})}function Te(t,a){return new Promise((r,n)=>{let o=[];a.forEach(e=>{t.floor[e[0]][e[1]].material.forEach(e=>o.push(e))}),anime({targets:o,opacity:0,duration:e/2,easing:"easeOutQuad",complete:()=>{o.forEach(e=>e.dispose()),a.forEach(e=>{t.cube_group.remove(t.floor[e[0]][e[1]]),t.cubes[e[0]][e[1]]=null}),r()}})})}v.value=E.value,le(te)&&ue(J.length,te,"pp"),function e(){L.render(T,A);B.push(C);B.shift();C=0;0!==Q&&(I+=Q,T.children.forEach(e=>e.rotation.y=I),Q*=D,Math.abs(Q)<N&&(Q=0));I>3.14159265?I-=6.283185301:I<-3.14159265&&(I+=6.283185301);M&&(M=!1,s.canvas.toBlob(e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()}));window.requestAnimationFrame(e)}(),Page.show()}();