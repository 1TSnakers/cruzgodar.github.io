!async function(){"use strict";Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then((()=>{Site.scripts_loaded.lodash=!0})).catch((e=>{console.error("Could not load Lodash")}));let e=2e3,t=600;const a=.4,r=100;let n={renderer:"cpu",canvas_width:e,canvas_height:e,mousedown_callback:re,touchstart_callback:re,mousedrag_callback:ne,touchmove_callback:ne,mouseup_callback:oe,touchend_callback:oe},o=new Wilson(Page.element.querySelector("#numbers-canvas"),n);o.ctx.fillStyle="rgb(255, 255, 255)",Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important");let l={canvas_width:e,canvas_height:e},i=new Wilson(Page.element.querySelector("#output-canvas"),l),s=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});s.ctx.strokeStyle="rgb(255, 255, 255)",s.ctx._alpha=1,s.ctx.fillStyle="rgba(64, 64, 64, 1)",s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle="rgba(128, 128, 128, 1)",s.ctx.fillRect(4,4,56,56),s.ctx.lineWidth=6;let c=new Wilson(Page.element.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});c.ctx.strokeStyle="rgb(255, 255, 255)",c.ctx._alpha=1,c.ctx.fillStyle="rgba(64, 64, 64, 1)",c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle="rgba(128, 128, 128, 1)",c.ctx.fillRect(4,4,56,56),c.ctx.lineWidth=6;let u=new Wilson(Page.element.querySelector("#hidden-canvas-3"),{renderer:"cpu",canvas_width:64,canvas_height:64});u.ctx.strokeStyle="rgb(255, 255, 255)",u.ctx._alpha=1,u.ctx.fillStyle="rgba(32, 32, 32, 1)",u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle="rgba(64, 64, 64, 1)",u.ctx.fillRect(4,4,56,56),u.ctx.lineWidth=6;let f=new Wilson(Page.element.querySelector("#hidden-canvas-4"),{renderer:"cpu",canvas_width:64,canvas_height:64});f.ctx.strokeStyle="rgb(255, 255, 255)",f.ctx._alpha=1,f.ctx.fillStyle="rgb(32, 32, 32)",f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle="rgb(64, 64, 64)",f.ctx.fillRect(4,4,56,56),f.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then((()=>{Site.scripts_loaded.three=!0})).catch((e=>{console.error("Could not load THREE.js")}));let h=Page.element.querySelector("#numbers-canvas-container");const p={"view-controls":Page.element.querySelectorAll(".view-controls-section"),"add-array":Page.element.querySelectorAll(".add-array-section"),"edit-array":Page.element.querySelectorAll(".edit-array-section"),"remove-array":Page.element.querySelectorAll(".remove-array-section"),algorithms:Page.element.querySelectorAll(".algorithms-section"),examples:Page.element.querySelectorAll(".examples-section")},m=Page.element.querySelector("#category-holder"),g=Page.element.querySelector("#canvas-landscape-left");let d="view-controls";["view-controls","add-array","edit-array","remove-array","algorithms"].forEach((e=>{e!==d&&p[e].forEach((e=>{e.style.opacity=0}))})),p[d].forEach((e=>g.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let w=Page.element.querySelector("#category-selector-dropdown");w.addEventListener("input",(async()=>{if(await Promise.all(Array.from(p[d]).map((e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time)))),p[d].forEach((e=>m.appendChild(e))),p[d].forEach((e=>e.classList.remove("move-to-left"))),p[d].forEach((e=>e.classList.remove("move-to-right"))),d=w.value,p[d].forEach((e=>g.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===d){let e=parseInt(P.value||0);e<V.length&&e>=0&&(S.value=se(V[e].numbers))}p[d].forEach((e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time)))}));let y=Page.element.querySelector("#resolution-input");y.addEventListener("input",(()=>{e=parseInt(y.value||2e3),L.setSize(e,e,!1)}));let b=Page.element.querySelector("#show-dimers-button");b.addEventListener("click",(()=>{O?be():new Promise((async(e,a)=>{if(Y)return void a();O=!0,Page.Animate.change_opacity(b,0,Site.opacity_animation_time).then((()=>{b.textContent="Hide Dimers",Page.Animate.change_opacity(b,1,Site.opacity_animation_time)})),j||await de(),Y=!0;let r=[];V.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),r.forEach((e=>e.opacity=0)),await new Promise(((e,a)=>{anime({targets:[s.ctx,c.ctx,u.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{s.ctx.clearRect(0,0,64,64),s.ctx.fillStyle=`rgba(64, 64, 64, ${s.ctx._alpha})`,s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle=`rgba(128, 128, 128, ${s.ctx._alpha})`,s.ctx.fillRect(4,4,56,56),s.ctx.moveTo(42.7,21.3),s.ctx.lineTo(21.3,42.7),s.ctx.stroke(),H.needsUpdate=!0,c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(21.3,21.3),c.ctx.lineTo(42.7,42.7),c.ctx.stroke(),q.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(32, 32, 32, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),$.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),I.needsUpdate=!0}})})),Y=!1,e()}))}));let x=Page.element.querySelector("#switch-view-button");x.addEventListener("click",(()=>{U?de():we()}));let E=Page.element.querySelector("#maximum-speed-checkbox");E.addEventListener("input",(()=>{t=E.checked?60:600}));let v=Page.element.querySelector("#array-data-textarea");v.value=le(),Page.element.querySelector("#add-array-button").addEventListener("click",(()=>{he(V.length,ie(v.value))}));let S=Page.element.querySelector("#edit-array-textarea"),P=Page.element.querySelector("#edit-array-index-input");P.addEventListener("input",(()=>{let e=parseInt(P.value||0);e>=V.length||e<0||(S.value=se(V[e].numbers))})),Page.element.querySelector("#edit-array-button").addEventListener("click",(function(){return new Promise((async(e,t)=>{let a=parseInt(P.value);if(a>=V.length||a<0)return void fe(`No array at index ${a}`);V[a];let r=ie(S.value);await pe(a),await he(a,r),ye(),e()}))}));let T=Page.element.querySelector("#remove-array-index-input");Page.element.querySelector("#remove-array-button").addEventListener("click",(()=>{pe(parseInt(T.value))}));let R=Page.element.querySelector("#algorithm-index-input");Page.element.querySelector("#hillman-grassl-button").addEventListener("click",(()=>{He(parseInt(R.value))})),Page.element.querySelector("#hillman-grassl-inverse-button").addEventListener("click",(()=>{qe(parseInt(R.value))})),Page.element.querySelector("#pak-button").addEventListener("click",(()=>{$e(parseInt(R.value))})),Page.element.querySelector("#pak-inverse-button").addEventListener("click",(()=>{var e;e=parseInt(R.value),new Promise((async(n,o)=>{if(G)return void o();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void o();let l=V[e],i=l.numbers;U||await we();let s=[];for(let e=0;e<i.length;e++)for(let t=0;t<i.length;t++)if(i[e][t]!==1/0)for(let a=0;a<i[e][t];a++)s.push([e,t,a]);await Se(l,s);let c=l.footprint*l.footprint,u=0;for(let e=l.footprint-1;e>=0;e--)for(let n=l.footprint-1;n>=0;n--){if(i[e][n]===1/0){l.cubes[e][n]=new Array(r);let a=[];for(let t=0;t<r;t++)l.cubes[e][n][t]=me(l,n,t,e,0,0,.6),l.cubes[e][n][t].material.forEach((e=>a.push(e)));l.floor[e][n]=ge(l,n,e),l.floor[e][n].material.forEach((e=>a.push(e))),await new Promise(((e,r)=>{anime({targets:a,opacity:1,duration:t,easing:"easeOutQuad",complete:e})})),await new Promise(((e,a)=>setTimeout(e,t)));continue}let o=[],s=0;for(;e+s<l.footprint&&n+s<l.footprint;)o.push([e+s,n+s,i[e+s][n+s]-1]),s++;s=o[0][0];let f=o[0][1],h=new Array(o.length),p=!1;if(o.forEach(((e,t)=>{let a=e[0],r=e[1],n=0,o=0;a<l.footprint-1&&(n=i[a+1][r]),r<l.footprint-1&&(o=i[a][r+1]),h[t]=Math.max(n,o),t>0?(n=i[a-1][r],o=i[a][r-1],h[t]+=Math.min(n,o)-i[a][r]):h[t]+=i[a][r],p||h[t]===i[a][r]||(p=!0)})),0!==i[s][f]){let e=[];for(let t=i[s][f]-1;t>=0;t--)e.push([s,f,t]);ve(l,e,u/c*6/7)}else if(0!==h[0])l.cubes[s][f][0]=me(l,f,0,s,u/c*6/7,1,a),i[s][f]=1,Me(l,[[s,f,0]]);else if(!p){u++;continue}await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<o.length;e++){if(s=o[e][0],f=o[e][1],h[e]>i[s][f]){let t=[];for(let r=i[s][f];r<h[e];r++)l.cubes[s][f][r]=me(l,f,r,s,u/c*6/7,1,a),t.push([s,f,r]);U?Me(l,t):await Me(l,t)}else if(h[e]<i[s][f]){let t=[];for(let a=i[s][f]-1;a>=h[e];a--)t.push([s,f,a]);U?Ae(l,t):await Ae(l,t)}if(i[s][f]=h[e],U){let e=J-l.partial_footprint_sum-1,t=l.partial_footprint_sum-l.footprint;Ee(l,s,f,e,t)}}u++,xe(l),await new Promise(((e,a)=>setTimeout(e,t)))}ye(!0),G=!1,n()}))})),Page.element.querySelector("#sulzgruber-button").addEventListener("click",(()=>{var e;e=parseInt(R.value),new Promise((async(a,r)=>{if(G)return void r();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void r();let n=V[e];if(!ce(n.numbers))return fe(`Array at index ${e} is not a plane partition!`),G=!1,void r();let o=_.cloneDeep(n.numbers),l=[];for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)if(o[e][t]!==1/0)for(let a=0;a<o[e][t];a++)l.push([e,t,a]);Se(n,l);let i=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;i[e]=t}let s=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;s[e]=t}let c={},u={};for(let e=0;e<o.length;e++)u[-e]=[e,0];for(let e=1;e<o.length;e++)u[e]=[0,e];for(let e=1-o.length;e<o.length;e++){let t=u[e][0],a=u[e][1];for(;t<o.length&&a<o.length&&o[t][a]===1/0;)t++,a++;if(u[e]=[t,a],t===o.length||a===o.length){c[e]=-1;continue}let r=0===a||o[t][a-1]===1/0,n=0===t||o[t-1][a]===1/0;c[e]=r&&n?0:r?3:n?2:1}let f=[];for(let e=1-o.length;e<o.length;e++){if(1===c[e]||3===c[e])continue;let t=u[e][0],a=u[e][1];if(0!==o[t][a])for(;;){let r=!1;for(;t<o.length&&a<o.length&&0!==o[t][a];){if((a<o.length-1&&o[t][a]>o[t][a+1]||a===o.length-1&&o[t][a]>0)&&(0===c[e]||2===c[e]&&(t<o.length-1&&o[t][a]>o[t+1][a]||t===o.length-1&&o[t][a]>0))){r=!0;break}t++,a++}if(!r)break;let n=t,l=a,i=[[n,l,o[n][l]-1]];for(;;){let e=l-n;if(n<o.length-1&&o[n][l]===o[n+1][l]&&(0===c[e]||3===c[e]))n++;else{if(!(l>s[n]&&(n===o.length-1||n<o.length-1&&o[n][l]>o[n+1][l])))break;l--}i.push([n,l,o[n][l]-1])}i.forEach((e=>o[e[0]][e[1]]--)),f.push(i)}}let h=new Array(o.length);for(let e=0;e<o.length;e++){h[e]=new Array(o.length);for(let t=0;t<o.length;t++)h[e][t]=o[e][t]===1/0?1/0:0}let p=await he(e+1,h);await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<f.length;e++){let a=e/f.length*6/7;await ve(n,f[e],a),await Pe(n,f[e],n.height+1);let r=J-n.partial_footprint_sum-1,o=n.partial_footprint_sum-n.footprint;f[e].forEach((e=>{n.numbers[e[0]][e[1]]--,U&&Ee(n,e[0],e[1],r,o)})),xe(n),await new Promise(((e,a)=>setTimeout(e,t/5)));let l=f[e][f[e].length-1][0],c=u[f[e][f[e].length-1][1]-l+f[e].length-1][1],h=[],m=Math.max(n.height+1,p.height+1);for(let e=i[c];e<=l;e++)h.push([e,c,m]);for(let e=c-1;e>=s[l];e--)h.push([l,e,m]);await Re(n,f[e],p,h),h=[];for(let e=l-1;e>=i[c];e--)h.push([e,c,m]);Ae(p,h),h=[];for(let e=c-1;e>=s[l];e--)h.push([l,e,m]);Ae(p,h),await Te(p,[[l,c,m]]),r=J-p.partial_footprint_sum-1,o=p.partial_footprint_sum-p.footprint,p.numbers[l][c]++,U&&Ee(p,l,c,r,o),xe(p),await new Promise(((e,a)=>setTimeout(e,t)))}await pe(e),G=!1,a()}))})),Page.element.querySelector("#sulzgruber-inverse-button").addEventListener("click",(()=>{Ie(parseInt(R.value))})),Page.element.querySelector("#rsk-button").addEventListener("click",(()=>{var e;e=parseInt(R.value),new Promise((async(a,r)=>{if(G)return void r();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void r();if(e===V.length-1)return fe(`No second array at index ${e+1} (RSK requires two adjacent SSYT of the same shape)`),G=!1,void r();let n=V[e],o=V[e+1];if(!ue(n.numbers))return fe(`Array at index ${e} is not an SSYT!`),G=!1,void r();if(!ue(o.numbers))return fe(`Array at index ${e+1} is not an SSYT!`),G=!1,void r();let l=n.numbers,i=o.numbers;if(l.length!==i.length)return fe("The SSYT do not have the same shape!"),G=!1,void r();for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++)if(0===l[e][t]&&0!==i[e][t]||0!==l[e][t]&&0===i[e][t])return fe("The SSYT do not have the same shape!"),G=!1,void r();let s=[],c=[],u=0,f=0;for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++){if(l[e][t]===1/0||i[e][t]===1/0)return fe("The SSYT contain infinite values, which is not allowed in RSK!"),G=!1,void r();0!==l[e][t]&&f++;for(let a=0;a<l[e][t];a++)s.push([e,t,a]);for(let a=0;a<i[e][t];a++)c.push([e,t,a]);u=Math.max(Math.max(u,l[e][t]),i[e][t])}if(0===u)return fe("The SSYT are empty!"),G=!1,void r();Se(n,s),Se(o,c);let h=new Array(u);for(let e=0;e<u;e++){h[e]=new Array(u);for(let t=0;t<u;t++)h[e][t]=0}let p=await he(e+2,h),m=0;for(;0!==i[0][0];){let e=m/f*6/7,a=0,r=0,s=0;for(let e=0;e<i.length;e++){let t=i.length-1;for(;t>=0&&0===i[e][t];)t--;t>=0&&(a=Math.max(a,i[e][t]))}for(let e=0;e<i.length;e++){let t=i.length-1;for(;t>=0&&0===i[e][t];)t--;if(i[e][t]===a){r=e,s=t;break}}let c=[],u=[],g=[],d=[],w=[],y=[],b=r,x=s,_=l[b][x],E=i[b][x],v=[[b,x]];for(;0!==b;){let e=l.length-1;for(;0===l[b-1][e]||_<=l[b-1][e];)e--;for(let t=0;t<_;t++)c.push([b,x,t]),u.push([b-1,e,t]);b--,x=e,_=l[b][x],v.push([b,x])}let S=p.height+1;for(let e=0;e<_;e++)g.push([b,x,e]),d.push([E-1,e,S]);for(let e=0;e<E-1;e++)w.push([r,s,e]),y.push([e,_-1,S]);ve(o,w.concat([[r,s,E-1]]),e),ve(n,c,e),await ve(n,g,e),i[r][s]=0;for(let e=v.length-1;e>0;e--)l[v[e][0]][v[e][1]]=l[v[e-1][0]][v[e-1][1]];if(l[r][s]=0,U){let e=J-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;Ee(n,r,s,e,t);for(let a=v.length-1;a>0;a--)Ee(n,v[a][0],v[a][1],e,t);e=J-o.partial_footprint_sum-1,t=o.partial_footprint_sum-o.footprint,Ee(o,r,s,e,t)}Re(o,w,p,y),Re(n,g,p,d),Re(n,c,n,u),await Re(o,[[r,s,E-1]],p,[[E-1,_-1,S]],!1),Se(n,u),p.cube_group.remove(o.cubes[r][s][E-1]),Ae(o,[[r,s,E-1]],!0,!0),d.reverse(),y.reverse(),Ae(p,d.slice(1)),Ae(p,y),await Te(p,[[E-1,_-1,S]]),h[E-1][_-1]++,U&&Ee(p,E-1,_-1,J-p.partial_footprint_sum-1,p.partial_footprint_sum-p.footprint),xe(p),m++,await new Promise(((e,a)=>setTimeout(e,t/2)))}await pe(e),await new Promise(((e,a)=>setTimeout(e,t))),await pe(e),G=!1,a()}))})),Page.element.querySelector("#example-1-button").addEventListener("click",(()=>{Le(1)})),Page.element.querySelector("#example-2-button").addEventListener("click",(()=>{Le(2)})),Page.element.querySelector("#example-3-button").addEventListener("click",(()=>{Le(3)}));let M=!1;Page.element.querySelector("#download-button").addEventListener("click",(()=>{M=!0}));const A=new THREE.Scene,k=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),L=new THREE.WebGLRenderer({canvas:i.canvas,antialias:!0});L.setSize(e,e,!1);new THREE.TextureLoader;const H=new THREE.CanvasTexture(s.canvas);H.minFilter=THREE.LinearFilter,H.magFilter=THREE.NearestFilter;const q=new THREE.CanvasTexture(c.canvas);q.minFilter=THREE.LinearFilter,q.magFilter=THREE.NearestFilter;const $=new THREE.CanvasTexture(u.canvas);$.minFilter=THREE.LinearFilter,$.magFilter=THREE.NearestFilter;const I=new THREE.CanvasTexture(f.canvas);I.minFilter=THREE.LinearFilter,I.magFilter=THREE.NearestFilter;const z=new THREE.BoxGeometry;let O=!1;const Q=new THREE.BoxGeometry(1,.001,1),C=(new THREE.BoxGeometry(.001,1,1),new THREE.BoxGeometry(1,1,.001),new THREE.AmbientLight(16777215,.2));A.add(C);const F=new THREE.PointLight(16777215,3,1e4);F.position.set(750,1e3,500),A.add(F);let N=0,B=0,D=0,W=[];let U=!1,j=!0,Y=!1,G=!1,K=10,V=[],J=0,X=0,Z=0,ee=[15,15,15],te=[0,20,0],ae=ie(v.value);function re(e,t,a){j=!1,B=0,W=[0,0,0,0]}function ne(e,t,a,r,n){U||(N+=a,N>3.14159265?N-=6.283185301:N<-3.14159265&&(N+=6.283185301),A.children.forEach((e=>e.rotation.y=N)),D=a)}function oe(e,t,a){if(!U){let e=0;if(W.forEach(((t,a)=>{Math.abs(t)>B&&(B=Math.abs(t),e=a)})),B<.005)return void(B=0);B=W[e]}W=[0,0,0,0]}function le(){let e=Math.floor(3*Math.random())+4,t=Math.floor(5*Math.random())+10,a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);a[0][0]=t;for(let t=1;t<e;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++){a[t][0]=Math.max(a[t-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<e;r++)a[t][r]=Math.max(Math.min(a[t][r-1],a[t-1][r])-Math.floor(4*Math.random()),0)}let r="";for(let t=0;t<e;t++){for(let n=0;n<e;n++){let e=a[t][n];r+=0===e?"   ":e<10?` ${e} `:`${e} `}t!==e-1&&(r+="\n")}return r}function ie(e){let t=e.split("\n"),a=t.length,r=new Array(t.length);for(let e=0;e<r.length;e++){r[e]=t[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let n=r[0].length,o=Math.max(a,n),l=new Array(o);for(let e=0;e<a;e++){l[e]=new Array(o);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?l[e][t]=1/0:l[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<o;t++)l[e][t]=0}for(let e=a;e<o;e++){l[e]=new Array(o);for(let t=0;t<o;t++)l[e][t]=0}return l}function se(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let a="";for(let r=0;r<e.length;r++){for(let n=0;n<e.length;n++)if(e[r][n]===1/0){for(let e=0;e<t-1-(0===n);e++)a+=" ";a+="^"}else{let o=`${e[r][n]}`.length;for(let e=0;e<t-o-(0===n);e++)a+=" ";a+=e[r][n]}r!==e.length-1&&(a+="\n")}return a}function ce(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return!1;return!0}function ue(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(0!==e[t+1][a]&&e[t][a]>=e[t+1][a]||0!==e[t][a+1]&&e[t][a]>e[t][a+1])return!1;return!0}function fe(e){Page.Footer.Floating.show_settings_text(e)}function he(e,a){return new Promise((async(n,o)=>{let l={numbers:a,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};U&&await Page.Animate.change_opacity(h,0,t/5),V.splice(e,0,l),l.footprint=l.numbers.length;for(let a=e;a<V.length;a++)V[a].partial_footprint_sum=V[a].footprint,0!==a?(V[a].center_offset=V[a-1].center_offset+V[a-1].footprint/2+V[a].footprint/2+1,V[a].partial_footprint_sum+=V[a-1].partial_footprint_sum+1):V[a].center_offset=0,a!==e&&anime({targets:V[a].cube_group.position,x:V[a].center_offset,y:0,z:-V[a].center_offset,duration:t,easing:"easeInOutQuad"});l.cube_group=new THREE.Object3D,A.add(l.cube_group),l.cube_group.position.set(l.center_offset,0,-l.center_offset),l.cube_group.rotation.y=N,l.cubes=new Array(l.footprint),l.floor=new Array(l.footprint);for(let e=0;e<l.footprint;e++){l.cubes[e]=new Array(l.footprint),l.floor[e]=new Array(l.footprint);for(let t=0;t<l.footprint;t++)if(l.numbers[e][t]!==1/0){l.cubes[e][t]=new Array(l.numbers[e][t]),l.numbers[e][t]>l.height&&(l.height=l.numbers[e][t]),l.floor[e][t]=ge(l,t,e);for(let a=0;a<l.numbers[e][t];a++)l.cubes[e][t][a]=me(l,t,a,e)}else{l.cubes[e][t]=new Array(r),l.floor[e][t]=ge(l,t,e);for(let a=0;a<r;a++)l.cubes[e][t][a]=me(l,t,a,e,0,0,.6)}}l.size=Math.max(l.footprint,l.height),J+=l.footprint+1,X=Math.max(X,l.height),Z=Math.max(J,X),1===V.length?(ee=[Z,Z+X/3,Z],te=[0,Z+10,0],k.left=-Z,k.right=Z,k.top=Z,k.bottom=-Z,k.position.set(ee[0],ee[1],ee[2]),k.rotation.set(-.785398163,.615479709,.523598775),k.updateProjectionMatrix()):ye(!0),e!==V.length-1&&await new Promise(((e,a)=>setTimeout(e,t)));let i=[];l.cube_group.traverse((e=>{e.material&&e.material.forEach((e=>i.push(e)))})),await new Promise((async(e,a)=>{anime({targets:i,opacity:1,duration:t/2,easing:"easeOutQuad",complete:e})})),U&&_e(),n(l)}))}function pe(e){return new Promise((async(a,r)=>{if(e>=V.length||e<0)fe(`No array at index ${e}`);else{U&&await Page.Animate.change_opacity(h,0,t/5),await new Promise(((a,r)=>{let n=[];V[e].cube_group.traverse((e=>{e.material&&e.material.forEach((e=>n.push(e)))})),anime({targets:n,opacity:0,duration:t/2,easing:"easeOutQuad",complete:a})}));for(let t=0;t<V[e].cubes.length;t++)for(let a=0;a<V[e].cubes[t].length;a++)if(V[e].cubes[t][a])for(let r=0;r<V[e].cubes[t][a].length;r++)V[e].cubes[t][a][r]&&V[e].cubes[t][a][r].material.forEach((e=>e.dispose()));A.remove(V[e].cube_group),J-=V[e].footprint+1,V.splice(e,1);for(let a=e;a<V.length;a++)V[a].partial_footprint_sum=V[a].footprint,0!==a?(V[a].center_offset=V[a-1].center_offset+V[a-1].footprint/2+V[a].footprint/2+1,V[a].partial_footprint_sum+=V[a-1].partial_footprint_sum+1):V[a].center_offset=0,anime({targets:V[a].cube_group.position,x:V[a].center_offset,y:0,z:-V[a].center_offset,duration:t,easing:"easeInOutQuad"});0!==V.length&&ye(!0),a()}}))}function me(e,t,a,r,n=0,o=0,l=.4){const i=[new THREE.MeshStandardMaterial({map:H,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:H,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:H,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:H,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0})];i.forEach((e=>e.color.setHSL(n,o,l)));const s=new THREE.Mesh(z,i);return e.cube_group.add(s),s.position.set(t-(e.footprint-1)/2,a,r-(e.footprint-1)/2),s}function ge(e,t,a,r=0,n=0,o=.4){const l=[new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:I,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:I,transparent:!0,opacity:0})];l.forEach((e=>e.color.setHSL(r,n,o)));const i=new THREE.Mesh(Q,l);return e.cube_group.add(i),i.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),i}function de(){return new Promise((async(e,a)=>{Y?a():(Page.Animate.change_opacity(x,0,Site.opacity_animation_time).then((()=>{x.textContent="Show 2D View",Page.Animate.change_opacity(x,1,Site.opacity_animation_time)})),Y=!0,U&&await Page.Animate.change_opacity(h,0,t/5),U=!1,j=!0,B=0,W=[0,0,0,0],ye(!0),anime({targets:k.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:t,easing:"easeInOutQuad",complete:()=>{Y=!1,e()}}),V.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),N=0)}))}function we(){return new Promise((async(e,a)=>{Y||U?a():(Page.Animate.change_opacity(x,0,Site.opacity_animation_time).then((()=>{x.textContent="Show 3D View",Page.Animate.change_opacity(x,1,Site.opacity_animation_time)})),O&&await be(),Y=!0,U=!0,j=!1,B=0,W=[0,0,0,0],ye(!0),anime({targets:k.rotation,x:-1.570796327,y:0,z:0,duration:t,easing:"easeInOutQuad"}),V.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),setTimeout((()=>{_e(),Page.Animate.change_opacity(h,1,t/5).then((()=>{Y=!1,e()}))}),t))}))}function ye(e=!1){if(!e){if(Y)return;Y=!0}X=0;for(let e=0;e<V.length;e++)X=Math.max(X,V[e].height);Z=Math.max(J,X);let a=(-V[0].footprint/2+V[V.length-1].center_offset+V[V.length-1].footprint/2)/2;ee=[Z+a,Z+X/3,Z-a],te=[a,Z+10,-a],U?(anime({targets:k.position,x:te[0],y:te[1],z:te[2],duration:t,easing:"easeInOutQuad"}),anime({targets:k,left:-(J/2+.5),right:J/2+.5,top:J/2+.5,bottom:-(J/2+.5),duration:t,easing:"easeInOutQuad",update:()=>k.updateProjectionMatrix(),complete:()=>Y=!1}),setTimeout((()=>{_e(),Page.Animate.change_opacity(h,1,t/5)}),t)):(anime({targets:k.position,x:ee[0],y:ee[1],z:ee[2],duration:t,easing:"easeInOutQuad"}),anime({targets:k,left:-Z,right:Z,top:Z,bottom:-Z,duration:t,easing:"easeInOutQuad",update:()=>k.updateProjectionMatrix(),complete:()=>Y=!1}))}function be(){return new Promise((async(e,a)=>{if(Y)return void a();O=!1,Page.Animate.change_opacity(b,0,Site.opacity_animation_time).then((()=>{b.textContent="Show Dimers",Page.Animate.change_opacity(b,1,Site.opacity_animation_time)})),Y=!0;let r=[];V.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),await new Promise(((e,a)=>{anime({targets:[s.ctx,c.ctx,u.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{s.ctx.clearRect(0,0,64,64),s.ctx.fillStyle=`rgba(64, 64, 64, ${s.ctx._alpha})`,s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle=`rgba(128, 128, 128, ${s.ctx._alpha})`,s.ctx.fillRect(4,4,56,56),s.ctx.moveTo(42.7,21.3),s.ctx.lineTo(21.3,42.7),s.ctx.stroke(),H.needsUpdate=!0,c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(21.3,21.3),c.ctx.lineTo(42.7,42.7),c.ctx.stroke(),q.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(32, 32, 32, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),$.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),I.needsUpdate=!0}})})),r.forEach((e=>e.opacity=1)),Y=!1,e()}))}function xe(e){e.height=0,e.numbers.forEach((t=>{t.forEach((t=>{t!==1/0&&(e.height=Math.max(t,e.height))}))})),e.size=Math.max(e.footprint,e.height);let t=X;X=0,V.forEach((e=>X=Math.max(e.height,X))),Z=Math.max(J,X),X!==t&&ye()}function _e(){K=o.canvas_width/(J+1);let e=Math.max(`${X}`.length,2);o.ctx.font=K/e+"px monospace",o.ctx.clearRect(0,0,o.canvas_width,o.canvas_height),V.forEach((e=>{let t=J-e.partial_footprint_sum-1,a=e.partial_footprint_sum-e.footprint;for(let r=0;r<e.footprint;r++)for(let n=0;n<e.footprint;n++)Ee(e,r,n,t,a)}))}function Ee(e,t,a,r,n){if(o.ctx.clearRect(K*(a+n+1),K*(t+r+1),K,K),e.numbers[t][a]!==1/0){let l=o.ctx.measureText(e.numbers[t][a]);o.ctx.fillText(e.numbers[t][a],K*(a+n+1)+(K-l.width)/2,K*(t+r+1)+(K+l.actualBoundingBoxAscent-l.actualBoundingBoxDescent)/2)}}function ve(e,r,n){return new Promise(((o,l)=>{if(0===r.length)return void o();let i=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e.color)))})),i.forEach((e=>e.getHSL(e))),anime({targets:i,s:1,duration:t,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",update:()=>i.forEach((e=>e.setHSL(n,e.s,a))),complete:o})}))}function Se(e,r){return new Promise(((n,o)=>{let l=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>l.push(e.color)))})),l.forEach((e=>e.getHSL(e))),anime({targets:l,s:0,duration:t,easing:"easeOutQuad",update:()=>l.forEach((e=>e.setHSL(e.h,e.s,a))),complete:n})}))}function Pe(e,a,r){return new Promise(((n,o)=>{let l=U?0:t,i=[];a.forEach((t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")})),anime({targets:i,y:r,duration:l,easing:"easeInOutQuad",complete:n})}))}function Te(e,a){return new Promise(((r,n)=>{let o=U?0:t,l=[];a.forEach((t=>{l.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")})),anime({targets:l,y:(t,r)=>e.numbers[a[r][0]][a[r][1]],duration:o,easing:"easeInOutQuad",complete:()=>{a.forEach((t=>{e.cubes[t[0]][t[1]][e.numbers[t[0]][t[1]]]=e.cubes[t[0]][t[1]][t[2]],e.cubes[t[0]][t[1]][t[2]]=null})),r()}})}))}function Re(e,a,r,n,o=!0){return new Promise(((l,i)=>{let s=[];a.forEach((t=>{s.push(e.cubes[t[0]][t[1]][t[2]].position),r.cube_group.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")})),anime({targets:s,x:(e,t)=>n[t][1]-(r.footprint-1)/2,y:(e,t)=>n[t][2],z:(e,t)=>n[t][0]-(r.footprint-1)/2,duration:t,easing:"easeInOutQuad",complete:()=>{if(o){let t=a.map((t=>e.cubes[t[0]][t[1]][t[2]]));a.forEach((t=>e.cubes[t[0]][t[1]][t[2]]=null)),n.forEach(((e,n)=>{r.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[e[0]][e[1]][e[2]]&&!a.some((t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]))&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),r.cubes[e[0]][e[1]][e[2]]=t[n]}))}l()}})}))}function Me(e,a){return new Promise(((r,n)=>{if(0===a.length)return void r();let o=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>o.push(e))),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")})),anime({targets:o,opacity:1,duration:t/2,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:r})}))}function Ae(e,a,r=!1,n=!1){return new Promise(((o,l)=>{let i=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e)))})),anime({targets:i,opacity:0,duration:t/2*!n,delay:(e,a)=>!r*Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:()=>{i.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null})),o()}})}))}function ke(e,a){return new Promise(((r,n)=>{let o=[];a.forEach((t=>{e.floor[t[0]][t[1]].material.forEach((e=>o.push(e)))})),anime({targets:o,opacity:0,duration:t/2,easing:"easeOutQuad",complete:()=>{o.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null})),r()}})}))}function Le(e){return new Promise((async(a,r)=>{if(1===e||2===e){for(;V.length>1;)await pe(1),await new Promise(((e,a)=>setTimeout(e,t)));if(0===V.length){let e=ie(le());S.value=v.value,await he(V.length,e)}else if(!ce(V[0].numbers)){await pe(0),await new Promise(((e,a)=>setTimeout(e,t)));let e=ie(le());S.value=v.value,await he(V.length,e)}1===e?(await He(0),await new Promise(((e,a)=>setTimeout(e,3*t))),await qe(0)):(await $e(0),await new Promise(((e,a)=>setTimeout(e,3*t))),await Ie(0)),a()}}))}function He(e){return new Promise((async(a,r)=>{if(G)return void r();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void r();let n=V[e];if(!ce(n.numbers))return fe(`Array at index ${e} is not a plane partition!`),G=!1,void r();let o=_.cloneDeep(n.numbers),l=[];for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)if(o[e][t]!==1/0)for(let a=0;a<o[e][t];a++)l.push([e,t,a]);Se(n,l);let i=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;i[e]=t}let s=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;s[e]=t}let c=[];for(;;){let e=o[0].length-1;for(;e>=0&&i[e]<o.length&&0===o[i[e]][e];)e--;if(e<0||i[e]===o.length)break;let t=i[e],a=e,r=[[t,a,o[t][a]-1]];for(;;){if(t<o.length-1&&o[t+1][a]===o[t][a])t++;else{if(!(a>0&&o[t][a-1]!==1/0))break;a--}r.push([t,a,o[t][a]-1])}for(let e=0;e<r.length;e++)o[r[e][0]][r[e][1]]--;c.push(r)}let u=new Array(o.length);for(let e=0;e<o.length;e++){u[e]=new Array(o.length);for(let t=0;t<o.length;t++)u[e][t]=o[e][t]===1/0?1/0:0}let f=await he(e+1,u);await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<c.length;e++){let a=e/c.length*6/7;await ve(n,c[e],a),await Pe(n,c[e],n.height);let r=J-n.partial_footprint_sum-1,o=n.partial_footprint_sum-n.footprint;for(let t=0;t<c[e].length;t++)n.numbers[c[e][t][0]][c[e][t][1]]--,U&&Ee(n,c[e][t][0],c[e][t][1],r,o);xe(n),await new Promise(((e,a)=>setTimeout(e,t/5)));let l=[c[e][c[e].length-1][0],c[e][0][1]],u=[],h=f.height+1;for(let e=i[l[1]];e<=l[0];e++)u.push([e,l[1],h]);let p=u[u.length-1];for(let e=l[1]-1;e>=s[l[0]];e--)u.push([l[0],e,h]);await Re(n,c[e],f,u),u=[];for(let e=l[0]-1;e>=i[l[1]];e--)u.push([e,l[1],h]);Ae(f,u),u=[];for(let e=l[1]-1;e>=s[l[0]];e--)u.push([l[0],e,h]);Ae(f,u),await Te(f,[p]),r=J-f.partial_footprint_sum-1,o=f.partial_footprint_sum-f.footprint,f.numbers[p[0]][p[1]]++,xe(f),U&&Ee(f,p[0],p[1],r,o),f.height=Math.max(f.height,f.numbers[p[0]][p[1]]),f.size=Math.max(f.size,f.height),await new Promise(((e,a)=>setTimeout(e,t)))}await pe(e),G=!1,a()}))}function qe(e){return new Promise((async(r,n)=>{if(G)return void n();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void n();let o=V[e],l=_.cloneDeep(o.numbers),i=[],s=[];for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++)if(l[e][t]!==1/0)for(let a=0;a<l[e][t];a++)s.push([e,t,a]);Se(o,s);let c=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;c[e]=t}let u=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;u[e]=t}let f=new Array(l.length);for(let e=0;e<l.length;e++){f[e]=new Array(l.length);for(let t=0;t<l.length;t++)f[e][t]=l[e][t]===1/0?1/0:0}let h=_.cloneDeep(f),p=await he(e+1,f);for(let e=0;e<l.length;e++)for(let t=l.length-1;t>=c[e];t--)for(;0!==l[t][e];){let a=[],r=t,n=u[t];for(;r>=0;){let t=n;if(0!==r)for(;h[r][t]!==h[r-1][t]&&t<e;)t++;else t=e;for(let e=n;e<=t;e++)a.push([r,e,h[r][e]]);if(!(r-1>=c[t]))break;r--,n=t}for(let e=0;e<a.length;e++)h[a[e][0]][a[e][1]]++;i.push([a,[t,e,l[t][e]-1]]),l[t][e]--}await new Promise(((e,a)=>setTimeout(e,t/2)));for(let e=0;e<i.length;e++){let r=e/i.length*6/7;await ve(o,[i[e][1]],r);let n=i[e][1][0],l=i[e][1][1],s=o.size;for(let e=c[l];e<n;e++)o.cubes[e][l][s]=me(o,l,s,e),o.cubes[e][l][s].material.forEach((e=>e.color.setHSL(r,1,a)));for(let e=u[n];e<l;e++)o.cubes[n][e][s]=me(o,e,s,n),o.cubes[n][e][s].material.forEach((e=>e.color.setHSL(r,1,a)));await Pe(o,[i[e][1]],s);let f=[];for(let e=n-1;e>=c[l];e--)f.push([e,l,s]);let h=Me(o,f);f=[];for(let e=l-1;e>=u[n];e--)f.push([n,e,s]);let m=Me(o,f);await Promise.all([h,m]),f=[];for(let e=u[n];e<l;e++)f.push([n,e,s]);f.push([n,l,o.numbers[n][l]-1]);for(let e=n-1;e>=c[l];e--)f.push([e,l,s]);let g=i[e][0],d=p.height+1;if(g.forEach((e=>e[2]=d)),o.numbers[n][l]--,xe(o),U){Ee(o,n,l,J-o.partial_footprint_sum-1,o.partial_footprint_sum-o.footprint)}if(await Re(o,f,p,g),await Te(p,g),g.forEach((e=>{p.numbers[e[0]][e[1]]++})),xe(p),U){let e=J-p.partial_footprint_sum-1,t=p.partial_footprint_sum-p.footprint;g.forEach((a=>{Ee(p,a[0],a[1],e,t)}))}await new Promise(((e,a)=>setTimeout(e,t/2)))}await pe(e),G=!1,r()}))}function $e(e){return new Promise((async(a,r)=>{if(G)return void r();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void r();let n=V[e];if(!ce(n.numbers))return fe(`Array at index ${e} is not a plane partition!`),G=!1,void r();let o=n.numbers;U||await we();let l=[];for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)if(o[e][t]!==1/0)for(let a=0;a<o[e][t];a++)l.push([e,t,a]);await Se(n,l);let i=n.footprint*n.footprint,s=0;for(let e=0;e<n.footprint;e++)for(let a=0;a<n.footprint;a++){if(o[e][a]===1/0){let r=n.cubes[e][a].map(((t,r)=>[e,a,r]));await Ae(n,r,!0),ke(n,[[e,a]]),n.cubes[e][a]=[],await new Promise(((e,a)=>setTimeout(e,t)));continue}let r=[],l=0;for(;e+l<n.footprint&&a+l<n.footprint;)r.push([e+l,a+l,o[e+l][a+l]-1]),l++;l=r[0][0];let c=r[0][1],u=[];for(let e=o[l][c]-2;e>=0;e--)u.push([l,c,e]);ve(n,u,s/i*6/7),u=[],r.forEach((e=>{e[2]>=0&&u.push(e)})),await ve(n,u,s/i*6/7);let f=new Array(r.length);r.forEach(((e,t)=>{let a=e[0],r=e[1],l=0,i=0;a<n.footprint-1&&(l=o[a+1][r]),r<n.footprint-1&&(i=o[a][r+1]),f[t]=Math.max(l,i),t>0?(l=o[a-1][r],i=o[a][r-1],f[t]+=Math.min(l,i)-o[a][r]):f[t]=o[a][r]-f[t]}));for(let e=0;e<r.length;e++){if(l=r[e][0],c=r[e][1],f[e]>o[l][c]){let t=[];for(let a=o[l][c];a<f[e];a++)n.cubes[l][c][a]=me(n,c,a,l),t.push([l,c,a]);U?Me(n,t):await Me(n,t)}else if(f[e]<o[l][c]){let t=[];for(let a=o[l][c]-1;a>=f[e];a--)t.push([l,c,a]);U?Ae(n,t):await Ae(n,t)}if(o[l][c]=f[e],U){let e=J-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;Ee(n,l,c,e,t)}}let h=[];u.forEach(((e,t)=>{0!==t&&e[2]<o[e[0]][e[1]]&&h.push(e)})),U?Se(n,h):await Se(n,h),s++,xe(n),0!==u.length&&await new Promise(((e,a)=>setTimeout(e,t)))}ye(!0),G=!1,a()}))}function Ie(e){return new Promise((async(r,n)=>{if(G)return void n();if(G=!0,e>=V.length||e<0)return fe(`No array at index ${e}`),G=!1,void n();let o=V[e],l=o.numbers,i=[];for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++)if(l[e][t]!==1/0)for(let a=0;a<l[e][t];a++)i.push([e,t,a]);Se(o,i);let s=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[t][e]===1/0;)t++;s[e]=t}let c=new Array(l.length);for(let e=0;e<l.length;e++){let t=0;for(;t<l.length&&l[e][t]===1/0;)t++;c[e]=t}let u={};for(let e=0;e<l.length;e++)u[-e]=[e,0];for(let e=1;e<l.length;e++)u[e]=[0,e];for(let e=1-l.length;e<l.length;e++){let t=u[e][0],a=u[e][1];for(;t<l.length&&a<l.length&&l[t][a]===1/0;)t++,a++;u[e]=[t,a]}let f=0,h=new Array(l.length);for(let e=0;e<l.length;e++){h[e]=new Array(l.length);for(let t=0;t<l.length;t++)l[e][t]===1/0?h[e][t]=1/0:(h[e][t]=0,f+=l[e][t])}let p=await he(e+1,h),m=(p.numbers,0);for(let e=l.length-1;e>=0;e--)for(let r=l.length-1;r>=0;r--)if(l[r][e]!==1/0)for(;0!==l[r][e];){let n=m/f*6/7,i=Math.max(o.size+1,p.size+1);await ve(o,[[r,e,l[r][e]-1]],n),await Pe(o,[[r,e,l[r][e]-1]],i);let h=r,g=e;for(let e=s[g];e<h;e++)o.cubes[e][g][i]=me(o,g,i,e),o.cubes[e][g][i].material.forEach((e=>e.color.setHSL(n,1,a)));for(let e=c[h];e<g;e++)o.cubes[h][e][i]=me(o,e,i,h),o.cubes[h][e][i].material.forEach((e=>e.color.setHSL(n,1,a)));let d=[];for(let e=h-1;e>=s[g];e--)d.push([e,g,i]);let w=Me(o,d);d=[];for(let e=g-1;e>=c[h];e--)d.push([h,e,i]);let y=Me(o,d);await Promise.all([w,y]),d=[];for(let e=c[h];e<g;e++)d.push([h,e,i]);d.push([h,g,o.numbers[h][g]-1]);for(let e=h-1;e>=s[g];e--)d.push([e,g,i]);let b=c[h]-h,x=b+d.length-1,E=[];for(let e=b;e<=x;e++)E.push(_.clone(u[e]));if(l[h][g]--,xe(o),U){Ee(o,h,g,J-o.partial_footprint_sum-1,o.partial_footprint_sum-o.footprint)}await Re(o,d,p,E);let v=0,S=p.numbers[E[0][0]][E[0][1]];for(;;){let e=v;for(;e<E.length&&E[e][0]===E[v][0];)e++;d=E.slice(v,e);let t=!0;for(let e=0;e<d.length;e++)if(p.numbers[d[e][0]][d[e][1]]!==S){t=!1;break}if(t){if(await Te(p,d),d.forEach((e=>p.numbers[e[0]][e[1]]++)),xe(p),U){let e=J-p.partial_footprint_sum-1,t=p.partial_footprint_sum-p.footprint;d.forEach((a=>{Ee(p,a[0],a[1],e,t)}))}v=e}else{let e=_.cloneDeep(E.slice(v));for(let e=v;e<E.length;e++)if(E[e][0]++,E[e][1]++,E[e][0]>p.footprint||E[e][1]>p.footprint)return void console.error("Insertion failed!");let t=E.slice(v);await Re(p,e,p,t),S=p.numbers[E[v][0]][E[v][1]]}if(v===E.length)break}m++,await new Promise(((e,a)=>setTimeout(e,t/2)))}await pe(e),G=!1,r()}))}S.value=v.value,he(V.length,ae),function e(){L.render(A,k),W.push(D),W.shift(),D=0,0!==B&&(N+=B,A.children.forEach((e=>e.rotation.y=N)),B*=.94,Math.abs(B)<5e-4&&(B=0));N>3.14159265?N-=6.283185301:N<-3.14159265&&(N+=6.283185301);M&&(M=!1,i.canvas.toBlob((e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()})));window.requestAnimationFrame(e)}(),Page.show()}();