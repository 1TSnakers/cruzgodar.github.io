!async function(){"use strict";Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then((()=>{Site.scripts_loaded.lodash=!0})).catch((e=>{console.error("Could not load Lodash")}));let e=2e3,t=500;const a=.4,r=100;let n={renderer:"cpu",canvas_width:e,canvas_height:e,mousedown_callback:ae,touchstart_callback:ae,mousedrag_callback:re,touchmove_callback:re,mouseup_callback:ne,touchend_callback:ne},o=new Wilson(Page.element.querySelector("#numbers-canvas"),n);o.ctx.fillStyle="rgb(255, 255, 255)",Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important");let l={canvas_width:e,canvas_height:e},i=new Wilson(Page.element.querySelector("#output-canvas"),l),c=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});c.ctx.strokeStyle="rgb(255, 255, 255)",c.ctx._alpha=1,c.ctx.fillStyle="rgba(64, 64, 64, 1)",c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle="rgba(128, 128, 128, 1)",c.ctx.fillRect(4,4,56,56),c.ctx.lineWidth=6;let s=new Wilson(Page.element.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});s.ctx.strokeStyle="rgb(255, 255, 255)",s.ctx._alpha=1,s.ctx.fillStyle="rgba(64, 64, 64, 1)",s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle="rgba(128, 128, 128, 1)",s.ctx.fillRect(4,4,56,56),s.ctx.lineWidth=6;let u=new Wilson(Page.element.querySelector("#hidden-canvas-3"),{renderer:"cpu",canvas_width:64,canvas_height:64});u.ctx.strokeStyle="rgb(255, 255, 255)",u.ctx._alpha=1,u.ctx.fillStyle="rgba(32, 32, 32, 1)",u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle="rgba(64, 64, 64, 1)",u.ctx.fillRect(4,4,56,56),u.ctx.lineWidth=6;let f=new Wilson(Page.element.querySelector("#hidden-canvas-4"),{renderer:"cpu",canvas_width:64,canvas_height:64});f.ctx.strokeStyle="rgb(255, 255, 255)",f.ctx._alpha=1,f.ctx.fillStyle="rgb(32, 32, 32)",f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle="rgb(64, 64, 64)",f.ctx.fillRect(4,4,56,56),f.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then((()=>{Site.scripts_loaded.three=!0})).catch((e=>{console.error("Could not load THREE.js")}));let h=Page.element.querySelector("#numbers-canvas-container");const p={"view-controls":Page.element.querySelectorAll(".view-controls-section"),"add-array":Page.element.querySelectorAll(".add-array-section"),"edit-array":Page.element.querySelectorAll(".edit-array-section"),"remove-array":Page.element.querySelectorAll(".remove-array-section"),algorithms:Page.element.querySelectorAll(".algorithms-section")},g=Page.element.querySelector("#category-holder"),m=Page.element.querySelector("#canvas-landscape-left");let d="view-controls";["view-controls","add-array","edit-array","remove-array","algorithms"].forEach((e=>{e!==d&&p[e].forEach((e=>{e.style.opacity=0}))})),p[d].forEach((e=>m.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let y=Page.element.querySelector("#category-selector-dropdown");y.addEventListener("input",(async()=>{if(await Promise.all(Array.from(p[d]).map((e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time)))),p[d].forEach((e=>g.appendChild(e))),p[d].forEach((e=>e.classList.remove("move-to-left"))),p[d].forEach((e=>e.classList.remove("move-to-right"))),d=y.value,p[d].forEach((e=>m.appendChild(e))),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===d){let e=parseInt(S.value||0);e<J.length&&e>=0&&(v.value=le(J[e].numbers))}p[d].forEach((e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time)))}));let b=Page.element.querySelector("#show-dimers-button");b.addEventListener("click",(()=>{z?de():new Promise((async(e,a)=>{if(j)return void a();z=!0,Page.Animate.change_opacity(b,0,Site.opacity_animation_time).then((()=>{b.textContent="Hide Dimers",Page.Animate.change_opacity(b,1,Site.opacity_animation_time)})),U||await pe(),j=!0;let r=[];J.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),r.forEach((e=>e.opacity=0)),await new Promise(((e,a)=>{anime({targets:[c.ctx,s.ctx,u.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(42.7,21.3),c.ctx.lineTo(21.3,42.7),c.ctx.stroke(),L.needsUpdate=!0,s.ctx.clearRect(0,0,64,64),s.ctx.fillStyle=`rgba(64, 64, 64, ${s.ctx._alpha})`,s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle=`rgba(128, 128, 128, ${s.ctx._alpha})`,s.ctx.fillRect(4,4,56,56),s.ctx.moveTo(21.3,21.3),s.ctx.lineTo(42.7,42.7),s.ctx.stroke(),k.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(32, 32, 32, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),q.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),$.needsUpdate=!0}})})),j=!1,e()}))}));let w=Page.element.querySelector("#switch-view-button");w.addEventListener("click",(()=>{D?pe():ge()}));let x=Page.element.querySelector("#maximum-speed-checkbox");x.addEventListener("input",(()=>{t=x.checked?50:500}));let E=Page.element.querySelector("#array-data-textarea");E.value=function(){let e=Math.floor(3*Math.random())+4,t=Math.floor(5*Math.random())+10,a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);a[0][0]=t;for(let t=1;t<e;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let t=1;t<e;t++){a[t][0]=Math.max(a[t-1][0]-Math.floor(4*Math.random()),0);for(let r=1;r<e;r++)a[t][r]=Math.max(Math.min(a[t][r-1],a[t-1][r])-Math.floor(4*Math.random()),0)}let r="";for(let t=0;t<e;t++){for(let n=0;n<e;n++){let e=a[t][n];r+=0===e?"   ":e<10?` ${e} `:`${e} `}t!==e-1&&(r+="\n")}return r}(),Page.element.querySelector("#add-pp-button").addEventListener("click",(()=>{let e=oe(E.value);ie(e)&&se(J.length,e,"pp")})),Page.element.querySelector("#add-tableau-button").addEventListener("click",(()=>{let e=oe(E.value);se(J.length,e,"tableau")}));let v=Page.element.querySelector("#edit-array-textarea"),S=Page.element.querySelector("#edit-array-index-input");S.addEventListener("input",(()=>{let e=parseInt(S.value||0);e>=J.length||e<0||(v.value=le(J[e].numbers))})),Page.element.querySelector("#edit-array-button").addEventListener("click",(function(){return new Promise((async(e,t)=>{let a=parseInt(S.value);if(a>=J.length||a<0)return void ce(`No array at index ${a}`);let r=J[a],n=oe(v.value),o=r.type;("pp"!==o||ie(n))&&(await ue(a),await se(a,n,o),me(),e())}))}));let P=Page.element.querySelector("#remove-array-index-input");Page.element.querySelector("#remove-array-button").addEventListener("click",(()=>{ue(parseInt(P.value))}));let T=Page.element.querySelector("#algorithm-index-input");Page.element.querySelector("#hillman-grassl-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let a=J[e];if("pp"!==a.type)return ce(`Array at index ${e} is not a plane partition!`),void(G=!1);let r=_.cloneDeep(a.numbers),n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);_e(a,n);let o=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;o[e]=t}let l=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;l[e]=t}let i=[];for(;;){let e=r[0].length-1;for(;e>=0&&o[e]<r.length&&0===r[o[e]][e];)e--;if(e<0||o[e]===r.length)break;let t=o[e],a=e,n=[[t,a,r[t][a]-1]];for(;;){if(t<r.length-1&&r[t+1][a]===r[t][a])t++;else{if(!(a>0&&r[t][a-1]!==1/0))break;a--}n.push([t,a,r[t][a]-1])}for(let e=0;e<n.length;e++)r[n[e][0]][n[e][1]]--;i.push(n)}let c=new Array(r.length);for(let e=0;e<r.length;e++){c[e]=new Array(r.length);for(let t=0;t<r.length;t++)c[e][t]=r[e][t]===1/0?1/0:0}let s=await se(e+1,c,"tableau");await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<i.length;e++){let r=e/i.length*6/7;await xe(a,i[e],r),await Ee(a,i[e],a.height);let n=K-a.partial_footprint_sum-1,c=a.partial_footprint_sum-a.footprint;for(let t=0;t<i[e].length;t++)a.numbers[i[e][t][0]][i[e][t][1]]--,D&&we(a,i[e][t][0],i[e][t][1],n,c);ye(a),await new Promise(((e,a)=>setTimeout(e,t/5)));let u=[i[e][i[e].length-1][0],i[e][0][1]],f=[],h=s.height+1;for(let e=o[u[1]];e<=u[0];e++)f.push([e,u[1],h]);let p=f[f.length-1];for(let e=u[1]-1;e>=l[u[0]];e--)f.push([u[0],e,h]);await Se(a,i[e],s,f),f=[];for(let e=u[0]-1;e>=o[u[1]];e--)f.push([e,u[1],h]);Te(s,f),f=[];for(let e=u[1]-1;e>=l[u[0]];e--)f.push([u[0],e,h]);Te(s,f),await ve(s,[p]),n=K-s.partial_footprint_sum-1,c=s.partial_footprint_sum-s.footprint,s.numbers[p[0]][p[1]]++,ye(s),D&&we(s,p[0],p[1],n,c),s.height=Math.max(s.height,s.numbers[p[0]][p[1]]),s.size=Math.max(s.size,s.height),await new Promise(((e,a)=>setTimeout(e,t)))}ue(e),G=!1}(parseInt(T.value))})),Page.element.querySelector("#hillman-grassl-inverse-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let r=J[e];if("tableau"!==r.type)return ce(`Array at index ${e} is not a tableau!`),void(G=!1);let n=_.cloneDeep(r.numbers),o=[],l=[];for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++)if(n[e][t]!==1/0)for(let a=0;a<n[e][t];a++)l.push([e,t,a]);_e(r,l);let i=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;i[e]=t}let c=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;c[e]=t}let s=new Array(n.length);for(let e=0;e<n.length;e++){s[e]=new Array(n.length);for(let t=0;t<n.length;t++)s[e][t]=n[e][t]===1/0?1/0:0}let u=_.cloneDeep(s),f=await se(e+1,s,"pp");for(let e=0;e<n.length;e++)for(let t=n.length-1;t>=i[e];t--)for(;0!==n[t][e];){let a=[],r=t,l=c[t];for(;r>=0;){let t=l;if(0!==r)for(;u[r][t]!==u[r-1][t]&&t<e;)t++;else t=e;for(let e=l;e<=t;e++)a.push([r,e,u[r][e]]);if(!(r-1>=i[t]))break;r--,l=t}for(let e=0;e<a.length;e++)u[a[e][0]][a[e][1]]++;o.push([a,[t,e,n[t][e]-1]]),n[t][e]--}await new Promise(((e,a)=>setTimeout(e,t/2)));for(let e=0;e<o.length;e++){let n=e/o.length*6/7;await xe(r,[o[e][1]],n);let l=o[e][1][0],s=o[e][1][1],u=r.size;for(let e=i[s];e<l;e++)r.cubes[e][s][u]=fe(r,s,u,e),r.cubes[e][s][u].material.forEach((e=>e.color.setHSL(n,1,a)));for(let e=c[l];e<s;e++)r.cubes[l][e][u]=fe(r,e,u,l),r.cubes[l][e][u].material.forEach((e=>e.color.setHSL(n,1,a)));await Ee(r,[o[e][1]],u);let h=[];for(let e=l-1;e>=i[s];e--)h.push([e,s,u]);let p=Pe(r,h);h=[];for(let e=s-1;e>=c[l];e--)h.push([l,e,u]);let g=Pe(r,h);await Promise.all([p,g]),h=[];for(let e=c[l];e<s;e++)h.push([l,e,u]);h.push([l,s,r.numbers[l][s]-1]);for(let e=l-1;e>=i[s];e--)h.push([e,s,u]);let m=o[e][0],d=f.height+1;if(m.forEach((e=>e[2]=d)),r.numbers[l][s]--,ye(r),D){we(r,l,s,K-r.partial_footprint_sum-1,r.partial_footprint_sum-r.footprint)}if(await Se(r,h,f,m),await ve(f,m),m.forEach((e=>{f.numbers[e[0]][e[1]]++})),ye(f),D){let e=K-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;m.forEach((a=>{we(f,a[0],a[1],e,t)}))}await new Promise(((e,a)=>setTimeout(e,t/2)))}ue(e),G=!1,console.log("hi!")}(parseInt(T.value))})),Page.element.querySelector("#pak-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let a=J[e];if("pp"!==a.type)return ce(`Array at index ${e} is not a plane partition!`),void(G=!1);let r=a.numbers;D||await ge();let n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);await _e(a,n);let o=a.footprint*a.footprint,l=0;for(let e=0;e<a.footprint;e++)for(let n=0;n<a.footprint;n++){if(r[e][n]===1/0){let r=a.cubes[e][n].map(((t,a)=>[e,n,a]));await Te(a,r,!0),Re(a,[[e,n]]),a.cubes[e][n]=[],await new Promise(((e,a)=>setTimeout(e,t)));continue}let i=[],c=0;for(;e+c<a.footprint&&n+c<a.footprint;)i.push([e+c,n+c,r[e+c][n+c]-1]),c++;c=i[0][0];let s=i[0][1],u=[];for(let e=r[c][s]-2;e>=0;e--)u.push([c,s,e]);xe(a,u,l/o*6/7),u=[],i.forEach((e=>{e[2]>=0&&u.push(e)})),await xe(a,u,l/o*6/7);let f=new Array(i.length);i.forEach(((e,t)=>{let n=e[0],o=e[1],l=0,i=0;n<a.footprint-1&&(l=r[n+1][o]),o<a.footprint-1&&(i=r[n][o+1]),f[t]=Math.max(l,i),t>0?(l=r[n-1][o],i=r[n][o-1],f[t]+=Math.min(l,i)-r[n][o]):f[t]=r[n][o]-f[t]}));for(let e=0;e<i.length;e++){if(c=i[e][0],s=i[e][1],f[e]>r[c][s]){let t=[];for(let n=r[c][s];n<f[e];n++)a.cubes[c][s][n]=fe(a,s,n,c),t.push([c,s,n]);D?Pe(a,t):await Pe(a,t)}else if(f[e]<r[c][s]){let t=[];for(let a=r[c][s]-1;a>=f[e];a--)t.push([c,s,a]);D?Te(a,t):await Te(a,t)}if(r[c][s]=f[e],D){let e=K-a.partial_footprint_sum-1,t=a.partial_footprint_sum-a.footprint;we(a,c,s,e,t)}}let h=[];u.forEach(((e,t)=>{0!==t&&e[2]<r[e[0]][e[1]]&&h.push(e)})),D?_e(a,h):await _e(a,h),l++,ye(a),0!==u.length&&await new Promise(((e,a)=>setTimeout(e,t)))}me(!0),a.type="tableau",G=!1}(parseInt(T.value))})),Page.element.querySelector("#pak-inverse-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let n=J[e];if("tableau"!==n.type)return ce(`Array at index ${e} is not a tableau!`),void(G=!1);let o=n.numbers;D||await ge();let l=[];for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)if(o[e][t]!==1/0)for(let a=0;a<o[e][t];a++)l.push([e,t,a]);await _e(n,l);let i=n.footprint*n.footprint,c=0;for(let e=n.footprint-1;e>=0;e--)for(let l=n.footprint-1;l>=0;l--){if(o[e][l]===1/0){n.cubes[e][l]=new Array(r);let a=[];for(let t=0;t<r;t++)n.cubes[e][l][t]=fe(n,l,t,e,0,0,.6),n.cubes[e][l][t].material.forEach((e=>a.push(e)));n.floor[e][l]=he(n,l,e),n.floor[e][l].material.forEach((e=>a.push(e))),await new Promise(((e,r)=>{anime({targets:a,opacity:1,duration:t,easing:"easeOutQuad",complete:e})})),await new Promise(((e,a)=>setTimeout(e,t)));continue}let s=[],u=0;for(;e+u<n.footprint&&l+u<n.footprint;)s.push([e+u,l+u,o[e+u][l+u]-1]),u++;u=s[0][0];let f=s[0][1],h=new Array(s.length),p=!1;if(s.forEach(((e,t)=>{let a=e[0],r=e[1],l=0,i=0;a<n.footprint-1&&(l=o[a+1][r]),r<n.footprint-1&&(i=o[a][r+1]),h[t]=Math.max(l,i),t>0?(l=o[a-1][r],i=o[a][r-1],h[t]+=Math.min(l,i)-o[a][r]):h[t]+=o[a][r],p||h[t]===o[a][r]||(p=!0)})),0!==o[u][f]){let e=[];for(let t=o[u][f]-1;t>=0;t--)e.push([u,f,t]);xe(n,e,c/i*6/7)}else if(0!==h[0])n.cubes[u][f][0]=fe(n,f,0,u,c/i*6/7,1,a),o[u][f]=1,Pe(n,[[u,f,0]]);else if(!p){c++;continue}await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<s.length;e++){if(u=s[e][0],f=s[e][1],h[e]>o[u][f]){let t=[];for(let r=o[u][f];r<h[e];r++)n.cubes[u][f][r]=fe(n,f,r,u,c/i*6/7,1,a),t.push([u,f,r]);D?Pe(n,t):await Pe(n,t)}else if(h[e]<o[u][f]){let t=[];for(let a=o[u][f]-1;a>=h[e];a--)t.push([u,f,a]);D?Te(n,t):await Te(n,t)}if(o[u][f]=h[e],D){let e=K-n.partial_footprint_sum-1,t=n.partial_footprint_sum-n.footprint;we(n,u,f,e,t)}}c++,ye(n),await new Promise(((e,a)=>setTimeout(e,t)))}me(!0),n.type="pp",G=!1}(parseInt(T.value))})),Page.element.querySelector("#sulzgruber-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let a=J[e];if("pp"!==a.type)return ce(`Array at index ${e} is not a plane partition!`),void(G=!1);let r=_.cloneDeep(a.numbers),n=[];for(let e=0;e<r.length;e++)for(let t=0;t<r.length;t++)if(r[e][t]!==1/0)for(let a=0;a<r[e][t];a++)n.push([e,t,a]);_e(a,n);let o=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;o[e]=t}let l=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;l[e]=t}let i={},c={};for(let e=0;e<r.length;e++)c[-e]=[e,0];for(let e=1;e<r.length;e++)c[e]=[0,e];for(let e=1-r.length;e<r.length;e++){let t=c[e][0],a=c[e][1];for(;t<r.length&&a<r.length&&r[t][a]===1/0;)t++,a++;if(c[e]=[t,a],t===r.length||a===r.length){i[e]=-1;continue}let n=0===a||r[t][a-1]===1/0,o=0===t||r[t-1][a]===1/0;i[e]=n&&o?0:n?3:o?2:1}let s=[];for(let e=1-r.length;e<r.length;e++){if(1===i[e]||3===i[e])continue;let t=c[e][0],a=c[e][1];if(0!==r[t][a])for(;;){let n=!1;for(;t<r.length&&a<r.length&&0!==r[t][a];){if((a<r.length-1&&r[t][a]>r[t][a+1]||a===r.length-1&&r[t][a]>0)&&(0===i[e]||2===i[e]&&(t<r.length-1&&r[t][a]>r[t+1][a]||t===r.length-1&&r[t][a]>0))){n=!0;break}t++,a++}if(!n)break;let o=t,c=a,u=[[o,c,r[o][c]-1]];for(;;){let e=c-o;if(o<r.length-1&&r[o][c]===r[o+1][c]&&(0===i[e]||3===i[e]))o++;else{if(!(c>l[o]&&(o===r.length-1||o<r.length-1&&r[o][c]>r[o+1][c])))break;c--}u.push([o,c,r[o][c]-1])}u.forEach((e=>r[e[0]][e[1]]--)),s.push(u)}}let u=new Array(r.length);for(let e=0;e<r.length;e++){u[e]=new Array(r.length);for(let t=0;t<r.length;t++)u[e][t]=r[e][t]===1/0?1/0:0}let f=await se(e+1,u,"tableau");await new Promise(((e,a)=>setTimeout(e,t)));for(let e=0;e<s.length;e++){let r=e/s.length*6/7;await xe(a,s[e],r),await Ee(a,s[e],a.height+1);let n=K-a.partial_footprint_sum-1,i=a.partial_footprint_sum-a.footprint;s[e].forEach((e=>{a.numbers[e[0]][e[1]]--,D&&we(a,e[0],e[1],n,i)})),ye(a),await new Promise(((e,a)=>setTimeout(e,t/5)));let u=s[e][s[e].length-1][0],h=c[s[e][s[e].length-1][1]-u+s[e].length-1][1],p=[],g=Math.max(a.height+1,f.height+1);for(let e=o[h];e<=u;e++)p.push([e,h,g]);for(let e=h-1;e>=l[u];e--)p.push([u,e,g]);await Se(a,s[e],f,p),p=[];for(let e=u-1;e>=o[h];e--)p.push([e,h,g]);Te(f,p),p=[];for(let e=h-1;e>=l[u];e--)p.push([u,e,g]);Te(f,p),await ve(f,[[u,h,g]]),n=K-f.partial_footprint_sum-1,i=f.partial_footprint_sum-f.footprint,f.numbers[u][h]++,D&&we(f,u,h,n,i),ye(f),await new Promise(((e,a)=>setTimeout(e,t)))}ue(e),G=!1}(parseInt(T.value))})),Page.element.querySelector("#sulzgruber-inverse-button").addEventListener("click",(()=>{!async function(e){if(G)return;if(G=!0,e>=J.length||e<0)return ce(`No array at index ${e}`),void(G=!1);let r=J[e];if("tableau"!==r.type)return ce(`Array at index ${e} is not a tableau!`),void(G=!1);let n=r.numbers,o=[];for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++)if(n[e][t]!==1/0)for(let a=0;a<n[e][t];a++)o.push([e,t,a]);_e(r,o);let l=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;l[e]=t}let i=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;i[e]=t}let c={};for(let e=0;e<n.length;e++)c[-e]=[e,0];for(let e=1;e<n.length;e++)c[e]=[0,e];for(let e=1-n.length;e<n.length;e++){let t=c[e][0],a=c[e][1];for(;t<n.length&&a<n.length&&n[t][a]===1/0;)t++,a++;c[e]=[t,a]}let s=0,u=new Array(n.length);for(let e=0;e<n.length;e++){u[e]=new Array(n.length);for(let t=0;t<n.length;t++)n[e][t]===1/0?u[e][t]=1/0:(u[e][t]=0,s+=n[e][t])}let f=await se(e+1,u,"pp"),h=(f.numbers,0);for(let e=n.length-1;e>=0;e--)for(let o=n.length-1;o>=0;o--)if(n[o][e]!==1/0)for(;0!==n[o][e];){let u=h/s*6/7,p=Math.max(r.size+1,f.size+1);await xe(r,[[o,e,n[o][e]-1]],u),await Ee(r,[[o,e,n[o][e]-1]],p);let g=o,m=e;for(let e=l[m];e<g;e++)r.cubes[e][m][p]=fe(r,m,p,e),r.cubes[e][m][p].material.forEach((e=>e.color.setHSL(u,1,a)));for(let e=i[g];e<m;e++)r.cubes[g][e][p]=fe(r,e,p,g),r.cubes[g][e][p].material.forEach((e=>e.color.setHSL(u,1,a)));let d=[];for(let e=g-1;e>=l[m];e--)d.push([e,m,p]);let y=Pe(r,d);d=[];for(let e=m-1;e>=i[g];e--)d.push([g,e,p]);let b=Pe(r,d);await Promise.all([y,b]),d=[];for(let e=i[g];e<m;e++)d.push([g,e,p]);d.push([g,m,r.numbers[g][m]-1]);for(let e=g-1;e>=l[m];e--)d.push([e,m,p]);let w=i[g]-g,x=w+d.length-1,E=[];for(let e=w;e<=x;e++)E.push(_.clone(c[e]));if(n[g][m]--,ye(r),D){we(r,g,m,K-r.partial_footprint_sum-1,r.partial_footprint_sum-r.footprint)}await Se(r,d,f,E);let v=0,S=f.numbers[E[0][0]][E[0][1]];for(;;){let e=v;for(;e<E.length&&E[e][0]===E[v][0];)e++;d=E.slice(v,e);let t=!0;for(let e=0;e<d.length;e++)if(f.numbers[d[e][0]][d[e][1]]!==S){t=!1;break}if(t){if(await ve(f,d),d.forEach((e=>f.numbers[e[0]][e[1]]++)),ye(f),D){let e=K-f.partial_footprint_sum-1,t=f.partial_footprint_sum-f.footprint;d.forEach((a=>{we(f,a[0],a[1],e,t)}))}v=e}else{let e=_.cloneDeep(E.slice(v));for(let e=v;e<E.length;e++)if(E[e][0]++,E[e][1]++,E[e][0]>f.footprint||E[e][1]>f.footprint)return void console.error("Insertion failed!");let t=E.slice(v);await Se(f,e,f,t),S=f.numbers[E[v][0]][E[v][1]]}if(v===E.length)break}h++,await new Promise(((e,a)=>setTimeout(e,t/2)))}ue(e),G=!1}(parseInt(T.value))}));let R=!1;Page.element.querySelector("#download-button").addEventListener("click",(()=>{R=!0}));const M=new THREE.Scene,A=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),H=new THREE.WebGLRenderer({canvas:i.canvas,antialias:!0});H.setSize(e,e,!1);new THREE.TextureLoader;const L=new THREE.CanvasTexture(c.canvas);L.minFilter=THREE.LinearFilter,L.magFilter=THREE.NearestFilter;const k=new THREE.CanvasTexture(s.canvas);k.minFilter=THREE.LinearFilter,k.magFilter=THREE.NearestFilter;const q=new THREE.CanvasTexture(u.canvas);q.minFilter=THREE.LinearFilter,q.magFilter=THREE.NearestFilter;const $=new THREE.CanvasTexture(f.canvas);$.minFilter=THREE.LinearFilter,$.magFilter=THREE.NearestFilter;const O=new THREE.BoxGeometry;let z=!1;const I=new THREE.BoxGeometry(1,.001,1),Q=(new THREE.BoxGeometry(.001,1,1),new THREE.BoxGeometry(1,1,.001),new THREE.AmbientLight(16777215,.2));M.add(Q);const C=new THREE.PointLight(16777215,3,1e4);C.position.set(750,1e3,500),M.add(C);let F=0,B=0,N=0,W=[];let D=!1,U=!0,j=!1,G=!1,V=10,J=[],K=0,X=0,Y=0,Z=[15,15,15],ee=[0,20,0],te=oe(E.value);function ae(e,t,a){U=!1,B=0,W=[0,0,0,0]}function re(e,t,a,r,n){D||(F+=a,F>3.14159265?F-=6.283185301:F<-3.14159265&&(F+=6.283185301),M.children.forEach((e=>e.rotation.y=F)),N=a)}function ne(e,t,a){if(!D){let e=0;if(W.forEach(((t,a)=>{Math.abs(t)>B&&(B=Math.abs(t),e=a)})),B<.005)return void(B=0);B=W[e]}W=[0,0,0,0]}function oe(e){let t=e.split("\n"),a=t.length,r=new Array(t.length);for(let e=0;e<r.length;e++){r[e]=t[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let n=r[0].length,o=Math.max(a,n),l=new Array(o);for(let e=0;e<a;e++){l[e]=new Array(o);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?l[e][t]=1/0:l[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<o;t++)l[e][t]=0}for(let e=a;e<o;e++){l[e]=new Array(o);for(let t=0;t<o;t++)l[e][t]=0}return l}function le(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let a="";for(let r=0;r<e.length;r++){for(let n=0;n<e.length;n++)if(e[r][n]===1/0){for(let e=0;e<t-1-(0===n);e++)a+=" ";a+="^"}else{let o=`${e[r][n]}`.length;for(let e=0;e<t-o-(0===n);e++)a+=" ";a+=e[r][n]}r!==e.length-1&&(a+="\n")}return a}function ie(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return ce(`Not a valid plane partition! Wrong inequality at (${t}, ${a})`),!1;return!0}function ce(e){Page.Footer.Floating.show_settings_text(e)}function se(e,a,n){return new Promise((async(o,l)=>{let i={type:n,numbers:a,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};D&&await Page.Animate.change_opacity(h,0,t/5),J.splice(e,0,i),i.footprint=i.numbers.length;for(let a=e;a<J.length;a++)J[a].partial_footprint_sum=J[a].footprint,0!==a?(J[a].center_offset=J[a-1].center_offset+J[a-1].footprint/2+J[a].footprint/2+1,J[a].partial_footprint_sum+=J[a-1].partial_footprint_sum+1):J[a].center_offset=0,a!==e&&anime({targets:J[a].cube_group.position,x:J[a].center_offset,y:0,z:-J[a].center_offset,duration:t,easing:"easeInOutQuad"});i.cube_group=new THREE.Object3D,M.add(i.cube_group),i.cube_group.rotation.y=F,i.cubes=new Array(i.footprint),i.floor=new Array(i.footprint);for(let e=0;e<i.footprint;e++){i.cubes[e]=new Array(i.footprint),i.floor[e]=new Array(i.footprint);for(let t=0;t<i.footprint;t++)if(i.numbers[e][t]!==1/0){i.cubes[e][t]=new Array(i.numbers[e][t]),i.numbers[e][t]>i.height&&(i.height=i.numbers[e][t]),i.floor[e][t]=he(i,t,e);for(let a=0;a<i.numbers[e][t];a++)i.cubes[e][t][a]=fe(i,t,a,e)}else if("tableau"!==n){i.cubes[e][t]=new Array(r),i.floor[e][t]=he(i,t,e);for(let a=0;a<r;a++)i.cubes[e][t][a]=fe(i,t,a,e,0,0,.6)}}i.size=Math.max(i.footprint,i.height),K+=i.footprint+1,X=Math.max(X,i.height),Y=Math.max(K,X),1===J.length?(Z=[Y,Y+X/3,Y],ee=[0,Y+10,0],A.left=-Y,A.right=Y,A.top=Y,A.bottom=-Y,A.position.set(Z[0],Z[1],Z[2]),A.rotation.set(-.785398163,.615479709,.523598775),A.updateProjectionMatrix()):me(!0),e!==J.length-1&&await new Promise(((e,a)=>setTimeout(e,t)));let c=[];i.cube_group.traverse((e=>{e.material&&e.material.forEach((e=>c.push(e)))})),await new Promise((async(e,a)=>{anime({targets:c,opacity:1,duration:t/2,easing:"easeOutQuad",complete:e})})),D&&be(),o(i)}))}function ue(e){return new Promise((async(a,r)=>{if(e>=J.length||e<0)ce(`No array at index ${e}`);else{D&&await Page.Animate.change_opacity(h,0,t/5),await new Promise(((a,r)=>{let n=[];J[e].cube_group.traverse((e=>{e.material&&e.material.forEach((e=>n.push(e)))})),anime({targets:n,opacity:0,duration:t/2,easing:"easeOutQuad",complete:a})}));for(let t=0;t<J[e].cubes.length;t++)for(let a=0;a<J[e].cubes[t].length;a++)if(J[e].cubes[t][a])for(let r=0;r<J[e].cubes[t][a].length;r++)J[e].cubes[t][a][r]&&J[e].cubes[t][a][r].material.forEach((e=>e.dispose()));M.remove(J[e].cube_group),K-=J[e].footprint+1,J.splice(e,1);for(let a=e;a<J.length;a++)J[a].partial_footprint_sum=J[a].footprint,0!==a?(J[a].center_offset=J[a-1].center_offset+J[a-1].footprint/2+J[a].footprint/2+1,J[a].partial_footprint_sum+=J[a-1].partial_footprint_sum+1):J[a].center_offset=0,anime({targets:J[a].cube_group.position,x:J[a].center_offset,y:0,z:-J[a].center_offset,duration:t,easing:"easeInOutQuad"});0!==J.length&&me(!0),a()}}))}function fe(e,t,a,r,n=0,o=0,l=.4){const i=[new THREE.MeshStandardMaterial({map:L,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:L,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:L,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:L,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:k,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:k,transparent:!0,opacity:0})];i.forEach((e=>e.color.setHSL(n,o,l)));const c=new THREE.Mesh(O,i);return e.cube_group.add(c),c.position.set(t-(e.footprint-1)/2,a,r-(e.footprint-1)/2),c}function he(e,t,a,r=0,n=0,o=.4){const l=[new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:q,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:$,transparent:!0,opacity:0})];l.forEach((e=>e.color.setHSL(r,n,o)));const i=new THREE.Mesh(I,l);return e.cube_group.add(i),i.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),i}function pe(){return new Promise((async(e,a)=>{j?a():(Page.Animate.change_opacity(w,0,Site.opacity_animation_time).then((()=>{w.textContent="Show 2D View",Page.Animate.change_opacity(w,1,Site.opacity_animation_time)})),j=!0,D&&await Page.Animate.change_opacity(h,0,t/5),D=!1,U=!0,B=0,W=[0,0,0,0],me(!0),anime({targets:A.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:t,easing:"easeInOutQuad",complete:()=>{j=!1,e()}}),J.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),F=0)}))}function ge(){return new Promise((async(e,a)=>{j||D?a():(Page.Animate.change_opacity(w,0,Site.opacity_animation_time).then((()=>{w.textContent="Show 3D View",Page.Animate.change_opacity(w,1,Site.opacity_animation_time)})),z&&await de(),j=!0,D=!0,U=!1,B=0,W=[0,0,0,0],me(!0),anime({targets:A.rotation,x:-1.570796327,y:0,z:0,duration:t,easing:"easeInOutQuad"}),J.forEach((e=>{anime({targets:e.cube_group.rotation,y:0,duration:t,easing:"easeInOutQuad"})})),setTimeout((()=>{be(),Page.Animate.change_opacity(h,1,t/5).then((()=>{j=!1,e()}))}),t))}))}function me(e=!1){if(!e){if(j)return;j=!0}X=0;for(let e=0;e<J.length;e++)X=Math.max(X,J[e].height);Y=Math.max(K,X);let a=(-J[0].footprint/2+J[J.length-1].center_offset+J[J.length-1].footprint/2)/2;Z=[Y+a,Y+X/3,Y-a],ee=[a,Y+10,-a],D?(anime({targets:A.position,x:ee[0],y:ee[1],z:ee[2],duration:t,easing:"easeInOutQuad"}),anime({targets:A,left:-(K/2+.5),right:K/2+.5,top:K/2+.5,bottom:-(K/2+.5),duration:t,easing:"easeInOutQuad",update:()=>A.updateProjectionMatrix(),complete:()=>j=!1}),setTimeout((()=>{be(),Page.Animate.change_opacity(h,1,t/5)}),t)):(anime({targets:A.position,x:Z[0],y:Z[1],z:Z[2],duration:t,easing:"easeInOutQuad"}),anime({targets:A,left:-Y,right:Y,top:Y,bottom:-Y,duration:t,easing:"easeInOutQuad",update:()=>A.updateProjectionMatrix(),complete:()=>j=!1}))}function de(){return new Promise((async(e,a)=>{if(j)return void a();z=!1,Page.Animate.change_opacity(b,0,Site.opacity_animation_time).then((()=>{b.textContent="Show Dimers",Page.Animate.change_opacity(b,1,Site.opacity_animation_time)})),j=!0;let r=[];J.forEach((e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++){for(let n=0;n<e.cubes[t][a].length;n++)n<e.cubes[t][a].length-1&&r.push(e.cubes[t][a][n].material[2]),t<e.footprint-1&&e.cubes[t+1][a].length>=n+1&&r.push(e.cubes[t][a][n].material[4]),a<e.footprint-1&&e.cubes[t][a+1].length>=n+1&&r.push(e.cubes[t][a][n].material[0]),r.push(e.cubes[t][a][n].material[1]),r.push(e.cubes[t][a][n].material[3]),r.push(e.cubes[t][a][n].material[5]);0!==e.cubes[t][a].length&&r.push(e.floor[t][a].material[2])}})),await new Promise(((e,a)=>{anime({targets:[c.ctx,s.ctx,u.ctx,f.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:t/2,easing:"easeOutQuad",complete:e,update:()=>{c.ctx.clearRect(0,0,64,64),c.ctx.fillStyle=`rgba(64, 64, 64, ${c.ctx._alpha})`,c.ctx.fillRect(0,0,64,64),c.ctx.fillStyle=`rgba(128, 128, 128, ${c.ctx._alpha})`,c.ctx.fillRect(4,4,56,56),c.ctx.moveTo(42.7,21.3),c.ctx.lineTo(21.3,42.7),c.ctx.stroke(),L.needsUpdate=!0,s.ctx.clearRect(0,0,64,64),s.ctx.fillStyle=`rgba(64, 64, 64, ${s.ctx._alpha})`,s.ctx.fillRect(0,0,64,64),s.ctx.fillStyle=`rgba(128, 128, 128, ${s.ctx._alpha})`,s.ctx.fillRect(4,4,56,56),s.ctx.moveTo(21.3,21.3),s.ctx.lineTo(42.7,42.7),s.ctx.stroke(),k.needsUpdate=!0,u.ctx.clearRect(0,0,64,64),u.ctx.fillStyle=`rgba(32, 32, 32, ${u.ctx._alpha})`,u.ctx.fillRect(0,0,64,64),u.ctx.fillStyle=`rgba(64, 64, 64, ${u.ctx._alpha})`,u.ctx.fillRect(4,4,56,56),u.ctx.moveTo(42.7,21.3),u.ctx.lineTo(21.3,42.7),u.ctx.stroke(),q.needsUpdate=!0,f.ctx.clearRect(0,0,64,64),f.ctx.fillStyle=`rgba(32, 32, 32, ${f.ctx._alpha})`,f.ctx.fillRect(0,0,64,64),f.ctx.fillStyle=`rgba(64, 64, 64, ${f.ctx._alpha})`,f.ctx.fillRect(4,4,56,56),f.ctx.moveTo(21.3,21.3),f.ctx.lineTo(42.7,42.7),f.ctx.stroke(),$.needsUpdate=!0}})})),r.forEach((e=>e.opacity=1)),j=!1,e()}))}function ye(e){e.height=0,e.numbers.forEach((t=>{t.forEach((t=>{t!==1/0&&(e.height=Math.max(t,e.height))}))})),e.size=Math.max(e.footprint,e.height);let t=X;X=0,J.forEach((e=>X=Math.max(e.height,X))),Y=Math.max(K,X),X!==t&&me()}function be(){V=o.canvas_width/(K+1);let e=Math.max(`${X}`.length,2);o.ctx.font=V/e+"px monospace",o.ctx.clearRect(0,0,o.canvas_width,o.canvas_height),J.forEach((e=>{let t=K-e.partial_footprint_sum-1,a=e.partial_footprint_sum-e.footprint;for(let r=0;r<e.footprint;r++)for(let n=0;n<e.footprint;n++)we(e,r,n,t,a)}))}function we(e,t,a,r,n){if(o.ctx.clearRect(V*(a+n+1),V*(t+r+1),V,V),e.numbers[t][a]!==1/0){let l=o.ctx.measureText(e.numbers[t][a]);o.ctx.fillText(e.numbers[t][a],V*(a+n+1)+(V-l.width)/2,V*(t+r+1)+(V+l.actualBoundingBoxAscent-l.actualBoundingBoxDescent)/2)}}function xe(e,r,n){return new Promise(((o,l)=>{if(0===r.length)return void o();let i=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>i.push(e.color)))})),i.forEach((e=>e.getHSL(e))),anime({targets:i,s:1,duration:t,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",update:()=>i.forEach((e=>e.setHSL(n,e.s,a))),complete:o})}))}function _e(e,r){return new Promise(((n,o)=>{let l=[];r.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>l.push(e.color)))})),l.forEach((e=>e.getHSL(e))),anime({targets:l,s:0,duration:t,easing:"easeOutQuad",update:()=>l.forEach((e=>e.setHSL(e.h,e.s,a))),complete:n})}))}function Ee(e,a,r){return new Promise(((n,o)=>{let l=D?0:t,i=[];a.forEach((t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")})),anime({targets:i,y:r,duration:l,easing:"easeInOutQuad",complete:n})}))}function ve(e,a){return new Promise(((r,n)=>{let o=D?0:t,l=[];a.forEach((t=>{l.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")})),anime({targets:l,y:(t,r)=>e.numbers[a[r][0]][a[r][1]],duration:o,easing:"easeInOutQuad",complete:()=>{a.forEach((t=>{e.cubes[t[0]][t[1]][e.numbers[t[0]][t[1]]]=e.cubes[t[0]][t[1]][t[2]],e.cubes[t[0]][t[1]][t[2]]=null})),r()}})}))}function Se(e,a,r,n){return new Promise(((o,l)=>{let i=[];a.forEach((t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),r.cube_group.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")})),anime({targets:i,x:(e,t)=>n[t][1]-(r.footprint-1)/2,y:(e,t)=>n[t][2],z:(e,t)=>n[t][0]-(r.footprint-1)/2,duration:t,easing:"easeInOutQuad",complete:()=>{n.forEach(((t,n)=>{r.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[t[0]][t[1]][t[2]]&&console.warn(`Moving a cube to a location that's already occupied: ${t}. This is probably not what you want to do.`),r.cubes[t[0]][t[1]][t[2]]=e.cubes[a[n][0]][a[n][1]][a[n][2]],e.cubes[a[n][0]][a[n][1]][a[n][2]]=null})),o()}})}))}function Pe(e,a){return new Promise(((r,n)=>{if(0===a.length)return void r();let o=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>o.push(e))),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")})),anime({targets:o,opacity:1,duration:t/2,delay:(e,a)=>Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:r})}))}function Te(e,a,r=!1){return new Promise(((n,o)=>{let l=[];a.forEach((t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach((e=>l.push(e)))})),anime({targets:l,opacity:0,duration:t/2,delay:(e,a)=>!r*Math.floor(a/6)*t/10,easing:"easeOutQuad",complete:()=>{l.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null})),n()}})}))}function Re(e,a){return new Promise(((r,n)=>{let o=[];a.forEach((t=>{e.floor[t[0]][t[1]].material.forEach((e=>o.push(e)))})),anime({targets:o,opacity:0,duration:t/2,easing:"easeOutQuad",complete:()=>{o.forEach((e=>e.dispose())),a.forEach((t=>{e.cube_group.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null})),r()}})}))}v.value=E.value,ie(te)&&se(J.length,te,"pp"),function e(){H.render(M,A),W.push(N),W.shift(),N=0,0!==B&&(F+=B,M.children.forEach((e=>e.rotation.y=F)),B*=.94,Math.abs(B)<5e-4&&(B=0));F>3.14159265?F-=6.283185301:F<-3.14159265&&(F+=6.283185301);R&&(R=!1,i.canvas.toBlob((e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()})));window.requestAnimationFrame(e)}(),Page.show()}();