import{showPage}from"../../../scripts/src/loadPage.min.js";import{PlanePartitions}from"./class.min.js";import{arrayToAscii,parseArray}from"./parseAndVerify.min.js";import{Button,ToggleButton,equalizeTextButtons}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{equalizeAppletColumns}from"/scripts/src/layout.min.js";import{$,$$}from"/scripts/src/main.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";import{Textarea}from"/scripts/src/textareas.min.js";export default function(){const d=new PlanePartitions({canvas:$("#output-canvas"),numbersCanvas:$("#numbers-canvas")}),e=new TextBox({element:$("#resolution-input"),name:"Resolution",value:2e3,minValue:500,maxValue:4e3,onInput:function(){d.resolution=e.value*siteSettings.resolutionMultiplier,d.renderer.setSize(d.resolution,d.resolution,!1),d.needNewFrame=!0}}),n=new TextBox({element:$("#edit-array-index-input"),name:"Index to Edit",value:0,onEnter:v,onInput:g}),t=new TextBox({element:$("#remove-array-index-input"),name:"Index to Remove",value:0,onEnter:A}),a=new TextBox({element:$("#algorithm-index-input"),name:"Index to Use",value:0}),r=new Checkbox({element:$("#maximum-speed-checkbox"),name:"Maximum speed",onInput:function(){d.animationTime=r.checked?60:600}}),o=new Dropdown({element:$("#categories-dropdown"),name:"Menus",options:{viewControls:"View Controls",addArray:"Add Array",editArray:"Edit Array",removeArray:"Remove Array",algorithms:"Algorithms"},onInput:function(){u[p].forEach(element=>c.appendChild(element)),u[p].forEach(element=>element.classList.remove("moved-to-left")),u[p].forEach(element=>element.classList.remove("moved-to-right")),p=o.value||"viewControls",u[p].forEach(element=>w.appendChild(element)),equalizeTextButtons(),setTimeout(equalizeTextButtons,10),equalizeAppletColumns(),setTimeout(equalizeAppletColumns,10),"editArray"===p&&g()}}),i=new Textarea({element:$("#add-array-textarea"),name:"Array",allowEnter:!0,onEnter:h}),l=new Textarea({element:$("#edit-array-textarea"),name:"Array",allowEnter:!0,onEnter:v});let s;const m=new ToggleButton({element:$("#switch-view-button"),name0:"Show 2D View",name1:"Show Hex View",persistState:!1,onClick0:()=>{d.dimersShown&&s.setState({newState:!1}),d.show2dView()},onClick1:()=>{d.showHexView()}}),u=(s=new ToggleButton({element:$("#show-dimers-button"),name0:"Show Dimers",name1:"Hide Dimers",persistState:!1,onClick0:()=>{d.in2dView&&m.setState({newState:!1}),d.showDimers()},onClick1:()=>{d.hideDimers()}}),new Button({element:$("#add-array-button"),name:"Add",onClick:h}),new Button({element:$("#edit-array-button"),name:"Edit",onClick:v}),new Button({element:$("#remove-array-button"),name:"Remove",onClick:A}),new Button({element:$("#hillman-grassl-button"),name:"Hillman-Grassl",onClick:()=>d.runAlgorithm("hillmanGrassl",a.value)}),new Button({element:$("#hillman-grassl-inverse-button"),name:"Hillman-Grassl Inverse",onClick:()=>d.runAlgorithm("hillmanGrasslInverse",a.value)}),new Button({element:$("#pak-button"),name:"Pak",onClick:()=>d.runAlgorithm("pak",a.value)}),new Button({element:$("#pak-inverse-button"),name:"Pak Inverse",onClick:()=>d.runAlgorithm("pakInverse",a.value)}),new Button({element:$("#sulzgruber-button"),name:"Sulzgruber",onClick:()=>d.runAlgorithm("sulzgruber",a.value)}),new Button({element:$("#sulzgruber-inverse-button"),name:"Sulzgruber Inverse",onClick:()=>d.runAlgorithm("sulzgruberInverse",a.value)}),new Button({element:$("#rsk-button"),name:"RSK",onClick:()=>d.runAlgorithm("rsk",a.value)}),new Button({element:$("#rsk-inverse-button"),name:"RSK Inverse",onClick:()=>d.runAlgorithm("rskInverse",a.value)}),new Button({element:$("#download-button"),name:"Download",onClick:()=>{d.needDownload=!0,d.needNewFrame=!0}}),{viewControls:$$(".view-controls-section"),addArray:$$(".add-array-section"),editArray:$$(".edit-array-section"),removeArray:$$(".remove-array-section"),algorithms:$$(".algorithms-section")}),c=$("#category-holder"),w=$("#canvas-landscape-left");let p="viewControls";async function h(){d.addNewArray({index:d.arrays.length,numbers:parseArray(i.value)})}async function v(){await d.editArray(n.value,parseArray(l.value)),l.value=arrayToAscii(d.arrays[n.value].numbers)}function g(){var e=n.value;e>=d.arrays.length||e<0||l.setValue(arrayToAscii(d.arrays[e].numbers))}function A(){d.removeArray(t.value)}u[p].forEach(element=>w.appendChild(element)),async function(){console.clear(),d.abConfigMode=!0,d.infiniteHeight=16,d.animationTime=0;var e=[3,2],n=[2,1,1],t=[4,2,1],[a,r]=d.getMinimalABConfig({lambda:e,mu:n,nu:t,negativeWidth:2}),o=(console.log(d.isValidABConfig({lambda:e,mu:n,nu:t,A:a,B:r})[0]),d.printABConfig({A:a,B:r}),0*e.concat(n).concat(t).reduce((a,b)=>a+b));for(let u=0;u<o;u++){var i,l;Math.random()<.5?(i=Math.floor(Math.random()*a.length),l=Math.floor(Math.random()*a[0].length),-4===a[i][l]||(a[i][l]--,d.isValidABConfig({lambda:e,mu:n,nu:t,A:a,B:r})[0])||a[i][l]++):(i=Math.floor(Math.random()*r.length),l=Math.floor(Math.random()*r[0].length),r[i][l]--,d.isValidABConfig({lambda:e,mu:n,nu:t,A:a,B:r})[0]||r[i][l]++)}d.printABConfig({A:a,B:r}),d.testAllEntriesOfABConfig({lambda:e,mu:n,nu:t,A:a,B:r,onlyUnboundedBelow:!1});var[s,m]=d.getArrayVersionOfABConfig({lambda:e,mu:n,nu:t,A:a,B:r});await d.addNewArray({index:0,numbers:s}),await d.addNewArray({index:0,numbers:m}),d.updateCameraHeight(),d.colorABConfigRegions({bigA:s,bigB:m,lambda:e,mu:n,nu:t,arrayA:d.arrays[1],arrayB:d.arrays[0]})}(),showPage()}