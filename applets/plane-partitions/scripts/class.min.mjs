import{Applet}from"../../../scripts/src/applets.min.mjs";class PlanePartitions extends Applet{loadPromise=null;wilsonNumbers=null;wilsonHidden=null;wilsonHidden2=null;wilsonHidden3=null;wilsonHidden4=null;useFullscreenButton=!1;resolution=2e3;animationTime=600;asymptoteLightness=.6;cubeLightness=.4;floorLightness=.4;infiniteHeight=100;addWalls=!1;wallSize=30;scene=null;orthographicCamera=null;renderer=null;loader=null;cubeTexture=null;cubeTexture2=null;floorTexture=null;floorTexture2=null;cubeGeometry=null;floorGeometry=null;wallLeftGeometry=null;wallRightGeometry=null;ambientLight=null;dimersShown=!1;ambientLight=null;pointLight=null;rotationY=0;rotationYVelocity=0;nextRotationYVelocity=0;lastRotationYVelocities=[];rotationYVelocityFriction=.94;rotationYVelocityStartThreshhold=.005;rotationYVelocityStopThreshhold=5e-4;in2dView=!1;inExactHexView=!0;currentlyAnimatingCamera=!1;currentlyRunningAlgorithm=!1;needDownload=!1;fontSize=10;arrays=[];totalArrayFootprint=0;totalArrayHeight=0;totalArraySize=0;hexViewCameraPos=[15,15,15];_2dViewCameraPos=[0,20,0];algorithmData={hillmanGrassl:{method:this.hillmanGrassl,inputType:["pp"]},hillmanGrasslInverse:{method:this.hillmanGrasslInverse,inputType:["tableau"]},pak:{method:this.pak,inputType:["pp"]},pakInverse:{method:this.pakInverse,inputType:["tableau"]},sulzgruber:{method:this.sulzgruber,inputType:["pp"]},sulzgruberInverse:{method:this.sulzgruberInverse,inputType:["tableau"]},rsk:{method:this.rsk,inputType:["ssyt","ssyt"],sameShape:!0},rskInverse:{method:this.rskInverse,inputType:["tableau"]},godar1:{method:this.godar1,inputType:["pp"]},godar1Inverse:{method:this.godar1Inverse,inputType:["pp","pp"]}};constructor(t,e,i=!0){super(t),this.useFullscreenButton=i;var i=this.createHiddenCanvas(),a=this.createHiddenCanvas(),r=this.createHiddenCanvas(),s=this.createHiddenCanvas(),n={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!1,mousedownCallback:this.onGrabCanvas.bind(this),touchstartCallback:this.onGrabCanvas.bind(this),mousedragCallback:this.onDragCanvas.bind(this),touchmoveCallback:this.onDragCanvas.bind(this),mouseupCallback:this.onReleaseCanvas.bind(this),touchendCallback:this.onReleaseCanvas.bind(this)},e=(this.wilsonNumbers=new Wilson(e,n),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),Page.setElementStyles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0),{canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:this.useFullscreenButton,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:this.switchFullscreen.bind(this)}),n=(this.wilson=new Wilson(t,e),{renderer:"cpu",canvasWidth:64,canvasHeight:64});this.wilsonHidden=new Wilson(i,n),this.wilsonHidden2=new Wilson(a,n),this.wilsonHidden3=new Wilson(r,n),this.wilsonHidden4=new Wilson(s,n),this.wilsonHidden.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden.ctx.Alpha=1,this.wilsonHidden.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.lineWidth=6,this.wilsonHidden2.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden2.ctx.Alpha=1,this.wilsonHidden2.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.lineWidth=6,this.wilsonHidden3.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden3.ctx.Alpha=1,this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.lineWidth=6,this.wilsonHidden4.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden4.ctx.Alpha=1,this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.lineWidth=6,this.loadPromise=new Promise(async(t,e)=>{Site.scriptsLoaded.three||(await Site.loadScript("/scripts/three.min.js"),Site.scriptsLoaded.three=!0),Site.scriptsLoaded.lodash||(await Site.loadScript("/scripts/lodash.min.js"),Site.scriptsLoaded.lodash=!0),this.scene=new THREE.Scene,this.scene.background=new THREE.Color(0),this.orthographicCamera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0}),this.renderer.setSize(this.resolution,this.resolution,!1),this.loader=new THREE.TextureLoader,this.cubeTexture=new THREE.CanvasTexture(this.wilsonHidden.canvas),this.cubeTexture.minFilter=THREE.LinearFilter,this.cubeTexture.magFilter=THREE.NearestFilter,this.cubeTexture2=new THREE.CanvasTexture(this.wilsonHidden2.canvas),this.cubeTexture2.minFilter=THREE.LinearFilter,this.cubeTexture2.magFilter=THREE.NearestFilter,this.floorTexture=new THREE.CanvasTexture(this.wilsonHidden3.canvas),this.floorTexture.minFilter=THREE.LinearFilter,this.floorTexture.magFilter=THREE.NearestFilter,this.floorTexture2=new THREE.CanvasTexture(this.wilsonHidden4.canvas),this.floorTexture2.minFilter=THREE.LinearFilter,this.floorTexture2.magFilter=THREE.NearestFilter,this.cubeGeometry=new THREE.BoxGeometry,this.dimersShown=!1,this.floorGeometry=new THREE.BoxGeometry(1,.001,1),this.wallLeftGeometry=new THREE.BoxGeometry(.001,1,1),this.wallRightGeometry=new THREE.BoxGeometry(1,1,.001),this.ambientLight=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,3,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.drawFrame(),t()})}onGrabCanvas(t,e,i){this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0]}onDragCanvas(t,e,i,a,r){this.in2dView||(this.rotationY+=i,this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.nextRotationYVelocity=i)}onReleaseCanvas(t,e,i){if(!this.in2dView){let i=0;if(this.lastRotationYVelocities.forEach((t,e)=>{Math.abs(t)>this.rotationYVelocity&&(this.rotationYVelocity=Math.abs(t),i=e)}),this.rotationYVelocity<this.rotationYVelocityStartThreshhold)return void(this.rotationYVelocity=0);this.rotationYVelocity=this.lastRotationYVelocities[i]}this.lastRotationYVelocities=[0,0,0,0]}drawFrame(){this.renderer.render(this.scene,this.orthographicCamera),this.lastRotationYVelocities.push(this.nextRotationYVelocity),this.lastRotationYVelocities.shift(),(this.nextRotationYVelocity=0)!==this.rotationYVelocity&&(this.rotationY+=this.rotationYVelocity,this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.rotationYVelocity*=this.rotationYVelocityFriction,Math.abs(this.rotationYVelocity)<this.rotationYVelocityStopThreshhold)&&(this.rotationYVelocity=0),this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.needDownload&&(this.needDownload=!1,this.wilson.canvas.toBlob(t=>{var e=document.createElement("a");e.download="a-plane-partition.png",e.href=window.URL.createObjectURL(t),e.click(),e.remove()})),window.requestAnimationFrame(this.drawFrame.bind(this))}switchFullscreen(){if(this.useFullscreenButton)try{document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(t){}this.in2dView||this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.wilsonNumbers.fullscreen.switchFullscreen()}generateRandomPlanePartition(){var i=Math.floor(3*Math.random())+5,t=Math.floor(5*Math.random())+10,a=new Array(i);for(let t=0;t<i;t++)a[t]=new Array(i);a[0][0]=t;for(let t=1;t<i;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let e=1;e<i;e++){a[e][0]=Math.max(a[e-1][0]-Math.floor(4*Math.random()),0);for(let t=1;t<i;t++)a[e][t]=Math.max(Math.min(a[e][t-1],a[e-1][t])-Math.floor(4*Math.random()),0)}for(let t=0;t<i;t++)a[i-1][t]=0,a[t][i-1]=0;return a}generateRandomTableau(){var i=Math.floor(3*Math.random())+5,a=new Array(i);for(let e=0;e<i;e++){a[e]=new Array(i);for(let t=0;t<i;t++)Math.random()<.75/i?a[e][t]=Math.floor(3*Math.random())+1:a[e][t]=0}for(let t=0;t<i;t++)a[t][i-1]=0,a[i-1][t]=0;return a}generateRandomSsyt(){var i=Math.floor(3*Math.random())+2,a=new Array(i);for(let t=0;t<i;t++)a[t]=new Array(i);a[0][0]=Math.floor(2*Math.random());for(let t=1;t<i;t++)a[0][t]=a[0][t-1]+Math.floor(2*Math.random());for(let e=1;e<i;e++){a[e][0]=a[e-1][0]+1+Math.floor(2*Math.random());for(let t=1;t<i;t++)a[e][t]=Math.max(a[e][t-1],a[e-1][t]+1)+Math.floor(2*Math.random())}return a}parseArray(t){var i=t.split("\n");let a=i.length;var r=new Array(i.length);for(let e=0;e<r.length;e++){r[e]=i[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let e=r[0].length;if(-1===t.indexOf(">")){for(let t=0;t<r.length;t++)r[t].push("0");e++}-1===t.indexOf("v")&&(r.push(["0"]),a++);var s=Math.max(a,e),n=new Array(s);for(let e=0;e<a;e++){n[e]=new Array(s);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?n[e][t]=1/0:">"===r[e][t]?n[e][t]=n[e][t-1]:"v"===r[e][t]?n[e][t]=n[e-1][t]:n[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<s;t++)n[e][t]=0}for(let e=a;e<s;e++){n[e]=new Array(s);for(let t=0;t<s;t++)n[e][t]=0}return n}arrayToAscii(i){let a=1;for(let e=0;e<i.length;e++)for(let t=0;t<i.length;t++)i[e][t]!==1/0&&(a=Math.max(a,(""+i[e][t]).length));a++;let r="";for(let t=0;t<i.length-1;t++){for(let e=0;e<i.length-1;e++)if(i[t][e]===1/0){for(let t=0;t<a-1-(0===e);t++)r+=" ";r+="^"}else{var s=(""+i[t][e]).length;for(let t=0;t<a-s-(0===e);t++)r+=" ";r+=i[t][e]}if(0!==i[t][i.length-1]){for(let t=0;t<a-1;t++)r+=" ";r+=">"}t!==i.length-2&&(r+="\n")}if(0!==i[i.length-1][0]){r+="\n";for(let e=0;e<i.length-1;e++)if(0!==i[i.length-1][e]){for(let t=0;t<a-1-(0===e);t++)r+=" ";r+="v"}}return r}verifyPp(i){for(let e=0;e<i.length-1;e++)for(let t=0;t<i[e].length-1;t++)if(i[e][t]<i[e+1][t]||i[e][t]<i[e][t+1])return!1;return!0}verifySsyt(i){for(let e=0;e<i.length-1;e++)for(let t=0;t<i[e].length-1;t++)if(0!==i[e+1][t]&&i[e][t]>=i[e+1][t]||0!==i[e][t+1]&&i[e][t]>i[e][t+1])return!1;return!0}displayError(t){}addNewArray(s,n,o=!1,h=!0){return new Promise(async(t,e)=>{if(this.currentlyAnimating)t();else{var a={numbers:n,cubes:[],floor:[],leftWall:[],rightWall:[],cubeGroup:null,centerOffset:0,partialFootprintSum:0,footprint:0,height:0,size:0};this.in2dView&&!o&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.arrays.splice(s,0,a),a.footprint=a.numbers.length;for(let t=s;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,t!==s&&(this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}));a.cubeGroup=new THREE.Object3D,this.scene.add(a.cubeGroup),this.addWalls||(this.in2dView?a.cubeGroup.position.set(a.centerOffset,0,0):a.cubeGroup.position.set(a.centerOffset,0,-a.centerOffset)),a.cubeGroup.rotation.y=this.rotationY,a.cubes=new Array(a.footprint),a.floor=new Array(a.footprint);for(let i=0;i<a.footprint;i++){a.cubes[i]=new Array(a.footprint),a.floor[i]=new Array(a.footprint);for(let e=0;e<a.footprint;e++)if(a.numbers[i][e]!==1/0)if(a.cubes[i][e]=new Array(a.numbers[i][e]),a.numbers[i][e]>a.height&&(a.height=a.numbers[i][e]),a.floor[i][e]=this.addFloor(a,e,i),h){var r=Math.max(a.numbers[i][a.footprint-1],a.numbers[a.footprint-1][e]);for(let t=0;t<r;t++)a.cubes[i][e][t]=this.addCube(a,e,t,i,0,0,this.asymptoteLightness);for(let t=r;t<a.numbers[i][e];t++)a.cubes[i][e][t]=this.addCube(a,e,t,i)}else for(let t=0;t<a.numbers[i][e];t++)a.cubes[i][e][t]=this.addCube(a,e,t,i);else{a.cubes[i][e]=new Array(this.infiniteHeight),a.floor[i][e]=this.addFloor(a,e,i);for(let t=0;t<this.infiniteHeight;t++)a.cubes[i][e][t]=this.addCube(a,e,t,i,0,0,this.asymptoteLightness)}}if(this.addWalls){a.leftWall=new Array(this.wallSize),a.rightWall=new Array(this.wallSize);for(let t=0;t<this.wallSize;t++)a.leftWall[t]=new Array(2*this.wallSize),a.rightWall[t]=new Array(2*this.wallSize);for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)a.leftWall[e][t]=this.addLeftWall(a,t,e),a.rightWall[e][t]=this.addRightWall(a,e,t)}a.size=Math.max(a.footprint,a.height),this.totalArrayFootprint+=a.footprint+1,this.totalArrayHeight=Math.max(this.totalArrayHeight,a.height),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),1!==this.arrays.length||o?this.addWalls||o||this.updateCameraHeight(!0):(this.hexViewCameraPos=[this.totalArraySize,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize],this._2dViewCameraPos=[0,this.totalArraySize+10,0],this.in2dView&&!o?this.updateCameraHeight(!0):(this.orthographicCamera.left=-this.totalArraySize,this.orthographicCamera.right=this.totalArraySize,this.orthographicCamera.top=this.totalArraySize,this.orthographicCamera.bottom=-this.totalArraySize,this.orthographicCamera.position.set(this.hexViewCameraPos[0],this.hexViewCameraPos[1],this.hexViewCameraPos[2]),this.orthographicCamera.rotation.set(-.785398163,.615479709,.523598775),this.orthographicCamera.updateProjectionMatrix())),s!==this.arrays.length-1&&await new Promise((t,e)=>setTimeout(t,this.animationTime));let i=[];a.cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>i.push(t))}),await new Promise(async(t,e)=>{anime({targets:i,opacity:1,duration:this.animationTime/2,easing:"easeOutQuad",complete:t})}),this.in2dView&&!o&&this.drawAll2dViewText(),t(a)}})}editArray(i,a){return new Promise(async(t,e)=>{this.currentlyAnimating?t():i>=this.arrays.length||i<0?this.displayError("No array at index "+i):(await this.removeArray(i),await this.addNewArray(i,a),this.in2dView||this.updateCameraHeight(),t())})}trimArray(s){return new Promise(async(t,e)=>{if(this.currentlyAnimating)t();else if(s>=this.arrays.length||s<0)this.displayError("No array at index "+s);else{var a=arrays[s].numbers;let i=0;for(let e=0;e<a.length;e++)for(let t=0;t<a.length;t++)0!==a[e][t]&&(i=Math.max(i,Math.max(e+1,t+1)));var r=new Array(i);for(let e=0;e<i;e++){r[e]=new Array(i);for(let t=0;t<i;t++)r[e][t]=a[e][t]}await this.removeArray(s),await this.addNewArray(s,r),this.in2dView||this.updateCameraHeight(),t()}})}removeArray(a,i=!1){return new Promise(async(t,e)=>{if(this.currentlyAnimating)t();else if(a>=this.arrays.length||a<0)this.displayError("No array at index "+a);else{this.in2dView&&!i&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),await new Promise((t,e)=>{let i=[];this.arrays[a].cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>i.push(t))}),anime({targets:i,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad",complete:t})});for(let i=0;i<this.arrays[a].cubes.length;i++)for(let e=0;e<this.arrays[a].cubes[i].length;e++)if(this.arrays[a].cubes[i][e])for(let t=0;t<this.arrays[a].cubes[i][e].length;t++)this.arrays[a].cubes[i][e][t]&&this.arrays[a].cubes[i][e][t].material.forEach(t=>t.dispose());this.scene.remove(this.arrays[a].cubeGroup),this.totalArrayFootprint-=this.arrays[a].footprint+1,this.arrays.splice(a,1);for(let t=a;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"});0===this.arrays.length||i||this.updateCameraHeight(!0),t()}})}addCube(t,e,i,a,r=0,s=0,n=this.cubeLightness){var o=[new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0})],o=(o.forEach(t=>t.color.setHSL(r,s,n)),new THREE.Mesh(this.cubeGeometry,o));return t.cubeGroup.add(o),this.addWalls?o.position.set(e,i,a):o.position.set(e-(t.footprint-1)/2,i,a-(t.footprint-1)/2),o}addFloor(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.floorGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(e,-.5005,i):n.position.set(e-(t.footprint-1)/2,-.5005,i-(t.footprint-1)/2),n}addLeftWall(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.wallLeftGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(-.5005,e-this.wallSize,i):n.position.set(-.5005-(t.footprint-1)/2,e,i-(t.footprint-1)/2),n}addRightWall(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.wallRightGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(e,i-this.wallSize,-.5005):n.position.set(e-(t.footprint-1)/2,i,-.5005-(t.footprint-1)/2),n}showHexView(){return new Promise(async(t,e)=>{this.currentlyAnimatingCamera?t():(this.currentlyAnimatingCamera=!0,this.in2dView&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.in2dView=!1,this.inExactHexView=!0,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),anime({targets:this.orthographicCamera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:this.animationTime,easing:"easeInOutQuad",complete:()=>{this.currentlyAnimatingCamera=!1,t()}}),this.arrays.forEach(t=>{anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:-t.centerOffset,duration:this.animationTime,easing:"easeInOutQuad"})}),this.rotationY=0)})}show2dView(){return new Promise(async(t,e)=>{this.currentlyAnimatingCamera||this.in2dView?t():(this.dimersShown&&await this.hideDimers(),this.currentlyAnimatingCamera=!0,this.in2dView=!0,this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),anime({targets:this.orthographicCamera.rotation,x:-1.570796327,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}),this.arrays.forEach(t=>{anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"})}),setTimeout(()=>{this.drawAll2dViewText(),Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5).then(()=>{this.currentlyAnimatingCamera=!1,this.rotationY=0,t()})},this.animationTime))})}updateCameraHeight(t=!1){if(!t){if(this.currentlyAnimatingCamera)return;this.currentlyAnimatingCamera=!0}for(let t=this.totalArrayHeight=0;t<this.arrays.length;t++)this.totalArrayHeight=Math.max(this.totalArrayHeight,this.arrays[t].height);this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight);t=(-this.arrays[0].footprint/2+this.arrays[this.arrays.length-1].centerOffset+this.arrays[this.arrays.length-1].footprint/2)/2;this.hexViewCameraPos=[this.totalArraySize+t,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize-t],this.addWalls&&(this.hexViewCameraPos[0]+=10,this.hexViewCameraPos[1]+=10,this.hexViewCameraPos[2]+=10),this._2dViewCameraPos=[t,this.totalArraySize+10,0],this.in2dView?(anime({targets:this.orthographicCamera.position,x:this._2dViewCameraPos[0],y:this._2dViewCameraPos[1],z:this._2dViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:this.orthographicCamera,left:-(this.totalArrayFootprint/2+.5),right:this.totalArrayFootprint/2+.5,top:this.totalArrayFootprint/2+.5,bottom:-(this.totalArrayFootprint/2+.5),duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix(),complete:()=>{this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1}}),setTimeout(()=>{this.drawAll2dViewText(),Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5)},this.animationTime)):(anime({targets:this.orthographicCamera.position,x:this.hexViewCameraPos[0],y:this.hexViewCameraPos[1],z:this.hexViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}),anime({targets:this.orthographicCamera,left:-this.totalArraySize,right:this.totalArraySize,top:this.totalArraySize,bottom:-this.totalArraySize,duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix(),complete:()=>{this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1}}))}showDimers(){return new Promise(async(t,e)=>{if(!this.currentlyAnimatingCamera){this.dimersShown=!0,this.inExactHexView||await this.showHexView(),this.currentlyAnimatingCamera=!0;let r=[];this.arrays.forEach(a=>{for(let i=0;i<a.footprint;i++)for(let e=0;e<a.footprint;e++){for(let t=0;t<a.cubes[i][e].length;t++)t<a.cubes[i][e].length-1&&r.push(a.cubes[i][e][t].material[2]),i<a.footprint-1&&a.cubes[i+1][e].length>=t+1&&r.push(a.cubes[i][e][t].material[4]),e<a.footprint-1&&a.cubes[i][e+1].length>=t+1&&r.push(a.cubes[i][e][t].material[0]),r.push(a.cubes[i][e][t].material[1]),r.push(a.cubes[i][e][t].material[3]),r.push(a.cubes[i][e][t].material[5]);0!==a.cubes[i][e].length&&r.push(a.floor[i][e].material[2])}if(this.addWalls)for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)r.push(a.rightWall[e][t].material[0]),r.push(a.leftWall[e][t].material[4])}),r.forEach(t=>t.opacity=0),await new Promise((t,e)=>{anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",Alpha:0,duration:this.animationTime/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}})}),this.currentlyAnimatingCamera=!1}t()})}hideDimers(){return new Promise(async(t,e)=>{if(!this.currentlyAnimatingCamera){this.dimersShown=!1;let r=[];this.arrays.forEach(a=>{for(let i=0;i<a.footprint;i++)for(let e=0;e<a.footprint;e++){for(let t=0;t<a.cubes[i][e].length;t++)t<a.cubes[i][e].length-1&&r.push(a.cubes[i][e][t].material[2]),i<a.footprint-1&&a.cubes[i+1][e].length>=t+1&&r.push(a.cubes[i][e][t].material[4]),e<a.footprint-1&&a.cubes[i][e+1].length>=t+1&&r.push(a.cubes[i][e][t].material[0]),r.push(a.cubes[i][e][t].material[1]),r.push(a.cubes[i][e][t].material[3]),r.push(a.cubes[i][e][t].material[5]);0!==a.cubes[i][e].length&&r.push(a.floor[i][e].material[2])}if(this.addWalls)for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)r.push(a.leftWall[e][t].material[0]),r.push(a.rightWall[e][t].material[4])}),await new Promise((t,e)=>{anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",Alpha:1,duration:this.animationTime/2,easing:"easeOutQuad",complete:t,update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx.Alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx.Alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx.Alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx.Alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}})}),r.forEach(t=>t.opacity=1),this.currentlyAnimatingCamera=!1}t()})}showFloor(a=1){return new Promise(async(t,e)=>{let i=[];this.arrays.forEach(t=>{t.floor.forEach(t=>{t.forEach(t=>{t.material.forEach(t=>i.push(t))})})}),anime({targets:i,opacity:a,duration:this.animationTime/2,easing:"easeOutQuad",complete:()=>{t()}})})}hideFloor(){return this.showFloor(0)}removeOutsideFloor(i){let a=[];var r=[];for(let e=0;e<i.footprint;e++)for(let t=i.footprint-1;0<=t&&0===i.numbers[e][t];t--)i.floor[e][t].material.forEach(t=>a.push(t)),r.push([e,t]);r.forEach(t=>{i.floor[t[0]][t[1]].material.forEach(t=>t.dispose()),i.cubeGroup.remove(i.floor[t[0]][t[1]]),i.floor[t[0]][t[1]]=null}),this.in2dView&&this.drawAll2dViewText()}recalculateHeights(e){e.height=0,e.numbers.forEach(t=>{t.forEach(t=>{t!==1/0&&(e.height=Math.max(t,e.height))})}),e.size=Math.max(e.footprint,e.height);this.totalArrayHeight;this.totalArrayHeight=0,this.arrays.forEach(t=>this.totalArrayHeight=Math.max(t.height,this.totalArrayHeight)),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),this.totalArrayHeight!==this.oldTotalArrayHeight&&this.updateCameraHeight()}drawAll2dViewText(){this.fontSize=this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1);var t=Math.max((""+this.totalArrayHeight).length,2);this.wilsonNumbers.ctx.font=this.fontSize/t+"px monospace",this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.arrays.forEach(i=>{for(let e=0;e<i.footprint;e++)for(let t=0;t<i.footprint;t++)null!==i.floor[e][t]&&this.drawSingleCell2dViewText(i,e,t)})}drawSingleCell2dViewText(t,e,i){var a,r=(this.totalArrayFootprint-t.footprint-1)/2,s=t.partialFootprintSum-t.footprint;this.wilsonNumbers.ctx.clearRect(this.fontSize*(i+s+1),this.fontSize*(e+r+1),this.fontSize,this.fontSize),t.numbers[e][i]===1/0||0===t.numbers[e][i]&&0===this.floorLightness||(a=this.wilsonNumbers.ctx.measureText(t.numbers[e][i]),this.wilsonNumbers.ctx.fillText(t.numbers[e][i],this.fontSize*(i+s+1)+(this.fontSize-a.width)/2,this.fontSize*(e+r+1)+(this.fontSize+a.actualBoundingBoxAscent-a.actualBoundingBoxDescent)/2))}colorCubes(s,n,o){return new Promise((t,e)=>{if(0===n.length)t();else{let e=[],i=(n.forEach(t=>{s.cubes[t[0]][t[1]][t[2]].material.forEach(t=>e.push(t.color))}),e.forEach(t=>t.getRGB(t)),this.cubeLightness+ +Math.min(this.cubeLightness,1-this.cubeLightness)),a=0===i?0:2*(1-this.cubeLightness/i),r=e.map(t=>this.wilson.utils.hsvToRgb(o,a,i));anime({targets:e,r:(t,e)=>r[e][0]/255,g:(t,e)=>r[e][1]/255,b:(t,e)=>r[e][2]/255,duration:this.animationTime,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",update:()=>e.forEach(t=>t.setRGB(t.r,t.g,t.b)),complete:t})}})}uncolorCubes(a,r){return new Promise((t,e)=>{let i=[];r.forEach(t=>{a.cubes[t[0]][t[1]][t[2]].material.forEach(t=>i.push(t.color))}),i.forEach(t=>t.getHSL(t)),anime({targets:i,s:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>i.forEach(t=>t.setHSL(t.h,t.s,this.cubeLightness)),complete:t})})}raiseCubes(r,s,n){return new Promise((t,e)=>{var i=this.in2dView?0:this.animationTime;let a=[];s.forEach(t=>{a.push(r.cubes[t[0]][t[1]][t[2]].position),r.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),anime({targets:a,y:n,duration:i,easing:"easeInOutQuad",complete:t})})}lowerCubes(r,s){return new Promise((t,e)=>{var i=this.in2dView?0:this.animationTime;let a=[];s.forEach(t=>{a.push(r.cubes[t[0]][t[1]][t[2]].position),r.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),anime({targets:a,y:(t,e)=>r.numbers[s[e][0]][s[e][1]],duration:i,easing:"easeInOutQuad",complete:()=>{s.forEach(t=>{r.cubes[t[0]][t[1]][r.numbers[t[0]][t[1]]]=r.cubes[t[0]][t[1]][t[2]],r.cubes[t[0]][t[1]][t[2]]=null}),t()}})})}moveCubes(a,r,s,n,o=!0){return new Promise((t,e)=>{let i=[];r.forEach(t=>{i.push(a.cubes[t[0]][t[1]][t[2]].position),s.cubeGroup.attach(a.cubes[t[0]][t[1]][t[2]]),a.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),anime({targets:i,x:(t,e)=>n[e][1]-(s.footprint-1)/2,y:(t,e)=>n[e][2],z:(t,e)=>n[e][0]-(s.footprint-1)/2,duration:this.animationTime,easing:"easeInOutQuad",complete:()=>{if(o){let i=r.map(t=>a.cubes[t[0]][t[1]][t[2]]);r.forEach(t=>a.cubes[t[0]][t[1]][t[2]]=null),n.forEach((e,t)=>{s.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),s.cubes[e[0]][e[1]][e[2]]&&!r.some(t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),s.cubes[e[0]][e[1]][e[2]]=i[t]})}t()}})})}revealCubes(i,a){return new Promise((t,e)=>{if(0===a.length)t();else{let e=[];a.forEach(t=>{i.cubes[t[0]][t[1]][t[2]].material.forEach(t=>e.push(t)),i.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),anime({targets:e,opacity:1,duration:this.animationTime/2,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",complete:t})}})}deleteCubes(a,r,s=!1,n=!1){return new Promise((t,e)=>{let i=[];r.forEach(t=>{a.cubes[t[0]][t[1]][t[2]].material.forEach(t=>i.push(t))}),anime({targets:i,opacity:0,duration:this.animationTime/2*!n,delay:(t,e)=>!s*Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",complete:()=>{i.forEach(t=>t.dispose()),r.forEach(t=>{a.cubeGroup.remove(a.cubes[t[0]][t[1]][t[2]]),a.cubes[t[0]][t[1]][t[2]]=null}),t()}})})}deleteFloor(a,r){return new Promise((t,e)=>{let i=[];r.forEach(t=>{a.floor[t[0]][t[1]].material.forEach(t=>i.push(t))}),anime({targets:i,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad",complete:()=>{i.forEach(t=>t.dispose()),r.forEach(t=>{a.cubeGroup.remove(a.floor[t[0]][t[1]]),a.cubes[t[0]][t[1]]=null}),t()}})})}runExample(a){return new Promise(async(t,e)=>{if(1===a||2===a){for(;1<this.arrays.length;)await this.removeArray(1),await new Promise((t,e)=>setTimeout(t,this.animationTime/2));var i;0===this.arrays.length?(i=this.parseArray(this.generateRandomPlanePartition()),await this.addNewArray(this.arrays.length,i)):this.verifyPp(this.arrays[0].numbers)||(await this.removeArray(0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),i=this.parseArray(this.generateRandomPlanePartition()),await addNewArray(this.arrays.length,i)),1===a?(await this.runAlgorithm("hillmanGrassl",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("hillmanGrasslInverse",0)):(await this.runAlgorithm("pak",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.showHexView(),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.runAlgorithm("sulzgruberInverse",0)),t()}else if(3===a){for(;0<this.arrays.length;)await this.removeArray(0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2));await this.addNewArray(this.arrays.length,this.generateRandomTableau()),await this.show2dView(),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.runAlgorithm("rskInverse",0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("rsk",0),t()}})}runAlgorithm(t,l,u=!1){return new Promise(async(i,e)=>{if(u||!this.currentlyRunningAlgorithm){this.currentlyRunningAlgorithm=!0;var a=this.algorithmData[t],r=a.inputType.length;if(l>this.arrays.length-1||l<0)console.log(`No array at index ${l}!`),this.currentlyRunningAlgorithm=!1;else if(1<r&&l>this.arrays.length-r)console.log(`No array at index ${l+r-1}! (This algorithm needs ${r} arrays)`),this.currentlyRunningAlgorithm=!1;else{for(let t=0;t<r;t++){var s=a.inputType[t];if("pp"===s&&!this.verifyPp(this.arrays[l+t].numbers))return console.log(`Array at index ${l+t} is not a plane partition!`),this.currentlyRunningAlgorithm=!1,void e();if("ssyt"===s&&!this.verifySsyt(this.arrays[l+t].numbers))return console.log(`Array at index ${l+t} is not an SSYT!`),this.currentlyRunningAlgorithm=!1,void i()}if(1<r&&void 0!==a.sameShape&&a.sameShape){var n=new Array(r);let a=0;for(let t=0;t<r;t++)a=Math.max(a,this.arrays[l+t].numbers.length);for(let i=0;i<r;i++){n[i]=new Array(a);for(let t=0;t<a;t++)n[i][t]=0;for(let e=0;e<this.arrays[l+i].numbers.length;e++){let t=0;for(;t<this.arrays[l+i].numbers[e].length&&0!==this.arrays[l+i].numbers[e][t];)t++;n[i][e]=t}}for(let e=1;e<r;e++)for(let t=0;t<a;t++)if(n[e][t]!==n[0][t])return this.displayError("Arrays are not the same shape!"),this.currentlyRunningAlgorithm=!1,void i()}for(let t=0;t<r;t++){var o=[],h=this.arrays[l+t].numbers;for(let i=0;i<h.length;i++)for(let e=0;e<h.length;e++)if(h[i][e]!==1/0)for(let t=0;t<h[i][e];t++)o.push([i,e,t]);this.uncolorCubes(this.arrays[l+t],o)}await a.method.bind(this)(l),this.subAlgorithm||(this.currentlyRunningAlgorithm=!1)}}i()})}hillmanGrassl(d){return new Promise(async(t,e)=>{var a=this.arrays[d],r=_.cloneDeep(a.numbers),s=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;s[e]=t}var n=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;n[e]=t}for(var o=[];;){let t=r[0].length-1;for(;0<=t&&s[t]<r.length&&0===r[s[t]][t];)t--;if(t<0||s[t]===r.length)break;let e=s[t],i=t;for(var h=[[e,i,r[e][i]-1]];;){if(e<r.length-1&&r[e+1][i]===r[e][i])e++;else{if(!(0<i&&r[e][i-1]!==1/0))break;i--}h.push([e,i,r[e][i]-1])}for(let t=0;t<h.length;t++)r[h[t][0]][h[t][1]]--;o.push(h)}var i=new Array(r.length);for(let e=0;e<r.length;e++){i[e]=new Array(r.length);for(let t=0;t<r.length;t++)i[e][t]=r[e][t]===1/0?1/0:0}var l=await this.addNewArray(d+1,i);await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let i=0;i<o.length;i++){var u=i/o.length*6/7;await this.colorCubes(a,o[i],u),await this.raiseCubes(a,o[i],a.height);for(let t=0;t<o[i].length;t++)a.numbers[o[i][t][0]][o[i][t][1]]--,this.in2dView&&this.drawSingleCell2dViewText(a,o[i][t][0],o[i][t][1]);this.recalculateHeights(a),await new Promise((t,e)=>setTimeout(t,this.animationTime/5));var m=[o[i][o[i].length-1][0],o[i][0][1]];let e=[];var c=l.height+1;for(let t=s[m[1]];t<=m[0];t++)e.push([t,m[1],c]);u=e[e.length-1];for(let t=m[1]-1;t>=n[m[0]];t--)e.push([m[0],t,c]);await this.moveCubes(a,o[i],l,e),e=[];for(let t=m[0]-1;t>=s[m[1]];t--)e.push([t,m[1],c]);this.deleteCubes(l,e),e=[];for(let t=m[1]-1;t>=n[m[0]];t--)e.push([m[0],t,c]);this.deleteCubes(l,e),await this.lowerCubes(l,[u]),l.numbers[u[0]][u[1]]++,this.recalculateHeights(l),this.in2dView&&this.drawSingleCell2dViewText(l,u[0],u[1]),l.height=Math.max(l.height,l.numbers[u[0]][u[1]]),l.size=Math.max(l.size,l.height),await new Promise((t,e)=>setTimeout(t,this.animationTime))}await this.removeArray(d),t()})}hillmanGrasslInverse(a){return new Promise(async(t,e)=>{var r=this.arrays[a],s=_.cloneDeep(r.numbers),n=[],o=new Array(s.length);for(let e=0;e<s.length;e++){let t=0;for(;t<s.length&&s[t][e]===1/0;)t++;o[e]=t}var h=new Array(s.length);for(let e=0;e<s.length;e++){let t=0;for(;t<s.length&&s[e][t]===1/0;)t++;h[e]=t}var i=new Array(s.length);for(let e=0;e<s.length;e++){i[e]=new Array(s.length);for(let t=0;t<s.length;t++)i[e][t]=s[e][t]===1/0?1/0:0}var l=_.cloneDeep(i);let u=await this.addNewArray(a+1,i);for(let r=0;r<s.length;r++)for(let t=s.length-1;t>=o[r];t--)for(;0!==s[t][r];){var m=[];let i=t,a=h[t];for(;0<=i;){let e=a;if(0!==i)for(;l[i][e]!==l[i-1][e]&&e<r;)e++;else e=r;for(let t=a;t<=e;t++)m.push([i,t,l[i][t]]);if(!(i-1>=o[e]))break;i--,a=e}for(let t=0;t<m.length;t++)l[m[t][0]][m[t][1]]++;n.push([m,[t,r,s[t][r]-1]]),s[t][r]--}await new Promise((t,e)=>setTimeout(t,this.animationTime/2));for(let t=0;t<n.length;t++){let e=t/n.length*6/7;await this.colorCubes(r,[n[t][1]],e);var c=n[t][1][0],d=n[t][1][1],w=r.size;for(let t=o[d];t<c;t++)r.cubes[t][d][w]=this.addCube(r,d,w,t),r.cubes[t][d][w].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=h[c];t<d;t++)r.cubes[c][t][w]=this.addCube(r,t,w,c),r.cubes[c][t][w].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));await this.raiseCubes(r,[n[t][1]],w);let i=[];for(let t=c-1;t>=o[d];t--)i.push([t,d,w]);var f=this.revealCubes(r,i);i=[];for(let t=d-1;t>=h[c];t--)i.push([c,t,w]);var g=this.revealCubes(r,i);await Promise.all([f,g]),i=[];for(let t=h[c];t<d;t++)i.push([c,t,w]);i.push([c,d,r.numbers[c][d]-1]);for(let t=c-1;t>=o[d];t--)i.push([t,d,w]);f=n[t][0];let a=u.height+1;f.forEach(t=>t[2]=a),r.numbers[c][d]--,this.recalculateHeights(r),this.in2dView&&this.drawSingleCell2dViewText(r,c,d),await this.moveCubes(r,i,u,f),await this.lowerCubes(u,f),f.forEach(t=>{u.numbers[t[0]][t[1]]++}),this.recalculateHeights(u),this.in2dView&&f.forEach(t=>this.drawSingleCell2dViewText(u,t[0],t[1])),await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(a),t()})}pak(r){return new Promise(async(t,e)=>{let o=this.arrays[r],h=o.numbers,i=(this.in2dView||await this.show2dView(),0),a=0;for(;i<o.footprint&&0!==o.numbers[i][o.footprint-1];)i++;for(;a<o.footprint&&0!==o.numbers[o.footprint-1][a];)a++;i=0;let l=a=0;for(let e=o.footprint-1-a;0<=e;e--)for(let t=o.footprint-1-i;0<=t;t--)h[e][t]!==1/0&&l++;let u=0;for(let n=0;n<o.footprint-a;n++)for(let t=0;t<o.footprint-i;t++)if(h[n][t]!==1/0){var m=[];let i=0;for(;n+i<o.footprint&&t+i<o.footprint;)m.push([n+i,t+i,h[n+i][t+i]-1]),i++;i=m[0][0];let a=m[0][1],e=[];for(let t=h[i][a]-2;0<=t;t--)e.push([i,a,t]);this.colorCubes(o,e,u/l*6/7),e=[],m.forEach(t=>{0<=t[2]&&e.push(t)}),await this.colorCubes(o,e,u/l*6/7);let s=new Array(m.length);m.forEach((t,e)=>{var i=t[0],t=t[1];let a=0,r=0;i<o.footprint-1&&(a=h[i+1][t]),t<o.footprint-1&&(r=h[i][t+1]),s[e]=Math.max(a,r),0<e?(a=h[i-1][t],r=h[i][t-1],s[e]+=Math.min(a,r)-h[i][t]):s[e]=h[i][t]-s[e]});for(let e=0;e<m.length;e++){if(i=m[e][0],a=m[e][1],s[e]>h[i][a]){var c=[];for(let t=h[i][a];t<s[e];t++)o.cubes[i][a][t]=this.addCube(o,a,t,i),c.push([i,a,t]);this.in2dView?this.revealCubes(o,c):await this.revealCubes(o,c)}else if(s[e]<h[i][a]){var d=[];for(let t=h[i][a]-1;t>=s[e];t--)d.push([i,a,t]);this.in2dView?this.deleteCubes(o,d):await this.deleteCubes(o,d)}h[i][a]=s[e],this.in2dView&&this.drawSingleCell2dViewText(o,i,a)}let r=[];e.forEach((t,e)=>{0!==e&&t[2]<h[t[0]][t[1]]&&r.push(t)}),this.in2dView?this.uncolorCubes(o,r):await this.uncolorCubes(o,r),u++,this.recalculateHeights(o),0!==e.length&&await new Promise((t,e)=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0),t()})}pakInverse(i,a=0,s=0){return new Promise(async(t,e)=>{let o=this.arrays[i],h=o.numbers,r=(this.in2dView||await this.show2dView(),0);for(let e=o.footprint-1-s;0<=e;e--)for(let t=o.footprint-1-a;0<=t;t--)h[e][t]!==1/0&&r++;let l=0;for(let e=o.footprint-1-s;0<=e;e--)for(let t=o.footprint-1-a;0<=t;t--)if(h[e][t]!==1/0){var u=[];let i=0;for(;e+i<o.footprint&&t+i<o.footprint;)u.push([e+i,t+i,h[e+i][t+i]-1]),i++;i=u[0][0];let a=u[0][1],s=new Array(u.length),n=!1;if(u.forEach((t,e)=>{var i=t[0],t=t[1];let a=0,r=0;i<o.footprint-1&&(a=h[i+1][t]),t<o.footprint-1&&(r=h[i][t+1]),s[e]=Math.max(a,r),0<e?(a=h[i-1][t],r=h[i][t-1],s[e]+=Math.min(a,r)-h[i][t]):s[e]+=h[i][t],n||s[e]===h[i][t]||(n=!0)}),0!==h[i][a]){var m=[];for(let t=h[i][a]-1;0<=t;t--)m.push([i,a,t]);this.colorCubes(o,m,l/r*6/7)}else if(0!==s[0])o.cubes[i][a][0]=this.addCube(o,a,0,i,l/r*6/7,1,this.cubeLightness),h[i][a]=1,this.revealCubes(o,[[i,a,0]]);else if(!n){l++;continue}await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let e=0;e<u.length;e++){if(i=u[e][0],a=u[e][1],s[e]>h[i][a]){var c=[];for(let t=h[i][a];t<s[e];t++)o.cubes[i][a][t]=this.addCube(o,a,t,i,l/r*6/7,1,this.cubeLightness),c.push([i,a,t]);this.in2dView?this.revealCubes(o,c):await this.revealCubes(o,c)}else if(s[e]<h[i][a]){var d=[];for(let t=h[i][a]-1;t>=s[e];t--)d.push([i,a,t]);this.in2dView?this.deleteCubes(o,d):await this.deleteCubes(o,d)}h[i][a]=s[e],this.in2dView&&this.drawSingleCell2dViewText(o,i,a)}l++,this.recalculateHeights(o),await new Promise((t,e)=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0),t()})}sulzgruber(b){return new Promise(async(t,e)=>{let i=this.arrays[b],n=_.cloneDeep(i.numbers);var a=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;a[e]=t}var o=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;o[e]=t}var r,s,h={},l={};for(let t=0;t<n.length;t++)l[-t]=[t,0];for(let t=1;t<n.length;t++)l[t]=[0,t];for(let i=1-n.length;i<n.length;i++){let t=l[i][0],e=l[i][1];for(;t<n.length&&e<n.length&&n[t][e]===1/0;)t++,e++;l[i]=[t,e],t===n.length||e===n.length?h[i]=-1:(r=0===e||n[t][e-1]===1/0,s=0===t||n[t-1][e]===1/0,h[i]=r&&s?0:r?3:s?2:1)}var u=[];for(let s=1-n.length;s<n.length;s++)if(1!==h[s]&&3!==h[s]){let a=l[s][0],r=l[s][1];if(0!==n[a][r])for(;;){let t=!1;for(;a<n.length&&r<n.length&&0!==n[a][r];){if((r<n.length-1&&n[a][r]>n[a][r+1]||r===n.length-1&&0<n[a][r])&&(0===h[s]||2===h[s]&&(a<n.length-1&&n[a][r]>n[a+1][r]||a===n.length-1&&0<n[a][r]))){t=!0;break}a++,r++}if(!t)break;let e=a,i=r;for(var m=[[e,i,n[e][i]-1]];;){var c=i-e;if(e<n.length-1&&n[e][i]===n[e+1][i]&&(0===h[c]||3===h[c]))e++;else{if(!(i>o[e]&&(e===n.length-1||e<n.length-1&&n[e][i]>n[e+1][i])))break;i--}m.push([e,i,n[e][i]-1])}m.forEach(t=>n[t[0]][t[1]]--),u.push(m)}}var d=new Array(n.length);for(let e=0;e<n.length;e++){d[e]=new Array(n.length);for(let t=0;t<n.length;t++)d[e][t]=n[e][t]===1/0?1/0:0}var w=await this.addNewArray(b+1,d);await new Promise((t,e)=>setTimeout(t,this.animationTime));for(let t=0;t<u.length;t++){var f=t/u.length*6/7,g=(await this.colorCubes(i,u[t],f),await this.raiseCubes(i,u[t],i.height+1),u[t].forEach(t=>{i.numbers[t[0]][t[1]]--,this.in2dView&&this.drawSingleCell2dViewText(i,t[0],t[1])}),this.recalculateHeights(i),await new Promise((t,e)=>setTimeout(t,this.animationTime/5)),u[t][u[t].length-1][0]),p=l[u[t][u[t].length-1][1]-g+u[t].length-1][1];let e=[];var y=Math.max(i.height+1,w.height+1);for(let t=a[p];t<=g;t++)e.push([t,p,y]);for(let t=p-1;t>=o[g];t--)e.push([g,t,y]);await this.moveCubes(i,u[t],w,e),e=[];for(let t=g-1;t>=a[p];t--)e.push([t,p,y]);this.deleteCubes(w,e),e=[];for(let t=p-1;t>=o[g];t--)e.push([g,t,y]);this.deleteCubes(w,e),await this.lowerCubes(w,[[g,p,y]]),w.numbers[g][p]++,this.in2dView&&this.drawSingleCell2dViewText(w,g,p),this.recalculateHeights(w),await new Promise((t,e)=>setTimeout(t,this.animationTime))}await this.removeArray(b),t()})}sulzgruberInverse(a){return new Promise(async(t,e)=>{var n=this.arrays[a],o=n.numbers,h=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;h[e]=t}var l=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;l[e]=t}var u={};for(let t=0;t<o.length;t++)u[-t]=[t,0];for(let t=1;t<o.length;t++)u[t]=[0,t];for(let i=1-o.length;i<o.length;i++){let t=u[i][0],e=u[i][1];for(;t<o.length&&e<o.length&&o[t][e]===1/0;)t++,e++;u[i]=[t,e]}let m=0;var i=new Array(o.length);for(let e=0;e<o.length;e++){i[e]=new Array(o.length);for(let t=0;t<o.length;t++)o[e][t]===1/0?i[e][t]=1/0:(i[e][t]=0,m+=o[e][t])}let c=await this.addNewArray(a+1,i);c.numbers;let d=0;for(let s=o.length-1;0<=s;s--)for(let t=o.length-1;0<=t;t--)if(o[t][s]!==1/0)for(;0!==o[t][s];){let e=d/m*6/7;var w=Math.max(n.size+1,c.size+1),f=(await this.colorCubes(n,[[t,s,o[t][s]-1]],e),await this.raiseCubes(n,[[t,s,o[t][s]-1]],w),t),g=s;for(let t=h[g];t<f;t++)n.cubes[t][g][w]=this.addCube(n,g,w,t),n.cubes[t][g][w].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=l[f];t<g;t++)n.cubes[f][t][w]=this.addCube(n,t,w,f),n.cubes[f][t][w].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));let i=[];for(let t=f-1;t>=h[g];t--)i.push([t,g,w]);var p=this.revealCubes(n,i);i=[];for(let t=g-1;t>=l[f];t--)i.push([f,t,w]);var y=this.revealCubes(n,i);await Promise.all([p,y]),i=[];for(let t=l[f];t<g;t++)i.push([f,t,w]);i.push([f,g,n.numbers[f][g]-1]);for(let t=f-1;t>=h[g];t--)i.push([t,g,w]);var p=l[f]-f,b=p+i.length-1,x=[];for(let t=p;t<=b;t++)x.push(_.clone(u[t]));o[f][g]--,this.recalculateHeights(n),this.in2dView&&this.drawSingleCell2dViewText(n,f,g),await this.moveCubes(n,i,c,x);let a=0,r=c.numbers[x[0][0]][x[0][1]];for(;;){let t=a;for(;t<x.length&&x[t][0]===x[a][0];)t++;i=x.slice(a,t);let e=!0;for(let t=0;t<i.length;t++)if(c.numbers[i[t][0]][i[t][1]]!==r){e=!1;break}if(e)await this.lowerCubes(c,i),i.forEach(t=>c.numbers[t[0]][t[1]]++),this.recalculateHeights(c),this.in2dView&&i.forEach(t=>{this.drawSingleCell2dViewText(c,t[0],t[1])}),a=t;else{var T=_.cloneDeep(x.slice(a));for(let t=a;t<x.length;t++)if(x[t][0]++,x[t][1]++,x[t][0]>c.footprint||x[t][1]>c.footprint)return void console.error("Insertion failed!");var v=x.slice(a);await this.moveCubes(c,T,c,v),r=c.numbers[x[a][0]][x[a][1]]}if(a===x.length)break}d++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(a),t()})}rsk(r){return new Promise(async(i,t)=>{var e=this.arrays[r],h=this.arrays[r+1],l=e.numbers,u=h.numbers;let a=0,m=0;for(let e=0;e<l.length;e++)for(let t=0;t<l.length;t++){if(l[e][t]===1/0||u[e][t]===1/0)return this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),this.currentlyRunningAlgorithm=!1,void i();0!==l[e][t]&&m++,a=Math.max(Math.max(a,l[e][t]),u[e][t])}if(0===a)displayError("The SSYT are empty!"),currentlyRunningAlgorithm=!1;else{var c=new Array(a);for(let e=0;e<a;e++){c[e]=new Array(a);for(let t=0;t<a;t++)c[e][t]=0}var d=await this.addNewArray(r+2,c);let t=0;for(;0!==u[0][0];){var w=t/m*6/7;let i=0,a=0,r=0;for(let e=0;e<u.length;e++){let t=u.length-1;for(;0<=t&&0===u[e][t];)t--;0<=t&&(i=Math.max(i,u[e][t]))}for(let e=0;e<u.length;e++){let t=u.length-1;for(;0<=t&&0===u[e][t];)t--;if(u[e][t]===i){a=e,r=t;break}}var f=[],g=[],p=[],y=[],b=[],x=[];let s=a,n=r,o=l[s][n];for(var T=u[s][n],v=[[s,n]];0!==s;){let e=l.length-1;for(;0===l[s-1][e]||o<=l[s-1][e];)e--;for(let t=0;t<o;t++)f.push([s,n,t]),g.push([s-1,e,t]);s--,n=e,o=l[s][n],v.push([s,n])}var A=d.height+1;for(let t=0;t<o;t++)p.push([s,n,t]),y.push([T-1,t,A]);for(let t=0;t<T-1;t++)b.push([a,r,t]),x.push([t,o-1,A]);this.colorCubes(h,b.concat([[a,r,T-1]]),w),this.colorCubes(e,f,w),await this.colorCubes(e,p,w),u[a][r]=0;for(let t=v.length-1;0<t;t--)l[v[t][0]][v[t][1]]=l[v[t-1][0]][v[t-1][1]];if(l[a][r]=0,this.in2dView){this.drawSingleCell2dViewText(e,a,r);for(let t=v.length-1;0<t;t--)this.drawSingleCell2dViewText(e,v[t][0],v[t][1]);this.drawSingleCell2dViewText(h,a,r)}this.moveCubes(h,b,d,x),this.moveCubes(e,p,d,y),this.moveCubes(e,f,e,g),await this.moveCubes(h,[[a,r,T-1]],d,[[T-1,o-1,A]],!1),this.uncolorCubes(e,g),d.cubeGroup.remove(h.cubes[a][r][T-1]),this.deleteCubes(h,[[a,r,T-1]],!0,!0),y.reverse(),x.reverse(),this.deleteCubes(d,y.slice(1)),this.deleteCubes(d,x),await this.lowerCubes(d,[[T-1,o-1,A]]),c[T-1][o-1]++,this.in2dView&&this.drawSingleCell2dViewText(d,T-1,o-1),this.recalculateHeights(d),t++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(r),await new Promise((t,e)=>setTimeout(t,this.animationTime)),await this.removeArray(r)}i()})}rskInverse(V){return new Promise(async(t,e)=>{var a=this.arrays[V],s=_.cloneDeep(a.numbers);let r=0,n=(s.forEach(t=>t.forEach(t=>r+=t)),new Array(r)),o=new Array(r);for(let e=0;e<r;e++){n[e]=new Array(r),o[e]=new Array(r);for(let t=0;t<r;t++)n[e][t]=0,o[e][t]=0}var h=new Array(s.length);for(let t=0;t<s.length;t++)h[t]=0;let l=0;var u=[],m=[],c=[];for(let r=0;r<s.length;r++)for(let a=0;a<s.length;a++)for(;0!==s[r][a];){s[r][a]--;let t=a+1,e=0,i=0;for(var d=[];;){for(i=h[e];0!==i&&n[e][i-1]>t;)i--;if(i===h[e]){n[e][i]=t,h[e]++,0===i&&l++,d.push([e,i]);break}var w=n[e][i];n[e][i]=t,t=w,d.push([e,i]),e++}u.push(d),m.push([e,i]),c.push([r,a]),o[e][i]=r+1}var i=Math.max(h[0],l);n=new Array(i),o=new Array(i);for(let e=0;e<i;e++){n[e]=new Array(i),o[e]=new Array(i);for(let t=0;t<i;t++)n[e][t]=0,o[e][t]=0}var f=await this.addNewArray(V+1,n),g=(await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.addNewArray(V+2,o));await new Promise((t,e)=>setTimeout(t,this.animationTime/2));let p=0;for(let t=0;t<c.length;t++){var y=c[t][0],b=c[t][1],x=a.height+1;let e=p/r*6/7;for(let t=b;0<=t;t--)a.cubes[y][t][x]=this.addCube(a,t,x,y),a.cubes[y][t][x].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=y-1;0<=t;t--)a.cubes[t][b][x]=this.addCube(a,b,x,t),a.cubes[t][b][x].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));a.cubes[y][b][x+1]=this.addCube(a,b,x,y),a.cubes[y][b][x+1].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness)),await this.colorCubes(a,[[y,b,a.numbers[y][b]-1]],e),await this.raiseCubes(a,[[y,b,a.numbers[y][b]-1]],x);var T=this.revealCubes(a,[[y,b,x+1]]);let i=[];for(let t=b-1;0<=t;t--)i.push([y,t,x]);var v=this.revealCubes(a,i);i=[];for(let t=y-1;0<=t;t--)i.push([t,b,x]);var A=this.revealCubes(a,i),H=(await Promise.all([T,v,A]),u[p]),C=[],E=[],S=[[y,b,a.numbers[y][b]-1]],R=[[H[0][0],H[0][1],b]],P=[[y,b,x+1]],M=[[m[p][0],m[p][1],y]];for(let t=b-1;0<=t;t--)S.push([y,t,x]),R.push([H[0][0],H[0][1],t]);for(let e=0;e<H.length-1;e++)for(let t=0;t<n[H[e][0]][H[e][1]];t++)C.push([H[e][0],H[e][1],t]),E.push([H[e+1][0],H[e+1][1],t]);for(let t=y-1;0<=t;t--)P.push([t,b,x]),M.push([m[p][0],m[p][1],t]);await this.colorCubes(f,C,e);for(let t=H.length-1;0<t;t--)n[H[t][0]][H[t][1]]=n[H[t-1][0]][H[t-1][1]];0!==H.length&&(n[H[0][0]][H[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==C.length&&await this.moveCubes(f,C,f,E),a.numbers[y][b]--,this.in2dView&&this.drawAll2dViewText(),this.moveCubes(a,S,f,R),await this.moveCubes(a,P,g,M),n[H[0][0]][H[0][1]]=b+1,o[m[p][0]][m[p][1]]=y+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(a),this.recalculateHeights(f),this.recalculateHeights(g),p++,await new Promise((t,e)=>setTimeout(t,this.animationTime/2))}await this.removeArray(V),t()})}godar1(V){return new Promise(async(t,e)=>{var i;let a=this.arrays[V].numbers;var r=new Array(2*a.length),s=new Array(2*a.length);for(let e=0;e<a.length;e++){let t=0;for(;t<a.length&&a[e][t]===1/0;)t++;for(r[e]=t,t=0;t<a.length&&a[t][e]===1/0;)t++;s[e]=t}for(let t=a.length;t<2*a.length;t++)r[t]=0,s[t]=0;var n=Math.max(r[0],s[0]),o=new Array(a.length);for(let e=0;e<a.length;e++){o[e]=new Array(a.length);for(let t=0;t<a.length;t++)a[e][t]===1/0?o[e][t]=this.infiniteHeight:o[e][t]=a[e][t]}await this.addNewArray(V+1,o),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.removeArray(V),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),i=this.arrays[V],a=i.numbers;let h=0,l=0;for(;h<a.length&&0!==a[h][a.length-1];)h++;for(;l<a.length&&0!==a[a.length-1][l];)l++;await this.runAlgorithm("pak",V,!0),await new Promise((t,e)=>setTimeout(t,2*this.animationTime)),i=this.arrays[V],a=i.numbers;var u=Math.max(h,l),m=new Array(a.length-u+1),c=[];for(let i=0;i<m.length-1;i++){m[i]=new Array(m.length);for(let e=0;e<m.length-1;e++){m[i][e]=a[i][e];for(let t=0;t<a[i][e];t++)c.push([i,e,t]);a[i][e]=0}m[i][m.length-1]=0}m[m.length-1]=new Array(m.length);for(let t=0;t<m.length;t++)m[m.length-1][t]=0;this.deleteCubes(i,c,!0,!0),await this.addNewArray(V,m),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pakInverse",V,!0),await new Promise((t,e)=>setTimeout(t,2*this.animationTime));var d=2*a.length-r[a.length-1]-s[a.length-1],w=r[0]+s[0],f=new Array(4*a.length),g=new Array(w),p=new Array(4*a.length);for(let t=0;t<4*a.length;t++)f[t]=new Array;for(let t=0;t<w;t++)g[t]=new Array;for(let t=0;t<4*a.length;t++)p[t]=new Array;let y=1;for(let e=0;e<2*a.length;e++)for(let t=0;t<2*a.length;t++)t>=r[e]?f[e+t+1-r[e]-s[t]].push([e,t]):g[r[e]+s[t]-e-t-1].unshift([n-e-1,n-t-1]),p[e+t+1].push([e,t]);var b=new Array(2*a.length);for(let t=0;t<2*a.length;t++)b[t]=new Array(2*a.length);for(let e=1;e<d;e++){var x=[];for(let t=0;t<f[e].length;t++){var T=f[e][t][0],v=f[e][t][1];if(T<a.length-l&&v<a.length-h)for(let t=0;t<this.arrays[V].numbers[T][v];t++)x.push([T,v,t]);t<p[e].length?(b[T][v]=[1,p[e][t]],T<a.length&&v<a.length&&0<this.arrays[V].numbers[T][v]&&(y=Math.max(Math.max(y,p[e][t][0]+1),p[e][t][1]+1))):b[T][v]=[0,g[e][t-p[e].length]]}0!==x.length&&this.colorCubes(this.arrays[V],x,(e-1)/(d-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animationTime));var A=new Array(n);for(let e=0;e<n;e++){A[e]=new Array(n);for(let t=0;t<n;t++)t<n-r[n-e-1]?A[e][t]=1/0:A[e][t]=0}let H=null;0<n&&(H=await this.addNewArray(V+1,A),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)));var C=new Array(y);for(let e=0;e<y;e++){C[e]=new Array(y);for(let t=0;t<y;t++)C[e][t]=0}var E=await this.addNewArray(V+2,C);for(let i=0;i<a.length-l;i++)for(let e=r[i];e<a.length-h;e++)if(0<this.arrays[V].numbers[i][e]){var S=[],R=[],P=b[i][e][1][0],M=b[i][e][1][1];for(let t=0;t<this.arrays[V].numbers[i][e];t++)S.push([i,e,t]),R.push([P,M,t]);0===b[i][e][0]?(await this.moveCubes(this.arrays[V],S,H,R),A[P][M]=this.arrays[V].numbers[i][e]):(await this.moveCubes(this.arrays[V],S,E,R),C[P][M]=this.arrays[V].numbers[i][e]),this.arrays[V].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",V,!0),0<n&&await this.runAlgorithm("hillmanGrasslInverse",V+1,!0),this.resolve()})}godar1Inverse(z){return new Promise(async(t,e)=>{var a=this.arrays[z+1].numbers,r=this.arrays[z].numbers,i=new Array(a.length+2*r.length),s=new Array(a.length+2*r.length);for(let t=0;t<a.length+2*r.length;t++)i[t]=0,s[t]=0;for(let e=0;e<r.length;e++){let t=r.length-1;for(;0<=t&&r[e][t]!==1/0;)t--;for(i[r.length-e-1]=r.length-t-1,t=r.length-1;0<=t&&r[t][e]!==1/0;)t--;s[r.length-e-1]=r.length-t-1}await this.runAlgorithm("pak",z,!0),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pak",z+1,!0),await new Promise((t,e)=>setTimeout(t,3*this.animationTime));let n=[],o=this.arrays[z].numbers;for(let i=0;i<o.length;i++)for(let e=0;e<o.length;e++)if(o[i][e]!==1/0)for(let t=0;t<o[i][e];t++)n.push([i,e,t]);this.uncolorCubes(this.arrays[z],n),n=[],o=this.arrays[z+1].numbers;for(let i=0;i<o.length;i++)for(let e=0;e<o.length;e++)if(o[i][e]!==1/0)for(let t=0;t<o[i][e];t++)n.push([i,e,t]);await this.uncolorCubes(arrays[z+1],n);let h=Math.max(i[0],s[0])+2*a.length-1;var l=2*h,u=i[0]+s[0],m=2*a.length,c=new Array(l),d=new Array(u),w=new Array(m);for(let t=0;t<l;t++)c[t]=new Array;for(let t=0;t<u;t++)d[t]=new Array;for(let e=0;e<m;e++){w[e]=new Array(e);for(let t=0;t<e;t++)w[e][t]=-1}for(;i.length<h;)i.push(0);for(;s.length<h;)s.push(0);for(let e=0;e<h;e++)for(let t=0;t<h;t++)t>=i[e]?c[e+t+1-i[e]-s[t]].push([e,t]):d[i[e]+s[t]-e-t-1].unshift([r.length-e-1,r.length-t-1]),e<a.length&&t<a.length&&(w[e+t+1][e]=[e,t]);var f=new Array(a.length);for(let t=0;t<a.length;t++)f[t]=new Array(a.length);var g=new Array(r.length);for(let t=0;t<r.length;t++)g[t]=new Array(r.length);for(let e=h=1;e<u;e++){var p=[];for(let t=0;t<d[e].length;t++){var y=d[e][t][0],b=d[e][t][1];for(let t=0;t<arrays[z].numbers[y][b];t++)p.push([y,b,t]);g[y][b]=c[e][t+w[e].length],0!==this.arrays[z].numbers[y][b]&&(h=Math.max(Math.max(h,g[y][b][0]+1),g[y][b][1]+1))}0!==p.length&&this.colorCubes(this.arrays[z],p,(e-1)/(u-1)*6/7)}for(let e=1;e<m;e++){var x=[];for(let t=0;t<w[e].length;t++)if(-1!==w[e][t]){var T=w[e][t][0],v=w[e][t][1];for(let t=0;t<arrays[z+1].numbers[T][v];t++)x.push([T,v,t]);f[T][v]=c[e][t],0!==this.arrays[z+1].numbers[T][v]&&(h=Math.max(Math.max(h,f[T][v][0]+1),f[T][v][1]+1))}0!==x.length&&this.colorCubes(this.arrays[z+1],x,(e-1)/(m-1)*6/7)}await new Promise((t,e)=>setTimeout(t,3*this.animationTime));var A=new Array(h);for(let e=0;e<h;e++){A[e]=new Array(h);for(let t=0;t<h;t++)t<i[e]?A[e][t]=1/0:A[e][t]=0}var H=await this.addNewArray(z+2,A);await new Promise((t,e)=>setTimeout(t,this.animationTime/2));for(let i=0;i<r.length;i++)for(let e=0;e<r.length;e++)if(0<arrays[z].numbers[i][e]&&this.arrays[z].numbers[i][e]!==1/0){var C=[],E=[],S=g[i][e][0],R=g[i][e][1];for(let t=0;t<this.arrays[z].numbers[i][e];t++)C.push([i,e,t]),E.push([S,R,t]);await this.moveCubes(this.arrays[z],C,H,E),A[S][R]=this.arrays[z].numbers[i][e],this.arrays[z].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}for(let i=0;i<a.length;i++)for(let e=0;e<a.length;e++)if(0<this.arrays[z+1].numbers[i][e]&&arrays[z+1].numbers[i][e]!==1/0){var P=[],M=[],V=f[i][e][0],N=f[i][e][1];for(let t=0;t<this.arrays[z+1].numbers[i][e];t++)P.push([i,e,t]),M.push([V,N,t]);await this.moveCubes(this.arrays[z+1],P,H,M),A[V][N]=this.arrays[z+1].numbers[i][e],this.arrays[z+1].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}await this.removeArray(z),await new Promise((t,e)=>setTimeout(t,this.animationTime/2)),await this.removeArray(z),await new Promise((t,e)=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",z,!0),await new Promise((t,e)=>setTimeout(t,this.animationTime)),t()})}drawBoundary(u,m){return new Promise(async(t,e)=>{this.in2dView||await this.show2dView(),"0"!==this.wilsonNumbers.canvas.style.opacity&&await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/3),this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight);let i=this.arrays[u];var a,r=i.numbers,s=[];let n=0,o=0;for(let t=i.footprint-1;0<=t;t--){for(;o<i.footprint&&r[t][o]===1/0;)t!==i.footprint-1&&r[t+1][o]===1/0||(a=n%m/m,a=this.wilson.utils.hsvToRgb(a,1,1),s.push([t,o,!0,`rgba(${a[0]}, ${a[1]}, ${a[2]}, `]),n++),o++;var h=n%m/m,h=this.wilson.utils.hsvToRgb(h,1,1);s.push([t,o,!1,`rgba(${h[0]}, ${h[1]}, ${h[2]}, `]),n++}for(var l;o<i.footprint;)-1!=i.footprint-1&&r[0][o]===1/0||(l=n%m/m,l=this.wilson.utils.hsvToRgb(l,1,1),s.push([-1,o,!0,`rgba(${l[0]}, ${l[1]}, ${l[2]}, `]),n++),o++;s.forEach(t=>{this.drawBoundaryRect(i,t[0],t[1],t[2],t[3]+" 1)")}),await Page.Animate.changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/3),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",t(s)})}drawNQuotient(u,m,c,d){return new Promise(async(t,e)=>{let a=this.arrays[u],i={t:1};await new Promise((t,e)=>{anime({targets:i,t:0,duration:this.animationTime,easing:"easeOutQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{e=e%m===c?1:0;this.drawBoundaryRect(a,t[0],t[1],t[2],t[3]+` ${e})`)}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{e=e%m===c?1:i.t;this.drawBoundaryRect(a,t[0],t[1],t[2],t[3]+` ${e})`)})}})});var r=(d=d.filter((t,e)=>e%m===c)).filter(t=>!t[2]).length;let s=new Array(d.length),n=r-1,o=0,h=(d.forEach((t,e)=>{s[e]=[n,o],t[2]?o++:n--}),i.t=0,await new Promise((t,e)=>{anime({targets:i,t:1,duration:this.animationTime,easing:"easeInOutQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{this.drawBoundaryRect(a,s[e][0],s[e][1],t[2],t[3]+" 1)")}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{this.drawBoundaryRect(a,(1-i.t)*t[0]+i.t*s[e][0],(1-i.t)*t[1]+i.t*s[e][1],t[2],t[3]+" 1)")})}})}),[]),l=(s.forEach((i,t)=>{if(!d[t][2])for(let e=i[1];e<a.footprint;e++)if(a.numbers[i[0]][e]===1/0)for(let t=0;t<this.infiniteHeight;t++)h.push([i[0],e,t])}),this.deleteCubes(a,h,!0),[]);for(let t=a.footprint-1;t>s[0][0];t--)l.push([t,0,!1]);for(let t=s[s.length-1][1];t<a.footprint;t++)l.push([-1,t,!0]);i.t=0,await new Promise((t,e)=>{anime({targets:i,t:1,duration:this.animationTime/2,easing:"easeInQuad",complete:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{this.drawBoundaryRect(a,s[e][0],s[e][1],t[2],t[3]+" 1)")}),l.forEach((t,e)=>{this.drawBoundaryRect(a,t[0],t[1],t[2],d[0][3]+" 1)")}),t()},update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),d.forEach((t,e)=>{this.drawBoundaryRect(a,s[e][0],s[e][1],t[2],t[3]+" 1)")}),l.forEach((t,e)=>{this.drawBoundaryRect(a,t[0],t[1],t[2],`${d[0][3]} ${i.t})`)})}})}),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",t()})}drawBoundaryRect(t,e,i,a,r){var s=(this.totalArrayFootprint-t.footprint-1)/2,t=t.partialFootprintSum-t.footprint;this.wilsonNumbers.ctx.fillStyle=r,a?this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+t+1)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+s+1+.9375)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(1/16)/(this.totalArrayFootprint+1)):this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+t+.9375)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+s+1)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth*(1/16)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight/(this.totalArrayFootprint+1))}}export{PlanePartitions};