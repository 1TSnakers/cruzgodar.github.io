import anime from"/scripts/anime.js";import{changeOpacity}from"/scripts/src/animation.min.mjs";import{Applet}from"/scripts/src/applets.min.mjs";import{$$}from"/scripts/src/main.min.mjs";import*as THREE from"/scripts/three.js";import{Wilson}from"/scripts/wilson.min.mjs";class PlanePartitions extends Applet{wilsonNumbers=null;wilsonHidden=null;wilsonHidden2=null;wilsonHidden3=null;wilsonHidden4=null;useFullscreenButton=!1;resolution=2e3;animationTime=600;asymptoteLightness=1;cubeLightness=1;floorLightness=1;infiniteHeight=100;addWalls=!1;wallSize=30;scene=null;orthographicCamera=null;renderer=null;loader=null;cubeTexture=null;cubeTexture2=null;floorTexture=null;floorTexture2=null;cubeGeometry=null;floorGeometry=null;wallLeftGeometry=null;wallRightGeometry=null;ambientLight=null;dimersShown=!1;pointLight=null;rotationY=0;rotationYVelocity=0;nextRotationYVelocity=0;lastRotationYVelocities=[];rotationYVelocityFriction=.94;rotationYVelocityStartThreshhold=.005;rotationYVelocityStopThreshhold=5e-4;in2dView=!1;inExactHexView=!0;currentlyAnimatingCamera=!1;currentlyRunningAlgorithm=!1;needDownload=!1;fontSize=10;arrays=[];totalArrayFootprint=0;totalArrayHeight=0;totalArraySize=0;hexViewCameraPos=[15,15,15];_2dViewCameraPos=[0,20,0];algorithmData={hillmanGrassl:{method:this.hillmanGrassl,inputType:["pp"]},hillmanGrasslInverse:{method:this.hillmanGrasslInverse,inputType:["tableau"]},pak:{method:this.pak,inputType:["pp"]},pakInverse:{method:this.pakInverse,inputType:["tableau"]},sulzgruber:{method:this.sulzgruber,inputType:["pp"]},sulzgruberInverse:{method:this.sulzgruberInverse,inputType:["tableau"]},rsk:{method:this.rsk,inputType:["ssyt","ssyt"],sameShape:!0},rskInverse:{method:this.rskInverse,inputType:["tableau"]},godar1:{method:this.godar1,inputType:["pp"]},godar1Inverse:{method:this.godar1Inverse,inputType:["pp","pp"]}};constructor(t,e,i=!0){super(t),this.useFullscreenButton=i;var i=this.createHiddenCanvas(),a=this.createHiddenCanvas(),r=this.createHiddenCanvas(),s=this.createHiddenCanvas(),n={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!1,mousedownCallback:this.onGrabCanvas.bind(this),touchstartCallback:this.onGrabCanvas.bind(this),mousedragCallback:this.onDragCanvas.bind(this),touchmoveCallback:this.onDragCanvas.bind(this),mouseupCallback:this.onReleaseCanvas.bind(this),touchendCallback:this.onReleaseCanvas.bind(this)},e=(this.wilsonNumbers=new Wilson(e,n),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),$$(".wilson-applet-canvas-container").forEach(t=>t.style.setProperty("background-color","rgba(0, 0, 0, 0)","important")),{canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:this.useFullscreenButton,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:this.switchFullscreen.bind(this)}),n=(this.wilson=new Wilson(t,e),{renderer:"cpu",canvasWidth:64,canvasHeight:64});this.wilsonHidden=new Wilson(i,n),this.wilsonHidden2=new Wilson(a,n),this.wilsonHidden3=new Wilson(r,n),this.wilsonHidden4=new Wilson(s,n),this.wilsonHidden.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden.ctx._alpha=1,this.wilsonHidden.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.lineWidth=6,this.wilsonHidden2.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden2.ctx._alpha=1,this.wilsonHidden2.ctx.fillStyle="rgba(64, 64, 64, 1)",this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle="rgba(128, 128, 128, 1)",this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.lineWidth=6,this.wilsonHidden3.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden3.ctx._alpha=1,this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.lineWidth=6,this.wilsonHidden4.ctx.strokeStyle="rgb(255, 255, 255)",this.wilsonHidden4.ctx._alpha=1,this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:1})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.lineWidth=6,this.scene=new THREE.Scene,this.scene.background=new THREE.Color(0),this.orthographicCamera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0}),this.renderer.setSize(this.resolution,this.resolution,!1),this.renderer.useLegacyLights=!0,this.loader=new THREE.TextureLoader,this.cubeTexture=new THREE.CanvasTexture(this.wilsonHidden.canvas),this.cubeTexture.minFilter=THREE.LinearFilter,this.cubeTexture.magFilter=THREE.NearestFilter,this.cubeTexture2=new THREE.CanvasTexture(this.wilsonHidden2.canvas),this.cubeTexture2.minFilter=THREE.LinearFilter,this.cubeTexture2.magFilter=THREE.NearestFilter,this.floorTexture=new THREE.CanvasTexture(this.wilsonHidden3.canvas),this.floorTexture.minFilter=THREE.LinearFilter,this.floorTexture.magFilter=THREE.NearestFilter,this.floorTexture2=new THREE.CanvasTexture(this.wilsonHidden4.canvas),this.floorTexture2.minFilter=THREE.LinearFilter,this.floorTexture2.magFilter=THREE.NearestFilter,this.cubeGeometry=new THREE.BoxGeometry,this.dimersShown=!1,this.floorGeometry=new THREE.BoxGeometry(1,.001,1),this.wallLeftGeometry=new THREE.BoxGeometry(.001,1,1),this.wallRightGeometry=new THREE.BoxGeometry(1,1,.001),this.ambientLight=new THREE.AmbientLight(16777215,.2),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,1,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.drawFrame()}onGrabCanvas(){this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0]}onDragCanvas(t,e,i){this.in2dView||(this.rotationY+=i,this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.nextRotationYVelocity=i)}onReleaseCanvas(){if(!this.in2dView){let i=0;if(this.lastRotationYVelocities.forEach((t,e)=>{Math.abs(t)>this.rotationYVelocity&&(this.rotationYVelocity=Math.abs(t),i=e)}),this.rotationYVelocity<this.rotationYVelocityStartThreshhold)return void(this.rotationYVelocity=0);this.rotationYVelocity=this.lastRotationYVelocities[i]}this.lastRotationYVelocities=[0,0,0,0]}drawFrame(){this.renderer.render(this.scene,this.orthographicCamera),this.lastRotationYVelocities.push(this.nextRotationYVelocity),this.lastRotationYVelocities.shift(),(this.nextRotationYVelocity=0)!==this.rotationYVelocity&&(this.rotationY+=this.rotationYVelocity,this.scene.children.forEach(t=>t.rotation.y=this.rotationY),this.rotationYVelocity*=this.rotationYVelocityFriction,Math.abs(this.rotationYVelocity)<this.rotationYVelocityStopThreshhold)&&(this.rotationYVelocity=0),this.rotationY>Math.PI?this.rotationY-=2*Math.PI:this.rotationY<-Math.PI&&(this.rotationY+=2*Math.PI),this.needDownload&&(this.needDownload=!1,this.wilson.canvas.toBlob(t=>{var e=document.createElement("a");e.download="a-plane-partition.png",e.href=window.URL.createObjectURL(t),e.click(),e.remove()})),window.requestAnimationFrame(this.drawFrame.bind(this))}switchFullscreen(){var t;this.useFullscreenButton&&(t=document.body.querySelector(".wilson-exit-fullscreen-button"))&&t.style.setProperty("z-index","300","important"),this.in2dView||this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.wilsonNumbers.fullscreen.switchFullscreen()}generateRandomPlanePartition(){var i=Math.floor(3*Math.random())+5,t=Math.floor(5*Math.random())+10,a=new Array(i);for(let t=0;t<i;t++)a[t]=new Array(i);a[0][0]=t;for(let t=1;t<i;t++)a[0][t]=Math.max(a[0][t-1]-Math.floor(4*Math.random()),0);for(let e=1;e<i;e++){a[e][0]=Math.max(a[e-1][0]-Math.floor(4*Math.random()),0);for(let t=1;t<i;t++)a[e][t]=Math.max(Math.min(a[e][t-1],a[e-1][t])-Math.floor(4*Math.random()),0)}for(let t=0;t<i;t++)a[i-1][t]=0,a[t][i-1]=0;return a}generateRandomTableau(){var i=Math.floor(3*Math.random())+5,a=new Array(i);for(let e=0;e<i;e++){a[e]=new Array(i);for(let t=0;t<i;t++)Math.random()<.75/i?a[e][t]=Math.floor(3*Math.random())+1:a[e][t]=0}for(let t=0;t<i;t++)a[t][i-1]=0,a[i-1][t]=0;return a}generateRandomSsyt(){var i=Math.floor(3*Math.random())+2,a=new Array(i);for(let t=0;t<i;t++)a[t]=new Array(i);a[0][0]=Math.floor(2*Math.random());for(let t=1;t<i;t++)a[0][t]=a[0][t-1]+Math.floor(2*Math.random());for(let e=1;e<i;e++){a[e][0]=a[e-1][0]+1+Math.floor(2*Math.random());for(let t=1;t<i;t++)a[e][t]=Math.max(a[e][t-1],a[e-1][t]+1)+Math.floor(2*Math.random())}return a}parseArray(t){var i=t.split("\n");let a=i.length;var r=new Array(i.length);for(let e=0;e<r.length;e++){r[e]=i[e].split(" ");for(let t=0;t<r[e].length;t++)""===r[e][t]&&(r[e].splice(t,1),t--)}let e=r[0].length;if(-1===t.indexOf(">")){for(let t=0;t<r.length;t++)r[t].push("0");e++}-1===t.indexOf("v")&&(r.push(["0"]),a++);var s=Math.max(a,e),n=new Array(s);for(let e=0;e<a;e++){n[e]=new Array(s);for(let t=0;t<r[e].length;t++)"^"===r[e][t]?n[e][t]=1/0:">"===r[e][t]?n[e][t]=n[e][t-1]:"v"===r[e][t]?n[e][t]=n[e-1][t]:n[e][t]=parseInt(r[e][t]);for(let t=r[e].length;t<s;t++)n[e][t]=0}for(let e=a;e<s;e++){n[e]=new Array(s);for(let t=0;t<s;t++)n[e][t]=0}return n}arrayToAscii(i){let a=1;for(let e=0;e<i.length;e++)for(let t=0;t<i.length;t++)i[e][t]!==1/0&&(a=Math.max(a,(""+i[e][t]).length));a++;let r="";for(let t=0;t<i.length-1;t++){for(let e=0;e<i.length-1;e++)if(i[t][e]===1/0){for(let t=0;t<a-1-(0===e);t++)r+=" ";r+="^"}else{var s=(""+i[t][e]).length;for(let t=0;t<a-s-(0===e);t++)r+=" ";r+=i[t][e]}if(0!==i[t][i.length-1]){for(let t=0;t<a-1;t++)r+=" ";r+=">"}t!==i.length-2&&(r+="\n")}if(0!==i[i.length-1][0]){r+="\n";for(let e=0;e<i.length-1;e++)if(0!==i[i.length-1][e]){for(let t=0;t<a-1-(0===e);t++)r+=" ";r+="v"}}return r}verifyPp(i){for(let e=0;e<i.length-1;e++)for(let t=0;t<i[e].length-1;t++)if(i[e][t]<i[e+1][t]||i[e][t]<i[e][t+1])return!1;return!0}verifySsyt(i){for(let e=0;e<i.length-1;e++)for(let t=0;t<i[e].length-1;t++)if(0!==i[e+1][t]&&i[e][t]>=i[e+1][t]||0!==i[e][t+1]&&i[e][t]>i[e][t+1])return!1;return!0}async addNewArray(i,t,a=!1,r=!0){if(!this.currentlyAnimating){var s={numbers:t,cubes:[],floor:[],leftWall:[],rightWall:[],cubeGroup:null,centerOffset:0,partialFootprintSum:0,footprint:0,height:0,size:0};this.in2dView&&!a&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.arrays.splice(i,0,s),s.footprint=s.numbers.length;for(let t=i;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,t!==i&&(this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}));s.cubeGroup=new THREE.Object3D,this.scene.add(s.cubeGroup),this.addWalls||(this.in2dView?s.cubeGroup.position.set(s.centerOffset,0,0):s.cubeGroup.position.set(s.centerOffset,0,-s.centerOffset)),s.cubeGroup.rotation.y=this.rotationY,s.cubes=new Array(s.footprint),s.floor=new Array(s.footprint);for(let i=0;i<s.footprint;i++){s.cubes[i]=new Array(s.footprint),s.floor[i]=new Array(s.footprint);for(let e=0;e<s.footprint;e++)if(s.numbers[i][e]!==1/0)if(s.cubes[i][e]=new Array(s.numbers[i][e]),s.numbers[i][e]>s.height&&(s.height=s.numbers[i][e]),s.floor[i][e]=this.addFloor(s,e,i),r){var n=Math.max(s.numbers[i][s.footprint-1],s.numbers[s.footprint-1][e]);for(let t=0;t<n;t++)s.cubes[i][e][t]=this.addCube(s,e,t,i,0,0,this.asymptoteLightness);for(let t=n;t<s.numbers[i][e];t++)s.cubes[i][e][t]=this.addCube(s,e,t,i)}else for(let t=0;t<s.numbers[i][e];t++)s.cubes[i][e][t]=this.addCube(s,e,t,i);else{s.cubes[i][e]=new Array(this.infiniteHeight),s.floor[i][e]=this.addFloor(s,e,i);for(let t=0;t<this.infiniteHeight;t++)s.cubes[i][e][t]=this.addCube(s,e,t,i,0,0,this.asymptoteLightness)}}if(this.addWalls){s.leftWall=new Array(this.wallSize),s.rightWall=new Array(this.wallSize);for(let t=0;t<this.wallSize;t++)s.leftWall[t]=new Array(2*this.wallSize),s.rightWall[t]=new Array(2*this.wallSize);for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)s.leftWall[e][t]=this.addLeftWall(s,t,e),s.rightWall[e][t]=this.addRightWall(s,e,t)}s.size=Math.max(s.footprint,s.height),this.totalArrayFootprint+=s.footprint+1,this.totalArrayHeight=Math.max(this.totalArrayHeight,s.height),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),1!==this.arrays.length||a?this.addWalls||a||this.updateCameraHeight(!0):(this.hexViewCameraPos=[this.totalArraySize,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize],this._2dViewCameraPos=[0,this.totalArraySize+10,0],this.in2dView&&!a?this.updateCameraHeight(!0):(this.orthographicCamera.left=-this.totalArraySize,this.orthographicCamera.right=this.totalArraySize,this.orthographicCamera.top=this.totalArraySize,this.orthographicCamera.bottom=-this.totalArraySize,this.orthographicCamera.position.set(this.hexViewCameraPos[0],this.hexViewCameraPos[1],this.hexViewCameraPos[2]),this.orthographicCamera.rotation.set(-.785398163,.615479709,.523598775),this.orthographicCamera.updateProjectionMatrix())),i!==this.arrays.length-1&&await new Promise(t=>setTimeout(t,this.animationTime));let e=[];return s.cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>e.push(t))}),await anime({targets:e,opacity:1,duration:this.animationTime/2,easing:"easeOutQuad"}).finished,this.in2dView&&!a&&this.drawAll2dViewText(),s}}async editArray(t,e){this.currentlyAnimating||(t>=this.arrays.length||t<0?this.displayError("No array at index "+t):(await this.removeArray(t),await this.addNewArray(t,e),this.in2dView||this.updateCameraHeight()))}async trimArray(t){if(!this.currentlyAnimating)if(t>=this.arrays.length||t<0)this.displayError("No array at index "+t);else{var a=this.arrays[t].numbers;let i=0;for(let e=0;e<a.length;e++)for(let t=0;t<a.length;t++)0!==a[e][t]&&(i=Math.max(i,Math.max(e+1,t+1)));var r=new Array(i);for(let e=0;e<i;e++){r[e]=new Array(i);for(let t=0;t<i;t++)r[e][t]=a[e][t]}await this.removeArray(t),await this.addNewArray(t,r),this.in2dView||this.updateCameraHeight()}}async removeArray(a,t=!1){if(!this.currentlyAnimating)if(a>=this.arrays.length||a<0)this.displayError("No array at index "+a);else{this.in2dView&&!t&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5);let e=[];this.arrays[a].cubeGroup.traverse(t=>{t.material&&t.material.forEach(t=>e.push(t))}),await anime({targets:e,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad"}).finished;for(let i=0;i<this.arrays[a].cubes.length;i++)for(let e=0;e<this.arrays[a].cubes[i].length;e++)if(this.arrays[a].cubes[i][e])for(let t=0;t<this.arrays[a].cubes[i][e].length;t++)this.arrays[a].cubes[i][e][t]&&this.arrays[a].cubes[i][e][t].material.forEach(t=>t.dispose());this.scene.remove(this.arrays[a].cubeGroup),this.totalArrayFootprint-=this.arrays[a].footprint+1,this.arrays.splice(a,1);for(let t=a;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"});0===this.arrays.length||t||this.updateCameraHeight(!0)}}addCube(t,e,i,a,r=0,s=0,n=this.cubeLightness){var o=[new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.cubeTexture2,transparent:!0,opacity:0})],o=(o.forEach(t=>t.color.setHSL(r,s,n)),new THREE.Mesh(this.cubeGeometry,o));return t.cubeGroup.add(o),this.addWalls?o.position.set(e,i,a):o.position.set(e-(t.footprint-1)/2,i,a-(t.footprint-1)/2),o}addFloor(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.floorGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(e,-.5005,i):n.position.set(e-(t.footprint-1)/2,-.5005,i-(t.footprint-1)/2),n}addLeftWall(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.wallLeftGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(-.5005,e-this.wallSize,i):n.position.set(-.5005-(t.footprint-1)/2,e,i-(t.footprint-1)/2),n}addRightWall(t,e,i,a=0,r=0,s=this.floorLightness){var n=[new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:this.floorTexture2,transparent:!0,opacity:0})],n=(n.forEach(t=>t.color.setHSL(a,r,s)),new THREE.Mesh(this.wallRightGeometry,n));return t.cubeGroup.add(n),this.addWalls?n.position.set(e,i-this.wallSize,-.5005):n.position.set(e-(t.footprint-1)/2,i,-.5005-(t.footprint-1)/2),n}async showHexView(){this.currentlyAnimatingCamera||(this.currentlyAnimatingCamera=!0,this.in2dView&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/5),this.in2dView=!1,this.inExactHexView=!0,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),await Promise.all([anime({targets:this.orthographicCamera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:this.animationTime,easing:"easeInOutQuad"}).finished].concat(this.arrays.map(t=>anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished),this.arrays.map(t=>anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:-t.centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}).finished))),this.currentlyAnimatingCamera=!1,this.rotationY=0)}async show2dView(){this.currentlyAnimatingCamera||this.in2dView||(this.dimersShown&&await this.hideDimers(),this.currentlyAnimatingCamera=!0,this.in2dView=!0,this.inExactHexView=!1,this.rotationYVelocity=0,this.lastRotationYVelocities=[0,0,0,0],this.updateCameraHeight(!0),await Promise.all([anime({targets:this.orthographicCamera.rotation,x:-1.570796327,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished].concat(this.arrays.map(t=>anime({targets:t.cubeGroup.rotation,y:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished),this.arrays.map(t=>anime({targets:t.cubeGroup.position,x:t.centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}).finished))),this.drawAll2dViewText(),await changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5),this.currentlyAnimatingCamera=!1,this.rotationY=0)}async updateCameraHeight(t=!1){if(!t){if(this.currentlyAnimatingCamera)return;this.currentlyAnimatingCamera=!0}for(let t=this.totalArrayHeight=0;t<this.arrays.length;t++)this.totalArrayHeight=Math.max(this.totalArrayHeight,this.arrays[t].height);this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight);t=(-this.arrays[0].footprint/2+this.arrays[this.arrays.length-1].centerOffset+this.arrays[this.arrays.length-1].footprint/2)/2;this.hexViewCameraPos=[this.totalArraySize+t,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize-t],this.addWalls&&(this.hexViewCameraPos[0]+=10,this.hexViewCameraPos[1]+=10,this.hexViewCameraPos[2]+=10),this._2dViewCameraPos=[t,this.totalArraySize+10,0],this.in2dView?(await Promise.all([anime({targets:this.orthographicCamera.position,x:this._2dViewCameraPos[0],y:this._2dViewCameraPos[1],z:this._2dViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}).finished,anime({targets:this.orthographicCamera,left:-(this.totalArrayFootprint/2+.5),right:this.totalArrayFootprint/2+.5,top:this.totalArrayFootprint/2+.5,bottom:-(this.totalArrayFootprint/2+.5),duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix()}).finished]),this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1,this.drawAll2dViewText(),changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/5)):(await Promise.all([anime({targets:this.orthographicCamera.position,x:this.hexViewCameraPos[0],y:this.hexViewCameraPos[1],z:this.hexViewCameraPos[2],duration:this.animationTime,easing:"easeInOutQuad"}).finished,anime({targets:this.orthographicCamera,left:-this.totalArraySize,right:this.totalArraySize,top:this.totalArraySize,bottom:-this.totalArraySize,duration:this.animationTime,easing:"easeInOutQuad",update:()=>this.orthographicCamera.updateProjectionMatrix()}).finished]),this.orthographicCamera.updateProjectionMatrix(),this.currentlyAnimatingCamera=!1)}async showDimers(){if(!this.currentlyAnimatingCamera){this.dimersShown=!0,this.inExactHexView||await this.showHexView(),this.currentlyAnimatingCamera=!0;let r=[];this.arrays.forEach(a=>{for(let i=0;i<a.footprint;i++)for(let e=0;e<a.footprint;e++){for(let t=0;t<a.cubes[i][e].length;t++)t<a.cubes[i][e].length-1&&r.push(a.cubes[i][e][t].material[2]),i<a.footprint-1&&a.cubes[i+1][e].length>=t+1&&r.push(a.cubes[i][e][t].material[4]),e<a.footprint-1&&a.cubes[i][e+1].length>=t+1&&r.push(a.cubes[i][e][t].material[0]),r.push(a.cubes[i][e][t].material[1]),r.push(a.cubes[i][e][t].material[3]),r.push(a.cubes[i][e][t].material[5]);0!==a.cubes[i][e].length&&r.push(a.floor[i][e].material[2])}if(this.addWalls)for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)r.push(a.rightWall[e][t].material[0]),r.push(a.leftWall[e][t].material[4])}),r.forEach(t=>t.opacity=0),await anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:this.animationTime/2,easing:"easeOutQuad",update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}}).finished,this.currentlyAnimatingCamera=!1}}async hideDimers(){if(!this.currentlyAnimatingCamera){this.dimersShown=!1;let r=[];this.arrays.forEach(a=>{for(let i=0;i<a.footprint;i++)for(let e=0;e<a.footprint;e++){for(let t=0;t<a.cubes[i][e].length;t++)t<a.cubes[i][e].length-1&&r.push(a.cubes[i][e][t].material[2]),i<a.footprint-1&&a.cubes[i+1][e].length>=t+1&&r.push(a.cubes[i][e][t].material[4]),e<a.footprint-1&&a.cubes[i][e+1].length>=t+1&&r.push(a.cubes[i][e][t].material[0]),r.push(a.cubes[i][e][t].material[1]),r.push(a.cubes[i][e][t].material[3]),r.push(a.cubes[i][e][t].material[5]);0!==a.cubes[i][e].length&&r.push(a.floor[i][e].material[2])}if(this.addWalls)for(let e=0;e<this.wallSize;e++)for(let t=0;t<2*this.wallSize;t++)r.push(a.leftWall[e][t].material[0]),r.push(a.rightWall[e][t].material[4])}),await anime({targets:[this.wilsonHidden.ctx,this.wilsonHidden2.ctx,this.wilsonHidden3.ctx,this.wilsonHidden4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:this.animationTime/2,easing:"easeOutQuad",update:()=>{this.wilsonHidden.ctx.clearRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(0,0,64,64),this.wilsonHidden.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden.ctx._alpha})`,this.wilsonHidden.ctx.fillRect(4,4,56,56),this.wilsonHidden.ctx.moveTo(42.7,21.3),this.wilsonHidden.ctx.lineTo(21.3,42.7),this.wilsonHidden.ctx.stroke(),this.cubeTexture.needsUpdate=!0,this.wilsonHidden2.ctx.clearRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(64, 64, 64, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(0,0,64,64),this.wilsonHidden2.ctx.fillStyle=`rgba(128, 128, 128, ${this.wilsonHidden2.ctx._alpha})`,this.wilsonHidden2.ctx.fillRect(4,4,56,56),this.wilsonHidden2.ctx.moveTo(21.3,21.3),this.wilsonHidden2.ctx.lineTo(42.7,42.7),this.wilsonHidden2.ctx.stroke(),this.cubeTexture2.needsUpdate=!0,this.wilsonHidden3.ctx.clearRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(0,0,64,64),this.wilsonHidden3.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden3.ctx._alpha})`,this.wilsonHidden3.ctx.fillRect(4,4,56,56),this.wilsonHidden3.ctx.moveTo(42.7,21.3),this.wilsonHidden3.ctx.lineTo(21.3,42.7),this.wilsonHidden3.ctx.stroke(),this.floorTexture.needsUpdate=!0,this.wilsonHidden4.ctx.clearRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(32, 32, 32, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(0,0,64,64),this.wilsonHidden4.ctx.fillStyle=`rgba(64, 64, 64, ${this.addWalls?0:this.wilsonHidden4.ctx._alpha})`,this.wilsonHidden4.ctx.fillRect(4,4,56,56),this.wilsonHidden4.ctx.moveTo(21.3,21.3),this.wilsonHidden4.ctx.lineTo(42.7,42.7),this.wilsonHidden4.ctx.stroke(),this.floorTexture2.needsUpdate=!0}}).finished,r.forEach(t=>t.opacity=1),this.currentlyAnimatingCamera=!1}}async showFloor(t=1){let e=[];return this.arrays.forEach(t=>{t.floor.forEach(t=>{t.forEach(t=>{t.material.forEach(t=>e.push(t))})})}),anime({targets:e,opacity:t,duration:this.animationTime/2,easing:"easeOutQuad"}).finished}hideFloor(){return this.showFloor(0)}removeOutsideFloor(i){let a=[];var r=[];for(let e=0;e<i.footprint;e++)for(let t=i.footprint-1;0<=t&&0===i.numbers[e][t];t--)i.floor[e][t].material.forEach(t=>a.push(t)),r.push([e,t]);r.forEach(t=>{i.floor[t[0]][t[1]].material.forEach(t=>t.dispose()),i.cubeGroup.remove(i.floor[t[0]][t[1]]),i.floor[t[0]][t[1]]=null}),this.in2dView&&this.drawAll2dViewText()}recalculateHeights(e){e.height=0,e.numbers.forEach(t=>{t.forEach(t=>{t!==1/0&&(e.height=Math.max(t,e.height))})}),e.size=Math.max(e.footprint,e.height),this.totalArrayHeight=0,this.arrays.forEach(t=>this.totalArrayHeight=Math.max(t.height,this.totalArrayHeight)),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),this.totalArrayHeight!==this.oldTotalArrayHeight&&this.updateCameraHeight()}drawAll2dViewText(){this.fontSize=this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1);var t=Math.max((""+this.totalArrayHeight).length,2);this.wilsonNumbers.ctx.font=this.fontSize/t+"px monospace",this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),this.arrays.forEach(i=>{for(let e=0;e<i.footprint;e++)for(let t=0;t<i.footprint;t++)null!==i.floor[e][t]&&this.drawSingleCell2dViewText(i,e,t)})}drawSingleCell2dViewText(t,e,i){var a,r=(this.totalArrayFootprint-t.footprint-1)/2,s=t.partialFootprintSum-t.footprint;this.wilsonNumbers.ctx.clearRect(this.fontSize*(i+s+1),this.fontSize*(e+r+1),this.fontSize,this.fontSize),t.numbers[e][i]===1/0||0===t.numbers[e][i]&&0===this.floorLightness||(a=this.wilsonNumbers.ctx.measureText(t.numbers[e][i]),this.wilsonNumbers.ctx.fillText(t.numbers[e][i],this.fontSize*(i+s+1)+(this.fontSize-a.width)/2,this.fontSize*(e+r+1)+(this.fontSize+a.actualBoundingBoxAscent-a.actualBoundingBoxDescent)/2))}async colorCubes(r,s,n){if(0!==s.length){let e=[],t=(s.forEach(t=>{r.cubes[t[0]][t[1]][t[2]].material.forEach(t=>e.push(t.color))}),e.forEach(t=>t.getRGB(t)),this.cubeLightness+ +Math.min(this.cubeLightness,1-this.cubeLightness)),i=0===t?0:2*(1-this.cubeLightness/t),a=e.map(()=>this.wilson.utils.hsvToRgb(n,i,t));await anime({targets:e,r:(t,e)=>a[e][0]/255,g:(t,e)=>a[e][1]/255,b:(t,e)=>a[e][2]/255,duration:this.animationTime,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad",update:()=>e.forEach(t=>t.setRGB(t.r,t.g,t.b))}).finished}}async uncolorCubes(e,t){let i=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(t=>i.push(t.color))}),i.forEach(t=>t.getHSL(t)),await anime({targets:i,s:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>i.forEach(t=>t.setHSL(t.h,t.s,this.cubeLightness))}).finished}async raiseCubes(e,t,i){var a=this.in2dView?0:this.animationTime;let r=[];t.forEach(t=>{r.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),await anime({targets:r,y:i,duration:a,easing:"easeInOutQuad"}).finished}async lowerCubes(i,a){var t=this.in2dView?0:this.animationTime;let e=[];a.forEach(t=>{e.push(i.cubes[t[0]][t[1]][t[2]].position),i.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),await anime({targets:e,y:(t,e)=>i.numbers[a[e][0]][a[e][1]],duration:t,easing:"easeInOutQuad"}).finished,a.forEach(t=>{i.cubes[t[0]][t[1]][i.numbers[t[0]][t[1]]]=i.cubes[t[0]][t[1]][t[2]],i.cubes[t[0]][t[1]][t[2]]=null})}async moveCubes(e,a,r,s,t=!0){let i=[];if(a.forEach(t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),r.cubeGroup.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),await anime({targets:i,x:(t,e)=>s[e][1]-(r.footprint-1)/2,y:(t,e)=>s[e][2],z:(t,e)=>s[e][0]-(r.footprint-1)/2,duration:this.animationTime,easing:"easeInOutQuad"}).finished,t){let i=a.map(t=>e.cubes[t[0]][t[1]][t[2]]);a.forEach(t=>e.cubes[t[0]][t[1]][t[2]]=null),s.forEach((e,t)=>{r.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),r.cubes[e[0]][e[1]][e[2]]&&!a.some(t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),r.cubes[e[0]][e[1]][e[2]]=i[t]})}}async revealCubes(i,t){if(0!==t.length){let e=[];t.forEach(t=>{i.cubes[t[0]][t[1]][t[2]].material.forEach(t=>e.push(t)),i.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),await anime({targets:e,opacity:1,duration:this.animationTime/2,delay:(t,e)=>Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad"}).finished}}async deleteCubes(e,t,i=!1,a=!1){let r=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(t=>r.push(t))}),await anime({targets:r,opacity:0,duration:this.animationTime/2*!a,delay:(t,e)=>!i*Math.floor(e/6)*this.animationTime/10,easing:"easeOutQuad"}).finished,r.forEach(t=>t.dispose()),t.forEach(t=>{e.cubeGroup.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null})}async deleteFloor(e,t){let i=[];t.forEach(t=>{e.floor[t[0]][t[1]].material.forEach(t=>i.push(t))}),await anime({targets:i,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad"}).finished,i.forEach(t=>t.dispose()),t.forEach(t=>{e.cubeGroup.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null})}async runExample(t){if(1===t||2===t){for(;1<this.arrays.length;)await this.removeArray(1),await new Promise(t=>setTimeout(t,this.animationTime/2));var e;0===this.arrays.length?(e=this.parseArray(this.generateRandomPlanePartition()),await this.addNewArray(this.arrays.length,e)):this.verifyPp(this.arrays[0].numbers)||(await this.removeArray(0),await new Promise(t=>setTimeout(t,this.animationTime/2)),e=this.parseArray(this.generateRandomPlanePartition()),await this.addNewArray(this.arrays.length,e)),1===t?(await this.runAlgorithm("hillmanGrassl",0),await new Promise(t=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("hillmanGrasslInverse",0)):(await this.runAlgorithm("pak",0),await new Promise(t=>setTimeout(t,3*this.animationTime)),await this.showHexView(),await new Promise(t=>setTimeout(t,this.animationTime)),await this.runAlgorithm("sulzgruberInverse",0))}else if(3===t){for(;0<this.arrays.length;)await this.removeArray(0),await new Promise(t=>setTimeout(t,this.animationTime/2));await this.addNewArray(this.arrays.length,this.generateRandomTableau()),await this.show2dView(),await new Promise(t=>setTimeout(t,this.animationTime)),await this.runAlgorithm("rskInverse",0),await new Promise(t=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("rsk",0)}}async runAlgorithm(t,r,e=!1){if(e||!this.currentlyRunningAlgorithm){this.currentlyRunningAlgorithm=!0;var i=this.algorithmData[t],s=i.inputType.length;if(r>this.arrays.length-1||r<0)console.log(`No array at index ${r}!`),this.currentlyRunningAlgorithm=!1;else if(1<s&&r>this.arrays.length-s)console.log(`No array at index ${r+s-1}! (This algorithm needs ${s} arrays)`),this.currentlyRunningAlgorithm=!1;else{for(let t=0;t<s;t++){var a=i.inputType[t];if("pp"===a&&!this.verifyPp(this.arrays[r+t].numbers))return console.log(`Array at index ${r+t} is not a plane partition!`),void(this.currentlyRunningAlgorithm=!1);if("ssyt"===a&&!this.verifySsyt(this.arrays[r+t].numbers))return console.log(`Array at index ${r+t} is not an SSYT!`),void(this.currentlyRunningAlgorithm=!1)}if(1<s&&void 0!==i.sameShape&&i.sameShape){var n=new Array(s);let a=0;for(let t=0;t<s;t++)a=Math.max(a,this.arrays[r+t].numbers.length);for(let i=0;i<s;i++){n[i]=new Array(a);for(let t=0;t<a;t++)n[i][t]=0;for(let e=0;e<this.arrays[r+i].numbers.length;e++){let t=0;for(;t<this.arrays[r+i].numbers[e].length&&0!==this.arrays[r+i].numbers[e][t];)t++;n[i][e]=t}}for(let e=1;e<s;e++)for(let t=0;t<a;t++)if(n[e][t]!==n[0][t])return this.displayError("Arrays are not the same shape!"),void(this.currentlyRunningAlgorithm=!1)}for(let t=0;t<s;t++){var o=[],h=this.arrays[r+t].numbers;for(let i=0;i<h.length;i++)for(let e=0;e<h.length;e++)if(h[i][e]!==1/0)for(let t=0;t<h[i][e];t++)o.push([i,e,t]);this.uncolorCubes(this.arrays[r+t],o)}await i.method.bind(this)(r),this.subAlgorithm||(this.currentlyRunningAlgorithm=!1)}}}async hillmanGrassl(t){var a=this.arrays[t],r=structuredClone(a.numbers),s=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[t][e]===1/0;)t++;s[e]=t}var n=new Array(r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;n[e]=t}for(var o=[];;){let t=r[0].length-1;for(;0<=t&&s[t]<r.length&&0===r[s[t]][t];)t--;if(t<0||s[t]===r.length)break;let e=s[t],i=t;for(var h=[[e,i,r[e][i]-1]];;){if(e<r.length-1&&r[e+1][i]===r[e][i])e++;else{if(!(0<i&&r[e][i-1]!==1/0))break;i--}h.push([e,i,r[e][i]-1])}for(let t=0;t<h.length;t++)r[h[t][0]][h[t][1]]--;o.push(h)}var i=new Array(r.length);for(let e=0;e<r.length;e++){i[e]=new Array(r.length);for(let t=0;t<r.length;t++)i[e][t]=r[e][t]===1/0?1/0:0}var l=await this.addNewArray(t+1,i);await new Promise(t=>setTimeout(t,this.animationTime));for(let i=0;i<o.length;i++){var u=i/o.length*6/7;await this.colorCubes(a,o[i],u),await this.raiseCubes(a,o[i],a.height);for(let t=0;t<o[i].length;t++)a.numbers[o[i][t][0]][o[i][t][1]]--,this.in2dView&&this.drawSingleCell2dViewText(a,o[i][t][0],o[i][t][1]);this.recalculateHeights(a),await new Promise(t=>setTimeout(t,this.animationTime/5));var d=[o[i][o[i].length-1][0],o[i][0][1]];let e=[];var c=l.height+1;for(let t=s[d[1]];t<=d[0];t++)e.push([t,d[1],c]);u=e[e.length-1];for(let t=d[1]-1;t>=n[d[0]];t--)e.push([d[0],t,c]);await this.moveCubes(a,o[i],l,e),e=[];for(let t=d[0]-1;t>=s[d[1]];t--)e.push([t,d[1],c]);this.deleteCubes(l,e),e=[];for(let t=d[1]-1;t>=n[d[0]];t--)e.push([d[0],t,c]);this.deleteCubes(l,e),await this.lowerCubes(l,[u]),l.numbers[u[0]][u[1]]++,this.recalculateHeights(l),this.in2dView&&this.drawSingleCell2dViewText(l,u[0],u[1]),l.height=Math.max(l.height,l.numbers[u[0]][u[1]]),l.size=Math.max(l.size,l.height),await new Promise(t=>setTimeout(t,this.animationTime))}await this.removeArray(t)}async hillmanGrasslInverse(t){var r=this.arrays[t],s=structuredClone(r.numbers),n=[],o=new Array(s.length);for(let e=0;e<s.length;e++){let t=0;for(;t<s.length&&s[t][e]===1/0;)t++;o[e]=t}var h=new Array(s.length);for(let e=0;e<s.length;e++){let t=0;for(;t<s.length&&s[e][t]===1/0;)t++;h[e]=t}var i=new Array(s.length);for(let e=0;e<s.length;e++){i[e]=new Array(s.length);for(let t=0;t<s.length;t++)i[e][t]=s[e][t]===1/0?1/0:0}var l=structuredClone(i);let u=await this.addNewArray(t+1,i);for(let r=0;r<s.length;r++)for(let t=s.length-1;t>=o[r];t--)for(;0!==s[t][r];){var d=[];let i=t,a=h[t];for(;0<=i;){let e=a;if(0!==i)for(;l[i][e]!==l[i-1][e]&&e<r;)e++;else e=r;for(let t=a;t<=e;t++)d.push([i,t,l[i][t]]);if(!(i-1>=o[e]))break;i--,a=e}for(let t=0;t<d.length;t++)l[d[t][0]][d[t][1]]++;n.push([d,[t,r,s[t][r]-1]]),s[t][r]--}await new Promise(t=>setTimeout(t,this.animationTime/2));for(let t=0;t<n.length;t++){let e=t/n.length*6/7;await this.colorCubes(r,[n[t][1]],e);var c=n[t][1][0],m=n[t][1][1],f=r.size;for(let t=o[m];t<c;t++)r.cubes[t][m][f]=this.addCube(r,m,f,t),r.cubes[t][m][f].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=h[c];t<m;t++)r.cubes[c][t][f]=this.addCube(r,t,f,c),r.cubes[c][t][f].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));await this.raiseCubes(r,[n[t][1]],f);let i=[];for(let t=c-1;t>=o[m];t--)i.push([t,m,f]);var w=this.revealCubes(r,i);i=[];for(let t=m-1;t>=h[c];t--)i.push([c,t,f]);var g=this.revealCubes(r,i);await Promise.all([w,g]),i=[];for(let t=h[c];t<m;t++)i.push([c,t,f]);i.push([c,m,r.numbers[c][m]-1]);for(let t=c-1;t>=o[m];t--)i.push([t,m,f]);w=n[t][0];let a=u.height+1;w.forEach(t=>t[2]=a),r.numbers[c][m]--,this.recalculateHeights(r),this.in2dView&&this.drawSingleCell2dViewText(r,c,m),await this.moveCubes(r,i,u,w),await this.lowerCubes(u,w),w.forEach(t=>{u.numbers[t[0]][t[1]]++}),this.recalculateHeights(u),this.in2dView&&w.forEach(t=>this.drawSingleCell2dViewText(u,t[0],t[1])),await new Promise(t=>setTimeout(t,this.animationTime/2))}await this.removeArray(t)}async pak(t){let o=this.arrays[t],h=o.numbers,i=(this.in2dView||await this.show2dView(),0),a=0;for(;i<o.footprint&&0!==o.numbers[i][o.footprint-1];)i++;for(;a<o.footprint&&0!==o.numbers[o.footprint-1][a];)a++;i=0;let l=a=0;for(let e=o.footprint-1-a;0<=e;e--)for(let t=o.footprint-1-i;0<=t;t--)h[e][t]!==1/0&&l++;let u=0;for(let n=0;n<o.footprint-a;n++)for(let t=0;t<o.footprint-i;t++)if(h[n][t]!==1/0){var d=[];let i=0;for(;n+i<o.footprint&&t+i<o.footprint;)d.push([n+i,t+i,h[n+i][t+i]-1]),i++;i=d[0][0];let a=d[0][1],e=[];for(let t=h[i][a]-2;0<=t;t--)e.push([i,a,t]);this.colorCubes(o,e,u/l*6/7),e=[],d.forEach(t=>{0<=t[2]&&e.push(t)}),await this.colorCubes(o,e,u/l*6/7);let s=new Array(d.length);d.forEach((t,e)=>{var i=t[0],t=t[1];let a=0,r=0;i<o.footprint-1&&(a=h[i+1][t]),t<o.footprint-1&&(r=h[i][t+1]),s[e]=Math.max(a,r),0<e?(a=h[i-1][t],r=h[i][t-1],s[e]+=Math.min(a,r)-h[i][t]):s[e]=h[i][t]-s[e]});for(let e=0;e<d.length;e++){if(i=d[e][0],a=d[e][1],s[e]>h[i][a]){var c=[];for(let t=h[i][a];t<s[e];t++)o.cubes[i][a][t]=this.addCube(o,a,t,i),c.push([i,a,t]);this.in2dView?this.revealCubes(o,c):await this.revealCubes(o,c)}else if(s[e]<h[i][a]){var m=[];for(let t=h[i][a]-1;t>=s[e];t--)m.push([i,a,t]);this.in2dView?this.deleteCubes(o,m):await this.deleteCubes(o,m)}h[i][a]=s[e],this.in2dView&&this.drawSingleCell2dViewText(o,i,a)}let r=[];e.forEach((t,e)=>{0!==e&&t[2]<h[t[0]][t[1]]&&r.push(t)}),this.in2dView?this.uncolorCubes(o,r):await this.uncolorCubes(o,r),u++,this.recalculateHeights(o),0!==e.length&&await new Promise(t=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0)}async pakInverse(t,i=0,a=0){let o=this.arrays[t],h=o.numbers,r=(this.in2dView||await this.show2dView(),0);for(let e=o.footprint-1-a;0<=e;e--)for(let t=o.footprint-1-i;0<=t;t--)h[e][t]!==1/0&&r++;let l=0;for(let e=o.footprint-1-a;0<=e;e--)for(let t=o.footprint-1-i;0<=t;t--)if(h[e][t]!==1/0){var u=[];let i=0;for(;e+i<o.footprint&&t+i<o.footprint;)u.push([e+i,t+i,h[e+i][t+i]-1]),i++;i=u[0][0];let a=u[0][1],s=new Array(u.length),n=!1;if(u.forEach((t,e)=>{var i=t[0],t=t[1];let a=0,r=0;i<o.footprint-1&&(a=h[i+1][t]),t<o.footprint-1&&(r=h[i][t+1]),s[e]=Math.max(a,r),0<e?(a=h[i-1][t],r=h[i][t-1],s[e]+=Math.min(a,r)-h[i][t]):s[e]+=h[i][t],n||s[e]===h[i][t]||(n=!0)}),0!==h[i][a]){var d=[];for(let t=h[i][a]-1;0<=t;t--)d.push([i,a,t]);this.colorCubes(o,d,l/r*6/7)}else if(0!==s[0])o.cubes[i][a][0]=this.addCube(o,a,0,i,l/r*6/7,1,this.cubeLightness),h[i][a]=1,this.revealCubes(o,[[i,a,0]]);else if(!n){l++;continue}await new Promise(t=>setTimeout(t,this.animationTime));for(let e=0;e<u.length;e++){if(i=u[e][0],a=u[e][1],s[e]>h[i][a]){var c=[];for(let t=h[i][a];t<s[e];t++)o.cubes[i][a][t]=this.addCube(o,a,t,i,l/r*6/7,1,this.cubeLightness),c.push([i,a,t]);this.in2dView?this.revealCubes(o,c):await this.revealCubes(o,c)}else if(s[e]<h[i][a]){var m=[];for(let t=h[i][a]-1;t>=s[e];t--)m.push([i,a,t]);this.in2dView?this.deleteCubes(o,m):await this.deleteCubes(o,m)}h[i][a]=s[e],this.in2dView&&this.drawSingleCell2dViewText(o,i,a)}l++,this.recalculateHeights(o),await new Promise(t=>setTimeout(t,this.animationTime))}this.updateCameraHeight(!0)}async sulzgruber(t){let i=this.arrays[t],n=structuredClone(i.numbers);var a=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[t][e]===1/0;)t++;a[e]=t}var o=new Array(n.length);for(let e=0;e<n.length;e++){let t=0;for(;t<n.length&&n[e][t]===1/0;)t++;o[e]=t}var r,s,h={},l={};for(let t=0;t<n.length;t++)l[-t]=[t,0];for(let t=1;t<n.length;t++)l[t]=[0,t];for(let i=1-n.length;i<n.length;i++){let t=l[i][0],e=l[i][1];for(;t<n.length&&e<n.length&&n[t][e]===1/0;)t++,e++;l[i]=[t,e],t===n.length||e===n.length?h[i]=-1:(r=0===e||n[t][e-1]===1/0,s=0===t||n[t-1][e]===1/0,h[i]=r&&s?0:r?3:s?2:1)}var u=[];for(let s=1-n.length;s<n.length;s++)if(1!==h[s]&&3!==h[s]){let a=l[s][0],r=l[s][1];if(0!==n[a][r])for(;;){let t=!1;for(;a<n.length&&r<n.length&&0!==n[a][r];){if((r<n.length-1&&n[a][r]>n[a][r+1]||r===n.length-1&&0<n[a][r])&&(0===h[s]||2===h[s]&&(a<n.length-1&&n[a][r]>n[a+1][r]||a===n.length-1&&0<n[a][r]))){t=!0;break}a++,r++}if(!t)break;let e=a,i=r;for(var d=[[e,i,n[e][i]-1]];;){var c=i-e;if(e<n.length-1&&n[e][i]===n[e+1][i]&&(0===h[c]||3===h[c]))e++;else{if(!(i>o[e]&&(e===n.length-1||e<n.length-1&&n[e][i]>n[e+1][i])))break;i--}d.push([e,i,n[e][i]-1])}d.forEach(t=>n[t[0]][t[1]]--),u.push(d)}}var m=new Array(n.length);for(let e=0;e<n.length;e++){m[e]=new Array(n.length);for(let t=0;t<n.length;t++)m[e][t]=n[e][t]===1/0?1/0:0}var f=await this.addNewArray(t+1,m);await new Promise(t=>setTimeout(t,this.animationTime));for(let t=0;t<u.length;t++){var w=t/u.length*6/7,g=(await this.colorCubes(i,u[t],w),await this.raiseCubes(i,u[t],i.height+1),u[t].forEach(t=>{i.numbers[t[0]][t[1]]--,this.in2dView&&this.drawSingleCell2dViewText(i,t[0],t[1])}),this.recalculateHeights(i),await new Promise(t=>setTimeout(t,this.animationTime/5)),u[t][u[t].length-1][0]),p=l[u[t][u[t].length-1][1]-g+u[t].length-1][1];let e=[];var y=Math.max(i.height+1,f.height+1);for(let t=a[p];t<=g;t++)e.push([t,p,y]);for(let t=p-1;t>=o[g];t--)e.push([g,t,y]);await this.moveCubes(i,u[t],f,e),e=[];for(let t=g-1;t>=a[p];t--)e.push([t,p,y]);this.deleteCubes(f,e),e=[];for(let t=p-1;t>=o[g];t--)e.push([g,t,y]);this.deleteCubes(f,e),await this.lowerCubes(f,[[g,p,y]]),f.numbers[g][p]++,this.in2dView&&this.drawSingleCell2dViewText(f,g,p),this.recalculateHeights(f),await new Promise(t=>setTimeout(t,this.animationTime))}await this.removeArray(t)}async sulzgruberInverse(t){var n=this.arrays[t],o=n.numbers,h=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[t][e]===1/0;)t++;h[e]=t}var l=new Array(o.length);for(let e=0;e<o.length;e++){let t=0;for(;t<o.length&&o[e][t]===1/0;)t++;l[e]=t}var u={};for(let t=0;t<o.length;t++)u[-t]=[t,0];for(let t=1;t<o.length;t++)u[t]=[0,t];for(let i=1-o.length;i<o.length;i++){let t=u[i][0],e=u[i][1];for(;t<o.length&&e<o.length&&o[t][e]===1/0;)t++,e++;u[i]=[t,e]}let d=0;var i=new Array(o.length);for(let e=0;e<o.length;e++){i[e]=new Array(o.length);for(let t=0;t<o.length;t++)o[e][t]===1/0?i[e][t]=1/0:(i[e][t]=0,d+=o[e][t])}let c=await this.addNewArray(t+1,i),m=0;for(let s=o.length-1;0<=s;s--)for(let t=o.length-1;0<=t;t--)if(o[t][s]!==1/0)for(;0!==o[t][s];){let e=m/d*6/7;var f=Math.max(n.size+1,c.size+1),w=(await this.colorCubes(n,[[t,s,o[t][s]-1]],e),await this.raiseCubes(n,[[t,s,o[t][s]-1]],f),t),g=s;for(let t=h[g];t<w;t++)n.cubes[t][g][f]=this.addCube(n,g,f,t),n.cubes[t][g][f].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=l[w];t<g;t++)n.cubes[w][t][f]=this.addCube(n,t,f,w),n.cubes[w][t][f].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));let i=[];for(let t=w-1;t>=h[g];t--)i.push([t,g,f]);var p=this.revealCubes(n,i);i=[];for(let t=g-1;t>=l[w];t--)i.push([w,t,f]);var y=this.revealCubes(n,i);await Promise.all([p,y]),i=[];for(let t=l[w];t<g;t++)i.push([w,t,f]);i.push([w,g,n.numbers[w][g]-1]);for(let t=w-1;t>=h[g];t--)i.push([t,g,f]);var p=l[w]-w,b=p+i.length-1,x=[];for(let t=p;t<=b;t++)x.push(structuredClone(u[t]));o[w][g]--,this.recalculateHeights(n),this.in2dView&&this.drawSingleCell2dViewText(n,w,g),await this.moveCubes(n,i,c,x);let a=0,r=c.numbers[x[0][0]][x[0][1]];for(;;){let t=a;for(;t<x.length&&x[t][0]===x[a][0];)t++;i=x.slice(a,t);let e=!0;for(let t=0;t<i.length;t++)if(c.numbers[i[t][0]][i[t][1]]!==r){e=!1;break}if(e)await this.lowerCubes(c,i),i.forEach(t=>c.numbers[t[0]][t[1]]++),this.recalculateHeights(c),this.in2dView&&i.forEach(t=>{this.drawSingleCell2dViewText(c,t[0],t[1])}),a=t;else{var T=structuredClone(x.slice(a));for(let t=a;t<x.length;t++)if(x[t][0]++,x[t][1]++,x[t][0]>c.footprint||x[t][1]>c.footprint)return void console.error("Insertion failed!");var v=x.slice(a);await this.moveCubes(c,T,c,v),r=c.numbers[x[a][0]][x[a][1]]}if(a===x.length)break}m++,await new Promise(t=>setTimeout(t,this.animationTime/2))}await this.removeArray(t)}async rsk(e){var h=this.arrays[e],l=this.arrays[e+1],u=h.numbers,d=l.numbers;let i=0,c=0;for(let e=0;e<u.length;e++)for(let t=0;t<u.length;t++){if(u[e][t]===1/0||d[e][t]===1/0)return this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),void(this.currentlyRunningAlgorithm=!1);0!==u[e][t]&&c++,i=Math.max(Math.max(i,u[e][t]),d[e][t])}if(0===i)this.displayError("The SSYT are empty!"),this.currentlyRunningAlgorithm=!1;else{var m=new Array(i);for(let e=0;e<i;e++){m[e]=new Array(i);for(let t=0;t<i;t++)m[e][t]=0}var f=await this.addNewArray(e+2,m);let t=0;for(;0!==d[0][0];){var w=t/c*6/7;let i=0,a=0,r=0;for(let e=0;e<d.length;e++){let t=d.length-1;for(;0<=t&&0===d[e][t];)t--;0<=t&&(i=Math.max(i,d[e][t]))}for(let e=0;e<d.length;e++){let t=d.length-1;for(;0<=t&&0===d[e][t];)t--;if(d[e][t]===i){a=e,r=t;break}}var g=[],p=[],y=[],b=[],x=[],T=[];let s=a,n=r,o=u[s][n];for(var v=d[s][n],H=[[s,n]];0!==s;){let e=u.length-1;for(;0===u[s-1][e]||o<=u[s-1][e];)e--;for(let t=0;t<o;t++)g.push([s,n,t]),p.push([s-1,e,t]);s--,n=e,o=u[s][n],H.push([s,n])}var A=f.height+1;for(let t=0;t<o;t++)y.push([s,n,t]),b.push([v-1,t,A]);for(let t=0;t<v-1;t++)x.push([a,r,t]),T.push([t,o-1,A]);this.colorCubes(l,x.concat([[a,r,v-1]]),w),this.colorCubes(h,g,w),await this.colorCubes(h,y,w),d[a][r]=0;for(let t=H.length-1;0<t;t--)u[H[t][0]][H[t][1]]=u[H[t-1][0]][H[t-1][1]];if(u[a][r]=0,this.in2dView){this.drawSingleCell2dViewText(h,a,r);for(let t=H.length-1;0<t;t--)this.drawSingleCell2dViewText(h,H[t][0],H[t][1]);this.drawSingleCell2dViewText(l,a,r)}this.moveCubes(l,x,f,T),this.moveCubes(h,y,f,b),this.moveCubes(h,g,h,p),await this.moveCubes(l,[[a,r,v-1]],f,[[v-1,o-1,A]],!1),this.uncolorCubes(h,p),f.cubeGroup.remove(l.cubes[a][r][v-1]),this.deleteCubes(l,[[a,r,v-1]],!0,!0),b.reverse(),T.reverse(),this.deleteCubes(f,b.slice(1)),this.deleteCubes(f,T),await this.lowerCubes(f,[[v-1,o-1,A]]),m[v-1][o-1]++,this.in2dView&&this.drawSingleCell2dViewText(f,v-1,o-1),this.recalculateHeights(f),t++,await new Promise(t=>setTimeout(t,this.animationTime/2))}await this.removeArray(e),await new Promise(t=>setTimeout(t,this.animationTime)),await this.removeArray(e)}}async rskInverse(t){var a=this.arrays[t],s=structuredClone(a.numbers);let r=0,n=(s.forEach(t=>t.forEach(t=>r+=t)),new Array(r)),o=new Array(r);for(let e=0;e<r;e++){n[e]=new Array(r),o[e]=new Array(r);for(let t=0;t<r;t++)n[e][t]=0,o[e][t]=0}var h=new Array(s.length);for(let t=0;t<s.length;t++)h[t]=0;let l=0;var u=[],d=[],c=[];for(let r=0;r<s.length;r++)for(let a=0;a<s.length;a++)for(;0!==s[r][a];){s[r][a]--;let t=a+1,e=0,i=0;for(var m=[];;){for(i=h[e];0!==i&&n[e][i-1]>t;)i--;if(i===h[e]){n[e][i]=t,h[e]++,0===i&&l++,m.push([e,i]);break}var f=n[e][i];n[e][i]=t,t=f,m.push([e,i]),e++}u.push(m),d.push([e,i]),c.push([r,a]),o[e][i]=r+1}var i=Math.max(h[0],l);n=new Array(i),o=new Array(i);for(let e=0;e<i;e++){n[e]=new Array(i),o[e]=new Array(i);for(let t=0;t<i;t++)n[e][t]=0,o[e][t]=0}var w=await this.addNewArray(t+1,n),g=(await new Promise(t=>setTimeout(t,this.animationTime/2)),await this.addNewArray(t+2,o));await new Promise(t=>setTimeout(t,this.animationTime/2));let p=0;for(let t=0;t<c.length;t++){var y=c[t][0],b=c[t][1],x=a.height+1;let e=p/r*6/7;for(let t=b;0<=t;t--)a.cubes[y][t][x]=this.addCube(a,t,x,y),a.cubes[y][t][x].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));for(let t=y-1;0<=t;t--)a.cubes[t][b][x]=this.addCube(a,b,x,t),a.cubes[t][b][x].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness));a.cubes[y][b][x+1]=this.addCube(a,b,x,y),a.cubes[y][b][x+1].material.forEach(t=>t.color.setHSL(e,1,this.cubeLightness)),await this.colorCubes(a,[[y,b,a.numbers[y][b]-1]],e),await this.raiseCubes(a,[[y,b,a.numbers[y][b]-1]],x);var T=this.revealCubes(a,[[y,b,x+1]]);let i=[];for(let t=b-1;0<=t;t--)i.push([y,t,x]);var v=this.revealCubes(a,i);i=[];for(let t=y-1;0<=t;t--)i.push([t,b,x]);var H=this.revealCubes(a,i),A=(await Promise.all([T,v,H]),u[p]),C=[],E=[],S=[[y,b,a.numbers[y][b]-1]],R=[[A[0][0],A[0][1],b]],M=[[y,b,x+1]],V=[[d[p][0],d[p][1],y]];for(let t=b-1;0<=t;t--)S.push([y,t,x]),R.push([A[0][0],A[0][1],t]);for(let e=0;e<A.length-1;e++)for(let t=0;t<n[A[e][0]][A[e][1]];t++)C.push([A[e][0],A[e][1],t]),E.push([A[e+1][0],A[e+1][1],t]);for(let t=y-1;0<=t;t--)M.push([t,b,x]),V.push([d[p][0],d[p][1],t]);await this.colorCubes(w,C,e);for(let t=A.length-1;0<t;t--)n[A[t][0]][A[t][1]]=n[A[t-1][0]][A[t-1][1]];0!==A.length&&(n[A[0][0]][A[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==C.length&&await this.moveCubes(w,C,w,E),a.numbers[y][b]--,this.in2dView&&this.drawAll2dViewText(),this.moveCubes(a,S,w,R),await this.moveCubes(a,M,g,V),n[A[0][0]][A[0][1]]=b+1,o[d[p][0]][d[p][1]]=y+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(a),this.recalculateHeights(w),this.recalculateHeights(g),p++,await new Promise(t=>setTimeout(t,this.animationTime/2))}await this.removeArray(t)}async godar1(a){var t;let r=this.arrays[a].numbers;var s=new Array(2*r.length),i=new Array(2*r.length);for(let e=0;e<r.length;e++){let t=0;for(;t<r.length&&r[e][t]===1/0;)t++;for(s[e]=t,t=0;t<r.length&&r[t][e]===1/0;)t++;i[e]=t}for(let t=r.length;t<2*r.length;t++)s[t]=0,i[t]=0;var n=Math.max(s[0],i[0]),o=new Array(r.length);for(let e=0;e<r.length;e++){o[e]=new Array(r.length);for(let t=0;t<r.length;t++)r[e][t]===1/0?o[e][t]=this.infiniteHeight:o[e][t]=r[e][t]}await this.addNewArray(a+1,o),await new Promise(t=>setTimeout(t,this.animationTime/2)),await this.removeArray(a),await new Promise(t=>setTimeout(t,this.animationTime/2)),t=this.arrays[a],r=t.numbers;let h=0,l=0;for(;h<r.length&&0!==r[h][r.length-1];)h++;for(;l<r.length&&0!==r[r.length-1][l];)l++;await this.runAlgorithm("pak",a,!0),await new Promise(t=>setTimeout(t,2*this.animationTime)),t=this.arrays[a],r=t.numbers;var e=Math.max(h,l),u=new Array(r.length-e+1),d=[];for(let i=0;i<u.length-1;i++){u[i]=new Array(u.length);for(let e=0;e<u.length-1;e++){u[i][e]=r[i][e];for(let t=0;t<r[i][e];t++)d.push([i,e,t]);r[i][e]=0}u[i][u.length-1]=0}u[u.length-1]=new Array(u.length);for(let t=0;t<u.length;t++)u[u.length-1][t]=0;this.deleteCubes(t,d,!0,!0),await this.addNewArray(a,u),await new Promise(t=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pakInverse",a,!0),await new Promise(t=>setTimeout(t,2*this.animationTime));var c=2*r.length-s[r.length-1]-i[r.length-1],m=s[0]+i[0],f=new Array(4*r.length),w=new Array(m),g=new Array(4*r.length);for(let t=0;t<4*r.length;t++)f[t]=new Array;for(let t=0;t<m;t++)w[t]=new Array;for(let t=0;t<4*r.length;t++)g[t]=new Array;let p=1;for(let e=0;e<2*r.length;e++)for(let t=0;t<2*r.length;t++)t>=s[e]?f[e+t+1-s[e]-i[t]].push([e,t]):w[s[e]+i[t]-e-t-1].unshift([n-e-1,n-t-1]),g[e+t+1].push([e,t]);var y=new Array(2*r.length);for(let t=0;t<2*r.length;t++)y[t]=new Array(2*r.length);for(let e=1;e<c;e++){var b=[];for(let t=0;t<f[e].length;t++){var x=f[e][t][0],T=f[e][t][1];if(x<r.length-l&&T<r.length-h)for(let t=0;t<this.arrays[a].numbers[x][T];t++)b.push([x,T,t]);t<g[e].length?(y[x][T]=[1,g[e][t]],x<r.length&&T<r.length&&0<this.arrays[a].numbers[x][T]&&(p=Math.max(Math.max(p,g[e][t][0]+1),g[e][t][1]+1))):y[x][T]=[0,w[e][t-g[e].length]]}0!==b.length&&this.colorCubes(this.arrays[a],b,(e-1)/(c-1)*6/7)}await new Promise(t=>setTimeout(t,3*this.animationTime));var v=new Array(n);for(let e=0;e<n;e++){v[e]=new Array(n);for(let t=0;t<n;t++)t<n-s[n-e-1]?v[e][t]=1/0:v[e][t]=0}let H=null;0<n&&(H=await this.addNewArray(a+1,v),await new Promise(t=>setTimeout(t,this.animationTime/2)));var A=new Array(p);for(let e=0;e<p;e++){A[e]=new Array(p);for(let t=0;t<p;t++)A[e][t]=0}var C=await this.addNewArray(a+2,A);for(let i=0;i<r.length-l;i++)for(let e=s[i];e<r.length-h;e++)if(0<this.arrays[a].numbers[i][e]){var E=[],S=[],R=y[i][e][1][0],M=y[i][e][1][1];for(let t=0;t<this.arrays[a].numbers[i][e];t++)E.push([i,e,t]),S.push([R,M,t]);0===y[i][e][0]?(await this.moveCubes(this.arrays[a],E,H,S),v[R][M]=this.arrays[a].numbers[i][e]):(await this.moveCubes(this.arrays[a],E,C,S),A[R][M]=this.arrays[a].numbers[i][e]),this.arrays[a].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}await new Promise(t=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",a,!0),0<n&&await this.runAlgorithm("hillmanGrasslInverse",a+1,!0)}async godar1Inverse(a){var r=this.arrays[a+1].numbers,s=this.arrays[a].numbers,i=new Array(r.length+2*s.length),n=new Array(r.length+2*s.length);for(let t=0;t<r.length+2*s.length;t++)i[t]=0,n[t]=0;for(let e=0;e<s.length;e++){let t=s.length-1;for(;0<=t&&s[e][t]!==1/0;)t--;for(i[s.length-e-1]=s.length-t-1,t=s.length-1;0<=t&&s[t][e]!==1/0;)t--;n[s.length-e-1]=s.length-t-1}await this.runAlgorithm("pak",a,!0),await new Promise(t=>setTimeout(t,this.animationTime/2)),await this.runAlgorithm("pak",a+1,!0),await new Promise(t=>setTimeout(t,3*this.animationTime));let o=[],h=this.arrays[a].numbers;for(let i=0;i<h.length;i++)for(let e=0;e<h.length;e++)if(h[i][e]!==1/0)for(let t=0;t<h[i][e];t++)o.push([i,e,t]);this.uncolorCubes(this.arrays[a],o),o=[],h=this.arrays[a+1].numbers;for(let i=0;i<h.length;i++)for(let e=0;e<h.length;e++)if(h[i][e]!==1/0)for(let t=0;t<h[i][e];t++)o.push([i,e,t]);await this.uncolorCubes(this.arrays[a+1],o);let l=Math.max(i[0],n[0])+2*r.length-1;var e=2*l,u=i[0]+n[0],t=2*r.length,d=new Array(e),c=new Array(u),m=new Array(t);for(let t=0;t<e;t++)d[t]=new Array;for(let t=0;t<u;t++)c[t]=new Array;for(let e=0;e<t;e++){m[e]=new Array(e);for(let t=0;t<e;t++)m[e][t]=-1}for(;i.length<l;)i.push(0);for(;n.length<l;)n.push(0);for(let e=0;e<l;e++)for(let t=0;t<l;t++)t>=i[e]?d[e+t+1-i[e]-n[t]].push([e,t]):c[i[e]+n[t]-e-t-1].unshift([s.length-e-1,s.length-t-1]),e<r.length&&t<r.length&&(m[e+t+1][e]=[e,t]);var f=new Array(r.length);for(let t=0;t<r.length;t++)f[t]=new Array(r.length);var w=new Array(s.length);for(let t=0;t<s.length;t++)w[t]=new Array(s.length);for(let e=l=1;e<u;e++){var g=[];for(let t=0;t<c[e].length;t++){var p=c[e][t][0],y=c[e][t][1];for(let t=0;t<this.arrays[a].numbers[p][y];t++)g.push([p,y,t]);w[p][y]=d[e][t+m[e].length],0!==this.arrays[a].numbers[p][y]&&(l=Math.max(Math.max(l,w[p][y][0]+1),w[p][y][1]+1))}0!==g.length&&this.colorCubes(this.arrays[a],g,(e-1)/(u-1)*6/7)}for(let e=1;e<t;e++){var b=[];for(let t=0;t<m[e].length;t++)if(-1!==m[e][t]){var x=m[e][t][0],T=m[e][t][1];for(let t=0;t<this.arrays[a+1].numbers[x][T];t++)b.push([x,T,t]);f[x][T]=d[e][t],0!==this.arrays[a+1].numbers[x][T]&&(l=Math.max(Math.max(l,f[x][T][0]+1),f[x][T][1]+1))}0!==b.length&&this.colorCubes(this.arrays[a+1],b,(e-1)/(t-1)*6/7)}await new Promise(t=>setTimeout(t,3*this.animationTime));var v=new Array(l);for(let e=0;e<l;e++){v[e]=new Array(l);for(let t=0;t<l;t++)t<i[e]?v[e][t]=1/0:v[e][t]=0}var H=await this.addNewArray(a+2,v);await new Promise(t=>setTimeout(t,this.animationTime/2));for(let i=0;i<s.length;i++)for(let e=0;e<s.length;e++)if(0<this.arrays[a].numbers[i][e]&&this.arrays[a].numbers[i][e]!==1/0){var A=[],C=[],E=w[i][e][0],S=w[i][e][1];for(let t=0;t<this.arrays[a].numbers[i][e];t++)A.push([i,e,t]),C.push([E,S,t]);await this.moveCubes(this.arrays[a],A,H,C),v[E][S]=this.arrays[a].numbers[i][e],this.arrays[a].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}for(let i=0;i<r.length;i++)for(let e=0;e<r.length;e++)if(0<this.arrays[a+1].numbers[i][e]&&this.arrays[a+1].numbers[i][e]!==1/0){var R=[],M=[],V=f[i][e][0],P=f[i][e][1];for(let t=0;t<this.arrays[a+1].numbers[i][e];t++)R.push([i,e,t]),M.push([V,P,t]);await this.moveCubes(this.arrays[a+1],R,H,M),v[V][P]=this.arrays[a+1].numbers[i][e],this.arrays[a+1].numbers[i][e]=0,this.in2dView&&this.drawAll2dViewText()}await this.removeArray(a),await new Promise(t=>setTimeout(t,this.animationTime/2)),await this.removeArray(a),await new Promise(t=>setTimeout(t,3*this.animationTime)),await this.runAlgorithm("pakInverse",a,!0),await new Promise(t=>setTimeout(t,this.animationTime))}async drawBoundary(t,e){this.in2dView||await this.show2dView(),"0"!==this.wilsonNumbers.canvas.style.opacity&&await changeOpacity(this.wilsonNumbers.canvas,0,this.animationTime/3),this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight);let i=this.arrays[t];var a,r=i.numbers,s=[];let n=0,o=0;for(let t=i.footprint-1;0<=t;t--){for(;o<i.footprint&&r[t][o]===1/0;)t!==i.footprint-1&&r[t+1][o]===1/0||(a=n%e/e,a=this.wilson.utils.hsvToRgb(a,1,1),s.push([t,o,!0,`rgba(${a[0]}, ${a[1]}, ${a[2]}, `]),n++),o++;var h=n%e/e,h=this.wilson.utils.hsvToRgb(h,1,1);s.push([t,o,!1,`rgba(${h[0]}, ${h[1]}, ${h[2]}, `]),n++}for(var l;o<i.footprint;)-1!=i.footprint-1&&r[0][o]===1/0||(l=n%e/e,l=this.wilson.utils.hsvToRgb(l,1,1),s.push([-1,o,!0,`rgba(${l[0]}, ${l[1]}, ${l[2]}, `]),n++),o++;return s.forEach(t=>{this.drawBoundaryRect(i,t[0],t[1],t[2],t[3]+" 1)")}),await changeOpacity(this.wilsonNumbers.canvas,1,this.animationTime/3),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)",s}async drawNQuotient(t,i,a,e){let r=this.arrays[t],s={t:1};await anime({targets:s,t:0,duration:this.animationTime,easing:"easeOutQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{e=e%i===a?1:s.t;this.drawBoundaryRect(r,t[0],t[1],t[2],t[3]+` ${e})`)})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{e=e%i===a?1:0;this.drawBoundaryRect(r,t[0],t[1],t[2],t[3]+` ${e})`)});t=(e=e.filter((t,e)=>e%i===a)).filter(t=>!t[2]).length;let n=new Array(e.length),o=t-1,h=0,l=(e.forEach((t,e)=>{n[e]=[o,h],t[2]?h++:o--}),s.t=0,await anime({targets:s,t:1,duration:this.animationTime,easing:"easeInOutQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{this.drawBoundaryRect(r,(1-s.t)*t[0]+s.t*n[e][0],(1-s.t)*t[1]+s.t*n[e][1],t[2],t[3]+" 1)")})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{this.drawBoundaryRect(r,n[e][0],n[e][1],t[2],t[3]+" 1)")}),[]),u=(n.forEach((i,t)=>{if(!e[t][2])for(let e=i[1];e<r.footprint;e++)if(r.numbers[i[0]][e]===1/0)for(let t=0;t<this.infiniteHeight;t++)l.push([i[0],e,t])}),this.deleteCubes(r,l,!0),[]);for(let t=r.footprint-1;t>n[0][0];t--)u.push([t,0,!1]);for(let t=n[n.length-1][1];t<r.footprint;t++)u.push([-1,t,!0]);s.t=0,await anime({targets:s,t:1,duration:this.animationTime/2,easing:"easeInQuad",update:()=>{this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{this.drawBoundaryRect(r,n[e][0],n[e][1],t[2],t[3]+" 1)")}),u.forEach(t=>{this.drawBoundaryRect(r,t[0],t[1],t[2],`${e[0][3]} ${s.t})`)})}}).finished,this.wilsonNumbers.ctx.clearRect(0,0,this.wilsonNumbers.canvasWidth,this.wilsonNumbers.canvasHeight),e.forEach((t,e)=>{this.drawBoundaryRect(r,n[e][0],n[e][1],t[2],t[3]+" 1)")}),u.forEach(t=>{this.drawBoundaryRect(r,t[0],t[1],t[2],e[0][3]+" 1)")}),this.wilsonNumbers.ctx.fillStyle="rgb(255, 255, 255)"}drawBoundaryRect(t,e,i,a,r){var s=(this.totalArrayFootprint-t.footprint-1)/2,t=t.partialFootprintSum-t.footprint;this.wilsonNumbers.ctx.fillStyle=r,a?this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+t+1)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+s+1+.9375)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(1/16)/(this.totalArrayFootprint+1)):this.wilsonNumbers.ctx.fillRect(this.wilsonNumbers.canvasWidth*(i+t+.9375)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight*(e+s+1)/(this.totalArrayFootprint+1)+1,this.wilsonNumbers.canvasWidth*(1/16)/(this.totalArrayFootprint+1),this.wilsonNumbers.canvasHeight/(this.totalArrayFootprint+1))}}export{PlanePartitions};