import anime from"/scripts/anime.min.js";import{changeOpacity}from"/scripts/src/animation.min.js";import*as THREE from"/scripts/three.js";async function addNewArray(index,numbers,keepNumbersCanvasVisible=!1,horizontalLegs=!0){if(!this.currentlyAnimating){var r={numbers:numbers,cubes:[],floor:[],leftWall:[],rightWall:[],cubeGroup:null,centerOffset:0,partialFootprintSum:0,footprint:0,height:0,size:0};this.in2dView&&!keepNumbersCanvasVisible&&await changeOpacity({element:this.wilsonNumbers.canvas,opacity:0,duration:this.animationTime/5}),this.arrays.splice(index,0,r),r.footprint=r.numbers.length;for(let t=index;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,t!==index&&(this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.addWalls?0:this.arrays[t].centerOffset,y:0,z:this.addWalls?0:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"}));r.cubeGroup=new THREE.Object3D,this.scene.add(r.cubeGroup),this.addWalls?r.cubeGroup.position.set(0,0,0):this.in2dView?r.cubeGroup.position.set(r.centerOffset,0,0):r.cubeGroup.position.set(r.centerOffset,0,-r.centerOffset),r.cubeGroup.rotation.y=this.rotationY,r.cubes=new Array(r.footprint),r.floor=new Array(r.footprint);for(let e=0;e<r.footprint;e++){r.cubes[e]=new Array(r.footprint),r.floor[e]=new Array(r.footprint);for(let a=0;a<r.footprint;a++)if(r.numbers[e][a]!==1/0)if(r.cubes[e][a]=new Array(r.numbers[e][a]),r.numbers[e][a]>r.height&&(r.height=r.numbers[e][a]),r.floor[e][a]=this.addFloor(r,a,e),horizontalLegs){var s=Math.max(r.numbers[e][r.footprint-1],r.numbers[r.footprint-1][a]);for(let t=0;t<s;t++)r.cubes[e][a][t]=this.addCube(r,a,t,e,0,0,this.asymptoteLightness);for(let i=s;i<r.numbers[e][a];i++)r.cubes[e][a][i]=this.addCube(r,a,i,e)}else for(let t=0;t<r.numbers[e][a];t++)r.cubes[e][a][t]=this.addCube(r,a,t,e);else{r.cubes[e][a]=new Array(this.infiniteHeight),r.floor[e][a]=this.addFloor(r,a,e);for(let t=0;t<this.infiniteHeight;t++)r.cubes[e][a][t]=this.addCube(r,a,t,e,0,0,this.asymptoteLightness)}}if(this.addWalls){r.leftWall=new Array(this.wallWidth),r.rightWall=new Array(this.wallWidth);for(let t=0;t<this.wallWidth;t++)r.leftWall[t]=new Array(this.wallHeight),r.rightWall[t]=new Array(this.wallHeight);for(let i=0;i<this.wallWidth;i++)for(let t=0;t<this.wallHeight;t++)r.leftWall[i][t]=this.addLeftWall(r,t,i),r.rightWall[i][t]=this.addRightWall(r,i,t)}r.size=Math.max(r.footprint,r.height),this.totalArrayFootprint+=r.footprint+1,this.totalArrayHeight=Math.max(this.totalArrayHeight,r.height),this.totalArraySize=Math.max(this.totalArrayFootprint,this.totalArrayHeight),1!==this.arrays.length||keepNumbersCanvasVisible?this.addWalls||keepNumbersCanvasVisible||this.updateCameraHeight(!0):(this.hexViewCameraPos=[this.totalArraySize,this.totalArraySize+this.totalArrayHeight/3,this.totalArraySize],this._2dViewCameraPos=[0,this.totalArraySize+10,0],!this.in2dView||keepNumbersCanvasVisible||this.addWalls?(this.orthographicCamera.left=-this.totalArraySize,this.orthographicCamera.right=this.totalArraySize,this.orthographicCamera.top=this.totalArraySize,this.orthographicCamera.bottom=-this.totalArraySize,this.orthographicCamera.position.set(this.hexViewCameraPos[0],this.hexViewCameraPos[1],this.hexViewCameraPos[2]),this.orthographicCamera.rotation.set(-.785398163,.615479709,.523598775),this.orthographicCamera.updateProjectionMatrix()):this.updateCameraHeight(!0)),index!==this.arrays.length-1&&await new Promise(resolve=>setTimeout(resolve,this.animationTime));const i=[];return r.cubeGroup.traverse(node=>{node.material&&node.material.forEach(material=>i.push(material))}),await anime({targets:i,opacity:1,duration:this.animationTime/2,easing:"easeOutQuad"}).finished,this.in2dView&&!keepNumbersCanvasVisible&&this.drawAll2dViewText(),r}}async function editArray(index,numbers){this.currentlyAnimating||(index>=this.arrays.length||index<0?this.displayError("No array at index "+index):(await this.removeArray(index),await this.addNewArray(index,numbers),this.in2dView||this.updateCameraHeight()))}async function trimArray(index){if(!this.currentlyAnimating)if(index>=this.arrays.length||index<0)this.displayError("No array at index "+index);else{var r=this.arrays[index].numbers;let i=0;for(let a=0;a<r.length;a++)for(let t=0;t<r.length;t++)0!==r[a][t]&&(i=Math.max(i,Math.max(a+1,t+1)));var s=new Array(i);for(let e=0;e<i;e++){s[e]=new Array(i);for(let t=0;t<i;t++)s[e][t]=r[e][t]}await this.removeArray(index),await this.addNewArray(index,s),this.in2dView||this.updateCameraHeight()}}async function removeArray(index,keepNumbersCanvasVisible=!1){if(!this.currentlyAnimating)if(index>=this.arrays.length||index<0)this.displayError("No array at index "+index);else{this.in2dView&&!keepNumbersCanvasVisible&&await changeOpacity({element:this.wilsonNumbers.canvas,opacity:0,duration:this.animationTime/5});const i=[];this.arrays[index].cubeGroup.traverse(node=>{node.material&&node.material.forEach(material=>i.push(material))}),await anime({targets:i,opacity:0,duration:this.animationTime/2,easing:"easeOutQuad"}).finished;for(let a=0;a<this.arrays[index].cubes.length;a++)for(let i=0;i<this.arrays[index].cubes[a].length;i++)if(this.arrays[index].cubes[a][i])for(let t=0;t<this.arrays[index].cubes[a][i].length;t++)this.arrays[index].cubes[a][i][t]&&this.arrays[index].cubes[a][i][t].material.forEach(material=>material.dispose());this.scene.remove(this.arrays[index].cubeGroup),this.totalArrayFootprint-=this.arrays[index].footprint+1,this.arrays.splice(index,1);for(let t=index;t<this.arrays.length;t++)this.arrays[t].partialFootprintSum=this.arrays[t].footprint,0!==t?(this.arrays[t].centerOffset=this.arrays[t-1].centerOffset+this.arrays[t-1].footprint/2+this.arrays[t].footprint/2+1,this.arrays[t].partialFootprintSum+=this.arrays[t-1].partialFootprintSum+1):this.arrays[t].centerOffset=0,this.in2dView?anime({targets:this.arrays[t].cubeGroup.position,x:this.arrays[t].centerOffset,y:0,z:0,duration:this.animationTime,easing:"easeInOutQuad"}):anime({targets:this.arrays[t].cubeGroup.position,x:this.addWalls?0:this.arrays[t].centerOffset,y:0,z:this.addWalls?0:-this.arrays[t].centerOffset,duration:this.animationTime,easing:"easeInOutQuad"});0===this.arrays.length||keepNumbersCanvasVisible||this.updateCameraHeight(!0)}}export{addNewArray,editArray,trimArray,removeArray};