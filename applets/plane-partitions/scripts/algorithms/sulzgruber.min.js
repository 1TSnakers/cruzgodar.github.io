import{sleep}from"/scripts/src/utils.min.js";async function sulzgruber(index){var n=this.arrays[index],s=structuredClone(n.numbers),a=new Array(s.length);for(let i=0;i<s.length;i++){let e=0;for(;e<s.length&&s[e][i]===1/0;)e++;a[i]=e}var h=new Array(s.length);for(let C=0;C<s.length;C++){let e=0;for(;e<s.length&&s[C][e]===1/0;)e++;h[C]=e}var r,l,o={},g={};for(let e=0;e<s.length;e++)g[-e]=[e,0];for(let p=1;p<s.length;p++)g[p]=[0,p];for(let y=1-s.length;y<s.length;y++){let e=g[y][0],t=g[y][1];for(;e<s.length&&t<s.length&&s[e][t]===1/0;)e++,t++;g[y]=[e,t],e===s.length||t===s.length?o[y]=-1:(r=0===t||s[e][t-1]===1/0,l=0===e||s[e-1][t]===1/0,o[y]=r&&l?0:r?3:l?2:1)}var f=[];for(let x=1-s.length;x<s.length;x++)if(1!==o[x]&&3!==o[x]){let l=g[x][0],i=g[x][1];if(0!==s[l][i])for(;;){let e=!1;for(;l<s.length&&i<s.length&&0!==s[l][i];){if((i<s.length-1&&s[l][i]>s[l][i+1]||i===s.length-1&&0<s[l][i])&&(0===o[x]||2===o[x]&&(l<s.length-1&&s[l][i]>s[l+1][i]||l===s.length-1&&0<s[l][i]))){e=!0;break}l++,i++}if(!e)break;let t=l,r=i;for(var u=[[t,r,s[t][r]-1]];;){var w=r-t;if(t<s.length-1&&s[t][r]===s[t+1][r]&&(0===o[w]||3===o[w]))t++;else{if(!(r>h[t]&&(t===s.length-1||t<s.length-1&&s[t][r]>s[t+1][r])))break;r--}u.push([t,r,s[t][r]-1])}for(const A of u)s[A[0]][A[1]]--;f.push(u)}}var t=new Array(s.length);for(let T=0;T<s.length;T++){t[T]=new Array(s.length);for(let e=0;e<s.length;e++)t[T][e]=s[T][e]===1/0?1/0:0}var b=await this.addNewArray({index:index+1,numbers:t});await sleep(this.animationTime);for(let V=0;V<f.length;V++){var c=V/f.length*6/7;await this.colorCubes(n,f[V],c),await this.raiseCubes(n,f[V],n.height+1);for(const z of f[V])n.numbers[z[0]][z[1]]--,this.in2dView&&this.drawSingleCell2dViewText(n,z[0],z[1]);this.recalculateHeights(n),await sleep(this.animationTime/5);var d=f[V][f[V].length-1][0],m=g[f[V][f[V].length-1][1]-d+f[V].length-1][1];let e=[];var v=Math.max(n.height+1,b.height+1);for(let t=a[m];t<=d;t++)e.push([t,m,v]);for(let r=m-1;r>=h[d];r--)e.push([d,r,v]);await this.moveCubes(n,f[V],b,e),e=[];for(let l=d-1;l>=a[m];l--)e.push([l,m,v]);this.deleteCubes(b,e),e=[];for(let i=m-1;i>=h[d];i--)e.push([d,i,v]);this.deleteCubes(b,e),await this.lowerCubes(b,[[d,m,v]]),b.numbers[d][m]++,this.in2dView&&this.drawSingleCell2dViewText(b,d,m),this.recalculateHeights(b),await sleep(this.animationTime)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}async function sulzgruberInverse(index){var f=this.arrays[index],u=f.numbers,w=new Array(u.length);for(let r=0;r<u.length;r++){let e=0;for(;e<u.length&&u[e][r]===1/0;)e++;w[r]=e}var b=new Array(u.length);for(let l=0;l<u.length;l++){let e=0;for(;e<u.length&&u[l][e]===1/0;)e++;b[l]=e}var c={};for(let e=0;e<u.length;e++)c[-e]=[e,0];for(let i=1;i<u.length;i++)c[i]=[0,i];for(let n=1-u.length;n<u.length;n++){let e=c[n][0],t=c[n][1];for(;e<u.length&&t<u.length&&u[e][t]===1/0;)e++,t++;c[n]=[e,t]}let d=0;var t=new Array(u.length);for(let s=0;s<u.length;s++){t[s]=new Array(u.length);for(let e=0;e<u.length;e++)u[s][e]===1/0?t[s][e]=1/0:(t[s][e]=0,d+=u[s][e])}var m=await this.addNewArray({index:index+1,numbers:t});let v=0;for(let k=u.length-1;0<=k;k--)for(let g=u.length-1;0<=g;g--)if(u[g][k]!==1/0)for(;0!==u[g][k];){var C=v/d*6/7,p=Math.max(f.size+1,m.size+1),y=(await this.colorCubes(f,[[g,k,u[g][k]-1]],C),await this.raiseCubes(f,[[g,k,u[g][k]-1]],p),g),x=k;for(let e=w[x];e<y;e++){f.cubes[e][x][p]=this.addCube(f,x,p,e);for(const L of f.cubes[e][x][p].material)L.color.setHSL(C,1,this.cubeLightness)}for(let t=b[y];t<x;t++){f.cubes[y][t][p]=this.addCube(f,t,p,y);for(const I of f.cubes[y][t][p].material)I.color.setHSL(C,1,this.cubeLightness)}let l=[];for(let r=y-1;r>=w[x];r--)l.push([r,x,p]);var A=this.revealCubes(f,l);l=[];for(let s=x-1;s>=b[y];s--)l.push([y,s,p]);var T=this.revealCubes(f,l);await Promise.all([A,T]),l=[];for(let a=b[y];a<x;a++)l.push([y,a,p]);l.push([y,x,f.numbers[y][x]-1]);for(let h=y-1;h>=w[x];h--)l.push([h,x,p]);var A=b[y]-y,V=A+l.length-1,z=[];for(let o=A;o<=V;o++)z.push(structuredClone(c[o]));u[y][x]--,this.recalculateHeights(f),this.in2dView&&this.drawSingleCell2dViewText(f,y,x),await this.moveCubes(f,l,m,z);let i=0,n=m.numbers[z[0][0]][z[0][1]];for(;;){let e=i;for(;e<z.length&&z[e][0]===z[i][0];)e++;l=z.slice(i,e);let t=!0;for(let r=0;r<l.length;r++)if(m.numbers[l[r][0]][l[r][1]]!==n){t=!1;break}if(t){await this.lowerCubes(m,l);for(const M of l)m.numbers[M[0]][M[1]]++;if(this.recalculateHeights(m),this.in2dView)for(const N of l)this.drawSingleCell2dViewText(m,N[0],N[1]);i=e}else{var H=structuredClone(z.slice(i));for(let e=i;e<z.length;e++)if(z[e][0]++,z[e][1]++,z[e][0]>m.footprint||z[e][1]>m.footprint)return void console.error("Insertion failed!");var S=z.slice(i);await this.moveCubes(m,H,m,S),n=m.numbers[z[i][0]][z[i][1]]}if(i===z.length)break}v++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{sulzgruber,sulzgruberInverse};