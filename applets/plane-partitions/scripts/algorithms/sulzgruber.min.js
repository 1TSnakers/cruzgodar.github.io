async function sulzgruber(index){const a=this.arrays[index],n=structuredClone(a.numbers);var h=new Array(n.length);for(let i=0;i<n.length;i++){let e=0;for(;e<n.length&&n[e][i]===1/0;)e++;h[i]=e}var s=new Array(n.length);for(let C=0;C<n.length;C++){let e=0;for(;e<n.length&&n[C][e]===1/0;)e++;s[C]=e}var r,l,o={},g={};for(let e=0;e<n.length;e++)g[-e]=[e,0];for(let x=1;x<n.length;x++)g[x]=[0,x];for(let y=1-n.length;y<n.length;y++){let e=g[y][0],t=g[y][1];for(;e<n.length&&t<n.length&&n[e][t]===1/0;)e++,t++;g[y]=[e,t],e===n.length||t===n.length?o[y]=-1:(r=0===t||n[e][t-1]===1/0,l=0===e||n[e-1][t]===1/0,o[y]=r&&l?0:r?3:l?2:1)}var f=[];for(let p=1-n.length;p<n.length;p++)if(1!==o[p]&&3!==o[p]){let l=g[p][0],i=g[p][1];if(0!==n[l][i])for(;;){let e=!1;for(;l<n.length&&i<n.length&&0!==n[l][i];){if((i<n.length-1&&n[l][i]>n[l][i+1]||i===n.length-1&&0<n[l][i])&&(0===o[p]||2===o[p]&&(l<n.length-1&&n[l][i]>n[l+1][i]||l===n.length-1&&0<n[l][i]))){e=!0;break}l++,i++}if(!e)break;let t=l,r=i;for(var u=[[t,r,n[t][r]-1]];;){var b=r-t;if(t<n.length-1&&n[t][r]===n[t+1][r]&&(0===o[b]||3===o[b]))t++;else{if(!(r>s[t]&&(t===n.length-1||t<n.length-1&&n[t][r]>n[t+1][r])))break;r--}u.push([t,r,n[t][r]-1])}u.forEach(box=>n[box[0]][box[1]]--),f.push(u)}}var t=new Array(n.length);for(let A=0;A<n.length;A++){t[A]=new Array(n.length);for(let e=0;e<n.length;e++)t[A][e]=n[A][e]===1/0?1/0:0}var c=await this.addNewArray(index+1,t);await sleep(this.animationTime);for(let T=0;T<f.length;T++){var w=T/f.length*6/7,d=(await this.colorCubes(a,f[T],w),await this.raiseCubes(a,f[T],a.height+1),f[T].forEach(box=>{a.numbers[box[0]][box[1]]--,this.in2dView&&this.drawSingleCell2dViewText(a,box[0],box[1])}),this.recalculateHeights(a),await sleep(this.animationTime/5),f[T][f[T].length-1][0]),m=g[f[T][f[T].length-1][1]-d+f[T].length-1][1];let e=[];var v=Math.max(a.height+1,c.height+1);for(let t=h[m];t<=d;t++)e.push([t,m,v]);for(let r=m-1;r>=s[d];r--)e.push([d,r,v]);await this.moveCubes(a,f[T],c,e),e=[];for(let l=d-1;l>=h[m];l--)e.push([l,m,v]);this.deleteCubes(c,e),e=[];for(let i=m-1;i>=s[d];i--)e.push([d,i,v]);this.deleteCubes(c,e),await this.lowerCubes(c,[[d,m,v]]),c.numbers[d][m]++,this.in2dView&&this.drawSingleCell2dViewText(c,d,m),this.recalculateHeights(c),await sleep(this.animationTime)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}async function sulzgruberInverse(index){var f=this.arrays[index],u=f.numbers,b=new Array(u.length);for(let r=0;r<u.length;r++){let e=0;for(;e<u.length&&u[e][r]===1/0;)e++;b[r]=e}var c=new Array(u.length);for(let l=0;l<u.length;l++){let e=0;for(;e<u.length&&u[l][e]===1/0;)e++;c[l]=e}var w={};for(let e=0;e<u.length;e++)w[-e]=[e,0];for(let i=1;i<u.length;i++)w[i]=[0,i];for(let a=1-u.length;a<u.length;a++){let e=w[a][0],t=w[a][1];for(;e<u.length&&t<u.length&&u[e][t]===1/0;)e++,t++;w[a]=[e,t]}let d=0;var t=new Array(u.length);for(let n=0;n<u.length;n++){t[n]=new Array(u.length);for(let e=0;e<u.length;e++)u[n][e]===1/0?t[n][e]=1/0:(t[n][e]=0,d+=u[n][e])}const m=await this.addNewArray(index+1,t);let v=0;for(let H=u.length-1;0<=H;H--)for(let g=u.length-1;0<=g;g--)if(u[g][H]!==1/0)for(;0!==u[g][H];){const S=v/d*6/7;var C=Math.max(f.size+1,m.size+1),x=(await this.colorCubes(f,[[g,H,u[g][H]-1]],S),await this.raiseCubes(f,[[g,H,u[g][H]-1]],C),g),y=H;for(let e=b[y];e<x;e++)f.cubes[e][y][C]=this.addCube(f,y,C,e),f.cubes[e][y][C].material.forEach(material=>material.color.setHSL(S,1,this.cubeLightness));for(let t=c[x];t<y;t++)f.cubes[x][t][C]=this.addCube(f,t,C,x),f.cubes[x][t][C].material.forEach(material=>material.color.setHSL(S,1,this.cubeLightness));let l=[];for(let r=x-1;r>=b[y];r--)l.push([r,y,C]);var p=this.revealCubes(f,l);l=[];for(let n=y-1;n>=c[x];n--)l.push([x,n,C]);var A=this.revealCubes(f,l);await Promise.all([p,A]),l=[];for(let h=c[x];h<y;h++)l.push([x,h,C]);l.push([x,y,f.numbers[x][y]-1]);for(let s=x-1;s>=b[y];s--)l.push([s,y,C]);var p=c[x]-x,T=p+l.length-1,V=[];for(let o=p;o<=T;o++)V.push(structuredClone(w[o]));u[x][y]--,this.recalculateHeights(f),this.in2dView&&this.drawSingleCell2dViewText(f,x,y),await this.moveCubes(f,l,m,V);let i=0,a=m.numbers[V[0][0]][V[0][1]];for(;;){let e=i;for(;e<V.length&&V[e][0]===V[i][0];)e++;l=V.slice(i,e);let t=!0;for(let r=0;r<l.length;r++)if(m.numbers[l[r][0]][l[r][1]]!==a){t=!1;break}if(t)await this.lowerCubes(m,l),l.forEach(coordinate=>{m.numbers[coordinate[0]][coordinate[1]]++}),this.recalculateHeights(m),this.in2dView&&l.forEach(entry=>{this.drawSingleCell2dViewText(m,entry[0],entry[1])}),i=e;else{var z=structuredClone(V.slice(i));for(let e=i;e<V.length;e++)if(V[e][0]++,V[e][1]++,V[e][0]>m.footprint||V[e][1]>m.footprint)return void console.error("Insertion failed!");var E=V.slice(i);await this.moveCubes(m,z,m,E),a=m.numbers[V[i][0]][V[i][1]]}if(i===V.length)break}v++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{sulzgruber,sulzgruberInverse};