async function sulzgruber(index){const a=this.arrays[index],s=structuredClone(a.numbers);var n=new Array(s.length);for(let i=0;i<s.length;i++){let e=0;for(;e<s.length&&s[e][i]===1/0;)e++;n[i]=e}var h=new Array(s.length);for(let x=0;x<s.length;x++){let e=0;for(;e<s.length&&s[x][e]===1/0;)e++;h[x]=e}var r,l,o={},g={};for(let e=0;e<s.length;e++)g[-e]=[e,0];for(let C=1;C<s.length;C++)g[C]=[0,C];for(let y=1-s.length;y<s.length;y++){let e=g[y][0],t=g[y][1];for(;e<s.length&&t<s.length&&s[e][t]===1/0;)e++,t++;g[y]=[e,t],e===s.length||t===s.length?o[y]=-1:(r=0===t||s[e][t-1]===1/0,l=0===e||s[e-1][t]===1/0,o[y]=r&&l?0:r?3:l?2:1)}var u=[];for(let p=1-s.length;p<s.length;p++)if(1!==o[p]&&3!==o[p]){let l=g[p][0],i=g[p][1];if(0!==s[l][i])for(;;){let e=!1;for(;l<s.length&&i<s.length&&0!==s[l][i];){if((i<s.length-1&&s[l][i]>s[l][i+1]||i===s.length-1&&0<s[l][i])&&(0===o[p]||2===o[p]&&(l<s.length-1&&s[l][i]>s[l+1][i]||l===s.length-1&&0<s[l][i]))){e=!0;break}l++,i++}if(!e)break;let t=l,r=i;for(var f=[[t,r,s[t][r]-1]];;){var b=r-t;if(t<s.length-1&&s[t][r]===s[t+1][r]&&(0===o[b]||3===o[b]))t++;else{if(!(r>h[t]&&(t===s.length-1||t<s.length-1&&s[t][r]>s[t+1][r])))break;r--}f.push([t,r,s[t][r]-1])}f.forEach(box=>s[box[0]][box[1]]--),u.push(f)}}var t=new Array(s.length);for(let A=0;A<s.length;A++){t[A]=new Array(s.length);for(let e=0;e<s.length;e++)t[A][e]=s[A][e]===1/0?1/0:0}var w=await this.addNewArray(index+1,t);await new Promise(resolve=>setTimeout(resolve,this.animationTime));for(let T=0;T<u.length;T++){var c=T/u.length*6/7,m=(await this.colorCubes(a,u[T],c),await this.raiseCubes(a,u[T],a.height+1),u[T].forEach(box=>{a.numbers[box[0]][box[1]]--,this.in2dView&&this.drawSingleCell2dViewText(a,box[0],box[1])}),this.recalculateHeights(a),await new Promise(resolve=>setTimeout(resolve,this.animationTime/5)),u[T][u[T].length-1][0]),d=g[u[T][u[T].length-1][1]-m+u[T].length-1][1];let e=[];var v=Math.max(a.height+1,w.height+1);for(let t=n[d];t<=m;t++)e.push([t,d,v]);for(let r=d-1;r>=h[m];r--)e.push([m,r,v]);await this.moveCubes(a,u[T],w,e),e=[];for(let l=m-1;l>=n[d];l--)e.push([l,d,v]);this.deleteCubes(w,e),e=[];for(let i=d-1;i>=h[m];i--)e.push([m,i,v]);this.deleteCubes(w,e),await this.lowerCubes(w,[[m,d,v]]),w.numbers[m][d]++,this.in2dView&&this.drawSingleCell2dViewText(w,m,d),this.recalculateHeights(w),await new Promise(resolve=>setTimeout(resolve,this.animationTime))}await this.removeArray(index)}async function sulzgruberInverse(index){var u=this.arrays[index],f=u.numbers,b=new Array(f.length);for(let r=0;r<f.length;r++){let e=0;for(;e<f.length&&f[e][r]===1/0;)e++;b[r]=e}var w=new Array(f.length);for(let l=0;l<f.length;l++){let e=0;for(;e<f.length&&f[l][e]===1/0;)e++;w[l]=e}var c={};for(let e=0;e<f.length;e++)c[-e]=[e,0];for(let i=1;i<f.length;i++)c[i]=[0,i];for(let a=1-f.length;a<f.length;a++){let e=c[a][0],t=c[a][1];for(;e<f.length&&t<f.length&&f[e][t]===1/0;)e++,t++;c[a]=[e,t]}let m=0;var t=new Array(f.length);for(let s=0;s<f.length;s++){t[s]=new Array(f.length);for(let e=0;e<f.length;e++)f[s][e]===1/0?t[s][e]=1/0:(t[s][e]=0,m+=f[s][e])}const d=await this.addNewArray(index+1,t);let v=0;for(let H=f.length-1;0<=H;H--)for(let g=f.length-1;0<=g;g--)if(f[g][H]!==1/0)for(;0!==f[g][H];){const S=v/m*6/7;var x=Math.max(u.size+1,d.size+1),C=(await this.colorCubes(u,[[g,H,f[g][H]-1]],S),await this.raiseCubes(u,[[g,H,f[g][H]-1]],x),g),y=H;for(let e=b[y];e<C;e++)u.cubes[e][y][x]=this.addCube(u,y,x,e),u.cubes[e][y][x].material.forEach(material=>material.color.setHSL(S,1,this.cubeLightness));for(let t=w[C];t<y;t++)u.cubes[C][t][x]=this.addCube(u,t,x,C),u.cubes[C][t][x].material.forEach(material=>material.color.setHSL(S,1,this.cubeLightness));let l=[];for(let r=C-1;r>=b[y];r--)l.push([r,y,x]);var p=this.revealCubes(u,l);l=[];for(let s=y-1;s>=w[C];s--)l.push([C,s,x]);var A=this.revealCubes(u,l);await Promise.all([p,A]),l=[];for(let n=w[C];n<y;n++)l.push([C,n,x]);l.push([C,y,u.numbers[C][y]-1]);for(let h=C-1;h>=b[y];h--)l.push([h,y,x]);var p=w[C]-C,T=p+l.length-1,V=[];for(let o=p;o<=T;o++)V.push(structuredClone(c[o]));f[C][y]--,this.recalculateHeights(u),this.in2dView&&this.drawSingleCell2dViewText(u,C,y),await this.moveCubes(u,l,d,V);let i=0,a=d.numbers[V[0][0]][V[0][1]];for(;;){let e=i;for(;e<V.length&&V[e][0]===V[i][0];)e++;l=V.slice(i,e);let t=!0;for(let r=0;r<l.length;r++)if(d.numbers[l[r][0]][l[r][1]]!==a){t=!1;break}if(t)await this.lowerCubes(d,l),l.forEach(coordinate=>{d.numbers[coordinate[0]][coordinate[1]]++}),this.recalculateHeights(d),this.in2dView&&l.forEach(entry=>{this.drawSingleCell2dViewText(d,entry[0],entry[1])}),i=e;else{var z=structuredClone(V.slice(i));for(let e=i;e<V.length;e++)if(V[e][0]++,V[e][1]++,V[e][0]>d.footprint||V[e][1]>d.footprint)return void console.error("Insertion failed!");var E=V.slice(i);await this.moveCubes(d,z,d,E),a=d.numbers[V[i][0]][V[i][1]]}if(i===V.length)break}v++,await new Promise(resolve=>setTimeout(resolve,this.animationTime/2))}await this.removeArray(index)}export{sulzgruber,sulzgruberInverse};