import{sleep}from"/scripts/src/utils.min.js";async function pak(index,ignoreLegs=!0){var a=this.arrays[index],n=a.numbers;this.in2dView||await this.show2dView();let e=0,i=0;for(;e<a.footprint&&0!==a.numbers[e][a.footprint-1];)e++;for(;i<a.footprint&&0!==a.numbers[a.footprint-1][i];)i++;ignoreLegs&&(e=0,i=0);let h=0;for(let s=a.footprint-1-i;0<=s;s--)for(let t=a.footprint-1-e;0<=t;t--)n[s][t]!==1/0&&h++;let l=0;for(let c=0;c<a.footprint-i;c++)for(let r=0;r<a.footprint-e;r++)if(n[c][r]!==1/0){var f=[];let e=0;for(;c+e<a.footprint&&r+e<a.footprint;)f.push([c+e,r+e,n[c+e][r+e]-1]),e++;e=f[0][0];let i=f[0][1],t=[];for(let s=n[e][i]-2;0<=s;s--)t.push([e,i,s]);this.colorCubes(a,t,l/h*6/7),t=[];for(const m of f)0<=m[2]&&t.push(m);await this.colorCubes(a,t,l/h*6/7);var u=new Array(f.length);for(const[index,v]of f.entries()){var p=v[0],d=v[1];let t=0,e=0;p<a.footprint-1&&(t=n[p+1][d]),d<a.footprint-1&&(e=n[p][d+1]),u[index]=Math.max(t,e),0<index?(t=n[p-1][d],e=n[p][d-1],u[index]+=Math.min(t,e)-n[p][d]):u[index]=n[p][d]-u[index]}for(let o=0;o<f.length;o++){if(e=f[o][0],i=f[o][1],u[o]>n[e][i]){var w=[];for(let t=n[e][i];t<u[o];t++)a.cubes[e][i][t]=this.addCube(a,i,t,e),w.push([e,i,t]);this.in2dView?this.revealCubes(a,w):await this.revealCubes(a,w)}else if(u[o]<n[e][i]){var b=[];for(let t=n[e][i]-1;t>=u[o];t--)b.push([e,i,t]);this.in2dView?this.deleteCubes(a,b):await this.deleteCubes(a,b)}n[e][i]=u[o],this.in2dView&&this.drawSingleCell2dViewText(a,e,i)}var g=[];for(const[index,C]of t.entries())0!==index&&C[2]<n[C[0]][C[1]]&&g.push(C);this.in2dView?this.uncolorCubes(a,g):await this.uncolorCubes(a,g),l++,this.recalculateHeights(a),0!==t.length&&await sleep(this.animationTime)}this.updateCameraHeight(!0)}async function pakInverse(index,rightLegSize=0,bottomLegSize=0){var r=this.arrays[index],a=r.numbers;this.in2dView||await this.show2dView();let n=0;for(let e=r.footprint-1-bottomLegSize;0<=e;e--)for(let t=r.footprint-1-rightLegSize;0<=t;t--)a[e][t]!==1/0&&n++;let h=0;for(let g=r.footprint-1-bottomLegSize;0<=g;g--)for(let t=r.footprint-1-rightLegSize;0<=t;t--)if(a[g][t]!==1/0){var l=[];let e=0;for(;g+e<r.footprint&&t+e<r.footprint;)l.push([g+e,t+e,a[g+e][t+e]-1]),e++;e=l[0][0];let i=l[0][1];var f=new Array(l.length);let s=!1;for(const[index,c]of l.entries()){var u=c[0],p=c[1];let t=0,e=0;u<r.footprint-1&&(t=a[u+1][p]),p<r.footprint-1&&(e=a[u][p+1]),f[index]=Math.max(t,e),0<index?(t=a[u-1][p],e=a[u][p-1],f[index]+=Math.min(t,e)-a[u][p]):f[index]+=a[u][p],s||f[index]===a[u][p]||(s=!0)}if(0!==a[e][i]){var d=[];for(let t=a[e][i]-1;0<=t;t--)d.push([e,i,t]);this.colorCubes(r,d,h/n*6/7)}else if(0!==f[0])r.cubes[e][i][0]=this.addCube(r,i,0,e,h/n*6/7,1,this.cubeLightness),a[e][i]=1,this.revealCubes(r,[[e,i,0]]);else if(!s){h++;continue}await sleep(this.animationTime);for(let o=0;o<l.length;o++){if(e=l[o][0],i=l[o][1],f[o]>a[e][i]){var w=[];for(let t=a[e][i];t<f[o];t++)r.cubes[e][i][t]=this.addCube(r,i,t,e,h/n*6/7,1,this.cubeLightness),w.push([e,i,t]);this.in2dView?this.revealCubes(r,w):await this.revealCubes(r,w)}else if(f[o]<a[e][i]){var b=[];for(let t=a[e][i]-1;t>=f[o];t--)b.push([e,i,t]);this.in2dView?this.deleteCubes(r,b):await this.deleteCubes(r,b)}a[e][i]=f[o],this.in2dView&&this.drawSingleCell2dViewText(r,e,i)}h++,this.recalculateHeights(r),await sleep(this.animationTime)}this.updateCameraHeight(!0)}export{pak,pakInverse};