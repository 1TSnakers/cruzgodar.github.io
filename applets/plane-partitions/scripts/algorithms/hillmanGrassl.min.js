import{sleep}from"/scripts/src/utils.min.js";async function hillmanGrassl(index){var s=this.arrays[index],a=structuredClone(s.numbers),h=new Array(a.length);for(let r=0;r<a.length;r++){let e=0;for(;e<a.length&&a[e][r]===1/0;)e++;h[r]=e}var n=new Array(a.length);for(let i=0;i<a.length;i++){let e=0;for(;e<a.length&&a[i][e]===1/0;)e++;n[i]=e}for(var o=[];;){let e=a[0].length-1;for(;0<=e&&h[e]<a.length&&0===a[h[e]][e];)e--;if(e<0||h[e]===a.length)break;let t=h[e],r=e;for(var l=[[t,r,a[t][r]-1]];;){if(t<a.length-1&&a[t+1][r]===a[t][r])t++;else{if(!(0<r&&a[t][r-1]!==1/0))break;r--}l.push([t,r,a[t][r]-1])}for(let i=0;i<l.length;i++)a[l[i][0]][l[i][1]]--;o.push(l)}var t=new Array(a.length);for(let w=0;w<a.length;w++){t[w]=new Array(a.length);for(let e=0;e<a.length;e++)t[w][e]=a[w][e]===1/0?1/0:0}var u=await this.addNewArray({index:index+1,numbers:t});await sleep(this.animationTime);for(let c=0;c<o.length;c++){var g=c/o.length*6/7;await this.colorCubes(s,o[c],g),await this.raiseCubes(s,o[c],s.height);for(let t=0;t<o[c].length;t++)s.numbers[o[c][t][0]][o[c][t][1]]--,this.in2dView&&this.drawSingleCell2dViewText(s,o[c][t][0],o[c][t][1]);this.recalculateHeights(s),await sleep(this.animationTime/5);var f=[o[c][o[c].length-1][0],o[c][0][1]];let e=[];var m=u.height+1;for(let r=h[f[1]];r<=f[0];r++)e.push([r,f[1],m]);g=e[e.length-1];for(let i=f[1]-1;i>=n[f[0]];i--)e.push([f[0],i,m]);await this.moveCubes(s,o[c],u,e),e=[];for(let a=f[0]-1;a>=h[f[1]];a--)e.push([a,f[1],m]);this.deleteCubes(u,e),e=[];for(let l=f[1]-1;l>=n[f[0]];l--)e.push([f[0],l,m]);this.deleteCubes(u,e),await this.lowerCubes(u,[g]),u.numbers[g[0]][g[1]]++,this.recalculateHeights(u),this.in2dView&&this.drawSingleCell2dViewText(u,g[0],g[1]),u.height=Math.max(u.height,u.numbers[g[0]][g[1]]),u.size=Math.max(u.size,u.height),await sleep(this.animationTime)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}async function hillmanGrasslInverse(index){var h=this.arrays[index],a=structuredClone(h.numbers),n=[],o=new Array(a.length);for(let r=0;r<a.length;r++){let e=0;for(;e<a.length&&a[e][r]===1/0;)e++;o[r]=e}var u=new Array(a.length);for(let i=0;i<a.length;i++){let e=0;for(;e<a.length&&a[i][e]===1/0;)e++;u[i]=e}var t=new Array(a.length);for(let b=0;b<a.length;b++){t[b]=new Array(a.length);for(let e=0;e<a.length;e++)t[b][e]=a[b][e]===1/0?1/0:0}var l=structuredClone(t);const g=await this.addNewArray({index:index+1,numbers:t});for(let y=0;y<a.length;y++)for(let t=a.length-1;t>=o[y];t--)for(;0!==a[t][y];){var s=[];let r=t,i=u[t];for(;0<=r;){let e=i;if(0!==r)for(;l[r][e]!==l[r-1][e]&&e<y;)e++;else e=y;for(let t=i;t<=e;t++)s.push([r,t,l[r][t]]);if(!(r-1>=o[e]))break;r--,i=e}for(let e=0;e<s.length;e++)l[s[e][0]][s[e][1]]++;n.push([s,[t,y,a[t][y]-1]]),a[t][y]--}await sleep(this.animationTime/2);for(let v=0;v<n.length;v++){const C=v/n.length*6/7;await this.colorCubes(h,[n[v][1]],C);var f=n[v][1][0],m=n[v][1][1],w=h.size;for(let t=o[m];t<f;t++)h.cubes[t][m][w]=this.addCube(h,m,w,t),h.cubes[t][m][w].material.forEach(material=>material.color.setHSL(C,1,this.cubeLightness));for(let r=u[f];r<m;r++)h.cubes[f][r][w]=this.addCube(h,r,w,f),h.cubes[f][r][w].material.forEach(material=>material.color.setHSL(C,1,this.cubeLightness));await this.raiseCubes(h,[n[v][1]],w);let e=[];for(let i=f-1;i>=o[m];i--)e.push([i,m,w]);var c=this.revealCubes(h,e);e=[];for(let a=m-1;a>=u[f];a--)e.push([f,a,w]);var d=this.revealCubes(h,e);await Promise.all([c,d]),e=[];for(let l=u[f];l<m;l++)e.push([f,l,w]);e.push([f,m,h.numbers[f][m]-1]);for(let s=f-1;s>=o[m];s--)e.push([s,m,w]);c=n[v][0];const p=g.height+1;c.forEach(entry=>entry[2]=p),h.numbers[f][m]--,this.recalculateHeights(h),this.in2dView&&this.drawSingleCell2dViewText(h,f,m),await this.moveCubes(h,e,g,c),await this.lowerCubes(g,c),c.forEach(entry=>{g.numbers[entry[0]][entry[1]]++}),this.recalculateHeights(g),this.in2dView&&c.forEach(entry=>this.drawSingleCell2dViewText(g,entry[0],entry[1])),await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{hillmanGrassl,hillmanGrasslInverse};