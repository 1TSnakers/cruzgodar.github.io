import{sleep}from"/scripts/src/utils.min.js";async function hillmanGrassl(index){var a=this.arrays[index],l=structuredClone(a.numbers),h=new Array(l.length);for(let r=0;r<l.length;r++){let e=0;for(;e<l.length&&l[e][r]===1/0;)e++;h[r]=e}var n=new Array(l.length);for(let i=0;i<l.length;i++){let e=0;for(;e<l.length&&l[i][e]===1/0;)e++;n[i]=e}for(var o=[];;){let e=l[0].length-1;for(;0<=e&&h[e]<l.length&&0===l[h[e]][e];)e--;if(e<0||h[e]===l.length)break;let t=h[e],r=e;for(var s=[[t,r,l[t][r]-1]];;){if(t<l.length-1&&l[t+1][r]===l[t][r])t++;else{if(!(0<r&&l[t][r-1]!==1/0))break;r--}s.push([t,r,l[t][r]-1])}for(let i=0;i<s.length;i++)l[s[i][0]][s[i][1]]--;o.push(s)}var t=new Array(l.length);for(let m=0;m<l.length;m++){t[m]=new Array(l.length);for(let e=0;e<l.length;e++)t[m][e]=l[m][e]===1/0?1/0:0}var u=await this.addNewArray({index:index+1,numbers:t});await sleep(this.animationTime);for(let d=0;d<o.length;d++){var f=d/o.length*6/7;await this.colorCubes(a,o[d],f),await this.raiseCubes(a,o[d],a.height);for(let t=0;t<o[d].length;t++)a.numbers[o[d][t][0]][o[d][t][1]]--,this.in2dView&&this.drawSingleCell2dViewText(a,o[d][t][0],o[d][t][1]);this.recalculateHeights(a),await sleep(this.animationTime/5);var g=[o[d][o[d].length-1][0],o[d][0][1]];let e=[];var w=u.height+1;for(let r=h[g[1]];r<=g[0];r++)e.push([r,g[1],w]);f=e[e.length-1];for(let i=g[1]-1;i>=n[g[0]];i--)e.push([g[0],i,w]);await this.moveCubes(a,o[d],u,e),e=[];for(let l=g[0]-1;l>=h[g[1]];l--)e.push([l,g[1],w]);this.deleteCubes(u,e),e=[];for(let s=g[1]-1;s>=n[g[0]];s--)e.push([g[0],s,w]);this.deleteCubes(u,e),await this.lowerCubes(u,[f]),u.numbers[f[0]][f[1]]++,this.recalculateHeights(u),this.in2dView&&this.drawSingleCell2dViewText(u,f[0],f[1]),u.height=Math.max(u.height,u.numbers[f[0]][f[1]]),u.size=Math.max(u.size,u.height),await sleep(this.animationTime)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}async function hillmanGrasslInverse(index){var h=this.arrays[index],l=structuredClone(h.numbers),n=[],o=new Array(l.length);for(let r=0;r<l.length;r++){let e=0;for(;e<l.length&&l[e][r]===1/0;)e++;o[r]=e}var u=new Array(l.length);for(let i=0;i<l.length;i++){let e=0;for(;e<l.length&&l[i][e]===1/0;)e++;u[i]=e}var t=new Array(l.length);for(let C=0;C<l.length;C++){t[C]=new Array(l.length);for(let e=0;e<l.length;e++)t[C][e]=l[C][e]===1/0?1/0:0}var s=structuredClone(t),f=await this.addNewArray({index:index+1,numbers:t});for(let p=0;p<l.length;p++)for(let t=l.length-1;t>=o[p];t--)for(;0!==l[t][p];){var a=[];let r=t,i=u[t];for(;0<=r;){let e=i;if(0!==r)for(;s[r][e]!==s[r-1][e]&&e<p;)e++;else e=p;for(let t=i;t<=e;t++)a.push([r,t,s[r][t]]);if(!(r-1>=o[e]))break;r--,i=e}for(let e=0;e<a.length;e++)s[a[e][0]][a[e][1]]++;n.push([a,[t,p,l[t][p]-1]]),l[t][p]--}await sleep(this.animationTime/2);for(let y=0;y<n.length;y++){var g=y/n.length*6/7,w=(await this.colorCubes(h,[n[y][1]],g),n[y][1][0]),m=n[y][1][1],d=h.size;for(let t=o[m];t<w;t++){h.cubes[t][m][d]=this.addCube(h,m,d,t);for(const x of h.cubes[t][m][d].material)x.color.setHSL(g,1,this.cubeLightness)}for(let r=u[w];r<m;r++){h.cubes[w][r][d]=this.addCube(h,r,d,w);for(const A of h.cubes[w][r][d].material)A.color.setHSL(g,1,this.cubeLightness)}await this.raiseCubes(h,[n[y][1]],d);let e=[];for(let i=w-1;i>=o[m];i--)e.push([i,m,d]);var c=this.revealCubes(h,e);e=[];for(let l=m-1;l>=u[w];l--)e.push([w,l,d]);var b=this.revealCubes(h,e);await Promise.all([c,b]),e=[];for(let s=u[w];s<m;s++)e.push([w,s,d]);e.push([w,m,h.numbers[w][m]-1]);for(let a=w-1;a>=o[m];a--)e.push([a,m,d]);var c=n[y][0],v=f.height+1;for(const T of c)T[2]=v;h.numbers[w][m]--,this.recalculateHeights(h),this.in2dView&&this.drawSingleCell2dViewText(h,w,m),await this.moveCubes(h,e,f,c),await this.lowerCubes(f,c);for(const V of c)f.numbers[V[0]][V[1]]++;if(this.recalculateHeights(f),this.in2dView)for(const H of c)this.drawSingleCell2dViewText(f,H[0],H[1]);await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{hillmanGrassl,hillmanGrasslInverse};