import{sleep}from"/scripts/src/utils.min.js";async function rsk(index){var f=this.arrays[index],d=this.arrays[index+1],m=f.numbers,c=d.numbers;let r=0,b=0;for(let t=0;t<m.length;t++)for(let e=0;e<m.length;e++){if(m[t][e]===1/0||c[t][e]===1/0)return this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),void(this.currentlyRunningAlgorithm=!1);0!==m[t][e]&&b++,r=Math.max(Math.max(r,m[t][e]),c[t][e])}if(0===r)this.displayError("The SSYT are empty!"),this.currentlyRunningAlgorithm=!1;else{var v=new Array(r);for(let t=0;t<r;t++){v[t]=new Array(r);for(let e=0;e<r;e++)v[t][e]=0}var g=await this.addNewArray({index:index+2,numbers:v});let w=0;for(;0!==c[0][0];){var p=w/b*6/7;let t=0,r=0,i=0;for(let h=0;h<c.length;h++){let e=c.length-1;for(;0<=e&&0===c[h][e];)e--;0<=e&&(t=Math.max(t,c[h][e]))}for(let n=0;n<c.length;n++){let e=c.length-1;for(;0<=e&&0===c[n][e];)e--;if(c[n][e]===t){r=n,i=e;break}}var C=[],y=[],x=[],A=[],T=[],S=[];let s=r,a=i,l=m[s][a];for(var V=c[s][a],H=[[s,a]];0!==s;){let e=m.length-1;for(;0===m[s-1][e]||l<=m[s-1][e];)e--;for(let t=0;t<l;t++)C.push([s,a,t]),y.push([s-1,e,t]);s--,a=e,l=m[s][a],H.push([s,a])}var k=g.height+1;for(let e=0;e<l;e++)x.push([s,a,e]),A.push([V-1,e,k]);for(let o=0;o<V-1;o++)T.push([r,i,o]),S.push([o,l-1,k]);this.colorCubes(d,T.concat([[r,i,V-1]]),p),this.colorCubes(f,C,p),await this.colorCubes(f,x,p),c[r][i]=0;for(let u=H.length-1;0<u;u--)m[H[u][0]][H[u][1]]=m[H[u-1][0]][H[u-1][1]];if(m[r][i]=0,this.in2dView){this.drawSingleCell2dViewText(f,r,i);for(let e=H.length-1;0<e;e--)this.drawSingleCell2dViewText(f,H[e][0],H[e][1]);this.drawSingleCell2dViewText(d,r,i)}await Promise.all([this.moveCubes(d,T,g,S),this.moveCubes(f,x,g,A),this.moveCubes(f,C,f,y),this.moveCubes(d,[[r,i,V-1]],g,[[V-1,l-1,k]],!1)]),this.uncolorCubes(f,y),g.cubeGroup.remove(d.cubes[r][i][V-1]),this.deleteCubes(d,[[r,i,V-1]],!0,!0),A.reverse(),S.reverse(),this.deleteCubes(g,A.slice(1)),this.deleteCubes(g,S),await this.lowerCubes(g,[[V-1,l-1,k]]),v[V-1][l-1]++,this.in2dView&&this.drawSingleCell2dViewText(g,V-1,l-1),this.recalculateHeights(g),w++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index),await sleep(this.animationTime),await this.removeArray(index)}}async function rskInverse(index){var o=this.arrays[index],s=structuredClone(o.numbers);let u=0;for(const e of s)for(const r of e)u+=r;let w=new Array(u),f=new Array(u);for(let i=0;i<u;i++){w[i]=new Array(u),f[i]=new Array(u);for(let e=0;e<u;e++)w[i][e]=0,f[i][e]=0}var a=new Array(s.length);for(let n=0;n<s.length;n++)a[n]=0;let l=0;var d=[],m=[],c=[];for(let M=0;M<s.length;M++)for(let i=0;i<s.length;i++)for(;0!==s[M][i];){s[M][i]--;let e=i+1,t=0,r=0;for(var h=[];;){for(r=a[t];0!==r&&w[t][r-1]>e;)r--;if(r===a[t]){w[t][r]=e,a[t]++,0===r&&l++,h.push([t,r]);break}var I=w[t][r];w[t][r]=e,e=I,h.push([t,r]),t++}d.push(h),m.push([t,r]),c.push([M,i]),f[t][r]=M+1}var t=Math.max(a[0],l);w=new Array(t),f=new Array(t);for(let N=0;N<t;N++){w[N]=new Array(t),f[N]=new Array(t);for(let e=0;e<t;e++)w[N][e]=0,f[N][e]=0}var b=await this.addNewArray({index:index+1,numbers:w}),v=(await sleep(this.animationTime/2),await this.addNewArray({index:index+2,numbers:f}));await sleep(this.animationTime/2);let g=0;for(let P=0;P<c.length;P++){var p=c[P][0],C=c[P][1],y=o.height+1,x=g/u*6/7;for(let t=C;0<=t;t--){o.cubes[p][t][y]=this.addCube(o,t,y,p);for(const R of o.cubes[p][t][y].material)R.color.setHSL(x,1,this.cubeLightness)}for(let r=p-1;0<=r;r--){o.cubes[r][C][y]=this.addCube(o,C,y,r);for(const E of o.cubes[r][C][y].material)E.color.setHSL(x,1,this.cubeLightness)}o.cubes[p][C][y+1]=this.addCube(o,C,y,p);for(const K of o.cubes[p][C][y+1].material)K.color.setHSL(x,1,this.cubeLightness);await this.colorCubes(o,[[p,C,o.numbers[p][C]-1]],x),await this.raiseCubes(o,[[p,C,o.numbers[p][C]-1]],y);var Y=this.revealCubes(o,[[p,C,y+1]]);let e=[];for(let i=C-1;0<=i;i--)e.push([p,i,y]);var j=this.revealCubes(o,e);e=[];for(let s=p-1;0<=s;s--)e.push([s,C,y]);var G=this.revealCubes(o,e),A=(await Promise.all([Y,j,G]),d[g]),T=[],S=[],V=[[p,C,o.numbers[p][C]-1]],H=[[A[0][0],A[0][1],C]],k=[[p,C,y+1]],L=[[m[g][0],m[g][1],p]];for(let a=C-1;0<=a;a--)V.push([p,a,y]),H.push([A[0][0],A[0][1],a]);for(let l=0;l<A.length-1;l++)for(let e=0;e<w[A[l][0]][A[l][1]];e++)T.push([A[l][0],A[l][1],e]),S.push([A[l+1][0],A[l+1][1],e]);for(let h=p-1;0<=h;h--)k.push([h,C,y]),L.push([m[g][0],m[g][1],h]);await this.colorCubes(b,T,x);for(let n=A.length-1;0<n;n--)w[A[n][0]][A[n][1]]=w[A[n-1][0]][A[n-1][1]];0!==A.length&&(w[A[0][0]][A[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==T.length&&await this.moveCubes(b,T,b,S),o.numbers[p][C]--,this.in2dView&&this.drawAll2dViewText(),await Promise.all([this.moveCubes(o,V,b,H),this.moveCubes(o,k,v,L)]),w[A[0][0]][A[0][1]]=C+1,f[m[g][0]][m[g][1]]=p+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(o),this.recalculateHeights(b),this.recalculateHeights(v),g++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{rsk,rskInverse};