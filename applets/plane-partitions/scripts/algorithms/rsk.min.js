import{sleep}from"/scripts/src/main.min.js";async function rsk(index){var m=this.arrays[index],c=this.arrays[index+1],d=m.numbers,f=c.numbers;let r=0,b=0;for(let t=0;t<d.length;t++)for(let e=0;e<d.length;e++){if(d[t][e]===1/0||f[t][e]===1/0)return this.displayError("The SSYT contain infinite values, which is not allowed in RSK!"),void(this.currentlyRunningAlgorithm=!1);0!==d[t][e]&&b++,r=Math.max(Math.max(r,d[t][e]),f[t][e])}if(0===r)this.displayError("The SSYT are empty!"),this.currentlyRunningAlgorithm=!1;else{var v=new Array(r);for(let t=0;t<r;t++){v[t]=new Array(r);for(let e=0;e<r;e++)v[t][e]=0}var g=await this.addNewArray(index+2,v);let w=0;for(;0!==f[0][0];){var p=w/b*6/7;let t=0,r=0,i=0;for(let h=0;h<f.length;h++){let e=f.length-1;for(;0<=e&&0===f[h][e];)e--;0<=e&&(t=Math.max(t,f[h][e]))}for(let n=0;n<f.length;n++){let e=f.length-1;for(;0<=e&&0===f[n][e];)e--;if(f[n][e]===t){r=n,i=e;break}}var y=[],C=[],A=[],x=[],T=[],S=[];let a=r,s=i,l=d[a][s];for(var V=f[a][s],E=[[a,s]];0!==a;){let e=d.length-1;for(;0===d[a-1][e]||l<=d[a-1][e];)e--;for(let t=0;t<l;t++)y.push([a,s,t]),C.push([a-1,e,t]);a--,s=e,l=d[a][s],E.push([a,s])}var H=g.height+1;for(let e=0;e<l;e++)A.push([a,s,e]),x.push([V-1,e,H]);for(let o=0;o<V-1;o++)T.push([r,i,o]),S.push([o,l-1,H]);this.colorCubes(c,T.concat([[r,i,V-1]]),p),this.colorCubes(m,y,p),await this.colorCubes(m,A,p),f[r][i]=0;for(let u=E.length-1;0<u;u--)d[E[u][0]][E[u][1]]=d[E[u-1][0]][E[u-1][1]];if(d[r][i]=0,this.in2dView){this.drawSingleCell2dViewText(m,r,i);for(let e=E.length-1;0<e;e--)this.drawSingleCell2dViewText(m,E[e][0],E[e][1]);this.drawSingleCell2dViewText(c,r,i)}await Promise.all([this.moveCubes(c,T,g,S),this.moveCubes(m,A,g,x),this.moveCubes(m,y,m,C),this.moveCubes(c,[[r,i,V-1]],g,[[V-1,l-1,H]],!1)]),this.uncolorCubes(m,C),g.cubeGroup.remove(c.cubes[r][i][V-1]),this.deleteCubes(c,[[r,i,V-1]],!0,!0),x.reverse(),S.reverse(),this.deleteCubes(g,x.slice(1)),this.deleteCubes(g,S),await this.lowerCubes(g,[[V-1,l-1,H]]),v[V-1][l-1]++,this.in2dView&&this.drawSingleCell2dViewText(g,V-1,l-1),this.recalculateHeights(g),w++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index),await sleep(this.animationTime),await this.removeArray(index)}}async function rskInverse(index){var o=this.arrays[index],a=structuredClone(o.numbers);let u=0,w=(a.forEach(row=>row.forEach(entry=>u+=entry)),new Array(u)),m=new Array(u);for(let r=0;r<u;r++){w[r]=new Array(u),m[r]=new Array(u);for(let e=0;e<u;e++)w[r][e]=0,m[r][e]=0}var s=new Array(a.length);for(let e=0;e<a.length;e++)s[e]=0;let l=0;var c=[],d=[],f=[];for(let N=0;N<a.length;N++)for(let i=0;i<a.length;i++)for(;0!==a[N][i];){a[N][i]--;let e=i+1,t=0,r=0;for(var h=[];;){for(r=s[t];0!==r&&w[t][r-1]>e;)r--;if(r===s[t]){w[t][r]=e,s[t]++,0===r&&l++,h.push([t,r]);break}var n=w[t][r];w[t][r]=e,e=n,h.push([t,r]),t++}c.push(h),d.push([t,r]),f.push([N,i]),m[t][r]=N+1}var t=Math.max(s[0],l);w=new Array(t),m=new Array(t);for(let i=0;i<t;i++){w[i]=new Array(t),m[i]=new Array(t);for(let e=0;e<t;e++)w[i][e]=0,m[i][e]=0}var b=await this.addNewArray(index+1,w),v=(await sleep(this.animationTime/2),await this.addNewArray(index+2,m));await sleep(this.animationTime/2);let g=0;for(let P=0;P<f.length;P++){var p=f[P][0],y=f[P][1],C=o.height+1;const R=g/u*6/7;for(let t=y;0<=t;t--)o.cubes[p][t][C]=this.addCube(o,t,C,p),o.cubes[p][t][C].material.forEach(material=>material.color.setHSL(R,1,this.cubeLightness));for(let r=p-1;0<=r;r--)o.cubes[r][y][C]=this.addCube(o,y,C,r),o.cubes[r][y][C].material.forEach(material=>material.color.setHSL(R,1,this.cubeLightness));o.cubes[p][y][C+1]=this.addCube(o,y,C,p),o.cubes[p][y][C+1].material.forEach(material=>material.color.setHSL(R,1,this.cubeLightness)),await this.colorCubes(o,[[p,y,o.numbers[p][y]-1]],R),await this.raiseCubes(o,[[p,y,o.numbers[p][y]-1]],C);var A=this.revealCubes(o,[[p,y,C+1]]);let e=[];for(let i=y-1;0<=i;i--)e.push([p,i,C]);var x=this.revealCubes(o,e);e=[];for(let a=p-1;0<=a;a--)e.push([a,y,C]);var T=this.revealCubes(o,e),S=(await Promise.all([A,x,T]),c[g]),V=[],E=[],H=[[p,y,o.numbers[p][y]-1]],k=[[S[0][0],S[0][1],y]],L=[[p,y,C+1]],M=[[d[g][0],d[g][1],p]];for(let s=y-1;0<=s;s--)H.push([p,s,C]),k.push([S[0][0],S[0][1],s]);for(let l=0;l<S.length-1;l++)for(let e=0;e<w[S[l][0]][S[l][1]];e++)V.push([S[l][0],S[l][1],e]),E.push([S[l+1][0],S[l+1][1],e]);for(let h=p-1;0<=h;h--)L.push([h,y,C]),M.push([d[g][0],d[g][1],h]);await this.colorCubes(b,V,R);for(let n=S.length-1;0<n;n--)w[S[n][0]][S[n][1]]=w[S[n-1][0]][S[n-1][1]];0!==S.length&&(w[S[0][0]][S[0][1]]=0),this.in2dView&&this.drawAll2dViewText(),0!==V.length&&await this.moveCubes(b,V,b,E),o.numbers[p][y]--,this.in2dView&&this.drawAll2dViewText(),await Promise.all([this.moveCubes(o,H,b,k),this.moveCubes(o,L,v,M)]),w[S[0][0]][S[0][1]]=y+1,m[d[g][0]][d[g][1]]=p+1,this.in2dView&&this.drawAll2dViewText(),this.recalculateHeights(o),this.recalculateHeights(b),this.recalculateHeights(v),g++,await sleep(this.animationTime/2)}this.currentlyAnimatingCamera=!1,await this.removeArray(index)}export{rsk,rskInverse};