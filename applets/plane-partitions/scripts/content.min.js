Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then(()=>{Site.scripts_loaded.lodash=!0}).catch(e=>{console.error("Could not load Lodash")});let resolution=2e3,animation_time=600;const asymptote_lightness=.6,cube_lightness=.4;let floor_lightness=.4;const infinite_height=100,add_walls=!1,wall_size=30,algorithm_data={hillman_grassl:{method:hillman_grassl,input_type:["pp"]},hillman_grassl_inverse:{method:hillman_grassl_inverse,input_type:["tableau"]},pak:{method:pak,input_type:["pp"]},pak_inverse:{method:pak_inverse,input_type:["tableau"]},sulzgruber:{method:sulzgruber,input_type:["pp"]},sulzgruber_inverse:{method:sulzgruber_inverse,input_type:["tableau"]},rsk:{method:rsk,input_type:["ssyt","ssyt"],same_shape:!0},rsk_inverse:{method:rsk_inverse,input_type:["tableau"]},godar_1:{method:godar_1,input_type:["pp"]},godar_1_inverse:{method:godar_1_inverse,input_type:["pp","pp"]}};let options_numbers={renderer:"cpu",canvas_width:resolution,canvas_height:resolution,use_fullscreen:!0,use_fullscreen_button:!1,mousedown_callback:on_grab_canvas,touchstart_callback:on_grab_canvas,mousedrag_callback:on_drag_canvas,touchmove_callback:on_drag_canvas,mouseup_callback:on_release_canvas,touchend_callback:on_release_canvas},wilson_numbers=new Wilson(document.body.querySelector("#numbers-canvas"),options_numbers);wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",document.body.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),Page.set_element_styles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0);let options={canvas_width:resolution,canvas_height:resolution,use_fullscreen:!0,use_fullscreen_button:APPLET_VERSION,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:switch_fullscreen},wilson=new Wilson(document.body.querySelector("#output-canvas"),options),wilson_hidden=new Wilson(document.body.querySelector("#hidden-canvas"),{renderer:"cpu",canvas_width:64,canvas_height:64});wilson_hidden.ctx.strokeStyle="rgb(255, 255, 255)",wilson_hidden.ctx._alpha=1,wilson_hidden.ctx.fillStyle="rgba(64, 64, 64, 1)",wilson_hidden.ctx.fillRect(0,0,64,64),wilson_hidden.ctx.fillStyle="rgba(128, 128, 128, 1)",wilson_hidden.ctx.fillRect(4,4,56,56),wilson_hidden.ctx.lineWidth=6;let wilson_hidden_2=new Wilson(document.body.querySelector("#hidden-canvas-2"),{renderer:"cpu",canvas_width:64,canvas_height:64});wilson_hidden_2.ctx.strokeStyle="rgb(255, 255, 255)",wilson_hidden_2.ctx._alpha=1,wilson_hidden_2.ctx.fillStyle="rgba(64, 64, 64, 1)",wilson_hidden_2.ctx.fillRect(0,0,64,64),wilson_hidden_2.ctx.fillStyle="rgba(128, 128, 128, 1)",wilson_hidden_2.ctx.fillRect(4,4,56,56),wilson_hidden_2.ctx.lineWidth=6;let wilson_hidden_3=new Wilson(document.body.querySelector("#hidden-canvas-3"),{renderer:"cpu",canvas_width:64,canvas_height:64});wilson_hidden_3.ctx.strokeStyle="rgb(255, 255, 255)",wilson_hidden_3.ctx._alpha=1,wilson_hidden_3.ctx.fillStyle="rgba(32, 32, 32, 1)",wilson_hidden_3.ctx.fillRect(0,0,64,64),wilson_hidden_3.ctx.fillStyle="rgba(64, 64, 64, 1)",wilson_hidden_3.ctx.fillRect(4,4,56,56),wilson_hidden_3.ctx.lineWidth=6;let wilson_hidden_4=new Wilson(document.body.querySelector("#hidden-canvas-4"),{renderer:"cpu",canvas_width:64,canvas_height:64});wilson_hidden_4.ctx.strokeStyle="rgb(255, 255, 255)",wilson_hidden_4.ctx._alpha=1,wilson_hidden_4.ctx.fillStyle="rgba(32, 32, 32, 1)",wilson_hidden_4.ctx.fillRect(0,0,64,64),wilson_hidden_4.ctx.fillStyle="rgba(64, 64, 64, 1)",wilson_hidden_4.ctx.fillRect(4,4,56,56),wilson_hidden_4.ctx.lineWidth=6,Site.scripts_loaded.three||await Site.load_script("/scripts/three.min.js").then(()=>{Site.scripts_loaded.three=!0}).catch(e=>{console.error("Could not load THREE.js")});let numbers_canvas_container_element=document.body.querySelector("#numbers-canvas-container");const section_names=["view-controls","add-array","edit-array","remove-array","algorithms"],section_elements={"view-controls":document.body.querySelectorAll(".view-controls-section"),"add-array":document.body.querySelectorAll(".add-array-section"),"edit-array":document.body.querySelectorAll(".edit-array-section"),"remove-array":document.body.querySelectorAll(".remove-array-section"),algorithms:document.body.querySelectorAll(".algorithms-section"),examples:document.body.querySelectorAll(".examples-section")},category_holder_element=document.body.querySelector("#category-holder"),canvas_landscape_left_element=document.body.querySelector("#canvas-landscape-left");let visible_section="view-controls";section_names.forEach(e=>{e!==visible_section&&section_elements[e].forEach(e=>{e.style.opacity=0})}),section_elements[visible_section].forEach(e=>canvas_landscape_left_element.appendChild(e)),APPLET_VERSION&&(Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10)),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize();let category_selector_dropdown_element=document.body.querySelector("#category-selector-dropdown"),resolution_input_element=document.body.querySelector("#resolution-input"),show_dimers_button_element=document.body.querySelector("#show-dimers-button"),switch_view_button_element=document.body.querySelector("#switch-view-button"),maximum_speed_checkbox_element=document.body.querySelector("#maximum-speed-checkbox"),array_data_textarea_element=document.body.querySelector("#array-data-textarea"),add_array_button_element=document.body.querySelector("#add-array-button"),edit_array_textarea_element=document.body.querySelector("#edit-array-textarea"),edit_array_index_input_element=document.body.querySelector("#edit-array-index-input"),edit_array_button_element=document.body.querySelector("#edit-array-button"),remove_array_index_input_element=document.body.querySelector("#remove-array-index-input"),remove_array_button_element=document.body.querySelector("#remove-array-button"),algorithm_index_input_element=document.body.querySelector("#algorithm-index-input"),hillman_grassl_button_element=document.body.querySelector("#hillman-grassl-button"),hillman_grassl_inverse_button_element=document.body.querySelector("#hillman-grassl-inverse-button"),pak_button_element=document.body.querySelector("#pak-button"),pak_inverse_button_element=document.body.querySelector("#pak-inverse-button"),sulzgruber_button_element=document.body.querySelector("#sulzgruber-button"),sulzgruber_inverse_button_element=document.body.querySelector("#sulzgruber-inverse-button"),rsk_button_element=document.body.querySelector("#rsk-button"),rsk_inverse_button_element=document.body.querySelector("#rsk-inverse-button"),godar_1_button_element=document.body.querySelector("#godar-1-button"),godar_1_inverse_button_element=document.body.querySelector("#godar-1-inverse-button"),example_1_button_element=document.body.querySelector("#example-1-button"),example_2_button_element=document.body.querySelector("#example-2-button"),example_3_button_element=document.body.querySelector("#example-3-button"),need_download=!1,download_button_element=document.body.querySelector("#download-button");APPLET_VERSION&&(category_selector_dropdown_element.addEventListener("input",async()=>{if(await Promise.all(Array.from(section_elements[visible_section]).map(e=>Page.Animate.change_opacity(e,0,Site.opacity_animation_time))),section_elements[visible_section].forEach(e=>category_holder_element.appendChild(e)),section_elements[visible_section].forEach(e=>e.classList.remove("move-to-left")),section_elements[visible_section].forEach(e=>e.classList.remove("move-to-right")),section_elements[visible_section=category_selector_dropdown_element.value].forEach(e=>canvas_landscape_left_element.appendChild(e)),Page.Load.TextButtons.equalize(),setTimeout(Page.Load.TextButtons.equalize,10),Page.Layout.aspect_ratio>1&&Page.Layout.AppletColumns.equalize(),"edit-array"===visible_section){let e=parseInt(edit_array_index_input_element.value||0);e<arrays.length&&e>=0&&(edit_array_textarea_element.value=array_to_ascii(arrays[e].numbers))}section_elements[visible_section].forEach(e=>Page.Animate.change_opacity(e,1,Site.opacity_animation_time))}),resolution_input_element.addEventListener("input",()=>{resolution=parseInt(resolution_input_element.value||2e3),renderer.setSize(resolution,resolution,!1)}),show_dimers_button_element.addEventListener("click",()=>{dimers_shown?hide_dimers():show_dimers()}),switch_view_button_element.addEventListener("click",()=>{in_2d_view?show_hex_view():show_2d_view()}),maximum_speed_checkbox_element.addEventListener("input",()=>{animation_time=maximum_speed_checkbox_element.checked?60:600}),array_data_textarea_element.value=generate_random_plane_partition(),add_array_button_element.addEventListener("click",()=>{add_new_array(arrays.length,parse_array(array_data_textarea_element.value))}),edit_array_index_input_element.addEventListener("input",()=>{let e=parseInt(edit_array_index_input_element.value||0);!(e>=arrays.length)&&!(e<0)&&(edit_array_textarea_element.value=array_to_ascii(arrays[e].numbers))}),edit_array_button_element.addEventListener("click",edit_array),remove_array_button_element.addEventListener("click",()=>{remove_array(parseInt(remove_array_index_input_element.value))}),hillman_grassl_button_element.addEventListener("click",()=>run_algorithm("hillman_grassl")),hillman_grassl_inverse_button_element.addEventListener("click",()=>run_algorithm("hillman_grassl_inverse")),pak_button_element.addEventListener("click",()=>run_algorithm("pak")),pak_inverse_button_element.addEventListener("click",()=>run_algorithm("pak_inverse")),sulzgruber_button_element.addEventListener("click",()=>run_algorithm("sulzgruber")),sulzgruber_inverse_button_element.addEventListener("click",()=>run_algorithm("sulzgruber_inverse")),rsk_button_element.addEventListener("click",()=>run_algorithm("rsk")),rsk_inverse_button_element.addEventListener("click",()=>run_algorithm("rsk_inverse")),godar_1_button_element.addEventListener("click",()=>run_algorithm("godar_1")),godar_1_inverse_button_element.addEventListener("click",()=>run_algorithm("godar_1_inverse")),example_1_button_element.addEventListener("click",()=>run_example(1)),example_2_button_element.addEventListener("click",()=>run_example(2)),example_3_button_element.addEventListener("click",()=>run_example(3)),download_button_element.addEventListener("click",()=>{need_download=!0}));const scene=new THREE.Scene;scene.background=new THREE.Color(0);const orthographic_camera=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),renderer=new THREE.WebGLRenderer({canvas:wilson.canvas,antialias:!0});renderer.setSize(resolution,resolution,!1);const loader=new THREE.TextureLoader,cube_texture=new THREE.CanvasTexture(wilson_hidden.canvas);cube_texture.minFilter=THREE.LinearFilter,cube_texture.magFilter=THREE.NearestFilter;const cube_texture_2=new THREE.CanvasTexture(wilson_hidden_2.canvas);cube_texture_2.minFilter=THREE.LinearFilter,cube_texture_2.magFilter=THREE.NearestFilter;const floor_texture=new THREE.CanvasTexture(wilson_hidden_3.canvas);floor_texture.minFilter=THREE.LinearFilter,floor_texture.magFilter=THREE.NearestFilter;const floor_texture_2=new THREE.CanvasTexture(wilson_hidden_4.canvas);floor_texture_2.minFilter=THREE.LinearFilter,floor_texture_2.magFilter=THREE.NearestFilter;const cube_geometry=new THREE.BoxGeometry;let dimers_shown=!1;const floor_geometry=new THREE.BoxGeometry(1,.001,1),wall_left_geometry=new THREE.BoxGeometry(.001,1,1),wall_right_geometry=new THREE.BoxGeometry(1,1,.001),ambient_light=new THREE.AmbientLight(16777215,.2);scene.add(ambient_light);const point_light=new THREE.PointLight(16777215,3,1e4);point_light.position.set(750,1e3,500),scene.add(point_light);let rotation_y=0,rotation_y_velocity=0,next_rotation_y_velocity=0,last_rotation_y_velocities=[];const rotation_y_velocity_friction=.94,rotation_y_velocity_start_threshhold=.005,rotation_y_velocity_stop_threshhold=5e-4;let in_2d_view=!1,in_exact_hex_view=!0,currently_animating_camera=!1,currently_running_algorithm=!1,font_size=10,arrays=[],total_array_footprint=0,total_array_height=0,total_array_size=0,hex_view_camera_pos=[15,15,15],_2d_view_camera_pos=[0,20,0];if(APPLET_VERSION){let e=parse_array(array_data_textarea_element.value);edit_array_textarea_element.value=array_data_textarea_element.value,add_new_array(arrays.length,e)}function garver_patrias_stress_test(){let e=[[1,2,3],[4,5,6],[7,8,9]],t=[[1,4,7],[2,5,8],[3,6,9]],a=[,,,];for(let r=0;r<3;r++)a[r]=[,,,];let n=[];for(let i=0;i<19683;i++){set_numbers(i,a,3,3);let o=garver_patrias(a,3,e,t);n.push(o)}for(let l=0;l<n.length-1;l++)for(let s=l+1;s<n.length;s++){let c=!1;for(let u=0;u<3;u++){for(let h=0;h<3;h++)if(n[l][u][h]!==n[s][u][h]){c=!0;break}if(c)break}c||(console.log("bad!"),set_numbers(l,a,3,3),console.log(a),set_numbers(s,a,3,3),console.log(a))}}function set_numbers(e,t,a,r){let n=e;for(let i=0;i<a;i++)for(let o=0;o<a;o++)t[i][o]=n%r,n=Math.floor(n/r)}function garver_patrias(e,t,a,r){let n=[];for(;;){let i=!1;for(let o=0;o<a.length;o++){for(let l=0;l<a[o].length;l++)if(a[o][l]===n.length+1){n.push([o,l]),i=!0;break}if(i)break}if(!i)break}let s=Array(t);for(let c=0;c<t;c++)s[c]=Array(t);for(let u=-t+1;u<=t-1;u++){let h=[0,0];for(u<0?h[0]=-u:h[1]=u;h[0]<t&&h[1]<t&&e[h[0]][h[1]]===1/0;)h[0]++,h[1]++;let d=[];n.forEach(t=>{if(t[0]>=h[0]&&t[1]>=h[1])for(let a=0;a<e[t[0]][t[1]];a++)d.push(r[t[0]][t[1]])});let $=[[]];for(let m=0;m<d.length;m++){let f=d[m],g=0;for(;;){if(0===$[g].length||$[g][$[g].length-1]<=f){$[g].push(f);break}let w=$[g].length-1;for(;w>0&&$[g][w-1]>f;)w--;let p=$[g][w];$[g][w]=f,f=p,g++,$.length<=g&&$.push([])}}let y=$.map(e=>e.length),b=h[0],v=h[1],x=0;for(;b<t&&v<t;)s[b][v]=y[x]??0,b++,v++,x++}return s}function on_grab_canvas(e,t,a){in_exact_hex_view=!1,rotation_y_velocity=0,last_rotation_y_velocities=[0,0,0,0]}function on_drag_canvas(e,t,a,r,n){!in_2d_view&&((rotation_y+=a)>3.14159265?rotation_y-=6.283185301:rotation_y<-3.14159265&&(rotation_y+=6.283185301),scene.children.forEach(e=>e.rotation.y=rotation_y),next_rotation_y_velocity=a)}function on_release_canvas(e,t,a){if(!in_2d_view){let r=0;if(last_rotation_y_velocities.forEach((e,t)=>{Math.abs(e)>rotation_y_velocity&&(rotation_y_velocity=Math.abs(e),r=t)}),rotation_y_velocity<.005){rotation_y_velocity=0;return}rotation_y_velocity=last_rotation_y_velocities[r]}last_rotation_y_velocities=[0,0,0,0]}function draw_frame(){renderer.render(scene,orthographic_camera),last_rotation_y_velocities.push(next_rotation_y_velocity),last_rotation_y_velocities.shift(),next_rotation_y_velocity=0,0!==rotation_y_velocity&&(rotation_y+=rotation_y_velocity,scene.children.forEach(e=>e.rotation.y=rotation_y),5e-4>Math.abs(rotation_y_velocity*=.94)&&(rotation_y_velocity=0)),rotation_y>3.14159265?rotation_y-=6.283185301:rotation_y<-3.14159265&&(rotation_y+=6.283185301),need_download&&(need_download=!1,wilson.canvas.toBlob(e=>{let t=document.createElement("a");t.download="a-plane-partition.png",t.href=window.URL.createObjectURL(e),t.click(),t.remove()})),window.requestAnimationFrame(draw_frame)}function switch_fullscreen(){try{document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(e){}in_2d_view||wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),wilson_numbers.fullscreen.switch_fullscreen()}function generate_random_plane_partition(){let e=Math.floor(3*Math.random())+4,t=Array(e);for(let a=0;a<e;a++)t[a]=Array(e);t[0][0]=Math.floor(5*Math.random())+10;for(let r=1;r<e;r++)t[0][r]=Math.max(t[0][r-1]-Math.floor(4*Math.random()),0);for(let n=1;n<e;n++){t[n][0]=Math.max(t[n-1][0]-Math.floor(4*Math.random()),0);for(let i=1;i<e;i++)t[n][i]=Math.max(Math.min(t[n][i-1],t[n-1][i])-Math.floor(4*Math.random()),0)}let o="";for(let l=0;l<e;l++){for(let s=0;s<e;s++){let c=t[l][s];0===c?o+="   ":c<10?o+=` ${c} `:o+=`${c} `}l!==e-1&&(o+="\n")}return o}function generate_random_tableau(){let e=Math.floor(3*Math.random())+4,t=Array(e);for(let a=0;a<e;a++){t[a]=Array(e);for(let r=0;r<e;r++)Math.random()<.75/e?t[a][r]=Math.floor(3*Math.random())+1:t[a][r]=0}return t}function generate_random_ssyt(){let e=Math.floor(3*Math.random())+2,t=Array(e);for(let a=0;a<e;a++)t[a]=Array(e);t[0][0]=Math.floor(2*Math.random());for(let r=1;r<e;r++)t[0][r]=t[0][r-1]+Math.floor(2*Math.random());for(let n=1;n<e;n++){t[n][0]=t[n-1][0]+1+Math.floor(2*Math.random());for(let i=1;i<e;i++)t[n][i]=Math.max(t[n][i-1],t[n-1][i]+1)+Math.floor(2*Math.random())}return t}function parse_array(e){let t=e.split("\n"),a=t.length,r=Array(t.length);for(let n=0;n<r.length;n++){r[n]=t[n].split(" ");for(let i=0;i<r[n].length;i++)""===r[n][i]&&(r[n].splice(i,1),i--)}let o=r[0].length;if(-1===e.indexOf(">")){for(let l=0;l<r.length;l++)r[l].push("0");o++}-1===e.indexOf("v")&&(r.push(["0"]),a++);let s=Math.max(a,o),c=Array(s);for(let u=0;u<a;u++){c[u]=Array(s);for(let h=0;h<r[u].length;h++)"^"===r[u][h]?c[u][h]=1/0:">"===r[u][h]?c[u][h]=c[u][h-1]:"v"===r[u][h]?c[u][h]=c[u-1][h]:c[u][h]=parseInt(r[u][h]);for(let d=r[u].length;d<s;d++)c[u][d]=0}for(let $=a;$<s;$++){c[$]=Array(s);for(let m=0;m<s;m++)c[$][m]=0}return c}function array_to_ascii(e){let t=1;for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)e[a][r]!==1/0&&(t=Math.max(t,`${e[a][r]}`.length));t++;let n="";for(let i=0;i<e.length-1;i++){for(let o=0;o<e.length-1;o++)if(e[i][o]===1/0){for(let l=0;l<t-1-(0===o);l++)n+=" ";n+="^"}else{let s=`${e[i][o]}`.length;for(let c=0;c<t-s-(0===o);c++)n+=" ";n+=e[i][o]}if(0!==e[i][e.length-1]){for(let u=0;u<t-1;u++)n+=" ";n+=">"}i!==e.length-2&&(n+="\n")}if(0!==e[e.length-1][0]){n+="\n";for(let h=0;h<e.length-1;h++)if(0!==e[e.length-1][h]){for(let d=0;d<t-1-(0===h);d++)n+=" ";n+="v"}}return n}function verify_pp(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(e[t][a]<e[t+1][a]||e[t][a]<e[t][a+1])return!1;return!0}function verify_ssyt(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e[t].length-1;a++)if(0!==e[t+1][a]&&e[t][a]>=e[t+1][a]||0!==e[t][a+1]&&e[t][a]>e[t][a+1])return!1;return!0}function display_error(e){Page.Footer.Floating.show_settings_text(e)}function add_new_array(e,t,a=!1,r=!0){return new Promise(async(n,i)=>{let o={numbers:t,cubes:[],floor:[],left_wall:[],right_wall:[],cube_group:null,center_offset:0,partial_footprint_sum:0,footprint:0,height:0,size:0};in_2d_view&&!a&&await Page.Animate.change_opacity(numbers_canvas_container_element,0,animation_time/5),arrays.splice(e,0,o),o.footprint=o.numbers.length;for(let l=e;l<arrays.length;l++)arrays[l].partial_footprint_sum=arrays[l].footprint,0!==l?(arrays[l].center_offset=arrays[l-1].center_offset+arrays[l-1].footprint/2+arrays[l].footprint/2+1,arrays[l].partial_footprint_sum+=arrays[l-1].partial_footprint_sum+1):arrays[l].center_offset=0,l!==e&&(in_2d_view?anime({targets:arrays[l].cube_group.position,x:arrays[l].center_offset,y:0,z:0,duration:animation_time,easing:"easeInOutQuad"}):anime({targets:arrays[l].cube_group.position,x:arrays[l].center_offset,y:0,z:-arrays[l].center_offset,duration:animation_time,easing:"easeInOutQuad"}));o.cube_group=new THREE.Object3D,scene.add(o.cube_group),in_2d_view?o.cube_group.position.set(o.center_offset,0,0):o.cube_group.position.set(o.center_offset,0,-o.center_offset),o.cube_group.rotation.y=rotation_y,o.cubes=Array(o.footprint),o.floor=Array(o.footprint);for(let s=0;s<o.footprint;s++){o.cubes[s]=Array(o.footprint),o.floor[s]=Array(o.footprint);for(let c=0;c<o.footprint;c++)if(o.numbers[s][c]!==1/0){if(o.cubes[s][c]=Array(o.numbers[s][c]),o.numbers[s][c]>o.height&&(o.height=o.numbers[s][c]),o.floor[s][c]=add_floor(o,c,s),r){let u=Math.max(o.numbers[s][o.footprint-1],o.numbers[o.footprint-1][c]);for(let h=0;h<u;h++)o.cubes[s][c][h]=add_cube(o,c,h,s,0,0,.6);for(let d=u;d<o.numbers[s][c];d++)o.cubes[s][c][d]=add_cube(o,c,d,s)}else for(let $=0;$<o.numbers[s][c];$++)o.cubes[s][c][$]=add_cube(o,c,$,s)}else{o.cubes[s][c]=Array(100),o.floor[s][c]=add_floor(o,c,s);for(let m=0;m<100;m++)o.cubes[s][c][m]=add_cube(o,c,m,s,0,0,.6)}}o.size=Math.max(o.footprint,o.height),total_array_footprint+=o.footprint+1,total_array_size=Math.max(total_array_footprint,total_array_height=Math.max(total_array_height,o.height)),1!==arrays.length||a?a||update_camera_height(!0):(hex_view_camera_pos=[total_array_size,total_array_size+total_array_height/3,total_array_size],_2d_view_camera_pos=[0,total_array_size+10,0],in_2d_view&&!a?update_camera_height(!0):(orthographic_camera.left=-total_array_size,orthographic_camera.right=total_array_size,orthographic_camera.top=total_array_size,orthographic_camera.bottom=-total_array_size,orthographic_camera.position.set(hex_view_camera_pos[0],hex_view_camera_pos[1],hex_view_camera_pos[2]),orthographic_camera.rotation.set(-.785398163,.615479709,.523598775),orthographic_camera.updateProjectionMatrix())),e!==arrays.length-1&&await new Promise((e,t)=>setTimeout(e,animation_time));let f=[];o.cube_group.traverse(e=>{e.material&&e.material.forEach(e=>f.push(e))}),await new Promise(async(e,t)=>{anime({targets:f,opacity:1,duration:animation_time/2,easing:"easeOutQuad",complete:e})}),in_2d_view&&!a&&draw_all_2d_view_text(),n(o)})}function edit_array(){return new Promise(async(e,t)=>{let a=parseInt(edit_array_index_input_element.value);if(a>=arrays.length||a<0){display_error(`No array at index ${a}`);return}arrays[a];let r=parse_array(edit_array_textarea_element.value);await remove_array(a),await add_new_array(a,r),in_2d_view||update_camera_height(),e()})}function trim_array(e){return new Promise(async(t,a)=>{if(e>=arrays.length||e<0){display_error(`No array at index ${e}`);return}let r=arrays[e].numbers,n=0;for(let i=0;i<r.length;i++)for(let o=0;o<r.length;o++)0!==r[i][o]&&(n=Math.max(n,Math.max(i+1,o+1)));let l=Array(n);for(let s=0;s<n;s++){l[s]=Array(n);for(let c=0;c<n;c++)l[s][c]=r[s][c]}await remove_array(e),await add_new_array(e,l),in_2d_view||update_camera_height(),t()})}function remove_array(e,t=!1){return new Promise(async(a,r)=>{if(e>=arrays.length||e<0){display_error(`No array at index ${e}`);return}in_2d_view&&!t&&await Page.Animate.change_opacity(numbers_canvas_container_element,0,animation_time/5),await new Promise((t,a)=>{let r=[];arrays[e].cube_group.traverse(e=>{e.material&&e.material.forEach(e=>r.push(e))}),anime({targets:r,opacity:0,duration:animation_time/2,easing:"easeOutQuad",complete:t})});for(let n=0;n<arrays[e].cubes.length;n++)for(let i=0;i<arrays[e].cubes[n].length;i++)if(arrays[e].cubes[n][i])for(let o=0;o<arrays[e].cubes[n][i].length;o++)arrays[e].cubes[n][i][o]&&arrays[e].cubes[n][i][o].material.forEach(e=>e.dispose());scene.remove(arrays[e].cube_group),total_array_footprint-=arrays[e].footprint+1,arrays.splice(e,1);for(let l=e;l<arrays.length;l++)arrays[l].partial_footprint_sum=arrays[l].footprint,0!==l?(arrays[l].center_offset=arrays[l-1].center_offset+arrays[l-1].footprint/2+arrays[l].footprint/2+1,arrays[l].partial_footprint_sum+=arrays[l-1].partial_footprint_sum+1):arrays[l].center_offset=0,in_2d_view?anime({targets:arrays[l].cube_group.position,x:arrays[l].center_offset,y:0,z:0,duration:animation_time,easing:"easeInOutQuad"}):anime({targets:arrays[l].cube_group.position,x:arrays[l].center_offset,y:0,z:-arrays[l].center_offset,duration:animation_time,easing:"easeInOutQuad"});0===arrays.length||t||update_camera_height(!0),a()})}function add_cube(e,t,a,r,n=0,i=0,o=.4){let l=[new THREE.MeshStandardMaterial({map:cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:cube_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:cube_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:cube_texture_2,transparent:!0,opacity:0})];l.forEach(e=>e.color.setHSL(n,i,o));let s=new THREE.Mesh(cube_geometry,l);return e.cube_group.add(s),s.position.set(t-(e.footprint-1)/2,a,r-(e.footprint-1)/2),s}function add_floor(e,t,a,r=0,n=0,i=floor_lightness){let o=[new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0})];o.forEach(e=>e.color.setHSL(r,n,i));let l=new THREE.Mesh(floor_geometry,o);return e.cube_group.add(l),l.position.set(t-(e.footprint-1)/2,-.5005,a-(e.footprint-1)/2),l}function add_left_wall(e,t,a,r=0,n=0,i=floor_lightness){let o=[new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0})];o.forEach(e=>e.color.setHSL(r,n,i));let l=new THREE.Mesh(wall_left_geometry,o);return e.cube_group.add(l),l.position.set(-.5005-(e.footprint-1)/2,t,a-(e.footprint-1)/2),l}function add_right_wall(e,t,a,r=0,n=0,i=floor_lightness){let o=[new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0}),new THREE.MeshStandardMaterial({map:floor_texture_2,transparent:!0,opacity:0})];o.forEach(e=>e.color.setHSL(r,n,i));let l=new THREE.Mesh(wall_right_geometry,o);return e.cube_group.add(l),l.position.set(t-(e.footprint-1)/2,a,-.5005-(e.footprint-1)/2),l}function show_hex_view(){return new Promise(async(e,t)=>{if(currently_animating_camera){t();return}APPLET_VERSION&&Page.Animate.change_opacity(switch_view_button_element,0,Site.opacity_animation_time).then(()=>{switch_view_button_element.textContent="Show 2D View",Page.Animate.change_opacity(switch_view_button_element,1,Site.opacity_animation_time)}),currently_animating_camera=!0,in_2d_view&&await Page.Animate.change_opacity(numbers_canvas_container_element,0,animation_time/5),in_2d_view=!1,in_exact_hex_view=!0,rotation_y_velocity=0,last_rotation_y_velocities=[0,0,0,0],update_camera_height(!0),anime({targets:orthographic_camera.rotation,x:-.785398163,y:.615479709,z:.523598775,duration:animation_time,easing:"easeInOutQuad",complete(){currently_animating_camera=!1,e()}}),arrays.forEach(e=>{anime({targets:e.cube_group.rotation,y:0,duration:animation_time,easing:"easeInOutQuad"}),anime({targets:e.cube_group.position,x:e.center_offset,y:0,z:-e.center_offset,duration:animation_time,easing:"easeInOutQuad"})}),rotation_y=0})}function show_2d_view(){return new Promise(async(e,t)=>{if(currently_animating_camera||in_2d_view){t();return}APPLET_VERSION&&Page.Animate.change_opacity(switch_view_button_element,0,Site.opacity_animation_time).then(()=>{switch_view_button_element.textContent="Show 3D View",Page.Animate.change_opacity(switch_view_button_element,1,Site.opacity_animation_time)}),dimers_shown&&await hide_dimers(),currently_animating_camera=!0,in_2d_view=!0,in_exact_hex_view=!1,rotation_y_velocity=0,last_rotation_y_velocities=[0,0,0,0],update_camera_height(!0),anime({targets:orthographic_camera.rotation,x:-1.570796327,y:0,z:0,duration:animation_time,easing:"easeInOutQuad"}),arrays.forEach(e=>{anime({targets:e.cube_group.rotation,y:0,duration:animation_time,easing:"easeInOutQuad"}),anime({targets:e.cube_group.position,x:e.center_offset,y:0,z:0,duration:animation_time,easing:"easeInOutQuad"})}),setTimeout(()=>{draw_all_2d_view_text(),Page.Animate.change_opacity(numbers_canvas_container_element,1,animation_time/5).then(()=>{currently_animating_camera=!1,rotation_y=0,e()})},animation_time)})}function update_camera_height(e=!1){if(!e){if(currently_animating_camera)return;currently_animating_camera=!0}total_array_height=0;for(let t=0;t<arrays.length;t++)total_array_height=Math.max(total_array_height,arrays[t].height);total_array_size=Math.max(total_array_footprint,total_array_height);let a=(-arrays[0].footprint/2+arrays[arrays.length-1].center_offset+arrays[arrays.length-1].footprint/2)/2;hex_view_camera_pos=[total_array_size+a,total_array_size+total_array_height/3,total_array_size-a],_2d_view_camera_pos=[a,total_array_size+10,0],in_2d_view?(anime({targets:orthographic_camera.position,x:_2d_view_camera_pos[0],y:_2d_view_camera_pos[1],z:_2d_view_camera_pos[2],duration:animation_time,easing:"easeInOutQuad"}),anime({targets:orthographic_camera,left:-(total_array_footprint/2+.5),right:total_array_footprint/2+.5,top:total_array_footprint/2+.5,bottom:-(total_array_footprint/2+.5),duration:animation_time,easing:"easeInOutQuad",update:()=>orthographic_camera.updateProjectionMatrix(),complete(){orthographic_camera.updateProjectionMatrix(),currently_animating_camera=!1}}),setTimeout(()=>{draw_all_2d_view_text(),Page.Animate.change_opacity(numbers_canvas_container_element,1,animation_time/5)},animation_time)):(anime({targets:orthographic_camera.position,x:hex_view_camera_pos[0],y:hex_view_camera_pos[1],z:hex_view_camera_pos[2],duration:animation_time,easing:"easeInOutQuad"}),anime({targets:orthographic_camera,left:-total_array_size,right:total_array_size,top:total_array_size,bottom:-total_array_size,duration:animation_time,easing:"easeInOutQuad",update:()=>orthographic_camera.updateProjectionMatrix(),complete(){orthographic_camera.updateProjectionMatrix(),currently_animating_camera=!1}}))}function show_dimers(){return new Promise(async(e,t)=>{if(currently_animating_camera){t();return}dimers_shown=!0,APPLET_VERSION&&Page.Animate.change_opacity(show_dimers_button_element,0,Site.opacity_animation_time).then(()=>{show_dimers_button_element.textContent="Hide Dimers",Page.Animate.change_opacity(show_dimers_button_element,1,Site.opacity_animation_time)}),in_exact_hex_view||await show_hex_view(),currently_animating_camera=!0;let a=[];arrays.forEach(e=>{for(let t=0;t<e.footprint;t++)for(let r=0;r<e.footprint;r++){for(let n=0;n<e.cubes[t][r].length;n++)n<e.cubes[t][r].length-1&&a.push(e.cubes[t][r][n].material[2]),t<e.footprint-1&&e.cubes[t+1][r].length>=n+1&&a.push(e.cubes[t][r][n].material[4]),r<e.footprint-1&&e.cubes[t][r+1].length>=n+1&&a.push(e.cubes[t][r][n].material[0]),a.push(e.cubes[t][r][n].material[1]),a.push(e.cubes[t][r][n].material[3]),a.push(e.cubes[t][r][n].material[5]);0!==e.cubes[t][r].length&&a.push(e.floor[t][r].material[2])}}),a.forEach(e=>e.opacity=0),await new Promise((e,t)=>{anime({targets:[wilson_hidden.ctx,wilson_hidden_2.ctx,wilson_hidden_3.ctx,wilson_hidden_4.ctx],strokeStyle:"rgba(255, 255, 255, 1)",_alpha:0,duration:animation_time/2,easing:"easeOutQuad",complete:e,update(){wilson_hidden.ctx.clearRect(0,0,64,64),wilson_hidden.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden.ctx._alpha})`,wilson_hidden.ctx.fillRect(0,0,64,64),wilson_hidden.ctx.fillStyle=`rgba(128, 128, 128, ${wilson_hidden.ctx._alpha})`,wilson_hidden.ctx.fillRect(4,4,56,56),wilson_hidden.ctx.moveTo(42.7,21.3),wilson_hidden.ctx.lineTo(21.3,42.7),wilson_hidden.ctx.stroke(),cube_texture.needsUpdate=!0,wilson_hidden_2.ctx.clearRect(0,0,64,64),wilson_hidden_2.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_2.ctx._alpha})`,wilson_hidden_2.ctx.fillRect(0,0,64,64),wilson_hidden_2.ctx.fillStyle=`rgba(128, 128, 128, ${wilson_hidden_2.ctx._alpha})`,wilson_hidden_2.ctx.fillRect(4,4,56,56),wilson_hidden_2.ctx.moveTo(21.3,21.3),wilson_hidden_2.ctx.lineTo(42.7,42.7),wilson_hidden_2.ctx.stroke(),cube_texture_2.needsUpdate=!0,wilson_hidden_3.ctx.clearRect(0,0,64,64),wilson_hidden_3.ctx.fillStyle=`rgba(32, 32, 32, ${wilson_hidden_3.ctx._alpha})`,wilson_hidden_3.ctx.fillRect(0,0,64,64),wilson_hidden_3.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_3.ctx._alpha})`,wilson_hidden_3.ctx.fillRect(4,4,56,56),wilson_hidden_3.ctx.moveTo(42.7,21.3),wilson_hidden_3.ctx.lineTo(21.3,42.7),wilson_hidden_3.ctx.stroke(),floor_texture.needsUpdate=!0,wilson_hidden_4.ctx.clearRect(0,0,64,64),wilson_hidden_4.ctx.fillStyle=`rgba(32, 32, 32, ${wilson_hidden_4.ctx._alpha})`,wilson_hidden_4.ctx.fillRect(0,0,64,64),wilson_hidden_4.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_4.ctx._alpha})`,wilson_hidden_4.ctx.fillRect(4,4,56,56),wilson_hidden_4.ctx.moveTo(21.3,21.3),wilson_hidden_4.ctx.lineTo(42.7,42.7),wilson_hidden_4.ctx.stroke(),floor_texture_2.needsUpdate=!0}})}),currently_animating_camera=!1,e()})}function hide_dimers(){return new Promise(async(e,t)=>{if(currently_animating_camera){t();return}dimers_shown=!1,APPLET_VERSION&&Page.Animate.change_opacity(show_dimers_button_element,0,Site.opacity_animation_time).then(()=>{show_dimers_button_element.textContent="Show Dimers",Page.Animate.change_opacity(show_dimers_button_element,1,Site.opacity_animation_time)}),currently_animating_camera=!0;let a=[];arrays.forEach(e=>{for(let t=0;t<e.footprint;t++)for(let r=0;r<e.footprint;r++){for(let n=0;n<e.cubes[t][r].length;n++)n<e.cubes[t][r].length-1&&a.push(e.cubes[t][r][n].material[2]),t<e.footprint-1&&e.cubes[t+1][r].length>=n+1&&a.push(e.cubes[t][r][n].material[4]),r<e.footprint-1&&e.cubes[t][r+1].length>=n+1&&a.push(e.cubes[t][r][n].material[0]),a.push(e.cubes[t][r][n].material[1]),a.push(e.cubes[t][r][n].material[3]),a.push(e.cubes[t][r][n].material[5]);0!==e.cubes[t][r].length&&a.push(e.floor[t][r].material[2])}}),await new Promise((e,t)=>{anime({targets:[wilson_hidden.ctx,wilson_hidden_2.ctx,wilson_hidden_3.ctx,wilson_hidden_4.ctx],strokeStyle:"rgba(255, 255, 255, 0)",_alpha:1,duration:animation_time/2,easing:"easeOutQuad",complete:e,update(){wilson_hidden.ctx.clearRect(0,0,64,64),wilson_hidden.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden.ctx._alpha})`,wilson_hidden.ctx.fillRect(0,0,64,64),wilson_hidden.ctx.fillStyle=`rgba(128, 128, 128, ${wilson_hidden.ctx._alpha})`,wilson_hidden.ctx.fillRect(4,4,56,56),wilson_hidden.ctx.moveTo(42.7,21.3),wilson_hidden.ctx.lineTo(21.3,42.7),wilson_hidden.ctx.stroke(),cube_texture.needsUpdate=!0,wilson_hidden_2.ctx.clearRect(0,0,64,64),wilson_hidden_2.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_2.ctx._alpha})`,wilson_hidden_2.ctx.fillRect(0,0,64,64),wilson_hidden_2.ctx.fillStyle=`rgba(128, 128, 128, ${wilson_hidden_2.ctx._alpha})`,wilson_hidden_2.ctx.fillRect(4,4,56,56),wilson_hidden_2.ctx.moveTo(21.3,21.3),wilson_hidden_2.ctx.lineTo(42.7,42.7),wilson_hidden_2.ctx.stroke(),cube_texture_2.needsUpdate=!0,wilson_hidden_3.ctx.clearRect(0,0,64,64),wilson_hidden_3.ctx.fillStyle=`rgba(32, 32, 32, ${wilson_hidden_3.ctx._alpha})`,wilson_hidden_3.ctx.fillRect(0,0,64,64),wilson_hidden_3.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_3.ctx._alpha})`,wilson_hidden_3.ctx.fillRect(4,4,56,56),wilson_hidden_3.ctx.moveTo(42.7,21.3),wilson_hidden_3.ctx.lineTo(21.3,42.7),wilson_hidden_3.ctx.stroke(),floor_texture.needsUpdate=!0,wilson_hidden_4.ctx.clearRect(0,0,64,64),wilson_hidden_4.ctx.fillStyle=`rgba(32, 32, 32, ${wilson_hidden_4.ctx._alpha})`,wilson_hidden_4.ctx.fillRect(0,0,64,64),wilson_hidden_4.ctx.fillStyle=`rgba(64, 64, 64, ${wilson_hidden_4.ctx._alpha})`,wilson_hidden_4.ctx.fillRect(4,4,56,56),wilson_hidden_4.ctx.moveTo(21.3,21.3),wilson_hidden_4.ctx.lineTo(42.7,42.7),wilson_hidden_4.ctx.stroke(),floor_texture_2.needsUpdate=!0}})}),a.forEach(e=>e.opacity=1),currently_animating_camera=!1,e()})}function show_floor(e=1){return new Promise(async(t,a)=>{let r=[];arrays.forEach(e=>{e.floor.forEach(e=>{e.forEach(e=>{e.material.forEach(e=>r.push(e))})})}),anime({targets:r,opacity:e,duration:animation_time/2,easing:"easeOutQuad",complete(){t()}})})}function hide_floor(){return show_floor(0)}function recalculate_heights(e){e.height=0,e.numbers.forEach(t=>{t.forEach(t=>{t!==1/0&&(e.height=Math.max(t,e.height))})}),e.size=Math.max(e.footprint,e.height);let t=total_array_height;total_array_height=0,arrays.forEach(e=>total_array_height=Math.max(e.height,total_array_height)),total_array_size=Math.max(total_array_footprint,total_array_height),total_array_height!==t&&update_camera_height()}function draw_all_2d_view_text(){font_size=wilson_numbers.canvas_width/(total_array_footprint+1);let e=Math.max(`${total_array_height}`.length,2);wilson_numbers.ctx.font=`${font_size/e}px monospace`,wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),arrays.forEach(e=>{for(let t=0;t<e.footprint;t++)for(let a=0;a<e.footprint;a++)draw_single_cell_2d_view_text(e,t,a)})}function draw_single_cell_2d_view_text(e,t,a){let r=(total_array_footprint-e.footprint-1)/2,n=e.partial_footprint_sum-e.footprint;if(wilson_numbers.ctx.clearRect(font_size*(a+n+1),font_size*(t+r+1),font_size,font_size),e.numbers[t][a]!==1/0&&(0!==e.numbers[t][a]||0!==floor_lightness)){let i=wilson_numbers.ctx.measureText(e.numbers[t][a]);wilson_numbers.ctx.fillText(e.numbers[t][a],font_size*(a+n+1)+(font_size-i.width)/2,font_size*(t+r+1)+(font_size+i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)/2)}}function color_cubes(e,t,a){return new Promise((r,n)=>{if(0===t.length){r();return}let i=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(e=>i.push(e.color))}),i.forEach(e=>e.getRGB(e));let o=1,l=i.map(e=>wilson.utils.hsv_to_rgb(a,o,.8));anime({targets:i,r:(e,t)=>l[t][0]/255,g:(e,t)=>l[t][1]/255,b:(e,t)=>l[t][2]/255,duration:animation_time,delay:(e,t)=>Math.floor(t/6)*animation_time/10,easing:"easeOutQuad",update:()=>i.forEach(e=>e.setRGB(e.r,e.g,e.b)),complete:r})})}function uncolor_cubes(e,t){return new Promise((a,r)=>{let n=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(e=>n.push(e.color))}),n.forEach(e=>e.getHSL(e)),anime({targets:n,s:0,duration:animation_time,easing:"easeOutQuad",update:()=>n.forEach(e=>e.setHSL(e.h,e.s,.4)),complete:a})})}function raise_cubes(e,t,a){return new Promise((r,n)=>{let i=in_2d_view?0:animation_time,o=[];t.forEach(t=>{o.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot raise cubes from an infinite height")}),anime({targets:o,y:a,duration:i,easing:"easeInOutQuad",complete:r})})}function lower_cubes(e,t){return new Promise((a,r)=>{let n=in_2d_view?0:animation_time,i=[];t.forEach(t=>{i.push(e.cubes[t[0]][t[1]][t[2]].position),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot lower cubes onto an infinite height")}),anime({targets:i,y:(a,r)=>e.numbers[t[r][0]][t[r][1]],duration:n,easing:"easeInOutQuad",complete(){t.forEach(t=>{e.cubes[t[0]][t[1]][e.numbers[t[0]][t[1]]]=e.cubes[t[0]][t[1]][t[2]],e.cubes[t[0]][t[1]][t[2]]=null}),a()}})})}function move_cubes(e,t,a,r,n=!0){return new Promise((i,o)=>{let l=[];t.forEach(t=>{l.push(e.cubes[t[0]][t[1]][t[2]].position),a.cube_group.attach(e.cubes[t[0]][t[1]][t[2]]),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot move cubes from an infinite height")}),anime({targets:l,x:(e,t)=>r[t][1]-(a.footprint-1)/2,y:(e,t)=>r[t][2],z:(e,t)=>r[t][0]-(a.footprint-1)/2,duration:animation_time,easing:"easeInOutQuad",complete(){if(n){let o=t.map(t=>e.cubes[t[0]][t[1]][t[2]]);t.forEach(t=>e.cubes[t[0]][t[1]][t[2]]=null),r.forEach((e,r)=>{a.numbers[e[0]][e[1]]===1/0&&console.error("Cannot move cubes to an infinite height"),a.cubes[e[0]][e[1]][e[2]]&&!t.some(t=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])&&console.warn(`Moving a cube to a location that's already occupied: ${e}. This is probably not what you want to do.`),a.cubes[e[0]][e[1]][e[2]]=o[r]})}i()}})})}function reveal_cubes(e,t){return new Promise((a,r)=>{if(0===t.length){a();return}let n=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(e=>n.push(e)),e.numbers[t[0]][t[1]]===1/0&&console.error("Cannot reveal cubes at an infinite height")}),anime({targets:n,opacity:1,duration:animation_time/2,delay:(e,t)=>Math.floor(t/6)*animation_time/10,easing:"easeOutQuad",complete:a})})}function delete_cubes(e,t,a=!1,r=!1){return new Promise((n,i)=>{let o=[];t.forEach(t=>{e.cubes[t[0]][t[1]][t[2]].material.forEach(e=>o.push(e))}),anime({targets:o,opacity:0,duration:animation_time/2*!r,delay:(e,t)=>!a*Math.floor(t/6)*animation_time/10,easing:"easeOutQuad",complete(){o.forEach(e=>e.dispose()),t.forEach(t=>{e.cube_group.remove(e.cubes[t[0]][t[1]][t[2]]),e.cubes[t[0]][t[1]][t[2]]=null}),n()}})})}function delete_floor(e,t){return new Promise((a,r)=>{let n=[];t.forEach(t=>{e.floor[t[0]][t[1]].material.forEach(e=>n.push(e))}),anime({targets:n,opacity:0,duration:animation_time/2,easing:"easeOutQuad",complete(){n.forEach(e=>e.dispose()),t.forEach(t=>{e.cube_group.remove(e.floor[t[0]][t[1]]),e.cubes[t[0]][t[1]]=null}),a()}})})}function run_example(e){return new Promise(async(t,a)=>{if(1===e||2===e){for(;arrays.length>1;)await remove_array(1),await new Promise((e,t)=>setTimeout(e,animation_time/2));if(0===arrays.length)await add_new_array(arrays.length,parse_array(generate_random_plane_partition()));else if(!verify_pp(arrays[0].numbers)){await remove_array(0),await new Promise((e,t)=>setTimeout(e,animation_time/2));await add_new_array(arrays.length,parse_array(generate_random_plane_partition()))}1===e?(await run_algorithm("hillman_grassl",0),await new Promise((e,t)=>setTimeout(e,3*animation_time)),await run_algorithm("hillman_grassl_inverse",0)):(await run_algorithm("pak",0),await new Promise((e,t)=>setTimeout(e,3*animation_time)),await show_hex_view(),await new Promise((e,t)=>setTimeout(e,animation_time)),await run_algorithm("sulzgruber_inverse",0)),t()}else if(3===e){for(;arrays.length>0;)await remove_array(0),await new Promise((e,t)=>setTimeout(e,animation_time/2));await add_new_array(arrays.length,generate_random_tableau()),await show_2d_view(),await new Promise((e,t)=>setTimeout(e,animation_time)),await run_algorithm("rsk_inverse",0),await new Promise((e,t)=>setTimeout(e,3*animation_time)),await run_algorithm("rsk",0),t()}})}function run_algorithm(e,t,a=!1){return new Promise(async(r,n)=>{if(void 0===t&&(t=parseInt(algorithm_index_input_element.value||0)),!a&&currently_running_algorithm){n();return}currently_running_algorithm=!0;let i=algorithm_data[e],o=i.input_type.length;if(t>arrays.length-1||t<0){console.log(`No array at index ${t}!`),currently_running_algorithm=!1,n();return}if(o>1&&t>arrays.length-o){console.log(`No array at index ${t+o-1}! (This algorithm needs ${o} arrays)`),currently_running_algorithm=!1,n();return}for(let l=0;l<o;l++){let s=i.input_type[l];if("pp"===s&&!verify_pp(arrays[t+l].numbers)){console.log(`Array at index ${t+l} is not a plane partition!`),currently_running_algorithm=!1,n();return}if("ssyt"===s&&!verify_ssyt(arrays[t+l].numbers)){console.log(`Array at index ${t+l} is not an SSYT!`),currently_running_algorithm=!1,n();return}}if(o>1&&void 0!==i.same_shape&&i.same_shape){let c=Array(o),u=0;for(let h=0;h<o;h++)u=Math.max(u,arrays[t+h].numbers.length);for(let d=0;d<o;d++){c[d]=Array(u);for(let $=0;$<u;$++)c[d][$]=0;for(let m=0;m<arrays[t+d].numbers.length;m++){let f=0;for(;f<arrays[t+d].numbers[m].length&&0!==arrays[t+d].numbers[m][f];)f++;c[d][m]=f}}for(let g=1;g<o;g++)for(let w=0;w<u;w++)if(c[g][w]!==c[0][w]){display_error("Arrays are not the same shape!"),currently_running_algorithm=!1,n();return}}for(let p=0;p<o;p++){let y=[],b=arrays[t+p].numbers;for(let v=0;v<b.length;v++)for(let x=0;x<b.length;x++)if(b[v][x]!==1/0)for(let S=0;S<b[v][x];S++)y.push([v,x,S]);uncolor_cubes(arrays[t+p],y)}await i.method(t),a||(currently_running_algorithm=!1),r()})}function hillman_grassl(e){return new Promise(async(t,a)=>{let r=arrays[e],n=_.cloneDeep(r.numbers),i=Array(n.length);for(let o=0;o<n.length;o++){let l=0;for(;l<n.length&&n[l][o]===1/0;)l++;i[o]=l}let s=Array(n.length);for(let c=0;c<n.length;c++){let u=0;for(;u<n.length&&n[c][u]===1/0;)u++;s[c]=u}let h=[];for(;;){let d=n[0].length-1;for(;d>=0&&i[d]<n.length&&0===n[i[d]][d];)d--;if(d<0||i[d]===n.length)break;let $=i[d],m=d,f=[[$,m,n[$][m]-1]];for(;;){if($<n.length-1&&n[$+1][m]===n[$][m])$++;else if(m>0&&n[$][m-1]!==1/0)m--;else break;f.push([$,m,n[$][m]-1])}for(let g=0;g<f.length;g++)n[f[g][0]][f[g][1]]--;h.push(f)}let w=Array(n.length);for(let p=0;p<n.length;p++){w[p]=Array(n.length);for(let y=0;y<n.length;y++)w[p][y]=n[p][y]===1/0?1/0:0}let b=await add_new_array(e+1,w);await new Promise((e,t)=>setTimeout(e,animation_time));for(let v=0;v<h.length;v++){await color_cubes(r,h[v],v/h.length*6/7),await raise_cubes(r,h[v],r.height);for(let x=0;x<h[v].length;x++)r.numbers[h[v][x][0]][h[v][x][1]]--,in_2d_view&&draw_single_cell_2d_view_text(r,h[v][x][0],h[v][x][1]);recalculate_heights(r),await new Promise((e,t)=>setTimeout(e,animation_time/5));let S=[h[v][h[v].length-1][0],h[v][0][1]],E=[],k=b.height+1;for(let z=i[S[1]];z<=S[0];z++)E.push([z,S[1],k]);let M=E[E.length-1];for(let L=S[1]-1;L>=s[S[0]];L--)E.push([S[0],L,k]);await move_cubes(r,h[v],b,E),E=[];for(let q=S[0]-1;q>=i[S[1]];q--)E.push([q,S[1],k]);delete_cubes(b,E),E=[];for(let R=S[1]-1;R>=s[S[0]];R--)E.push([S[0],R,k]);delete_cubes(b,E),await lower_cubes(b,[M]),b.numbers[M[0]][M[1]]++,recalculate_heights(b),in_2d_view&&draw_single_cell_2d_view_text(b,M[0],M[1]),b.height=Math.max(b.height,b.numbers[M[0]][M[1]]),b.size=Math.max(b.size,b.height),await new Promise((e,t)=>setTimeout(e,animation_time))}await remove_array(e),t()})}function hillman_grassl_inverse(e){return new Promise(async(t,a)=>{let r=arrays[e],n=_.cloneDeep(r.numbers),i=[],o=Array(n.length);for(let l=0;l<n.length;l++){let s=0;for(;s<n.length&&n[s][l]===1/0;)s++;o[l]=s}let c=Array(n.length);for(let u=0;u<n.length;u++){let h=0;for(;h<n.length&&n[u][h]===1/0;)h++;c[u]=h}let d=Array(n.length);for(let $=0;$<n.length;$++){d[$]=Array(n.length);for(let m=0;m<n.length;m++)d[$][m]=n[$][m]===1/0?1/0:0}let f=_.cloneDeep(d),g=await add_new_array(e+1,d);for(let w=0;w<n.length;w++)for(let p=n.length-1;p>=o[w];p--)for(;0!==n[p][w];){let y=[],b=p,v=c[p];for(;b>=0;){let x=v;if(0!==b)for(;f[b][x]!==f[b-1][x]&&x<w;)x++;else x=w;for(let S=v;S<=x;S++)y.push([b,S,f[b][S]]);if(b-1>=o[x])b--,v=x;else break}for(let E=0;E<y.length;E++)f[y[E][0]][y[E][1]]++;i.push([y,[p,w,n[p][w]-1]]),n[p][w]--}await new Promise((e,t)=>setTimeout(e,animation_time/2));for(let k=0;k<i.length;k++){let z=k/i.length*6/7;await color_cubes(r,[i[k][1]],z);let M=i[k][1][0],L=i[k][1][1],q=r.size;for(let R=o[L];R<M;R++)r.cubes[R][L][q]=add_cube(r,L,q,R),r.cubes[R][L][q].material.forEach(e=>e.color.setHSL(z,1,.4));for(let T=c[M];T<L;T++)r.cubes[M][T][q]=add_cube(r,T,q,M),r.cubes[M][T][q].material.forEach(e=>e.color.setHSL(z,1,.4));await raise_cubes(r,[i[k][1]],q);let O=[];for(let A=M-1;A>=o[L];A--)O.push([A,L,q]);let Q=reveal_cubes(r,O);O=[];for(let C=L-1;C>=c[M];C--)O.push([M,C,q]);await Promise.all([Q,reveal_cubes(r,O)]),O=[];for(let I=c[M];I<L;I++)O.push([M,I,q]);O.push([M,L,r.numbers[M][L]-1]);for(let F=M-1;F>=o[L];F--)O.push([F,L,q]);let B=i[k][0],H=g.height+1;B.forEach(e=>e[2]=H),r.numbers[M][L]--,recalculate_heights(r),in_2d_view&&draw_single_cell_2d_view_text(r,M,L),await move_cubes(r,O,g,B),await lower_cubes(g,B),B.forEach(e=>{g.numbers[e[0]][e[1]]++}),recalculate_heights(g),in_2d_view&&B.forEach(e=>draw_single_cell_2d_view_text(g,e[0],e[1])),await new Promise((e,t)=>setTimeout(e,animation_time/2))}await remove_array(e),t()})}function pak(e){return new Promise(async(t,a)=>{let r=arrays[e],n=r.numbers;in_2d_view||await show_2d_view();let i=0,o=0;for(;i<r.footprint&&0!==r.numbers[i][r.footprint-1];)i++;for(;o<r.footprint&&0!==r.numbers[r.footprint-1][o];)o++;i=0,o=0;let l=0;for(let s=r.footprint-1-o;s>=0;s--)for(let c=r.footprint-1-i;c>=0;c--)n[s][c]!==1/0&&l++;let u=0;for(let h=0;h<r.footprint-o;h++)for(let d=0;d<r.footprint-i;d++){if(n[h][d]===1/0)continue;let $=[],m=0;for(;h+m<r.footprint&&d+m<r.footprint;)$.push([h+m,d+m,n[h+m][d+m]-1]),m++;m=$[0][0];let f=$[0][1],g=[];for(let w=n[m][f]-2;w>=0;w--)g.push([m,f,w]);color_cubes(r,g,u/l*6/7),g=[],$.forEach(e=>{e[2]>=0&&g.push(e)}),await color_cubes(r,g,u/l*6/7);let p=Array($.length);$.forEach((e,t)=>{let a=e[0],i=e[1],o=0,l=0;a<r.footprint-1&&(o=n[a+1][i]),i<r.footprint-1&&(l=n[a][i+1]),p[t]=Math.max(o,l),t>0?(o=n[a-1][i],l=n[a][i-1],p[t]+=Math.min(o,l)-n[a][i]):p[t]=n[a][i]-p[t]});for(let y=0;y<$.length;y++){if(m=$[y][0],f=$[y][1],p[y]>n[m][f]){let b=[];for(let v=n[m][f];v<p[y];v++)r.cubes[m][f][v]=add_cube(r,f,v,m),b.push([m,f,v]);in_2d_view?reveal_cubes(r,b):await reveal_cubes(r,b)}else if(p[y]<n[m][f]){let x=[];for(let S=n[m][f]-1;S>=p[y];S--)x.push([m,f,S]);in_2d_view?delete_cubes(r,x):await delete_cubes(r,x)}n[m][f]=p[y],in_2d_view&&draw_single_cell_2d_view_text(r,m,f)}let E=[];g.forEach((e,t)=>{0!==t&&e[2]<n[e[0]][e[1]]&&E.push(e)}),in_2d_view?uncolor_cubes(r,E):await uncolor_cubes(r,E),u++,recalculate_heights(r),0!==g.length&&await new Promise((e,t)=>setTimeout(e,animation_time))}update_camera_height(!0),t()})}function pak_inverse(e,t=0,a=0){return new Promise(async(r,n)=>{let i=arrays[e],o=i.numbers;in_2d_view||await show_2d_view();let l=0;for(let s=i.footprint-1-a;s>=0;s--)for(let c=i.footprint-1-t;c>=0;c--)o[s][c]!==1/0&&l++;let u=0;for(let h=i.footprint-1-a;h>=0;h--)for(let d=i.footprint-1-t;d>=0;d--){if(o[h][d]===1/0)continue;let $=[],m=0;for(;h+m<i.footprint&&d+m<i.footprint;)$.push([h+m,d+m,o[h+m][d+m]-1]),m++;m=$[0][0];let f=$[0][1],g=Array($.length),w=!1;if($.forEach((e,t)=>{let a=e[0],r=e[1],n=0,l=0;a<i.footprint-1&&(n=o[a+1][r]),r<i.footprint-1&&(l=o[a][r+1]),g[t]=Math.max(n,l),t>0?(n=o[a-1][r],l=o[a][r-1],g[t]+=Math.min(n,l)-o[a][r]):g[t]+=o[a][r],w||g[t]===o[a][r]||(w=!0)}),0!==o[m][f]){let p=[];for(let y=o[m][f]-1;y>=0;y--)p.push([m,f,y]);color_cubes(i,p,u/l*6/7)}else if(0!==g[0])i.cubes[m][f][0]=add_cube(i,f,0,m,u/l*6/7,1,.4),o[m][f]=1,reveal_cubes(i,[[m,f,0]]);else if(!w){u++;continue}await new Promise((e,t)=>setTimeout(e,animation_time));for(let b=0;b<$.length;b++){if(m=$[b][0],f=$[b][1],g[b]>o[m][f]){let v=[];for(let x=o[m][f];x<g[b];x++)i.cubes[m][f][x]=add_cube(i,f,x,m,u/l*6/7,1,.4),v.push([m,f,x]);in_2d_view?reveal_cubes(i,v):await reveal_cubes(i,v)}else if(g[b]<o[m][f]){let S=[];for(let E=o[m][f]-1;E>=g[b];E--)S.push([m,f,E]);in_2d_view?delete_cubes(i,S):await delete_cubes(i,S)}o[m][f]=g[b],in_2d_view&&draw_single_cell_2d_view_text(i,m,f)}u++,recalculate_heights(i),await new Promise((e,t)=>setTimeout(e,animation_time))}update_camera_height(!0),r()})}function sulzgruber(e){return new Promise(async(t,a)=>{let r=arrays[e],n=_.cloneDeep(r.numbers),i=Array(n.length);for(let o=0;o<n.length;o++){let l=0;for(;l<n.length&&n[l][o]===1/0;)l++;i[o]=l}let s=Array(n.length);for(let c=0;c<n.length;c++){let u=0;for(;u<n.length&&n[c][u]===1/0;)u++;s[c]=u}let h={},d={};for(let $=0;$<n.length;$++)d[-$]=[$,0];for(let m=1;m<n.length;m++)d[m]=[0,m];for(let f=-n.length+1;f<n.length;f++){let g=d[f][0],w=d[f][1];for(;g<n.length&&w<n.length&&n[g][w]===1/0;)g++,w++;if(d[f]=[g,w],g===n.length||w===n.length){h[f]=-1;continue}let p=0===w||n[g][w-1]===1/0,y=0===g||n[g-1][w]===1/0;p&&y?h[f]=0:p?h[f]=3:y?h[f]=2:h[f]=1}let b=[];for(let v=-n.length+1;v<n.length;v++){if(1===h[v]||3===h[v])continue;let x=d[v][0],S=d[v][1];if(0!==n[x][S])for(;;){let E=!1;for(;x<n.length&&S<n.length&&0!==n[x][S];){if((S<n.length-1&&n[x][S]>n[x][S+1]||S===n.length-1&&n[x][S]>0)&&(0===h[v]||2===h[v]&&(x<n.length-1&&n[x][S]>n[x+1][S]||x===n.length-1&&n[x][S]>0))){E=!0;break}x++,S++}if(!E)break;let k=x,z=S,M=[[k,z,n[k][z]-1]];for(;;){let L=z-k;if(k<n.length-1&&n[k][z]===n[k+1][z]&&(0===h[L]||3===h[L]))k++;else if(z>s[k]&&(k===n.length-1||k<n.length-1&&n[k][z]>n[k+1][z]))z--;else break;M.push([k,z,n[k][z]-1])}M.forEach(e=>n[e[0]][e[1]]--),b.push(M)}}let q=Array(n.length);for(let R=0;R<n.length;R++){q[R]=Array(n.length);for(let T=0;T<n.length;T++)q[R][T]=n[R][T]===1/0?1/0:0}let O=await add_new_array(e+1,q);await new Promise((e,t)=>setTimeout(e,animation_time));for(let A=0;A<b.length;A++){await color_cubes(r,b[A],A/b.length*6/7),await raise_cubes(r,b[A],r.height+1),b[A].forEach(e=>{r.numbers[e[0]][e[1]]--,in_2d_view&&draw_single_cell_2d_view_text(r,e[0],e[1])}),recalculate_heights(r),await new Promise((e,t)=>setTimeout(e,animation_time/5));let Q=b[A][b[A].length-1][0],C=d[b[A][b[A].length-1][1]-Q+b[A].length-1][1],I=[],F=Math.max(r.height+1,O.height+1);for(let B=i[C];B<=Q;B++)I.push([B,C,F]);for(let H=C-1;H>=s[Q];H--)I.push([Q,H,F]);await move_cubes(r,b[A],O,I),I=[];for(let D=Q-1;D>=i[C];D--)I.push([D,C,F]);delete_cubes(O,I),I=[];for(let j=C-1;j>=s[Q];j--)I.push([Q,j,F]);delete_cubes(O,I),await lower_cubes(O,[[Q,C,F]]),O.numbers[Q][C]++,in_2d_view&&draw_single_cell_2d_view_text(O,Q,C),recalculate_heights(O),await new Promise((e,t)=>setTimeout(e,animation_time))}await remove_array(e),t()})}function sulzgruber_inverse(e){return new Promise(async(t,a)=>{let r=arrays[e],n=r.numbers,i=Array(n.length);for(let o=0;o<n.length;o++){let l=0;for(;l<n.length&&n[l][o]===1/0;)l++;i[o]=l}let s=Array(n.length);for(let c=0;c<n.length;c++){let u=0;for(;u<n.length&&n[c][u]===1/0;)u++;s[c]=u}let h={};for(let d=0;d<n.length;d++)h[-d]=[d,0];for(let $=1;$<n.length;$++)h[$]=[0,$];for(let m=-n.length+1;m<n.length;m++){let f=h[m][0],g=h[m][1];for(;f<n.length&&g<n.length&&n[f][g]===1/0;)f++,g++;h[m]=[f,g]}let w=0,p=Array(n.length);for(let y=0;y<n.length;y++){p[y]=Array(n.length);for(let b=0;b<n.length;b++)n[y][b]===1/0?p[y][b]=1/0:(p[y][b]=0,w+=n[y][b])}let v=await add_new_array(e+1,p);v.numbers;let x=0;for(let S=n.length-1;S>=0;S--)for(let E=n.length-1;E>=0;E--)if(n[E][S]!==1/0)for(;0!==n[E][S];){let k=x/w*6/7,z=Math.max(r.size+1,v.size+1);await color_cubes(r,[[E,S,n[E][S]-1]],k),await raise_cubes(r,[[E,S,n[E][S]-1]],z);let M=E,L=S;for(let q=i[L];q<M;q++)r.cubes[q][L][z]=add_cube(r,L,z,q),r.cubes[q][L][z].material.forEach(e=>e.color.setHSL(k,1,.4));for(let R=s[M];R<L;R++)r.cubes[M][R][z]=add_cube(r,R,z,M),r.cubes[M][R][z].material.forEach(e=>e.color.setHSL(k,1,.4));let T=[];for(let O=M-1;O>=i[L];O--)T.push([O,L,z]);let A=reveal_cubes(r,T);T=[];for(let Q=L-1;Q>=s[M];Q--)T.push([M,Q,z]);await Promise.all([A,reveal_cubes(r,T)]),T=[];for(let C=s[M];C<L;C++)T.push([M,C,z]);T.push([M,L,r.numbers[M][L]-1]);for(let I=M-1;I>=i[L];I--)T.push([I,L,z]);let F=s[M]-M,B=F+T.length-1,H=[];for(let D=F;D<=B;D++)H.push(_.clone(h[D]));n[M][L]--,recalculate_heights(r),in_2d_view&&draw_single_cell_2d_view_text(r,M,L),await move_cubes(r,T,v,H);let j=0,U=v.numbers[H[0][0]][H[0][1]];for(;;){let N=j;for(;N<H.length&&H[N][0]===H[j][0];)N++;T=H.slice(j,N);let P=!0;for(let G=0;G<T.length;G++)if(v.numbers[T[G][0]][T[G][1]]!==U){P=!1;break}if(P)await lower_cubes(v,T),T.forEach(e=>v.numbers[e[0]][e[1]]++),recalculate_heights(v),in_2d_view&&T.forEach(e=>{draw_single_cell_2d_view_text(v,e[0],e[1])}),j=N;else{let W=_.cloneDeep(H.slice(j));for(let Y=j;Y<H.length;Y++)if(H[Y][0]++,H[Y][1]++,H[Y][0]>v.footprint||H[Y][1]>v.footprint){console.error("Insertion failed!");return}await move_cubes(v,W,v,H.slice(j)),U=v.numbers[H[j][0]][H[j][1]]}if(j===H.length)break}x++,await new Promise((e,t)=>setTimeout(e,animation_time/2))}await remove_array(e),t()})}function rsk(e){return new Promise(async(t,a)=>{let r=arrays[e],n=arrays[e+1],i=r.numbers,o=n.numbers,l=0,s=0;for(let c=0;c<i.length;c++)for(let u=0;u<i.length;u++){if(i[c][u]===1/0||o[c][u]===1/0){display_error("The SSYT contain infinite values, which is not allowed in RSK!"),currently_running_algorithm=!1,a();return}0!==i[c][u]&&s++,l=Math.max(Math.max(l,i[c][u]),o[c][u])}if(0===l){display_error("The SSYT are empty!"),currently_running_algorithm=!1,a();return}let h=Array(l);for(let d=0;d<l;d++){h[d]=Array(l);for(let $=0;$<l;$++)h[d][$]=0}let m=await add_new_array(e+2,h),f=0;for(;0!==o[0][0];){let g=f/s*6/7,w=0,p=0,y=0;for(let b=0;b<o.length;b++){let v=o.length-1;for(;v>=0&&0===o[b][v];)v--;v>=0&&(w=Math.max(w,o[b][v]))}for(let x=0;x<o.length;x++){let S=o.length-1;for(;S>=0&&0===o[x][S];)S--;if(o[x][S]===w){p=x,y=S;break}}let E=[],k=[],z=[],M=[],L=[],q=[],R=p,T=y,O=i[R][T],A=o[R][T],Q=[[R,T]];for(;0!==R;){let C=i.length-1;for(;0===i[R-1][C]||O<=i[R-1][C];)C--;for(let I=0;I<O;I++)E.push([R,T,I]),k.push([R-1,C,I]);R--,T=C,O=i[R][T],Q.push([R,T])}let F=m.height+1;for(let B=0;B<O;B++)z.push([R,T,B]),M.push([A-1,B,F]);for(let H=0;H<A-1;H++)L.push([p,y,H]),q.push([H,O-1,F]);color_cubes(n,L.concat([[p,y,A-1]]),g),color_cubes(r,E,g),await color_cubes(r,z,g),o[p][y]=0;for(let D=Q.length-1;D>0;D--)i[Q[D][0]][Q[D][1]]=i[Q[D-1][0]][Q[D-1][1]];if(i[p][y]=0,in_2d_view){draw_single_cell_2d_view_text(r,p,y);for(let j=Q.length-1;j>0;j--)draw_single_cell_2d_view_text(r,Q[j][0],Q[j][1]);draw_single_cell_2d_view_text(n,p,y)}move_cubes(n,L,m,q),move_cubes(r,z,m,M),move_cubes(r,E,r,k),await move_cubes(n,[[p,y,A-1]],m,[[A-1,O-1,F]],!1),uncolor_cubes(r,k),m.cube_group.remove(n.cubes[p][y][A-1]),delete_cubes(n,[[p,y,A-1]],!0,!0),M.reverse(),q.reverse(),delete_cubes(m,M.slice(1)),delete_cubes(m,q),await lower_cubes(m,[[A-1,O-1,F]]),h[A-1][O-1]++,in_2d_view&&draw_single_cell_2d_view_text(m,A-1,O-1),recalculate_heights(m),f++,await new Promise((e,t)=>setTimeout(e,animation_time/2))}await remove_array(e),await new Promise((e,t)=>setTimeout(e,animation_time)),await remove_array(e),t()})}function rsk_inverse(e){return new Promise(async(t,a)=>{let r=arrays[e],n=_.cloneDeep(r.numbers),i=0;n.forEach(e=>e.forEach(e=>i+=e));let o=Array(i),l=Array(i);for(let s=0;s<i;s++){o[s]=Array(i),l[s]=Array(i);for(let c=0;c<i;c++)o[s][c]=0,l[s][c]=0}let u=Array(n.length);for(let h=0;h<n.length;h++)u[h]=0;let d=0,$=[],m=[],f=[];for(let g=0;g<n.length;g++)for(let w=0;w<n.length;w++)for(;0!==n[g][w];){n[g][w]--;let p=w+1,y=0,b=0,v=[];for(;;){for(b=u[y];0!==b&&o[y][b-1]>p;)b--;if(b===u[y]){o[y][b]=p,u[y]++,0===b&&d++,v.push([y,b]);break}let x=o[y][b];o[y][b]=p,p=x,v.push([y,b]),y++}$.push(v),m.push([y,b]),f.push([g,w]),l[y][b]=g+1}let S=Math.max(u[0],d);o=Array(S),l=Array(S);for(let E=0;E<S;E++){o[E]=Array(S),l[E]=Array(S);for(let k=0;k<S;k++)o[E][k]=0,l[E][k]=0}let z=await add_new_array(e+1,o);await new Promise((e,t)=>setTimeout(e,animation_time/2));let M=await add_new_array(e+2,l);await new Promise((e,t)=>setTimeout(e,animation_time/2));let L=0;for(let q=0;q<f.length;q++){let R=f[q][0],T=f[q][1],O=r.height+1,A=L/i*6/7;for(let Q=T;Q>=0;Q--)r.cubes[R][Q][O]=add_cube(r,Q,O,R),r.cubes[R][Q][O].material.forEach(e=>e.color.setHSL(A,1,.4));for(let C=R-1;C>=0;C--)r.cubes[C][T][O]=add_cube(r,T,O,C),r.cubes[C][T][O].material.forEach(e=>e.color.setHSL(A,1,.4));r.cubes[R][T][O+1]=add_cube(r,T,O,R),r.cubes[R][T][O+1].material.forEach(e=>e.color.setHSL(A,1,.4)),await color_cubes(r,[[R,T,r.numbers[R][T]-1]],A),await raise_cubes(r,[[R,T,r.numbers[R][T]-1]],O);let I=reveal_cubes(r,[[R,T,O+1]]),F=[];for(let B=T-1;B>=0;B--)F.push([R,B,O]);let H=reveal_cubes(r,F);F=[];for(let D=R-1;D>=0;D--)F.push([D,T,O]);await Promise.all([I,H,reveal_cubes(r,F)]);let j=$[L],U=[],N=[],P=[[R,T,r.numbers[R][T]-1]],G=[[j[0][0],j[0][1],T]],W=[[R,T,O+1]],Y=[[m[L][0],m[L][1],R]];for(let V=T-1;V>=0;V--)P.push([R,V,O]),G.push([j[0][0],j[0][1],V]);for(let K=0;K<j.length-1;K++)for(let J=0;J<o[j[K][0]][j[K][1]];J++)U.push([j[K][0],j[K][1],J]),N.push([j[K+1][0],j[K+1][1],J]);for(let X=R-1;X>=0;X--)W.push([X,T,O]),Y.push([m[L][0],m[L][1],X]);await color_cubes(z,U,A);for(let Z=j.length-1;Z>0;Z--)o[j[Z][0]][j[Z][1]]=o[j[Z-1][0]][j[Z-1][1]];0!==j.length&&(o[j[0][0]][j[0][1]]=0),in_2d_view&&draw_all_2d_view_text(),0!==U.length&&await move_cubes(z,U,z,N),r.numbers[R][T]--,in_2d_view&&draw_all_2d_view_text(),move_cubes(r,P,z,G),await move_cubes(r,W,M,Y),o[j[0][0]][j[0][1]]=T+1,l[m[L][0]][m[L][1]]=R+1,in_2d_view&&draw_all_2d_view_text(),recalculate_heights(r),recalculate_heights(z),recalculate_heights(M),L++,await new Promise((e,t)=>setTimeout(e,animation_time/2))}await remove_array(e),t()})}function godar_1(e){return new Promise(async(t,a)=>{let r=arrays[e],n=r.numbers,i=Array(2*n.length),o=Array(2*n.length);for(let l=0;l<n.length;l++){let s=0;for(;s<n.length&&n[l][s]===1/0;)s++;for(i[l]=s,s=0;s<n.length&&n[s][l]===1/0;)s++;o[l]=s}for(let c=n.length;c<2*n.length;c++)i[c]=0,o[c]=0;let u=Math.max(i[0],o[0]),h=Array(n.length);for(let d=0;d<n.length;d++){h[d]=Array(n.length);for(let $=0;$<n.length;$++)n[d][$]===1/0?h[d][$]=100:h[d][$]=n[d][$]}await add_new_array(e+1,h),await new Promise((e,t)=>setTimeout(e,animation_time/2)),await remove_array(e),await new Promise((e,t)=>setTimeout(e,animation_time/2)),n=(r=arrays[e]).numbers;let m=0,f=0;for(;m<n.length&&0!==n[m][n.length-1];)m++;for(;f<n.length&&0!==n[n.length-1][f];)f++;await run_algorithm("pak",e,!0),await new Promise((e,t)=>setTimeout(e,2*animation_time)),n=(r=arrays[e]).numbers;let g=Math.max(m,f),w=Array(n.length-g+1),p=[];for(let y=0;y<w.length-1;y++){w[y]=Array(w.length);for(let b=0;b<w.length-1;b++){w[y][b]=n[y][b];for(let v=0;v<n[y][b];v++)p.push([y,b,v]);n[y][b]=0}w[y][w.length-1]=0}w[w.length-1]=Array(w.length);for(let x=0;x<w.length;x++)w[w.length-1][x]=0;delete_cubes(r,p,!0,!0),await add_new_array(e,w),await new Promise((e,t)=>setTimeout(e,animation_time/2)),await run_algorithm("pak_inverse",e,!0),await new Promise((e,t)=>setTimeout(e,2*animation_time));let S=2*n.length-i[n.length-1]-o[n.length-1],E=i[0]+o[0],k=Array(4*n.length),z=Array(E),M=Array(4*n.length);for(let L=0;L<4*n.length;L++)k[L]=[];for(let q=0;q<E;q++)z[q]=[];for(let R=0;R<4*n.length;R++)M[R]=[];let T=1;for(let O=0;O<2*n.length;O++)for(let A=0;A<2*n.length;A++)A>=i[O]?k[O+A+1-i[O]-o[A]].push([O,A]):z[i[O]+o[A]-O-A-1].unshift([u-O-1,u-A-1]),M[O+A+1].push([O,A]);let Q=Array(2*n.length);for(let C=0;C<2*n.length;C++)Q[C]=Array(2*n.length);for(let I=1;I<S;I++){let F=[];for(let B=0;B<k[I].length;B++){let H=k[I][B][0],D=k[I][B][1];if(H<n.length-f&&D<n.length-m)for(let j=0;j<arrays[e].numbers[H][D];j++)F.push([H,D,j]);B<M[I].length?(Q[H][D]=[1,M[I][B]],H<n.length&&D<n.length&&arrays[e].numbers[H][D]>0&&(T=Math.max(Math.max(T,M[I][B][0]+1),M[I][B][1]+1))):Q[H][D]=[0,z[I][B-M[I].length]]}0!==F.length&&color_cubes(arrays[e],F,(I-1)/(S-1)*6/7)}await new Promise((e,t)=>setTimeout(e,3*animation_time));let U=Array(u);for(let N=0;N<u;N++){U[N]=Array(u);for(let P=0;P<u;P++)P<u-i[u-N-1]?U[N][P]=1/0:U[N][P]=0}let G=null;u>0&&(G=await add_new_array(e+1,U),await new Promise((e,t)=>setTimeout(e,animation_time/2)));let W=Array(T);for(let Y=0;Y<T;Y++){W[Y]=Array(T);for(let V=0;V<T;V++)W[Y][V]=0}let K=await add_new_array(e+2,W);for(let J=0;J<n.length-f;J++)for(let X=i[J];X<n.length-m;X++)if(arrays[e].numbers[J][X]>0){let Z=[],ee=[],et=Q[J][X][1][0],ea=Q[J][X][1][1];for(let er=0;er<arrays[e].numbers[J][X];er++)Z.push([J,X,er]),ee.push([et,ea,er]);0===Q[J][X][0]?(await move_cubes(arrays[e],Z,G,ee),U[et][ea]=arrays[e].numbers[J][X],arrays[e].numbers[J][X]=0):(await move_cubes(arrays[e],Z,K,ee),W[et][ea]=arrays[e].numbers[J][X],arrays[e].numbers[J][X]=0),in_2d_view&&draw_all_2d_view_text()}await new Promise((e,t)=>setTimeout(e,3*animation_time)),await run_algorithm("pak_inverse",e,!0),u>0&&await run_algorithm("hillman_grassl_inverse",e+1,!0),t()})}function godar_1_inverse(e){return new Promise(async(t,a)=>{let r=arrays[e+1].numbers,n=arrays[e].numbers,i=Array(r.length+2*n.length),o=Array(r.length+2*n.length);for(let l=0;l<r.length+2*n.length;l++)i[l]=0,o[l]=0;for(let s=0;s<n.length;s++){let c=n.length-1;for(;c>=0&&n[s][c]!==1/0;)c--;for(i[n.length-s-1]=n.length-c-1,c=n.length-1;c>=0&&n[c][s]!==1/0;)c--;o[n.length-s-1]=n.length-c-1}await run_algorithm("hillman_grassl",e,!0),await new Promise((e,t)=>setTimeout(e,animation_time/2)),await run_algorithm("hillman_grassl",e+1,!0),await new Promise((e,t)=>setTimeout(e,3*animation_time));let u=[],h=arrays[e].numbers;for(let d=0;d<h.length;d++)for(let $=0;$<h.length;$++)if(h[d][$]!==1/0)for(let m=0;m<h[d][$];m++)u.push([d,$,m]);uncolor_cubes(arrays[e],u),u=[],h=arrays[e+1].numbers;for(let f=0;f<h.length;f++)for(let g=0;g<h.length;g++)if(h[f][g]!==1/0)for(let w=0;w<h[f][g];w++)u.push([f,g,w]);await uncolor_cubes(arrays[e+1],u);let p=Math.max(i[0],o[0])+2*r.length-1,y=2*p,b=i[0]+o[0],v=2*r.length,x=Array(y),S=Array(b),E=Array(v);for(let k=0;k<y;k++)x[k]=[];for(let z=0;z<b;z++)S[z]=[];for(let M=0;M<v;M++){E[M]=Array(M);for(let L=0;L<M;L++)E[M][L]=-1}for(;i.length<p;)i.push(0);for(;o.length<p;)o.push(0);for(let q=0;q<p;q++)for(let R=0;R<p;R++)R>=i[q]?x[q+R+1-i[q]-o[R]].push([q,R]):S[i[q]+o[R]-q-R-1].unshift([n.length-q-1,n.length-R-1]),q<r.length&&R<r.length&&(E[q+R+1][q]=[q,R]);let T=Array(r.length);for(let O=0;O<r.length;O++)T[O]=Array(r.length);let A=Array(n.length);for(let Q=0;Q<n.length;Q++)A[Q]=Array(n.length);p=1;for(let C=1;C<b;C++){let I=[];for(let F=0;F<S[C].length;F++){let B=S[C][F][0],H=S[C][F][1];for(let D=0;D<arrays[e].numbers[B][H];D++)I.push([B,H,D]);A[B][H]=x[C][F+E[C].length],0!==arrays[e].numbers[B][H]&&(p=Math.max(Math.max(p,A[B][H][0]+1),A[B][H][1]+1))}0!==I.length&&color_cubes(arrays[e],I,(C-1)/(b-1)*6/7)}for(let j=1;j<v;j++){let U=[];for(let N=0;N<E[j].length;N++){if(-1===E[j][N])continue;let P=E[j][N][0],G=E[j][N][1];for(let W=0;W<arrays[e+1].numbers[P][G];W++)U.push([P,G,W]);T[P][G]=x[j][N],0!==arrays[e+1].numbers[P][G]&&(p=Math.max(Math.max(p,T[P][G][0]+1),T[P][G][1]+1))}0!==U.length&&color_cubes(arrays[e+1],U,(j-1)/(v-1)*6/7)}await new Promise((e,t)=>setTimeout(e,3*animation_time));let Y=Array(p);for(let V=0;V<p;V++){Y[V]=Array(p);for(let K=0;K<p;K++)K<i[V]?Y[V][K]=1/0:Y[V][K]=0}let J=await add_new_array(e+2,Y);await new Promise((e,t)=>setTimeout(e,animation_time/2));for(let X=0;X<n.length;X++)for(let Z=0;Z<n.length;Z++)if(arrays[e].numbers[X][Z]>0&&arrays[e].numbers[X][Z]!==1/0){let ee=[],et=[],ea=A[X][Z][0],er=A[X][Z][1];for(let en=0;en<arrays[e].numbers[X][Z];en++)ee.push([X,Z,en]),et.push([ea,er,en]);await move_cubes(arrays[e],ee,J,et),Y[ea][er]=arrays[e].numbers[X][Z],arrays[e].numbers[X][Z]=0,in_2d_view&&draw_all_2d_view_text()}for(let ei=0;ei<r.length;ei++)for(let eo=0;eo<r.length;eo++)if(arrays[e+1].numbers[ei][eo]>0&&arrays[e+1].numbers[ei][eo]!==1/0){let el=[],e8=[],es=T[ei][eo][0],ec=T[ei][eo][1];for(let eu=0;eu<arrays[e+1].numbers[ei][eo];eu++)el.push([ei,eo,eu]),e8.push([es,ec,eu]);await move_cubes(arrays[e+1],el,J,e8),Y[es][ec]=arrays[e+1].numbers[ei][eo],arrays[e+1].numbers[ei][eo]=0,in_2d_view&&draw_all_2d_view_text()}await remove_array(e),await new Promise((e,t)=>setTimeout(e,animation_time/2)),await remove_array(e),await new Promise((e,t)=>setTimeout(e,3*animation_time)),await run_algorithm("hillman_grassl_inverse",e,!0),await new Promise((e,t)=>setTimeout(e,animation_time)),t()})}function draw_boundary(e,t){return new Promise(async(a,r)=>{in_2d_view||await show_2d_view(),"0"!==numbers_canvas_container_element.style.opacity&&await Page.Animate.change_opacity(numbers_canvas_container_element,0,animation_time/3),wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height);let n=arrays[e],i=n.numbers,o=[],l=0,s=0;for(let c=n.footprint-1;c>=0;c--){for(;s<n.footprint&&i[c][s]===1/0;){if(c===n.footprint-1||i[c+1][s]!==1/0){let u=l%t/t,h=wilson.utils.hsv_to_rgb(u,1,1);o.push([c,s,!0,`rgba(${h[0]}, ${h[1]}, ${h[2]}, `]),l++}s++}let d=l%t/t,$=wilson.utils.hsv_to_rgb(d,1,1);o.push([c,s,!1,`rgba(${$[0]}, ${$[1]}, ${$[2]}, `]),l++}for(;s<n.footprint;){if(-1==n.footprint-1||i[0][s]!==1/0){let m=l%t/t,f=wilson.utils.hsv_to_rgb(m,1,1);o.push([-1,s,!0,`rgba(${f[0]}, ${f[1]}, ${f[2]}, `]),l++}s++}o.forEach(e=>{draw_boundary_rect(n,e[0],e[1],e[2],`${e[3]} 1)`)}),await Page.Animate.change_opacity(numbers_canvas_container_element,1,animation_time/3),wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",a(o)})}function draw_n_quotient(e,t,a,r){return new Promise(async(n,i)=>{let o=arrays[e],l={t:1};await new Promise((e,n)=>{anime({targets:l,t:0,duration:animation_time,easing:"easeOutQuad",complete(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,r)=>{draw_boundary_rect(o,e[0],e[1],e[2],`${e[3]} ${r%t===a?1:0})`)}),e()},update(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,r)=>{let n=r%t===a?1:l.t;draw_boundary_rect(o,e[0],e[1],e[2],`${e[3]} ${n})`)})}})});let s=(r=r.filter((e,r)=>r%t===a)).filter(e=>!e[2]).length,c=Array(r.length),u=s-1,h=0;r.forEach((e,t)=>{c[t]=[u,h],e[2]?h++:u--}),l.t=0,await new Promise((e,t)=>{anime({targets:l,t:1,duration:animation_time,easing:"easeInOutQuad",complete(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,t)=>{draw_boundary_rect(o,c[t][0],c[t][1],e[2],`${e[3]} 1)`)}),e()},update(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,t)=>{draw_boundary_rect(o,(1-l.t)*e[0]+l.t*c[t][0],(1-l.t)*e[1]+l.t*c[t][1],e[2],`${e[3]} 1)`)})}})});let d=[];c.forEach((e,t)=>{if(!r[t][2]){for(let a=e[1];a<o.footprint;a++)if(o.numbers[e[0]][a]===1/0)for(let n=0;n<100;n++)d.push([e[0],a,n])}}),delete_cubes(o,d,!0);let $=[];for(let m=o.footprint-1;m>c[0][0];m--)$.push([m,0,!1]);for(let f=c[c.length-1][1];f<o.footprint;f++)$.push([-1,f,!0]);l.t=0,await new Promise((e,t)=>{anime({targets:l,t:1,duration:animation_time/2,easing:"easeInQuad",complete(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,t)=>{draw_boundary_rect(o,c[t][0],c[t][1],e[2],`${e[3]} 1)`)}),$.forEach((e,t)=>{draw_boundary_rect(o,e[0],e[1],e[2],`${r[0][3]} 1)`)}),e()},update(){wilson_numbers.ctx.clearRect(0,0,wilson_numbers.canvas_width,wilson_numbers.canvas_height),r.forEach((e,t)=>{draw_boundary_rect(o,c[t][0],c[t][1],e[2],`${e[3]} 1)`)}),$.forEach((e,t)=>{draw_boundary_rect(o,e[0],e[1],e[2],`${r[0][3]} ${l.t})`)})}})}),wilson_numbers.ctx.fillStyle="rgb(255, 255, 255)",n()})}function draw_boundary_rect(e,t,a,r,n){let i=(total_array_footprint-e.footprint-1)/2,o=e.partial_footprint_sum-e.footprint;wilson_numbers.ctx.fillStyle=n,r?wilson_numbers.ctx.fillRect(wilson_numbers.canvas_width*(a+o+1)/(total_array_footprint+1),wilson_numbers.canvas_height*(t+i+1+15/16)/(total_array_footprint+1)+1,wilson_numbers.canvas_width/(total_array_footprint+1),wilson_numbers.canvas_height*(1/16)/(total_array_footprint+1)):wilson_numbers.ctx.fillRect(wilson_numbers.canvas_width*(a+o+15/16)/(total_array_footprint+1),wilson_numbers.canvas_height*(t+i+1)/(total_array_footprint+1)+1,wilson_numbers.canvas_width*(1/16)/(total_array_footprint+1),wilson_numbers.canvas_height/(total_array_footprint+1))}draw_frame(),Page.show();