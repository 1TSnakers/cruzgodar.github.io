!function(){"use strict";let e=20,t=0,n=10,r=0,l=2e3,o=3,a=0,i=[],c=[],s=[],u=[],g=-1,f=[],d=null,p=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"cpu",canvas_width:2e3,canvas_height:2e3,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"});Page.element.querySelector("#generate-button").addEventListener("click",_);let h=Page.element.querySelector("#resolution-input");h.addEventListener("keydown",e=>{13===e.keyCode&&_()});let x=Page.element.querySelector("#triangle-size-input");x.addEventListener("keydown",e=>{13===e.keyCode&&_()});let y=Page.element.querySelector("#num-colors-input");function _(){d=Site.applet_process_id,l=parseInt(h.value||2e3),p.change_canvas_size(l,l),n=Math.ceil(l/200),e=parseInt(x.value||20),t=Math.round(l/(e+2)),r=2*t,o=parseInt(y.value||3),a=(1-Math.sqrt(3)/2*(e+1)/(e+2))/2*l,f=[[0,0,0,0]],i=new Array(e),s=new Array(e),u=new Array(e);for(let t=0;t<e;t++){i[t]=new Array(e),s[t]=new Array(e),u[t]=new Array(e);for(let n=0;n<e;n++)u[t][n]=!1}i[0][0]=1,s[0][0]=p.utils.hsv_to_rgb(1/o,1,1),c=new Array(e);for(let t=0;t<e;t++)c[t]=new Array(e);for(let t=1;t<e;t++){i[t][0]=1,i[t][t]=1,s[t][0]=[...s[0][0]],s[t][t]=[...s[0][0]];for(let e=1;e<t;e++)i[t][e]=(i[t-1][e-1]+i[t-1][e])%o,s[t][e]=p.utils.hsv_to_rgb(i[t][e]/o,1,1)}for(let t=0;t<e;t++)for(let e=0;e<=t;e++)c[t][e]=b(t,e);p.ctx.fillStyle="rgb(0, 0, 0)",p.ctx.fillRect(0,0,l,l),p.ctx.lineWidth=10*Math.sqrt(t/150),window.requestAnimationFrame(w)}function w(l){let o=l-g;if(g=l,0!==o){for(let l=0;l<n;l++)for(let n=0;n<f.length;n++)if(0===f[n][3]){if(k(n),f[n][2]++,f[n][2]===t-1){if(f[n][0]!==e-2){if(!u[f[n][0]+1][f[n][1]]){let e=!1;for(let t=0;t<f.length;t++)if(f[t][0]===f[n][0]+1&&f[t][1]===f[n][1]){e=!0,f[t][3]+=r;break}e||f.push([f[n][0]+1,f[n][1],0,0])}if(!u[f[n][0]+1][f[n][1]+1]){let e=!1;for(let t=0;t<f.length;t++)if(f[t][0]===f[n][0]+1&&f[t][1]===f[n][1]+1){e=!0,f[t][3]+=r;break}!e&&f[n][1]+1<=(f[n][0]+1)/2&&f.push([f[n][0]+1,f[n][1]+1,0,0])}}u[f[n][0]][f[n][1]]=!0,f.splice(n,1)}}else f[n][3]--;d===Site.applet_process_id?0!==f.length&&window.requestAnimationFrame(w):console.log("Terminated applet process")}}function b(t,n){let r=(n-Math.floor(t/2))*l/(e+2)+l/2;t%2==1&&(r-=.5*l/(e+2));let o=(t+1)*Math.sqrt(3)/2*l/(e+2)+a;return[.8*r+.1*l,.8*o+.1*l]}function k(e){let n=f[e][2]/t,r=(f[e][2]+2)/t,l=f[e][0],o=f[e][1],a=l+1,i=o;p.ctx.strokeStyle=`rgb(${s[l][o][0]*(1-n)+s[a][i][0]*n}, ${s[l][o][1]*(1-n)+s[a][i][1]*n}, ${s[l][o][2]*(1-n)+s[a][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(c[l][o][0]*(1-n)+c[a][i][0]*n,c[l][o][1]*(1-n)+c[a][i][1]*n),p.ctx.lineTo(c[l][o][0]*(1-r)+c[a][i][0]*r,c[l][o][1]*(1-r)+c[a][i][1]*r),p.ctx.stroke(),i++,p.ctx.strokeStyle=`rgb(${s[l][o][0]*(1-n)+s[a][i][0]*n}, ${s[l][o][1]*(1-n)+s[a][i][1]*n}, ${s[l][o][2]*(1-n)+s[a][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(c[l][o][0]*(1-n)+c[a][i][0]*n,c[l][o][1]*(1-n)+c[a][i][1]*n),p.ctx.lineTo(c[l][o][0]*(1-r)+c[a][i][0]*r,c[l][o][1]*(1-r)+c[a][i][1]*r),p.ctx.stroke(),o=l-o,i=a-i,p.ctx.strokeStyle=`rgb(${s[l][o][0]*(1-n)+s[a][i][0]*n}, ${s[l][o][1]*(1-n)+s[a][i][1]*n}, ${s[l][o][2]*(1-n)+s[a][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(c[l][o][0]*(1-n)+c[a][i][0]*n,c[l][o][1]*(1-n)+c[a][i][1]*n),p.ctx.lineTo(c[l][o][0]*(1-r)+c[a][i][0]*r,c[l][o][1]*(1-r)+c[a][i][1]*r),p.ctx.stroke(),i++,p.ctx.strokeStyle=`rgb(${s[l][o][0]*(1-n)+s[a][i][0]*n}, ${s[l][o][1]*(1-n)+s[a][i][1]*n}, ${s[l][o][2]*(1-n)+s[a][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(c[l][o][0]*(1-n)+c[a][i][0]*n,c[l][o][1]*(1-n)+c[a][i][1]*n),p.ctx.lineTo(c[l][o][0]*(1-r)+c[a][i][0]*r,c[l][o][1]*(1-r)+c[a][i][1]*r),p.ctx.stroke()}y.addEventListener("keydown",e=>{13===e.keyCode&&_()}),Page.element.querySelector("#download-button").addEventListener("click",()=>{p.download_frame("a-pascals-triangle-coloring.png")})}();