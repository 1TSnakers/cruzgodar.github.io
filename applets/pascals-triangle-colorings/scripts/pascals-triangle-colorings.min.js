!function(){"use strict";let e=20,t=0,n=10,r=0,o=2e3,l=3,c=0,i=[],a=[],s=[],u=[],d=-1,f=[],g=null,p=new Wilson(document.querySelector("#output-canvas"),{renderer:"cpu",canvas_width:2e3,canvas_height:2e3,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"});document.querySelector("#generate-button").addEventListener("click",_);let h=document.querySelector("#resolution-input");h.addEventListener("keydown",e=>{13===e.keyCode&&_()});let x=document.querySelector("#triangle-size-input");x.addEventListener("keydown",e=>{13===e.keyCode&&_()});let y=document.querySelector("#num-colors-input");function _(){g=Site.applet_process_id,o=parseInt(h.value||2e3),p.change_canvas_size(o,o),n=Math.ceil(o/200),e=parseInt(x.value||20),t=Math.round(o/(e+2)),r=2*t,l=parseInt(y.value||3),c=(1-Math.sqrt(3)/2*(e+1)/(e+2))/2*o,f=[[0,0,0,0]],i=new Array(e),s=new Array(e),u=new Array(e);for(let t=0;t<e;t++){i[t]=new Array(e),s[t]=new Array(e),u[t]=new Array(e);for(let n=0;n<e;n++)u[t][n]=!1}i[0][0]=1,s[0][0]=p.utils.hsv_to_rgb(1/l,1,1),a=new Array(e);for(let t=0;t<e;t++)a[t]=new Array(e);for(let t=1;t<e;t++){i[t][0]=1,i[t][t]=1,s[t][0]=[...s[0][0]],s[t][t]=[...s[0][0]];for(let e=1;e<t;e++)i[t][e]=(i[t-1][e-1]+i[t-1][e])%l,s[t][e]=p.utils.hsv_to_rgb(i[t][e]/l,1,1)}for(let t=0;t<e;t++)for(let e=0;e<=t;e++)a[t][e]=b(t,e);p.ctx.fillStyle="rgb(0, 0, 0)",p.ctx.fillRect(0,0,o,o),p.ctx.lineWidth=10*Math.sqrt(t/150),window.requestAnimationFrame(w)}function w(o){let l=o-d;if(d=o,0!==l){for(let o=0;o<n;o++)for(let n=0;n<f.length;n++)if(0===f[n][3]){if(k(n),f[n][2]++,f[n][2]===t-1){if(f[n][0]!==e-2){if(!u[f[n][0]+1][f[n][1]]){let e=!1;for(let t=0;t<f.length;t++)if(f[t][0]===f[n][0]+1&&f[t][1]===f[n][1]){e=!0,f[t][3]+=r;break}e||f.push([f[n][0]+1,f[n][1],0,0])}if(!u[f[n][0]+1][f[n][1]+1]){let e=!1;for(let t=0;t<f.length;t++)if(f[t][0]===f[n][0]+1&&f[t][1]===f[n][1]+1){e=!0,f[t][3]+=r;break}!e&&f[n][1]+1<=(f[n][0]+1)/2&&f.push([f[n][0]+1,f[n][1]+1,0,0])}}u[f[n][0]][f[n][1]]=!0,f.splice(n,1)}}else f[n][3]--;g===Site.applet_process_id?0!==f.length&&window.requestAnimationFrame(w):console.log("Terminated applet process")}}function b(t,n){let r=(n-Math.floor(t/2))*o/(e+2)+o/2;t%2==1&&(r-=.5*o/(e+2));let l=(t+1)*Math.sqrt(3)/2*o/(e+2)+c;return[.8*r+.1*o,.8*l+.1*o]}function k(e){let n=f[e][2]/t,r=(f[e][2]+2)/t,o=f[e][0],l=f[e][1],c=o+1,i=l;p.ctx.strokeStyle=`rgb(${s[o][l][0]*(1-n)+s[c][i][0]*n}, ${s[o][l][1]*(1-n)+s[c][i][1]*n}, ${s[o][l][2]*(1-n)+s[c][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(a[o][l][0]*(1-n)+a[c][i][0]*n,a[o][l][1]*(1-n)+a[c][i][1]*n),p.ctx.lineTo(a[o][l][0]*(1-r)+a[c][i][0]*r,a[o][l][1]*(1-r)+a[c][i][1]*r),p.ctx.stroke(),i++,p.ctx.strokeStyle=`rgb(${s[o][l][0]*(1-n)+s[c][i][0]*n}, ${s[o][l][1]*(1-n)+s[c][i][1]*n}, ${s[o][l][2]*(1-n)+s[c][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(a[o][l][0]*(1-n)+a[c][i][0]*n,a[o][l][1]*(1-n)+a[c][i][1]*n),p.ctx.lineTo(a[o][l][0]*(1-r)+a[c][i][0]*r,a[o][l][1]*(1-r)+a[c][i][1]*r),p.ctx.stroke(),l=o-l,i=c-i,p.ctx.strokeStyle=`rgb(${s[o][l][0]*(1-n)+s[c][i][0]*n}, ${s[o][l][1]*(1-n)+s[c][i][1]*n}, ${s[o][l][2]*(1-n)+s[c][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(a[o][l][0]*(1-n)+a[c][i][0]*n,a[o][l][1]*(1-n)+a[c][i][1]*n),p.ctx.lineTo(a[o][l][0]*(1-r)+a[c][i][0]*r,a[o][l][1]*(1-r)+a[c][i][1]*r),p.ctx.stroke(),i++,p.ctx.strokeStyle=`rgb(${s[o][l][0]*(1-n)+s[c][i][0]*n}, ${s[o][l][1]*(1-n)+s[c][i][1]*n}, ${s[o][l][2]*(1-n)+s[c][i][2]*n})`,p.ctx.beginPath(),p.ctx.moveTo(a[o][l][0]*(1-n)+a[c][i][0]*n,a[o][l][1]*(1-n)+a[c][i][1]*n),p.ctx.lineTo(a[o][l][0]*(1-r)+a[c][i][0]*r,a[o][l][1]*(1-r)+a[c][i][1]*r),p.ctx.stroke()}y.addEventListener("keydown",e=>{13===e.keyCode&&_()}),document.querySelector("#download-button").addEventListener("click",()=>{p.download_frame("a-pascals-triangle-coloring.png")})}();