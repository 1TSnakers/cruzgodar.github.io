!function(){"use strict";let e=2e3,t=20,a=!0,n=.05,r=[],l=[],o=[],c=[],i=[],s=[],h=1,u=0,M=1,d=!0,f=-1,b=null,y=new Wilson(document.querySelector("#output-canvas"),{renderer:"cpu",canvas_width:2e3,canvas_height:2e3,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"});document.querySelector("#generate-button").addEventListener("click",g);let p=document.querySelector("#resolution-input");p.addEventListener("keydown",e=>{13===e.keyCode&&g()});let w=document.querySelector("#diamond-size-input");w.addEventListener("keydown",e=>{13===e.keyCode&&g()});let _=document.querySelector("#use-smooth-colors-checkbox");function g(){b=Site.applet_process_id,e=parseInt(p.value||2e3),y.change_canvas_size(e,e),t=parseInt(w.value||20)+1,M=Math.ceil(100/t),d=!(t>30),a=_.checked,r=new Array(2*t),l=new Array(2*t),i=new Array(2*t),s=new Array(2*t),o=new Array(2*t),c=new Array(2*t);for(let e=0;e<2*t;e++){r[e]=new Array(2*t),l[e]=new Array(2*t),i[e]=new Array(2*t),s[e]=new Array(2*t),o[e]=new Array(2*t),c[e]=new Array(2*t);for(let a=0;a<2*t;a++)r[e][a]=0,i[e][a]=0,o[e][a]=0}Math.random()<.5?(r[t-1][t-1]=-1,r[t][t-1]=1,i[t-1][t-1]=1,i[t][t-1]=1,a?(o[t-1][t-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),o[t][t-1]=.75-Math.atan2(.5,-.5)/(2*Math.PI)):(o[t-1][t-1]=0,o[t][t-1]=.5)):(r[t-1][t-1]=-2,r[t-1][t]=2,i[t-1][t-1]=1,i[t-1][t]=1,a?(o[t-1][t-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),o[t-1][t]=.75-Math.atan2(-.5,.5)/(2*Math.PI)):(o[t-1][t-1]=.25,o[t-1][t]=.75)),h=1,u=M-1,window.requestAnimationFrame(m)}function m(a){let n=a-f;if(f=a,0!==n){if(++u===M&&(u=0,function(){for(let e=0;e<2*t;e++)for(let a=0;a<2*t;a++)l[e][a]=0,s[e][a]=0,c[e][a]=0;for(let e=0;e<2*t;e++)for(let a=0;a<2*t;a++)0!==r[e][a]&&(1===Math.abs(r[e][a])?r[e+r[e][a]][a]===-r[e][a]&&(r[e+r[e][a]][a]=0,r[e][a]=0):r[e][a+Math.sign(r[e][a])]===-r[e][a]&&(r[e][a+Math.sign(r[e][a])]=0,r[e][a]=0));for(let e=0;e<2*t;e++)for(let a=0;a<2*t;a++)0!==r[e][a]&&(1===Math.abs(r[e][a])?(l[e+r[e][a]][a]=r[e][a],s[e+r[e][a]][a]=i[e][a],c[e+r[e][a]][a]=o[e][a]):(l[e][a+Math.sign(r[e][a])]=r[e][a],s[e][a+Math.sign(r[e][a])]=i[e][a],c[e][a+Math.sign(r[e][a])]=o[e][a]));for(let e=0;e<2*t;e++)for(let a=0;a<2*t;a++)r[e][a]=l[e][a],i[e][a]=s[e][a],o[e][a]=c[e][a];h++}(),function(){for(let e=-h;e<h;e++)for(let a=-h;a<h;a++)if(Math.abs(e+.5)+Math.abs(a+.5)<=h&&Math.abs(e+1.5)+Math.abs(a+.5)<=h&&Math.abs(e+.5)+Math.abs(a+1.5)<=h&&Math.abs(e+1.5)+Math.abs(a+1.5)<=h){let n=e+t,l=a+t;0===r[n][l]&&0===r[n+1][l]&&0===r[n][l+1]&&0===r[n+1][l+1]&&2!==Math.abs(r[n-1][l])&&2!==Math.abs(r[n-1][l+1])&&1!==Math.abs(r[n][l-1])&&1!==Math.abs(r[n+1][l-1])&&S(n,l)}}(),y.ctx.fillStyle="rgb(0, 0, 0)",y.ctx.fillRect(0,0,e,e),A()),b===Site.applet_process_id)return 0===u&&h===t-1?(y.ctx.fillStyle="rgb(0, 0, 0)",y.ctx.fillRect(0,0,e,e),void A()):void window.requestAnimationFrame(m);console.log("Terminated applet process")}}function A(){for(let e=-h;e<h;e++)for(let a=-h;a<h;a++){let n=e+t,l=a+t;0!==r[n][l]&&(1===Math.abs(r[n][l])?v(n,l,!0):v(n,l,!1))}}function v(a,r,l){let c=o[a][r],s=1-.8*Math.pow((i[a][r]-1)/h,4),u=y.utils.hsv_to_rgb(c,s,1);y.ctx.fillStyle=`rgb(${u[0]}, ${u[1]}, ${u[2]})`;let M=e*(.1+(r+n)/(2*t)*.8),d=e*(.1+(a+n)/(2*t)*.8);l?y.ctx.fillRect(M,d,e*(2-2*n)/(2*t)*.8,e*(1-2*n)/(2*t)*.8):y.ctx.fillRect(M,d,e*(1-2*n)/(2*t)*.8,e*(2-2*n)/(2*t)*.8)}function S(e,n){Math.random()<.5?(r[e][n]=-1,r[e+1][n]=1,i[e][n]=h,i[e+1][n]=h,a?(o[e][n]=.75-Math.atan2(e+.5-t,n+.5-t)/(2*Math.PI),o[e+1][n]=.75-Math.atan2(e+1.5-t,n+.5-t)/(2*Math.PI)):(o[e][n]=0,o[e+1][n]=.5)):(r[e][n]=-2,r[e][n+1]=2,i[e][n]=h,i[e][n+1]=h,a?(o[e][n]=.75-Math.atan2(e+.5-t,n+.5-t)/(2*Math.PI),o[e][n+1]=.75-Math.atan2(e+.5-t,n+1.5-t)/(2*Math.PI)):(o[e][n]=.25,o[e][n+1]=.75))}_.checked=!0,document.querySelector("#download-button").addEventListener("click",()=>{y.download_frame("an-aztec-diamond.png")})}();