import{Applet}from"/scripts/src/applets.min.mjs";import{Wilson}from"/scripts/wilson.min.mjs";class DominoShuffling extends Applet{resolution=2e3;diamondSize=20;useSmoothColors=!0;marginSize=.05;aztecDiamond=[];newDiamond=[];hue=[];newHue=[];age=[];newAge=[];currentDiamondSize=1;frame=0;framesPerAnimationStep=1;drawDiamondWithHoles=!0;lastTimestamp=-1;constructor(canvas){super(canvas);canvas={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson(this.canvas,canvas)}run({resolution,diamondSize,useSmoothColors}){this.resolution=resolution,this.wilson.changeCanvasSize(this.resolution,this.resolution),this.diamondSize=diamondSize,this.framesPerAnimationStep=Math.ceil(100/this.diamondSize),30<this.diamondSize?this.drawDiamondWithHoles=!1:this.drawDiamondWithHoles=!0,this.useSmoothColors=useSmoothColors,this.aztecDiamond=new Array(2*this.diamondSize),this.newDiamond=new Array(2*this.diamondSize),this.age=new Array(2*this.diamondSize),this.newAge=new Array(2*this.diamondSize),this.hue=new Array(2*this.diamondSize),this.newHue=new Array(2*this.diamondSize);for(let i=0;i<2*this.diamondSize;i++){this.aztecDiamond[i]=new Array(2*this.diamondSize),this.newDiamond[i]=new Array(2*this.diamondSize),this.age[i]=new Array(2*this.diamondSize),this.newAge[i]=new Array(2*this.diamondSize),this.hue[i]=new Array(2*this.diamondSize),this.newHue[i]=new Array(2*this.diamondSize);for(let j=0;j<2*this.diamondSize;j++)this.aztecDiamond[i][j]=0,this.age[i][j]=0,this.hue[i][j]=0}Math.random()<.5?(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-1,this.aztecDiamond[this.diamondSize][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize][this.diamondSize-1]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize][this.diamondSize-1]=.75-Math.atan2(.5,-.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=0,this.hue[this.diamondSize][this.diamondSize-1]=.5)):(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-2,this.aztecDiamond[this.diamondSize-1][this.diamondSize]=2,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize-1][this.diamondSize]=.75-Math.atan2(-.5,.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=.25,this.hue[this.diamondSize-1][this.diamondSize]=.75)),this.currentDiamondSize=1,this.frame=this.framesPerAnimationStep-1,window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(timestamp){var timeElapsed=timestamp-this.lastTimestamp;this.lastTimestamp=timestamp,0==timeElapsed||(this.frame++,this.frame===this.framesPerAnimationStep&&(this.frame=0,this.moveDominos(),this.fillSpaces(),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()),this.animationPaused)||(0===this.frame&&this.currentDiamondSize===this.diamondSize-1?(this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()):this.animationPaused||window.requestAnimationFrame(this.drawFrame.bind(this)))}drawDiamond(){for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++)for(let j=-this.currentDiamondSize;j<this.currentDiamondSize;j++){var row=i+this.diamondSize,col=j+this.diamondSize;0!==this.aztecDiamond[row][col]&&(1===Math.abs(this.aztecDiamond[row][col])?this.drawDomino(row,col,!0):this.drawDomino(row,col,!1))}}drawDomino(row,col,isHorizontal){var h=this.hue[row][col],s=1-.8*Math.pow((this.age[row][col]-1)/this.currentDiamondSize,4),h=this.wilson.utils.hsvToRgb(h,s,1),s=(this.wilson.ctx.fillStyle=`rgb(${h[0]}, ${h[1]}, ${h[2]})`,this.resolution*(.1+(col+this.marginSize)/(2*this.diamondSize)*.8)),h=this.resolution*(.1+(row+this.marginSize)/(2*this.diamondSize)*.8);isHorizontal?this.wilson.ctx.fillRect(s,h,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8):this.wilson.ctx.fillRect(s,h,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8)}moveDominos(){for(let i=0;i<2*this.diamondSize;i++)for(let j=0;j<2*this.diamondSize;j++)this.newDiamond[i][j]=0,this.newAge[i][j]=0,this.newHue[i][j]=0;for(let i=0;i<2*this.diamondSize;i++)for(let j=0;j<2*this.diamondSize;j++)0!==this.aztecDiamond[i][j]&&(1===Math.abs(this.aztecDiamond[i][j])?this.aztecDiamond[i+this.aztecDiamond[i][j]][j]===-this.aztecDiamond[i][j]&&(this.aztecDiamond[i+this.aztecDiamond[i][j]][j]=0,this.aztecDiamond[i][j]=0):this.aztecDiamond[i][j+Math.sign(this.aztecDiamond[i][j])]===-this.aztecDiamond[i][j]&&(this.aztecDiamond[i][j+Math.sign(this.aztecDiamond[i][j])]=0,this.aztecDiamond[i][j]=0));for(let i=0;i<2*this.diamondSize;i++)for(let j=0;j<2*this.diamondSize;j++)0!==this.aztecDiamond[i][j]&&(1===Math.abs(this.aztecDiamond[i][j])?(this.newDiamond[i+this.aztecDiamond[i][j]][j]=this.aztecDiamond[i][j],this.newAge[i+this.aztecDiamond[i][j]][j]=this.age[i][j],this.newHue[i+this.aztecDiamond[i][j]][j]=this.hue[i][j]):(this.newDiamond[i][j+Math.sign(this.aztecDiamond[i][j])]=this.aztecDiamond[i][j],this.newAge[i][j+Math.sign(this.aztecDiamond[i][j])]=this.age[i][j],this.newHue[i][j+Math.sign(this.aztecDiamond[i][j])]=this.hue[i][j]));for(let i=0;i<2*this.diamondSize;i++)for(let j=0;j<2*this.diamondSize;j++)this.aztecDiamond[i][j]=this.newDiamond[i][j],this.age[i][j]=this.newAge[i][j],this.hue[i][j]=this.newHue[i][j];this.currentDiamondSize++}fillSpaces(){for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++)for(let j=-this.currentDiamondSize;j<this.currentDiamondSize;j++){var row,col;Math.abs(i+.5)+Math.abs(j+.5)<=this.currentDiamondSize&&Math.abs(i+1.5)+Math.abs(j+.5)<=this.currentDiamondSize&&Math.abs(i+.5)+Math.abs(j+1.5)<=this.currentDiamondSize&&Math.abs(i+1.5)+Math.abs(j+1.5)<=this.currentDiamondSize&&(row=i+this.diamondSize,col=j+this.diamondSize,0===this.aztecDiamond[row][col])&&0===this.aztecDiamond[row+1][col]&&0===this.aztecDiamond[row][col+1]&&0===this.aztecDiamond[row+1][col+1]&&2!==Math.abs(this.aztecDiamond[row-1][col])&&2!==Math.abs(this.aztecDiamond[row-1][col+1])&&1!==Math.abs(this.aztecDiamond[row][col-1])&&1!==Math.abs(this.aztecDiamond[row+1][col-1])&&this.fillSpace(row,col)}}fillSpace(row,col){Math.random()<.5?(this.aztecDiamond[row][col]=-1,this.aztecDiamond[row+1][col]=1,this.age[row][col]=this.currentDiamondSize,this.age[row+1][col]=this.currentDiamondSize,this.useSmoothColors?(this.hue[row][col]=.75-Math.atan2(row+.5-this.diamondSize,col+.5-this.diamondSize)/(2*Math.PI),this.hue[row+1][col]=.75-Math.atan2(row+1.5-this.diamondSize,col+.5-this.diamondSize)/(2*Math.PI)):(this.hue[row][col]=0,this.hue[row+1][col]=.5)):(this.aztecDiamond[row][col]=-2,this.aztecDiamond[row][col+1]=2,this.age[row][col]=this.currentDiamondSize,this.age[row][col+1]=this.currentDiamondSize,this.useSmoothColors?(this.hue[row][col]=.75-Math.atan2(row+.5-this.diamondSize,col+.5-this.diamondSize)/(2*Math.PI),this.hue[row][col+1]=.75-Math.atan2(row+.5-this.diamondSize,col+1.5-this.diamondSize)/(2*Math.PI)):(this.hue[row][col]=.25,this.hue[row][col+1]=.75))}}export{DominoShuffling};