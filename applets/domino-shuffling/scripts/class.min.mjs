import{Applet}from"/scripts/src/applets.min.mjs";import{Wilson}from"/scripts/wilson.min.mjs";class DominoShuffling extends Applet{resolution=2e3;diamondSize=20;useSmoothColors=!0;marginSize=.05;aztecDiamond=[];newDiamond=[];hue=[];newHue=[];age=[];newAge=[];currentDiamondSize=1;frame=0;framesPerAnimationStep=1;drawDiamondWithHoles=!0;lastTimestamp=-1;constructor(i){super(i);i={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson(this.canvas,i)}run(i,t,e){this.resolution=i,this.wilson.changeCanvasSize(this.resolution,this.resolution),this.diamondSize=t,this.framesPerAnimationStep=Math.ceil(100/this.diamondSize),30<this.diamondSize?this.drawDiamondWithHoles=!1:this.drawDiamondWithHoles=!0,this.useSmoothColors=e,this.aztecDiamond=new Array(2*this.diamondSize),this.newDiamond=new Array(2*this.diamondSize),this.age=new Array(2*this.diamondSize),this.newAge=new Array(2*this.diamondSize),this.hue=new Array(2*this.diamondSize),this.newHue=new Array(2*this.diamondSize);for(let t=0;t<2*this.diamondSize;t++){this.aztecDiamond[t]=new Array(2*this.diamondSize),this.newDiamond[t]=new Array(2*this.diamondSize),this.age[t]=new Array(2*this.diamondSize),this.newAge[t]=new Array(2*this.diamondSize),this.hue[t]=new Array(2*this.diamondSize),this.newHue[t]=new Array(2*this.diamondSize);for(let i=0;i<2*this.diamondSize;i++)this.aztecDiamond[t][i]=0,this.age[t][i]=0,this.hue[t][i]=0}Math.random()<.5?(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-1,this.aztecDiamond[this.diamondSize][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize][this.diamondSize-1]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize][this.diamondSize-1]=.75-Math.atan2(.5,-.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=0,this.hue[this.diamondSize][this.diamondSize-1]=.5)):(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-2,this.aztecDiamond[this.diamondSize-1][this.diamondSize]=2,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize-1][this.diamondSize]=.75-Math.atan2(-.5,.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=.25,this.hue[this.diamondSize-1][this.diamondSize]=.75)),this.currentDiamondSize=1,this.frame=this.framesPerAnimationStep-1,window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(i){var t=i-this.lastTimestamp;this.lastTimestamp=i,0==t||(this.frame++,this.frame===this.framesPerAnimationStep&&(this.frame=0,this.moveDominos(),this.fillSpaces(),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()),this.animationPaused)||(0===this.frame&&this.currentDiamondSize===this.diamondSize-1?(this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()):this.animationPaused||window.requestAnimationFrame(this.drawFrame.bind(this)))}drawDiamond(){for(let t=-this.currentDiamondSize;t<this.currentDiamondSize;t++)for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++){var e=t+this.diamondSize,a=i+this.diamondSize;0!==this.aztecDiamond[e][a]&&(1===Math.abs(this.aztecDiamond[e][a])?this.drawDomino(e,a,!0):this.drawDomino(e,a,!1))}}drawDomino(i,t,e){var a=this.hue[i][t],s=1-.8*Math.pow((this.age[i][t]-1)/this.currentDiamondSize,4),a=this.wilson.utils.hsvToRgb(a,s,1),s=(this.wilson.ctx.fillStyle=`rgb(${a[0]}, ${a[1]}, ${a[2]})`,this.resolution*(.1+(t+this.marginSize)/(2*this.diamondSize)*.8)),a=this.resolution*(.1+(i+this.marginSize)/(2*this.diamondSize)*.8);e?this.wilson.ctx.fillRect(s,a,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8):this.wilson.ctx.fillRect(s,a,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8)}moveDominos(){for(let t=0;t<2*this.diamondSize;t++)for(let i=0;i<2*this.diamondSize;i++)this.newDiamond[t][i]=0,this.newAge[t][i]=0,this.newHue[t][i]=0;for(let t=0;t<2*this.diamondSize;t++)for(let i=0;i<2*this.diamondSize;i++)0!==this.aztecDiamond[t][i]&&(1===Math.abs(this.aztecDiamond[t][i])?this.aztecDiamond[t+this.aztecDiamond[t][i]][i]===-this.aztecDiamond[t][i]&&(this.aztecDiamond[t+this.aztecDiamond[t][i]][i]=0,this.aztecDiamond[t][i]=0):this.aztecDiamond[t][i+Math.sign(this.aztecDiamond[t][i])]===-this.aztecDiamond[t][i]&&(this.aztecDiamond[t][i+Math.sign(this.aztecDiamond[t][i])]=0,this.aztecDiamond[t][i]=0));for(let t=0;t<2*this.diamondSize;t++)for(let i=0;i<2*this.diamondSize;i++)0!==this.aztecDiamond[t][i]&&(1===Math.abs(this.aztecDiamond[t][i])?(this.newDiamond[t+this.aztecDiamond[t][i]][i]=this.aztecDiamond[t][i],this.newAge[t+this.aztecDiamond[t][i]][i]=this.age[t][i],this.newHue[t+this.aztecDiamond[t][i]][i]=this.hue[t][i]):(this.newDiamond[t][i+Math.sign(this.aztecDiamond[t][i])]=this.aztecDiamond[t][i],this.newAge[t][i+Math.sign(this.aztecDiamond[t][i])]=this.age[t][i],this.newHue[t][i+Math.sign(this.aztecDiamond[t][i])]=this.hue[t][i]));for(let t=0;t<2*this.diamondSize;t++)for(let i=0;i<2*this.diamondSize;i++)this.aztecDiamond[t][i]=this.newDiamond[t][i],this.age[t][i]=this.newAge[t][i],this.hue[t][i]=this.newHue[t][i];this.currentDiamondSize++}fillSpaces(){for(let t=-this.currentDiamondSize;t<this.currentDiamondSize;t++)for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++){var e,a;Math.abs(t+.5)+Math.abs(i+.5)<=this.currentDiamondSize&&Math.abs(t+1.5)+Math.abs(i+.5)<=this.currentDiamondSize&&Math.abs(t+.5)+Math.abs(i+1.5)<=this.currentDiamondSize&&Math.abs(t+1.5)+Math.abs(i+1.5)<=this.currentDiamondSize&&(e=t+this.diamondSize,a=i+this.diamondSize,0===this.aztecDiamond[e][a])&&0===this.aztecDiamond[e+1][a]&&0===this.aztecDiamond[e][a+1]&&0===this.aztecDiamond[e+1][a+1]&&2!==Math.abs(this.aztecDiamond[e-1][a])&&2!==Math.abs(this.aztecDiamond[e-1][a+1])&&1!==Math.abs(this.aztecDiamond[e][a-1])&&1!==Math.abs(this.aztecDiamond[e+1][a-1])&&this.fillSpace(e,a)}}fillSpace(i,t){Math.random()<.5?(this.aztecDiamond[i][t]=-1,this.aztecDiamond[i+1][t]=1,this.age[i][t]=this.currentDiamondSize,this.age[i+1][t]=this.currentDiamondSize,this.useSmoothColors?(this.hue[i][t]=.75-Math.atan2(i+.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI),this.hue[i+1][t]=.75-Math.atan2(i+1.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI)):(this.hue[i][t]=0,this.hue[i+1][t]=.5)):(this.aztecDiamond[i][t]=-2,this.aztecDiamond[i][t+1]=2,this.age[i][t]=this.currentDiamondSize,this.age[i][t+1]=this.currentDiamondSize,this.useSmoothColors?(this.hue[i][t]=.75-Math.atan2(i+.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI),this.hue[i][t+1]=.75-Math.atan2(i+.5-this.diamondSize,t+1.5-this.diamondSize)/(2*Math.PI)):(this.hue[i][t]=.25,this.hue[i][t+1]=.75))}}export{DominoShuffling};