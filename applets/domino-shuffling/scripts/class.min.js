"use strict";class DominoShuffling extends Applet{resolution=2e3;diamondSize=20;useSmoothColors=!0;marginSize=.05;aztecDiamond=[];newDiamond=[];hue=[];newHue=[];age=[];newAge=[];currentDiamondSize=1;frame=0;framesPerAnimationStep=1;drawDiamondWithHoles=!0;lastTimestamp=-1;constructor(i){super(i);let t={renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson(this.canvas,t)}run(i,t,e){this.resolution=i,this.wilson.changeCanvasSize(this.resolution,this.resolution),this.diamondSize=t,this.framesPerAnimationStep=Math.ceil(100/this.diamondSize),this.diamondSize>30?this.drawDiamondWithHoles=!1:this.drawDiamondWithHoles=!0,this.useSmoothColors=e,this.aztecDiamond=Array(2*this.diamondSize),this.newDiamond=Array(2*this.diamondSize),this.age=Array(2*this.diamondSize),this.newAge=Array(2*this.diamondSize),this.hue=Array(2*this.diamondSize),this.newHue=Array(2*this.diamondSize);for(let s=0;s<2*this.diamondSize;s++){this.aztecDiamond[s]=Array(2*this.diamondSize),this.newDiamond[s]=Array(2*this.diamondSize),this.age[s]=Array(2*this.diamondSize),this.newAge[s]=Array(2*this.diamondSize),this.hue[s]=Array(2*this.diamondSize),this.newHue[s]=Array(2*this.diamondSize);for(let a=0;a<2*this.diamondSize;a++)this.aztecDiamond[s][a]=0,this.age[s][a]=0,this.hue[s][a]=0}.5>Math.random()?(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-1,this.aztecDiamond[this.diamondSize][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize][this.diamondSize-1]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize][this.diamondSize-1]=.75-Math.atan2(.5,-.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=0,this.hue[this.diamondSize][this.diamondSize-1]=.5)):(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-2,this.aztecDiamond[this.diamondSize-1][this.diamondSize]=2,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize-1][this.diamondSize]=.75-Math.atan2(-.5,.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=.25,this.hue[this.diamondSize-1][this.diamondSize]=.75)),this.currentDiamondSize=1,this.frame=this.framesPerAnimationStep-1,window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(i){let t=i-this.lastTimestamp;if(this.lastTimestamp=i,0!==t){if(this.frame++,this.frame===this.framesPerAnimationStep&&(this.frame=0,this.moveDominos(),this.fillSpaces(),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()),!this.animationPaused){if(0===this.frame&&this.currentDiamondSize===this.diamondSize-1){this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond();return}this.animationPaused||window.requestAnimationFrame(this.drawFrame.bind(this))}}}drawDiamond(){for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++)for(let t=-this.currentDiamondSize;t<this.currentDiamondSize;t++){let e=i+this.diamondSize,s=t+this.diamondSize;0!==this.aztecDiamond[e][s]&&(1===Math.abs(this.aztecDiamond[e][s])?this.drawDomino(e,s,!0):this.drawDomino(e,s,!1))}}drawDomino(i,t,e){let s=this.hue[i][t],a=1-.8*Math.pow((this.age[i][t]-1)/this.currentDiamondSize,4),n=this.wilson.utils.hsvToRgb(s,a,1);this.wilson.ctx.fillStyle=`rgb(${n[0]}, ${n[1]}, ${n[2]})`;let h=this.resolution*(.1+(t+this.marginSize)/(2*this.diamondSize)*.8),o=this.resolution*(.1+(i+this.marginSize)/(2*this.diamondSize)*.8);e?this.wilson.ctx.fillRect(h,o,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8):this.wilson.ctx.fillRect(h,o,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8)}moveDominos(){for(let i=0;i<2*this.diamondSize;i++)for(let t=0;t<2*this.diamondSize;t++)this.newDiamond[i][t]=0,this.newAge[i][t]=0,this.newHue[i][t]=0;for(let e=0;e<2*this.diamondSize;e++)for(let s=0;s<2*this.diamondSize;s++)0!==this.aztecDiamond[e][s]&&(1===Math.abs(this.aztecDiamond[e][s])?this.aztecDiamond[e+this.aztecDiamond[e][s]][s]===-this.aztecDiamond[e][s]&&(this.aztecDiamond[e+this.aztecDiamond[e][s]][s]=0,this.aztecDiamond[e][s]=0):this.aztecDiamond[e][s+Math.sign(this.aztecDiamond[e][s])]===-this.aztecDiamond[e][s]&&(this.aztecDiamond[e][s+Math.sign(this.aztecDiamond[e][s])]=0,this.aztecDiamond[e][s]=0));for(let a=0;a<2*this.diamondSize;a++)for(let n=0;n<2*this.diamondSize;n++)0!==this.aztecDiamond[a][n]&&(1===Math.abs(this.aztecDiamond[a][n])?(this.newDiamond[a+this.aztecDiamond[a][n]][n]=this.aztecDiamond[a][n],this.newAge[a+this.aztecDiamond[a][n]][n]=this.age[a][n],this.newHue[a+this.aztecDiamond[a][n]][n]=this.hue[a][n]):(this.newDiamond[a][n+Math.sign(this.aztecDiamond[a][n])]=this.aztecDiamond[a][n],this.newAge[a][n+Math.sign(this.aztecDiamond[a][n])]=this.age[a][n],this.newHue[a][n+Math.sign(this.aztecDiamond[a][n])]=this.hue[a][n]));for(let h=0;h<2*this.diamondSize;h++)for(let o=0;o<2*this.diamondSize;o++)this.aztecDiamond[h][o]=this.newDiamond[h][o],this.age[h][o]=this.newAge[h][o],this.hue[h][o]=this.newHue[h][o];this.currentDiamondSize++}fillSpaces(){for(let i=-this.currentDiamondSize;i<this.currentDiamondSize;i++)for(let t=-this.currentDiamondSize;t<this.currentDiamondSize;t++)if(Math.abs(i+.5)+Math.abs(t+.5)<=this.currentDiamondSize&&Math.abs(i+1.5)+Math.abs(t+.5)<=this.currentDiamondSize&&Math.abs(i+.5)+Math.abs(t+1.5)<=this.currentDiamondSize&&Math.abs(i+1.5)+Math.abs(t+1.5)<=this.currentDiamondSize){let e=i+this.diamondSize,s=t+this.diamondSize;0===this.aztecDiamond[e][s]&&0===this.aztecDiamond[e+1][s]&&0===this.aztecDiamond[e][s+1]&&0===this.aztecDiamond[e+1][s+1]&&2!==Math.abs(this.aztecDiamond[e-1][s])&&2!==Math.abs(this.aztecDiamond[e-1][s+1])&&1!==Math.abs(this.aztecDiamond[e][s-1])&&1!==Math.abs(this.aztecDiamond[e+1][s-1])&&this.fillSpace(e,s)}}fillSpace(i,t){.5>Math.random()?(this.aztecDiamond[i][t]=-1,this.aztecDiamond[i+1][t]=1,this.age[i][t]=this.currentDiamondSize,this.age[i+1][t]=this.currentDiamondSize,this.useSmoothColors?(this.hue[i][t]=.75-Math.atan2(i+.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI),this.hue[i+1][t]=.75-Math.atan2(i+1.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI)):(this.hue[i][t]=0,this.hue[i+1][t]=.5)):(this.aztecDiamond[i][t]=-2,this.aztecDiamond[i][t+1]=2,this.age[i][t]=this.currentDiamondSize,this.age[i][t+1]=this.currentDiamondSize,this.useSmoothColors?(this.hue[i][t]=.75-Math.atan2(i+.5-this.diamondSize,t+.5-this.diamondSize)/(2*Math.PI),this.hue[i][t+1]=.75-Math.atan2(i+.5-this.diamondSize,t+1.5-this.diamondSize)/(2*Math.PI)):(this.hue[i][t]=.25,this.hue[i][t+1]=.75))}}