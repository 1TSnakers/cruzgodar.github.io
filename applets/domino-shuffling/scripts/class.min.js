class DominoShuffling extends Applet{resolution=2E3;diamondSize=20;useSmoothColors=!0;marginSize=.05;aztecDiamond=[];newDiamond=[];hue=[];newHue=[];age=[];newAge=[];currentDiamondSize=1;frame=0;framesPerAnimationStep=1;drawDiamondWithHoles=!0;lastTimestamp=-1;constructor(a){super(a);this.wilson=new Wilson(this.canvas,{renderer:"cpu",canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",
exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"})}run(a,b,c){this.resolution=a;this.wilson.changeCanvasSize(this.resolution,this.resolution);this.diamondSize=b;this.framesPerAnimationStep=Math.ceil(100/this.diamondSize);this.drawDiamondWithHoles=30<this.diamondSize?!1:!0;this.useSmoothColors=c;this.aztecDiamond=Array(2*this.diamondSize);this.newDiamond=Array(2*this.diamondSize);this.age=Array(2*this.diamondSize);this.newAge=Array(2*this.diamondSize);this.hue=Array(2*this.diamondSize);
this.newHue=Array(2*this.diamondSize);for(a=0;a<2*this.diamondSize;a++)for(this.aztecDiamond[a]=Array(2*this.diamondSize),this.newDiamond[a]=Array(2*this.diamondSize),this.age[a]=Array(2*this.diamondSize),this.newAge[a]=Array(2*this.diamondSize),this.hue[a]=Array(2*this.diamondSize),this.newHue[a]=Array(2*this.diamondSize),b=0;b<2*this.diamondSize;b++)this.aztecDiamond[a][b]=0,this.age[a][b]=0,this.hue[a][b]=0;.5>Math.random()?(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-1,this.aztecDiamond[this.diamondSize][this.diamondSize-
1]=1,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize][this.diamondSize-1]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize][this.diamondSize-1]=.75-Math.atan2(.5,-.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=0,this.hue[this.diamondSize][this.diamondSize-1]=.5)):(this.aztecDiamond[this.diamondSize-1][this.diamondSize-1]=-2,this.aztecDiamond[this.diamondSize-1][this.diamondSize]=
2,this.age[this.diamondSize-1][this.diamondSize-1]=1,this.age[this.diamondSize-1][this.diamondSize]=1,this.useSmoothColors?(this.hue[this.diamondSize-1][this.diamondSize-1]=.75-Math.atan2(-.5,-.5)/(2*Math.PI),this.hue[this.diamondSize-1][this.diamondSize]=.75-Math.atan2(-.5,.5)/(2*Math.PI)):(this.hue[this.diamondSize-1][this.diamondSize-1]=.25,this.hue[this.diamondSize-1][this.diamondSize]=.75));this.currentDiamondSize=1;this.frame=this.framesPerAnimationStep-1;window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(a){const b=
a-this.lastTimestamp;this.lastTimestamp=a;0!==b&&(this.frame++,this.frame===this.framesPerAnimationStep&&(this.frame=0,this.moveDominos(),this.fillSpaces(),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()),this.animationPaused||(0===this.frame&&this.currentDiamondSize===this.diamondSize-1?(this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution),this.drawDiamond()):this.animationPaused||
window.requestAnimationFrame(this.drawFrame.bind(this))))}drawDiamond(){for(let a=-this.currentDiamondSize;a<this.currentDiamondSize;a++)for(let b=-this.currentDiamondSize;b<this.currentDiamondSize;b++){const c=a+this.diamondSize,d=b+this.diamondSize;0!==this.aztecDiamond[c][d]&&(1===Math.abs(this.aztecDiamond[c][d])?this.drawDomino(c,d,!0):this.drawDomino(c,d,!1))}}drawDomino(a,b,c){const d=this.wilson.utils.hsvToRgb(this.hue[a][b],1-.8*Math.pow((this.age[a][b]-1)/this.currentDiamondSize,4),1);this.wilson.ctx.fillStyle=
`rgb(${d[0]}, ${d[1]}, ${d[2]})`;b=this.resolution*(.1+(b+this.marginSize)/(2*this.diamondSize)*.8);a=this.resolution*(.1+(a+this.marginSize)/(2*this.diamondSize)*.8);c?this.wilson.ctx.fillRect(b,a,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8):this.wilson.ctx.fillRect(b,a,this.resolution*(1-2*this.marginSize)/(2*this.diamondSize)*.8,this.resolution*(2-2*this.marginSize)/(2*this.diamondSize)*.8)}moveDominos(){for(var a=
0;a<2*this.diamondSize;a++)for(var b=0;b<2*this.diamondSize;b++)this.newDiamond[a][b]=0,this.newAge[a][b]=0,this.newHue[a][b]=0;for(a=0;a<2*this.diamondSize;a++)for(b=0;b<2*this.diamondSize;b++)0!==this.aztecDiamond[a][b]&&(1===Math.abs(this.aztecDiamond[a][b])?this.aztecDiamond[a+this.aztecDiamond[a][b]][b]===-this.aztecDiamond[a][b]&&(this.aztecDiamond[a+this.aztecDiamond[a][b]][b]=0,this.aztecDiamond[a][b]=0):this.aztecDiamond[a][b+Math.sign(this.aztecDiamond[a][b])]===-this.aztecDiamond[a][b]&&
(this.aztecDiamond[a][b+Math.sign(this.aztecDiamond[a][b])]=0,this.aztecDiamond[a][b]=0));for(a=0;a<2*this.diamondSize;a++)for(b=0;b<2*this.diamondSize;b++)0!==this.aztecDiamond[a][b]&&(1===Math.abs(this.aztecDiamond[a][b])?(this.newDiamond[a+this.aztecDiamond[a][b]][b]=this.aztecDiamond[a][b],this.newAge[a+this.aztecDiamond[a][b]][b]=this.age[a][b],this.newHue[a+this.aztecDiamond[a][b]][b]=this.hue[a][b]):(this.newDiamond[a][b+Math.sign(this.aztecDiamond[a][b])]=this.aztecDiamond[a][b],this.newAge[a][b+
Math.sign(this.aztecDiamond[a][b])]=this.age[a][b],this.newHue[a][b+Math.sign(this.aztecDiamond[a][b])]=this.hue[a][b]));for(a=0;a<2*this.diamondSize;a++)for(b=0;b<2*this.diamondSize;b++)this.aztecDiamond[a][b]=this.newDiamond[a][b],this.age[a][b]=this.newAge[a][b],this.hue[a][b]=this.newHue[a][b];this.currentDiamondSize++}fillSpaces(){for(let a=-this.currentDiamondSize;a<this.currentDiamondSize;a++)for(let b=-this.currentDiamondSize;b<this.currentDiamondSize;b++)if(Math.abs(a+.5)+Math.abs(b+.5)<=
this.currentDiamondSize&&Math.abs(a+1.5)+Math.abs(b+.5)<=this.currentDiamondSize&&Math.abs(a+.5)+Math.abs(b+1.5)<=this.currentDiamondSize&&Math.abs(a+1.5)+Math.abs(b+1.5)<=this.currentDiamondSize){const c=a+this.diamondSize,d=b+this.diamondSize;0===this.aztecDiamond[c][d]&&0===this.aztecDiamond[c+1][d]&&0===this.aztecDiamond[c][d+1]&&0===this.aztecDiamond[c+1][d+1]&&2!==Math.abs(this.aztecDiamond[c-1][d])&&2!==Math.abs(this.aztecDiamond[c-1][d+1])&&1!==Math.abs(this.aztecDiamond[c][d-1])&&1!==Math.abs(this.aztecDiamond[c+
1][d-1])&&this.fillSpace(c,d)}}fillSpace(a,b){.5>Math.random()?(this.aztecDiamond[a][b]=-1,this.aztecDiamond[a+1][b]=1,this.age[a][b]=this.currentDiamondSize,this.age[a+1][b]=this.currentDiamondSize,this.useSmoothColors?(this.hue[a][b]=.75-Math.atan2(a+.5-this.diamondSize,b+.5-this.diamondSize)/(2*Math.PI),this.hue[a+1][b]=.75-Math.atan2(a+1.5-this.diamondSize,b+.5-this.diamondSize)/(2*Math.PI)):(this.hue[a][b]=0,this.hue[a+1][b]=.5)):(this.aztecDiamond[a][b]=-2,this.aztecDiamond[a][b+1]=2,this.age[a][b]=
this.currentDiamondSize,this.age[a][b+1]=this.currentDiamondSize,this.useSmoothColors?(this.hue[a][b]=.75-Math.atan2(a+.5-this.diamondSize,b+.5-this.diamondSize)/(2*Math.PI),this.hue[a][b+1]=.75-Math.atan2(a+.5-this.diamondSize,b+1.5-this.diamondSize)/(2*Math.PI)):(this.hue[a][b]=.25,this.hue[a][b+1]=.75))}};
