!async function(){"use strict";Site.scripts_loaded.glsl||await Site.load_glsl();let t=null,e=null,n=null,r=Page.element.querySelector("#line-drawer-canvas-container"),o=0,l=1,a=200,_=1,c=0,i=[],s=0,u=!1,h=500,d=200,w=0,m=0,f=0,z=0,v=0,p=0,g=!1,x=0,y=0,M=0,b=0,q=0,P=0;let A=-1,S={mandelbrot:["cmul(z, z) + c",(t,e,n,r)=>[t*t-e*e+n,2*t*e+r]],sfx:["cmul(z, dot(z, z)) - cmul(z, c*c)",(t,e,n,r)=>[t*t*t+t*e*e-t*n*n+e*r*r,t*t*e-t*r*r+e*e*e-e*n*n]],"burning-ship":["-vec2(z.x * z.x - z.y * z.y, 2.0 * abs(z.x * z.y)) + c",(t,e,n,r)=>[-(t*t-e*e)+n,-2*Math.abs(t*e)+r]],feather:["cdiv(cmul(cmul(z, z), z), ONE + z*z) + c",(t,e,n,r)=>[n+(t*t*t*t*t+t*t*t*(1-3*e*e)+3*t*t*e*e*e-3*t*e*e-e*e*e*e*e)/(t*t*t*t+2*t*t+e*e*e*e+1),r+e*(3*t*t*t*t-t*t*t*e-t*t*(e*e-3)+3*t*e*e*e-e*e)/(t*t*t*t+2*t*t+e*e*e*e+1)]],duffing:["vec2(z.y, -c.y * z.x + c.x * z.y - z.y * z.y * z.y)",(t,e,n,r)=>[e,-r*t+n*e-e*e*e]],ikeda:["vec2(1.0 + c.x * (z.x * cos(.4 - 6.0 / (1.0 + dot(z, z))) - z.y * sin(.4 - 6.0 / (1.0 + dot(z, z)))), c.y * (z.x * sin(.4 - 6.0 / (1.0 + dot(z, z))) + z.y * cos(.4 - 6.0 / (1.0 + dot(z, z)))))",(t,e,n,r)=>[1+n*(t*Math.cos(.4-6/(1+t*t+e*e))-e*Math.sin(.4-6/(1+t*t+e*e))),r*(t*Math.sin(.4-6/(1+t*t+e*e))+e*Math.cos(.4-6/(1+t*t+e*e)))]]},k=S.mandelbrot[1],F={renderer:"cpu",canvas_width:h,canvas_height:h,world_width:4,world_height:4,world_center_x:0,world_center_y:0,mousemove_callback:function(t,e,n,r,o){R(t,e),z=0},mousedown_callback:K,touchstart_callback:K,mousedrag_callback:j,touchmove_callback:j,mouseup_callback:N,touchend_callback:N,wheel_callback:function(t,e,n,r){w=t,m=e,Math.abs(n/100)<.3?(c+=n/100,c=Math.min(c,1)):P+=.05*Math.sign(n);v=t,p=e,g=!0,H()},pinch_callback:function(t,e,r,a){if(2===o)return;l>=1?(c-=r/n.world_width*10,M=-r/n.world_width*10):(c-=r/n.world_height*10,M=-r/n.world_height*10);c=Math.min(c,1),w=t,m=e,g=!1,H()},use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!1};n=new Wilson(Page.element.querySelector("#line-drawer-canvas"),F),Page.element.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),n.ctx.lineWidth=40;let E=Page.element.querySelector("#fractal-selector-dropdown");E.addEventListener("input",W);let L=Page.element.querySelector("#resolution-input");L.addEventListener("input",(()=>{h=parseInt(L.value||500),t.change_canvas_size(h,h),n.change_canvas_size(h,h),window.requestAnimationFrame($)}));let C=Page.element.querySelector("#exposure-input");C.addEventListener("input",(()=>{_=parseFloat(C.value||1),window.requestAnimationFrame($)}));let I=Page.element.querySelector("#num-iterations-input");I.addEventListener("input",(()=>{a=parseInt(I.value||200),window.requestAnimationFrame($)})),Page.element.querySelector("#download-button").addEventListener("click",(()=>{t.download_frame("a-sound-fractal.png")}));let T=Page.element.querySelector("#canvas-location");function W(){let r=S[E.value][0];k=S[E.value][1];let l=`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float world_center_x;\n\t\t\tuniform float world_center_y;\n\t\t\tuniform float world_size;\n\t\t\t\n\t\t\tuniform float exposure;\n\t\t\tuniform int num_iterations;\n\t\t\tuniform float brightness_scale;\n\t\t\t\n\t\t\tconst float hue_multiplier = 100.0;\n\t\t\t\n\t\t\tconst vec3 color_1 = vec3(1.0, 0.0, 0.0);\n\t\t\tconst vec3 color_2 = vec3(1.0, .4157, 0.0);\n\t\t\tconst vec3 color_3 = vec3(1.0, .8471, 0.0);\n\t\t\tconst vec3 color_4 = vec3(.7333, 1.0, 0.0);\n\t\t\tconst vec3 color_5 = vec3(.2980, 1.0, 0.0);\n\t\t\tconst vec3 color_6 = vec3(0.0, 1.0, .1137);\n\t\t\tconst vec3 color_7 = vec3(0.0, 1.0, .5490);\n\t\t\tconst vec3 color_8 = vec3(0.0, 1.0, .9647);\n\t\t\tconst vec3 color_9 = vec3(0.0, .6, 1.0);\n\t\t\tconst vec3 color_10 = vec3(0.0, .1804, 1.0);\n\t\t\tconst vec3 color_11 = vec3(.2471, 0.0, 1.0);\n\t\t\tconst vec3 color_12 = vec3(.6667, 0.0, 1.0);\n\t\t\tconst vec3 color_13 = vec3(1.0, 0.0, .8980);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t${Site.get_glsl_bundle(r)}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvec3 hsv2rgb(vec3 c)\n\t\t\t{\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z;\n\t\t\t\t\n\t\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat brightness = exp(-max(length(z), .5));\n\t\t\t\t\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 last_z_1 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_2 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_3 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_4 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_5 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_6 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_7 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_8 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_9 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_10 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_11 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_12 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_13 = vec2(0.0, 0.0);\n\t\t\t\t\n\t\t\t\tfloat hue_1 = 0.0;\n\t\t\t\tfloat hue_2 = 0.0;\n\t\t\t\tfloat hue_3 = 0.0;\n\t\t\t\tfloat hue_4 = 0.0;\n\t\t\t\tfloat hue_5 = 0.0;\n\t\t\t\tfloat hue_6 = 0.0;\n\t\t\t\tfloat hue_7 = 0.0;\n\t\t\t\tfloat hue_8 = 0.0;\n\t\t\t\tfloat hue_9 = 0.0;\n\t\t\t\tfloat hue_10 = 0.0;\n\t\t\t\tfloat hue_11 = 0.0;\n\t\t\t\tfloat hue_12 = 0.0;\n\t\t\t\tfloat hue_13 = 0.0;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 color = hue_1 * color_1 + hue_2 * color_2 + hue_3 * color_3 + hue_4 * color_4 + hue_5 * color_5 + hue_6 * color_6 + hue_7 * color_7 + hue_8 * color_8 + hue_9 * color_9 + hue_10 * color_10 + hue_11 * color_11 + hue_12 * color_12 + hue_13 * color_13;\n\t\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * exposure * normalize(color), 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 10.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlast_z_13 = last_z_12;\n\t\t\t\t\tlast_z_12 = last_z_11;\n\t\t\t\t\tlast_z_11 = last_z_10;\n\t\t\t\t\tlast_z_10 = last_z_9;\n\t\t\t\t\tlast_z_9 = last_z_8;\n\t\t\t\t\tlast_z_8 = last_z_7;\n\t\t\t\t\tlast_z_7 = last_z_6;\n\t\t\t\t\tlast_z_6 = last_z_5;\n\t\t\t\t\tlast_z_5 = last_z_4;\n\t\t\t\t\tlast_z_4 = last_z_3;\n\t\t\t\t\tlast_z_3 = last_z_2;\n\t\t\t\t\tlast_z_2 = last_z_1;\n\t\t\t\t\tlast_z_1 = z;\n\t\t\t\t\tz = ${r};\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-max(length(z), .5));\n\t\t\t\t\t\n\t\t\t\t\thue_1 += exp(-hue_multiplier * length(z - last_z_1));\n\t\t\t\t\thue_2 += exp(-hue_multiplier * length(z - last_z_2));\n\t\t\t\t\thue_3 += exp(-hue_multiplier * length(z - last_z_3));\n\t\t\t\t\thue_4 += exp(-hue_multiplier * length(z - last_z_4));\n\t\t\t\t\thue_5 += exp(-hue_multiplier * length(z - last_z_5));\n\t\t\t\t\thue_6 += exp(-hue_multiplier * length(z - last_z_6));\n\t\t\t\t\thue_7 += exp(-hue_multiplier * length(z - last_z_7));\n\t\t\t\t\thue_8 += exp(-hue_multiplier * length(z - last_z_8));\n\t\t\t\t\thue_9 += exp(-hue_multiplier * length(z - last_z_9));\n\t\t\t\t\thue_10 += exp(-hue_multiplier * length(z - last_z_10));\n\t\t\t\t\thue_11 += exp(-hue_multiplier * length(z - last_z_11));\n\t\t\t\t\thue_12 += exp(-hue_multiplier * length(z - last_z_12));\n\t\t\t\t\thue_13 += exp(-hue_multiplier * length(z - last_z_13));\n\t\t\t\t}\n\t\t\t}\n\t\t`,a={renderer:"gpu",shader:l,canvas_width:500,canvas_height:500,world_width:4,world_height:4,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:G},_={renderer:"gpu",shader:l,canvas_width:d,canvas_height:d};try{t.output_canvas_container.parentNode.remove(),e.output_canvas_container.parentNode.remove(),T.insertAdjacentHTML("beforebegin",'\n\t\t\t\t<div>\n\t\t\t\t\t<canvas id="output-canvas" class="output-canvas"></canvas>\n\t\t\t\t\t<canvas id="hidden-canvas" class="hidden-canvas"></canvas>\n\t\t\t\t</div>\n\t\t\t')}catch(t){}t=new Wilson(Page.element.querySelector("#output-canvas"),a),t.render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),e=new Wilson(Page.element.querySelector("#hidden-canvas"),_),e.render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),o=0,c=0,i=[],n.world_width=4,n.world_height=4,n.world_center_x=0,n.world_center_y=0,t.gl.uniform1f(t.uniforms.aspect_ratio,1),e.gl.uniform1f(e.uniforms.aspect_ratio,1),window.requestAnimationFrame($)}function K(t,e,n){b=0,q=0,P=0,x=0,y=0,M=0,s=0,u=!1,r.style.opacity=1,"touchstart"===n.type?(f=n.touches.length,1===f&&(R(t,e),D(t,e))):(z=0,R(t,e))}function j(e,r,o,l,a){"mousemove"===a.type||f>=2?((f>=2||Math.abs(o)>0||Math.abs(l)>0)&&n.ctx.clearRect(0,0,h,h),n.world_center_x-=o,n.world_center_y-=l,x=-o/t.world_width,y=-l/t.world_height,n.world_center_x=Math.min(Math.max(n.world_center_x,-2),2),n.world_center_y=Math.min(Math.max(n.world_center_y,-2),2),z++,window.requestAnimationFrame($)):R(e,r)}function N(t,e,n){"mouseup"===n.type||f>=2?(Math.sqrt(x*x+y*y)>=.0025&&(b=x,q=y,z=10),Math.abs(M)>=.01&&(P=M,z=10),z<10&&"mouseup"===n.type&&D(t,e)):(s=0,u=!0,window.requestAnimationFrame(B)),setTimeout((()=>f=0),50),z=0,window.requestAnimationFrame($)}function R(t,e){n.ctx.lineWidth=2,r.style.opacity=1,n.ctx.strokeStyle="rgb(255, 255, 255)",n.ctx.clearRect(0,0,h,h),n.ctx.beginPath();let o=n.utils.interpolate.world_to_canvas(t,e);n.ctx.moveTo(o[1],o[0]);let l=t,a=e,_=t,c=e,i=k(l,a,_,c);l=0,a=0;for(let t=0;t<300;t++){if(Math.abs(i[0])>10||Math.abs(i[1])>10)return;l=i[0],a=i[1],i=k(l,a,_,c),o=n.utils.interpolate.world_to_canvas(l,a),n.ctx.lineTo(o[1],o[0])}n.ctx.stroke()}function B(){s++;let t=.5+.5*Math.sin(Math.PI*s/30-Math.PI/2);r.style.opacity=1-t,s<30&&u?window.requestAnimationFrame(B):u=!1}function D(t,e){let n=new AudioContext,r=44100,o=Math.floor(3675),l=t,a=e,_=t,c=e,i=k(l,a,_,c);l=0,a=0;let s=0,u=new Array(o),h=new Array(o),d=n.createBuffer(2,r,44100),w=d.getChannelData(0),m=d.getChannelData(1);for(let t=0;t<o;t++){if(Math.abs(i[0])>100||Math.abs(i[1])>100)return;Math.abs(i[0])>s&&(s=Math.abs(i[0])),Math.abs(i[1])>s&&(s=Math.abs(i[1])),u[t]=l,h[t]=a,l=i[0],a=i[1],i=k(l,a,_,c)}for(let t=0;t<o;t++)u[t]/=s,h[t]/=s;for(let t=0;t<o-1;t++)for(let e=0;e<12;e++){let n=.5+.5*Math.sin(Math.PI*e/12-Math.PI/2);w[12*t+e]=(1-n)*(u[t]/2)+n*(u[t+1]/2),m[12*t+e]=(1-n)*(h[t]/2)+n*(h[t+1]/2)}let f=n.createBufferSource();f.buffer=d;let z=n.createGain();f.connect(z),z.connect(n.destination),f.start(0),z.gain.exponentialRampToValueAtTime(1e-4,1)}function H(){if(l>=1){let t=n.input.get_zoomed_world_center(w,m,4*Math.pow(2,c)*l,4*Math.pow(2,c));n.world_width=4*Math.pow(2,c)*l,n.world_height=4*Math.pow(2,c),n.world_center_x=t[0],n.world_center_y=t[1]}else{let t=n.input.get_zoomed_world_center(w,m,4*Math.pow(2,c),4*Math.pow(2,c)/l);n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)/l,n.world_center_x=t[0],n.world_center_y=t[1]}g&&R(v,p),window.requestAnimationFrame($)}function $(r){let o=r-A;if(A=r,0===o)return;e.gl.uniform1f(e.uniforms.world_center_x,n.world_center_x),e.gl.uniform1f(e.uniforms.world_center_y,n.world_center_y),e.gl.uniform1f(e.uniforms.world_size,Math.min(n.world_height,n.world_width)/2),e.gl.uniform1i(e.uniforms.num_iterations,a),e.gl.uniform1f(e.uniforms.exposure,1),e.gl.uniform1f(e.uniforms.brightness_scale,20*(Math.abs(c)+1)),e.render.draw_frame();let s=e.render.get_pixel_data(),u=new Array(4e4);for(let t=0;t<4e4;t++)u[t]=s[4*t]+s[4*t+1]+s[4*t+2];u.sort(((t,e)=>t-e));let h=(u[Math.floor(38400)]+u[Math.floor(39200)])/255*15*(Math.abs(c/2)+1);i.push(h);let d=i.length;d>10&&i.shift(),h=Math.max(i.reduce(((t,e)=>t+e))/d,.5),t.gl.uniform1f(t.uniforms.aspect_ratio,l),t.gl.uniform1f(t.uniforms.world_center_x,n.world_center_x),t.gl.uniform1f(t.uniforms.world_center_y,n.world_center_y),t.gl.uniform1f(t.uniforms.world_size,Math.min(n.world_height,n.world_width)/2),t.gl.uniform1i(t.uniforms.num_iterations,a),t.gl.uniform1f(t.uniforms.exposure,_),t.gl.uniform1f(t.uniforms.brightness_scale,h),t.render.draw_frame(),o>=50&&(b=0,q=0,P=0,x=0,y=0,M=0),0===b&&0===q&&0===P||(n.world_center_x+=b*n.world_width,n.world_center_y+=q*n.world_height,n.world_center_x=Math.min(Math.max(n.world_center_x,-2),2),n.world_center_y=Math.min(Math.max(n.world_center_y,-2),2),b*=.96,q*=.96,Math.sqrt(b*b+q*q)<25e-5&&(b=0,q=0),c+=P,c=Math.min(c,1),H(),P*=.93,Math.abs(P)<.001&&(P=0),window.requestAnimationFrame($))}function G(){O();try{document.body.querySelectorAll(".wilson-applet-canvas-container").forEach((t=>t.style.setProperty("background-color","rgba(0, 0, 0, 0)","important"))),document.body.querySelector(".wilson-exit-fullscreen-button").style.setProperty("z-index","300","important")}catch(t){}n.fullscreen.switch_fullscreen()}function O(){t.fullscreen.currently_fullscreen?(l=window.innerWidth/window.innerHeight,l>=1?(n.change_canvas_size(h,Math.floor(h/l)),t.change_canvas_size(h,Math.floor(h/l)),n.world_width=4*Math.pow(2,c)*l,n.world_height=4*Math.pow(2,c)):(n.change_canvas_size(Math.floor(h*l),h),t.change_canvas_size(Math.floor(h*l),h),n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)/l)):(l=1,n.change_canvas_size(h,h),t.change_canvas_size(h,h),n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)),window.requestAnimationFrame($)}W(),Page.show(),window.addEventListener("resize",O),Page.temporary_handlers.resize.push(O)}();