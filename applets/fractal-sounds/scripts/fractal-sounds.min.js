!async function(){"use strict";Site.scripts_loaded.glsl||await Site.load_glsl();let t=null,e=null,n=null,o=document.querySelector("#line-drawer-canvas-container"),r=0,l=1,a=200,_=1,c=0,i=[],s=0,u=!1,h=500,d=200,w=0,m=0,f=0,z=0,v=0,p=0,g=!1,x=0,y=0,M=0,b=0,q=0,A=0;const S=.96,k=.0025,F=25e-5,L=.93,P=.01,E=.001;let C=-1,I={mandelbrot:["cmul(z, z) + c",(t,e,n,o)=>[t*t-e*e+n,2*t*e+o]],sfx:["cmul(z, dot(z, z)) - cmul(z, c*c)",(t,e,n,o)=>[t*t*t+t*e*e-t*n*n+e*o*o,t*t*e-t*o*o+e*e*e-e*n*n]],"burning-ship":["-vec2(z.x * z.x - z.y * z.y, 2.0 * abs(z.x * z.y)) + c",(t,e,n,o)=>[-(t*t-e*e)+n,-2*Math.abs(t*e)+o]],feather:["cdiv(cmul(cmul(z, z), z), ONE + z*z) + c",(t,e,n,o)=>[n+(t*t*t*t*t+t*t*t*(1-3*e*e)+3*t*t*e*e*e-3*t*e*e-e*e*e*e*e)/(t*t*t*t+2*t*t+e*e*e*e+1),o+e*(3*t*t*t*t-t*t*t*e-t*t*(e*e-3)+3*t*e*e*e-e*e)/(t*t*t*t+2*t*t+e*e*e*e+1)]],duffing:["vec2(z.y, -c.y * z.x + c.x * z.y - z.y * z.y * z.y)",(t,e,n,o)=>[e,-o*t+n*e-e*e*e]],ikeda:["vec2(1.0 + c.x * (z.x * cos(.4 - 6.0 / (1.0 + dot(z, z))) - z.y * sin(.4 - 6.0 / (1.0 + dot(z, z)))), c.y * (z.x * sin(.4 - 6.0 / (1.0 + dot(z, z))) + z.y * cos(.4 - 6.0 / (1.0 + dot(z, z)))))",(t,e,n,o)=>[1+n*(t*Math.cos(.4-6/(1+t*t+e*e))-e*Math.sin(.4-6/(1+t*t+e*e))),o*(t*Math.sin(.4-6/(1+t*t+e*e))+e*Math.cos(.4-6/(1+t*t+e*e)))]]},T=I.mandelbrot[1],W={renderer:"cpu",canvas_width:h,canvas_height:h,world_width:4,world_height:4,world_center_x:0,world_center_y:0,mousemove_callback:function(t,e,n,o,r){$(t,e),z=0},mousedown_callback:G,touchstart_callback:G,mousedrag_callback:H,touchmove_callback:H,mouseup_callback:O,touchend_callback:O,wheel_callback:function(t,e,n,o){w=t,m=e,Math.abs(n/100)<.3?(c+=n/100,c=Math.min(c,1)):A+=.05*Math.sign(n);v=t,p=e,g=!0,J()},pinch_callback:function(t,e,o,a){if(2===r)return;l>=1?(c-=o/n.world_width*10,M=-o/n.world_width*10):(c-=o/n.world_height*10,M=-o/n.world_height*10);c=Math.min(c,1),w=t,m=e,g=!1,J()},use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!1};n=new Wilson(document.querySelector("#line-drawer-canvas"),W),document.querySelector(".wilson-fullscreen-components-container").style.setProperty("z-index",200,"important"),n.ctx.lineWidth=40;let K=document.querySelector("#fractal-selector-dropdown");K.addEventListener("input",D);let j=document.querySelector("#resolution-input");j.addEventListener("input",()=>{h=parseInt(j.value||500),t.change_canvas_size(h,h),n.change_canvas_size(h,h),window.requestAnimationFrame(Q)});let N=document.querySelector("#exposure-input");N.addEventListener("input",()=>{_=parseFloat(N.value||1),window.requestAnimationFrame(Q)});let R=document.querySelector("#num-iterations-input");R.addEventListener("input",()=>{a=parseInt(R.value||200),window.requestAnimationFrame(Q)}),document.querySelector("#download-button").addEventListener("click",()=>{t.download_frame("a-sound-fractal.png")});let B=document.querySelector("#canvas-location");function D(){let o=I[K.value][0];T=I[K.value][1];let l=`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float world_center_x;\n\t\t\tuniform float world_center_y;\n\t\t\tuniform float world_size;\n\t\t\t\n\t\t\tuniform float exposure;\n\t\t\tuniform int num_iterations;\n\t\t\tuniform float brightness_scale;\n\t\t\t\n\t\t\tconst float hue_multiplier = 100.0;\n\t\t\t\n\t\t\tconst vec3 color_1 = vec3(1.0, 0.0, 0.0);\n\t\t\tconst vec3 color_2 = vec3(1.0, .4157, 0.0);\n\t\t\tconst vec3 color_3 = vec3(1.0, .8471, 0.0);\n\t\t\tconst vec3 color_4 = vec3(.7333, 1.0, 0.0);\n\t\t\tconst vec3 color_5 = vec3(.2980, 1.0, 0.0);\n\t\t\tconst vec3 color_6 = vec3(0.0, 1.0, .1137);\n\t\t\tconst vec3 color_7 = vec3(0.0, 1.0, .5490);\n\t\t\tconst vec3 color_8 = vec3(0.0, 1.0, .9647);\n\t\t\tconst vec3 color_9 = vec3(0.0, .6, 1.0);\n\t\t\tconst vec3 color_10 = vec3(0.0, .1804, 1.0);\n\t\t\tconst vec3 color_11 = vec3(.2471, 0.0, 1.0);\n\t\t\tconst vec3 color_12 = vec3(.6667, 0.0, 1.0);\n\t\t\tconst vec3 color_13 = vec3(1.0, 0.0, .8980);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t${COMPLEX_GLSL}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvec3 hsv2rgb(vec3 c)\n\t\t\t{\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z;\n\t\t\t\t\n\t\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat brightness = exp(-max(length(z), .5));\n\t\t\t\t\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 last_z_1 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_2 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_3 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_4 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_5 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_6 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_7 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_8 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_9 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_10 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_11 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_12 = vec2(0.0, 0.0);\n\t\t\t\tvec2 last_z_13 = vec2(0.0, 0.0);\n\t\t\t\t\n\t\t\t\tfloat hue_1 = 0.0;\n\t\t\t\tfloat hue_2 = 0.0;\n\t\t\t\tfloat hue_3 = 0.0;\n\t\t\t\tfloat hue_4 = 0.0;\n\t\t\t\tfloat hue_5 = 0.0;\n\t\t\t\tfloat hue_6 = 0.0;\n\t\t\t\tfloat hue_7 = 0.0;\n\t\t\t\tfloat hue_8 = 0.0;\n\t\t\t\tfloat hue_9 = 0.0;\n\t\t\t\tfloat hue_10 = 0.0;\n\t\t\t\tfloat hue_11 = 0.0;\n\t\t\t\tfloat hue_12 = 0.0;\n\t\t\t\tfloat hue_13 = 0.0;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 color = hue_1 * color_1 + hue_2 * color_2 + hue_3 * color_3 + hue_4 * color_4 + hue_5 * color_5 + hue_6 * color_6 + hue_7 * color_7 + hue_8 * color_8 + hue_9 * color_9 + hue_10 * color_10 + hue_11 * color_11 + hue_12 * color_12 + hue_13 * color_13;\n\t\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * exposure * normalize(color), 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 10.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlast_z_13 = last_z_12;\n\t\t\t\t\tlast_z_12 = last_z_11;\n\t\t\t\t\tlast_z_11 = last_z_10;\n\t\t\t\t\tlast_z_10 = last_z_9;\n\t\t\t\t\tlast_z_9 = last_z_8;\n\t\t\t\t\tlast_z_8 = last_z_7;\n\t\t\t\t\tlast_z_7 = last_z_6;\n\t\t\t\t\tlast_z_6 = last_z_5;\n\t\t\t\t\tlast_z_5 = last_z_4;\n\t\t\t\t\tlast_z_4 = last_z_3;\n\t\t\t\t\tlast_z_3 = last_z_2;\n\t\t\t\t\tlast_z_2 = last_z_1;\n\t\t\t\t\tlast_z_1 = z;\n\t\t\t\t\tz = ${o};\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-max(length(z), .5));\n\t\t\t\t\t\n\t\t\t\t\thue_1 += exp(-hue_multiplier * length(z - last_z_1));\n\t\t\t\t\thue_2 += exp(-hue_multiplier * length(z - last_z_2));\n\t\t\t\t\thue_3 += exp(-hue_multiplier * length(z - last_z_3));\n\t\t\t\t\thue_4 += exp(-hue_multiplier * length(z - last_z_4));\n\t\t\t\t\thue_5 += exp(-hue_multiplier * length(z - last_z_5));\n\t\t\t\t\thue_6 += exp(-hue_multiplier * length(z - last_z_6));\n\t\t\t\t\thue_7 += exp(-hue_multiplier * length(z - last_z_7));\n\t\t\t\t\thue_8 += exp(-hue_multiplier * length(z - last_z_8));\n\t\t\t\t\thue_9 += exp(-hue_multiplier * length(z - last_z_9));\n\t\t\t\t\thue_10 += exp(-hue_multiplier * length(z - last_z_10));\n\t\t\t\t\thue_11 += exp(-hue_multiplier * length(z - last_z_11));\n\t\t\t\t\thue_12 += exp(-hue_multiplier * length(z - last_z_12));\n\t\t\t\t\thue_13 += exp(-hue_multiplier * length(z - last_z_13));\n\t\t\t\t}\n\t\t\t}\n\t\t`,a={renderer:"gpu",shader:l,canvas_width:500,canvas_height:500,world_width:4,world_height:4,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:U},_={renderer:"gpu",shader:l,canvas_width:d,canvas_height:d};try{t.output_canvas_container.parentNode.remove(),e.output_canvas_container.parentNode.remove(),B.insertAdjacentHTML("beforebegin",'\n\t\t\t\t<div>\n\t\t\t\t\t<canvas id="output-canvas" class="output-canvas"></canvas>\n\t\t\t\t\t<canvas id="hidden-canvas" class="hidden-canvas"></canvas>\n\t\t\t\t</div>\n\t\t\t')}catch(t){}(t=new Wilson(document.querySelector("#output-canvas"),a)).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),(e=new Wilson(document.querySelector("#hidden-canvas"),_)).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),r=0,c=0,i=[],n.world_width=4,n.world_height=4,n.world_center_x=0,n.world_center_y=0,t.gl.uniform1f(t.uniforms.aspect_ratio,1),e.gl.uniform1f(e.uniforms.aspect_ratio,1),window.requestAnimationFrame(Q)}function G(t,e,n){b=0,q=0,A=0,x=0,y=0,M=0,s=0,u=!1,o.style.opacity=1,"touchstart"===n.type?1===(f=n.touches.length)&&($(t,e),X(t,e)):(z=0,$(t,e))}function H(e,o,r,l,a){"mousemove"===a.type||f>=2?((f>=2||Math.abs(r)>0||Math.abs(l)>0)&&n.ctx.clearRect(0,0,h,h),n.world_center_x-=r,n.world_center_y-=l,x=-r/t.world_width,y=-l/t.world_height,n.world_center_x=Math.min(Math.max(n.world_center_x,-2),2),n.world_center_y=Math.min(Math.max(n.world_center_y,-2),2),z++,window.requestAnimationFrame(Q)):$(e,o)}function O(t,e,n){"mouseup"===n.type||f>=2?(Math.sqrt(x*x+y*y)>=k&&(b=x,q=y,z=10),Math.abs(M)>=P&&(A=M,z=10),z<10&&"mouseup"===n.type&&X(t,e)):(s=0,u=!0,window.requestAnimationFrame(V)),setTimeout(()=>f=0,50),z=0,window.requestAnimationFrame(Q)}function $(t,e){n.ctx.lineWidth=2,o.style.opacity=1,n.ctx.strokeStyle="rgb(255, 255, 255)",n.ctx.clearRect(0,0,h,h),n.ctx.beginPath();let r=n.utils.interpolate.world_to_canvas(t,e);n.ctx.moveTo(r[1],r[0]);let l=t,a=e,_=t,c=e,i=T(l,a,_,c);l=0,a=0;for(let t=0;t<300;t++){if(Math.abs(i[0])>10||Math.abs(i[1])>10)return;l=i[0],a=i[1],i=T(l,a,_,c),r=n.utils.interpolate.world_to_canvas(l,a),n.ctx.lineTo(r[1],r[0])}n.ctx.stroke()}function V(){s++;let t=.5+.5*Math.sin(Math.PI*s/30-Math.PI/2);o.style.opacity=1-t,s<30&&u?window.requestAnimationFrame(V):u=!1}function X(t,e){let n=new AudioContext,o=Math.floor(3675),r=t,l=e,a=t,_=e,c=T(r,l,a,_);r=0,l=0;let i=0,s=new Array(o),u=new Array(o),h=n.createBuffer(2,44100,44100),d=h.getChannelData(0),w=h.getChannelData(1);for(let t=0;t<o;t++){if(Math.abs(c[0])>100||Math.abs(c[1])>100)return;Math.abs(c[0])>i&&(i=Math.abs(c[0])),Math.abs(c[1])>i&&(i=Math.abs(c[1])),s[t]=r,u[t]=l,r=c[0],l=c[1],c=T(r,l,a,_)}for(let t=0;t<o;t++)s[t]/=i,u[t]/=i;for(let t=0;t<o-1;t++)for(let e=0;e<12;e++){let n=.5+.5*Math.sin(Math.PI*e/12-Math.PI/2);d[12*t+e]=(1-n)*(s[t]/2)+n*(s[t+1]/2),w[12*t+e]=(1-n)*(u[t]/2)+n*(u[t+1]/2)}let m=n.createBufferSource();m.buffer=h;let f=n.createGain();m.connect(f),f.connect(n.destination),m.start(0),f.gain.exponentialRampToValueAtTime(1e-4,1)}function J(){if(l>=1){let t=n.input.get_zoomed_world_center(w,m,4*Math.pow(2,c)*l,4*Math.pow(2,c));n.world_width=4*Math.pow(2,c)*l,n.world_height=4*Math.pow(2,c),n.world_center_x=t[0],n.world_center_y=t[1]}else{let t=n.input.get_zoomed_world_center(w,m,4*Math.pow(2,c),4*Math.pow(2,c)/l);n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)/l,n.world_center_x=t[0],n.world_center_y=t[1]}g&&$(v,p),window.requestAnimationFrame(Q)}function Q(o){let r=o-C;if(C=o,0===r)return;e.gl.uniform1f(e.uniforms.world_center_x,n.world_center_x),e.gl.uniform1f(e.uniforms.world_center_y,n.world_center_y),e.gl.uniform1f(e.uniforms.world_size,Math.min(n.world_height,n.world_width)/2),e.gl.uniform1i(e.uniforms.num_iterations,a),e.gl.uniform1f(e.uniforms.exposure,1),e.gl.uniform1f(e.uniforms.brightness_scale,20*(Math.abs(c)+1)),e.render.draw_frame();let s=e.render.get_pixel_data(),u=new Array(d*d);for(let t=0;t<d*d;t++)u[t]=s[4*t]+s[4*t+1]+s[4*t+2];u.sort((t,e)=>t-e);let h=(u[Math.floor(d*d*.96)]+u[Math.floor(d*d*.98)])/255*15*(Math.abs(c/2)+1);i.push(h);let w=i.length;w>10&&i.shift(),h=Math.max(i.reduce((t,e)=>t+e)/w,.5),t.gl.uniform1f(t.uniforms.aspect_ratio,l),t.gl.uniform1f(t.uniforms.world_center_x,n.world_center_x),t.gl.uniform1f(t.uniforms.world_center_y,n.world_center_y),t.gl.uniform1f(t.uniforms.world_size,Math.min(n.world_height,n.world_width)/2),t.gl.uniform1i(t.uniforms.num_iterations,a),t.gl.uniform1f(t.uniforms.exposure,_),t.gl.uniform1f(t.uniforms.brightness_scale,h),t.render.draw_frame(),r>=50&&(b=0,q=0,A=0,x=0,y=0,M=0),0===b&&0===q&&0===A||(n.world_center_x+=b*n.world_width,n.world_center_y+=q*n.world_height,n.world_center_x=Math.min(Math.max(n.world_center_x,-2),2),n.world_center_y=Math.min(Math.max(n.world_center_y,-2),2),b*=S,q*=S,Math.sqrt(b*b+q*q)<F&&(b=0,q=0),c+=A,c=Math.min(c,1),J(),A*=L,Math.abs(A)<E&&(A=0),window.requestAnimationFrame(Q))}function U(){Y(),Page.set_element_styles(".wilson-applet-canvas-container","background-color","rgba(0, 0, 0, 0)",!0),Page.set_element_styles(".wilson-exit-fullscreen-button","z-index","300",!0),n.fullscreen.switch_fullscreen()}function Y(){t.fullscreen.currently_fullscreen?(l=window.innerWidth/window.innerHeight)>=1?(n.change_canvas_size(h,Math.floor(h/l)),t.change_canvas_size(h,Math.floor(h/l)),n.world_width=4*Math.pow(2,c)*l,n.world_height=4*Math.pow(2,c)):(n.change_canvas_size(Math.floor(h*l),h),t.change_canvas_size(Math.floor(h*l),h),n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)/l):(l=1,n.change_canvas_size(h,h),t.change_canvas_size(h,h),n.world_width=4*Math.pow(2,c),n.world_height=4*Math.pow(2,c)),window.requestAnimationFrame(Q)}D(),window.addEventListener("resize",Y),Page.temporary_handlers.resize.push(Y)}();