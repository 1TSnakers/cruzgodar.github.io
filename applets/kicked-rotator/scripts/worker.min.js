"use strict";let gridSize=null,K=null,orbitSeparation=null,image=[],currentRow=null,currentCol=null,currentP=null,currentTheta=null;function drawKickedRotator(){var middleCol=Math.floor(gridSize/2);for(let i=1;i<gridSize/2;i+=orbitSeparation+1){image=new Array(gridSize*gridSize);for(let j=0;j<gridSize;j++)for(let k=0;k<gridSize;k++)image[gridSize*j+k]=0;var color=6/7*i/(gridSize/2),rand=Math.floor(Math.random()*(2*orbitSeparation+1))-orbitSeparation,rand=calculateOrbit(Math.floor(gridSize/2+i),middleCol+rand,color);if(-1!==rand){if(rand<.45)for(let j=0;j<gridSize;j++)for(let k=0;k<gridSize;k++)0!==image[gridSize*j+k]&&(image[gridSize*(gridSize-j-1)+gridSize-k-1]=image[gridSize*j+k]);postMessage([image,color])}}}function calculateOrbit(startRow,startCol){let numUpperHalfPoints=0;if(currentRow=startRow,currentCol=startCol,0!==image[gridSize*currentRow+currentCol])return-1;currentP=(1-currentRow/gridSize)*(2*Math.PI),currentTheta=currentCol/gridSize*(2*Math.PI);let numPoints=0;for(;image[gridSize*currentRow+currentCol]++,numPoints++,currentRow<gridSize/2&&numUpperHalfPoints++,300!==image[gridSize*currentRow+currentCol];){for(currentP+=K*Math.sin(currentTheta),currentTheta+=currentP;currentP>=2*Math.PI;)currentP-=2*Math.PI;for(;currentTheta>=2*Math.PI;)currentTheta-=2*Math.PI;for(;currentP<0;)currentP+=2*Math.PI;for(;currentTheta<0;)currentTheta+=2*Math.PI;currentRow=Math.floor((1-currentP/(2*Math.PI))*gridSize),currentCol=Math.floor(currentTheta/(2*Math.PI)*gridSize)}return numUpperHalfPoints/numPoints}onmessage=e=>{gridSize=e.data[0],K=e.data[1],orbitSeparation=e.data[2],drawKickedRotator()};