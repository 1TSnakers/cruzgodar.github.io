!function(){"use strict";let t="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float world_center_x;\n\t\tuniform float world_center_y;\n\t\tuniform float world_size;\n\t\t\n\t\tuniform int num_roots;\n\t\t\n\t\tuniform vec2 roots[8];\n\t\t\n\t\tuniform vec3 colors[8];\n\t\t\n\t\tuniform vec2 a;\n\t\tuniform vec2 c;\n\t\t\n\t\tuniform float brightness_scale;\n\t\t\n\t\tconst float threshhold = .05;\n\t\t\n\t\t\n\t\t\n\t\t//Returns z_1 * z_2.\n\t\tvec2 cmul(vec2 z_1, vec2 z_2)\n\t\t{\n\t\t\treturn vec2(z_1.x * z_2.x - z_1.y * z_2.y, z_1.x * z_2.y + z_1.y * z_2.x);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns 1/z.\n\t\tvec2 cinv(vec2 z)\n\t\t{\n\t\t\tfloat magnitude = z.x*z.x + z.y*z.y;\n\t\t\t\n\t\t\treturn vec2(z.x / magnitude, -z.y / magnitude);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns f(z) for a polynomial f with given roots.\n\t\tvec2 cpoly(vec2 z)\n\t\t{\n\t\t\tvec2 result = vec2(1.0, 0.0);\n\t\t\t\n\t\t\tfor (int i = 0; i <= 8; i++)\n\t\t\t{\n\t\t\t\tif (i == num_roots)\n\t\t\t\t{\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tresult = cmul(result, z - roots[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Approximates f'(z) for a polynomial f with given roots.\n\t\tvec2 cderiv(vec2 z)\n\t\t{\n\t\t\treturn 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z;\n\t\t\tvec2 last_z = vec2(0.0, 0.0);\n\t\t\t\n\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tvec2 temp = cmul(cmul(cpoly(z), cinv(cderiv(z))), a) + c;\n\t\t\t\t\n\t\t\t\tlast_z = z;\n\t\t\t\t\n\t\t\t\tz -= temp;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int i = 0; i <= 8; i++)\n\t\t\t\t{\n\t\t\t\t\tif (i == num_roots)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfloat d_0 = length(z - roots[i]);\n\t\t\t\t\t\n\t\t\t\t\tif (d_0 < threshhold)\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat d_1 = length(last_z - roots[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness_adjust = (log(threshhold) - log(d_0)) / (log(d_1) - log(d_0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness = 1.0 - (float(iteration) - brightness_adjust) / brightness_scale;\n\t\t\t\t\t\t\n\t\t\t\t\t\tgl_FragColor = vec4(colors[i] * brightness, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t",e={renderer:"gpu",shader:t,canvas_width:500,canvas_height:500,world_width:3,world_height:3,world_center_x:0,world_center_y:0,use_draggables:!0,draggables_mousemove_callback:K,draggables_touchmove_callback:K,draggables_mouseup_callback:Q,draggables_touchend_callback:Q,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:V,mousedown_callback:T,touchstart_callback:T,mousedrag_callback:B,touchmove_callback:B,mouseup_callback:D,touchend_callback:D,wheel_callback:function(t,e,n,r){p=t,b=e,Math.abs(n/100)<.3?f+=n/100:F+=.05*Math.sign(n);G()},pinch_callback:function(t,e,n,o){d>=1?(f-=n/r.world_width*10,M=-n/r.world_width*10):(f-=n/r.world_height*10,M=-n/r.world_height*10);p=t,b=e,G()}},n={renderer:"gpu",shader:t,canvas_width:100,canvas_height:100},r=new Wilson(Page.element.querySelector("#output-canvas"),e);r.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let o=new Wilson(Page.element.querySelector("#hidden-canvas"),n);o.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let a=[1,0],l=[0,0],i=[],s=0,c=0,d=1,u=!1,_=0,g=[],h=[],f=0,w=[],m=500,v=100,p=0,b=0,z=0,y=0,M=0,x=0,q=0,F=0;const k=.96,P=.0025,A=25e-5,S=.93,L=.01,E=.001;let I=-1,R=r.draggables.add(1,0);R.classList.add("a-marker"),(R=r.draggables.add(0,0)).classList.add("c-marker"),N(),N(),N(),O(!0);let W=Page.element.querySelector("#resolution-input");W.addEventListener("input",()=>{m=parseInt(W.value||500),r.change_canvas_size(m,m),window.requestAnimationFrame(U)}),Page.element.querySelector("#add-root-button").addEventListener("click",N),Page.element.querySelector("#remove-root-button").addEventListener("click",function(){if(1===c)return;c--,i.pop(),i.pop(),r.draggables.draggables[c+2].remove(),r.draggables.draggables.pop(),r.draggables.world_coordinates.pop(),r.draggables.num_draggables--,window.requestAnimationFrame(U)}),Page.element.querySelector("#spread-roots-button").addEventListener("click",()=>O(!1)),Page.element.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("newtons-method.png")});let j=Page.element.querySelector("#root-a-input"),C=Page.element.querySelector("#root-b-input");j.addEventListener("input",H),C.addEventListener("input",H);let J=Page.element.querySelector("#root-setter");function N(){if(8===c)return;let t=3*Math.random()-1.5,e=3*Math.random()-1.5;r.draggables.add(t,e),i.push(t),i.push(e),c++,window.requestAnimationFrame(U)}function O(t=!1){u||(u=!0,_=0),g=JSON.parse(JSON.stringify(i));for(let t=0;t<c;t++)t<c/2||c%2==1?(h[2*t]=Math.cos(2*Math.PI*2*t/c)-i[2*t],h[2*t+1]=Math.sin(2*Math.PI*2*t/c)-i[2*t+1]):(h[2*t]=Math.cos(2*Math.PI*(2*t+1)/c)-i[2*t],h[2*t+1]=Math.sin(2*Math.PI*(2*t+1)/c)-i[2*t+1]);if(t){u=!1;for(let t=0;t<c;t++)i[2*t]=g[2*t]+h[2*t],i[2*t+1]=g[2*t+1]+h[2*t+1],r.draggables.world_coordinates[t+2]=[i[2*t],i[2*t+1]];r.draggables.recalculate_locations()}window.requestAnimationFrame(U)}function H(){0===s?(a[0]=parseFloat(j.value||1),a[1]=parseFloat(C.value||0),r.draggables.world_coordinates[0]=[a[0],a[1]]):1===s?(l[0]=10*parseFloat(j.value||0),l[1]=10*parseFloat(C.value||0),r.draggables.world_coordinates[1]=[l[0],l[1]]):(i[2*(s-2)]=parseFloat(j.value||0),i[2*(s-2)+1]=parseFloat(C.value||0),r.draggables.world_coordinates[s-2]=[i[2*(s-2)],i[2*(s-2)+1]]),window.requestAnimationFrame(U),r.draggables.recalculate_locations()}function T(t,e,n){x=0,q=0,F=0,z=0,y=0,M=0}function B(t,e,n,o,a){r.world_center_x-=n,r.world_center_y-=o,z=-n/r.world_width,y=-o/r.world_height,window.requestAnimationFrame(U),r.draggables.recalculate_locations()}function D(t,e,n){Math.sqrt(z*z+y*y)>=P&&(x=z,q=y),Math.abs(M)>=L&&(F=M),window.requestAnimationFrame(U)}function G(){if(d>=1){let t=r.input.get_zoomed_world_center(p,b,3*Math.pow(2,f)*d,3*Math.pow(2,f));r.world_width=3*Math.pow(2,f)*d,r.world_height=3*Math.pow(2,f),r.world_center_x=t[0],r.world_center_y=t[1]}else{let t=r.input.get_zoomed_world_center(p,b,3*Math.pow(2,f),3*Math.pow(2,f)/d);r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)/d,r.world_center_x=t[0],r.world_center_y=t[1]}window.requestAnimationFrame(U),r.draggables.recalculate_locations()}function K(t,e,n,r){0===t?a=[e,n]:1===t?l=[e,n]:(i[2*(t-2)]=e,i[2*(t-2)+1]=n),window.requestAnimationFrame(U)}function Q(t,e,n,r){J.style.opacity=0,setTimeout(()=>{0===(s=t)?(j.value=Math.round(1e3*a[0])/1e3,C.value=Math.round(1e3*a[1])/1e3):1===s?(j.value=Math.round(1e3*l[0])/1e4,C.value=Math.round(1e3*l[1])/1e4):(j.value=Math.round(1e3*i[2*(s-2)])/1e3,C.value=Math.round(1e3*i[2*(s-2)+1])/1e3),J.style.opacity=1},Site.opacity_animation_time)}function U(t){let e=t-I;if(I=t,0===e)return;o.gl.uniform1f(o.uniforms.aspect_ratio,d),o.gl.uniform1f(o.uniforms.world_center_x,r.world_center_x),o.gl.uniform1f(o.uniforms.world_center_y,r.world_center_y),o.gl.uniform1f(o.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),o.gl.uniform1i(o.uniforms.num_roots,c),o.gl.uniform2fv(o.uniforms.roots,i),o.gl.uniform2fv(o.uniforms.a,a),o.gl.uniform2f(o.uniforms.c,l[0]/10,l[1]/10),o.gl.uniform1f(o.uniforms.brightness_scale,30),o.render.draw_frame();let n=o.render.get_pixel_data(),s=new Array(v*v);for(let t=0;t<v*v;t++)s[t]=Math.max(Math.max(n[4*t],n[4*t+1]),n[4*t+2]);s.sort((t,e)=>t-e);let m=Math.min(1e4/(s[Math.floor(v*v*.96)]+s[Math.floor(v*v*.98)]),200);w.push(m);let p=w.length;p>10&&w.shift(),m=Math.max(w.reduce((t,e)=>t+e)/p,.5),r.gl.uniform1f(r.uniforms.aspect_ratio,d),r.gl.uniform1f(r.uniforms.world_center_x,r.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,r.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),r.gl.uniform1i(r.uniforms.num_roots,c),r.gl.uniform2fv(r.uniforms.roots,i),r.gl.uniform2fv(r.uniforms.a,a),r.gl.uniform2f(r.uniforms.c,l[0]/10,l[1]/10),r.gl.uniform1f(r.uniforms.brightness_scale,m),r.render.draw_frame(),u&&function(){let t=.5*Math.sin(Math.PI*_/120-Math.PI/2)+.5;for(let e=0;e<c;e++)i[2*e]=g[2*e]+h[2*e]*t,i[2*e+1]=g[2*e+1]+h[2*e+1]*t,r.draggables.world_coordinates[e+2]=[i[2*e],i[2*e+1]];window.requestAnimationFrame(U),r.draggables.recalculate_locations(),121==++_&&(u=!1)}(),e>=50&&(x=0,q=0,F=0,z=0,y=0,M=0),0===x&&0===q&&0===F||(r.world_center_x+=x*r.world_width,r.world_center_y+=q*r.world_height,x*=k,q*=k,Math.sqrt(x*x+q*q)<A&&(x=0,q=0),f+=F,G(),F*=S,Math.abs(F)<E&&(F=0),window.requestAnimationFrame(U),r.draggables.recalculate_locations())}function V(){r.fullscreen.currently_fullscreen?(d=window.innerWidth/window.innerHeight)>=1?(r.change_canvas_size(m,Math.floor(m/d)),r.world_width=3*Math.pow(2,f)*d,r.world_height=3*Math.pow(2,f)):(r.change_canvas_size(Math.floor(m*d),m),r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)/d):(d=1,r.change_canvas_size(m,m),r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)),window.requestAnimationFrame(U)}r.gl.uniform1f(r.uniforms.aspect_ratio,1),r.gl.uniform3fv(r.uniforms.colors,[1,0,0,0,1,0,0,0,1,0,1,1,1,0,1,1,1,0,.5,0,1,1,.5,0]),o.gl.uniform3fv(o.uniforms.colors,[1,0,0,0,1,0,0,0,1,0,1,1,1,0,1,1,1,0,.5,0,1,1,.5,0]),window.requestAnimationFrame(U),Page.show(),window.addEventListener("resize",V),Page.temporary_handlers.resize.push(V)}();