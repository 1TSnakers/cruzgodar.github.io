!function(){"use strict";let t="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float world_center_x;\n\t\tuniform float world_center_y;\n\t\tuniform float world_size;\n\t\t\n\t\tuniform int num_roots;\n\t\t\n\t\tuniform vec2 roots[11];\n\t\t\n\t\tuniform vec3 colors[11];\n\t\t\n\t\tuniform vec2 a;\n\t\tuniform vec2 c;\n\t\t\n\t\tuniform float brightness_scale;\n\t\t\n\t\tconst float threshhold = .05;\n\t\t\n\t\t\n\t\t\n\t\t//Returns z_1 * z_2.\n\t\tvec2 cmul(vec2 z_1, vec2 z_2)\n\t\t{\n\t\t\treturn vec2(z_1.x * z_2.x - z_1.y * z_2.y, z_1.x * z_2.y + z_1.y * z_2.x);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns 1/z.\n\t\tvec2 cinv(vec2 z)\n\t\t{\n\t\t\tfloat magnitude = z.x*z.x + z.y*z.y;\n\t\t\t\n\t\t\treturn vec2(z.x / magnitude, -z.y / magnitude);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Returns f(z) for a polynomial f with given roots.\n\t\tvec2 cpoly(vec2 z)\n\t\t{\n\t\t\tvec2 result = vec2(1.0, 0.0);\n\t\t\t\n\t\t\tfor (int i = 0; i <= 11; i++)\n\t\t\t{\n\t\t\t\tif (i == num_roots)\n\t\t\t\t{\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tresult = cmul(result, z - roots[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//Approximates f'(z) for a polynomial f with given roots.\n\t\tvec2 cderiv(vec2 z)\n\t\t{\n\t\t\treturn 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z;\n\t\t\tvec2 last_z = vec2(0.0, 0.0);\n\t\t\t\n\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tvec2 temp = cmul(cmul(cpoly(z), cinv(cderiv(z))), a) + c;\n\t\t\t\t\n\t\t\t\tlast_z = z;\n\t\t\t\t\n\t\t\t\tz -= temp;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int i = 0; i <= 11; i++)\n\t\t\t\t{\n\t\t\t\t\tif (i == num_roots)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfloat d_0 = length(z - roots[i]);\n\t\t\t\t\t\n\t\t\t\t\tif (d_0 < threshhold)\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat d_1 = length(last_z - roots[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness_adjust = (log(threshhold) - log(d_0)) / (log(d_1) - log(d_0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness = 1.0 - (float(iteration) - brightness_adjust) / brightness_scale;\n\t\t\t\t\t\t\n\t\t\t\t\t\tgl_FragColor = vec4(colors[i] * brightness, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t",e={renderer:"gpu",shader:t,canvas_width:500,canvas_height:500,world_width:3,world_height:3,world_center_x:0,world_center_y:0,use_draggables:!0,draggables_mousemove_callback:U,draggables_touchmove_callback:U,draggables_mouseup_callback:V,draggables_touchend_callback:V,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:Y,mousedown_callback:D,touchstart_callback:D,mousedrag_callback:G,touchmove_callback:G,mouseup_callback:K,touchend_callback:K,wheel_callback:function(t,e,n,r){v=t,b=e,Math.abs(n/100)<.3?f+=n/100:P+=.05*Math.sign(n);T()},pinch_callback:function(t,e,n,o){u>=1?(f-=n/r.world_width*10,M=-n/r.world_width*10):(f-=n/r.world_height*10,M=-n/r.world_height*10);v=t,b=e,T()}},n={renderer:"gpu",shader:t,canvas_width:100,canvas_height:100},r=new Wilson(Page.element.querySelector("#output-canvas"),e);r.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let o=new Wilson(Page.element.querySelector("#hidden-canvas"),n);o.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let a=[1,0],i=[0,0],l=[],s=0,c=0,u=1,d=!1,_=0,g=[],m=[],f=0,h=[],w=500,p=100,v=0,b=0,z=0,y=0,M=0,x=0,q=0,P=0;const F=.96,k=.0025,A=25e-5,S=.93,L=.01,E=.001;let I=-1,O=r.draggables.add(1,0);O.classList.add("a-marker"),(O=r.draggables.add(0,0)).classList.add("c-marker"),Q(),Q(),Q(),$(!0);let R=Page.element.querySelector("#resolution-input");R.addEventListener("input",()=>{w=parseInt(R.value||500),r.change_canvas_size(w,w),window.requestAnimationFrame(X)}),Page.element.querySelector("#add-root-button").addEventListener("click",Q),Page.element.querySelector("#remove-root-button").addEventListener("click",function(){if(1===c)return;c--,l.pop(),l.pop(),r.draggables.draggables[c+2].remove(),r.draggables.draggables.pop(),r.draggables.world_coordinates.pop(),r.draggables.num_draggables--,window.requestAnimationFrame(X)}),Page.element.querySelector("#spread-roots-button").addEventListener("click",()=>$(!1,!1)),Page.element.querySelector("#randomize-roots-button").addEventListener("click",()=>$(!1,!0)),Page.element.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("newtons-method.png")});let W=Page.element.querySelector("#root-a-input"),j=Page.element.querySelector("#root-b-input");W.addEventListener("input",B),j.addEventListener("input",B);let C=Page.element.querySelector("#root-color-input");C.addEventListener("input",function(){if(s<2)return;let t=s-2,e=function(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(C.value),n=e.r/255,a=e.g/255,i=e.b/255;e.r=H[3*t],e.g=H[3*t+1],e.b=H[3*t+2],anime({targets:e,r:n,g:a,b:i,easing:"easeInOutQuad",duration:250,update:()=>{H[3*t]=e.r,H[3*t+1]=e.g,H[3*t+2]=e.b,r.gl.uniform3fv(r.uniforms.colors,H),o.gl.uniform3fv(o.uniforms.colors,H),window.requestAnimationFrame(X)}})});let J=Page.element.querySelector("#root-setter"),N=Page.element.querySelector("#color-setter");r.gl.uniform1f(r.uniforms.aspect_ratio,1);let H=[216/255,1/255,42/255,1,139/255,56/255,249/255,239/255,20/255,27/255,181/255,61/255,0,86/255,195/255,154/255,82/255,164/255,32/255,32/255,32/255,155/255,92/255,15/255,182/255,228/255,254/255,250/255,195/255,218/255,1,1,1];function Q(){if(11===c)return;let t=3*Math.random()-1.5,e=3*Math.random()-1.5;r.draggables.add(t,e),l.push(t),l.push(e),c++,window.requestAnimationFrame(X)}function $(t=!1,e=!1){if(!d){d=!0,_=0,g=JSON.parse(JSON.stringify(l));for(let t=0;t<c;t++){let n=1;e&&(n+=.75*Math.random()),m[2*t]=n*Math.cos(2*Math.PI*t/c)-l[2*t],m[2*t+1]=n*Math.sin(2*Math.PI*t/c)-l[2*t+1]}if(t){d=!1;for(let t=0;t<c;t++)l[2*t]=g[2*t]+m[2*t],l[2*t+1]=g[2*t+1]+m[2*t+1],r.draggables.world_coordinates[t+2]=[l[2*t],l[2*t+1]];r.draggables.recalculate_locations()}window.requestAnimationFrame(X)}}function B(){0===s?(a[0]=parseFloat(W.value||1),a[1]=parseFloat(j.value||0),r.draggables.world_coordinates[0]=[a[0],a[1]]):1===s?(i[0]=10*parseFloat(W.value||0),i[1]=10*parseFloat(j.value||0),r.draggables.world_coordinates[1]=[i[0],i[1]]):(l[2*(s-2)]=parseFloat(W.value||0),l[2*(s-2)+1]=parseFloat(j.value||0),r.draggables.world_coordinates[s-2]=[l[2*(s-2)],l[2*(s-2)+1]]),window.requestAnimationFrame(X),r.draggables.recalculate_locations()}function D(t,e,n){x=0,q=0,P=0,z=0,y=0,M=0}function G(t,e,n,o,a){r.world_center_x-=n,r.world_center_y-=o,z=-n/r.world_width,y=-o/r.world_height,window.requestAnimationFrame(X),r.draggables.recalculate_locations()}function K(t,e,n){Math.sqrt(z*z+y*y)>=k&&(x=z,q=y),Math.abs(M)>=L&&(P=M),window.requestAnimationFrame(X)}function T(){if(u>=1){let t=r.input.get_zoomed_world_center(v,b,3*Math.pow(2,f)*u,3*Math.pow(2,f));r.world_width=3*Math.pow(2,f)*u,r.world_height=3*Math.pow(2,f),r.world_center_x=t[0],r.world_center_y=t[1]}else{let t=r.input.get_zoomed_world_center(v,b,3*Math.pow(2,f),3*Math.pow(2,f)/u);r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)/u,r.world_center_x=t[0],r.world_center_y=t[1]}window.requestAnimationFrame(X),r.draggables.recalculate_locations()}function U(t,e,n,r){0===t?a=[e,n]:1===t?i=[e,n]:(l[2*(t-2)]=e,l[2*(t-2)+1]=n),window.requestAnimationFrame(X)}function V(t,e,n,r){Page.Animate.change_opacity(J,0,Site.opacity_animation_time),Page.Animate.change_opacity(N,0,Site.opacity_animation_time).then(()=>{if(0===(s=t))W.value=Math.round(1e3*a[0])/1e3,j.value=Math.round(1e3*a[1])/1e3;else if(1===s)W.value=Math.round(1e3*i[0])/1e4,j.value=Math.round(1e3*i[1])/1e4;else{let t=s-2;W.value=Math.round(1e3*l[2*t])/1e3,j.value=Math.round(1e3*l[2*t+1])/1e3,C.value=function(t,e,n){return"#"+Z(t)+Z(e)+Z(n)}(255*H[3*t],255*H[3*t+1],255*H[3*t+2])}Page.Animate.change_opacity(J,1,Site.opacity_animation_time),Page.Animate.change_opacity(N,1,Site.opacity_animation_time)})}function X(t){let e=t-I;if(I=t,0===e)return;o.gl.uniform1f(o.uniforms.aspect_ratio,u),o.gl.uniform1f(o.uniforms.world_center_x,r.world_center_x),o.gl.uniform1f(o.uniforms.world_center_y,r.world_center_y),o.gl.uniform1f(o.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),o.gl.uniform1i(o.uniforms.num_roots,c),o.gl.uniform2fv(o.uniforms.roots,l),o.gl.uniform2fv(o.uniforms.a,a),o.gl.uniform2f(o.uniforms.c,i[0]/10,i[1]/10),o.gl.uniform1f(o.uniforms.brightness_scale,30),o.render.draw_frame();let n=o.render.get_pixel_data(),s=new Array(p*p);for(let t=0;t<p*p;t++)s[t]=Math.max(Math.max(n[4*t],n[4*t+1]),n[4*t+2]);s.sort((t,e)=>t-e);let w=Math.min(1e4/(s[Math.floor(p*p*.96)]+s[Math.floor(p*p*.98)]),200);h.push(w);let v=h.length;v>10&&h.shift(),w=Math.max(h.reduce((t,e)=>t+e)/v,.5),r.gl.uniform1f(r.uniforms.aspect_ratio,u),r.gl.uniform1f(r.uniforms.world_center_x,r.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,r.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),r.gl.uniform1i(r.uniforms.num_roots,c),r.gl.uniform2fv(r.uniforms.roots,l),r.gl.uniform2fv(r.uniforms.a,a),r.gl.uniform2f(r.uniforms.c,i[0]/10,i[1]/10),r.gl.uniform1f(r.uniforms.brightness_scale,w),r.render.draw_frame(),d&&function(){let t=.5*Math.sin(Math.PI*_/120-Math.PI/2)+.5;for(let e=0;e<c;e++)l[2*e]=g[2*e]+m[2*e]*t,l[2*e+1]=g[2*e+1]+m[2*e+1]*t,r.draggables.world_coordinates[e+2]=[l[2*e],l[2*e+1]];window.requestAnimationFrame(X),r.draggables.recalculate_locations(),121==++_&&(d=!1)}(),e>=50&&(x=0,q=0,P=0,z=0,y=0,M=0),0===x&&0===q&&0===P||(r.world_center_x+=x*r.world_width,r.world_center_y+=q*r.world_height,x*=F,q*=F,Math.sqrt(x*x+q*q)<A&&(x=0,q=0),f+=P,T(),P*=S,Math.abs(P)<E&&(P=0),window.requestAnimationFrame(X),r.draggables.recalculate_locations())}function Y(){r.fullscreen.currently_fullscreen?(u=window.innerWidth/window.innerHeight)>=1?(r.change_canvas_size(w,Math.floor(w/u)),r.world_width=3*Math.pow(2,f)*u,r.world_height=3*Math.pow(2,f)):(r.change_canvas_size(Math.floor(w*u),w),r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)/u):(u=1,r.change_canvas_size(w,w),r.world_width=3*Math.pow(2,f),r.world_height=3*Math.pow(2,f)),window.requestAnimationFrame(X)}function Z(t){let e=t.toString(16);return 1==e.length?"0"+e:e}r.gl.uniform3fv(r.uniforms.colors,H),o.gl.uniform3fv(o.uniforms.colors,H),window.requestAnimationFrame(X),Page.show(),window.addEventListener("resize",Y),Page.temporary_handlers.resize.push(Y)}();