!function(){"use strict";let e=null,t=[],o=100,r=document.querySelector("#newtons-method-plot").getContext("2d"),n=null,l=[],u=-1,s=document.querySelector("#root-selector").offsetWidth,c=document.querySelector("#root-selector").offsetHeight;const a=.05;let d=[],m=[],h=[];const i=[[255,0,0],[0,255,0],[0,0,255],[0,255,255],[255,0,255],[255,255,0],[127,0,255],[255,127,0]];function p(n){document.querySelector("#newtons-method-plot").setAttribute("width",e),document.querySelector("#newtons-method-plot").setAttribute("height",e);for(let t=0;t<e;t++){m[t]=[],d[t]=[];for(let o=0;o<e;o++)d[t][o]=0,m[t][o]=-1}for(let t=0;t<e;t++)for(let r=0;r<e;r++){if(0!==d[t][r])continue;let l=[(r-e/2)/e*4,-(t-e/2)/e*4],u=[0,0],s=[];for(let c=0;c<o;c++){let o=y(w(n,l),b(S(n,l)));u[0]=l[0],u[1]=l[1],l[0]=l[0]-o[0],l[1]=l[1]-o[1];let h=Math.floor(l[0]/4*e+e/2),i=Math.floor(-(l[1]/4*e-e/2));i>=0&&i<e&&h>=0&&h<e&&s.push([[i,h],c+1]);let p=!1;for(let e=0;e<n.length;e++){let o=g([l[0]-n[e][0],l[1]-n[e][1]]);if(o<=a*a){let l=g([u[0]-n[e][0],u[1]-n[e][1]]),h=(Math.log(a)-.5*Math.log(o))/(.5*Math.log(l)-.5*Math.log(o));m[t][r]=e,d[t][r]=c-h;for(let t=0;t<s.length;t++)d[s[t][0][0]][s[t][0][1]]=c-h-s[t][1],m[s[t][0][0]][s[t][0][1]]=e;p=!0;break}}if(p)break}}!function(){let o=0,n=1/0;for(let t=0;t<e;t++)for(let r=0;r<e;r++)d[t][r]>o&&(o=d[t][r]),d[t][r]<n&&(n=d[t][r]);if(100===e){h.push(o),h.length>10&&h.shift();let e=0;for(let t=0;t<h.length;t++)e+=h[t];o=e/h.length}let l=r.getImageData(0,0,e,e),u=l.data;for(let r=0;r<e;r++)for(let l=0;l<e;l++){d[r][l]-=n,d[r][l]/=o-n,d[r][l]=1-d[r][l],d[r][l]=Math.pow(d[r][l],1+t.length/4),d[r][l]>=0||d[r][l]<=1||(d[r][l]=1);let s=4*r*e+4*l,c=m[r][l];-1!==c?(u[s]=i[c][0]*d[r][l],u[s+1]=i[c][1]*d[r][l],u[s+2]=i[c][2]*d[r][l],u[s+3]=255):(u[s]=0,u[s+1]=0,u[s+2]=0,u[s+3]=255)}r.putImageData(l,0,0)}()}function f(){e=parseInt(document.querySelector("#dim-input").value||1e3),document.querySelector("#newtons-method-plot").setAttribute("width",e),document.querySelector("#newtons-method-plot").setAttribute("height",e);try{n.terminate()}catch(e){}n=DEBUG?new Worker("/applets/newtons-method/scripts/worker.js"):new Worker("/applets/newtons-method/scripts/worker.min.js"),temporary_web_workers.push(n),n.onmessage=function(t){if("progress"===t.data[0])document.querySelector("#progress-bar span").style.width=t.data[1]+"%",100===t.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0,document.querySelector("#progress-bar span").style.width=0},300)},600);else{let o=r.getImageData(0,0,e,e),n=o.data,l=t.data[1].length;for(let e=0;e<l;e++)n[e]=t.data[1][e];r.putImageData(o,0,0),function(){let e=document.createElement("a");e.download="newtons-method.png",e.href=document.querySelector("#newtons-method-plot").toDataURL(),e.click(),e.remove()}()}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),n.postMessage([e,t])}function g(e){return e[0]*e[0]+e[1]*e[1]}function y(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function b(e){let t=g(e);return[1/t*e[0],-1/t*e[1]]}function w(e,t){let o=[1,0];for(let r=0;r<e.length;r++)o=y(o,[t[0]-e[r][0],t[1]-e[r][1]]);return o}function S(e,t){let o=w(e,t),r=w(e,[t[0]-.001,t[1]]);return o[0]-=r[0],o[1]-=r[1],o[0]/=.001,o[1]/=.001,o}function q(e){u=-1;for(let t=0;t<l.length;t++)if(e.target.id===`root-marker-${t}`){e.preventDefault(),h=[],u=t;break}}function v(o){-1!==u&&(document.body.style.WebkitUserSelect="",e=500,p(t)),u=-1}function k(o){if(-1===u)return;let r=null,n=null,a=document.querySelector("#root-selector").getBoundingClientRect();"touchmove"===o.type?(r=o.touches[0].clientY-a.top,n=o.touches[0].clientX-a.left):(r=o.clientY-a.top,n=o.clientX-a.left),r<24&&(r=24),r>c-24&&(r=c-24),n<24&&(n=24),n>s-24&&(n=s-24),l[u].style.transform=`translate3d(${n-24}px, ${r-24}px, 0)`;let d=(n-s/2)/s*4,m=-(r-c/2)/c*4;t[u][0]=d,t[u][1]=m,e=100,p(t)}!function(){1===url_vars.contrast&&(1===url_vars.theme?document.querySelector("#newtons-method-plot").style.borderColor="rgb(192, 192, 192)":document.querySelector("#newtons-method-plot").style.borderColor="rgb(64, 64, 64)");add_style("\n\t\t\t.root-marker.enable-hover:hover\n\t\t\t{\n\t\t\t\tbackground-color: rgb(127, 127, 127);\t\n\t\t\t}\n\t\t",!0)}(),document.documentElement.addEventListener("touchstart",q,!1),document.documentElement.addEventListener("touchmove",k,!1),document.documentElement.addEventListener("touchend",v,!1),document.documentElement.addEventListener("mousedown",q,!1),document.documentElement.addEventListener("mousemove",k,!1),document.documentElement.addEventListener("mouseup",v,!1),temporary_handlers.touchstart.push(q),temporary_handlers.touchmove.push(k),temporary_handlers.touchend.push(v),temporary_handlers.mousedown.push(q),temporary_handlers.mousemove.push(k),temporary_handlers.mouseup.push(v),document.querySelector("#add-marker-button").addEventListener("click",function(){if(t.length===i.length)return;let o=document.createElement("div");o.classList.add("root-marker"),o.id=`root-marker-${l.length}`,o.style.transform=`translate3d(${s/2-24}px, ${c/2-24}px, 0)`,document.querySelector("#root-selector").appendChild(o),l.push(o),t.push([0,0]),h=[],e=100,p(t)}),document.querySelector("#spread-markers-button").addEventListener("click",function(o=!0){for(let e=0;e<t.length;e++){e<t.length/2||t.length%2==1?(t[e][0]=Math.cos(2*Math.PI*2*e/t.length),t[e][1]=Math.sin(2*Math.PI*2*e/t.length)):(t[e][0]=Math.cos(2*Math.PI*(2*e+1)/t.length),t[e][1]=Math.sin(2*Math.PI*(2*e+1)/t.length));let o=Math.floor(c*(1-(t[e][1]/4+.5))),r=Math.floor(s*(t[e][0]/4+.5));l[e].style.transform=`translate3d(${r-24}px, ${o-24}px, 0)`}e=o?500:100;p(t)}),document.querySelector("#generate-high-res-plot-button").addEventListener("click",f),document.querySelector("#dim-input").addEventListener("keydown",function(e){13===e.keyCode&&f()})}();