import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{addHoverEvent}from"/scripts/src/hoverEvents.min.js";import{$,$$,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const r=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),winOverlay:$("#win-overlay")}),s=new Checkbox({element:$("#show-diffs-checkbox"),name:"Show guess overlaps",onInput:function(){r.setShowDiffs(s.checked)},checked:!0,persistState:!1});new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>r.replay()});r.possibleFlags=possibleAnswers.all;let t=!1,a=!1,n=0,o=possibleAnswers.all,l=Array.from({length:possibleAnswers.all.length},(_,i)=>i),i=[...l];const c=$("#guess-selector-input"),d=$("#country-list");for(const[u,f]of o.entries()){const h=document.createElement("div");h.classList.add("country-list-item"),h.innerHTML=`
			<img src="graphics/${f}.png">
			<p class="body-text">${countryNames[f]}</p>
		`,h.style.order=u,d.appendChild(h),addHoverEvent({element:h,addBounceOnTouch:()=>!0,scale:1.05,callback:isHovering=>{var e;isHovering&&a?("0"!==h.style.order&&h.classList.remove("hover"),m(n)):isHovering&&(n!==i[u]&&(e=l[n],d.children[e].classList.remove("hover")),n=i[u])}}),h.addEventListener("click",async()=>{await r.loadPromise,c.value="",r.guessFlag(f)})}function m(apparentIndex){var e=l[n],e=(void 0!==e&&d.children[e].classList.remove("hover"),n=apparentIndex,l[n]);0<d.children.length&&void 0!==e&&d.children[e].classList.add("hover")}function p(){var e=c.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);d.style.maxHeight=e+"px"}function y(){t=!0,d.style.display="flex",p(),m(0),requestAnimationFrame(()=>{d.style.transform="scale(1)",d.style.opacity=1})}function v(){d.style.transform="scale(0.975)",d.style.opacity=0,setTimeout(()=>d.style.display="none",125)}c.addEventListener("focus",y),c.addEventListener("blur",()=>{t=!1,v()}),c.addEventListener("input",function(){if(a=!0,setTimeout(()=>a=!1,100),0===c.value.length){l=Array.from({length:possibleAnswers.all.length},(_,i)=>i),i=[...l];for(const t of d.children)t.style.display="flex",t.classList.remove("hover"),t.style.order=1;m(0)}else{o=Array.from(new Set(fuzzySearch(c.value,countryNameList).map(name=>countriesByName[name]))),l=new Array(o.length);for(const n of d.children)n.style.display="none";for(var[e,s]of o.entries()){var s=possibleAnswers.all.indexOf(s),r=d.children[s];r.style.display="flex",r.style.order=e,r.classList.remove("hover"),l[e]=s,i[s]=e}y()}}),addTemporaryListener({object:window,event:"resize",callback:p}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{var s;"Escape"===e.key&&t?(document.activeElement.blur(),t=!1):"ArrowDown"===e.key?(e.preventDefault(),n<o.length-1&&m(n+1)):"ArrowUp"===e.key?(e.preventDefault(),0<n&&m(n-1)):"Enter"===e.key&&t&&(r.won?r.replay():(0===c.value.length&&this.lastGuessFlagId&&r.guessFlag(this.lastGuessFlagId),s=l[n],d.children[s].click(),v()))}})}