import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{addHoverEvent,addHoverEventWithScale}from"/scripts/src/hoverEvents.min.js";import{$,$$,addStyle,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const r=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),progressBarTexts:Array.from($$(".progress-bar-text")),overlapCheckboxes:Array.from($$(".guess-overlap-checkbox")),winOverlay:$("#win-overlay"),viewFlagButtonContainer:$("#view-flag-button").parentElement});new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>r.replay()}),new Button({element:$("#view-flag-button"),name:"View Flag",onClick:()=>r.wilsonOverlay.enterFullscreen()}),r.possibleFlags=possibleAnswers.all;let t=void 0;for(const[f,g]of r.overlapCheckboxes.entries())addHoverEventWithScale({element:g,scale:1.1,addBounceOnTouch:()=>!0}),g.addEventListener("click",()=>{g.classList.toggle("checked"),r.setShowDiffs(g.classList.contains("checked"),f)});addStyle(`
		.cap-background
		{
			transition: opacity .125s ease-out;
		}
	`);let a=!1,n=!1,o=0,l=possibleAnswers.all,i=Array.from({length:possibleAnswers.all.length},(_,i)=>i),c=[...i];const d=$("#guess-selector-input"),v=$("#country-list");for(const[h,w]of l.entries()){const b=document.createElement("div");b.classList.add("country-list-item"),b.innerHTML=`
			<img src="graphics/thumbnails/${w}.webp">
			<p class="body-text">${countryNames[w]}</p>
		`,b.style.order=h,v.appendChild(b),addHoverEvent({element:b,addBounceOnTouch:()=>!0,scale:1.05,callback:isHovering=>{var e;isHovering&&n?("0"!==b.style.order&&b.classList.remove("hover"),y(o)):isHovering&&(o!==c[h]&&(e=i[o],v.children[e].classList.remove("hover")),o=c[h])}}),b.addEventListener("click",async()=>{await r.loadPromise,d.value="",r.guessFlag(w),t=w,u()})}function y(apparentIndex){var e=i[o],e=(void 0!==e&&v.children[e].classList.remove("hover"),o=apparentIndex,i[o]);0<v.children.length&&void 0!==e&&v.children[e].classList.add("hover")}function s(){var e=d.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);v.style.maxHeight=e+"px"}function m(){a=!0,v.style.display="flex",s(),y(0),requestAnimationFrame(()=>{v.style.transform="scale(1)",v.style.opacity=1})}function p(){v.style.transform="scale(0.975)",v.style.opacity=0,setTimeout(()=>v.style.display="none",125)}function u(){if(n=!0,setTimeout(()=>n=!1,100),0===d.value.length){i=Array.from({length:possibleAnswers.all.length},(_,i)=>i),c=[...i];for(const t of v.children)t.style.display="flex",t.classList.remove("hover"),t.style.order=1;y(0)}else{l=Array.from(new Set(fuzzySearch(d.value,countryNameList).map(name=>countriesByName[name]))),i=new Array(l.length);for(const a of v.children)a.style.display="none";for(var[e,s]of l.entries()){var s=possibleAnswers.all.indexOf(s),r=v.children[s];r.style.display="flex",r.style.order=e,r.classList.remove("hover"),i[e]=s,c[s]=e}m()}}d.addEventListener("focus",m),d.addEventListener("blur",()=>{a=!1,p()}),d.addEventListener("input",u),addTemporaryListener({object:window,event:"resize",callback:s}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{var s;"Escape"===e.key&&a?(document.activeElement.blur(),a=!1):"ArrowDown"===e.key?(e.preventDefault(),o<l.length-1&&y(o+1)):"ArrowUp"===e.key?(e.preventDefault(),0<o&&y(o-1)):"Enter"===e.key&&a&&(r.gameOver?r.replay():(0===d.value.length&&t&&(r.guessFlag(t),t=void 0,u()),s=i[o],v.children[s].click(),p()))}})}