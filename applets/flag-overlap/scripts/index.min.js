import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{addHoverEvent}from"/scripts/src/hoverEvents.min.js";import{$,$$,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const t=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),winOverlay:$("#win-overlay")}),s=new Checkbox({element:$("#show-diffs-checkbox"),name:"Show guess overlaps",onInput:function(){t.setShowDiffs(s.checked)},checked:!0,persistState:!1});new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>t.replay()});t.possibleFlags=possibleAnswers.all;let n=!1,l=0,i=possibleAnswers.all,c=Array.from({length:possibleAnswers.all.length},(_,i)=>i),d=[...c];const m=$("#guess-selector-input"),v=$("#country-list");for(const[p,u]of i.entries()){var r=document.createElement("div");r.classList.add("country-list-item"),r.innerHTML=`
			<img src="graphics/${u}.png">
			<p class="body-text">${countryNames[u]}</p>
		`,r.style.order=p,v.appendChild(r),addHoverEvent({element:r,addBounceOnTouch:()=>!0,callback:isHovering=>{var e;isHovering&&(l!==d[p]&&(e=c[l],v.children[e].classList.remove("hover")),l=d[p])}}),r.addEventListener("click",async()=>{await t.loadPromise,m.value="",t.guessFlag(u)})}function a(){var e=m.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);v.style.maxHeight=e+"px"}function y(){n=!0,v.style.display="flex",a();var e=c[l],e=(v.children[e].classList.remove("hover"),l=0,c[l]);0<v.children.length&&v.children[e].classList.add("hover"),requestAnimationFrame(()=>{v.style.transform="scale(1)",v.style.opacity=1})}function o(){v.style.transform="scale(0.975)",v.style.opacity=0,setTimeout(()=>v.style.display="none",125)}m.addEventListener("focus",y),m.addEventListener("blur",()=>{n=!1,o()}),m.addEventListener("input",function(){if(0===m.value.length){c=Array.from({length:possibleAnswers.all.length},(_,i)=>i),d=[...c];for(const a of v.children)a.style.display="flex",a.style.order=0}else{var e,s,r=c[l];v.children[r].classList.remove("hover"),i=Array.from(new Set(fuzzySearch(m.value,countryNameList).map(name=>countriesByName[name]))),c=new Array(i.length);for(const o of v.children)o.style.display="none";for([e,s]of i.entries()){var t=possibleAnswers.all.indexOf(s),n=v.children[t];n.style.display="flex",n.style.order=e,c[e]=t,d[t]=e}y()}}),addTemporaryListener({object:window,event:"resize",callback:a}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{var s,r;"Escape"===e.key&&n?(document.activeElement.blur(),n=!1):"ArrowDown"===e.key?(e.preventDefault(),l<i.length-1&&(r=c[l],v.children[r].classList.remove("hover"),l++,r=c[l],v.children[r].classList.add("hover"))):"ArrowUp"===e.key?(e.preventDefault(),0<l&&(r=c[l],v.children[r].classList.remove("hover"),l--,r=c[l],v.children[r].classList.add("hover"))):"Enter"===e.key&&n&&(t.won?t.replay():(0===m.value.length&&this.lastGuessFlagId&&t.guessFlag(this.lastGuessFlagId),s=c[l],v.children[s].click(),o()))}})}