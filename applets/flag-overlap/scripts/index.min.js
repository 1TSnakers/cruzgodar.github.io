import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{addHoverEvent,addHoverEventWithScale}from"/scripts/src/hoverEvents.min.js";import{$,$$,addStyle,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const n=$("#guess-selector-input"),o=$("#country-list"),r=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),progressBarTexts:Array.from($$(".progress-bar-text")),overlapCheckboxes:Array.from($$(".guess-overlap-checkbox")),winOverlay:$("#win-overlay"),viewFlagButtonContainer:$("#view-flag-button").parentElement}),s=(new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>r.replay()}),new Button({element:$("#view-flag-button"),name:"View Flag",onClick:()=>r.wilsonOverlay.enterFullscreen()}),new Checkbox({element:$("#hide-flag-icons-checkbox"),name:"Hide flags in list",onInput:()=>{setTimeout(()=>{o.classList.toggle("hard-mode",s.checked)},100)}})),t=new Dropdown({element:$("#possible-flags-dropdown"),name:"Possible Answers",options:{all:"All Countries and Territories",un:"United Nations Members and Observers",americas:"The Americas",europe:"Europe",africa:"Africa",asiaAndPacific:"Asia and the Pacific"},onInput:()=>{r.possibleFlags=possibleAnswers[t.value]}});t.loaded.then(()=>{r.possibleFlags=possibleAnswers[t.value||"all"]});let a=void 0;for(const[g,b]of r.overlapCheckboxes.entries())addHoverEventWithScale({element:b,scale:1.1,addBounceOnTouch:()=>!0}),b.addEventListener("click",()=>{b.classList.toggle("checked"),r.setShowDiffs(b.classList.contains("checked"),g)});addStyle(`
		.cap-background
		{
			transition: opacity .125s ease-out;
		}
	`);let l=!1,i=!1,c=0,d=possibleAnswers.all,p=Array.from({length:possibleAnswers.all.length},(_,i)=>i),m=[...p];for(const[w,A]of d.entries()){const k=document.createElement("div");k.classList.add("country-list-item"),k.innerHTML=`
			<img src="graphics/thumbnails/${A}.webp">
			<p class="body-text">${countryNames[A]}</p>
		`,k.style.order=w,o.appendChild(k),addHoverEvent({element:k,addBounceOnTouch:()=>!0,scale:1.05,callback:isHovering=>{var e;isHovering&&i?("0"!==k.style.order&&k.classList.remove("hover"),v(c)):isHovering&&(c!==m[w]&&(e=p[c],o.children[e].classList.remove("hover")),c=m[w])}}),k.addEventListener("click",async()=>{await r.loadPromise,n.value="",r.guessFlag(A),a=A,f()})}function v(apparentIndex){var e=p[c],e=(void 0!==e&&o.children[e].classList.remove("hover"),c=apparentIndex,p[c]);0<o.children.length&&void 0!==e&&o.children[e].classList.add("hover")}function u(){var e=n.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);o.style.maxHeight=e+"px"}function y(){l=!0,o.style.display="flex",u(),v(0),requestAnimationFrame(()=>{o.style.transform="scale(1)",o.style.opacity=1})}function f(){o.style.transform="scale(0.975)",o.style.opacity=0,setTimeout(()=>{o.style.display="none",h()},125)}function h(){if(i=!0,setTimeout(()=>i=!1,100),0===n.value.length){p=Array.from({length:possibleAnswers.all.length},(_,i)=>i),m=[...p];for(const t of o.children)t.style.display="flex",t.classList.remove("hover"),t.style.order=1;v(0)}else{d=Array.from(new Set(fuzzySearch(n.value,countryNameList).map(name=>countriesByName[name]))),p=new Array(d.length);for(const a of o.children)a.style.display="none";for(var[e,s]of d.entries()){var s=possibleAnswers.all.indexOf(s),r=o.children[s];r.style.display="flex",r.style.order=e,r.classList.remove("hover"),p[e]=s,m[s]=e}}}n.addEventListener("focus",y),n.addEventListener("blur",()=>{l=!1,f()}),n.addEventListener("input",()=>{h(),y()}),addTemporaryListener({object:window,event:"resize",callback:u}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{var s;"Escape"===e.key&&l?(document.activeElement.blur(),l=!1):"ArrowDown"===e.key?(e.preventDefault(),c<d.length-1&&v(c+1)):"ArrowUp"===e.key?(e.preventDefault(),0<c&&v(c-1)):"Enter"===e.key&&l&&(r.gameOver?r.replay():(0===n.value.length&&a&&(r.guessFlag(a),a=void 0),s=p[c],o.children[s].click()))}})}