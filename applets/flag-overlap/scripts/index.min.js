import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{addHoverEvent,addHoverEventWithScale}from"/scripts/src/hoverEvents.min.js";import{$,$$,addStyle,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const r=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),overlapCheckboxes:Array.from($$(".guess-overlap-checkbox")),winOverlay:$("#win-overlay")});new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>r.replay()}),r.possibleFlags=possibleAnswers.all;for(const[p,u]of r.overlapCheckboxes.entries())addHoverEventWithScale({element:u,scale:1.1,addBounceOnTouch:()=>!0}),u.addEventListener("click",()=>{u.classList.toggle("checked"),r.setShowDiffs(u.classList.contains("checked"),p)});addStyle(`
		.cap-background
		{
			transition: opacity .125s ease-out;
		}
	`);let t=!1,n=!1,a=0,o=possibleAnswers.all,l=Array.from({length:possibleAnswers.all.length},(_,i)=>i),i=[...l];const c=$("#guess-selector-input"),d=$("#country-list");for(const[f,h]of o.entries()){const g=document.createElement("div");g.classList.add("country-list-item"),g.innerHTML=`
			<img src="graphics/thumbnails/${h}.webp">
			<p class="body-text">${countryNames[h]}</p>
		`,g.style.order=f,d.appendChild(g),addHoverEvent({element:g,addBounceOnTouch:()=>!0,scale:1.05,callback:isHovering=>{var e;isHovering&&n?("0"!==g.style.order&&g.classList.remove("hover"),v(a)):isHovering&&(a!==i[f]&&(e=l[a],d.children[e].classList.remove("hover")),a=i[f])}}),g.addEventListener("click",async()=>{await r.loadPromise,c.value="",r.guessFlag(h)})}function v(apparentIndex){var e=l[a],e=(void 0!==e&&d.children[e].classList.remove("hover"),a=apparentIndex,l[a]);0<d.children.length&&void 0!==e&&d.children[e].classList.add("hover")}function s(){var e=c.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);d.style.maxHeight=e+"px"}function y(){t=!0,d.style.display="flex",s(),v(0),requestAnimationFrame(()=>{d.style.transform="scale(1)",d.style.opacity=1})}function m(){d.style.transform="scale(0.975)",d.style.opacity=0,setTimeout(()=>d.style.display="none",125)}c.addEventListener("focus",y),c.addEventListener("blur",()=>{t=!1,m()}),c.addEventListener("input",function(){if(n=!0,setTimeout(()=>n=!1,100),0===c.value.length){l=Array.from({length:possibleAnswers.all.length},(_,i)=>i),i=[...l];for(const t of d.children)t.style.display="flex",t.classList.remove("hover"),t.style.order=1;v(0)}else{o=Array.from(new Set(fuzzySearch(c.value,countryNameList).map(name=>countriesByName[name]))),l=new Array(o.length);for(const a of d.children)a.style.display="none";for(var[e,s]of o.entries()){var s=possibleAnswers.all.indexOf(s),r=d.children[s];r.style.display="flex",r.style.order=e,r.classList.remove("hover"),l[e]=s,i[s]=e}y()}}),addTemporaryListener({object:window,event:"resize",callback:s}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{var s;"Escape"===e.key&&t?(document.activeElement.blur(),t=!1):"ArrowDown"===e.key?(e.preventDefault(),a<o.length-1&&v(a+1)):"ArrowUp"===e.key?(e.preventDefault(),0<a&&v(a-1)):"Enter"===e.key&&t&&(r.won?r.replay():(0===c.value.length&&this.lastGuessFlagId&&r.guessFlag(this.lastGuessFlagId),s=l[a],d.children[s].click(),m()))}})}