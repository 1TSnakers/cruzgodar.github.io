import{FlagOverlap}from"./class.min.js";import{countriesByName,countryNameList,countryNames,possibleAnswers}from"./countryData.min.js";import{Button}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{addHoverEvent}from"/scripts/src/hoverEvents.min.js";import{$,$$,addTemporaryListener}from"/scripts/src/main.min.js";import{fuzzySearch}from"/scripts/src/utils.min.js";export default async function(){const s=new FlagOverlap({canvas:$("#output-canvas"),overlayCanvas:$("#overlay-canvas"),guessCanvases:Array.from($$(".guess-canvas")),overlayCanvases:Array.from($$(".overlay-canvas")),progressBars:Array.from($$(".progress-bar")),winOverlay:$("#win-overlay")}),r=new Checkbox({element:$("#show-diffs-checkbox"),name:"Show guess overlaps",onInput:function(){s.setShowDiffs(r.checked)},checked:!0,persistState:!1});new Button({element:$("#replay-button"),name:"Play Again",onClick:()=>s.replay()});let t=!1,n=0,a=possibleAnswers.all;const o=$("#guess-selector-input"),i=$("#country-list");for(const[y,v]of a.entries()){var l=document.createElement("div");l.classList.add("country-list-item"),l.innerHTML=`
			<img src="graphics/${v}.png">
			<p class="body-text">${countryNames[v]}</p>
		`,l.style.order=y,i.appendChild(l),addHoverEvent({element:l,addBounceOnTouch:()=>!0,callback:isHovering=>{isHovering&&(i.children.length>n&&n!==y&&i.children[n].classList.remove("hover"),n=y)}}),l.addEventListener("click",async()=>{await s.loadPromise,o.value="",s.guessFlag(v)})}function c(){var e=o.getBoundingClientRect().top,e=Math.min(window.innerHeight-e-100,500);i.style.maxHeight=e+"px"}function d(){t=!0,i.style.display="flex",c(),i.children.length>n&&i.children[n].classList.remove("hover"),(n=0)<i.children.length&&i.children[0].classList.add("hover"),requestAnimationFrame(()=>{i.style.transform="scale(1)",i.style.opacity=1})}function m(){t=!1,i.style.transform="scale(0.975)",i.style.opacity=0,setTimeout(()=>i.style.display="none",125)}o.addEventListener("focus",d),o.addEventListener("blur",m),o.addEventListener("input",function(){if(0===o.value.length)for(const r of i.children)r.style.display="flex",r.style.order=0;else{a=fuzzySearch(o.value,countryNameList).map(name=>countriesByName[name]);for(const t of i.children)t.style.display="none";for(var[e,s]of a.entries()){s=possibleAnswers.all.indexOf(s),s=i.children[s];s.style.display="flex",s.style.order=e}d()}}),addTemporaryListener({object:window,event:"resize",callback:c}),addTemporaryListener({object:document.documentElement,event:"keydown",callback:e=>{"Escape"===e.key&&t?document.activeElement.blur():"ArrowDown"===e.key?n<i.children.length-1&&(i.children[n].classList.remove("hover"),n++,i.children[n].classList.add("hover")):"ArrowUp"===e.key?0<n&&(i.children[n].classList.remove("hover"),n--,i.children[n].classList.add("hover")):"Enter"===e.key&&t&&(i.children[n].click(),m())}}),await s.loadPromise}