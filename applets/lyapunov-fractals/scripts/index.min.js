!function(){"use strict";let e=null,r=null,n=1,o=1,t=[],l=500,i=0,a=0,d=0,s=0,$=0,u=0,w=0,c=0,m=-1,f=Page.element.querySelector("#generating-string-input");Page.element.querySelector("#generate-button").addEventListener("click",C);let h=Page.element.querySelector("#resolution-input");h.addEventListener("input",()=>{l=parseInt(h.value||500),e.changeCanvasSize(l,l),window.requestAnimationFrame(H)});Page.element.querySelector("#download-button").addEventListener("click",()=>{e.downloadFrame("a-lyapunov-fractal.png")});let g=Page.element.querySelector("#canvas-location");function C(){let n=(f.value||"AB").toUpperCase(),l=[];for(let i=0;i<n.length;i++)"B"===n[i]?l.push(1):l.push(0);let a=`
   precision highp float;
   
   varying vec2 uv;
   
   uniform float aspectRatio;
   
   uniform float worldCenterX;
   uniform float worldCenterY;
   uniform float worldSize;
   
   uniform float brightnessScale;
   
   uniform int seq[12];
   
   
   
   void main(void)
   {
    vec2 z;
    
    if (aspectRatio >= 1.0)
    {
     z = vec2(uv.x * aspectRatio * worldSize + worldCenterX, uv.y * worldSize + worldCenterY);
    }
    
    else
    {
     z = vec2(uv.x * worldSize + worldCenterX, uv.y / aspectRatio * worldSize + worldCenterY);
    }
    
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    
    
    
    float x = .5;
    
    float lambda = 0.0;
    
    vec3 color = vec3(0.0, 0.0, 0.0);
    
    for (int iteration = 0; iteration < ${Math.floor(250/n.length)}; iteration++)
    {
     for (int index = 0; index < ${n.length}; index++)
     {
      if (seq[index] == 0)
      {
       x = z.x * x * (1.0 - x);
       
       color.x += abs(z.x) / 40.0;
      }
      
      else
      {
       x = z.y * x * (1.0 - x);
       
       color.y += abs(z.y) / 40.0;
      }
      
      lambda += log(abs(1.0 - 2.0*x));
      
      color.z = -lambda / 100.0;
     }
    }
    
    lambda /= 10000.0;
    
    if (lambda <= 0.0)
    {
     gl_FragColor = vec4(-lambda / brightnessScale * color, 1.0);
     
     return;
    }
   }
  `;try{e.outputCanvasContainer.parentNode.remove(),r.outputCanvasContainer.parentNode.remove(),g.insertAdjacentHTML("beforebegin",`
    <div>
     <canvas id="output-canvas" class="output-canvas"></canvas>
     <canvas id="hidden-canvas" class="hidden-canvas"></canvas>
    </div>
   `)}catch(m){}(e=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"gpu",shader:a,canvasWidth:500,canvasHeight:500,worldWidth:4,worldHeight:4,worldCenterX:2,worldCenterY:2,useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:W,mousedownCallback:p,touchstartCallback:p,mousedragCallback:_,touchmoveCallback:_,mouseupCallback:v,touchendCallback:v,wheelCallback:b,pinchCallback:x})).render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","brightnessScale","seq"]),(r=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"gpu",shader:a,canvasWidth:100,canvasHeight:100})).render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","brightnessScale","seq"]),t=[],o=.415,d=0,s=0,$=0,u=0,w=0,c=0,e.gl.uniform1f(e.uniforms.aspectRatio,1),r.gl.uniform1f(r.uniforms.aspectRatio,1),e.gl.uniform1iv(e.uniforms.seq,l),r.gl.uniform1iv(r.uniforms.seq,l),window.requestAnimationFrame(H)}function p(e,r,n){u=0,w=0,c=0,d=0,s=0,$=0}function _(r,n,o,t,l){e.worldCenterX-=o,e.worldCenterY-=t,e.worldCenterX=Math.min(Math.max(e.worldCenterX,e.worldWidth/2),4-e.worldWidth/2),e.worldCenterY=Math.min(Math.max(e.worldCenterY,e.worldHeight/2),4-e.worldHeight/2),d=-o,s=-t,window.requestAnimationFrame(H)}function v(r,n,o){Math.sqrt(d*d+s*s)>=.005*Math.min(e.worldWidth,e.worldHeight)&&(u=d,w=s),Math.abs($)>=.01&&(c=$),window.requestAnimationFrame(H)}function b(e,r,n,t){i=e,a=r,.3>Math.abs(n/100)?o+=n/100:c+=.05*Math.sign(n),o=Math.min(o,.415),S()}function x(r,t,l,d){n>=1?(o-=l/e.worldWidth*10,$=-l/e.worldWidth*10):(o-=l/e.worldHeight*10,$=-l/e.worldHeight*10),o=Math.min(o,.415),i=r,a=t,S()}function S(){if(n<1){let r=e.input.getZoomedWorldCenter(i,a,3*Math.pow(2,o)*n,3*Math.pow(2,o));e.worldWidth=3*Math.pow(2,o)*n,e.worldHeight=3*Math.pow(2,o),e.worldCenterX=r[0],e.worldCenterY=r[1]}else{let t=e.input.getZoomedWorldCenter(i,a,3*Math.pow(2,o),3*Math.pow(2,o)/n);e.worldWidth=3*Math.pow(2,o),e.worldHeight=3*Math.pow(2,o)/n,e.worldCenterX=t[0],e.worldCenterY=t[1]}e.worldCenterX=Math.min(Math.max(e.worldCenterX,e.worldWidth/2),4-e.worldWidth/2),e.worldCenterY=Math.min(Math.max(e.worldCenterY,e.worldHeight/2),4-e.worldHeight/2),window.requestAnimationFrame(H)}function H(l){let f=l-m;if(m=l,0===f)return;r.gl.uniform1f(r.uniforms.aspectRatio,n),r.gl.uniform1f(r.uniforms.worldCenterX,e.worldCenterX),r.gl.uniform1f(r.uniforms.worldCenterY,e.worldCenterY),r.gl.uniform1f(r.uniforms.worldSize,Math.min(e.worldHeight,e.worldWidth)/2),r.gl.uniform1f(r.uniforms.brightnessScale,20),r.render.drawFrame();let h=r.render.getPixelData(),g=Array(1e4);for(let C=0;C<1e4;C++)g[C]=h[4*C]+h[4*C+1]+h[4*C+2];g.sort((e,r)=>e-r);let p=(g[Math.floor(9600)]+g[Math.floor(9800)])/255*6;t.push(p);let _=t.length;_>10&&t.shift(),p=Math.max(t.reduce((e,r)=>e+r)/_,.5),e.gl.uniform1f(e.uniforms.aspectRatio,n),e.gl.uniform1f(e.uniforms.worldCenterX,e.worldCenterX),e.gl.uniform1f(e.uniforms.worldCenterY,e.worldCenterY),e.gl.uniform1f(e.uniforms.worldSize,Math.min(e.worldHeight,e.worldWidth)/2),e.gl.uniform1f(e.uniforms.brightnessScale,p),e.render.drawFrame(),f>=50&&(u=0,w=0,c=0,d=0,s=0,$=0),(0!==u||0!==w||0!==c)&&(e.worldCenterX+=u,e.worldCenterY+=w,Math.sqrt((u*=.96)*u+(w*=.96)*w)<5e-4*Math.min(e.worldWidth,e.worldHeight)&&(u=0,w=0),o+=c,o=Math.min(o,.415),S(i,a),.001>Math.abs(c*=.93)&&(c=0),e.worldCenterX=Math.min(Math.max(e.worldCenterX,e.worldWidth/2),4-e.worldWidth/2),e.worldCenterY=Math.min(Math.max(e.worldCenterY,e.worldHeight/2),4-e.worldHeight/2),window.requestAnimationFrame(H))}function W(){e.fullscreen.currentlyFullscreen?(n=window.innerWidth/window.innerHeight)>=1?(e.changeCanvasSize(l,Math.floor(l/n)),e.worldWidth=3*Math.pow(2,o),e.worldHeight=3*Math.pow(2,o)/n):(e.changeCanvasSize(Math.floor(l*n),l),e.worldWidth=3*Math.pow(2,o)*n,e.worldHeight=3*Math.pow(2,o)):(n=1,e.changeCanvasSize(l,l),e.worldWidth=3*Math.pow(2,o),e.worldHeight=3*Math.pow(2,o)),e.worldCenterX=Math.min(Math.max(e.worldCenterX,e.worldWidth/2),4-e.worldWidth/2),e.worldCenterY=Math.min(Math.max(e.worldCenterY,e.worldHeight/2),4-e.worldHeight/2),window.requestAnimationFrame(H)}C(),Page.show(),window.addEventListener("resize",W),Page.temporaryHandlers.resize.push(W)}();