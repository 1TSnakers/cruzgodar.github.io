!function(){"use strict";let t=null,n=null,e=[1,0],r=[0,0],o=1,a=1,c=[],l=500,i=100,s=20,u=0,f=0,d=0,w=0,_=0,v=0,z=0,m=0;const h=.96,g=.005,p=5e-4,x=.93,y=.01,b=.001;let M=-1,q=!1,R=0,k=null,A=new Array(12),F=new Array(12),L=document.querySelector("#code-textarea");L.value="cmul(csin(z), csin(cmul(z, i)))",document.querySelector("#randomize-palette-button").addEventListener("click",function(){if(!q){q=!0,R=0;let t=P();F=[...k];for(let n=0;n<12;n++)A[n]=t[n]-k[n];window.requestAnimationFrame(D)}}),document.querySelector("#generate-button").addEventListener("click",I);let S=document.querySelector("#resolution-input");S.addEventListener("input",()=>{l=parseInt(S.value||500),t.change_canvas_size(l,l),window.requestAnimationFrame(D)});let j=document.querySelector("#derivative-precision-input");j.addEventListener("input",()=>{s=parseFloat(j.value||20),t.gl.uniform1f(t.uniforms.derivative_precision,s),n.gl.uniform1f(n.uniforms.derivative_precision,s),window.requestAnimationFrame(D)}),document.querySelector("#download-button").addEventListener("click",()=>{t.download_frame("newtons-method.png")});let E=document.querySelector("#canvas-location");function I(){let e=`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float world_center_x;\n\t\t\tuniform float world_center_y;\n\t\t\tuniform float world_size;\n\t\t\t\n\t\t\tuniform float derivative_precision;\n\t\t\t\n\t\t\t\n\t\t\tuniform vec3 colors[4];\n\t\t\t\n\t\t\tuniform vec2 a;\n\t\t\tuniform vec2 c;\n\t\t\t\n\t\t\tuniform float brightness_scale;\n\t\t\t\n\t\t\tconst float threshhold = .01;\n\t\t\t\n\t\t\tconst vec2 i = vec2(0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat cabs(vec2 z)\n\t\t\t{\n\t\t\t\treturn length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cabs(float z)\n\t\t\t{\n\t\t\t\treturn abs(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat carg(vec2 z)\n\t\t\t{\n\t\t\t\tif (z.x == 0.0)\n\t\t\t\t{\n\t\t\t\t\tif (z.y >= 0.0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 1.57079632;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn -1.57079632;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn atan(z.y, z.x);\n\t\t\t}\n\t\t\t\n\t\t\tfloat carg(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn 3.14159265;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns the conjugate of z.\n\t\t\tvec2 cconj(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(z.x, -z.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cconj(float z)\n\t\t\t{\n\t\t\t\treturn z;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / |z|.\n\t\t\tvec2 csign(vec2 z)\n\t\t\t{\n\t\t\t\tif (length(z) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csign(float z)\n\t\t\t{\n\t\t\t\treturn sign(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z + w.\n\t\t\tvec2 cadd(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x + w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z + w.x, w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cadd(float z, float w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z - w.\n\t\t\tvec2 csub(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x - w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z - w.x, -w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csub(float z, float w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z * w.\n\t\t\tvec2 cmul(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x * w.x - z.y * w.y, z.x * w.y + z.y * w.x);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tfloat cmul(float z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / w.\n\t\t\tvec2 cdiv(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z.x * w.x + z.y * w.y, -z.x * w.y + z.y * w.x) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z * w.x, -z * w.y) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cdiv(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns 1/z.\n\t\t\tvec2 cinv(vec2 z)\n\t\t\t{\n\t\t\t\tfloat magnitude = z.x*z.x + z.y*z.y;\n\t\t\t\t\n\t\t\t\treturn vec2(z.x / magnitude, -z.y / magnitude);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cinv(float z)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn 1.0 / z;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^w.\n\t\t\tvec2 cpow(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat exparg = exp(-w.y * arg);\n\t\t\t\tfloat magexp = pow(magnitude, w.x / 2.0);\n\t\t\t\tfloat logmag = log(magnitude) * w.y / 2.0;\n\t\t\t\t\n\t\t\t\tfloat p1 = exparg * cos(w.x * arg);\n\t\t\t\tfloat p2 = exparg * sin(w.x * arg);\n\t\t\t\t\n\t\t\t\tfloat q1 = magexp * cos(logmag);\n\t\t\t\tfloat q2 = magexp * sin(logmag);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * q1 - p2 * q2, q1 * p2 + p1 * q2);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(vec2 z, float w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat magexp = pow(magnitude, w / 2.0);\n\t\t\t\t\n\t\t\t\tfloat p1 = cos(w * arg);\n\t\t\t\tfloat p2 = sin(w * arg);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * magexp, p2 * magexp);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat zlog = log(z);\n\t\t\t\tfloat zexp = exp(w.x * zlog);\n\t\t\t\t\n\t\t\t\treturn vec2(zexp * cos(w.y * zlog), zexp * sin(w.y * zlog));\n\t\t\t}\n\t\t\t\n\t\t\tfloat cpow(float z, float w)\n\t\t\t{\n\t\t\t\treturn pow(z, w);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^^w.\n\t\t\tvec2 ctet(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = cpow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctet(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfloat prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = pow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sqrt(z).\n\t\t\tvec2 csqrt(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(z, .5);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csqrt(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(sqrt(z), 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(0.0, sqrt(-z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns e^z.\n\t\t\tvec2 cexp(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(2.7182818, z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cexp(float z)\n\t\t\t{\n\t\t\t\treturn exp(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns log(z).\n\t\t\tvec2 clog(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(.5 * log(z.x * z.x + z.y * z.y), carg(z));\n\t\t\t}\n\t\t\t\n\t\t\tfloat clog(float z)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn log(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sin(z).\n\t\t\tvec2 csin(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) - cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat csin(float z)\n\t\t\t{\n\t\t\t\treturn sin(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns cos(z).\n\t\t\tvec2 ccos(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) + cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat ccos(float z)\n\t\t\t{\n\t\t\t\treturn cos(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns tan(z).\n\t\t\tvec2 ctan(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 2.0)));\n\t\t\t\t\n\t\t\t\treturn cdiv(cmul(vec2(0.0, -1.0), vec2(-1.0, 0.0) + temp), vec2(1.0, 0.0) + temp);\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctan(float z)\n\t\t\t{\n\t\t\t\treturn tan(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns f(z) for a polynomial f with given roots.\n\t\t\tvec2 f(vec2 z)\n\t\t\t{\n\t\t\t\treturn ${L.value||"cmul(csin(z), csin(cmul(z, i)))"};\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Approximates f'(z) for a polynomial f with given roots.\n\t\t\tvec2 cderiv(vec2 z)\n\t\t\t{\n\t\t\t\treturn derivative_precision * (f(z + vec2(1.0 / (2.0*derivative_precision), 0.0)) - f(z - vec2(1.0 / (2.0*derivative_precision), 0.0)));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z;\n\t\t\t\tvec2 last_z = vec2(0.0, 0.0);\n\t\t\t\tvec2 old_z = vec2(0.0, 0.0);\n\t\t\t\t\n\t\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 200; iteration++)\n\t\t\t\t{\n\t\t\t\t\tvec2 temp = cmul(cmul(f(z), cinv(cderiv(z))), a) + c;\n\t\t\t\t\t\n\t\t\t\t\told_z = last_z;\n\t\t\t\t\t\n\t\t\t\t\tlast_z = z;\n\t\t\t\t\t\n\t\t\t\t\tz -= temp;\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t//If we're slowing down, it's reasonably safe to assume that we're near a root.\n\t\t\t\t\t\n\t\t\t\t\tfloat d_0 = length(last_z - z);\n\t\t\t\t\t\n\t\t\t\t\tif (d_0 < threshhold)\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat d_1 = length(old_z - last_z);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness_adjust = (log(threshhold) - log(d_0)) / (log(d_1) - log(d_0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat brightness = 1.0 - (float(iteration) - brightness_adjust) / brightness_scale;\n\t\t\t\t\t\t\n\t\t\t\t\t\t//Round to a square grid so that basin colors are consistent.\n\t\t\t\t\t\tvec2 theoretical_root = floor(z / (threshhold / 3.0)) * threshhold / 3.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat c0 = sin(theoretical_root.x * 7.239846) + cos(theoretical_root.x * 2.945387) + 2.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat c1 = sin(theoretical_root.y * 5.918445) + cos(theoretical_root.y * .987235) + 2.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat c2 = sin((theoretical_root.x + theoretical_root.y) * 1.023974) + cos((theoretical_root.x + theoretical_root.y) * 9.130874) + 2.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat c3 = sin((theoretical_root.x - theoretical_root.y) * 3.258342) + cos((theoretical_root.x - theoretical_root.y) * 4.20957) + 2.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\t//Pick an interpolated color between the 4 that we chose earlier.\n\t\t\t\t\t\tgl_FragColor = vec4((c0 * colors[0] + c1 * colors[1] + c2 * colors[2] + c3 * colors[3]) / (c0 + c1 + c2 + c3) * brightness, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`,r={renderer:"gpu",shader:e,canvas_width:500,canvas_height:500,world_width:12,world_height:12,world_center_x:0,world_center_y:0,use_draggables:!0,draggables_mousemove_callback:B,draggables_touchmove_callback:B,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:G,mousedown_callback:W,touchstart_callback:W,mousedrag_callback:C,touchmove_callback:C,mouseup_callback:H,touchend_callback:H,wheel_callback:N,pinch_callback:T},o={renderer:"gpu",shader:e,canvas_width:100,canvas_height:100};try{t.output_canvas_container.parentNode.remove(),n.output_canvas_container.parentNode.remove(),E.insertAdjacentHTML("beforebegin",'\n\t\t\t\t<div>\n\t\t\t\t\t<canvas id="output-canvas" class="output-canvas"></canvas>\n\t\t\t\t\t<canvas id="hidden-canvas" class="hidden-canvas"></canvas>\n\t\t\t\t</div>\n\t\t\t')}catch(t){}(t=new Wilson(document.querySelector("#output-canvas"),r)).render.init_uniforms(["aspect_ratio","derivative_precision","world_center_x","world_center_y","world_size","colors","a","c","brightness_scale"]),(n=new Wilson(document.querySelector("#hidden-canvas"),o)).render.init_uniforms(["aspect_ratio","derivative_precision","world_center_x","world_center_y","world_size","colors","a","c","brightness_scale"]),c=[],a=2,d=0,w=0,_=0,v=0,z=0,m=0;let l=t.draggables.add(1,0);l.classList.add("a-marker"),(l=t.draggables.add(0,0)).classList.add("c-marker"),k=P(),t.gl.uniform1f(t.uniforms.aspect_ratio,1),n.gl.uniform1f(n.uniforms.aspect_ratio,1),t.gl.uniform1f(t.uniforms.derivative_precision,s),n.gl.uniform1f(n.uniforms.derivative_precision,s),t.gl.uniform3fv(t.uniforms.colors,k),n.gl.uniform3fv(n.uniforms.colors,k),window.requestAnimationFrame(D)}function P(){let n=new Array(12),e=0,r=[];for(let o=0;o<4;o++){e=Math.random()*(1-2*o*.1);for(let t=0;t<o;t++)e>r[t]&&(e+=.2);r[o]=e-.1,r.sort(),console.log(e);let a=t.utils.hsv_to_rgb(e,.25*Math.random()+.75,.25*Math.random()+.75);n[3*o]=a[0]/255,n[3*o+1]=a[1]/255,n[3*o+2]=a[2]/255}return n}function W(t,n,e){v=0,z=0,m=0,d=0,w=0,_=0}function C(n,e,r,o,a){t.world_center_x-=r,t.world_center_y-=o,d=-r,w=-o,window.requestAnimationFrame(D),t.draggables.recalculate_locations()}function H(n,e,r){Math.sqrt(d*d+w*w)>=g*Math.min(t.world_width,t.world_height)&&(v=d,z=w),Math.abs(_)>=y&&(m=_),window.requestAnimationFrame(D)}function N(t,n,e,r){u=t,f=n,Math.abs(e/100)<.3?a+=e/100:m+=.05*Math.sign(e),$()}function T(n,e,r,c){o>=1?(a-=r/t.world_width*10,_=-r/t.world_width*10):(a-=r/t.world_height*10,_=-r/t.world_height*10),u=n,f=e,$()}function $(){if(o>=1){let n=t.input.get_zoomed_world_center(u,f,3*Math.pow(2,a)*o,3*Math.pow(2,a));t.world_width=3*Math.pow(2,a)*o,t.world_height=3*Math.pow(2,a),t.world_center_x=n[0],t.world_center_y=n[1]}else{let n=t.input.get_zoomed_world_center(u,f,3*Math.pow(2,a),3*Math.pow(2,a)/o);t.world_width=3*Math.pow(2,a),t.world_height=3*Math.pow(2,a)/o,t.world_center_x=n[0],t.world_center_y=n[1]}window.requestAnimationFrame(D),t.draggables.recalculate_locations()}function B(t,n,o,a){0===t?e=[n,o]:r=[n,o],window.requestAnimationFrame(D)}function D(l){let s=l-M;if(M=l,0===s)return;n.gl.uniform1f(n.uniforms.aspect_ratio,o),n.gl.uniform1f(n.uniforms.world_center_x,t.world_center_x),n.gl.uniform1f(n.uniforms.world_center_y,t.world_center_y),n.gl.uniform1f(n.uniforms.world_size,Math.min(t.world_height,t.world_width)/2),n.gl.uniform2fv(n.uniforms.a,e),n.gl.uniform2f(n.uniforms.c,r[0]/10,r[1]/10),n.gl.uniform1f(n.uniforms.brightness_scale,30),n.render.draw_frame();let u=n.render.get_pixel_data(),f=new Array(i*i);for(let t=0;t<i*i;t++)f[t]=Math.max(Math.max(u[4*t],u[4*t+1]),u[4*t+2]);f.sort((t,n)=>t-n);let d=Math.min(1e4/(f[Math.floor(i*i*.96)]+f[Math.floor(i*i*.98)]),200);c.push(d);let w=c.length;w>10&&c.shift(),d=Math.max(c.reduce((t,n)=>t+n)/w,.5),t.gl.uniform1f(t.uniforms.aspect_ratio,o),t.gl.uniform1f(t.uniforms.world_center_x,t.world_center_x),t.gl.uniform1f(t.uniforms.world_center_y,t.world_center_y),t.gl.uniform1f(t.uniforms.world_size,Math.min(t.world_height,t.world_width)/2),t.gl.uniform2fv(t.uniforms.a,e),t.gl.uniform2f(t.uniforms.c,r[0]/10,r[1]/10),t.gl.uniform1f(t.uniforms.brightness_scale,d),t.render.draw_frame();let _=!1;q&&(!function(){let e=.5*Math.sin(Math.PI*R/30-Math.PI/2)+.5;for(let t=0;t<12;t++)k[t]=F[t]+A[t]*e;t.gl.uniform3fv(t.uniforms.colors,k),n.gl.uniform3fv(n.uniforms.colors,k),31==++R&&(q=!1)}(),_=!0),0===v&&0===z&&0===m||(t.world_center_x+=v,t.world_center_y+=z,v*=h,z*=h,Math.sqrt(v*v+z*z)<p*Math.min(t.world_width,t.world_height)&&(v=0,z=0),a+=m,$(),m*=x,Math.abs(m)<b&&(m=0),_=!0,t.draggables.recalculate_locations()),_&&window.requestAnimationFrame(D)}function G(){t.fullscreen.currently_fullscreen?(o=window.innerWidth/window.innerHeight)>=1?(t.change_canvas_size(l,Math.floor(l/o)),t.world_width=3*Math.pow(2,a)*o,t.world_height=3*Math.pow(2,a)):(t.change_canvas_size(Math.floor(l*o),l),t.world_width=3*Math.pow(2,a),t.world_height=3*Math.pow(2,a)/o):(o=1,t.change_canvas_size(l,l),t.world_width=3*Math.pow(2,a),t.world_height=3*Math.pow(2,a)),window.requestAnimationFrame(D)}I(),window.addEventListener("resize",G),Page.temporary_handlers.resize.push(G)}();