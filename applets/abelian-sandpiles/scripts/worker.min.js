"use strict";onmessage=async function(e){grid_size=e.data[0],num_grains=e.data[1],maximum_speed=e.data[2],await draw_sandpile_graph()};let grid_size=null,num_grains=null,maximum_speed=null,sandpile_graph=[],old_sandpile_graph=[];async function draw_sandpile_graph(){sandpile_graph=[],old_sandpile_graph=[];for(let e=0;e<grid_size;e++){sandpile_graph[e]=[],old_sandpile_graph[e]=[];for(let a=0;a<grid_size;a++)sandpile_graph[e][a]=0,old_sandpile_graph[e][a]=0}sandpile_graph[Math.floor(grid_size/2)][Math.floor(grid_size/2)]=num_grains;let e=0,a=!0;for(;a;){a=!1;for(let e=1;e<grid_size-1;e++)for(let i=1;i<grid_size-1;i++)if(sandpile_graph[e][i]>=4){let s=sandpile_graph[e][i]>>2;sandpile_graph[e][i]&=3,sandpile_graph[e-1][i]+=s,sandpile_graph[e][i+1]+=s,sandpile_graph[e+1][i]+=s,sandpile_graph[e][i-1]+=s,a=!0}e%Math.floor(num_grains/500)==0&&(maximum_speed?color_piles():await color_piles()),e++}maximum_speed?color_piles():await color_piles()}function color_piles(){return new Promise(function(e,a){let i=0;for(let e=1;e<grid_size-1;e++)for(let a=1;a<grid_size-1;a++)sandpile_graph[e][a]>i&&(i=sandpile_graph[e][a]);for(let e=1;e<grid_size-1;e++)for(let a=1;a<grid_size-1;a++)if(sandpile_graph[e][a]!==old_sandpile_graph[e][a]){let s=sandpile_graph[e][a],r=s/i*255;0===s?postMessage([a,e,"rgb(0, 0, 0)"]):1===s?postMessage([a,e,"rgb(0, 127, 255)"]):2===s?postMessage([a,e,"rgb(92, 0, 255)"]):3===s?postMessage([a,e,"rgb(255, 255, 0)"]):postMessage([a,e,`rgb(${r}, ${r}, ${r})`])}for(let e=1;e<grid_size-1;e++)for(let a=1;a<grid_size-1;a++)old_sandpile_graph[e][a]=sandpile_graph[e][a];setTimeout(e,50)})}