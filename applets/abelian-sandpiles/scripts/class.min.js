"use strict";class AbelianSandpile extends Applet{grid_size=100;canvas_scale_factor=5;web_worker=null;constructor(s){super(s);let i={renderer:"cpu",canvas_width:this.grid_size,canvas_height:this.grid_size,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson(s,i)}run(s,i){this.num_grains=s,this.maximum_speed=i,this.grid_size=Math.floor(Math.sqrt(this.num_grains))+2,this.grid_size%2==0&&this.grid_size++;let e=Math.min(window.innerWidth,window.innerWidth);this.canvas_scale_factor=Math.ceil(e/this.grid_size),this.wilson.change_canvas_size(this.grid_size*this.canvas_scale_factor,this.grid_size*this.canvas_scale_factor),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.grid_size*this.canvas_scale_factor,this.grid_size*this.canvas_scale_factor);try{this.web_worker.terminate()}catch(t){}this.web_worker=new Worker(`/applets/abelian-sandpiles/scripts/worker.${DEBUG?"":"min."}js`),Page.temporary_web_workers.push(this.web_worker),this.web_worker.onmessage=s=>{let i=s.data[0];for(let e=0;e<this.grid_size;e++)for(let t=0;t<this.grid_size;t++)this.wilson.ctx.fillStyle=i[e][t],this.wilson.ctx.fillRect(t*this.canvas_scale_factor,e*this.canvas_scale_factor,this.canvas_scale_factor,this.canvas_scale_factor)},this.web_worker.postMessage([this.grid_size,this.num_grains,this.maximum_speed])}}