import{showPage}from"../../../scripts/src/loadPage.min.js";import{LambdaCalculus}from"./class.min.js";import{Button,DownloadButton}from"/scripts/src/buttons.min.js";import{$}from"/scripts/src/main.min.js";import{setOnThemeChange}from"/scripts/src/settings.min.js";import{Textarea}from"/scripts/src/textareas.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";export default function(){const s=new LambdaCalculus({canvas:$("#output-canvas")}),a=new TextBox({element:$("#resolution-input"),name:"Resolution",value:2e3,minValue:1e3,maxValue:3e3,onEnter:e}),r=new Textarea({element:$("#expression-textarea"),name:"Expression",value:"",onInput:e,allowEnter:!0});async function e(){await Promise.all([r.loaded,a.loaded]);var{selectionStart:e,selectionEnd:n}=r.element,e=(r.setValue(r.value.replaceAll(/l/gi,"λ")),r.setValue(r.value.replaceAll(/[^a-km-zA-KM-Zλ().]/g,"")),r.element.setSelectionRange(e,n),function(expressionString){let e=0,n=expressionString.search(/\(/g);for(let s=0;s<expressionString.length;s++){if("("===expressionString[s]?e++:")"===expressionString[s]&&e--,e<0)return[s,s+1];0===e&&(n=s+1)}if(0!==e)return[n,n+1];var t=expressionString.search(/λ([a-mk-zA-KM-Z])[()λ]/g);return-1===t?-1===(t=expressionString.search(/λ([a-mk-zA-KM-Z])$/g))?-1===(t=expressionString.search(/λ\./g))?-1===(t=expressionString.search(/λ[a-mk-zA-KM-Z]\.$/g))?-1:[t,t+expressionString.match(/λ[a-mk-zA-KM-Z]\.$/g)[0].length]:[t,t+expressionString.match(/λ\./g)[0].length]:[t,t+expressionString.match(/λ([a-mk-zA-KM-Z])$/g)[0].length]:[t,t+expressionString.match(/λ([a-mk-zA-KM-Z])[()λ]/g)[0].length]}(r.value));if(-1!==e)r.overlayElement.innerHTML=r.value.slice(0,e[0])+`<span class="invalid">${r.value.slice(e[0],e[1])}</span>`+r.value.slice(e[1]);else{const t=s.run({resolution:a.value,expression:r.value});r.overlayElement.innerHTML=t,setTimeout(()=>r.overlayElement.innerHTML=t,50)}}new Button({element:$("#evaluate-button"),name:"Evaluate",onClick:e}),new DownloadButton({element:$("#download-button"),applet:s,filename:"lambda-calculus.png"}),showPage(),e(),setOnThemeChange(()=>e())}