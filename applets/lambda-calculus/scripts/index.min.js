import{showPage}from"../../../scripts/src/loadPage.min.js";import{LambdaCalculus}from"./class.min.js";import{Button,DownloadButton}from"/scripts/src/buttons.min.js";import{$}from"/scripts/src/main.min.js";import{Textarea}from"/scripts/src/textareas.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";export default function(){const t=new LambdaCalculus({canvas:$("#output-canvas")});new TextBox({element:$("#resolution-input"),name:"Resolution",value:2e3,minValue:1e3,maxValue:3e3,onEnter:e});const s=new Textarea({element:$("#expression-textarea"),name:"Expression",value:"",onInput:e,allowEnter:!0});function e(){var{selectionStart:e,selectionEnd:n}=s.element,e=(s.setValue(s.value.replaceAll(/l/g,"λ")),s.setValue(s.value.replaceAll(/[^a-km-zA-KM-Zλ().\n\t ]/g,"")),s.element.setSelectionRange(e,n),function(expressionString){let e=0,n=expressionString.search(/\(/g);for(let s=0;s<expressionString.length;s++){if("("===expressionString[s]?e++:")"===expressionString[s]&&e--,e<0)return s;0===e&&(n=s+1)}if(0!==e)return[n,n+1];var t=expressionString.search(/λ([a-mk-zA-KM-Z]*)[()λ]/g);return-1===t?-1===(t=expressionString.search(/λ([a-mk-zA-KM-Z]*)$/g))?-1===(t=expressionString.search(/λ\./g))?-1===(t=expressionString.search(/λ[a-mk-zA-KM-Z]*\.$/g))?-1:[t,t+expressionString.match(/λ[a-mk-zA-KM-Z]*\.$/g)[0].length]:[t,t+expressionString.match(/λ\./g)[0].length]:[t,t+expressionString.match(/λ([a-mk-zA-KM-Z]*)$/g)[0].length]:[t,t+expressionString.match(/λ([a-mk-zA-KM-Z]*)[()λ]/g)[0].length]}(s.value));-1!==e?s.overlayElement.innerHTML=s.value.slice(0,e[0])+`<span class="invalid">${s.value.slice(e[0],e[1])}</span>`+s.value.slice(e[1]):(n=s.value.replaceAll(/λ([a-mk-zA-KM-Z]+?)\./g,(match,$1)=>{return`λ${$1.split("").join(".λ")}.`}),t.run({expression:n}))}new Button({element:$("#evaluate-button"),name:"Evaluate",onClick:e}),new DownloadButton({element:$("#download-button"),applet:t,filename:"lambda-calculus.png"}),showPage(),e()}