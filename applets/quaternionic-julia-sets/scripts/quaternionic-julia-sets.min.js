!function(){"use strict";let t={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio_x;\n\t\tuniform float aspect_ratio_y;\n\t\t\n\t\tuniform vec3 camera_pos;\n\t\tuniform vec3 image_plane_center_pos;\n\t\tuniform vec3 forward_vec;\n\t\tuniform vec3 right_vec;\n\t\tuniform vec3 up_vec;\n\t\t\n\t\tuniform float focal_length;\n\t\t\n\t\tuniform vec3 light_pos;\n\t\tconst float light_brightness = 1.5;\n\t\t\n\t\tuniform int image_size;\n\t\t\n\t\tuniform int draw_sphere;\n\t\t\n\t\tuniform int max_iterations;\n\t\t\n\t\t\n\t\t\n\t\tconst float clip_distance = 1000.0;\n\t\tuniform int max_marches;\n\t\tuniform float step_factor;\n\t\tconst vec3 fog_color = vec3(0.0, 0.0, 0.0);\n\t\tconst float fog_scaling = .1;\n\t\t\n\t\tconst float k_slice = 0.0;\n\t\t\n\t\t\n\t\tvec3 color;\n\t\t\n\t\t\n\t\tuniform vec3 c;\n\t\tuniform float julia_proportion;\n\t\t\n\t\t\n\t\t\n\t\tvec4 qmul(vec4 z, vec4 w)\n\t\t{\n\t\t\treturn vec4(z.x*w.x - z.y*w.y - z.z*w.z - z.w*w.w, z.x*w.y + z.y*w.x + z.z*w.w - z.w*w.z, z.x*w.z - z.y*w.w + z.z*w.x + z.w*w.y, z.x*w.w + z.y*w.z - z.z*w.y + z.w*w.x);\n\t\t}\n\t\t\n\t\t\n\t\tfloat distance_estimator(vec3 pos)\n\t\t{\n\t\t\tvec4 z = vec4(pos, k_slice);\n\t\t\tvec4 z_prime = vec4(1.0, 0.0, 0.0, 0.0);\n\t\t\tfloat r;\n\t\t\t\n\t\t\tcolor = vec3(1.0, 1.0, 1.0);\n\t\t\tfloat color_scale = .5;\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tr = length(z);\n\t\t\t\t\n\t\t\t\tif (r > 16.0 || iteration >= max_iterations)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz_prime = 2.0 * qmul(z, z_prime);\n\t\t\t\t\n\t\t\t\tz = qmul(z, z);\n\t\t\t\t\n\t\t\t\tz += mix(vec4(pos, k_slice), vec4(c, k_slice), julia_proportion);\n\t\t\t\t\n\t\t\t\tcolor = mix(color, abs(normalize(z.xyz)), color_scale);\n\t\t\t\t\n\t\t\t\tcolor_scale *= .5;\n\t\t\t}\n\t\t\t\n\t\t\tcolor /= max(max(color.x, color.y), color.z);\n\t\t\t\n\t\t\t\n\t\t\tr = length(z);\n\t\t\tfloat distance_1 = .5 * r * log(r) / length(z_prime);\n\t\t\tfloat distance_2 = length(pos - c) - .05;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tif (distance_2 < distance_1 && draw_sphere == 1)\n\t\t\t{\n\t\t\t\tcolor = vec3(1.0, 1.0, 1.0);\n\t\t\t\t\n\t\t\t\treturn distance_2;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\treturn distance_1;\n\t\t\treturn length(pos - c) - .05;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 get_surface_normal(vec3 pos)\n\t\t{\n\t\t\tfloat x_step_1 = distance_estimator(pos + vec3(.000001, 0.0, 0.0));\n\t\t\tfloat y_step_1 = distance_estimator(pos + vec3(0.0, .000001, 0.0));\n\t\t\tfloat z_step_1 = distance_estimator(pos + vec3(0.0, 0.0, .000001));\n\t\t\t\n\t\t\tfloat x_step_2 = distance_estimator(pos - vec3(.000001, 0.0, 0.0));\n\t\t\tfloat y_step_2 = distance_estimator(pos - vec3(0.0, .000001, 0.0));\n\t\t\tfloat z_step_2 = distance_estimator(pos - vec3(0.0, 0.0, .000001));\n\t\t\t\n\t\t\treturn normalize(vec3(x_step_1 - x_step_2, y_step_1 - y_step_2, z_step_1 - z_step_2));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 compute_shading(vec3 pos, int iteration)\n\t\t{\n\t\t\tvec3 surface_normal = get_surface_normal(pos);\n\t\t\t\n\t\t\tvec3 light_direction = normalize(light_pos - pos);\n\t\t\t\n\t\t\tfloat dot_product = dot(surface_normal, light_direction);\n\t\t\t\n\t\t\tfloat light_intensity = light_brightness * max(dot_product, -.25 * dot_product);\n\t\t\t\n\t\t\t//The last factor adds ambient occlusion.\n\t\t\tcolor = color * light_intensity * max((1.0 - float(iteration) / float(max_marches)), 0.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Apply fog.\n\t\t\treturn mix(color, fog_color, 1.0 - exp(-distance(pos, camera_pos) * fog_scaling));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 raymarch(vec3 start_pos)\n\t\t{\n\t\t\t//That factor of .9 is important -- without it, we're always stepping as far as possible, which results in artefacts and weirdness.\n\t\t\tvec3 ray_direction_vec = normalize(start_pos - camera_pos) * .9 / step_factor;\n\t\t\t\n\t\t\tvec3 final_color = fog_color;\n\t\t\t\n\t\t\tfloat epsilon = 0.0;\n\t\t\t\n\t\t\tfloat t = 0.0;\n\t\t\t\n\t\t\tfloat last_distance = 1000.0;\n\t\t\t\n\t\t\t//int slowed_down = 0;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 1024; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == max_marches)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec3 pos = start_pos + t * ray_direction_vec;\n\t\t\t\t\n\t\t\t\t//This prevents overstepping, and is honestly a pretty clever fix.\n\t\t\t\tfloat distance = min(distance_estimator(pos), last_distance);\n\t\t\t\tlast_distance = distance;\n\t\t\t\t\n\t\t\t\t//This lowers the detail far away, which makes everything run nice and fast.\n\t\t\t\tepsilon = max(.0000006, .5 * t / float(image_size));\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (distance < epsilon)\n\t\t\t\t{\n\t\t\t\t\tfinal_color = compute_shading(pos, iteration);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//Uncomment to add aggressive understepping when close to the fractal boundary, which helps to prevent flickering but is a significant performance hit.\n\t\t\t\t/*\n\t\t\t\telse if (last_distance / distance > .9999 && slowed_down == 0)\n\t\t\t\t{\n\t\t\t\t\tray_direction_vec = normalize(start_pos - camera_pos) * .125;\n\t\t\t\t\t\n\t\t\t\t\tslowed_down = 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse if (last_distance / distance <= .9999 && slowed_down == 1)\n\t\t\t\t{\n\t\t\t\t\tray_direction_vec = normalize(start_pos - camera_pos) * .9;\n\t\t\t\t\t\n\t\t\t\t\tslowed_down = 0;\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\t\n\t\t\t\telse if (t > clip_distance)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tt += distance;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\treturn final_color;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\t//Uncomment to use 2x antialiasing.\n\t\t\t//vec3 final_color = (raymarch(image_plane_center_pos + right_vec * (uv.x * aspect_ratio + .5 / float(image_size)) + up_vec * (uv.y + .5 / float(image_size))) + raymarch(image_plane_center_pos + right_vec * (uv.x * aspect_ratio + .5 / float(image_size)) + up_vec * (uv.y - .5 / float(image_size))) + raymarch(image_plane_center_pos + right_vec * (uv.x * aspect_ratio - .5 / float(image_size)) + up_vec * (uv.y + .5 / float(image_size))) + raymarch(image_plane_center_pos + right_vec * (uv.x * aspect_ratio - .5 / float(image_size)) + up_vec * (uv.y - .5 / float(image_size)))) / 4.0;\n\t\t\t\n\t\t\tgl_FragColor = vec4(raymarch(image_plane_center_pos + right_vec * uv.x * aspect_ratio_x + up_vec * uv.y / aspect_ratio_y), 1.0);\n\t\t}\n\t",canvas_width:500,canvas_height:500,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:ut,mousedown_callback:it,touchstart_callback:it,mousedrag_callback:rt,touchmove_callback:rt,mouseup_callback:st,touchend_callback:st},e=new Wilson(document.querySelector("#output-canvas"),t);e.render.init_uniforms(["aspect_ratio_x","aspect_ratio_y","image_size","camera_pos","image_plane_center_pos","forward_vec","right_vec","up_vec","focal_length","light_pos","draw_sphere","c","julia_proportion","max_marches","step_factor","max_iterations"]);let n=!1,o=!1,a=!1,i=!1,r=!1,s=!1,c=!1,l=!1,u=0,_=[0,0,0],m=[0,0,0];const f=.94,p=5e-4;let d=1,h=-1,g=1.4824,v=1.9469,y=0,w=0,z=0,x=0;const M=.94,k=.005,q=5e-4;let b=500,P=500,C=500,I=16,S=100,L=[],E=[],F=[],T=[],A=[-.3796,-3.4871,1.4271],j=2,N=[-.528783,.123638,.672392],U=[0,0,0],B=[0,0,0],J=0,W=1,D=0,G=0,H=0,K=0,O=document.querySelector("#resolution-input");O.addEventListener("input",ut);let Q=document.querySelector("#iterations-input");Q.addEventListener("input",()=>{I=parseInt(Q.value||16),e.gl.uniform1i(e.uniforms.max_iterations,I),window.requestAnimationFrame(et)});let R=document.querySelector("#view-distance-input");R.addEventListener("input",()=>{S=Math.max(parseInt(R.value||100),32),e.gl.uniform1i(e.uniforms.max_marches,S),window.requestAnimationFrame(et)}),document.querySelector("#download-button").addEventListener("click",()=>{0===W?e.download_frame("the-quaternionic-mandelbrot-set.png"):e.download_frame("a-quaternionic-julia-set.png")});let V=document.querySelector("#c-x-input"),X=document.querySelector("#c-y-input"),Y=document.querySelector("#c-z-input"),Z=[V,X,Y];for(let t=0;t<Z.length;t++)Z[t].addEventListener("input",_t);document.querySelector("#randomize-c-button").addEventListener("click",function(t=!0){if(n)return;U[0]=N[0],U[1]=N[1],U[2]=N[2],B[0]=2*Math.random()-1-U[0],B[1]=2*Math.random()-1-U[1],B[2]=2*Math.random()-1-U[2],V.value=Math.round(1e6*(U[0]+B[0]))/1e6,X.value=Math.round(1e6*(U[1]+B[1]))/1e6,Y.value=Math.round(1e6*(U[2]+B[2]))/1e6,G=W,H=0,t?mt():(N[0]=U[0]+B[0],N[1]=U[1]+B[1],N[2]=U[2]+B[2])});let $=document.querySelector("#switch-bulb-button");$.addEventListener("click",function(){if(n)return;$.style.opacity=0,setTimeout(()=>{$.textContent=0===G?"Switch to Mandelbrot Set":"Switch to Julia Set",Page.Load.TextButtons.equalize(),$.style.opacity=1},Site.opacity_animation_time),0===W?(e.gl.uniform3fv(e.uniforms.c,N),D||e.gl.uniform1i(e.uniforms.draw_sphere,1),setTimeout(()=>{tt.style.opacity=1},Site.opacity_animation_time)):(D=!0,e.gl.uniform1i(e.uniforms.draw_sphere,0),tt.style.opacity=0);H=1-2*(G=W),U[0]=N[0],U[1]=N[1],U[2]=N[2],B[0]=0,B[1]=0,B[2]=0,mt()});let tt=document.querySelector("#switch-movement-button");function et(t){let l=t-h;if(h=t,0===l)return;e.render.draw_frame();let k=!1;n&&(!function(){let t=.5*Math.sin(Math.PI*K/120-Math.PI/2)+.5;N[0]=U[0]+B[0]*t,N[1]=U[1]+B[1]*t,N[2]=U[2]+B[2]*t,e.gl.uniform3fv(e.uniforms.c,N),W=G+H*t,e.gl.uniform1f(e.uniforms.julia_proportion,W),121==++K&&(n=!1)}(),k=!0),o||a||i||r||s||c?(!function(){if(u=Math.min(Math.max(1e-6,d/20),.02),D){let t=[...A];o||s?(A[0]+=u*E[0],A[1]+=u*E[1],A[2]+=u*E[2]):(a||c)&&(A[0]-=u*E[0],A[1]-=u*E[1],A[2]-=u*E[2]),i?(A[0]+=u*F[0]/j,A[1]+=u*F[1]/j,A[2]+=u*F[2]/j):r&&(A[0]-=u*F[0]/j,A[1]-=u*F[1]/j,A[2]-=u*F[2]/j),_[0]=A[0]-t[0],_[1]=A[1]-t[1],_[2]=A[2]-t[2]}else{let t=[...N];o||s?(N[0]+=.5*u*E[0],N[1]+=.5*u*E[1],N[2]+=.5*u*E[2]):(a||c)&&(N[0]-=.5*u*E[0],N[1]-=.5*u*E[1],N[2]-=.5*u*E[2]),i?(N[0]+=.5*u*F[0]/j,N[1]+=.5*u*F[0]/j,N[2]+=.5*u*F[0]/j):r&&(N[0]-=.5*u*F[0]/j,N[1]-=.5*u*F[0]/j,N[2]-=.5*u*F[0]/j),V.value=Math.round(1e6*N[0])/1e6,X.value=Math.round(1e6*N[1])/1e6,Y.value=Math.round(1e6*N[2])/1e6,e.gl.uniform3fv(e.uniforms.c,N),_[0]=N[0]-t[0],_[1]=N[1]-t[1],_[2]=N[2]-t[2]}nt()}(),k=!0):l>=50&&(y=0,w=0,z=0,x=0,s=!1,c=!1,m[0]=0,m[1]=0,m[2]=0,_[0]=0,_[1]=0,_[2]=0),0===z&&0===x||(v+=x,(g+=z)>=2*Math.PI?g-=2*Math.PI:g<0&&(g+=2*Math.PI),v>Math.PI-.01?v=Math.PI-.01:v<.01&&(v=.01),z*=M,x*=M,Math.sqrt(z*z+x*x)<q&&(z=0,x=0),nt(),k=!0),0===m[0]&&0===m[1]&&0===m[2]||(D?(A[0]+=m[0],A[1]+=m[1],A[2]+=m[2]):(N[0]+=m[0],N[1]+=m[1],N[2]+=m[2],V.value=Math.round(1e6*N[0])/1e6,X.value=Math.round(1e6*N[1])/1e6,Y.value=Math.round(1e6*N[2])/1e6,e.gl.uniform3fv(e.uniforms.c,N)),m[0]*=f,m[1]*=f,m[2]*=f,Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])<p*u&&(m[0]=0,m[1]=0,m[2]=0),nt(),k=!0),k&&window.requestAnimationFrame(et)}function nt(){var t,n;E=[Math.cos(g)*Math.sin(v),Math.sin(g)*Math.sin(v),Math.cos(v)],F=function(t){let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]}([E[1],-E[0],0]),n=E,T=[(t=F)[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]],d=function(t,e,n){let o=[t,e,n,J],a=[1,0,0,0],i=0;for(let r=0;r<4*I&&!((i=Math.sqrt(ot(o,o)))>16);r++)(a=at(...o,...a))[0]*=2,a[1]*=2,a[2]*=2,a[3]*=2,(o=at(...o,...o))[0]+=(1-W)*t+W*N[0],o[1]+=(1-W)*e+W*N[1],o[2]+=(1-W)*n+W*N[2],o[3]+=J;return.5*Math.log(i)*i/Math.sqrt(ot(a,a))}(A[0],A[1],A[2]),j=d/2,F[0]*=j/2,F[1]*=j/2,T[0]*=j/2,T[1]*=j/2,T[2]*=j/2,L=[A[0]+j*E[0],A[1]+j*E[1],A[2]+j*E[2]],e.gl.uniform3fv(e.uniforms.camera_pos,A),e.gl.uniform3fv(e.uniforms.image_plane_center_pos,L),e.gl.uniform3fv(e.uniforms.forward_vec,E),e.gl.uniform3fv(e.uniforms.right_vec,F),e.gl.uniform3fv(e.uniforms.up_vec,T),e.gl.uniform1f(e.uniforms.focal_length,j)}function ot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function at(t,e,n,o,a,i,r,s){return[t*a-e*i-n*n-o*s,t*i+e*a+n*s-o*r,t*r-e*s+n*a+o*i,t*s+e*r-n*i+o*a]}function it(t,e,n){y=0,w=0,z=0,x=0,"touchstart"===n.type&&(2===n.touches.length?(s=!0,c=!1,m[0]=0,m[1]=0,m[2]=0,_[0]=0,_[1]=0,_[2]=0,window.requestAnimationFrame(et)):3===n.touches.length?(s=!1,c=!0,m[0]=0,m[1]=0,m[2]=0,_[0]=0,_[1]=0,_[2]=0,window.requestAnimationFrame(et)):(s=!1,c=!1),l=!1)}function rt(t,e,n,o,a){"touchmove"===a.type&&l?l=!1:(g+=n*Math.PI/2,y=n*Math.PI/2,g>=2*Math.PI?g-=2*Math.PI:g<0&&(g+=2*Math.PI),v+=o*Math.PI/2,w=o*Math.PI/2,v>Math.PI-.01?v=Math.PI-.01:v<.01&&(v=.01),nt(),window.requestAnimationFrame(et))}function st(t,e,n){"touchend"===n.type&&(s=!1,c=!1,l=!0,0===m[0]&&0===m[1]&&0===m[2]&&(m[0]=_[0],m[1]=_[1],m[2]=_[2],_[0]=0,_[1]=0,_[2]=0)),"touchend"===n.type&&n.touches,(0===length||"mouseup"===n.type)&&Math.sqrt(y*y+w*w)>=k&&(z=y,x=w)}function ct(t){"INPUT"===document.activeElement.tagName||87!==t.keyCode&&83!==t.keyCode&&68!==t.keyCode&&65!==t.keyCode||(_=[0,0,0],m=[0,0,0],87===t.keyCode?o=!0:83===t.keyCode&&(a=!0),68===t.keyCode?i=!0:65===t.keyCode&&(r=!0),window.requestAnimationFrame(et))}function lt(t){"INPUT"===document.activeElement.tagName||87!==t.keyCode&&83!==t.keyCode&&68!==t.keyCode&&65!==t.keyCode||(0===m[0]&&0===m[1]&&0===m[2]&&(m[0]=_[0],m[1]=_[1],m[2]=_[2],_[0]=0,_[1]=0,_[2]=0),87===t.keyCode?o=!1:83===t.keyCode&&(a=!1),68===t.keyCode?i=!1:65===t.keyCode&&(r=!1))}function ut(){b=Math.max(100,parseInt(O.value||500)),e.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(P=b,C=Math.floor(b/Page.Layout.aspect_ratio)):(P=Math.floor(b*Page.Layout.aspect_ratio),C=b):(P=b,C=b),e.change_canvas_size(P,C),P>=C?(e.gl.uniform1f(e.uniforms.aspect_ratio_x,P/C),e.gl.uniform1f(e.uniforms.aspect_ratio_y,1)):(e.gl.uniform1f(e.uniforms.aspect_ratio_x,1),e.gl.uniform1f(e.uniforms.aspect_ratio_y,P/C)),e.gl.uniform1i(e.uniforms.image_size,b),window.requestAnimationFrame(et)}function _t(){U[0]=N[0],U[1]=N[1],U[2]=N[2],B[0]=(parseFloat(V.value||0)||0)-U[0],B[1]=(parseFloat(X.value||0)||0)-U[1],B[2]=(parseFloat(Y.value||0)||0)-U[2],G=W,H=0,mt()}function mt(){n||(n=!0,K=0,window.requestAnimationFrame(et))}tt.addEventListener("click",function(){D=!D,tt.style.opacity=0,setTimeout(()=>{tt.textContent=D?"Change Julia Set":"Move Camera",Page.Load.TextButtons.equalize(),tt.style.opacity=1},Site.opacity_animation_time),D?e.gl.uniform1i(e.uniforms.draw_sphere,0):e.gl.uniform1i(e.uniforms.draw_sphere,1)}),Page.Load.TextButtons.equalize(),nt(),P>=C?(e.gl.uniform1f(e.uniforms.aspect_ratio_x,P/C),e.gl.uniform1f(e.uniforms.aspect_ratio_y,1)):(e.gl.uniform1f(e.uniforms.aspect_ratio_x,1),e.gl.uniform1f(e.uniforms.aspect_ratio_y,P/C)),e.gl.uniform1i(e.uniforms.image_size,b),e.gl.uniform3fv(e.uniforms.camera_pos,A),e.gl.uniform3fv(e.uniforms.image_plane_center_pos,L),e.gl.uniform3fv(e.uniforms.light_pos,[-5,-5,5]),e.gl.uniform3fv(e.uniforms.forward_vec,E),e.gl.uniform3fv(e.uniforms.right_vec,F),e.gl.uniform3fv(e.uniforms.up_vec,T),e.gl.uniform1f(e.uniforms.focal_length,j),e.gl.uniform1i(e.uniforms.draw_sphere,0),e.gl.uniform3fv(e.uniforms.c,N),e.gl.uniform1f(e.uniforms.julia_proportion,1),e.gl.uniform1i(e.uniforms.max_marches,S),e.gl.uniform1f(e.uniforms.step_factor,1),e.gl.uniform1i(e.uniforms.max_iterations,I),window.requestAnimationFrame(et),document.documentElement.addEventListener("keydown",ct),Page.temporary_handlers.keydown.push(ct),document.documentElement.addEventListener("keyup",lt),Page.temporary_handlers.keydown.push(lt)}();