!function(){"use strict";let e=500,t=0,a=3e3,r=1,n=.6515,o=0,l=0,i=.005,$=200,s=[],c=[],f=[],d=!1,h=null,u=Site.applet_process_id,v=null,w=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  const float dt = .005;
  
  
  
  //Don't know how, but this writes an honest float32 to the 32 bits of output, which JS then decodes.
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
   
   float dx = sin(v.y);
   
   float x = dt * dx + v.x;
   
   gl_FragColor = encode_float(x);
  }
 `,g=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  const float dt = .005;
  
  
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
   
   float dy = sin(v.x + 3.14159265);
   
   float y = dt * dy + v.y;
   
   gl_FragColor = encode_float(y);
  }
 `,p=new Wilson(Page.element.querySelector("#update-canvas"),{renderer:"gpu",shader:w,canvas_width:100,canvas_height:100});p.render.load_new_shader(g),p.render.create_framebuffer_texture_pair();let m=new Float32Array(p.canvas_width*p.canvas_height*4);for(let b=0;b<p.canvas_height;b++)for(let _=0;_<p.canvas_width;_++){let x=p.canvas_height*b+_;m[4*x]=0,m[4*x+1]=0,m[4*x+2]=0,m[4*x+3]=0}p.gl.bindTexture(p.gl.TEXTURE_2D,p.render.framebuffers[0].texture),p.gl.bindFramebuffer(p.gl.FRAMEBUFFER,null);let y={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:P,mousedown_callback:Y,touchstart_callback:Y,mousedrag_callback:Z,touchmove_callback:Z,mouseup_callback:ee,touchend_callback:ee,wheel_callback:function e(t,a,r,i){o=t,l=a,.3>Math.abs(r/100)?(U(t,a,r/100),n=Math.min(Math.max(n+r/100,-3),3)):X+=.05*Math.sign(r),et()},pinch_callback:function e(t,a,i,$){let s;U(t,a,-(s=r>=1?i/k.world_width*10:i/k.world_height*10)),n=Math.min(Math.max(n-s,-3),3),M=-s,o=t,l=a,et()}},k=new Wilson(Page.element.querySelector("#output-canvas"),y),E=Page.element.querySelector("#code-textarea"),q=Page.element.querySelector("#generate-button");q.addEventListener("click",()=>{k.world_center_x=0,k.world_center_y=0,k.world_width=2*Math.PI,k.world_height=2*Math.PI,n=.6515,P()});let D=Page.element.querySelector("#resolution-input");D.addEventListener("input",P);let S=Page.element.querySelector("#max-particles-input");S.addEventListener("input",()=>{a=parseInt(S.value||3e3)});let z=Page.element.querySelector("#speed-input");z.addEventListener("input",()=>{i=parseFloat(z.value||1)/100});let F=Page.element.querySelector("#lifetime-input");F.addEventListener("input",P);let L=Page.element.querySelector("#download-button");function P(){v=Function("x","y",`return ${E.value}`),e=parseInt(D.value||500),t=0,a=parseInt(S.value||3e3),i=parseFloat(z.value||1)/100,$=parseInt(F.value||200),ea(),c=Array(a),f=Array(a);for(let r=0;r<a;r++)c[r]=[0,0,0],f[r]=r;s=Array(k.canvas_height);for(let n=0;n<k.canvas_height;n++){s[n]=Array(k.canvas_width);for(let o=0;o<k.canvas_width;o++)s[n][o]=[0,0,0]}h=new Uint8ClampedArray(k.canvas_height*k.canvas_width*4);for(let l=0;l<k.canvas_height;l++)for(let d=0;d<k.canvas_width;d++)h[4*(k.canvas_width*l+d)+3]=255;window.requestAnimationFrame(T)}L.addEventListener("click",()=>{k.download_frame("a-vector-field.png")}),P(),Page.show();let I=-1;function T(e){try{let r=e-I;if(I=e,0===r)return;if(t<a){let w=Math.min(a/100,a-t);for(let g=f.length-w;g<f.length;g++)A(f[g]);f.splice(f.length-w,w)}if(d)d=!1;else{!function e(){for(let t=0;t<p.canvas_height;t++)for(let a=0;a<p.canvas_width;a++){let r=p.canvas_height*t+a;r<c.length&&c[r][2]?(m[4*r]=c[r][0],m[4*r+1]=c[r][1],m[4*r+2]=1):m[4*r+2]=0}p.gl.texImage2D(p.gl.TEXTURE_2D,0,p.gl.RGBA,p.canvas_width,p.canvas_height,0,p.gl.RGBA,p.gl.FLOAT,m),p.gl.useProgram(p.render.shader_programs[0]),p.render.draw_frame();let n=p.render.get_pixel_data(),o=new Float32Array(n.buffer);p.gl.useProgram(p.render.shader_programs[1]),p.render.draw_frame();let l=p.render.get_pixel_data(),i=new Float32Array(l.buffer);for(let $=0;$<p.canvas_height;$++)for(let s=0;s<p.canvas_width;s++){let f=p.canvas_height*$+s;f<c.length&&c[f][2]&&(c[f][0]=o[f],c[f][1]=i[f])}}();for(let b=0;b<c.length;b++){let _=Math.round((.5-(c[b][1]-k.world_center_y)/k.world_height)*k.canvas_height),x=Math.round(((c[b][0]-k.world_center_x)/k.world_width+.5)*k.canvas_width);if(_>=0&&_<k.canvas_height&&x>=0&&x<k.canvas_width){let y=v(c[b][0],c[b][1]),E=i*y[0],q=i*y[1];s[_][x][0]=$,s[_][x][1]=(Math.atan2(q,E)+Math.PI)/(2*Math.PI),s[_][x][2]=1-Math.exp(-1.2*(E*E+q*q)/(i*i)),c[b][2]--,c[b][2]<=0&&R(b)}else{R(b);continue}}}for(let D=0;D<k.canvas_height;D++)for(let S=0;S<k.canvas_width;S++)if(s[D][S][0]){let z=er(s[D][S][1],s[D][S][2],s[D][S][0]/$);h[4*(k.canvas_width*D+S)+0]=z[0],h[4*(k.canvas_width*D+S)+1]=z[1],h[4*(k.canvas_width*D+S)+2]=z[2],s[D][S][0]--}else h[4*(k.canvas_width*D+S)+0]=0,h[4*(k.canvas_width*D+S)+1]=0,h[4*(k.canvas_width*D+S)+2]=0;if(k.render.draw_frame(h),O.push(H),W.push(J),O.shift(),W.shift(),H=0,J=0,0!==C||0!==G){let F=-C*k.world_width,L=-G*k.world_height,Y=Math.round(-L/k.world_height*k.canvas_height),Z=Math.round(F/k.world_width*k.canvas_width);B(Y,Z),Y?(k.world_center_y-=L,G*=K):G=0,Z?(k.world_center_x-=F,C*=K):C=0,Math.sqrt(C*C+G*G)<N&&(C=0,G=0)}if(j.push(M),j.shift(),M=0,0!==X&&(U(o,l,X),n+=X,n=Math.min(Math.max(n,-3),3),et(o,l),X*=Q,Math.abs(X)<V&&(X=0)),u!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(T)}catch(ee){P()}}function A(e){c[e][0]=k.world_center_x+k.world_width*(Math.random()-.5),c[e][1]=k.world_center_y+k.world_height*(Math.random()-.5),c[e][2]=Math.round($*(.5*Math.random()+.75)),t++}function R(e){c[e][2]=0,f.push(e),t--}function B(e,t){if(e<=0&&t<=0)for(let a=0;a<k.canvas_height;a++)for(let r=0;r<k.canvas_width;r++)a-e<k.canvas_height&&r-t<k.canvas_width?s[a][r]=s[a-e][r-t]:s[a][r]=[0,0,0];else if(e>0&&t<=0)for(let n=k.canvas_height-1;n>=0;n--)for(let o=0;o<k.canvas_width;o++)n-e>=0&&o-t<k.canvas_width?s[n][o]=s[n-e][o-t]:s[n][o]=[0,0,0];else if(e<=0&&t>0)for(let l=0;l<k.canvas_height;l++)for(let i=k.canvas_width-1;i>=0;i--)l-e<k.canvas_height&&i-t>=0?s[l][i]=s[l-e][i-t]:s[l][i]=[0,0,0];else for(let $=k.canvas_height-1;$>=0;$--)for(let c=k.canvas_width-1;c>=0;c--)$-e>=0&&c-t>=0?s[$][c]=s[$-e][c-t]:s[$][c]=[0,0,0]}function U(e,t,a){if(n<=-3||n>=3)return;let r=Math.pow(2,a),o=Math.round((.5-(t-k.world_center_y)/k.world_height)*k.canvas_height),l=Math.round(((e-k.world_center_x)/k.world_width+.5)*k.canvas_width),i=Array(k.canvas_height);for(let $=0;$<k.canvas_height;$++){i[$]=Array(k.canvas_width);for(let c=0;c<k.canvas_width;c++){let f=Math.round(($-o)*r+o),d=Math.round((c-l)*r+l);f>=0&&f<k.canvas_height&&d>=0&&d<k.canvas_width?i[$][c]=[Math.ceil(s[f][d][0]/1.08),s[f][d][1],s[f][d][2]]:i[$][c]=[0,0,0]}}s=i}let C=0,G=0,X=0,H=0,J=0,M=0,O=[],W=[],j=[],K=.96,N=.002,Q=.93,V=.002;function Y(e,t,a){C=0,G=0,X=0,O=[0,0,0,0],W=[0,0,0,0],j=[0,0,0,0]}function Z(e,t,a,r,n){let o=Math.round(-r/k.world_height*k.canvas_height),l=Math.round(a/k.world_width*k.canvas_width);B(o,l),o?(k.world_center_y-=r,J=-r/k.world_height):J=0,l?(k.world_center_x-=a,H=-a/k.world_width):H=0}function ee(e,t,a){let r=0;O.forEach((e,t)=>{Math.abs(e)>C&&(C=Math.abs(e),r=t)}),C=C<.002?0:O[r],W.forEach((e,t)=>{Math.abs(e)>G&&(G=Math.abs(e),r=t)}),G=G<.002?0:W[r],j.forEach((e,t)=>{Math.abs(e)>X&&(X=Math.abs(e),r=t)}),X=X<.002?0:j[r]}function et(){if(r>=1){let e=k.input.get_zoomed_world_center(o,l,4*Math.pow(2,n)*r,4*Math.pow(2,n));k.world_width=4*Math.pow(2,n)*r,k.world_height=4*Math.pow(2,n),k.world_center_x=e[0],k.world_center_y=e[1]}else{let t=k.input.get_zoomed_world_center(o,l,4*Math.pow(2,n),4*Math.pow(2,n)/r);k.world_width=4*Math.pow(2,n),k.world_height=4*Math.pow(2,n)/r,k.world_center_x=t[0],k.world_center_y=t[1]}}function ea(){k.fullscreen.currently_fullscreen?(r=window.innerWidth/window.innerHeight)>=1?(k.change_canvas_size(Math.ceil(e*r),e),k.world_width=4*Math.pow(2,n)*r,k.world_height=4*Math.pow(2,n)):(k.change_canvas_size(e,Math.ceil(e/r)),k.world_width=4*Math.pow(2,n),k.world_height=4*Math.pow(2,n)/r):(r=1,k.change_canvas_size(e,e),k.world_width=4*Math.pow(2,n),k.world_height=4*Math.pow(2,n))}function er(e,t,a){let r,n,o,l,i,$,s,c;switch(l=Math.floor(6*e),i=6*e-l,$=a*(1-t),s=a*(1-i*t),c=a*(1-(1-i)*t),l%6){case 0:r=a,n=c,o=$;break;case 1:r=s,n=a,o=$;break;case 2:r=$,n=a,o=c;break;case 3:r=$,n=s,o=a;break;case 4:r=c,n=$,o=a;break;case 5:r=a,n=$,o=s}return[Math.round(255*r),Math.round(255*n),Math.round(255*o)]}window.addEventListener("resize",ea),Page.temporary_handlers.resize.push(ea)}();