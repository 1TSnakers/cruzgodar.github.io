!function(){"use strict";let e=500,t=0,r=3e3,l=1,n=.6515,o=0,$=0,i=.01,a=200,c=[],d=[],s=[],u=!1,h=null,w=Site.applet_process_id,f=null,p={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:U,mousedown_callback:N,touchstart_callback:N,mousedrag_callback:O,touchmove_callback:O,mouseup_callback:Q,touchend_callback:Q,wheel_callback:function e(t,r,l,i){o=t,$=r,.3>Math.abs(l/100)?(P(t,r,l/100),n=Math.min(Math.max(n+l/100,-5),5)):H+=.05*Math.sign(l),R()},pinch_callback:function e(t,r,i,a){let c;P(t,r,-(c=l>=1?i/_.world_width*10:i/_.world_height*10)),n=Math.min(Math.max(n-c,-5),5),j=-c,o=t,$=r,R()}},_=new Wilson(Page.element.querySelector("#output-canvas"),p),g=Page.element.querySelector("#code-textarea"),m=Page.element.querySelector("#generate-button");m.addEventListener("click",()=>{_.world_center_x=0,_.world_center_y=0,_.world_width=2*Math.PI,_.world_height=2*Math.PI,n=.6515,q()});let v=Page.element.querySelector("#resolution-input");v.addEventListener("input",q);let b=Page.element.querySelector("#max-particles-input");b.addEventListener("input",()=>{r=parseInt(b.value||3e3)});let y=Page.element.querySelector("#speed-input");y.addEventListener("input",()=>{i=parseFloat(y.value||1)/100});let x=Page.element.querySelector("#lifetime-input");x.addEventListener("input",q);let k=Page.element.querySelector("#download-button");function q(){f=Function("x","y",`return ${g.value}`),e=parseInt(v.value||500),t=0,r=parseInt(b.value||3e3),i=parseFloat(y.value||1)/100,a=parseInt(x.value||200),_.change_canvas_size(e,e),d=Array(r),s=Array(r);for(let l=0;l<r;l++)d[l]=[0,0,0],s[l]=l;c=Array(e);for(let n=0;n<e;n++){c[n]=Array(e);for(let o=0;o<e;o++)c[n][o]=[0,0,0]}h=new Uint8ClampedArray(e*e*4);for(let $=0;$<e;$++)for(let u=0;u<e;u++)h[4*(e*$+u)+3]=255;window.requestAnimationFrame(z)}k.addEventListener("click",()=>{_.download_frame("a-vector-field.png")}),q(),Page.show();let E=-1;function z(l){let p=l-E;if(E=l,0!==p){if(t<r){let g=Math.min(r/100,r-t);for(let m=s.length-g;m<s.length;m++)S(s[m]);s.splice(s.length-g,g)}if(u)u=!1;else for(let v=0;v<d.length;v++){let b=Math.round((.5-(d[v][1]-_.world_center_y)/_.world_height)*_.canvas_height),y=Math.round(((d[v][0]-_.world_center_x)/_.world_width+.5)*_.canvas_width);if(b>=0&&b<e&&y>=0&&y<e){let x=f(d[v][0],d[v][1]),k=i*x[0],q=i*x[1];c[b][y][0]=a,c[b][y][1]=(Math.atan2(q,k)+Math.PI)/(2*Math.PI),c[b][y][2]=1-Math.exp(-1.2*(k*k+q*q)/(i*i)),d[v][0]+=k,d[v][1]+=q,d[v][2]--,d[v][2]<=0&&L(v)}else{L(v);continue}}for(let N=0;N<e;N++)for(let O=0;O<e;O++)if(c[N][O][0]){let Q=V(c[N][O][1],c[N][O][2],c[N][O][0]/a);h[4*(e*N+O)+0]=Q[0],h[4*(e*N+O)+1]=Q[1],h[4*(e*N+O)+2]=Q[2],c[N][O][0]--}else h[4*(e*N+O)+0]=0,h[4*(e*N+O)+1]=0,h[4*(e*N+O)+2]=0;if(_.render.draw_frame(h),B.push(T),C.push(W),B.shift(),C.shift(),T=0,W=0,0!==A||0!==F){let U=-A*_.world_width,X=-F*_.world_height,Y=Math.round(-X/_.world_height*_.canvas_height),Z=Math.round(U/_.world_width*_.canvas_width);I(Y,Z),Y?(_.world_center_y-=X,F*=G):F=0,Z?(_.world_center_x-=U,A*=G):A=0,Math.sqrt(A*A+F*F)<J&&(A=0,F=0)}if(D.push(j),D.shift(),j=0,0!==H&&(P(o,$,H),n+=H,n=Math.min(Math.max(n,-5),5),R(o,$),Math.abs(H*=K)<M&&(H=0)),w!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(z)}}function S(e){d[e][0]=_.world_center_x+_.world_width*(Math.random()-.5),d[e][1]=_.world_center_y+_.world_height*(Math.random()-.5),d[e][2]=Math.round(a*(.5*Math.random()+.75)),t++}function L(e){d[e][2]=0,s.push(e),t--}function I(t,r){if(t<=0&&r<=0)for(let l=0;l<e;l++)for(let n=0;n<e;n++)l-t<e&&n-r<e?c[l][n]=c[l-t][n-r]:c[l][n]=[0,0,0];else if(t>0&&r<=0)for(let o=e-1;o>=0;o--)for(let $=0;$<e;$++)o-t>=0&&$-r<e?c[o][$]=c[o-t][$-r]:c[o][$]=[0,0,0];else if(t<=0&&r>0)for(let i=0;i<e;i++)for(let a=e-1;a>=0;a--)i-t<e&&a-r>=0?c[i][a]=c[i-t][a-r]:c[i][a]=[0,0,0];else for(let d=e-1;d>=0;d--)for(let s=e-1;s>=0;s--)d-t>=0&&s-r>=0?c[d][s]=c[d-t][s-r]:c[d][s]=[0,0,0]}function P(t,r,l){if(n<=-5||n>=5)return;let o=Math.pow(2,l),$=Math.round((.5-(r-_.world_center_y)/_.world_height)*_.canvas_height),i=Math.round(((t-_.world_center_x)/_.world_width+.5)*_.canvas_width),a=Array(e);for(let d=0;d<e;d++){a[d]=Array(e);for(let s=0;s<e;s++){let u=Math.round((d-$)*o+$),h=Math.round((s-i)*o+i);u>=0&&u<e&&h>=0&&h<e?a[d][s]=[Math.ceil(c[u][h][0]/1.08),c[u][h][1],c[u][h][2]]:a[d][s]=[0,0,0]}}c=a}let A=0,F=0,H=0,T=0,W=0,j=0,B=[],C=[],D=[],G=.96,J=.002,K=.93,M=.002;function N(e,t,r){A=0,F=0,H=0,B=[0,0,0,0],C=[0,0,0,0],D=[0,0,0,0]}function O(e,t,r,l,n){let o=Math.round(-l/_.world_height*_.canvas_height),$=Math.round(r/_.world_width*_.canvas_width);I(o,$),o?(_.world_center_y-=l,W=-l/_.world_height):W=0,$?(_.world_center_x-=r,T=-r/_.world_width):T=0}function Q(e,t,r){let l=0;B.forEach((e,t)=>{Math.abs(e)>A&&(A=Math.abs(e),l=t)}),A=A<.002?0:B[l],C.forEach((e,t)=>{Math.abs(e)>F&&(F=Math.abs(e),l=t)}),F=F<.002?0:C[l],D.forEach((e,t)=>{Math.abs(e)>H&&(H=Math.abs(e),l=t)}),H=H<.002?0:D[l]}function R(){if(l>=1){let e=_.input.get_zoomed_world_center(o,$,4*Math.pow(2,n)*l,4*Math.pow(2,n));_.world_width=4*Math.pow(2,n)*l,_.world_height=4*Math.pow(2,n),_.world_center_x=e[0],_.world_center_y=e[1]}else{let t=_.input.get_zoomed_world_center(o,$,4*Math.pow(2,n),4*Math.pow(2,n)/l);_.world_width=4*Math.pow(2,n),_.world_height=4*Math.pow(2,n)/l,_.world_center_x=t[0],_.world_center_y=t[1]}}function U(){_.fullscreen.currently_fullscreen?(l=window.innerWidth/window.innerHeight)>=1?(_.change_canvas_size(e,Math.floor(e/l)),_.world_width=4*Math.pow(2,n)*l,_.world_height=4*Math.pow(2,n)):(_.change_canvas_size(Math.floor(e*l),e),_.world_width=4*Math.pow(2,n),_.world_height=4*Math.pow(2,n)/l):(l=1,_.change_canvas_size(e,e),_.world_width=4*Math.pow(2,n),_.world_height=4*Math.pow(2,n))}function V(e,t,r){let l,n,o,$,i,a,c,d;switch($=Math.floor(6*e),i=6*e-$,a=r*(1-t),c=r*(1-i*t),d=r*(1-(1-i)*t),$%6){case 0:l=r,n=d,o=a;break;case 1:l=c,n=r,o=a;break;case 2:l=a,n=r,o=d;break;case 3:l=a,n=c,o=r;break;case 4:l=d,n=a,o=r;break;case 5:l=r,n=a,o=c}return[Math.round(255*l),Math.round(255*n),Math.round(255*o)]}window.addEventListener("resize",U),Page.temporary_handlers.resize.push(U)}();