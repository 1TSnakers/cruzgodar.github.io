!function(){"use strict";let e=500,t=0,a=3e3,r=1,n=.6515,l=0,o=0,i=.005,$=200,d=[],s=[],c=[],h=!1,f=null,w=Site.applet_process_id,u=null,v=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  const float dt = .005;
  
  
  
  //Don't know how, but this writes an honest float32 to the 32 bits of output, which JS then decodes.
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
 `,g=`
   ${v}
   
   float dx = sin(v.y);
   
   float x = dt * dx + v.x;
   
   gl_FragColor = encode_float(x);
  }
 `,p=`
   ${v}
   
   float dy = sin(v.x + 3.14159265);
   
   float y = dt * dy + v.y;
   
   gl_FragColor = encode_float(y);
  }
 `,m=`
   ${v}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float h = (atan(dy, dx) + 3.14159265) / 6.28318531;
   
   gl_FragColor = encode_float(h);
  }
 `,_=`
   ${v}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float s = 1.0 - exp(-1.2 * (dx * dx + dy * dy));
   
   gl_FragColor = encode_float(s);
  }
 `,b=new Wilson(Page.element.querySelector("#update-canvas"),{renderer:"gpu",shader:g,canvas_width:100,canvas_height:100});b.render.load_new_shader(p),b.render.load_new_shader(m),b.render.load_new_shader(_),b.render.create_framebuffer_texture_pair();let x=new Float32Array(b.canvas_width*b.canvas_height*4);for(let y=0;y<b.canvas_height;y++)for(let k=0;k<b.canvas_width;k++){let E=b.canvas_height*y+k;x[4*E]=0,x[4*E+1]=0,x[4*E+2]=0,x[4*E+3]=0}b.gl.bindTexture(b.gl.TEXTURE_2D,b.render.framebuffers[0].texture),b.gl.bindFramebuffer(b.gl.FRAMEBUFFER,null);let q={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:R,mousedown_callback:et,touchstart_callback:et,mousedrag_callback:ea,touchmove_callback:ea,mouseup_callback:er,touchend_callback:er,wheel_callback:function e(t,a,r,i){l=t,o=a,.3>Math.abs(r/100)?(X(t,a,r/100),n=Math.min(Math.max(n+r/100,-3),3)):M+=.05*Math.sign(r),en()},pinch_callback:function e(t,a,i,$){let d;X(t,a,-(d=r>=1?i/F.world_width*10:i/F.world_height*10)),n=Math.min(Math.max(n-d,-3),3),j=-d,l=t,o=a,en()}},F=new Wilson(Page.element.querySelector("#output-canvas"),q),S=Page.element.querySelector("#code-textarea"),z=Page.element.querySelector("#generate-button");z.addEventListener("click",()=>{F.world_center_x=0,F.world_center_y=0,F.world_width=2*Math.PI,F.world_height=2*Math.PI,n=.6515,R()});let L=Page.element.querySelector("#resolution-input");L.addEventListener("input",R);let P=Page.element.querySelector("#max-particles-input");P.addEventListener("input",()=>{a=parseInt(P.value||3e3)});let D=Page.element.querySelector("#speed-input");D.addEventListener("input",()=>{i=parseFloat(D.value||1)/100});let T=Page.element.querySelector("#lifetime-input");T.addEventListener("input",R);let A=Page.element.querySelector("#download-button");function R(){u=Function("x","y",`return ${S.value}`),e=parseInt(L.value||500),t=0,a=parseInt(P.value||3e3),i=parseFloat(D.value||1)/100,$=parseInt(T.value||200),el(),s=Array(a),c=Array(a);for(let r=0;r<a;r++)s[r]=[0,0,0],c[r]=r;d=Array(F.canvas_height);for(let n=0;n<F.canvas_height;n++){d[n]=Array(F.canvas_width);for(let l=0;l<F.canvas_width;l++)d[n][l]=[0,0,0]}f=new Uint8ClampedArray(F.canvas_height*F.canvas_width*4);for(let o=0;o<F.canvas_height;o++)for(let h=0;h<F.canvas_width;h++)f[4*(F.canvas_width*o+h)+3]=255;window.requestAnimationFrame(C)}A.addEventListener("click",()=>{F.download_frame("a-vector-field.png")}),R(),Page.show();let I=-1;function C(e){try{let r=e-I;if(I=e,0===r)return;if(t<a){let i=Math.min(a/100,a-t);for(let u=c.length-i;u<c.length;u++)B(c[u]);c.splice(c.length-i,i)}h?h=!1:function e(){for(let t=0;t<b.canvas_height;t++)for(let a=0;a<b.canvas_width;a++){let r=b.canvas_height*t+a;r<s.length&&s[r][2]?(x[4*r]=s[r][0],x[4*r+1]=s[r][1],x[4*r+2]=1):x[4*r+2]=0}b.gl.texImage2D(b.gl.TEXTURE_2D,0,b.gl.RGBA,b.canvas_width,b.canvas_height,0,b.gl.RGBA,b.gl.FLOAT,x),b.gl.useProgram(b.render.shader_programs[0]),b.render.draw_frame();let n=new Float32Array(b.render.get_pixel_data().buffer);b.gl.useProgram(b.render.shader_programs[1]),b.render.draw_frame();let l=new Float32Array(b.render.get_pixel_data().buffer);b.gl.useProgram(b.render.shader_programs[2]),b.render.draw_frame();let o=new Float32Array(b.render.get_pixel_data().buffer);b.gl.useProgram(b.render.shader_programs[3]),b.render.draw_frame();let i=new Float32Array(b.render.get_pixel_data().buffer);for(let c=0;c<b.canvas_height;c++)for(let h=0;h<b.canvas_width;h++){let f=b.canvas_height*c+h;if(f<s.length&&s[f][2]){s[f][0]=n[f],s[f][1]=l[f];let w=Math.round((.5-(s[f][1]-F.world_center_y)/F.world_height)*F.canvas_height),u=Math.round(((s[f][0]-F.world_center_x)/F.world_width+.5)*F.canvas_width);if(w>=0&&w<F.canvas_height&&u>=0&&u<F.canvas_width)d[w][u][0]=$,d[w][u][1]=o[f],d[w][u][2]=i[f],s[f][2]--,s[f][2]<=0&&U(f);else{U(f);continue}}}}();for(let v=0;v<F.canvas_height;v++)for(let g=0;g<F.canvas_width;g++)if(d[v][g][0]){let p=eo(d[v][g][1],d[v][g][2],d[v][g][0]/$);f[4*(F.canvas_width*v+g)+0]=p[0],f[4*(F.canvas_width*v+g)+1]=p[1],f[4*(F.canvas_width*v+g)+2]=p[2],d[v][g][0]--}else f[4*(F.canvas_width*v+g)+0]=0,f[4*(F.canvas_width*v+g)+1]=0,f[4*(F.canvas_width*v+g)+2]=0;if(F.render.draw_frame(f),K.push(O),N.push(W),K.shift(),N.shift(),O=0,W=0,0!==H||0!==J){let m=-H*F.world_width,_=-J*F.world_height,y=Math.round(-_/F.world_height*F.canvas_height),k=Math.round(m/F.world_width*F.canvas_width);G(y,k),y?(F.world_center_y-=_,J*=V):J=0,k?(F.world_center_x-=m,H*=V):H=0,Math.sqrt(H*H+J*J)<Y&&(H=0,J=0)}if(Q.push(j),Q.shift(),j=0,0!==M&&(X(l,o,M),n+=M,n=Math.min(Math.max(n,-3),3),en(l,o),M*=Z,Math.abs(M)<ee&&(M=0)),w!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(C)}catch(E){R()}}function B(e){s[e][0]=F.world_center_x+F.world_width*(Math.random()-.5),s[e][1]=F.world_center_y+F.world_height*(Math.random()-.5),s[e][2]=Math.round($*(.5*Math.random()+.75)),t++}function U(e){s[e][2]=0,c.push(e),t--}function G(e,t){if(e<=0&&t<=0)for(let a=0;a<F.canvas_height;a++)for(let r=0;r<F.canvas_width;r++)a-e<F.canvas_height&&r-t<F.canvas_width?d[a][r]=d[a-e][r-t]:d[a][r]=[0,0,0];else if(e>0&&t<=0)for(let n=F.canvas_height-1;n>=0;n--)for(let l=0;l<F.canvas_width;l++)n-e>=0&&l-t<F.canvas_width?d[n][l]=d[n-e][l-t]:d[n][l]=[0,0,0];else if(e<=0&&t>0)for(let o=0;o<F.canvas_height;o++)for(let i=F.canvas_width-1;i>=0;i--)o-e<F.canvas_height&&i-t>=0?d[o][i]=d[o-e][i-t]:d[o][i]=[0,0,0];else for(let $=F.canvas_height-1;$>=0;$--)for(let s=F.canvas_width-1;s>=0;s--)$-e>=0&&s-t>=0?d[$][s]=d[$-e][s-t]:d[$][s]=[0,0,0]}function X(e,t,a){if(n<=-3||n>=3)return;let r=Math.pow(2,a),l=Math.round((.5-(t-F.world_center_y)/F.world_height)*F.canvas_height),o=Math.round(((e-F.world_center_x)/F.world_width+.5)*F.canvas_width),i=Array(F.canvas_height);for(let $=0;$<F.canvas_height;$++){i[$]=Array(F.canvas_width);for(let s=0;s<F.canvas_width;s++){let c=Math.round(($-l)*r+l),h=Math.round((s-o)*r+o);c>=0&&c<F.canvas_height&&h>=0&&h<F.canvas_width?i[$][s]=[Math.ceil(d[c][h][0]/1.08),d[c][h][1],d[c][h][2]]:i[$][s]=[0,0,0]}}d=i}let H=0,J=0,M=0,O=0,W=0,j=0,K=[],N=[],Q=[],V=.96,Y=.002,Z=.93,ee=.002;function et(e,t,a){H=0,J=0,M=0,K=[0,0,0,0],N=[0,0,0,0],Q=[0,0,0,0]}function ea(e,t,a,r,n){let l=Math.round(-r/F.world_height*F.canvas_height),o=Math.round(a/F.world_width*F.canvas_width);G(l,o),l?(F.world_center_y-=r,W=-r/F.world_height):W=0,o?(F.world_center_x-=a,O=-a/F.world_width):O=0}function er(e,t,a){let r=0;K.forEach((e,t)=>{Math.abs(e)>H&&(H=Math.abs(e),r=t)}),H=H<.002?0:K[r],N.forEach((e,t)=>{Math.abs(e)>J&&(J=Math.abs(e),r=t)}),J=J<.002?0:N[r],Q.forEach((e,t)=>{Math.abs(e)>M&&(M=Math.abs(e),r=t)}),M=M<.002?0:Q[r]}function en(){if(r>=1){let e=F.input.get_zoomed_world_center(l,o,4*Math.pow(2,n)*r,4*Math.pow(2,n));F.world_width=4*Math.pow(2,n)*r,F.world_height=4*Math.pow(2,n),F.world_center_x=e[0],F.world_center_y=e[1]}else{let t=F.input.get_zoomed_world_center(l,o,4*Math.pow(2,n),4*Math.pow(2,n)/r);F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n)/r,F.world_center_x=t[0],F.world_center_y=t[1]}}function el(){F.fullscreen.currently_fullscreen?(r=window.innerWidth/window.innerHeight)>=1?(F.change_canvas_size(Math.ceil(e*r),e),F.world_width=4*Math.pow(2,n)*r,F.world_height=4*Math.pow(2,n)):(F.change_canvas_size(e,Math.ceil(e/r)),F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n)/r):(r=1,F.change_canvas_size(e,e),F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n))}function eo(e,t,a){let r,n,l,o,i,$,d,s;switch(o=Math.floor(6*e),i=6*e-o,$=a*(1-t),d=a*(1-i*t),s=a*(1-(1-i)*t),o%6){case 0:r=a,n=s,l=$;break;case 1:r=d,n=a,l=$;break;case 2:r=$,n=a,l=s;break;case 3:r=$,n=d,l=a;break;case 4:r=s,n=$,l=a;break;case 5:r=a,n=$,l=d}return[Math.round(255*r),Math.round(255*n),Math.round(255*l)]}window.addEventListener("resize",el),Page.temporary_handlers.resize.push(el)}();