!function(){"use strict";let e=500,t=0,r=3e3,a=1,n=.6515,o=0,l=0,i=.0075,d=200,s=[],$=[],c=[],h=null,f=Site.applet_process_id,u=null,g=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  uniform float dt;
  
  
  
  //Don't know how, but this writes an honest float32 to the 32 bits of output, which JS then decodes.
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
 `,w=`
   ${g}
   
   float dx = sin(v.y);
   
   float x = dt * dx + v.x;
   
   gl_FragColor = encode_float(x);
  }
 `,v=`
   ${g}
   
   float dy = sin(v.x + 3.14159265);
   
   float y = dt * dy + v.y;
   
   gl_FragColor = encode_float(y);
  }
 `,m=`
   ${g}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float h = (atan(dy, dx) + 3.14159265) / 6.28318531;
   
   gl_FragColor = encode_float(h);
  }
 `,p=`
   ${g}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float s = 1.0 - exp(-1.2 * (dx * dx + dy * dy));
   
   gl_FragColor = encode_float(s);
  }
 `,_=new Wilson(Page.element.querySelector("#update-canvas"),{renderer:"gpu",shader:w,canvas_width:100,canvas_height:100});_.render.load_new_shader(v),_.render.load_new_shader(m),_.render.load_new_shader(p),_.render.init_uniforms(["dt"],0),_.render.init_uniforms(["dt"],1),_.render.init_uniforms(["dt"],2),_.render.init_uniforms(["dt"],3),_.gl.useProgram(_.render.shader_programs[0]),_.gl.uniform1f(_.uniforms.dt[0],i),_.gl.useProgram(_.render.shader_programs[1]),_.gl.uniform1f(_.uniforms.dt[1],i),_.gl.useProgram(_.render.shader_programs[2]),_.gl.uniform1f(_.uniforms.dt[2],i),_.gl.useProgram(_.render.shader_programs[3]),_.gl.uniform1f(_.uniforms.dt[3],i),_.render.create_framebuffer_texture_pair();let b=null;_.gl.bindTexture(_.gl.TEXTURE_2D,_.render.framebuffers[0].texture),_.gl.bindFramebuffer(_.gl.FRAMEBUFFER,null);let x={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:L,mousedown_callback:V,touchstart_callback:V,mousedrag_callback:Y,touchmove_callback:Y,mouseup_callback:Z,touchend_callback:Z,wheel_callback:function e(t,r,a,i){o=t,l=r,.3>Math.abs(a/100)?(C(t,r,a/100),n=Math.min(Math.max(n+a/100,-3),3)):G+=.05*Math.sign(a),ee()},pinch_callback:function e(t,r,i,d){let s;C(t,r,-(s=a>=1?i/y.world_width*10:i/y.world_height*10)),n=Math.min(Math.max(n-s,-3),3),J=-s,o=t,l=r,ee()}},y=new Wilson(Page.element.querySelector("#output-canvas"),x),k=Page.element.querySelector("#code-textarea"),E=Page.element.querySelector("#generate-button");E.addEventListener("click",()=>{y.world_center_x=0,y.world_center_y=0,y.world_width=2*Math.PI,y.world_height=2*Math.PI,n=.6515,L()});let P=Page.element.querySelector("#resolution-input");P.addEventListener("input",L);let q=Page.element.querySelector("#max-particles-input");q.addEventListener("input",L);let F=Page.element.querySelector("#speed-input");F.addEventListener("input",()=>{i=parseFloat(F.value||1)/75,_.gl.useProgram(_.render.shader_programs[0]),_.gl.uniform1f(_.uniforms.dt[0],i),_.gl.useProgram(_.render.shader_programs[1]),_.gl.uniform1f(_.uniforms.dt[1],i),_.gl.useProgram(_.render.shader_programs[2]),_.gl.uniform1f(_.uniforms.dt[2],i),_.gl.useProgram(_.render.shader_programs[3]),_.gl.uniform1f(_.uniforms.dt[3],i)});let S=Page.element.querySelector("#lifetime-input");S.addEventListener("input",L);let z=Page.element.querySelector("#download-button");function L(){u=Function("x","y",`return ${k.value}`),e=parseInt(P.value||500),t=0,r=Math.max(parseInt(q.value||3e3),100);let a=Math.ceil(Math.sqrt(r));_.change_canvas_size(a,a),i=parseFloat(F.value||1)/100,d=parseInt(S.value||200),et(),$=Array(r),c=Array(r);for(let n=0;n<r;n++)$[n]=[0,0,0],c[n]=n;s=Array(y.canvas_height);for(let o=0;o<y.canvas_height;o++){s[o]=Array(y.canvas_width);for(let l=0;l<y.canvas_width;l++)s[o][l]=[0,0,0]}b=new Float32Array(_.canvas_width*_.canvas_height*4);for(let f=0;f<_.canvas_height;f++)for(let g=0;g<_.canvas_width;g++){let w=_.canvas_height*f+g;b[4*w]=0,b[4*w+1]=0,b[4*w+2]=0,b[4*w+3]=0}h=new Uint8ClampedArray(y.canvas_height*y.canvas_width*4);for(let v=0;v<y.canvas_height;v++)for(let m=0;m<y.canvas_width;m++)h[4*(y.canvas_width*v+m)+3]=255;window.requestAnimationFrame(T)}z.addEventListener("click",()=>{y.download_frame("a-vector-field.png")}),L(),Page.show();let D=-1;function T(e){try{let a=e-D;if(D=e,0===a)return;if(t<r){let i=Math.min(r/80,r-t);for(let u=c.length-i;u<c.length;u++)A(c[u]);c.splice(c.length-i,i)}!function e(){for(let t=0;t<_.canvas_height;t++)for(let r=0;r<_.canvas_width;r++){let a=_.canvas_height*t+r;a<$.length&&$[a][2]?(b[4*a]=$[a][0],b[4*a+1]=$[a][1],b[4*a+2]=1):b[4*a+2]=0}_.gl.texImage2D(_.gl.TEXTURE_2D,0,_.gl.RGBA,_.canvas_width,_.canvas_height,0,_.gl.RGBA,_.gl.FLOAT,b),_.gl.useProgram(_.render.shader_programs[0]),_.render.draw_frame();let n=new Float32Array(_.render.get_pixel_data().buffer);_.gl.useProgram(_.render.shader_programs[1]),_.render.draw_frame();let o=new Float32Array(_.render.get_pixel_data().buffer);_.gl.useProgram(_.render.shader_programs[2]),_.render.draw_frame();let l=new Float32Array(_.render.get_pixel_data().buffer);_.gl.useProgram(_.render.shader_programs[3]),_.render.draw_frame();let i=new Float32Array(_.render.get_pixel_data().buffer);for(let c=0;c<_.canvas_height;c++)for(let h=0;h<_.canvas_width;h++){let f=_.canvas_height*c+h;if(f<$.length&&$[f][2]){$[f][0]=n[f],$[f][1]=o[f];let u=Math.round((.5-($[f][1]-y.world_center_y)/y.world_height)*y.canvas_height),g=Math.round((($[f][0]-y.world_center_x)/y.world_width+.5)*y.canvas_width);if(u>=0&&u<y.canvas_height&&g>=0&&g<y.canvas_width)s[u][g][0]=d,s[u][g][1]=l[f],s[u][g][2]=i[f],$[f][2]--,$[f][2]<=0&&R(f);else{R(f);continue}}}}();for(let g=0;g<y.canvas_height;g++)for(let w=0;w<y.canvas_width;w++)if(s[g][w][0]){let v=er(s[g][w][1],s[g][w][2],s[g][w][0]/d);h[4*(y.canvas_width*g+w)+0]=v[0],h[4*(y.canvas_width*g+w)+1]=v[1],h[4*(y.canvas_width*g+w)+2]=v[2],s[g][w][0]--}else h[4*(y.canvas_width*g+w)+0]=0,h[4*(y.canvas_width*g+w)+1]=0,h[4*(y.canvas_width*g+w)+2]=0;if(y.render.draw_frame(h),M.push(X),O.push(H),M.shift(),O.shift(),X=0,H=0,0!==B||0!==U){let m=-B*y.world_width,p=-U*y.world_height,x=Math.round(-p/y.world_height*y.canvas_height),k=Math.round(m/y.world_width*y.canvas_width);I(x,k),x?(y.world_center_y-=p,U*=j):U=0,k?(y.world_center_x-=m,B*=j):B=0,Math.sqrt(B*B+U*U)<K&&(B=0,U=0)}if(W.push(J),W.shift(),J=0,0!==G&&(C(o,l,G),n+=G,n=Math.min(Math.max(n,-3),3),ee(o,l),G*=N,Math.abs(G)<Q&&(G=0)),f!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(T)}catch(E){L()}}function A(e){$[e][0]=y.world_center_x+y.world_width*(Math.random()-.5),$[e][1]=y.world_center_y+y.world_height*(Math.random()-.5),$[e][2]=Math.round(d*(.5*Math.random()+.75)),t++}function R(e){$[e][2]=0,c.push(e),t--}function I(e,t){if(e<=0&&t<=0)for(let r=0;r<y.canvas_height;r++)for(let a=0;a<y.canvas_width;a++)r-e<y.canvas_height&&a-t<y.canvas_width?s[r][a]=s[r-e][a-t]:s[r][a]=[0,0,0];else if(e>0&&t<=0)for(let n=y.canvas_height-1;n>=0;n--)for(let o=0;o<y.canvas_width;o++)n-e>=0&&o-t<y.canvas_width?s[n][o]=s[n-e][o-t]:s[n][o]=[0,0,0];else if(e<=0&&t>0)for(let l=0;l<y.canvas_height;l++)for(let i=y.canvas_width-1;i>=0;i--)l-e<y.canvas_height&&i-t>=0?s[l][i]=s[l-e][i-t]:s[l][i]=[0,0,0];else for(let d=y.canvas_height-1;d>=0;d--)for(let $=y.canvas_width-1;$>=0;$--)d-e>=0&&$-t>=0?s[d][$]=s[d-e][$-t]:s[d][$]=[0,0,0]}function C(e,t,r){if(n<=-3||n>=3)return;let a=Math.pow(2,r),o=Math.round((.5-(t-y.world_center_y)/y.world_height)*y.canvas_height),l=Math.round(((e-y.world_center_x)/y.world_width+.5)*y.canvas_width),i=Array(y.canvas_height);for(let d=0;d<y.canvas_height;d++){i[d]=Array(y.canvas_width);for(let c=0;c<y.canvas_width;c++){let h=Math.round((d-o)*a+o),f=Math.round((c-l)*a+l);h>=0&&h<y.canvas_height&&f>=0&&f<y.canvas_width?i[d][c]=[Math.ceil(s[h][f][0]/1.08),s[h][f][1],s[h][f][2]]:i[d][c]=[0,0,0]}}let u=Math.pow(2,2*r),g=0;if(r>0)for(let w=0;w<$.length;w++)$[w][2]&&w%u>=1&&(R(w),g++);s=i}let B=0,U=0,G=0,X=0,H=0,J=0,M=[],O=[],W=[],j=.96,K=.002,N=.93,Q=.002;function V(e,t,r){B=0,U=0,G=0,M=[0,0,0,0],O=[0,0,0,0],W=[0,0,0,0]}function Y(e,t,r,a,n){let o=Math.round(-a/y.world_height*y.canvas_height),l=Math.round(r/y.world_width*y.canvas_width);I(o,l),o?(y.world_center_y-=a,H=-a/y.world_height):H=0,l?(y.world_center_x-=r,X=-r/y.world_width):X=0}function Z(e,t,r){let a=0;M.forEach((e,t)=>{Math.abs(e)>B&&(B=Math.abs(e),a=t)}),B=B<.002?0:M[a],O.forEach((e,t)=>{Math.abs(e)>U&&(U=Math.abs(e),a=t)}),U=U<.002?0:O[a],W.forEach((e,t)=>{Math.abs(e)>G&&(G=Math.abs(e),a=t)}),G=G<.002?0:W[a]}function ee(){if(a>=1){let e=y.input.get_zoomed_world_center(o,l,4*Math.pow(2,n)*a,4*Math.pow(2,n));y.world_width=4*Math.pow(2,n)*a,y.world_height=4*Math.pow(2,n),y.world_center_x=e[0],y.world_center_y=e[1]}else{let t=y.input.get_zoomed_world_center(o,l,4*Math.pow(2,n),4*Math.pow(2,n)/a);y.world_width=4*Math.pow(2,n),y.world_height=4*Math.pow(2,n)/a,y.world_center_x=t[0],y.world_center_y=t[1]}}function et(){y.fullscreen.currently_fullscreen?(a=window.innerWidth/window.innerHeight)>=1?(y.change_canvas_size(Math.ceil(e*a),e),y.world_width=4*Math.pow(2,n)*a,y.world_height=4*Math.pow(2,n)):(y.change_canvas_size(e,Math.ceil(e/a)),y.world_width=4*Math.pow(2,n),y.world_height=4*Math.pow(2,n)/a):(a=1,y.change_canvas_size(e,e),y.world_width=4*Math.pow(2,n),y.world_height=4*Math.pow(2,n))}function er(e,t,r){let a,n,o,l,i,d,s,$;switch(l=Math.floor(6*e),i=6*e-l,d=r*(1-t),s=r*(1-i*t),$=r*(1-(1-i)*t),l%6){case 0:a=r,n=$,o=d;break;case 1:a=s,n=r,o=d;break;case 2:a=d,n=r,o=$;break;case 3:a=d,n=s,o=r;break;case 4:a=$,n=d,o=r;break;case 5:a=r,n=d,o=s}return[Math.round(255*a),Math.round(255*n),Math.round(255*o)]}window.addEventListener("resize",et),Page.temporary_handlers.resize.push(et)}();