!function(){"use strict";let e=500,r=0,t=5e3,a=1,n=.6515,o=0,l=0,i=.0075,d=[],s=[],c=[],$=Site.applet_process_id,f=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  uniform float dt;
  
  
  
  //Don't know how, but this writes an honest float32 to the 32 bits of output, which JS then decodes.
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
 `,h=`
   ${f}
   
   float dx = sin(v.y);
   
   float x = dt * dx + v.x;
   
   gl_FragColor = encode_float(x);
  }
 `,u=`
   ${f}
   
   float dy = sin(v.x + 3.14159265);
   
   float y = dt * dy + v.y;
   
   gl_FragColor = encode_float(y);
  }
 `,g=`
   ${f}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float h = (atan(dy, dx) + 3.14159265) / 6.28318531;
   
   gl_FragColor = encode_float(h);
  }
 `,v=`
   ${f}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float s = 1.0 - exp(-1.2 * (dx * dx + dy * dy));
   
   gl_FragColor = encode_float(s);
  }
 `,m=new Wilson(Page.element.querySelector("#update-canvas"),{renderer:"gpu",shader:h,canvas_width:100,canvas_height:100});m.render.load_new_shader(u),m.render.load_new_shader(g),m.render.load_new_shader(v),m.render.init_uniforms(["dt"],0),m.render.init_uniforms(["dt"],1),m.render.init_uniforms(["dt"],2),m.render.init_uniforms(["dt"],3),m.gl.useProgram(m.render.shader_programs[0]),m.gl.uniform1f(m.uniforms.dt[0],i),m.gl.useProgram(m.render.shader_programs[1]),m.gl.uniform1f(m.uniforms.dt[1],i),m.gl.useProgram(m.render.shader_programs[2]),m.gl.uniform1f(m.uniforms.dt[2],i),m.gl.useProgram(m.render.shader_programs[3]),m.gl.uniform1f(m.uniforms.dt[3],i),m.render.create_framebuffer_texture_pair();let w=null;m.gl.bindTexture(m.gl.TEXTURE_2D,m.render.framebuffers[0].texture),m.gl.bindFramebuffer(m.gl.FRAMEBUFFER,null);let p=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  void main(void)
  {
   vec3 v = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0).xyz;
   
   gl_FragColor = vec4(v.x - 1.0 / 255.0, v.y, v.z, 1.0);
  }
 `,x=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  uniform vec2 pan;
  
  void main(void)
  {
   vec2 tex_coord = (uv + vec2(1.0, 1.0)) / 2.0 - pan;
   
   if (tex_coord.x >= 0.0 && tex_coord.x < 1.0 && tex_coord.y >= 0.0 && tex_coord.y < 1.0)
   {
    vec3 v = texture2D(u_texture, tex_coord).xyz;
    
    gl_FragColor = vec4(v.x, v.y, v.z, 1.0);
    
    return;
   }
   
   gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
  }
 `,_={renderer:"gpu",shader:p,canvas_width:e,canvas_height:e},b=new Wilson(Page.element.querySelector("#dim-canvas"),_);b.render.load_new_shader(x),b.render.init_uniforms(["pan"],1),b.gl.useProgram(b.render.shader_programs[0]),b.render.create_framebuffer_texture_pair(b.gl.UNSIGNED_BYTE),b.gl.bindTexture(b.gl.TEXTURE_2D,b.render.framebuffers[0].texture),b.gl.bindFramebuffer(b.gl.FRAMEBUFFER,null);let y=new Uint8Array(e*e*4),E=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  vec3 hsv2rgb(vec3 c)
  {
   vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
   vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
   return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
  }
  
  void main(void)
  {
   vec3 v = texture2D(u_texture, (vec2(1.0 + uv.x, 1.0 - uv.y)) / 2.0).xyz;
   
   gl_FragColor = vec4(hsv2rgb(vec3(v.y, v.z, v.x)), 1.0);
  }
 `,D={renderer:"gpu",shader:E,canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:S,mousedown_callback:Z,touchstart_callback:Z,mousedrag_callback:ee,touchmove_callback:ee,mouseup_callback:er,touchend_callback:er,wheel_callback:function e(r,t,a,i){o=r,l=t,.3>Math.abs(a/100)?(C(r,t,a/100),n=Math.min(Math.max(n+a/100,-3),3)):X+=.05*Math.sign(a),et()},pinch_callback:function e(r,t,i,d){let s;C(r,t,-(s=a>=1?i/F.world_width*10:i/F.world_height*10)),n=Math.min(Math.max(n-s,-3),3),M=-s,o=r,l=t,et()}},F=new Wilson(Page.element.querySelector("#output-canvas"),D);F.render.create_framebuffer_texture_pair(F.gl.UNSIGNED_BYTE),F.gl.bindTexture(F.gl.TEXTURE_2D,F.render.framebuffers[0].texture),F.gl.bindFramebuffer(F.gl.FRAMEBUFFER,null),Page.element.querySelector("#code-textarea");let T=Page.element.querySelector("#generate-button");T.addEventListener("click",()=>{F.world_center_x=0,F.world_center_y=0,F.world_width=2*Math.PI,F.world_height=2*Math.PI,n=.6515,S()});let z=Page.element.querySelector("#resolution-input");z.addEventListener("input",S);let P=Page.element.querySelector("#max-particles-input");P.addEventListener("input",S);let R=Page.element.querySelector("#speed-input");R.addEventListener("input",()=>{i=parseFloat(R.value||1)/75,m.gl.useProgram(m.render.shader_programs[0]),m.gl.uniform1f(m.uniforms.dt[0],i),m.gl.useProgram(m.render.shader_programs[1]),m.gl.uniform1f(m.uniforms.dt[1],i),m.gl.useProgram(m.render.shader_programs[2]),m.gl.uniform1f(m.uniforms.dt[2],i),m.gl.useProgram(m.render.shader_programs[3]),m.gl.uniform1f(m.uniforms.dt[3],i)});let k=Page.element.querySelector("#download-button");function S(){e=parseInt(z.value||500),r=0,t=Math.max(parseInt(P.value||3e3),100);let a=Math.ceil(Math.sqrt(t));m.change_canvas_size(a,a),i=parseFloat(R.value||1)/100,ea(),s=Array(t),c=Array(t);for(let n=0;n<t;n++)s[n]=[0,0,0],c[n]=n;w=new Float32Array(m.canvas_width*m.canvas_height*4);for(let o=0;o<m.canvas_height;o++)for(let l=0;l<m.canvas_width;l++){let d=m.canvas_width*o+l;w[4*d]=0,w[4*d+1]=0,w[4*d+2]=0,w[4*d+3]=0}y=new Uint8Array(F.canvas_width*F.canvas_height*4);for(let $=0;$<F.canvas_height;$++)for(let f=0;f<F.canvas_width;f++){let h=F.canvas_width*$+f;y[4*h]=0,y[4*h+1]=0,y[4*h+2]=0}window.requestAnimationFrame(B)}k.addEventListener("click",()=>{F.download_frame("a-vector-field.png")}),S(),Page.show();let q=-1;function B(e){try{let a=e-q;if(q=e,0===a)return;if(r<t){let i=Math.min(Math.ceil(t/80),t-r);for(let d=c.length-i;d<c.length;d++)U(c[d]);c.splice(c.length-i,i)}if(function e(){for(let r=0;r<m.canvas_height;r++)for(let t=0;t<m.canvas_width;t++){let a=m.canvas_width*r+t;a<s.length&&s[a][2]?(w[4*a]=s[a][0],w[4*a+1]=s[a][1],w[4*a+2]=1):w[4*a+2]=0}m.gl.texImage2D(m.gl.TEXTURE_2D,0,m.gl.RGBA,m.canvas_width,m.canvas_height,0,m.gl.RGBA,m.gl.FLOAT,w),m.gl.useProgram(m.render.shader_programs[0]),m.render.draw_frame();let n=new Float32Array(m.render.get_pixel_data().buffer);m.gl.useProgram(m.render.shader_programs[1]),m.render.draw_frame();let o=new Float32Array(m.render.get_pixel_data().buffer);m.gl.useProgram(m.render.shader_programs[2]),m.render.draw_frame();let l=new Float32Array(m.render.get_pixel_data().buffer);m.gl.useProgram(m.render.shader_programs[3]),m.render.draw_frame();let i=new Float32Array(m.render.get_pixel_data().buffer);for(let d=0;d<m.canvas_height;d++)for(let c=0;c<m.canvas_width;c++){let $=m.canvas_width*d+c;if($<s.length&&s[$][2]){s[$][0]=n[$],s[$][1]=o[$];let f=Math.round((.5-(s[$][1]-F.world_center_y)/F.world_height)*F.canvas_height),h=Math.round(((s[$][0]-F.world_center_x)/F.world_width+.5)*F.canvas_width);if(f>=0&&f<F.canvas_height&&h>=0&&h<F.canvas_width){let u=f*F.canvas_width+h;y[4*u]=255,y[4*u+1]=255*l[$],y[4*u+2]=255*i[$],s[$][2]--,s[$][2]<=0&&A($)}else A($)}}}(),I(),H.push(K),J.push(Y),H.shift(),J.shift(),0!==K||0!==Y){let f=-K,h=-Y;1>Math.abs(f/F.world_width*F.canvas_width)?f=0:K=0,1>Math.abs(h/F.world_height*F.canvas_height)?h=0:Y=0,G(f,h),F.world_center_y-=h,F.world_center_x-=f}else if(0!==N||0!==L){let u=-N,g=-L;1>Math.abs(u/F.world_width*F.canvas_width)&&(u=0),1>Math.abs(g/F.world_height*F.canvas_height)&&(g=0),G(u,g),F.world_center_y-=g,L*=W,F.world_center_x-=u,N*=W,Math.sqrt(N*N+L*L)<j&&(N=0,L=0)}if(O.push(M),O.shift(),M=0,0!==X&&(n+=X,n=Math.min(Math.max(n,-3),3),et(o,l),X*=Q,Math.abs(X)<V&&(X=0)),$!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(B)}catch(v){S()}}function U(e){s[e][0]=F.world_center_x+F.world_width*(Math.random()-.5),s[e][1]=F.world_center_y+F.world_height*(Math.random()-.5),s[e][2]=Math.round(255*(.5*Math.random()+.75)),r++}function A(e){s[e][2]=0,c.push(e),r--}function I(){b.gl.texImage2D(b.gl.TEXTURE_2D,0,b.gl.RGBA,b.canvas_width,b.canvas_height,0,b.gl.RGBA,b.gl.UNSIGNED_BYTE,y),b.render.draw_frame(),y=b.render.get_pixel_data(),F.gl.texImage2D(F.gl.TEXTURE_2D,0,F.gl.RGBA,F.canvas_width,F.canvas_height,0,F.gl.RGBA,F.gl.UNSIGNED_BYTE,y),F.render.draw_frame()}function G(e,r){b.gl.useProgram(b.render.shader_programs[1]),b.gl.uniform2f(b.uniforms.pan[1],e/F.world_width,-r/F.world_height),I(),b.gl.useProgram(b.render.shader_programs[0])}function C(e,r,t){if(n<=-3||n>=3)return;let a=Math.pow(2,t),o=Math.round((.5-(r-F.world_center_y)/F.world_height)*F.canvas_height),l=Math.round(((e-F.world_center_x)/F.world_width+.5)*F.canvas_width),i=Array(F.canvas_height);for(let c=0;c<F.canvas_height;c++){i[c]=Array(F.canvas_width);for(let $=0;$<F.canvas_width;$++){let f=Math.round((c-o)*a+o),h=Math.round(($-l)*a+l);f>=0&&f<F.canvas_height&&h>=0&&h<F.canvas_width?i[c][$]=[Math.ceil(d[f][h][0]/1.08),d[f][h][1],d[f][h][2]]:i[c][$]=[0,0,0]}}let u=Math.pow(2,2*t),g=0;if(t>0)for(let v=0;v<s.length;v++)s[v][2]&&v%u>=1&&(A(v),g++);d=i}let N=0,L=0,X=0,K=0,Y=0,M=0,H=[],J=[],O=[],W=.96,j=25e-5,Q=.93,V=.002;function Z(e,r,t){N=0,L=0,X=0,H=[0,0,0,0],J=[0,0,0,0],O=[0,0,0,0]}function ee(e,r,t,a,n){K+=-t,Y+=-a}function er(e,r,t){let a=0;H.forEach((e,r)=>{Math.abs(e)>N&&(N=Math.abs(e),a=r)}),N=N<25e-5?0:H[a],J.forEach((e,r)=>{Math.abs(e)>L&&(L=Math.abs(e),a=r)}),L=L<25e-5?0:J[a],O.forEach((e,r)=>{Math.abs(e)>X&&(X=Math.abs(e),a=r)}),X=X<.002?0:O[a]}function et(){if(a>=1){let e=F.input.get_zoomed_world_center(o,l,4*Math.pow(2,n)*a,4*Math.pow(2,n));F.world_width=4*Math.pow(2,n)*a,F.world_height=4*Math.pow(2,n),F.world_center_x=e[0],F.world_center_y=e[1]}else{let r=F.input.get_zoomed_world_center(o,l,4*Math.pow(2,n),4*Math.pow(2,n)/a);F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n)/a,F.world_center_x=r[0],F.world_center_y=r[1]}}function ea(){F.fullscreen.currently_fullscreen?(a=window.innerWidth/window.innerHeight)>=1?(F.change_canvas_size(Math.ceil(e*a),e),b.change_canvas_size(Math.ceil(e*a),e),F.world_width=4*Math.pow(2,n)*a,F.world_height=4*Math.pow(2,n)):(F.change_canvas_size(e,Math.ceil(e/a)),b.change_canvas_size(e,Math.ceil(e/a)),F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n)/a):(a=1,F.change_canvas_size(e,e),b.change_canvas_size(e,e),F.world_width=4*Math.pow(2,n),F.world_height=4*Math.pow(2,n))}window.addEventListener("resize",ea),Page.temporary_handlers.resize.push(ea)}();