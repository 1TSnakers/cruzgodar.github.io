!function(){"use strict";let e=500,t=0,n=3e3,r=1,a=.6515,l=0,i=0,o=.01,$=200,c=[],h=[],d=[],s=!1,w=null,u=Site.applet_process_id,f=null,v={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:q,mousedown_callback:N,touchstart_callback:N,mousedrag_callback:O,touchmove_callback:O,mouseup_callback:Q,touchend_callback:Q,wheel_callback:function e(t,n,r,o){l=t,i=n,.3>Math.abs(r/100)?(P(t,n,r/100),a=Math.min(Math.max(a+r/100,-3),3)):H+=.05*Math.sign(r),R()},pinch_callback:function e(t,n,o,$){let c;P(t,n,-(c=r>=1?o/g.world_width*10:o/g.world_height*10)),a=Math.min(Math.max(a-c,-3),3),j=-c,l=t,i=n,R()}},g=new Wilson(Page.element.querySelector("#output-canvas"),v),p=Page.element.querySelector("#code-textarea"),_=Page.element.querySelector("#generate-button");_.addEventListener("click",()=>{g.world_center_x=0,g.world_center_y=0,g.world_width=2*Math.PI,g.world_height=2*Math.PI,a=.6515,q()});let m=Page.element.querySelector("#resolution-input");m.addEventListener("input",q);let b=Page.element.querySelector("#max-particles-input");b.addEventListener("input",()=>{n=parseInt(b.value||3e3)});let y=Page.element.querySelector("#speed-input");y.addEventListener("input",()=>{o=parseFloat(y.value||1)/100});let x=Page.element.querySelector("#lifetime-input");x.addEventListener("input",q);let k=Page.element.querySelector("#download-button");function q(){f=Function("x","y",`return ${p.value}`),e=parseInt(m.value||500),t=0,n=parseInt(b.value||3e3),o=parseFloat(y.value||1)/100,$=parseInt(x.value||200),U(),h=Array(n),d=Array(n);for(let r=0;r<n;r++)h[r]=[0,0,0],d[r]=r;c=Array(g.canvas_height);for(let a=0;a<g.canvas_height;a++){c[a]=Array(g.canvas_width);for(let l=0;l<g.canvas_width;l++)c[a][l]=[0,0,0]}w=new Uint8ClampedArray(g.canvas_height*g.canvas_width*4);for(let i=0;i<g.canvas_height;i++)for(let s=0;s<g.canvas_width;s++)w[4*(g.canvas_width*i+s)+3]=255;window.requestAnimationFrame(S)}k.addEventListener("click",()=>{g.download_frame("a-vector-field.png")}),q(),Page.show();let E=-1;function S(e){try{let r=e-E;if(E=e,0===r)return;if(t<n){let v=Math.min(n/100,n-t);for(let p=d.length-v;p<d.length;p++)z(d[p]);d.splice(d.length-v,v)}if(s)s=!1;else for(let _=0;_<h.length;_++){let m=Math.round((.5-(h[_][1]-g.world_center_y)/g.world_height)*g.canvas_height),b=Math.round(((h[_][0]-g.world_center_x)/g.world_width+.5)*g.canvas_width);if(m>=0&&m<g.canvas_height&&b>=0&&b<g.canvas_width){let y=f(h[_][0],h[_][1]),x=o*y[0],k=o*y[1];c[m][b][0]=$,c[m][b][1]=(Math.atan2(k,x)+Math.PI)/(2*Math.PI),c[m][b][2]=1-Math.exp(-1.2*(x*x+k*k)/(o*o)),h[_][0]+=x,h[_][1]+=k,h[_][2]--,h[_][2]<=0&&L(_)}else{L(_);continue}}for(let N=0;N<g.canvas_height;N++)for(let O=0;O<g.canvas_width;O++)if(c[N][O][0]){let Q=V(c[N][O][1],c[N][O][2],c[N][O][0]/$);w[4*(g.canvas_width*N+O)+0]=Q[0],w[4*(g.canvas_width*N+O)+1]=Q[1],w[4*(g.canvas_width*N+O)+2]=Q[2],c[N][O][0]--}else w[4*(g.canvas_width*N+O)+0]=0,w[4*(g.canvas_width*N+O)+1]=0,w[4*(g.canvas_width*N+O)+2]=0;if(g.render.draw_frame(w),B.push(T),C.push(W),B.shift(),C.shift(),T=0,W=0,0!==A||0!==F){let U=-A*g.world_width,X=-F*g.world_height,Y=Math.round(-X/g.world_height*g.canvas_height),Z=Math.round(U/g.world_width*g.canvas_width);I(Y,Z),Y?(g.world_center_y-=X,F*=G):F=0,Z?(g.world_center_x-=U,A*=G):A=0,Math.sqrt(A*A+F*F)<J&&(A=0,F=0)}if(D.push(j),D.shift(),j=0,0!==H&&(P(l,i,H),a+=H,a=Math.min(Math.max(a,-3),3),R(l,i),H*=K,Math.abs(H)<M&&(H=0)),u!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(S)}catch(ee){q()}}function z(e){h[e][0]=g.world_center_x+g.world_width*(Math.random()-.5),h[e][1]=g.world_center_y+g.world_height*(Math.random()-.5),h[e][2]=Math.round($*(.5*Math.random()+.75)),t++}function L(e){h[e][2]=0,d.push(e),t--}function I(e,t){if(e<=0&&t<=0)for(let n=0;n<g.canvas_height;n++)for(let r=0;r<g.canvas_width;r++)n-e<g.canvas_height&&r-t<g.canvas_width?c[n][r]=c[n-e][r-t]:c[n][r]=[0,0,0];else if(e>0&&t<=0)for(let a=g.canvas_height-1;a>=0;a--)for(let l=0;l<g.canvas_width;l++)a-e>=0&&l-t<g.canvas_width?c[a][l]=c[a-e][l-t]:c[a][l]=[0,0,0];else if(e<=0&&t>0)for(let i=0;i<g.canvas_height;i++)for(let o=g.canvas_width-1;o>=0;o--)i-e<g.canvas_height&&o-t>=0?c[i][o]=c[i-e][o-t]:c[i][o]=[0,0,0];else for(let $=g.canvas_height-1;$>=0;$--)for(let h=g.canvas_width-1;h>=0;h--)$-e>=0&&h-t>=0?c[$][h]=c[$-e][h-t]:c[$][h]=[0,0,0]}function P(e,t,n){if(a<=-3||a>=3)return;let r=Math.pow(2,n),l=Math.round((.5-(t-g.world_center_y)/g.world_height)*g.canvas_height),i=Math.round(((e-g.world_center_x)/g.world_width+.5)*g.canvas_width),o=Array(g.canvas_height);for(let $=0;$<g.canvas_height;$++){o[$]=Array(g.canvas_width);for(let h=0;h<g.canvas_width;h++){let d=Math.round(($-l)*r+l),s=Math.round((h-i)*r+i);d>=0&&d<g.canvas_height&&s>=0&&s<g.canvas_width?o[$][h]=[Math.ceil(c[d][s][0]/1.08),c[d][s][1],c[d][s][2]]:o[$][h]=[0,0,0]}}c=o}let A=0,F=0,H=0,T=0,W=0,j=0,B=[],C=[],D=[],G=.96,J=.002,K=.93,M=.002;function N(e,t,n){A=0,F=0,H=0,B=[0,0,0,0],C=[0,0,0,0],D=[0,0,0,0]}function O(e,t,n,r,a){let l=Math.round(-r/g.world_height*g.canvas_height),i=Math.round(n/g.world_width*g.canvas_width);I(l,i),l?(g.world_center_y-=r,W=-r/g.world_height):W=0,i?(g.world_center_x-=n,T=-n/g.world_width):T=0}function Q(e,t,n){let r=0;B.forEach((e,t)=>{Math.abs(e)>A&&(A=Math.abs(e),r=t)}),A=A<.002?0:B[r],C.forEach((e,t)=>{Math.abs(e)>F&&(F=Math.abs(e),r=t)}),F=F<.002?0:C[r],D.forEach((e,t)=>{Math.abs(e)>H&&(H=Math.abs(e),r=t)}),H=H<.002?0:D[r]}function R(){if(r>=1){let e=g.input.get_zoomed_world_center(l,i,4*Math.pow(2,a)*r,4*Math.pow(2,a));g.world_width=4*Math.pow(2,a)*r,g.world_height=4*Math.pow(2,a),g.world_center_x=e[0],g.world_center_y=e[1]}else{let t=g.input.get_zoomed_world_center(l,i,4*Math.pow(2,a),4*Math.pow(2,a)/r);g.world_width=4*Math.pow(2,a),g.world_height=4*Math.pow(2,a)/r,g.world_center_x=t[0],g.world_center_y=t[1]}}function U(){g.fullscreen.currently_fullscreen?(r=window.innerWidth/window.innerHeight)>=1?(g.change_canvas_size(Math.ceil(e*r),e),g.world_width=4*Math.pow(2,a)*r,g.world_height=4*Math.pow(2,a)):(g.change_canvas_size(e,Math.ceil(e/r)),g.world_width=4*Math.pow(2,a),g.world_height=4*Math.pow(2,a)/r):(r=1,g.change_canvas_size(e,e),g.world_width=4*Math.pow(2,a),g.world_height=4*Math.pow(2,a))}function V(e,t,n){let r,a,l,i,o,$,c,h;switch(i=Math.floor(6*e),o=6*e-i,$=n*(1-t),c=n*(1-o*t),h=n*(1-(1-o)*t),i%6){case 0:r=n,a=h,l=$;break;case 1:r=c,a=n,l=$;break;case 2:r=$,a=n,l=h;break;case 3:r=$,a=c,l=n;break;case 4:r=h,a=$,l=n;break;case 5:r=n,a=$,l=c}return[Math.round(255*r),Math.round(255*a),Math.round(255*l)]}window.addEventListener("resize",U),Page.temporary_handlers.resize.push(U)}();