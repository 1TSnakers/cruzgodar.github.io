!function(){"use strict";let e=400,r=0,t=3e3,a=1,n=.6515,l=0,o=0,i=.0075,d=[],s=[],$=[],c=null,h=Site.applet_process_id,f=null,u=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  uniform float dt;
  
  
  
  //Don't know how, but this writes an honest float32 to the 32 bits of output, which JS then decodes.
  
  float shift_right(float v, float amt)
  {
   v = floor(v) + 0.5;
   return floor(v / exp2(amt));
  }
  
  float shift_left(float v, float amt)
  {
   return floor(v * exp2(amt) + 0.5);
  }
  
  float mask_last(float v, float bits)
  {
   return mod(v, shift_left(1.0, bits));
  }
  
  float extract_bits(float num, float from, float to)
  {
   from = floor(from + 0.5); to = floor(to + 0.5);
   return mask_last(shift_right(num, from), to - from);
  }
  
  vec4 encode_float(float val)
  {
   if (val == 0.0) return vec4(0, 0, 0, 0);
   float sign = val > 0.0 ? 0.0 : 1.0;
   val = abs(val);
   float exponent = floor(log2(val));
   float biased_exponent = exponent + 127.0;
   float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;
   float t = biased_exponent / 2.0;
   float last_bit_of_biased_exponent = fract(t) * 2.0;
   float remaining_bits_of_biased_exponent = floor(t);
   float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;
   float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;
   float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;
   float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
   return vec4(byte4, byte3, byte2, byte1);
  }
  
  
  
  void main(void)
  {
   vec4 sample = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0);
   
   if (int(sample.z) == 0)
   {
    return;
   }
   
   vec2 v = sample.xy;
 `,g=`
   ${u}
   
   float dx = sin(v.y);
   
   float x = dt * dx + v.x;
   
   gl_FragColor = encode_float(x);
  }
 `,v=`
   ${u}
   
   float dy = sin(v.x + 3.14159265);
   
   float y = dt * dy + v.y;
   
   gl_FragColor = encode_float(y);
  }
 `,w=`
   ${u}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float h = (atan(dy, dx) + 3.14159265) / 6.28318531;
   
   gl_FragColor = encode_float(h);
  }
 `,m=`
   ${u}
   
   float dx = sin(v.y);
   float dy = sin(v.x + 3.14159265);
   
   float s = 1.0 - exp(-1.2 * (dx * dx + dy * dy));
   
   gl_FragColor = encode_float(s);
  }
 `,p=new Wilson(Page.element.querySelector("#update-canvas"),{renderer:"gpu",shader:g,canvas_width:100,canvas_height:100});p.render.load_new_shader(v),p.render.load_new_shader(w),p.render.load_new_shader(m),p.render.init_uniforms(["dt"],0),p.render.init_uniforms(["dt"],1),p.render.init_uniforms(["dt"],2),p.render.init_uniforms(["dt"],3),p.gl.useProgram(p.render.shader_programs[0]),p.gl.uniform1f(p.uniforms.dt[0],i),p.gl.useProgram(p.render.shader_programs[1]),p.gl.uniform1f(p.uniforms.dt[1],i),p.gl.useProgram(p.render.shader_programs[2]),p.gl.uniform1f(p.uniforms.dt[2],i),p.gl.useProgram(p.render.shader_programs[3]),p.gl.uniform1f(p.uniforms.dt[3],i),p.render.create_framebuffer_texture_pair();let _=null;p.gl.bindTexture(p.gl.TEXTURE_2D,p.render.framebuffers[0].texture),p.gl.bindFramebuffer(p.gl.FRAMEBUFFER,null);let x=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  void main(void)
  {
   vec3 v = texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0).xyz;
   
   gl_FragColor = vec4((v.x - 1.0) / 255.0, v.y, v.z, 1.0);
  }
 `,b={renderer:"gpu",shader:x,canvas_width:e,canvas_height:e},y=new Wilson(Page.element.querySelector("#dim-canvas"),b);y.render.create_framebuffer_texture_pair(),y.gl.bindTexture(y.gl.TEXTURE_2D,y.render.framebuffers[0].texture),y.gl.bindFramebuffer(y.gl.FRAMEBUFFER,null);let E=new Float32Array(e*e*4),F=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D u_texture;
  
  vec3 hsv2rgb(vec3 c)
  {
   vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
   vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
   return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
  }
  
  void main(void)
  {
   vec3 v = texture2D(u_texture, (-uv + vec2(1.0, 1.0)) / 2.0).xyz;
   
   gl_FragColor = vec4(hsv2rgb(vec3(v.y, v.z, v.x / 255.0)), 1.0);
  }
 `,k={renderer:"gpu",shader:F,canvas_width:e,canvas_height:e},D=new Wilson(Page.element.querySelector("#draw-canvas"),k);D.render.create_framebuffer_texture_pair(),D.gl.bindTexture(D.gl.TEXTURE_2D,D.render.framebuffers[0].texture),D.gl.bindFramebuffer(D.gl.FRAMEBUFFER,null);let T={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:2*Math.PI,world_height:2*Math.PI,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:L,mousedown_callback:et,touchstart_callback:et,mousedrag_callback:ea,touchmove_callback:ea,mouseup_callback:en,touchend_callback:en,wheel_callback:function e(r,t,a,i){l=r,o=t,.3>Math.abs(a/100)?(K(r,t,a/100),n=Math.min(Math.max(n+a/100,-3),3)):H+=.05*Math.sign(a),el()},pinch_callback:function e(r,t,i,d){let s;K(r,t,-(s=a>=1?i/R.world_width*10:i/R.world_height*10)),n=Math.min(Math.max(n-s,-3),3),j=-s,l=r,o=t,el()}},R=new Wilson(Page.element.querySelector("#output-canvas"),T),P=Page.element.querySelector("#code-textarea"),z=Page.element.querySelector("#generate-button");z.addEventListener("click",()=>{R.world_center_x=0,R.world_center_y=0,R.world_width=2*Math.PI,R.world_height=2*Math.PI,n=.6515,L()});let q=Page.element.querySelector("#resolution-input");q.addEventListener("input",L);let A=Page.element.querySelector("#max-particles-input");A.addEventListener("input",L);let S=Page.element.querySelector("#speed-input");S.addEventListener("input",()=>{i=parseFloat(S.value||1)/75,p.gl.useProgram(p.render.shader_programs[0]),p.gl.uniform1f(p.uniforms.dt[0],i),p.gl.useProgram(p.render.shader_programs[1]),p.gl.uniform1f(p.uniforms.dt[1],i),p.gl.useProgram(p.render.shader_programs[2]),p.gl.uniform1f(p.uniforms.dt[2],i),p.gl.useProgram(p.render.shader_programs[3]),p.gl.uniform1f(p.uniforms.dt[3],i)});let B=Page.element.querySelector("#download-button");function L(){f=Function("x","y",`return ${P.value}`),e=parseInt(q.value||500),r=0,t=Math.max(parseInt(A.value||3e3),100);let a=Math.ceil(Math.sqrt(t));p.change_canvas_size(a,a),i=parseFloat(S.value||1)/100,eo(),s=Array(t),$=Array(t);for(let n=0;n<t;n++)s[n]=[0,0,0],$[n]=n;d=Array(R.canvas_height);for(let l=0;l<R.canvas_height;l++){d[l]=Array(R.canvas_width);for(let o=0;o<R.canvas_width;o++)d[l][o]=[0,0,0]}_=new Float32Array(p.canvas_width*p.canvas_height*4);for(let h=0;h<p.canvas_height;h++)for(let u=0;u<p.canvas_width;u++){let g=p.canvas_height*h+u;_[4*g]=0,_[4*g+1]=0,_[4*g+2]=0,_[4*g+3]=0}c=new Uint8ClampedArray(R.canvas_height*R.canvas_width*4);for(let v=0;v<R.canvas_height;v++)for(let w=0;w<R.canvas_width;w++)c[4*(R.canvas_width*v+w)+3]=255;window.requestAnimationFrame(I)}B.addEventListener("click",()=>{R.download_frame("a-vector-field.png")}),L(),Page.show();let U=-1;function I(e){try{let a=e-U;if(U=e,0===a)return;if(r<t){let i=Math.min(t/80,t-r);for(let f=$.length-i;f<$.length;f++)C($[f]);$.splice($.length-i,i)}!function e(){for(let r=0;r<p.canvas_height;r++)for(let t=0;t<p.canvas_width;t++){let a=p.canvas_height*r+t;a<s.length&&s[a][2]?(_[4*a]=s[a][0],_[4*a+1]=s[a][1],_[4*a+2]=1):_[4*a+2]=0}p.gl.texImage2D(p.gl.TEXTURE_2D,0,p.gl.RGBA,p.canvas_width,p.canvas_height,0,p.gl.RGBA,p.gl.FLOAT,_),p.gl.useProgram(p.render.shader_programs[0]),p.render.draw_frame();let n=new Float32Array(p.render.get_pixel_data().buffer);p.gl.useProgram(p.render.shader_programs[1]),p.render.draw_frame();let l=new Float32Array(p.render.get_pixel_data().buffer);p.gl.useProgram(p.render.shader_programs[2]),p.render.draw_frame();let o=new Float32Array(p.render.get_pixel_data().buffer);p.gl.useProgram(p.render.shader_programs[3]),p.render.draw_frame();let i=new Float32Array(p.render.get_pixel_data().buffer);for(let $=0;$<p.canvas_height;$++)for(let c=0;c<p.canvas_width;c++){let h=p.canvas_height*$+c;if(h<s.length&&s[h][2]){s[h][0]=n[h],s[h][1]=l[h];let f=Math.round((.5-(s[h][1]-R.world_center_y)/R.world_height)*R.canvas_height),u=Math.round(((s[h][0]-R.world_center_x)/R.world_width+.5)*R.canvas_width);if(f>=0&&f<R.canvas_height&&u>=0&&u<R.canvas_width)d[f][u][0]=255,d[f][u][1]=o[h],d[f][u][2]=i[h],s[h][2]--,s[h][2]<=0&&G(h);else{G(h);continue}}}}();for(let u=0;u<R.canvas_height;u++)for(let g=0;g<R.canvas_width;g++){if(d[u][g][0]){let v=ei(d[u][g][1],d[u][g][2],d[u][g][0]/255);c[4*(R.canvas_width*u+g)+0]=v[0],c[4*(R.canvas_width*u+g)+1]=v[1],c[4*(R.canvas_width*u+g)+2]=v[2],d[u][g][0]--}else c[4*(R.canvas_width*u+g)+0]=0,c[4*(R.canvas_width*u+g)+1]=0,c[4*(R.canvas_width*u+g)+2]=0;let w=y.canvas_width*u+g;E[4*w]=d[u][g][0],E[4*w+1]=d[u][g][1],E[4*w+2]=d[u][g][2]}if(R.render.draw_frame(c),y.gl.texImage2D(y.gl.TEXTURE_2D,0,y.gl.RGBA,y.canvas_width,y.canvas_height,0,y.gl.RGBA,y.gl.FLOAT,E),y.render.draw_frame(),D.gl.texImage2D(D.gl.TEXTURE_2D,0,D.gl.RGBA,D.canvas_width,D.canvas_height,0,D.gl.RGBA,D.gl.FLOAT,E),D.render.draw_frame(),N.push(J),Q.push(W),N.shift(),Q.shift(),J=0,W=0,0!==M||0!==O){let m=-M*R.world_width,x=-O*R.world_height,b=Math.round(-x/R.world_height*R.canvas_height),F=Math.round(m/R.world_width*R.canvas_width);X(b,F),b?(R.world_center_y-=x,O*=Y):O=0,F?(R.world_center_x-=m,M*=Y):M=0,Math.sqrt(M*M+O*O)<Z&&(M=0,O=0)}if(V.push(j),V.shift(),j=0,0!==H&&(K(l,o,H),n+=H,n=Math.min(Math.max(n,-3),3),el(l,o),H*=ee,Math.abs(H)<er&&(H=0)),h!==Site.applet_process_id){console.log("Terminated applet process");return}window.requestAnimationFrame(I)}catch(k){L()}}function C(e){s[e][0]=R.world_center_x+R.world_width*(Math.random()-.5),s[e][1]=R.world_center_y+R.world_height*(Math.random()-.5),s[e][2]=Math.round(255*(.5*Math.random()+.75)),r++}function G(e){s[e][2]=0,$.push(e),r--}function X(e,r){if(e<=0&&r<=0)for(let t=0;t<R.canvas_height;t++)for(let a=0;a<R.canvas_width;a++)t-e<R.canvas_height&&a-r<R.canvas_width?d[t][a]=d[t-e][a-r]:d[t][a]=[0,0,0];else if(e>0&&r<=0)for(let n=R.canvas_height-1;n>=0;n--)for(let l=0;l<R.canvas_width;l++)n-e>=0&&l-r<R.canvas_width?d[n][l]=d[n-e][l-r]:d[n][l]=[0,0,0];else if(e<=0&&r>0)for(let o=0;o<R.canvas_height;o++)for(let i=R.canvas_width-1;i>=0;i--)o-e<R.canvas_height&&i-r>=0?d[o][i]=d[o-e][i-r]:d[o][i]=[0,0,0];else for(let s=R.canvas_height-1;s>=0;s--)for(let $=R.canvas_width-1;$>=0;$--)s-e>=0&&$-r>=0?d[s][$]=d[s-e][$-r]:d[s][$]=[0,0,0]}function K(e,r,t){if(n<=-3||n>=3)return;let a=Math.pow(2,t),l=Math.round((.5-(r-R.world_center_y)/R.world_height)*R.canvas_height),o=Math.round(((e-R.world_center_x)/R.world_width+.5)*R.canvas_width),i=Array(R.canvas_height);for(let $=0;$<R.canvas_height;$++){i[$]=Array(R.canvas_width);for(let c=0;c<R.canvas_width;c++){let h=Math.round(($-l)*a+l),f=Math.round((c-o)*a+o);h>=0&&h<R.canvas_height&&f>=0&&f<R.canvas_width?i[$][c]=[Math.ceil(d[h][f][0]/1.08),d[h][f][1],d[h][f][2]]:i[$][c]=[0,0,0]}}let u=Math.pow(2,2*t),g=0;if(t>0)for(let v=0;v<s.length;v++)s[v][2]&&v%u>=1&&(G(v),g++);d=i}let M=0,O=0,H=0,J=0,W=0,j=0,N=[],Q=[],V=[],Y=.96,Z=.002,ee=.93,er=.002;function et(e,r,t){M=0,O=0,H=0,N=[0,0,0,0],Q=[0,0,0,0],V=[0,0,0,0]}function ea(e,r,t,a,n){let l=Math.round(-a/R.world_height*R.canvas_height),o=Math.round(t/R.world_width*R.canvas_width);X(l,o),l?(R.world_center_y-=a,W=-a/R.world_height):W=0,o?(R.world_center_x-=t,J=-t/R.world_width):J=0}function en(e,r,t){let a=0;N.forEach((e,r)=>{Math.abs(e)>M&&(M=Math.abs(e),a=r)}),M=M<.002?0:N[a],Q.forEach((e,r)=>{Math.abs(e)>O&&(O=Math.abs(e),a=r)}),O=O<.002?0:Q[a],V.forEach((e,r)=>{Math.abs(e)>H&&(H=Math.abs(e),a=r)}),H=H<.002?0:V[a]}function el(){if(a>=1){let e=R.input.get_zoomed_world_center(l,o,4*Math.pow(2,n)*a,4*Math.pow(2,n));R.world_width=4*Math.pow(2,n)*a,R.world_height=4*Math.pow(2,n),R.world_center_x=e[0],R.world_center_y=e[1]}else{let r=R.input.get_zoomed_world_center(l,o,4*Math.pow(2,n),4*Math.pow(2,n)/a);R.world_width=4*Math.pow(2,n),R.world_height=4*Math.pow(2,n)/a,R.world_center_x=r[0],R.world_center_y=r[1]}}function eo(){R.fullscreen.currently_fullscreen?(a=window.innerWidth/window.innerHeight)>=1?(R.change_canvas_size(Math.ceil(e*a),e),R.world_width=4*Math.pow(2,n)*a,R.world_height=4*Math.pow(2,n)):(R.change_canvas_size(e,Math.ceil(e/a)),R.world_width=4*Math.pow(2,n),R.world_height=4*Math.pow(2,n)/a):(a=1,R.change_canvas_size(e,e),R.world_width=4*Math.pow(2,n),R.world_height=4*Math.pow(2,n))}function ei(e,r,t){let a,n,l,o,i,d,s,$;switch(o=Math.floor(6*e),i=6*e-o,d=t*(1-r),s=t*(1-i*r),$=t*(1-(1-i)*r),o%6){case 0:a=t,n=$,l=d;break;case 1:a=s,n=t,l=d;break;case 2:a=d,n=t,l=$;break;case 3:a=d,n=s,l=t;break;case 4:a=$,n=d,l=t;break;case 5:a=t,n=d,l=s}return[Math.round(255*a),Math.round(255*n),Math.round(255*l)]}window.addEventListener("resize",eo),Page.temporary_handlers.resize.push(eo)}();