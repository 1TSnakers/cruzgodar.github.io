!function(){"use strict";let t=1e3,e=0,n=1,r=-.866,a=-.5,l=.866,i=-.5,s=.1,o=.01,d=!1,c=!1,_={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"},u=new Wilson(document.querySelector("#output-canvas"),_);u.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\tconst float dt = .001;\n\t\t\n\t\tuniform vec2 planet_1;\n\t\tuniform vec2 planet_2;\n\t\tuniform vec2 planet_3;\n\t\t\n\t\tconst float world_size = 10.0;\n\t\t\n\t\tconst float crash_threshhold = .02;\n\t\t\n\t\tconst float G = 1.0;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * world_size;\n\t\t\t\n\t\t\tvec4 d_state = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfloat d_x = planet_1.x - state.x;\n\t\t\tfloat d_y = planet_1.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvec2 planet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tfloat r = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_1 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_x = planet_2.x - state.x;\n\t\t\td_y = planet_2.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tr = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_2 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_x = planet_3.x - state.x;\n\t\t\td_y = planet_3.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tr = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_3 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_state.xy = state.zw;\n\t\t\t\n\t\t\tstate = ((dt * d_state + state) / world_size) + vec4(.5, .5, .5, .5);\n\t\t\t\n\t\t\tstate.xy = fract(state.xy);\n\t\t\t\n\t\t\tgl_FragColor = state;\n\t\t}\n\t"),u.render.init_uniforms(["planet_1","planet_2","planet_3"]),u.gl.uniform2f(u.uniforms.planet_1,e,n),u.gl.uniform2f(u.uniforms.planet_2,r,a),u.gl.uniform2f(u.uniforms.planet_3,l,i),u.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\t\n\t\t\n\t\tvec3 hsv2rgb(vec3 c)\n\t\t{\n\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));\n\t\t\t\n\t\t\tfloat h = atan(state.y, state.x) / (2.0 * 3.14159265258) + .5;\n\t\t\t\n\t\t\tfloat s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);\n\t\t\t\n\t\t\tfloat v_add = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));\n\t\t\t\n\t\t\tfloat v = clamp(sqrt(state.z * state.z + state.w * state.w) + v_add, 0.0, 1.0);\n\t\t\t\n\t\t\tvec3 rgb = hsv2rgb(vec3(h, s, v));\n\t\t\t\n\t\t\tgl_FragColor = vec4(rgb, 1.0);\n\t\t}\n\t"),u.render.create_framebuffer_texture_pair(),u.render.create_framebuffer_texture_pair();let f=document.querySelector("#resolution-input");document.querySelector("#generate-button").addEventListener("click",()=>{d=!1,t=parseInt(f.value||1e3),u.change_canvas_size(t,t),u.gl.useProgram(u.render.shader_programs[1]),u.gl.bindTexture(u.gl.TEXTURE_2D,u.render.framebuffers[0].texture),u.gl.texImage2D(u.gl.TEXTURE_2D,0,u.gl.RGBA,u.canvas_width,u.canvas_height,0,u.gl.RGBA,u.gl.FLOAT,null),u.gl.bindTexture(u.gl.TEXTURE_2D,u.render.framebuffers[1].texture),u.gl.texImage2D(u.gl.TEXTURE_2D,0,u.gl.RGBA,u.canvas_width,u.canvas_height,0,u.gl.RGBA,u.gl.FLOAT,null),u.gl.useProgram(u.render.shader_programs[0]),u.gl.bindTexture(u.gl.TEXTURE_2D,u.render.framebuffers[0].texture),u.gl.bindFramebuffer(u.gl.FRAMEBUFFER,u.render.framebuffers[0].framebuffer),u.render.draw_frame(),window.requestAnimationFrame(m),d=!0});let g=document.querySelector("#switch-planet-drawer-canvas-button");function m(t){let s=t-T;T=t,0!==s&&(u.gl.useProgram(u.render.shader_programs[1]),u.gl.uniform2f(u.uniforms.planet_1,e,n),u.gl.uniform2f(u.uniforms.planet_2,r,a),u.gl.uniform2f(u.uniforms.planet_3,l,i),u.gl.bindFramebuffer(u.gl.FRAMEBUFFER,u.render.framebuffers[1].framebuffer),u.render.draw_frame(),u.gl.useProgram(u.render.shader_programs[2]),u.gl.bindTexture(u.gl.TEXTURE_2D,u.render.framebuffers[1].texture),u.gl.bindFramebuffer(u.gl.FRAMEBUFFER,null),u.render.draw_frame(),u.gl.useProgram(u.render.shader_programs[1]),u.gl.bindFramebuffer(u.gl.FRAMEBUFFER,u.render.framebuffers[0].framebuffer),u.render.draw_frame(),u.gl.useProgram(u.render.shader_programs[2]),u.gl.bindTexture(u.gl.TEXTURE_2D,u.render.framebuffers[0].texture),u.gl.bindFramebuffer(u.gl.FRAMEBUFFER,null),u.render.draw_frame(),c||window.requestAnimationFrame(m))}g.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",g.addEventListener("click",()=>{c?(q(),window.requestAnimationFrame(q),g.style.opacity=0,setTimeout(()=>{g.textContent="Pick Particle",g.style.opacity=1},250)):(c=!0,g.style.opacity=0,setTimeout(()=>{g.textContent="Return to Fractal",g.style.opacity=1},250))}),document.querySelector("#download-button").addEventListener("click",()=>{u.download_frame("a-three-body-system.png")});let h=2e3,v=0,p=10,x={renderer:"cpu",world_width:p,world_height:p,canvas_width:h,canvas_height:h,mousemove_callback:A,touchmove_callback:A,mousedown_callback:k,touchend_callback:k,use_draggables:!0,draggables_mousemove_callback:U,draggables_touchmove_callback:U},b=new Wilson(document.querySelector("#planet-drawer-canvas"),x);b.draggables.add(0,1),b.draggables.add(-.866,-.5),b.draggables.add(.866,-.5);let w=0,y=0,F=0,z=0,E=0,M=0,R=0,T=-1;function A(t,e,n,r,a){c&&(0===v&&function(){if(!d)return;c=!0,b.canvas.style.opacity=.5,v=1}(),2!==v&&(w=t,y=-e,F=0,z=0,window.requestAnimationFrame(D)))}function k(t,e,n){1===v&&(M=w,R=y,F=0,z=0,E=0,function(){if(!d)return;b.canvas.style.opacity=1,v=2,window.requestAnimationFrame(D)}())}function q(){d&&(c=!1,window.requestAnimationFrame(m),b.canvas.style.opacity=0,v=0)}function D(t){let d=t-T;if(T=t,0===d)return;E++,b.ctx.fillStyle="rgb(0, 0, 0)",b.ctx.fillRect(0,0,h,h);let c=w/p,_=y/p,u=F/p,f=z/p,g=Math.atan2(_,-c)/(2*Math.PI)+1,m=Math.min(Math.min(50*(c*c+_*_),5*(1-Math.max(Math.abs(c),Math.abs(_)))),1),x=.9*((1-M/(2*Math.PI))*(1-M/(2*Math.PI))+(1-R/(2*Math.PI))*(1-R/(2*Math.PI)))*4,A=function(t,e,n){let r,a,l,i,s,o,d,c;switch(i=Math.floor(6*t),o=n*(1-e),d=n*(1-(s=6*t-i)*e),c=n*(1-(1-s)*e),i%6){case 0:r=n,a=c,l=o;break;case 1:r=d,a=n,l=o;break;case 2:r=o,a=n,l=c;break;case 3:r=o,a=d,l=n;break;case 4:r=c,a=o,l=n;break;case 5:r=n,a=o,l=d}return[Math.round(255*r),Math.round(255*a),Math.round(255*l)]}(g,m,Math.min(Math.pow(u*u+f*f,.5)+x,1));b.ctx.fillStyle=`rgb(${A[0]}, ${A[1]}, ${A[2]})`,b.ctx.beginPath(),b.ctx.arc(h*(c+.5),h*(_+.5),30,0,2*Math.PI,!1),b.ctx.fill(),2===v&&(!function(){let t=0,d=0,c=P(e,-n);if(t+=c[0],d+=c[1],c[2]<s)return w=e,y=-n,F=0,void(z=0);if(c=P(r,-a),t+=c[0],d+=c[1],c[2]<s)return w=r,y=-a,F=0,void(z=0);if(c=P(l,-i),t+=c[0],d+=c[1],c[2]<s)return w=l,y=-i,F=0,void(z=0);w+=F*o,y+=z*o,F+=t*o,z+=d*o;for(;w<-p/2;)w+=p;for(;w>p/2;)w-=p;for(;y<-p/2;)y+=p;for(;y>p/2;)y-=p}(),window.requestAnimationFrame(D))}function P(t,e){let n=t-w,r=e-y,a=0;return Math.abs(n)>p/2&&(n<0?n+=p:n-=p),Math.abs(r)>p/2&&(r<0?r+=p:r-=p),[n/((a=Math.sqrt(n*n+r*r))*a*a),r/(a*a*a),a]}function U(t,s,o,d){0===t?(e=s,n=o):1===t?(r=s,a=o):(l=s,i=o)}b.ctx.lineWidth=h/100,b.ctx.strokeStyle="rgb(127, 0, 255)",b.ctx.fillStyle="rgb(0, 0, 0)",b.draggables.container.addEventListener("mouseleave",()=>{(1===v||E<3)&&(b.canvas.style.opacity=0,v=0)})}();