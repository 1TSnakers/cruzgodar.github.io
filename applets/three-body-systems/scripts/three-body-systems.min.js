!function(){"use strict";let t=1e3,e=0,n=1,r=-.866,a=-.5,l=.866,i=-.5,s=.1,o=.01,d=!1,_=!1,c=null,u={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t",canvas_width:t,canvas_height:t,use_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png"},f=new Wilson(Page.element.querySelector("#output-canvas"),u);f.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\tconst float dt = .001;\n\t\t\n\t\tuniform vec2 planet_1;\n\t\tuniform vec2 planet_2;\n\t\tuniform vec2 planet_3;\n\t\t\n\t\tconst float world_size = 15.0;\n\t\t\n\t\tconst float crash_threshhold = .02;\n\t\t\n\t\tconst float G = 1.0;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * world_size;\n\t\t\t\n\t\t\tvec4 d_state = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfloat d_x = planet_1.x - state.x;\n\t\t\tfloat d_y = planet_1.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvec2 planet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tfloat r = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_1 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_x = planet_2.x - state.x;\n\t\t\td_y = planet_2.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tr = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_2 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_x = planet_3.x - state.x;\n\t\t\td_y = planet_3.y - state.y;\n\t\t\t\n\t\t\tif (abs(d_x) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_x < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_x += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_x -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(d_y) > world_size / 2.0)\n\t\t\t{\n\t\t\t\tif (d_y < 0.0)\n\t\t\t\t{\n\t\t\t\t\td_y += world_size;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\td_y -= world_size;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanet_direction = vec2(d_x, d_y);\n\t\t\t\n\t\t\tr = length(planet_direction);\n\t\t\t\n\t\t\tif (r < crash_threshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet_3 / world_size + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\td_state.zw += planet_direction / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\td_state.xy = state.zw;\n\t\t\t\n\t\t\tstate = ((dt * d_state + state) / world_size) + vec4(.5, .5, .5, .5);\n\t\t\t\n\t\t\tstate.xy = fract(state.xy);\n\t\t\t\n\t\t\tgl_FragColor = state;\n\t\t}\n\t"),f.render.init_uniforms(["planet_1","planet_2","planet_3"]),f.gl.uniform2f(f.uniforms.planet_1,e,n),f.gl.uniform2f(f.uniforms.planet_2,r,a),f.gl.uniform2f(f.uniforms.planet_3,l,i),f.render.load_new_shader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\t\n\t\t\n\t\t\n\t\tvec3 hsv2rgb(vec3 c)\n\t\t{\n\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(u_texture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));\n\t\t\t\n\t\t\tfloat h = atan(state.y, state.x) / (2.0 * 3.14159265258) + .5;\n\t\t\t\n\t\t\tfloat s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);\n\t\t\t\n\t\t\tfloat v_add = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));\n\t\t\t\n\t\t\tfloat v = clamp(sqrt(state.z * state.z + state.w * state.w) + v_add, 0.0, 1.0);\n\t\t\t\n\t\t\tvec3 rgb = hsv2rgb(vec3(h, s, v));\n\t\t\t\n\t\t\tgl_FragColor = vec4(rgb, 1.0);\n\t\t}\n\t"),f.render.create_framebuffer_texture_pair(),f.render.create_framebuffer_texture_pair();let g=Page.element.querySelector("#resolution-input");Page.element.querySelector("#generate-button").addEventListener("click",()=>{d=!1,c=Site.applet_process_id,t=parseInt(g.value||1e3),f.change_canvas_size(t,t),f.gl.useProgram(f.render.shader_programs[1]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.texImage2D(f.gl.TEXTURE_2D,0,f.gl.RGBA,f.canvas_width,f.canvas_height,0,f.gl.RGBA,f.gl.FLOAT,null),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[1].texture),f.gl.texImage2D(f.gl.TEXTURE_2D,0,f.gl.RGBA,f.canvas_width,f.canvas_height,0,f.gl.RGBA,f.gl.FLOAT,null),f.gl.useProgram(f.render.shader_programs[0]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[0].framebuffer),f.render.draw_frame(),window.requestAnimationFrame(h),d=!0});let m=Page.element.querySelector("#switch-planet-drawer-canvas-button");function h(t){let s=t-P;P=t,0!==s&&(f.gl.useProgram(f.render.shader_programs[1]),f.gl.uniform2f(f.uniforms.planet_1,e,n),f.gl.uniform2f(f.uniforms.planet_2,r,a),f.gl.uniform2f(f.uniforms.planet_3,l,i),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[1].framebuffer),f.render.draw_frame(),f.gl.useProgram(f.render.shader_programs[2]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[1].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,null),f.render.draw_frame(),f.gl.useProgram(f.render.shader_programs[1]),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[0].framebuffer),f.render.draw_frame(),f.gl.useProgram(f.render.shader_programs[2]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,null),f.render.draw_frame(),c===Site.applet_process_id?_||window.requestAnimationFrame(h):console.log("Terminated applet process"))}m.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",m.addEventListener("click",()=>{_?(q(),window.requestAnimationFrame(q),m.style.opacity=0,setTimeout(()=>{m.textContent="Pick Particle",m.style.opacity=1},250)):(_=!0,m.style.opacity=0,setTimeout(()=>{m.textContent="Return to Fractal",m.style.opacity=1},250))}),Page.element.querySelector("#download-button").addEventListener("click",()=>{f.download_frame("a-three-body-system.png")});let p=2e3,v=0,x=15,b={renderer:"cpu",world_width:x,world_height:x,canvas_width:p,canvas_height:p,mousemove_callback:A,touchmove_callback:A,mousedown_callback:k,touchend_callback:k,use_draggables:!0,draggables_mousemove_callback:U,draggables_touchmove_callback:U},w=new Wilson(Page.element.querySelector("#planet-drawer-canvas"),b);w.draggables.add(0,1),w.draggables.add(-.866,-.5),w.draggables.add(.866,-.5);let y=0,F=0,z=0,E=0,M=0,T=0,R=0,P=-1;function A(t,e,n,r,a){_&&(0===v&&function(){if(!d)return;_=!0,w.canvas.style.opacity=.5,v=1}(),2!==v&&(y=t,F=-e,z=0,E=0,window.requestAnimationFrame(D)))}function k(t,e,n){1===v&&(T=y,R=F,z=0,E=0,M=0,function(){if(!d)return;w.canvas.style.opacity=1,v=2,window.requestAnimationFrame(D)}())}function q(){d&&(_=!1,window.requestAnimationFrame(h),w.canvas.style.opacity=0,v=0)}function D(t){let d=t-P;if(P=t,0===d)return;M++,w.ctx.fillStyle="rgb(0, 0, 0)",w.ctx.fillRect(0,0,p,p);let _=y/x,c=F/x,u=z/x,f=E/x,g=Math.atan2(c,-_)/(2*Math.PI)+1,m=Math.min(Math.min(50*(_*_+c*c),5*(1-Math.max(Math.abs(_),Math.abs(c)))),1),h=.9*((1-T/(2*Math.PI))*(1-T/(2*Math.PI))+(1-R/(2*Math.PI))*(1-R/(2*Math.PI)))*4,b=function(t,e,n){let r,a,l,i,s,o,d,_;switch(i=Math.floor(6*t),o=n*(1-e),d=n*(1-(s=6*t-i)*e),_=n*(1-(1-s)*e),i%6){case 0:r=n,a=_,l=o;break;case 1:r=d,a=n,l=o;break;case 2:r=o,a=n,l=_;break;case 3:r=o,a=d,l=n;break;case 4:r=_,a=o,l=n;break;case 5:r=n,a=o,l=d}return[Math.round(255*r),Math.round(255*a),Math.round(255*l)]}(g,m,Math.min(Math.pow(u*u+f*f,.5)+h,1));w.ctx.fillStyle=`rgb(${b[0]}, ${b[1]}, ${b[2]})`,w.ctx.beginPath(),w.ctx.arc(p*(_+.5),p*(c+.5),30,0,2*Math.PI,!1),w.ctx.fill(),2===v&&(!function(){let t=0,d=0,_=S(e,-n);if(t+=_[0],d+=_[1],_[2]<s)return y=e,F=-n,z=0,void(E=0);if(_=S(r,-a),t+=_[0],d+=_[1],_[2]<s)return y=r,F=-a,z=0,void(E=0);if(_=S(l,-i),t+=_[0],d+=_[1],_[2]<s)return y=l,F=-i,z=0,void(E=0);y+=z*o,F+=E*o,z+=t*o,E+=d*o;for(;y<-x/2;)y+=x;for(;y>x/2;)y-=x;for(;F<-x/2;)F+=x;for(;F>x/2;)F-=x}(),window.requestAnimationFrame(D))}function S(t,e){let n=t-y,r=e-F,a=0;return Math.abs(n)>x/2&&(n<0?n+=x:n-=x),Math.abs(r)>x/2&&(r<0?r+=x:r-=x),[n/((a=Math.sqrt(n*n+r*r))*a*a),r/(a*a*a),a]}function U(t,s,o,d){0===t?(e=s,n=o):1===t?(r=s,a=o):(l=s,i=o)}w.ctx.lineWidth=p/100,w.ctx.strokeStyle="rgb(127, 0, 255)",w.ctx.fillStyle="rgb(0, 0, 0)",Page.show(),w.draggables.container.addEventListener("mouseleave",()=>{(1===v||M<3)&&(w.canvas.style.opacity=0,v=0)})}();