!function(){function F(b){let d=b-E;E=b;0!==d&&(a.gl.useProgram(a.render.shaderPrograms[1]),a.gl.uniform2f(a.uniforms.planet1,w,x),a.gl.uniform2f(a.uniforms.planet2,y,z),a.gl.uniform2f(a.uniforms.planet3,A,B),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,a.render.framebuffers[1].framebuffer),a.render.drawFrame(),a.gl.useProgram(a.render.shaderPrograms[2]),a.gl.bindTexture(a.gl.TEXTURE_2D,a.render.framebuffers[1].texture),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null),a.render.drawFrame(),a.gl.useProgram(a.render.shaderPrograms[1]),
a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,a.render.framebuffers[0].framebuffer),a.render.drawFrame(),a.gl.useProgram(a.render.shaderPrograms[2]),a.gl.bindTexture(a.gl.TEXTURE_2D,a.render.framebuffers[0].texture),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null),a.render.drawFrame(),N!==Site.appletProcessId?console.log("Terminated applet process"):v||window.requestAnimationFrame(F))}function O(b,d,c,t,m){v&&(0===n&&C&&(v=!0,f.canvas.style.opacity=.5,n=1),2!==n&&(h=b,k=-d,p=q=0,window.requestAnimationFrame(G)))}
function P(b,d,c){1===n&&(H=h,I=k,J=p=q=0,C&&(f.canvas.style.opacity=1,n=2,window.requestAnimationFrame(G)))}function Q(){C&&(v=!1,window.requestAnimationFrame(F),n=f.canvas.style.opacity=0)}function G(b){var d=b-E;E=b;if(0!==d){J++;f.ctx.fillStyle="rgb(0, 0, 0)";f.ctx.fillRect(0,0,2E3,2E3);b=h/15;d=k/15;var c=q/15,t=p/15,m=Math.atan2(d,-b)/(2*Math.PI)+1,u=Math.min(Math.min(50*(b*b+d*d),5*(1-Math.max(Math.abs(b),Math.abs(d)))),1);c=Math.min(Math.pow(c*c+t*t,.5)+3.6*((1-H/(2*Math.PI))*(1-H/(2*Math.PI))+
(1-I/(2*Math.PI))*(1-I/(2*Math.PI))),1);t=Math.floor(6*m);var R=6*m-t;m=c*(1-u);var K=c*(1-R*u);u=c*(1-(1-R)*u);switch(t%6){case 0:var g=c;var l=u;var e=m;break;case 1:g=K;l=c;e=m;break;case 2:g=m;l=c;e=u;break;case 3:g=m;l=K;e=c;break;case 4:g=u;l=m;e=c;break;case 5:g=c,l=m,e=K}g=[Math.round(255*g),Math.round(255*l),Math.round(255*e)];f.ctx.fillStyle=`rgb(${g[0]}, ${g[1]}, ${g[2]})`;f.ctx.beginPath();f.ctx.arc(2E3*(b+.5),2E3*(d+.5),30,0,2*Math.PI,!1);f.ctx.fill();if(2===n){l=g=0;e=L(w,-x);g+=e[0];
l+=e[1];if(.1>e[2])h=w,k=-x,p=q=0;else if(e=L(y,-z),g+=e[0],l+=e[1],.1>e[2])h=y,k=-z,p=q=0;else if(e=L(A,-B),g+=e[0],l+=e[1],.1>e[2])h=A,k=-B,p=q=0;else{h+=.01*q;k+=.01*p;q+=.01*g;for(p+=.01*l;-7.5>h;)h+=15;for(;7.5<h;)h-=15;for(;-7.5>k;)k+=15;for(;7.5<k;)k-=15}window.requestAnimationFrame(G)}}}function L(b,d){b-=h;d-=k;let c;7.5<Math.abs(b)&&(b=0>b?b+15:b-15);7.5<Math.abs(d)&&(d=0>d?d+15:d-15);c=Math.sqrt(b*b+d*d);return[b/(c*c*c),d/(c*c*c),c]}function S(b,d,c,t){0===b?(w=d,x=c):1===b?(y=d,z=c):
(A=d,B=c)}let D=1E3,w=0,x=1,y=-.866,z=-.5,A=.866,B=-.5,C=!1,v=!1,N=null;var M={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t",canvasWidth:D,canvasHeight:D,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};
let a=new Wilson($("#output-canvas"),M);a.render.loadNewShader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D uTexture;\n\t\t\n\t\tconst float dt = .001;\n\t\t\n\t\tuniform vec2 planet1;\n\t\tuniform vec2 planet2;\n\t\tuniform vec2 planet3;\n\t\t\n\t\tconst float worldSize = 15.0;\n\t\t\n\t\tconst float crashThreshhold = .02;\n\t\t\n\t\tconst float G = 1.0;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * worldSize;\n\t\t\t\n\t\t\tvec4 dState = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfloat dX = planet1.x - state.x;\n\t\t\tfloat dY = planet1.y - state.y;\n\t\t\t\n\t\t\tif (abs(dX) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dX < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdX += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdX -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(dY) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dY < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdY += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdY -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvec2 planetDirection = vec2(dX, dY);\n\t\t\t\n\t\t\tfloat r = length(planetDirection);\n\t\t\t\n\t\t\tif (r < crashThreshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet1 / worldSize + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tdState.zw += planetDirection / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tdX = planet2.x - state.x;\n\t\t\tdY = planet2.y - state.y;\n\t\t\t\n\t\t\tif (abs(dX) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dX < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdX += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdX -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(dY) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dY < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdY += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdY -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanetDirection = vec2(dX, dY);\n\t\t\t\n\t\t\tr = length(planetDirection);\n\t\t\t\n\t\t\tif (r < crashThreshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet2 / worldSize + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tdState.zw += planetDirection / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tdX = planet3.x - state.x;\n\t\t\tdY = planet3.y - state.y;\n\t\t\t\n\t\t\tif (abs(dX) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dX < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdX += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdX -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (abs(dY) > worldSize / 2.0)\n\t\t\t{\n\t\t\t\tif (dY < 0.0)\n\t\t\t\t{\n\t\t\t\t\tdY += worldSize;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdY -= worldSize;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tplanetDirection = vec2(dX, dY);\n\t\t\t\n\t\t\tr = length(planetDirection);\n\t\t\t\n\t\t\tif (r < crashThreshhold)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(planet3 / worldSize + vec2(.5, .5), 0.5, 0.5);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tdState.zw += planetDirection / (r*r*r);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tdState.xy = state.zw;\n\t\t\t\n\t\t\tstate = ((dt * dState + state) / worldSize) + vec4(.5, .5, .5, .5);\n\t\t\t\n\t\t\tstate.xy = fract(state.xy);\n\t\t\t\n\t\t\tgl_FragColor = state;\n\t\t}\n\t");
a.render.initUniforms(["planet1","planet2","planet3"]);a.gl.uniform2f(a.uniforms.planet1,w,x);a.gl.uniform2f(a.uniforms.planet2,y,z);a.gl.uniform2f(a.uniforms.planet3,A,B);a.render.loadNewShader("\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform sampler2D uTexture;\n\t\t\n\t\t\n\t\t\n\t\tvec3 hsv2rgb(vec3 c)\n\t\t{\n\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec4 state = (texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));\n\t\t\t\n\t\t\tfloat h = atan(state.y, state.x) / (2.0 * 3.14159265258) + .5;\n\t\t\t\n\t\t\tfloat s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);\n\t\t\t\n\t\t\tfloat vAdd = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));\n\t\t\t\n\t\t\tfloat v = clamp(sqrt(state.z * state.z + state.w * state.w) + vAdd, 0.0, 1.0);\n\t\t\t\n\t\t\tvec3 rgb = hsv2rgb(vec3(h, s, v));\n\t\t\t\n\t\t\tgl_FragColor = vec4(rgb, 1.0);\n\t\t}\n\t");
a.render.createFramebufferTexturePair();a.render.createFramebufferTexturePair();let T=$("#resolution-input");$("#generate-button").addEventListener("click",()=>{C=!1;N=Site.appletProcessId;D=parseInt(T.value||1E3);a.changeCanvasSize(D,D);a.gl.useProgram(a.render.shaderPrograms[1]);a.gl.bindTexture(a.gl.TEXTURE_2D,a.render.framebuffers[0].texture);a.gl.texImage2D(a.gl.TEXTURE_2D,0,a.gl.RGBA,a.canvasWidth,a.canvasHeight,0,a.gl.RGBA,a.gl.FLOAT,null);a.gl.bindTexture(a.gl.TEXTURE_2D,a.render.framebuffers[1].texture);
a.gl.texImage2D(a.gl.TEXTURE_2D,0,a.gl.RGBA,a.canvasWidth,a.canvasHeight,0,a.gl.RGBA,a.gl.FLOAT,null);a.gl.useProgram(a.render.shaderPrograms[0]);a.gl.bindTexture(a.gl.TEXTURE_2D,a.render.framebuffers[0].texture);a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,a.render.framebuffers[0].framebuffer);a.render.drawFrame();window.requestAnimationFrame(F);C=!0});let r=$("#switch-planet-drawer-canvas-button");r.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out";r.addEventListener("click",()=>{v?
(Q(),window.requestAnimationFrame(Q),r.style.opacity=0,setTimeout(()=>{r.textContent="Pick Particle";r.style.opacity=1},250)):(v=!0,r.style.opacity=0,setTimeout(()=>{r.textContent="Return to Fractal";r.style.opacity=1},250))});$("#download-button").addEventListener("click",()=>{a.downloadFrame("a-three-body-system.png")});let n=0;M={renderer:"cpu",worldWidth:15,worldHeight:15,canvasWidth:2E3,canvasHeight:2E3,mousemoveCallback:O,touchmoveCallback:O,mousedownCallback:P,touchendCallback:P,useDraggables:!0,
draggablesMousemoveCallback:S,draggablesTouchmoveCallback:S};let f=new Wilson($("#planet-drawer-canvas"),M);f.draggables.add(0,1);f.draggables.add(-.866,-.5);f.draggables.add(.866,-.5);let h=0,k=0,q=0,p=0,J=0,H=0,I=0,E=-1;f.ctx.lineWidth=20;f.ctx.strokeStyle="rgb(127, 0, 255)";f.ctx.fillStyle="rgb(0, 0, 0)";Page.show();f.draggables.container.addEventListener("mouseleave",()=>{if(1===n||3>J)n=f.canvas.style.opacity=0})}();
