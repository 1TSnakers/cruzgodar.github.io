!function(){"use strict";let e=1e3,r=0,t=1,a=-.866,l=-.5,n=.866,i=-.5,o=!1,s=!1,d=null,$=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D uTexture;
  
  const float dt = .001;
  
  uniform vec2 planet1;
  uniform vec2 planet2;
  uniform vec2 planet3;
  
  const float worldSize = 15.0;
  
  const float crashThreshhold = .02;
  
  const float G = 1.0;
  
  
  
  void main(void)
  {
   vec4 state = (texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5)) * worldSize;
   
   vec4 dState = vec4(0.0, 0.0, 0.0, 0.0);
   
   
   
   float dX = planet1.x - state.x;
   float dY = planet1.y - state.y;
   
   if (abs(dX) > worldSize / 2.0)
   {
    if (dX < 0.0)
    {
     dX += worldSize;
    }
    
    else
    {
     dX -= worldSize;
    }
   }
   
   if (abs(dY) > worldSize / 2.0)
   {
    if (dY < 0.0)
    {
     dY += worldSize;
    }
    
    else
    {
     dY -= worldSize;
    }
   }
   
   vec2 planetDirection = vec2(dX, dY);
   
   float r = length(planetDirection);
   
   if (r < crashThreshhold)
   {
    gl_FragColor = vec4(planet1 / worldSize + vec2(.5, .5), 0.5, 0.5);
    return;
   }
   
   dState.zw += planetDirection / (r*r*r);
   
   
   
   dX = planet2.x - state.x;
   dY = planet2.y - state.y;
   
   if (abs(dX) > worldSize / 2.0)
   {
    if (dX < 0.0)
    {
     dX += worldSize;
    }
    
    else
    {
     dX -= worldSize;
    }
   }
   
   if (abs(dY) > worldSize / 2.0)
   {
    if (dY < 0.0)
    {
     dY += worldSize;
    }
    
    else
    {
     dY -= worldSize;
    }
   }
   
   planetDirection = vec2(dX, dY);
   
   r = length(planetDirection);
   
   if (r < crashThreshhold)
   {
    gl_FragColor = vec4(planet2 / worldSize + vec2(.5, .5), 0.5, 0.5);
    return;
   }
   
   dState.zw += planetDirection / (r*r*r);
   
   
   
   dX = planet3.x - state.x;
   dY = planet3.y - state.y;
   
   if (abs(dX) > worldSize / 2.0)
   {
    if (dX < 0.0)
    {
     dX += worldSize;
    }
    
    else
    {
     dX -= worldSize;
    }
   }
   
   if (abs(dY) > worldSize / 2.0)
   {
    if (dY < 0.0)
    {
     dY += worldSize;
    }
    
    else
    {
     dY -= worldSize;
    }
   }
   
   planetDirection = vec2(dX, dY);
   
   r = length(planetDirection);
   
   if (r < crashThreshhold)
   {
    gl_FragColor = vec4(planet3 / worldSize + vec2(.5, .5), 0.5, 0.5);
    return;
   }
   
   dState.zw += planetDirection / (r*r*r);
   
   
   
   dState.xy = state.zw;
   
   state = ((dt * dState + state) / worldSize) + vec4(.5, .5, .5, .5);
   
   state.xy = fract(state.xy);
   
   gl_FragColor = state;
  }
 `,c=`
  precision highp float;
  precision highp sampler2D;
  
  varying vec2 uv;
  
  uniform sampler2D uTexture;
  
  
  
  vec3 hsv2rgb(vec3 c)
  {
   vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
   vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
   return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
  }
  
  
  
  void main(void)
  {
   vec4 state = (texture2D(uTexture, (uv + vec2(1.0, 1.0)) / 2.0) - vec4(.5, .5, .5, .5));
   
   float h = atan(state.y, state.x) / (2.0 * 3.14159265258) + .5;
   
   float s = min((state.x * state.x + state.y * state.y) * 100.0, 1.0);
   
   float vAdd = .9 * (1.0 - 4.0 * ((uv.x * uv.x) / 4.0 + (uv.y * uv.y) / 4.0));
   
   float v = clamp(sqrt(state.z * state.z + state.w * state.w) + vAdd, 0.0, 1.0);
   
   vec3 rgb = hsv2rgb(vec3(h, s, v));
   
   gl_FragColor = vec4(rgb, 1.0);
  }
 `,u={renderer:"gpu",shader:`
  precision highp float;
  
  varying vec2 uv;
  
  
  
  void main(void)
  {
   gl_FragColor = vec4((uv + vec2(1.0, 1.0)) / 2.0, 0.5, 0.5);
   
   return;
  }
 `,canvasWidth:e,canvasHeight:e,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"},f=new Wilson(Page.element.querySelector("#output-canvas"),u);f.render.loadNewShader($),f.render.initUniforms(["planet1","planet2","planet3"]),f.gl.uniform2f(f.uniforms.planet1,r,t),f.gl.uniform2f(f.uniforms.planet2,a,l),f.gl.uniform2f(f.uniforms.planet3,n,i),f.render.loadNewShader(c),f.render.createFramebufferTexturePair(),f.render.createFramebufferTexturePair();let g=Page.element.querySelector("#resolution-input");Page.element.querySelector("#generate-button").addEventListener("click",()=>{o=!1,d=Site.appletProcessId,e=parseInt(g.value||1e3),f.changeCanvasSize(e,e),f.gl.useProgram(f.render.shaderPrograms[1]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.texImage2D(f.gl.TEXTURE_2D,0,f.gl.RGBA,f.canvasWidth,f.canvasHeight,0,f.gl.RGBA,f.gl.FLOAT,null),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[1].texture),f.gl.texImage2D(f.gl.TEXTURE_2D,0,f.gl.RGBA,f.canvasWidth,f.canvasHeight,0,f.gl.RGBA,f.gl.FLOAT,null),f.gl.useProgram(f.render.shaderPrograms[0]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[0].framebuffer),f.render.drawFrame(),window.requestAnimationFrame(_),o=!0});let m=Page.element.querySelector("#switch-planet-drawer-canvas-button");m.style.transition="filter .125s ease-in-out, opacity .25s ease-in-out",m.addEventListener("click",()=>{s?(P(),window.requestAnimationFrame(P),m.style.opacity=0,setTimeout(()=>{m.textContent="Pick Particle",m.style.opacity=1},250)):(s=!0,m.style.opacity=0,setTimeout(()=>{m.textContent="Return to Fractal",m.style.opacity=1},250))});function _(e){let o=e-z;if(z=e,0!==o){if(f.gl.useProgram(f.render.shaderPrograms[1]),f.gl.uniform2f(f.uniforms.planet1,r,t),f.gl.uniform2f(f.uniforms.planet2,a,l),f.gl.uniform2f(f.uniforms.planet3,n,i),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[1].framebuffer),f.render.drawFrame(),f.gl.useProgram(f.render.shaderPrograms[2]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[1].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,null),f.render.drawFrame(),f.gl.useProgram(f.render.shaderPrograms[1]),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,f.render.framebuffers[0].framebuffer),f.render.drawFrame(),f.gl.useProgram(f.render.shaderPrograms[2]),f.gl.bindTexture(f.gl.TEXTURE_2D,f.render.framebuffers[0].texture),f.gl.bindFramebuffer(f.gl.FRAMEBUFFER,null),f.render.drawFrame(),d!==Site.appletProcessId){console.log("Terminated applet process");return}s||window.requestAnimationFrame(_)}}Page.element.querySelector("#download-button").addEventListener("click",()=>{f.downloadFrame("a-three-body-system.png")});let v=0,p=new Wilson(Page.element.querySelector("#planet-drawer-canvas"),{renderer:"cpu",worldWidth:15,worldHeight:15,canvasWidth:2e3,canvasHeight:2e3,mousemoveCallback:T,touchmoveCallback:T,mousedownCallback:E,touchendCallback:E,useDraggables:!0,draggablesMousemoveCallback:R,draggablesTouchmoveCallback:R});p.draggables.add(0,1),p.draggables.add(-.866,-.5),p.draggables.add(.866,-.5);let b=0,h=0,x=0,w=0,y=0,F=0,S=0,z=-1;function T(e,r,t,a,l){s&&(0===v&&o&&(s=!0,p.canvas.style.opacity=.5,v=1),2!==v&&(b=e,h=-r,x=0,w=0,window.requestAnimationFrame(D)))}function E(e,r,t){1===v&&(F=b,S=h,x=0,w=0,y=0,o&&(p.canvas.style.opacity=1,v=2,window.requestAnimationFrame(D)))}function P(){o&&(s=!1,window.requestAnimationFrame(_),p.canvas.style.opacity=0,v=0)}function D(e){let o=e-z;if(z=e,0===o)return;y++,p.ctx.fillStyle="rgb(0, 0, 0)",p.ctx.fillRect(0,0,2e3,2e3);let s=b/15,d=h/15,$=x/15,c=w/15,u,f=function e(r,t,a){let l,n,i,o,s,d,$,c;switch(o=Math.floor(6*r),s=6*r-o,d=a*(1-t),$=a*(1-s*t),c=a*(1-(1-s)*t),o%6){case 0:l=a,n=c,i=d;break;case 1:l=$,n=a,i=d;break;case 2:l=d,n=a,i=c;break;case 3:l=d,n=$,i=a;break;case 4:l=c,n=d,i=a;break;case 5:l=a,n=d,i=$}return[Math.round(255*l),Math.round(255*n),Math.round(255*i)]}(Math.atan2(d,-s)/(2*Math.PI)+1,Math.min(Math.min((s*s+d*d)*50,(1-Math.max(Math.abs(s),Math.abs(d)))*5),1),Math.min(Math.pow($*$+c*c,.5)+.9*((1-F/(2*Math.PI))*(1-F/(2*Math.PI))+(1-S/(2*Math.PI))*(1-S/(2*Math.PI)))*4,1));p.ctx.fillStyle=`rgb(${f[0]}, ${f[1]}, ${f[2]})`,p.ctx.beginPath(),p.ctx.arc(2e3*(s+.5),2e3*(d+.5),30,0,2*Math.PI,!1),p.ctx.fill(),2===v&&(function e(){let o=0,s=0,d=X(r,-t);if(o+=d[0],s+=d[1],d[2]<.1){b=r,h=-t,x=0,w=0;return}if(o+=(d=X(a,-l))[0],s+=d[1],d[2]<.1){b=a,h=-l,x=0,w=0;return}if(o+=(d=X(n,-i))[0],s+=d[1],d[2]<.1){b=n,h=-i,x=0,w=0;return}for(b+=.01*x,h+=.01*w,x+=.01*o,w+=.01*s;b<-7.5;)b+=15;for(;b>7.5;)b-=15;for(;h<-7.5;)h+=15;for(;h>7.5;)h-=15}(),window.requestAnimationFrame(D))}function X(e,r){let t=e-b,a=r-h,l=0;return Math.abs(t)>7.5&&(t<0?t+=15:t-=15),Math.abs(a)>7.5&&(a<0?a+=15:a-=15),l=Math.sqrt(t*t+a*a),[t/(l*l*l),a/(l*l*l),l]}function R(e,o,s,d){0===e?(r=o,t=s):1===e?(a=o,l=s):(n=o,i=s)}p.ctx.lineWidth=20,p.ctx.strokeStyle="rgb(127, 0, 255)",p.ctx.fillStyle="rgb(0, 0, 0)",Page.show(),p.draggables.container.addEventListener("mouseleave",()=>{(1===v||y<3)&&(p.canvas.style.opacity=0,v=0)})}();