!function(){"use strict";let e=300,t=300,o=300,r=4,a=document.querySelector("#quasi-fuchsian-groups-plot").getContext("2d",{alpha:!1}),u=[],n=[],s=null,l=[[2,0],[2,0]],i=[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]],[],[]],c=[],m=[],p=-1,d=document.querySelector("#coefficient-selector").offsetWidth,f=document.querySelector("#coefficient-selector").offsetHeight,h=17.5,g=!1,y=!0,q=20,b=10,v=0,w=0;document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("width",t),document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("height",o),n=[],u=[];for(let e=0;e<o;e++){n[e]=[],u[e]=[];for(let a=0;a<t;a++)v=e/o*r-r/2,w=r/2-a/t*r,n[e][a]=(Math.atan2(-w,-v)+Math.PI)/(2*Math.PI),u[e][a]=0}function P(){a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,t,o);let r=new Complex(l[0]),s=new Complex(l[1]),c=new Complex([0,0]);c=r.mul(s);let m=new Complex([0,0]);m=r.mul(r).add(s.mul(s));let p=new Complex([0,0]);p=c.mul(c).sub(m.mul(4)).arg()>0?c.sub(c.mul(c).sub(m.mul(4)).sqrt()).div(2):c.add(c.mul(c).sub(m.mul(4)).sqrt()).div(2);let d=new Complex([0,0]);d=p.sub(2).mul(s).div(s.mul(p).sub(r.mul(2)).add(p.mul(new Complex([0,2]))));let f=new Complex([0,0]);f=r.div(2),i[0][0][0]=f.re,i[0][0][1]=f.im,i[0][3][0]=f.re,i[0][3][1]=f.im,f=r.mul(p).sub(s.mul(2)).add(new Complex([0,4])).div(p.mul(2).add(4).mul(d)),i[0][1][0]=f.re,i[0][1][1]=f.im,f=r.mul(p).sub(s.mul(2)).sub(new Complex([0,4])).mul(d).div(p.mul(2).sub(4)),i[0][2][0]=f.re,i[0][2][1]=f.im,f=s.sub(new Complex([0,2])).div(2),i[1][0][0]=f.re,i[1][0][1]=f.im,f=s.div(2),i[1][1][0]=f.re,i[1][1][1]=f.im,i[1][2][0]=f.re,i[1][2][1]=f.im,f=s.add(new Complex([0,2])).div(2),i[1][3][0]=f.re,i[1][3][1]=f.im;for(let e=0;e<2;e++){let t=i[e][0][0],o=i[e][0][1],r=i[e][1][0],a=i[e][1][1],u=i[e][2][0],n=i[e][2][1],s=i[e][3][0],l=i[e][3][1];i[e+2]=[[s,l],[-r,-a],[-u,-n],[t,o]]}for(let e=0;e<4;e++)M(0,0,e,-1,-1,1);let h=u.flat().sort(function(e,t){return e-t}),q=h[h.length-1];if(300!==e)for(let e=1;e<o-1;e++)for(let o=1;o<t-1;o++)0!==u[e][o]&&0===u[e-1][o]&&0===u[e-1][o+1]&&0===u[e][o+1]&&0===u[e+1][o+1]&&0===u[e+1][o]&&0===u[e+1][o-1]&&0===u[e][o-1]&&0===u[e-1][o-1]&&(u[e][o]=0);let b=a.getImageData(0,0,t,o),v=b.data;for(let e=0;e<o;e++)for(let o=0;o<t;o++){let r=4*e*t+4*o,a=k(n[e][o],1,Math.pow(u[e][o]/q,.25));v[r]=a[0],v[r+1]=a[1],v[r+2]=a[2],v[r+3]=255}a.putImageData(b,0,0),g?(g=!1,window.requestAnimationFrame(P)):y=!0}function M(a,n,s,l,i,c){if(c!==q)for(let l=3;l<6;l++){v=a,w=n;let i=(s+l)%4;S(i);let m=0,p=0;if(t>=o?(m=Math.floor((r/2-w)/r*o),p=Math.floor((v/(t/o)+r/2)/r*t)):(m=Math.floor((t/o*-w+r/2)/r*o),p=Math.floor((v+r/2)/r*t)),m>=0&&m<o&&p>=0&&p<t){if(u[m][p]===b)continue;(c>10||300!==e)&&u[m][p]++}M(v,w,i,m,p,c+1)}}function S(e){let t=i[e][0][0],o=i[e][0][1],r=i[e][1][0],a=i[e][1][1],u=i[e][2][0],n=i[e][2][1],s=i[e][3][0],l=i[e][3][1],c=t*v-o*w+r,m=t*w+o*v+a,p=u*v-n*w+s,d=u*w+n*v+l,f=p*p+d*d;v=(c*p+m*d)/f,w=(m*p-c*d)/f}function _(){for(let e=0;e<2;e++)c.push(document.querySelector(`#coefficient-marker-${e}`));for(let e=0;e<2;e++){m.push([Math.floor(o/2),Math.floor(t/2)]);let r=0,a=0;t>=o?(r=m[e][0]/o*f,a=m[e][1]/(t/o)/t*d):(r=m[e][0]*(t/o)/o*f,a=m[e][1]/t*d),c[e].style.transform=`translate3d(${a-h}px, ${r-h}px, 0)`,c[e].classList.add("no-floating-footer")}window.addEventListener("resize",L),Page.temporary_handlers.resize.push(L),setTimeout(L,1e3),P()}function x(a){p=-1;for(let s=0;s<2;s++)if(a.target.id===`coefficient-marker-${s}`){a.preventDefault(),p=s,e=300,Page.Applets.Canvases.is_fullscreen?Page.Layout.aspect_ratio>=1?(t=e,o=Math.floor(e/Page.Layout.aspect_ratio)):(t=Math.floor(e*Page.Layout.aspect_ratio),o=e):(t=e,o=e),q=20,b=10,document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("width",t),document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("height",o),n=[],u=[];for(let e=0;e<o;e++){n[e]=[],u[e]=[];for(let a=0;a<t;a++)v=e/o*r-r/2,w=r/2-a/t*r,n[e][a]=(Math.atan2(-w,-v)+Math.PI)/(2*Math.PI),u[e][a]=0}g=!0,y&&(y=!1,window.requestAnimationFrame(P))}}function C(a){if(-1!==p){e=1e3,Page.Applets.Canvases.is_fullscreen?Page.Layout.aspect_ratio>=1?(t=e,o=Math.floor(e/Page.Layout.aspect_ratio)):(t=Math.floor(e*Page.Layout.aspect_ratio),o=e):(t=e,o=e),q=100,b=50,document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("width",t),document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("height",o),n=[],u=[];for(let e=0;e<o;e++){n[e]=[],u[e]=[];for(let a=0;a<t;a++)v=e/o*r-r/2,w=r/2-a/t*r,n[e][a]=(Math.atan2(-w,-v)+Math.PI)/(2*Math.PI),u[e][a]=0}g=!0,y&&(y=!1,window.requestAnimationFrame(P))}p=-1}function A(e){if(-1===p)return;let r=null,a=null,n=document.querySelector("#coefficient-selector").getBoundingClientRect();"touchmove"===e.type?(r=e.touches[0].clientY-n.top,a=e.touches[0].clientX-n.left):(r=e.clientY-n.top,a=e.clientX-n.left),r<h&&(r=h),r>f-h&&(r=f-h),a<h&&(a=h),a>d-h&&(a=d-h),c[p].style.transform=`translate3d(${a-h}px, ${r-h}px, 0)`,l[p][0]=a/d-.5+2,l[p][1]=1-r/f-.5;for(let e=0;e<o;e++)for(let o=0;o<t;o++)u[e][o]=0;g=!0,y&&(y=!1,window.requestAnimationFrame(P))}function L(){d=document.querySelector("#coefficient-selector").offsetWidth,f=document.querySelector("#coefficient-selector").offsetHeight;for(let e=0;e<2;e++){let t=Math.floor((1-(l[e][1]+.5))*f),o=Math.floor((l[e][0]-2+.5)*d);c[e].style.transform=`translate3d(${o-h}px, ${t-h}px, 0)`}P()}function k(e,t,o){let r,a,u,n,s,l,i,c;switch(l=o*(1-t),i=o*(1-(s=6*e-(n=Math.floor(6*e)))*t),c=o*(1-(1-s)*t),n%6){case 0:r=o,a=c,u=l;break;case 1:r=i,a=o,u=l;break;case 2:r=l,a=o,u=c;break;case 3:r=l,a=i,u=o;break;case 4:r=c,a=l,u=o;break;case 5:r=o,a=l,u=i}return[Math.round(255*r),Math.round(255*a),Math.round(255*u)]}Site.scripts_loaded.complexjs?_():Site.load_script("/scripts/complex.min.js").then(function(){Site.scripts_loaded.complexjs=!0,_()}).catch(function(e){console.error("Could not load ComplexJS")}),document.querySelector("#download-button").addEventListener("click",function(){e=parseInt(document.querySelector("#image-size-input").value||1e3),q=parseInt(document.querySelector("#max-depth-input").value||100),b=parseInt(document.querySelector("#max-pixel-brightness-input").value||50),Page.Applets.Canvases.is_fullscreen?Page.Layout.aspect_ratio>=1?(t=e,o=Math.floor(e/Page.Layout.aspect_ratio)):(t=Math.floor(e*Page.Layout.aspect_ratio),o=e):(t=e,o=e);n=[],u=[];for(let e=0;e<o;e++){n[e]=[],u[e]=[];for(let a=0;a<t;a++)v=e/o*r-r/2,w=r/2-a/t*r,n[e][a]=(Math.atan2(-w,-v)+Math.PI)/(2*Math.PI),u[e][a]=0}try{s.terminate()}catch(e){}s=DEBUG?new Worker("/applets/quasi-fuchsian-groups/scripts/worker.js"):new Worker("/applets/quasi-fuchsian-groups/scripts/worker.min.js");Page.temporary_web_workers.push(s),s.onmessage=function(e){u=e.data[0],document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("width",t),document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("height",o);let r=a.getImageData(0,0,t,o),s=r.data;for(let e=0;e<o;e++)for(let o=0;o<t;o++){let r=4*e*t+4*o,a=k(n[e][o],1,u[e][o]);s[r]=a[0],s[r+1]=a[1],s[r+2]=a[2],s[r+3]=255}a.putImageData(r,0,0),function(){let e=document.createElement("a");e.download="a-quasi-fuchsian-group.png",e.href=document.querySelector("#quasi-fuchsian-groups-plot").toDataURL(),e.click(),e.remove()}()},s.postMessage([t,o,q,b,r,i])}),function(){1===Site.Settings.url_vars.contrast&&(1===Site.Settings.url_vars.theme?document.querySelector("#quasi-fuchsian-groups-plot").style.borderColor="rgb(192, 192, 192)":document.querySelector("#quasi-fuchsian-groups-plot").style.borderColor="rgb(64, 64, 64)");Site.add_style("\n\t\t\t.coefficient-marker.hover\n\t\t\t{\n\t\t\t\tbackground-color: rgb(127, 127, 127);\t\n\t\t\t}\n\t\t\t\n\t\t\t.coefficient-marker:not(:hover):focus\n\t\t\t{\n\t\t\t\tbackground-color: rgb(127, 127, 127);\n\t\t\t\toutline: none;\n\t\t\t}\n\t\t",!0)}(),document.documentElement.addEventListener("touchstart",x,!1),document.documentElement.addEventListener("touchmove",A,!1),document.documentElement.addEventListener("touchend",C,!1),document.documentElement.addEventListener("mousedown",x,!1),document.documentElement.addEventListener("mousemove",A,!1),document.documentElement.addEventListener("mouseup",C,!1),Page.temporary_handlers.touchstart.push(x),Page.temporary_handlers.touchmove.push(A),Page.temporary_handlers.touchend.push(C),Page.temporary_handlers.mousedown.push(x),Page.temporary_handlers.mousemove.push(A),Page.temporary_handlers.mouseup.push(C),Page.Applets.Canvases.to_resize=[document.querySelector("#quasi-fuchsian-groups-plot"),document.querySelector("#coefficient-selector")],Page.Applets.Canvases.resize_callback=function(){e=300,Page.Applets.Canvases.is_fullscreen?Page.Layout.aspect_ratio>=1?(t=e,o=Math.floor(e/Page.Layout.aspect_ratio)):(t=Math.floor(e*Page.Layout.aspect_ratio),o=e):(t=e,o=e);for(let e=0;e<o;e++){n[e]=[],u[e]=[];for(let a=0;a<t;a++)v=e/o*r-r/2,w=r/2-a/t*r,n[e][a]=(Math.atan2(-w,-v)+Math.PI)/(2*Math.PI),u[e][a]=0}document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("width",t),document.querySelector("#quasi-fuchsian-groups-plot").setAttribute("height",o),L(),P()},Page.Applets.Canvases.true_fullscreen=!0,Page.Applets.Canvases.set_up_resizer()}();