!function(){"use strict";let e=500,a=1500,t={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:1,world_height:4,world_center_x:2,world_center_y:0,use_draggables:!0,draggables_mousedown_callback:P,draggables_touchstart_callback:P,draggables_mousemove_callback:q,draggables_touchmove_callback:q,draggables_mouseup_callback:M,draggables_touchend_callback:M,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:L},l=new Wilson(Page.element.querySelector("#output-canvas"),t),r=e,o=e,n=e,s=4,u=null,i=-1,c=[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]],[],[]],d=20,m=10,_=0,g=0,p=null,f=null,h=null;C(),Site.scripts_loaded.complexjs?x():Site.load_script("/scripts/complex.min.js").then(()=>{Site.scripts_loaded.complexjs=!0,x()}).catch(e=>{console.error("Could not load ComplexJS")});let w=Page.element.querySelector("#resolution-input");function b(a){let t=a-i;if(i=a,0===t)return;let s=new Complex(l.draggables.world_coordinates[0][0],l.draggables.world_coordinates[0][1]),u=new Complex(l.draggables.world_coordinates[1][0],l.draggables.world_coordinates[1][1]),d=new Complex([0,0]);d=s.mul(u);let m=new Complex([0,0]);m=s.mul(s).add(u.mul(u));let _=new Complex([0,0]);_=d.mul(d).sub(m.mul(4)).arg()>0?d.sub(d.mul(d).sub(m.mul(4)).sqrt()).div(2):d.add(d.mul(d).sub(m.mul(4)).sqrt()).div(2);let g=new Complex([0,0]);g=_.sub(2).mul(u).div(u.mul(_).sub(s.mul(2)).add(_.mul(new Complex([0,2]))));let w=new Complex([0,0]);w=s.div(2),c[0][0][0]=w.re,c[0][0][1]=w.im,c[0][3][0]=w.re,c[0][3][1]=w.im,w=s.mul(_).sub(u.mul(2)).add(new Complex([0,4])).div(_.mul(2).add(4).mul(g)),c[0][1][0]=w.re,c[0][1][1]=w.im,w=s.mul(_).sub(u.mul(2)).sub(new Complex([0,4])).mul(g).div(_.mul(2).sub(4)),c[0][2][0]=w.re,c[0][2][1]=w.im,w=u.sub(new Complex([0,2])).div(2),c[1][0][0]=w.re,c[1][0][1]=w.im,w=u.div(2),c[1][1][0]=w.re,c[1][1][1]=w.im,c[1][2][0]=w.re,c[1][2][1]=w.im,w=u.add(new Complex([0,2])).div(2),c[1][3][0]=w.re,c[1][3][1]=w.im;for(let e=0;e<2;e++){let a=c[e][0][0],t=c[e][0][1],l=c[e][1][0],r=c[e][1][1],o=c[e][2][0],n=c[e][2][1],s=c[e][3][0],u=c[e][3][1];c[e+2]=[[s,u],[-l,-r],[-o,-n],[a,t]]}for(let e=0;e<4;e++)y(0,0,e,-1,-1,1);let b=f.slice().sort((e,a)=>e-a),v=b[b.length-1];if(r!==e)for(let e=1;e<n-1;e++)for(let a=1;a<o-1;a++)0!==f[o*e+a]&&0===f[o*(e-1)+a]&&0===f[o*(e-1)+(a+1)]&&0===f[o*e+(a+1)]&&0===f[o*(e+1)+(a+1)]&&0===f[o*(e+1)+a]&&0===f[o*(e+1)+(a-1)]&&0===f[o*e+(a-1)]&&0===f[o*(e-1)+(a-1)]&&(f[o*e+a]=0);for(let e=0;e<n;e++)for(let a=0;a<o;a++){let t=4*e*o+4*a,r=l.utils.hsv_to_rgb(p[o*e+a],1,Math.pow(f[o*e+a]/v,.25));h[t]=r[0],h[t+1]=r[1],h[t+2]=r[2],h[t+3]=255}l.render.draw_frame(h)}function y(a,t,l,u,i,c){if(c!==d)for(let u=3;u<6;u++){_=a,g=t;let i=(l+u)%4;v(i);let d=0,p=0;if(o>=n?(d=Math.floor((s/2-g)/s*n),p=Math.floor((_/(o/n)+s/2)/s*o)):(d=Math.floor((o/n*-g+s/2)/s*n),p=Math.floor((_+s/2)/s*o)),d>=0&&d<n&&p>=0&&p<o){if(f[o*d+p]===m)continue;(c>10||r!==e)&&f[o*d+p]++}y(_,g,i,d,p,c+1)}}function v(e){let a=c[e][0][0],t=c[e][0][1],l=c[e][1][0],r=c[e][1][1],o=c[e][2][0],n=c[e][2][1],s=c[e][3][0],u=c[e][3][1],i=a*_-t*g+l,d=a*g+t*_+r,m=o*_-n*g+s,p=o*g+n*_+u,f=m*m+p*p;_=(i*m+d*p)/f,g=(d*m-i*p)/f}function x(){l.draggables.add(2,0),l.draggables.add(2,0),window.requestAnimationFrame(b)}function P(a,t,s,u){r=e,l.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=r,n=Math.floor(r/Page.Layout.aspect_ratio)):(o=Math.floor(r*Page.Layout.aspect_ratio),n=r):(o=r,n=r),d=20,m=10,l.change_canvas_size(o,n),C(),window.requestAnimationFrame(b)}function M(e,t,s,u){r=a,l.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=r,n=Math.floor(r/Page.Layout.aspect_ratio)):(o=Math.floor(r*Page.Layout.aspect_ratio),n=r):(o=r,n=r),d=100,m=50,l.change_canvas_size(o,n),C(),window.requestAnimationFrame(b)}function q(e,a,t,l){for(let e=0;e<n;e++)for(let a=0;a<o;a++)f[o*e+a]=0;window.requestAnimationFrame(b)}function C(){p=new Array(o*n),f=new Array(o*n),h=new Uint8ClampedArray(o*n*4);for(let e=0;e<n;e++)for(let a=0;a<o;a++)_=e/n*s-s/2,g=s/2-a/o*s,p[o*e+a]=(Math.atan2(-g,-_)+Math.PI)/(2*Math.PI),f[o*e+a]=0}function L(){r=e,l.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=r,n=Math.floor(r/Page.Layout.aspect_ratio)):(o=Math.floor(r*Page.Layout.aspect_ratio),n=r):(o=r,n=r),l.change_canvas_size(o,n),C(),window.requestAnimationFrame(b)}w.addEventListener("input",()=>{e=Math.max(parseInt(w.value||500),100),a=3*e,L()}),Page.element.querySelector("#download-button").addEventListener("click",function(){r=parseInt(Page.element.querySelector("#high-res-resolution-input").value||1e3),d=parseInt(Page.element.querySelector("#max-depth-input").value||100),m=parseInt(Page.element.querySelector("#max-pixel-brightness-input").value||50),l.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=r,n=Math.floor(r/Page.Layout.aspect_ratio)):(o=Math.floor(r*Page.Layout.aspect_ratio),n=r):(o=r,n=r);C();try{u.terminate()}catch(e){}u=DEBUG?new Worker("/applets/quasi-fuchsian-groups/scripts/worker.js"):new Worker("/applets/quasi-fuchsian-groups/scripts/worker.min.js");Page.temporary_web_workers.push(u),u.onmessage=function(e){f=e.data[0],l.change_canvas_size(o,n);for(let e=0;e<n;e++)for(let a=0;a<o;a++){let t=4*e*o+4*a,r=l.utils.hsv_to_rgb(p[o*e+a],1,f[o*e+a]);h[t]=r[0],h[t+1]=r[1],h[t+2]=r[2],h[t+3]=255}l.render.draw_frame(h),l.download_frame("a-quasi-fuchsian-group.png")},u.postMessage([o,n,d,m,s,c])}),Page.show()}();