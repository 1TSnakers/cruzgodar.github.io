!function(){"use strict";let e=500,t=1500,a={renderer:"hybrid",canvas_width:e,canvas_height:e,world_width:1,world_height:4,world_center_x:2,world_center_y:0,use_draggables:!0,draggables_mousedown_callback:M,draggables_touchstart_callback:M,draggables_mousemove_callback:C,draggables_touchmove_callback:C,draggables_mouseup_callback:q,draggables_touchend_callback:q,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:L},r=new Wilson(document.querySelector("#output-canvas"),a),l=e,o=e,n=e,u=4,s=null,i=-1,c=[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]],[],[]],d=20,m=10,_=0,p=0,f=null,g=null,h=null;P(),Site.scripts_loaded.complexjs?x():Site.load_script("/scripts/complex.min.js").then(()=>{Site.scripts_loaded.complexjs=!0,x()}).catch(e=>{console.error("Could not load ComplexJS")});let w=document.querySelector("#resolution-input");function b(t){let a=t-i;if(i=t,0===a)return;let u=new Complex(r.draggables.world_coordinates[0][0],r.draggables.world_coordinates[0][1]),s=new Complex(r.draggables.world_coordinates[1][0],r.draggables.world_coordinates[1][1]),d=new Complex([0,0]);d=u.mul(s);let m=new Complex([0,0]);m=u.mul(u).add(s.mul(s));let _=new Complex([0,0]);_=d.mul(d).sub(m.mul(4)).arg()>0?d.sub(d.mul(d).sub(m.mul(4)).sqrt()).div(2):d.add(d.mul(d).sub(m.mul(4)).sqrt()).div(2);let p=new Complex([0,0]);p=_.sub(2).mul(s).div(s.mul(_).sub(u.mul(2)).add(_.mul(new Complex([0,2]))));let w=new Complex([0,0]);w=u.div(2),c[0][0][0]=w.re,c[0][0][1]=w.im,c[0][3][0]=w.re,c[0][3][1]=w.im,w=u.mul(_).sub(s.mul(2)).add(new Complex([0,4])).div(_.mul(2).add(4).mul(p)),c[0][1][0]=w.re,c[0][1][1]=w.im,w=u.mul(_).sub(s.mul(2)).sub(new Complex([0,4])).mul(p).div(_.mul(2).sub(4)),c[0][2][0]=w.re,c[0][2][1]=w.im,w=s.sub(new Complex([0,2])).div(2),c[1][0][0]=w.re,c[1][0][1]=w.im,w=s.div(2),c[1][1][0]=w.re,c[1][1][1]=w.im,c[1][2][0]=w.re,c[1][2][1]=w.im,w=s.add(new Complex([0,2])).div(2),c[1][3][0]=w.re,c[1][3][1]=w.im;for(let e=0;e<2;e++){let t=c[e][0][0],a=c[e][0][1],r=c[e][1][0],l=c[e][1][1],o=c[e][2][0],n=c[e][2][1],u=c[e][3][0],s=c[e][3][1];c[e+2]=[[u,s],[-r,-l],[-o,-n],[t,a]]}for(let e=0;e<4;e++)y(0,0,e,-1,-1,1);let b=g.slice().sort((e,t)=>e-t),v=b[b.length-1];if(l!==e)for(let e=1;e<n-1;e++)for(let t=1;t<o-1;t++)0!==g[o*e+t]&&0===g[o*(e-1)+t]&&0===g[o*(e-1)+(t+1)]&&0===g[o*e+(t+1)]&&0===g[o*(e+1)+(t+1)]&&0===g[o*(e+1)+t]&&0===g[o*(e+1)+(t-1)]&&0===g[o*e+(t-1)]&&0===g[o*(e-1)+(t-1)]&&(g[o*e+t]=0);for(let e=0;e<n;e++)for(let t=0;t<o;t++){let a=4*e*o+4*t,l=r.utils.hsv_to_rgb(f[o*e+t],1,Math.pow(g[o*e+t]/v,.25));h[a]=l[0],h[a+1]=l[1],h[a+2]=l[2],h[a+3]=255}r.render.draw_frame(h)}function y(t,a,r,s,i,c){if(c!==d)for(let s=3;s<6;s++){_=t,p=a;let i=(r+s)%4;v(i);let d=0,f=0;if(o>=n?(d=Math.floor((u/2-p)/u*n),f=Math.floor((_/(o/n)+u/2)/u*o)):(d=Math.floor((o/n*-p+u/2)/u*n),f=Math.floor((_+u/2)/u*o)),d>=0&&d<n&&f>=0&&f<o){if(g[o*d+f]===m)continue;(c>10||l!==e)&&g[o*d+f]++}y(_,p,i,d,f,c+1)}}function v(e){let t=c[e][0][0],a=c[e][0][1],r=c[e][1][0],l=c[e][1][1],o=c[e][2][0],n=c[e][2][1],u=c[e][3][0],s=c[e][3][1],i=t*_-a*p+r,d=t*p+a*_+l,m=o*_-n*p+u,f=o*p+n*_+s,g=m*m+f*f;_=(i*m+d*f)/g,p=(d*m-i*f)/g}function x(){r.draggables.add(2,0),r.draggables.add(2,0),window.requestAnimationFrame(b)}function M(t,a,u,s){l=e,r.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=l,n=Math.floor(l/Page.Layout.aspect_ratio)):(o=Math.floor(l*Page.Layout.aspect_ratio),n=l):(o=l,n=l),d=20,m=10,r.change_canvas_size(o,n),P(),window.requestAnimationFrame(b)}function q(e,a,u,s){l=t,r.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=l,n=Math.floor(l/Page.Layout.aspect_ratio)):(o=Math.floor(l*Page.Layout.aspect_ratio),n=l):(o=l,n=l),d=100,m=50,r.change_canvas_size(o,n),P(),window.requestAnimationFrame(b)}function C(e,t,a,r){for(let e=0;e<n;e++)for(let t=0;t<o;t++)g[o*e+t]=0;window.requestAnimationFrame(b)}function P(){f=new Array(o*n),g=new Array(o*n),h=new Uint8ClampedArray(o*n*4);for(let e=0;e<n;e++)for(let t=0;t<o;t++)_=e/n*u-u/2,p=u/2-t/o*u,f[o*e+t]=(Math.atan2(-p,-_)+Math.PI)/(2*Math.PI),g[o*e+t]=0}function L(){l=e,r.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=l,n=Math.floor(l/Page.Layout.aspect_ratio)):(o=Math.floor(l*Page.Layout.aspect_ratio),n=l):(o=l,n=l),r.change_canvas_size(o,n),P(),window.requestAnimationFrame(b)}w.addEventListener("input",()=>{e=Math.max(parseInt(w.value||500),100),t=3*e,L()}),document.querySelector("#download-button").addEventListener("click",function(){l=parseInt(document.querySelector("#high-res-resolution-input").value||1e3),d=parseInt(document.querySelector("#max-depth-input").value||100),m=parseInt(document.querySelector("#max-pixel-brightness-input").value||50),r.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?(o=l,n=Math.floor(l/Page.Layout.aspect_ratio)):(o=Math.floor(l*Page.Layout.aspect_ratio),n=l):(o=l,n=l);P();try{s.terminate()}catch(e){}s=DEBUG?new Worker("/applets/quasi-fuchsian-groups/scripts/worker.js"):new Worker("/applets/quasi-fuchsian-groups/scripts/worker.min.js");Page.temporary_web_workers.push(s),s.onmessage=function(e){g=e.data[0],r.change_canvas_size(o,n);for(let e=0;e<n;e++)for(let t=0;t<o;t++){let a=4*e*o+4*t,l=r.utils.hsv_to_rgb(f[o*e+t],1,g[o*e+t]);h[a]=l[0],h[a+1]=l[1],h[a+2]=l[2],h[a+3]=255}r.render.draw_frame(h),r.download_frame("a-quasi-fuchsian-group.png")},s.postMessage([o,n,d,m,u,c])})}();