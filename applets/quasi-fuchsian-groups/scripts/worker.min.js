onmessage=async function(a){canvasWidth=a.data[0];canvasHeight=a.data[1];maxDepth=a.data[2];maxPixelBrightness=a.data[3];boxSize=a.data[4];coefficients=a.data[5];await drawQuasiFuchsianGroup()};let canvasWidth=null,canvasHeight=null,maxDepth=null,maxPixelBrightness=null,boxSize=null,coefficients=[],brightness=[],x=0,y=0;
function drawQuasiFuchsianGroup(){return new Promise(async function(a,b){brightness=Array(canvasWidth*canvasHeight);for(b=0;b<brightness.length;b++)brightness[b]=0;for(b=0;4>b;b++)searchStep(0,0,b,-1,-1,1);b=0;for(var c=0;c<brightness.length;c++)b=Math.max(b,brightness[c]);for(c=0;c<brightness.length;c++)brightness[c]=Math.pow(brightness[c]/b,.15);postMessage([brightness]);a()})}
function searchStep(a,b,c,d,g,h){if(h!==maxDepth)for(d=3;6>d;d++){x=a;y=b;g=(c+d)%4;applyTransformation(g);let e,f;canvasWidth>=canvasHeight?(e=Math.floor((-y+boxSize/2)/boxSize*canvasHeight),f=Math.floor((x/(canvasWidth/canvasHeight)+boxSize/2)/boxSize*canvasWidth)):(e=Math.floor((canvasWidth/canvasHeight*-y+boxSize/2)/boxSize*canvasHeight),f=Math.floor((x+boxSize/2)/boxSize*canvasWidth));if(0<=e&&e<canvasHeight&&0<=f&&f<canvasWidth){if(brightness[canvasWidth*e+f]===maxPixelBrightness)continue;brightness[canvasWidth*
e+f]++}searchStep(x,y,g,e,f,h+1)}}function applyTransformation(a){var b=coefficients[a][0][0],c=coefficients[a][0][1],d=coefficients[a][2][0];let g=coefficients[a][2][1],h=b*x-c*y+coefficients[a][1][0];b=b*y+c*x+coefficients[a][1][1];c=d*x-g*y+coefficients[a][3][0];a=d*y+g*x+coefficients[a][3][1];d=c*c+a*a;x=(h*c+b*a)/d;y=(b*c-h*a)/d};
