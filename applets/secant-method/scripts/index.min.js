!function(){"use strict";let e=`
  precision highp float;
  
  varying vec2 uv;
  
  uniform float aspectRatio;
  
  uniform float worldCenterX;
  uniform float worldCenterY;
  uniform float worldSize;
  
  uniform int numRoots;
  
  uniform vec2 roots[11];
  
  uniform vec3 colors[11];
  
  uniform vec2 a;
  uniform vec2 c;
  
  uniform float brightnessScale;
  
  const float threshhold = .05;
  
  
  
  //Returns z1 * z2.
  vec2 cmul(vec2 z1, vec2 z2)
  {
   return vec2(z1.x * z2.x - z1.y * z2.y, z1.x * z2.y + z1.y * z2.x);
  }
  
  
  
  //Returns 1/z.
  vec2 cinv(vec2 z)
  {
   float magnitude = z.x*z.x + z.y*z.y;
   
   return vec2(z.x / magnitude, -z.y / magnitude);
  }
  
  
  
  //Returns f(z) for a polynomial f with given roots.
  vec2 cpoly(vec2 z)
  {
   vec2 result = vec2(1.0, 0.0);
   
   for (int i = 0; i <= 11; i++)
   {
    if (i == numRoots)
    {
     return result;
    }
    
    result = cmul(result, z - roots[i]);
   }
  }
  
  
  
  //Approximates f'(z) for a polynomial f with given roots.
  vec2 cderiv(vec2 z)
  {
   return 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));
  }
  
  
  
  void main(void)
  {
   vec2 z;
   vec2 lastZ = vec2(0.0, 0.0);
   
   if (aspectRatio >= 1.0)
   {
    z = vec2(uv.x * aspectRatio * worldSize + worldCenterX, uv.y * worldSize + worldCenterY);
   }
   
   else
   {
    z = vec2(uv.x * worldSize + worldCenterX, uv.y / aspectRatio * worldSize + worldCenterY);
   }
   
   gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
   
   
   
   for (int iteration = 0; iteration < 100; iteration++)
   {
    vec2 temp = cmul(cmul(cpoly(z), cmul(z - lastZ, cinv(cpoly(z) - cpoly(lastZ)))), a) + c;
    
    lastZ = z;
    
    z -= temp;
    
    
    
    for (int i = 0; i <= 11; i++)
    {
     if (i == numRoots)
     {
      break;
     }
     
     float d0 = length(z - roots[i]);
     
     if (d0 < threshhold)
     {
      float d1 = length(lastZ - roots[i]);
      
      float brightnessAdjust = (log(threshhold) - log(d0)) / (log(d1) - log(d0));
      
      float brightness = 1.0 - (float(iteration) - brightnessAdjust) / brightnessScale;
      
      gl_FragColor = vec4(colors[i] * brightness, 1.0);
      
      return;
     }
    }
   }
  }
 `,r=new Wilson($("#output-canvas"),{renderer:"gpu",shader:e,canvasWidth:500,canvasHeight:500,worldWidth:3,worldHeight:3,worldCenterX:0,worldCenterY:0,useDraggables:!0,draggablesMousemoveCallback:Z,draggablesTouchmoveCallback:Z,draggablesMouseupCallback:T,draggablesTouchendCallback:T,useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:B,mousedownCallback:Y,touchstartCallback:Y,mousedragCallback:E,touchmoveCallback:E,mouseupCallback:I,touchendCallback:I,wheelCallback:function e(r,o,t,n){f=r,w=o,.3>Math.abs(t/100)?m+=t/100:z+=.05*Math.sign(t),P()},pinchCallback:function e(o,t,n,l){s>=1?(m-=n/r.worldWidth*10,p=-n/r.worldWidth*10):(m-=n/r.worldHeight*10,p=-n/r.worldHeight*10),f=o,w=t,P()}});r.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","numRoots","roots","colors","a","c","brightnessScale"]);let o=new Wilson($("#hidden-canvas"),{renderer:"gpu",shader:e,canvasWidth:100,canvasHeight:100});o.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","numRoots","roots","colors","a","c","brightnessScale"]);let t=[1,0],n=[0,0],l=[],i=0,a=0,s=1,u=!1,$=0,d=[],c=[],m=0,_=[],g=500,f=0,w=0,v=0,h=0,p=0,b=0,C=0,z=0,y=-1,S=r.draggables.add(1,0);S.classList.add("a-marker"),(S=r.draggables.add(0,0)).classList.add("c-marker"),W(),W(),W(),H(!0);let q=$("#resolution-input");q.addEventListener("input",()=>{g=parseInt(q.value||500),r.changeCanvasSize(g,g),window.requestAnimationFrame(O)});$("#add-root-button").addEventListener("click",W);$("#remove-root-button").addEventListener("click",function e(){1!==a&&(a--,l.pop(),l.pop(),r.draggables.draggables[a+2].remove(),r.draggables.draggables.pop(),r.draggables.worldCoordinates.pop(),r.draggables.numDraggables--,window.requestAnimationFrame(O))});$("#spread-roots-button").addEventListener("click",()=>H(!1,!1));$("#randomize-roots-button").addEventListener("click",()=>H(!1,!0));$("#download-button").addEventListener("click",()=>{r.downloadFrame("newtons-method.png")});let F=$("#root-a-input"),A=$("#root-b-input");F.addEventListener("input",X),A.addEventListener("input",X);let k=$("#root-color-input");k.addEventListener("input",function e(){var t;if(i<2)return;let n,l=i-2,a=(t=k.value,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null),s=a.r/255,u=a.g/255,$=a.b/255;a.r=x[3*l],a.g=x[3*l+1],a.b=x[3*l+2],anime({targets:a,r:s,g:u,b:$,easing:"easeInOutQuad",duration:250,update(){x[3*l]=a.r,x[3*l+1]=a.g,x[3*l+2]=a.b,r.gl.uniform3fv(r.uniforms.colors,x),o.gl.uniform3fv(o.uniforms.colors,x),window.requestAnimationFrame(O)}})});let R=$("#root-setter"),L=$("#color-setter");r.gl.uniform1f(r.uniforms.aspectRatio,1);let x=[216/255,1/255,42/255,1,139/255,56/255,249/255,239/255,20/255,27/255,181/255,61/255,0,86/255,195/255,154/255,82/255,164/255,32/255,32/255,32/255,155/255,92/255,15/255,182/255,228/255,254/255,250/255,195/255,218/255,1,1,1];function W(){if(11===a)return;let e=3*Math.random()-1.5,o=3*Math.random()-1.5;r.draggables.add(e,o),l.push(e),l.push(o),a++,window.requestAnimationFrame(O)}function H(e=!1,o=!1){if(!u){u=!0,$=0,d=JSON.parse(JSON.stringify(l));for(let t=0;t<a;t++){let n=1;o&&(n+=.75*Math.random()),c[2*t]=n*Math.cos(2*Math.PI*t/a)-l[2*t],c[2*t+1]=n*Math.sin(2*Math.PI*t/a)-l[2*t+1]}if(e){u=!1;for(let i=0;i<a;i++)l[2*i]=d[2*i]+c[2*i],l[2*i+1]=d[2*i+1]+c[2*i+1],r.draggables.worldCoordinates[i+2]=[l[2*i],l[2*i+1]];r.draggables.recalculateLocations()}window.requestAnimationFrame(O)}}function X(){0===i?(t[0]=parseFloat(F.value||1),t[1]=parseFloat(A.value||0),r.draggables.worldCoordinates[0]=[t[0],t[1]]):1===i?(n[0]=10*parseFloat(F.value||0),n[1]=10*parseFloat(A.value||0),r.draggables.worldCoordinates[1]=[n[0],n[1]]):(l[2*(i-2)]=parseFloat(F.value||0),l[2*(i-2)+1]=parseFloat(A.value||0),r.draggables.worldCoordinates[i-2]=[l[2*(i-2)],l[2*(i-2)+1]]),window.requestAnimationFrame(O),r.draggables.recalculateLocations()}function Y(e,r,o){b=0,C=0,z=0,v=0,h=0,p=0}function E(e,o,t,n,l){r.worldCenterX-=t,r.worldCenterY-=n,v=-t/r.worldWidth,h=-n/r.worldHeight,window.requestAnimationFrame(O),r.draggables.recalculateLocations()}function I(e,r,o){Math.sqrt(v*v+h*h)>=.0025&&(b=v,C=h),Math.abs(p)>=.01&&(z=p),window.requestAnimationFrame(O)}function P(){if(s>=1){let e=r.input.getZoomedWorldCenter(f,w,3*Math.pow(2,m)*s,3*Math.pow(2,m));r.worldWidth=3*Math.pow(2,m)*s,r.worldHeight=3*Math.pow(2,m),r.worldCenterX=e[0],r.worldCenterY=e[1]}else{let o=r.input.getZoomedWorldCenter(f,w,3*Math.pow(2,m),3*Math.pow(2,m)/s);r.worldWidth=3*Math.pow(2,m),r.worldHeight=3*Math.pow(2,m)/s,r.worldCenterX=o[0],r.worldCenterY=o[1]}window.requestAnimationFrame(O),r.draggables.recalculateLocations()}function Z(e,r,o,i){0===e?t=[r,o]:1===e?n=[r,o]:(l[2*(e-2)]=r,l[2*(e-2)+1]=o),window.requestAnimationFrame(O)}function T(e,r,o,a){Page.Animate.changeOpacity(R,0,Site.opacityAnimationTime),Page.Animate.changeOpacity(L,0,Site.opacityAnimationTime).then(()=>{if(0===(i=e))F.value=Math.round(1e3*t[0])/1e3,A.value=Math.round(1e3*t[1])/1e3;else if(1===i)F.value=Math.round(1e3*n[0])/1e4,A.value=Math.round(1e3*n[1])/1e4;else{var r,o,a;let s=i-2;F.value=Math.round(1e3*l[2*s])/1e3,A.value=Math.round(1e3*l[2*s+1])/1e3,k.value=(r=255*x[3*s],o=255*x[3*s+1],a=255*x[3*s+2],"#"+D(r)+D(o)+D(a))}Page.Animate.changeOpacity(R,1,Site.opacityAnimationTime),Page.Animate.changeOpacity(L,1,Site.opacityAnimationTime)})}function O(e){let i=e-y;if(y=e,0===i)return;o.gl.uniform1f(o.uniforms.aspectRatio,s),o.gl.uniform1f(o.uniforms.worldCenterX,r.worldCenterX),o.gl.uniform1f(o.uniforms.worldCenterY,r.worldCenterY),o.gl.uniform1f(o.uniforms.worldSize,Math.min(r.worldHeight,r.worldWidth)/2),o.gl.uniform1i(o.uniforms.numRoots,a),o.gl.uniform2fv(o.uniforms.roots,l),o.gl.uniform2fv(o.uniforms.a,t),o.gl.uniform2f(o.uniforms.c,n[0]/10,n[1]/10),o.gl.uniform1f(o.uniforms.brightnessScale,30),o.render.drawFrame();let g=o.render.getPixelData(),S=Array(1e4);for(let q=0;q<1e4;q++)S[q]=Math.max(Math.max(g[4*q],g[4*q+1]),g[4*q+2]);S.sort((e,r)=>e-r);let F=Math.min(1e4/(S[Math.floor(9600)]+S[Math.floor(9800)]),200);_.push(F);let A=_.length;A>10&&_.shift(),F=Math.max(_.reduce((e,r)=>e+r)/A,.5),r.gl.uniform1f(r.uniforms.aspectRatio,s),r.gl.uniform1f(r.uniforms.worldCenterX,r.worldCenterX),r.gl.uniform1f(r.uniforms.worldCenterY,r.worldCenterY),r.gl.uniform1f(r.uniforms.worldSize,Math.min(r.worldHeight,r.worldWidth)/2),r.gl.uniform1i(r.uniforms.numRoots,a),r.gl.uniform2fv(r.uniforms.roots,l),r.gl.uniform2fv(r.uniforms.a,t),r.gl.uniform2f(r.uniforms.c,n[0]/10,n[1]/10),r.gl.uniform1f(r.uniforms.brightnessScale,F),r.render.drawFrame(),u&&function e(){let o=.5*Math.sin(Math.PI*$/120-Math.PI/2)+.5;for(let t=0;t<a;t++)l[2*t]=d[2*t]+c[2*t]*o,l[2*t+1]=d[2*t+1]+c[2*t+1]*o,r.draggables.worldCoordinates[t+2]=[l[2*t],l[2*t+1]];window.requestAnimationFrame(O),r.draggables.recalculateLocations(),121==++$&&(u=!1)}(),i>=50&&(b=0,C=0,z=0,v=0,h=0,p=0),(0!==b||0!==C||0!==z)&&(r.worldCenterX+=b*r.worldWidth,r.worldCenterY+=C*r.worldHeight,25e-5>Math.sqrt((b*=.96)*b+(C*=.96)*C)&&(b=0,C=0),m+=z,P(f,w),.001>Math.abs(z*=.93)&&(z=0),window.requestAnimationFrame(O),r.draggables.recalculateLocations())}function B(){r.fullscreen.currentlyFullscreen?(s=window.innerWidth/window.innerHeight)>=1?(r.changeCanvasSize(g,Math.floor(g/s)),r.worldWidth=3*Math.pow(2,m)*s,r.worldHeight=3*Math.pow(2,m)):(r.changeCanvasSize(Math.floor(g*s),g),r.worldWidth=3*Math.pow(2,m),r.worldHeight=3*Math.pow(2,m)/s):(s=1,r.changeCanvasSize(g,g),r.worldWidth=3*Math.pow(2,m),r.worldHeight=3*Math.pow(2,m)),window.requestAnimationFrame(O)}function D(e){let r=e.toString(16);return 1==r.length?"0"+r:r}r.gl.uniform3fv(r.uniforms.colors,x),o.gl.uniform3fv(o.uniforms.colors,x),window.requestAnimationFrame(O),Page.show(),window.addEventListener("resize",B),Page.temporaryHandlers.resize.push(B)}();