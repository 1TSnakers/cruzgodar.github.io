!function(){"use strict";let e=`
  precision highp float;
  
  varying vec2 uv;
  
  uniform float aspect_ratio;
  
  uniform float world_center_x;
  uniform float world_center_y;
  uniform float world_size;
  
  uniform int num_roots;
  
  uniform vec2 roots[11];
  
  uniform vec3 colors[11];
  
  uniform vec2 a;
  uniform vec2 c;
  
  uniform float brightness_scale;
  
  const float threshhold = .05;
  
  
  
  //Returns z_1 * z_2.
  vec2 cmul(vec2 z_1, vec2 z_2)
  {
   return vec2(z_1.x * z_2.x - z_1.y * z_2.y, z_1.x * z_2.y + z_1.y * z_2.x);
  }
  
  
  
  //Returns 1/z.
  vec2 cinv(vec2 z)
  {
   float magnitude = z.x*z.x + z.y*z.y;
   
   return vec2(z.x / magnitude, -z.y / magnitude);
  }
  
  
  
  //Returns f(z) for a polynomial f with given roots.
  vec2 cpoly(vec2 z)
  {
   vec2 result = vec2(1.0, 0.0);
   
   for (int i = 0; i <= 11; i++)
   {
    if (i == num_roots)
    {
     return result;
    }
    
    result = cmul(result, z - roots[i]);
   }
  }
  
  
  
  //Approximates f'(z) for a polynomial f with given roots.
  vec2 cderiv(vec2 z)
  {
   return 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));
  }
  
  
  
  void main(void)
  {
   vec2 z;
   vec2 last_z = vec2(0.0, 0.0);
   
   if (aspect_ratio >= 1.0)
   {
    z = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);
   }
   
   else
   {
    z = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);
   }
   
   gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
   
   
   
   for (int iteration = 0; iteration < 100; iteration++)
   {
    vec2 temp = cmul(cmul(cpoly(z), cmul(z - last_z, cinv(cpoly(z) - cpoly(last_z)))), a) + c;
    
    last_z = z;
    
    z -= temp;
    
    
    
    for (int i = 0; i <= 11; i++)
    {
     if (i == num_roots)
     {
      break;
     }
     
     float d_0 = length(z - roots[i]);
     
     if (d_0 < threshhold)
     {
      float d_1 = length(last_z - roots[i]);
      
      float brightness_adjust = (log(threshhold) - log(d_0)) / (log(d_1) - log(d_0));
      
      float brightness = 1.0 - (float(iteration) - brightness_adjust) / brightness_scale;
      
      gl_FragColor = vec4(colors[i] * brightness, 1.0);
      
      return;
     }
    }
   }
  }
 `,r=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"gpu",shader:e,canvas_width:500,canvas_height:500,world_width:3,world_height:3,world_center_x:0,world_center_y:0,use_draggables:!0,draggables_mousemove_callback:W,draggables_touchmove_callback:W,draggables_mouseup_callback:B,draggables_touchend_callback:B,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:G,mousedown_callback:C,touchstart_callback:C,mousedrag_callback:H,touchmove_callback:H,mouseup_callback:O,touchend_callback:O,wheel_callback:function e(r,o,t,n){g=r,w=o,.3>Math.abs(t/100)?m+=t/100:y+=.05*Math.sign(t),Q()},pinch_callback:function e(o,t,n,l){s>=1?(m-=n/r.world_width*10,p=-n/r.world_width*10):(m-=n/r.world_height*10,p=-n/r.world_height*10),g=o,w=t,Q()}});r.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let o=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"gpu",shader:e,canvas_width:100,canvas_height:100});o.render.init_uniforms(["aspect_ratio","world_center_x","world_center_y","world_size","num_roots","roots","colors","a","c","brightness_scale"]);let t=[1,0],n=[0,0],l=[],a=0,i=0,s=1,c=!1,u=0,d=[],$=[],m=0,f=[],_=500,g=0,w=0,h=0,v=0,p=0,b=0,z=0,y=0,x=-1,q=r.draggables.add(1,0);q.classList.add("a-marker"),(q=r.draggables.add(0,0)).classList.add("c-marker"),P(),P(),P(),R(!0);let k=Page.element.querySelector("#resolution-input");k.addEventListener("input",()=>{_=parseInt(k.value||500),r.change_canvas_size(_,_),window.requestAnimationFrame(D)});Page.element.querySelector("#add-root-button").addEventListener("click",P);Page.element.querySelector("#remove-root-button").addEventListener("click",function e(){1!==i&&(i--,l.pop(),l.pop(),r.draggables.draggables[i+2].remove(),r.draggables.draggables.pop(),r.draggables.world_coordinates.pop(),r.draggables.num_draggables--,window.requestAnimationFrame(D))});Page.element.querySelector("#spread-roots-button").addEventListener("click",()=>R(!1,!1));Page.element.querySelector("#randomize-roots-button").addEventListener("click",()=>R(!1,!0));Page.element.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("newtons-method.png")});let A=Page.element.querySelector("#root-a-input"),F=Page.element.querySelector("#root-b-input");A.addEventListener("input",j),F.addEventListener("input",j);let S=Page.element.querySelector("#root-color-input");S.addEventListener("input",function e(){var t;if(a<2)return;let n,l=a-2,i=(t=S.value,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null),s=i.r/255,c=i.g/255,u=i.b/255;i.r=I[3*l],i.g=I[3*l+1],i.b=I[3*l+2],anime({targets:i,r:s,g:c,b:u,easing:"easeInOutQuad",duration:250,update(){I[3*l]=i.r,I[3*l+1]=i.g,I[3*l+2]=i.b,r.gl.uniform3fv(r.uniforms.colors,I),o.gl.uniform3fv(o.uniforms.colors,I),window.requestAnimationFrame(D)}})});let L=Page.element.querySelector("#root-setter"),E=Page.element.querySelector("#color-setter");r.gl.uniform1f(r.uniforms.aspect_ratio,1);let I=[216/255,1/255,42/255,1,139/255,56/255,249/255,239/255,20/255,27/255,181/255,61/255,0,86/255,195/255,154/255,82/255,164/255,32/255,32/255,32/255,155/255,92/255,15/255,182/255,228/255,254/255,250/255,195/255,218/255,1,1,1];function P(){if(11===i)return;let e=3*Math.random()-1.5,o=3*Math.random()-1.5;r.draggables.add(e,o),l.push(e),l.push(o),i++,window.requestAnimationFrame(D)}function R(e=!1,o=!1){if(!c){c=!0,u=0,d=JSON.parse(JSON.stringify(l));for(let t=0;t<i;t++){let n=1;o&&(n+=.75*Math.random()),$[2*t]=n*Math.cos(2*Math.PI*t/i)-l[2*t],$[2*t+1]=n*Math.sin(2*Math.PI*t/i)-l[2*t+1]}if(e){c=!1;for(let a=0;a<i;a++)l[2*a]=d[2*a]+$[2*a],l[2*a+1]=d[2*a+1]+$[2*a+1],r.draggables.world_coordinates[a+2]=[l[2*a],l[2*a+1]];r.draggables.recalculate_locations()}window.requestAnimationFrame(D)}}function j(){0===a?(t[0]=parseFloat(A.value||1),t[1]=parseFloat(F.value||0),r.draggables.world_coordinates[0]=[t[0],t[1]]):1===a?(n[0]=10*parseFloat(A.value||0),n[1]=10*parseFloat(F.value||0),r.draggables.world_coordinates[1]=[n[0],n[1]]):(l[2*(a-2)]=parseFloat(A.value||0),l[2*(a-2)+1]=parseFloat(F.value||0),r.draggables.world_coordinates[a-2]=[l[2*(a-2)],l[2*(a-2)+1]]),window.requestAnimationFrame(D),r.draggables.recalculate_locations()}function C(e,r,o){b=0,z=0,y=0,h=0,v=0,p=0}function H(e,o,t,n,l){r.world_center_x-=t,r.world_center_y-=n,h=-t/r.world_width,v=-n/r.world_height,window.requestAnimationFrame(D),r.draggables.recalculate_locations()}function O(e,r,o){Math.sqrt(h*h+v*v)>=.0025&&(b=h,z=v),Math.abs(p)>=.01&&(y=p),window.requestAnimationFrame(D)}function Q(){if(s>=1){let e=r.input.get_zoomed_world_center(g,w,3*Math.pow(2,m)*s,3*Math.pow(2,m));r.world_width=3*Math.pow(2,m)*s,r.world_height=3*Math.pow(2,m),r.world_center_x=e[0],r.world_center_y=e[1]}else{let o=r.input.get_zoomed_world_center(g,w,3*Math.pow(2,m),3*Math.pow(2,m)/s);r.world_width=3*Math.pow(2,m),r.world_height=3*Math.pow(2,m)/s,r.world_center_x=o[0],r.world_center_y=o[1]}window.requestAnimationFrame(D),r.draggables.recalculate_locations()}function W(e,r,o,a){0===e?t=[r,o]:1===e?n=[r,o]:(l[2*(e-2)]=r,l[2*(e-2)+1]=o),window.requestAnimationFrame(D)}function B(e,r,o,i){Page.Animate.change_opacity(L,0,Site.opacity_animation_time),Page.Animate.change_opacity(E,0,Site.opacity_animation_time).then(()=>{if(0===(a=e))A.value=Math.round(1e3*t[0])/1e3,F.value=Math.round(1e3*t[1])/1e3;else if(1===a)A.value=Math.round(1e3*n[0])/1e4,F.value=Math.round(1e3*n[1])/1e4;else{var r,o,i;let s=a-2;A.value=Math.round(1e3*l[2*s])/1e3,F.value=Math.round(1e3*l[2*s+1])/1e3,S.value=(r=255*I[3*s],o=255*I[3*s+1],i=255*I[3*s+2],"#"+J(r)+J(o)+J(i))}Page.Animate.change_opacity(L,1,Site.opacity_animation_time),Page.Animate.change_opacity(E,1,Site.opacity_animation_time)})}function D(e){let a=e-x;if(x=e,0===a)return;o.gl.uniform1f(o.uniforms.aspect_ratio,s),o.gl.uniform1f(o.uniforms.world_center_x,r.world_center_x),o.gl.uniform1f(o.uniforms.world_center_y,r.world_center_y),o.gl.uniform1f(o.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),o.gl.uniform1i(o.uniforms.num_roots,i),o.gl.uniform2fv(o.uniforms.roots,l),o.gl.uniform2fv(o.uniforms.a,t),o.gl.uniform2f(o.uniforms.c,n[0]/10,n[1]/10),o.gl.uniform1f(o.uniforms.brightness_scale,30),o.render.draw_frame();let _=o.render.get_pixel_data(),q=Array(1e4);for(let k=0;k<1e4;k++)q[k]=Math.max(Math.max(_[4*k],_[4*k+1]),_[4*k+2]);q.sort((e,r)=>e-r);let A=Math.min(1e4/(q[Math.floor(9600)]+q[Math.floor(9800)]),200);f.push(A);let F=f.length;F>10&&f.shift(),A=Math.max(f.reduce((e,r)=>e+r)/F,.5),r.gl.uniform1f(r.uniforms.aspect_ratio,s),r.gl.uniform1f(r.uniforms.world_center_x,r.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,r.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),r.gl.uniform1i(r.uniforms.num_roots,i),r.gl.uniform2fv(r.uniforms.roots,l),r.gl.uniform2fv(r.uniforms.a,t),r.gl.uniform2f(r.uniforms.c,n[0]/10,n[1]/10),r.gl.uniform1f(r.uniforms.brightness_scale,A),r.render.draw_frame(),c&&function e(){let o=.5*Math.sin(Math.PI*u/120-Math.PI/2)+.5;for(let t=0;t<i;t++)l[2*t]=d[2*t]+$[2*t]*o,l[2*t+1]=d[2*t+1]+$[2*t+1]*o,r.draggables.world_coordinates[t+2]=[l[2*t],l[2*t+1]];window.requestAnimationFrame(D),r.draggables.recalculate_locations(),121==++u&&(c=!1)}(),a>=50&&(b=0,z=0,y=0,h=0,v=0,p=0),(0!==b||0!==z||0!==y)&&(r.world_center_x+=b*r.world_width,r.world_center_y+=z*r.world_height,25e-5>Math.sqrt((b*=.96)*b+(z*=.96)*z)&&(b=0,z=0),m+=y,Q(g,w),.001>Math.abs(y*=.93)&&(y=0),window.requestAnimationFrame(D),r.draggables.recalculate_locations())}function G(){r.fullscreen.currently_fullscreen?(s=window.innerWidth/window.innerHeight)>=1?(r.change_canvas_size(_,Math.floor(_/s)),r.world_width=3*Math.pow(2,m)*s,r.world_height=3*Math.pow(2,m)):(r.change_canvas_size(Math.floor(_*s),_),r.world_width=3*Math.pow(2,m),r.world_height=3*Math.pow(2,m)/s):(s=1,r.change_canvas_size(_,_),r.world_width=3*Math.pow(2,m),r.world_height=3*Math.pow(2,m)),window.requestAnimationFrame(D)}function J(e){let r=e.toString(16);return 1==r.length?"0"+r:r}r.gl.uniform3fv(r.uniforms.colors,I),o.gl.uniform3fv(o.uniforms.colors,I),window.requestAnimationFrame(D),Page.show(),window.addEventListener("resize",G),Page.temporary_handlers.resize.push(G)}();