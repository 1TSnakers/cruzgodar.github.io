!function(){"use strict";let e=`
  precision highp float;
  
  varying vec2 uv;
  
  uniform float aspectRatio;
  
  uniform float worldCenterX;
  uniform float worldCenterY;
  uniform float worldSize;
  
  uniform int numRoots;
  
  uniform vec2 roots[11];
  
  uniform vec3 colors[11];
  
  uniform vec2 a;
  uniform vec2 c;
  
  uniform float brightnessScale;
  
  const float threshhold = .05;
  
  
  
  //Returns z1 * z2.
  vec2 cmul(vec2 z1, vec2 z2)
  {
   return vec2(z1.x * z2.x - z1.y * z2.y, z1.x * z2.y + z1.y * z2.x);
  }
  
  
  
  //Returns 1/z.
  vec2 cinv(vec2 z)
  {
   float magnitude = z.x*z.x + z.y*z.y;
   
   return vec2(z.x / magnitude, -z.y / magnitude);
  }
  
  
  
  //Returns f(z) for a polynomial f with given roots.
  vec2 cpoly(vec2 z)
  {
   vec2 result = vec2(1.0, 0.0);
   
   for (int i = 0; i <= 11; i++)
   {
    if (i == numRoots)
    {
     return result;
    }
    
    result = cmul(result, z - roots[i]);
   }
  }
  
  
  
  //Approximates f'(z) for a polynomial f with given roots.
  vec2 cderiv(vec2 z)
  {
   return 20.0 * (cpoly(z + vec2(.025, 0.0)) - cpoly(z - vec2(.025, 0.0)));
  }
  
  
  
  void main(void)
  {
   vec2 z;
   vec2 lastZ = vec2(0.0, 0.0);
   
   if (aspectRatio >= 1.0)
   {
    z = vec2(uv.x * aspectRatio * worldSize + worldCenterX, uv.y * worldSize + worldCenterY);
   }
   
   else
   {
    z = vec2(uv.x * worldSize + worldCenterX, uv.y / aspectRatio * worldSize + worldCenterY);
   }
   
   gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
   
   
   
   for (int iteration = 0; iteration < 100; iteration++)
   {
    vec2 temp = cmul(cmul(cpoly(z), cmul(z - lastZ, cinv(cpoly(z) - cpoly(lastZ)))), a) + c;
    
    lastZ = z;
    
    z -= temp;
    
    
    
    for (int i = 0; i <= 11; i++)
    {
     if (i == numRoots)
     {
      break;
     }
     
     float d0 = length(z - roots[i]);
     
     if (d0 < threshhold)
     {
      float d1 = length(lastZ - roots[i]);
      
      float brightnessAdjust = (log(threshhold) - log(d0)) / (log(d1) - log(d0));
      
      float brightness = 1.0 - (float(iteration) - brightnessAdjust) / brightnessScale;
      
      gl_FragColor = vec4(colors[i] * brightness, 1.0);
      
      return;
     }
    }
   }
  }
 `,r=new Wilson($("#output-canvas"),{renderer:"gpu",shader:e,canvasWidth:500,canvasHeight:500,worldWidth:3,worldHeight:3,worldCenterX:0,worldCenterY:0,useDraggables:!0,draggablesMousemoveCallback:T,draggablesTouchmoveCallback:T,draggablesMouseupCallback:O,draggablesTouchendCallback:O,useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:D,mousedownCallback:E,touchstartCallback:E,mousedragCallback:I,touchmoveCallback:I,mouseupCallback:P,touchendCallback:P,wheelCallback:function e(r,o,t,n){w=r,v=o,.3>Math.abs(t/100)?g+=t/100:y+=.05*Math.sign(t),Z()},pinchCallback:function e(o,t,n,i){s>=1?(g-=n/r.worldWidth*10,b=-n/r.worldWidth*10):(g-=n/r.worldHeight*10,b=-n/r.worldHeight*10),w=o,v=t,Z()}});r.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","numRoots","roots","colors","a","c","brightnessScale"]);let o=new Wilson($("#hidden-canvas"),{renderer:"gpu",shader:e,canvasWidth:100,canvasHeight:100});o.render.initUniforms(["aspectRatio","worldCenterX","worldCenterY","worldSize","numRoots","roots","colors","a","c","brightnessScale"]);let t=[1,0],n=[0,0],i=[],a=0,l=0,s=1,u=!1,d=0,c=[],_=[],g=0,f=[],m=500,w=0,v=0,h=0,p=0,b=0,C=0,z=0,y=0,F=-1,A=r.draggables.add(1,0);A.classList.add("a-marker"),(A=r.draggables.add(0,0)).classList.add("c-marker"),H(),H(),H(),X(!0);let k=$("#resolution-input");k.addEventListener("input",()=>{m=parseInt(k.value||500),r.changeCanvasSize(m,m),window.requestAnimationFrame(B)});$("#add-root-button").addEventListener("click",H);$("#remove-root-button").addEventListener("click",function e(){1!==l&&(l--,i.pop(),i.pop(),r.draggables.draggables[l+2].remove(),r.draggables.draggables.pop(),r.draggables.worldCoordinates.pop(),r.draggables.numDraggables--,window.requestAnimationFrame(B))});$("#spread-roots-button").addEventListener("click",()=>X(!1,!1));$("#randomize-roots-button").addEventListener("click",()=>X(!1,!0));$("#download-button").addEventListener("click",()=>{r.downloadFrame("newtons-method.png")});let S=$("#root-a-input"),R=$("#root-b-input");S.addEventListener("input",Y),R.addEventListener("input",Y);let L=$("#root-color-input");L.addEventListener("input",function e(){var t;if(a<2)return;let n,i=a-2,l=(t=L.value,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null),s=l.r/255,u=l.g/255,d=l.b/255;l.r=q[3*i],l.g=q[3*i+1],l.b=q[3*i+2],anime({targets:l,r:s,g:u,b:d,easing:"easeInOutQuad",duration:250,update(){q[3*i]=l.r,q[3*i+1]=l.g,q[3*i+2]=l.b,r.gl.uniform3fv(r.uniforms.colors,q),o.gl.uniform3fv(o.uniforms.colors,q),window.requestAnimationFrame(B)}})});let x=$("#root-setter"),W=$("#color-setter");r.gl.uniform1f(r.uniforms.aspectRatio,1);let q=[216/255,1/255,42/255,1,139/255,56/255,249/255,239/255,20/255,27/255,181/255,61/255,0,86/255,195/255,154/255,82/255,164/255,32/255,32/255,32/255,155/255,92/255,15/255,182/255,228/255,254/255,250/255,195/255,218/255,1,1,1];function H(){if(11===l)return;let e=3*Math.random()-1.5,o=3*Math.random()-1.5;r.draggables.add(e,o),i.push(e),i.push(o),l++,window.requestAnimationFrame(B)}function X(e=!1,o=!1){if(!u){u=!0,d=0,c=JSON.parse(JSON.stringify(i));for(let t=0;t<l;t++){let n=1;o&&(n+=.75*Math.random()),_[2*t]=n*Math.cos(2*Math.PI*t/l)-i[2*t],_[2*t+1]=n*Math.sin(2*Math.PI*t/l)-i[2*t+1]}if(e){u=!1;for(let a=0;a<l;a++)i[2*a]=c[2*a]+_[2*a],i[2*a+1]=c[2*a+1]+_[2*a+1],r.draggables.worldCoordinates[a+2]=[i[2*a],i[2*a+1]];r.draggables.recalculateLocations()}window.requestAnimationFrame(B)}}function Y(){0===a?(t[0]=parseFloat(S.value||1),t[1]=parseFloat(R.value||0),r.draggables.worldCoordinates[0]=[t[0],t[1]]):1===a?(n[0]=10*parseFloat(S.value||0),n[1]=10*parseFloat(R.value||0),r.draggables.worldCoordinates[1]=[n[0],n[1]]):(i[2*(a-2)]=parseFloat(S.value||0),i[2*(a-2)+1]=parseFloat(R.value||0),r.draggables.worldCoordinates[a-2]=[i[2*(a-2)],i[2*(a-2)+1]]),window.requestAnimationFrame(B),r.draggables.recalculateLocations()}function E(e,r,o){C=0,z=0,y=0,h=0,p=0,b=0}function I(e,o,t,n,i){r.worldCenterX-=t,r.worldCenterY-=n,h=-t/r.worldWidth,p=-n/r.worldHeight,window.requestAnimationFrame(B),r.draggables.recalculateLocations()}function P(e,r,o){Math.sqrt(h*h+p*p)>=.0025&&(C=h,z=p),Math.abs(b)>=.01&&(y=b),window.requestAnimationFrame(B)}function Z(){if(s>=1){let e=r.input.getZoomedWorldCenter(w,v,3*Math.pow(2,g)*s,3*Math.pow(2,g));r.worldWidth=3*Math.pow(2,g)*s,r.worldHeight=3*Math.pow(2,g),r.worldCenterX=e[0],r.worldCenterY=e[1]}else{let o=r.input.getZoomedWorldCenter(w,v,3*Math.pow(2,g),3*Math.pow(2,g)/s);r.worldWidth=3*Math.pow(2,g),r.worldHeight=3*Math.pow(2,g)/s,r.worldCenterX=o[0],r.worldCenterY=o[1]}window.requestAnimationFrame(B),r.draggables.recalculateLocations()}function T(e,r,o,a){0===e?t=[r,o]:1===e?n=[r,o]:(i[2*(e-2)]=r,i[2*(e-2)+1]=o),window.requestAnimationFrame(B)}function O(e,r,o,l){Page.Animate.changeOpacity(x,0,Site.opacityAnimationTime),Page.Animate.changeOpacity(W,0,Site.opacityAnimationTime).then(()=>{if(0===(a=e))S.value=Math.round(1e3*t[0])/1e3,R.value=Math.round(1e3*t[1])/1e3;else if(1===a)S.value=Math.round(1e3*n[0])/1e4,R.value=Math.round(1e3*n[1])/1e4;else{var r,o,l;let s=a-2;S.value=Math.round(1e3*i[2*s])/1e3,R.value=Math.round(1e3*i[2*s+1])/1e3,L.value=(r=255*q[3*s],o=255*q[3*s+1],l=255*q[3*s+2],"#"+j(r)+j(o)+j(l))}Page.Animate.changeOpacity(x,1,Site.opacityAnimationTime),Page.Animate.changeOpacity(W,1,Site.opacityAnimationTime)})}function B(e){let a=e-F;if(F=e,0===a)return;o.gl.uniform1f(o.uniforms.aspectRatio,s),o.gl.uniform1f(o.uniforms.worldCenterX,r.worldCenterX),o.gl.uniform1f(o.uniforms.worldCenterY,r.worldCenterY),o.gl.uniform1f(o.uniforms.worldSize,Math.min(r.worldHeight,r.worldWidth)/2),o.gl.uniform1i(o.uniforms.numRoots,l),o.gl.uniform2fv(o.uniforms.roots,i),o.gl.uniform2fv(o.uniforms.a,t),o.gl.uniform2f(o.uniforms.c,n[0]/10,n[1]/10),o.gl.uniform1f(o.uniforms.brightnessScale,30),o.render.drawFrame();let m=o.render.getPixelData(),A=Array(1e4);for(let k=0;k<1e4;k++)A[k]=Math.max(Math.max(m[4*k],m[4*k+1]),m[4*k+2]);A.sort((e,r)=>e-r);let S=Math.min(1e4/(A[Math.floor(9600)]+A[Math.floor(9800)]),200);f.push(S);let R=f.length;R>10&&f.shift(),S=Math.max(f.reduce((e,r)=>e+r)/R,.5),r.gl.uniform1f(r.uniforms.aspectRatio,s),r.gl.uniform1f(r.uniforms.worldCenterX,r.worldCenterX),r.gl.uniform1f(r.uniforms.worldCenterY,r.worldCenterY),r.gl.uniform1f(r.uniforms.worldSize,Math.min(r.worldHeight,r.worldWidth)/2),r.gl.uniform1i(r.uniforms.numRoots,l),r.gl.uniform2fv(r.uniforms.roots,i),r.gl.uniform2fv(r.uniforms.a,t),r.gl.uniform2f(r.uniforms.c,n[0]/10,n[1]/10),r.gl.uniform1f(r.uniforms.brightnessScale,S),r.render.drawFrame(),u&&function e(){let o=.5*Math.sin(Math.PI*d/120-Math.PI/2)+.5;for(let t=0;t<l;t++)i[2*t]=c[2*t]+_[2*t]*o,i[2*t+1]=c[2*t+1]+_[2*t+1]*o,r.draggables.worldCoordinates[t+2]=[i[2*t],i[2*t+1]];window.requestAnimationFrame(B),r.draggables.recalculateLocations(),121==++d&&(u=!1)}(),a>=50&&(C=0,z=0,y=0,h=0,p=0,b=0),(0!==C||0!==z||0!==y)&&(r.worldCenterX+=C*r.worldWidth,r.worldCenterY+=z*r.worldHeight,25e-5>Math.sqrt((C*=.96)*C+(z*=.96)*z)&&(C=0,z=0),g+=y,Z(w,v),.001>Math.abs(y*=.93)&&(y=0),window.requestAnimationFrame(B),r.draggables.recalculateLocations())}function D(){r.fullscreen.currentlyFullscreen?(s=window.innerWidth/window.innerHeight)>=1?(r.changeCanvasSize(m,Math.floor(m/s)),r.worldWidth=3*Math.pow(2,g)*s,r.worldHeight=3*Math.pow(2,g)):(r.changeCanvasSize(Math.floor(m*s),m),r.worldWidth=3*Math.pow(2,g),r.worldHeight=3*Math.pow(2,g)/s):(s=1,r.changeCanvasSize(m,m),r.worldWidth=3*Math.pow(2,g),r.worldHeight=3*Math.pow(2,g)),window.requestAnimationFrame(B)}function j(e){let r=e.toString(16);return 1==r.length?"0"+r:r}r.gl.uniform3fv(r.uniforms.colors,q),o.gl.uniform3fv(o.uniforms.colors,q),window.requestAnimationFrame(B),Page.show(),window.addEventListener("resize",D),Page.temporaryHandlers.resize.push(D)}();