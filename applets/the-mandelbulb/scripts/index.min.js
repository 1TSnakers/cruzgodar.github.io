!function(){function B(b){var d=b-Aa;Aa=b;if(0!==d){a.render.drawFrame();b=!1;if(R){b=.5*Math.sin(Math.PI*oa/120-Math.PI/2)+.5;t=E+S*b;u=F+T*b;v=G+U*b;var k=[[1,0,0],[0,Math.cos(t),-Math.sin(t)],[0,Math.sin(t),Math.cos(t)]];k=pa(pa([[Math.cos(v),-Math.sin(v),0],[Math.sin(v),Math.cos(v),0],[0,0,1]],[[Math.cos(u),0,-Math.sin(u)],[0,1,0],[Math.sin(u),0,Math.cos(u)]]),k);a.gl.uniformMatrix3fv(a.uniforms.rotationMatrix,!1,[k[0][0],k[1][0],k[2][0],k[0][1],k[1][1],k[2][1],k[0][2],k[1][2],k[2][2]]);c[0]=
h[0]+q[0]*b;c[1]=h[1]+q[1]*b;c[2]=h[2]+q[2]*b;a.gl.uniform3fv(a.uniforms.c,c);z=Z+ca*b;a.gl.uniform1f(a.uniforms.power,z);w=V+da*b;a.gl.uniform1f(a.uniforms.juliaProportion,w);oa++;121===oa&&(R=!1);b=!0}if(ea||fa||ha||ia||M||N){l=Math.min(Math.max(1E-6,ua/20),.02);if(O){d=[...f];if(ea||M)f[0]+=l*m[0],f[1]+=l*m[1],f[2]+=l*m[2];else if(fa||N)f[0]-=l*m[0],f[1]-=l*m[1],f[2]-=l*m[2];ha?(f[0]+=l*n[0]/p,f[1]+=l*n[1]/p,f[2]+=l*n[2]/p):ia&&(f[0]-=l*n[0]/p,f[1]-=l*n[1]/p,f[2]-=l*n[2]/p);g[0]=f[0]-d[0];g[1]=
f[1]-d[1];g[2]=f[2]-d[2]}else{d=[...c];if(ea||M)c[0]+=.5*l*m[0],c[1]+=.5*l*m[1],c[2]+=.5*l*m[2];else if(fa||N)c[0]-=.5*l*m[0],c[1]-=.5*l*m[1],c[2]-=.5*l*m[2];ha?(c[0]+=.5*l*n[0]/p,c[1]+=.5*l*n[1]/p,c[2]+=.5*l*n[2]/p):ia&&(c[0]-=.5*l*n[0]/p,c[1]-=.5*l*n[1]/p,c[2]-=.5*l*n[2]/p);ja.value=Math.round(1E6*c[0])/1E6;ka.value=Math.round(1E6*c[1])/1E6;la.value=Math.round(1E6*c[2])/1E6;a.gl.uniform3fv(a.uniforms.c,c);g[0]=c[0]-d[0];g[1]=c[1]-d[1];g[2]=c[2]-d[2]}ma();b=!0}else 50<=d&&(H=I=aa=ba=0,N=M=!1,e[0]=
0,e[1]=0,e[2]=0,g[0]=0,g[1]=0,g[2]=0);if(0!==I||0!==H)y+=I,x+=H,y>=2*Math.PI?y-=2*Math.PI:0>y&&(y+=2*Math.PI),x>Math.PI-.01?x=Math.PI-.01:.01>x&&(x=.01),I*=.94,H*=.94,5E-4>Math.sqrt(I*I+H*H)&&(H=I=0),ma(),b=!0;if(0!==e[0]||0!==e[1]||0!==e[2])O?(f[0]+=e[0],f[1]+=e[1],f[2]+=e[2]):(c[0]+=e[0],c[1]+=e[1],c[2]+=e[2],ja.value=Math.round(1E6*c[0])/1E6,ka.value=Math.round(1E6*c[1])/1E6,la.value=Math.round(1E6*c[2])/1E6,a.gl.uniform3fv(a.uniforms.c,c)),e[0]*=.94,e[1]*=.94,e[2]*=.94,Math.sqrt(e[0]*e[0]+e[1]*
e[1]+e[2]*e[2])<5E-4*l&&(e[0]=0,e[1]=0,e[2]=0),ma(),b=!0;b&&window.requestAnimationFrame(B)}}function ma(){m=[Math.cos(y)*Math.sin(x),Math.sin(y)*Math.sin(x),Math.cos(x)];var b=[m[1],-m[0],0],d=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);n=[b[0]/d,b[1]/d,b[2]/d];J=[n[1]*m[2]-n[2]*m[1],n[2]*m[0]-n[0]*m[2],n[0]*m[1]-n[1]*m[0]];b=f[0];d=f[1];var k=f[2];let r=[b,d,k],K=0,va=1;for(let Ba=0;Ba<4*qa;Ba++){K=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(16<K)break;var P=Math.acos(r[2]/K),W=Math.atan2(r[1],r[0]);
va=Math.pow(K,z-1)*z*va+1;P*=z;W*=z;var X=Math.pow(K,z);r[0]=X*Math.sin(P)*Math.cos(W)+((1-w)*b+w*c[0]);r[1]=X*Math.sin(P)*Math.sin(W)+((1-w)*d+w*c[1]);r[2]=X*Math.cos(P)+((1-w)*k+w*c[2]);P=r[0];W=r[1];X=r[2];var A=[[1,0,0],[0,Math.cos(t),-Math.sin(t)],[0,Math.sin(t),Math.cos(t)]];A=pa(pa([[Math.cos(v),-Math.sin(v),0],[Math.sin(v),Math.cos(v),0],[0,0,1]],[[Math.cos(u),0,-Math.sin(u)],[0,1,0],[Math.sin(u),0,Math.cos(u)]]),A);r[0]=A[0][0]*P+A[0][1]*W+A[0][2]*X;r[1]=A[1][0]*P+A[1][1]*W+A[1][2]*X;r[2]=
A[2][0]*P+A[2][1]*W+A[2][2]*X}ua=.5*Math.log(K)*K/va;p=ua/2;n[0]*=p/2;n[1]*=p/2;J[0]*=p/2;J[1]*=p/2;J[2]*=p/2;wa=[f[0]+p*m[0],f[1]+p*m[1],f[2]+p*m[2]];a.gl.uniform3fv(a.uniforms.cameraPos,f);a.gl.uniform3fv(a.uniforms.imagePlaneCenterPos,wa);a.gl.uniform3fv(a.uniforms.forwardVec,m);a.gl.uniform3fv(a.uniforms.rightVec,n);a.gl.uniform3fv(a.uniforms.upVec,J);a.gl.uniform1f(a.uniforms.focalLength,p)}function pa(b,d){return[[b[0][0]*d[0][0]+b[0][1]*d[1][0]+b[0][2]*d[2][0],b[0][0]*d[0][1]+b[0][1]*d[1][1]+
b[0][2]*d[2][1],b[0][0]*d[0][2]+b[0][1]*d[1][2]+b[0][2]*d[2][2]],[b[1][0]*d[0][0]+b[1][1]*d[1][0]+b[1][2]*d[2][0],b[1][0]*d[0][1]+b[1][1]*d[1][1]+b[1][2]*d[2][1],b[1][0]*d[0][2]+b[1][1]*d[1][2]+b[1][2]*d[2][2]],[b[2][0]*d[0][0]+b[2][1]*d[1][0]+b[2][2]*d[2][0],b[2][0]*d[0][1]+b[2][1]*d[1][1]+b[2][2]*d[2][1],b[2][0]*d[0][2]+b[2][1]*d[1][2]+b[2][2]*d[2][2]]]}function Ca(b,d,k){H=I=aa=ba=0;"touchstart"===k.type&&(2===k.touches.length?(M=!0,N=!1,e[0]=0,e[1]=0,e[2]=0,g[0]=0,g[1]=0,g[2]=0,window.requestAnimationFrame(B)):
3===k.touches.length?(M=!1,N=!0,e[0]=0,e[1]=0,e[2]=0,g[0]=0,g[1]=0,g[2]=0,window.requestAnimationFrame(B)):N=M=!1,ra=!1)}function Da(b,d,k,r,K){"touchmove"===K.type&&ra?ra=!1:(y+=k*Math.PI/2,ba=k*Math.PI/2,y>=2*Math.PI?y-=2*Math.PI:0>y&&(y+=2*Math.PI),x+=r*Math.PI/2,aa=r*Math.PI/2,x>Math.PI-.01?x=Math.PI-.01:.01>x&&(x=.01),ma(),window.requestAnimationFrame(B))}function Ea(b,d,k){"touchend"===k.type&&(N=M=!1,ra=!0,0===e[0]&&0===e[1]&&0===e[2]&&(e[0]=g[0],e[1]=g[1],e[2]=g[2],g[0]=0,g[1]=0,g[2]=0));
(("touchend"===k.type&&k.touches,0===length)||"mouseup"===k.type)&&.005<=Math.sqrt(ba*ba+aa*aa)&&(I=ba,H=aa)}function Fa(b){"INPUT"===document.activeElement.tagName||87!==b.keyCode&&83!==b.keyCode&&68!==b.keyCode&&65!==b.keyCode||(g=[0,0,0],e=[0,0,0],87===b.keyCode?ea=!0:83===b.keyCode&&(fa=!0),68===b.keyCode?ha=!0:65===b.keyCode&&(ia=!0),window.requestAnimationFrame(B))}function Ga(b){"INPUT"===document.activeElement.tagName||87!==b.keyCode&&83!==b.keyCode&&68!==b.keyCode&&65!==b.keyCode||(0===e[0]&&
0===e[1]&&0===e[2]&&(e[0]=g[0],e[1]=g[1],e[2]=g[2],g[0]=0,g[1]=0,g[2]=0),87===b.keyCode?ea=!1:83===b.keyCode&&(fa=!1),68===b.keyCode?ha=!1:65===b.keyCode&&(ia=!1))}function Ha(){Q=Math.max(100,parseInt(Ia.value||500));a.fullscreen.currentlyFullscreen?1<=Page.Layout.aspectRatio?(C=Q,D=Math.floor(Q/Page.Layout.aspectRatio)):(C=Math.floor(Q*Page.Layout.aspectRatio),D=Q):D=C=Q;a.changeCanvasSize(C,D);C>=D?(a.gl.uniform1f(a.uniforms.aspectRatioX,C/D),a.gl.uniform1f(a.uniforms.aspectRatioY,1)):(a.gl.uniform1f(a.uniforms.aspectRatioX,
1),a.gl.uniform1f(a.uniforms.aspectRatioY,C/D));a.gl.uniform1i(a.uniforms.imageSize,Q);window.requestAnimationFrame(B)}function Ma(){E=t;F=u;G=v;S=(parseFloat(xa.value||0)||0)-E;T=(parseFloat(ya.value||0)||0)-F;U=(parseFloat(za.value||0)||0)-G;h[0]=c[0];h[1]=c[1];h[2]=c[2];q[0]=(parseFloat(ja.value||0)||0)-h[0];q[1]=(parseFloat(ka.value||0)||0)-h[1];q[2]=(parseFloat(la.value||0)||0)-h[2];Z=z;ca=(parseFloat(Ja.value||0)||0)-Z;V=w;da=0;sa()}function sa(){R||(R=!0,oa=0,window.requestAnimationFrame(B))}
var L={renderer:"gpu",shader:"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspectRatioX;\n\t\tuniform float aspectRatioY;\n\t\t\n\t\tuniform vec3 cameraPos;\n\t\tuniform vec3 imagePlaneCenterPos;\n\t\tuniform vec3 forwardVec;\n\t\tuniform vec3 rightVec;\n\t\tuniform vec3 upVec;\n\t\t\n\t\tuniform float focalLength;\n\t\t\n\t\tuniform vec3 lightPos;\n\t\tconst float lightBrightness = 1.5;\n\t\t\n\t\tuniform int imageSize;\n\t\t\n\t\tuniform int drawSphere;\n\t\t\n\t\tuniform int maxIterations;\n\t\t\n\t\t\n\t\t\n\t\tconst float clipDistance = 1000.0;\n\t\tuniform int maxMarches;\n\t\tuniform float stepFactor;\n\t\tconst vec3 fogColor = vec3(0.0, 0.0, 0.0);\n\t\tconst float fogScaling = .1;\n\t\t\n\t\t\n\t\t\n\t\tuniform mat3 rotationMatrix;\n\t\t\n\t\tuniform float power;\n\t\tuniform vec3 c;\n\t\tuniform float juliaProportion;\n\t\t\n\t\t\n\t\t\n\t\tfloat distanceEstimator(vec3 pos)\n\t\t{\n\t\t\tvec3 z = pos;\n\t\t\t\n\t\t\tfloat r = length(z);\n\t\t\tfloat dr = 1.0;\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tif (r > 16.0 || iteration >= maxIterations)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat theta = acos(z.z / r);\n\t\t\t\t\n\t\t\t\tfloat phi = atan(z.y, z.x);\n\t\t\t\t\n\t\t\t\tdr = pow(r, power - 1.0) * power * dr + 1.0;\n\t\t\t\t\n\t\t\t\ttheta *= power;\n\t\t\t\t\n\t\t\t\tphi *= power;\n\t\t\t\t\n\t\t\t\tz = pow(r, power) * vec3(sin(theta)*cos(phi), sin(phi)*sin(theta), cos(theta));\n\t\t\t\t\n\t\t\t\tz += mix(pos, c, juliaProportion);\n\t\t\t\t\n\t\t\t\tz = rotationMatrix * z;\n\t\t\t\t\n\t\t\t\tr = length(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfloat distance1 = .5 * log(r) * r / dr;\n\t\t\tfloat distance2 = length(pos - c) - .05;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tif (distance2 < distance1 && drawSphere == 1)\n\t\t\t{\n\t\t\t\treturn distance2;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\treturn distance1;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 getColor(vec3 pos)\n\t\t{\n\t\t\tvec3 z = pos;\n\t\t\t\n\t\t\tfloat r = length(z);\n\t\t\tfloat dr = 1.0;\n\t\t\t\n\t\t\tvec3 color = vec3(1.0, 1.0, 1.0);\n\t\t\tfloat colorScale = .5;\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 100; iteration++)\n\t\t\t{\n\t\t\t\tif (r > 16.0 || iteration >= maxIterations)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat theta = acos(z.z / r);\n\t\t\t\t\n\t\t\t\tfloat phi = atan(z.y, z.x);\n\t\t\t\t\n\t\t\t\tdr = pow(r, power - 1.0) * power * dr + 1.0;\n\t\t\t\t\n\t\t\t\ttheta *= power;\n\t\t\t\t\n\t\t\t\tphi *= power;\n\t\t\t\t\n\t\t\t\tz = pow(r, power) * vec3(sin(theta)*cos(phi), sin(phi)*sin(theta), cos(theta));\n\t\t\t\t\n\t\t\t\tz += mix(pos, c, juliaProportion);\n\t\t\t\t\n\t\t\t\tz = rotationMatrix * z;\n\t\t\t\t\n\t\t\t\tr = length(z);\n\t\t\t\t\n\t\t\t\tcolor = mix(color, abs(z / r), colorScale);\n\t\t\t\t\n\t\t\t\tcolorScale *= .5;\n\t\t\t}\n\t\t\t\n\t\t\tcolor /= max(max(color.x, color.y), color.z);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfloat distance1 = .5 * log(r) * r / dr;\n\t\t\tfloat distance2 = length(pos - c) - .05;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tif (distance2 < distance1 && drawSphere == 1)\n\t\t\t{\n\t\t\t\tcolor = vec3(1.0, 1.0, 1.0);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\treturn color;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 getSurfaceNormal(vec3 pos)\n\t\t{\n\t\t\tfloat xStep1 = distanceEstimator(pos + vec3(.000001, 0.0, 0.0));\n\t\t\tfloat yStep1 = distanceEstimator(pos + vec3(0.0, .000001, 0.0));\n\t\t\tfloat zStep1 = distanceEstimator(pos + vec3(0.0, 0.0, .000001));\n\t\t\t\n\t\t\tfloat xStep2 = distanceEstimator(pos - vec3(.000001, 0.0, 0.0));\n\t\t\tfloat yStep2 = distanceEstimator(pos - vec3(0.0, .000001, 0.0));\n\t\t\tfloat zStep2 = distanceEstimator(pos - vec3(0.0, 0.0, .000001));\n\t\t\t\n\t\t\treturn normalize(vec3(xStep1 - xStep2, yStep1 - yStep2, zStep1 - zStep2));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 computeShading(vec3 pos, int iteration)\n\t\t{\n\t\t\tvec3 surfaceNormal = getSurfaceNormal(pos);\n\t\t\t\n\t\t\tvec3 lightDirection = normalize(lightPos - pos);\n\t\t\t\n\t\t\tfloat dotProduct = dot(surfaceNormal, lightDirection);\n\t\t\t\n\t\t\tfloat lightIntensity = lightBrightness * max(dotProduct, -.25 * dotProduct);\n\t\t\t\n\t\t\t//The last factor adds ambient occlusion.\n\t\t\tvec3 color = getColor(pos) * lightIntensity * max((1.0 - float(iteration) / float(maxMarches)), 0.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Apply fog.\n\t\t\treturn mix(color, fogColor, 1.0 - exp(-distance(pos, cameraPos) * fogScaling));\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvec3 raymarch(vec3 startPos)\n\t\t{\n\t\t\t//That factor of .9 is important -- without it, we're always stepping as far as possible, which results in artefacts and weirdness.\n\t\t\tvec3 rayDirectionVec = normalize(startPos - cameraPos) * .9 / stepFactor;\n\t\t\t\n\t\t\tvec3 finalColor = fogColor;\n\t\t\t\n\t\t\tfloat epsilon = 0.0;\n\t\t\t\n\t\t\tfloat t = 0.0;\n\t\t\t\n\t\t\tfloat lastDistance = 1000.0;\n\t\t\t\n\t\t\t//int slowedDown = 0;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 1024; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == maxMarches)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec3 pos = startPos + t * rayDirectionVec;\n\t\t\t\t\n\t\t\t\t//This prevents overstepping, and is honestly a pretty clever fix.\n\t\t\t\tfloat distance = min(distanceEstimator(pos), lastDistance);\n\t\t\t\tlastDistance = distance;\n\t\t\t\t\n\t\t\t\t//This lowers the detail far away, which makes everything run nice and fast.\n\t\t\t\tepsilon = max(.0000006, .5 * t / float(imageSize));\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (distance < epsilon)\n\t\t\t\t{\n\t\t\t\t\tfinalColor = computeShading(pos, iteration);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//Uncomment to add aggressive understepping when close to the fractal boundary, which helps to prevent flickering but is a significant performance hit.\n\t\t\t\t/*\n\t\t\t\telse if (lastDistance / distance > .9999 && slowedDown == 0)\n\t\t\t\t{\n\t\t\t\t\trayDirectionVec = normalize(startPos - cameraPos) * .125;\n\t\t\t\t\t\n\t\t\t\t\tslowedDown = 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse if (lastDistance / distance <= .9999 && slowedDown == 1)\n\t\t\t\t{\n\t\t\t\t\trayDirectionVec = normalize(startPos - cameraPos) * .9;\n\t\t\t\t\t\n\t\t\t\t\tslowedDown = 0;\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\t\n\t\t\t\telse if (t > clipDistance)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tt += distance;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\treturn finalColor;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\t//Uncomment to use 2x antialiasing.\n\t\t\t//vec3 finalColor = (raymarch(imagePlaneCenterPos + rightVec * (uv.x * aspectRatio + .5 / float(imageSize)) + upVec * (uv.y + .5 / float(imageSize))) + raymarch(imagePlaneCenterPos + rightVec * (uv.x * aspectRatio + .5 / float(imageSize)) + upVec * (uv.y - .5 / float(imageSize))) + raymarch(imagePlaneCenterPos + rightVec * (uv.x * aspectRatio - .5 / float(imageSize)) + upVec * (uv.y + .5 / float(imageSize))) + raymarch(imagePlaneCenterPos + rightVec * (uv.x * aspectRatio - .5 / float(imageSize)) + upVec * (uv.y - .5 / float(imageSize)))) / 4.0;\n\t\t\t\n\t\t\tgl_FragColor = vec4(raymarch(imagePlaneCenterPos + rightVec * uv.x * aspectRatioX + upVec * uv.y / aspectRatioY), 1.0);\n\t\t}\n\t",
canvasWidth:500,canvasHeight:500,useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:Ha,mousedownCallback:Ca,touchstartCallback:Ca,mousedragCallback:Da,touchmoveCallback:Da,mouseupCallback:Ea,touchendCallback:Ea};let a=new Wilson($("#output-canvas"),L);a.render.initUniforms("aspectRatioX aspectRatioY imageSize cameraPos imagePlaneCenterPos forwardVec rightVec upVec focalLength lightPos drawSphere power c juliaProportion rotationMatrix maxMarches stepFactor maxIterations".split(" "));
let R=!1,ea=!1,fa=!1,ha=!1,ia=!1,M=!1,N=!1,ra=!1,l=0,g=[0,0,0],e=[0,0,0],ua=1,Aa=-1,y=4.6601,x=2.272,ba=0,aa=0,I=0,H=0,Q=500,C=500,D=500,qa=4,ta=100,wa=[],m=[],n=[],J=[],f=[.0828,2.17,1.8925],p=2,z=8,c=[0,0,0],h=[0,0,0],q=[0,0,0],t=0,u=0,v=0,w=0,O=1,Z=8,ca=0,V=0,da=0,E=0,F=0,G=0,S=0,T=0,U=0,oa=0,Ia=$("#resolution-input");Ia.addEventListener("input",Ha);let Ka=$("#iterations-input");Ka.addEventListener("input",()=>{qa=parseInt(Ka.value||4);a.gl.uniform1i(a.uniforms.maxIterations,qa);window.requestAnimationFrame(B)});
let La=$("#view-distance-input");La.addEventListener("input",()=>{ta=Math.max(parseInt(La.value||100),32);a.gl.uniform1i(a.uniforms.maxMarches,ta);window.requestAnimationFrame(B)});$("#download-button").addEventListener("click",()=>{a.gl.uniform1i(a.uniforms.maxMarches,1024);a.gl.uniform1f(a.uniforms.stepFactor,12);0===w?a.downloadFrame("the-mandelbulb.png"):a.downloadFrame("a-juliabulb.png");a.gl.uniform1i(a.uniforms.maxMarches,ta);a.gl.uniform1f(a.uniforms.stepFactor,1)});let xa=$("#rotation-angle-x-input"),
ya=$("#rotation-angle-y-input"),za=$("#rotation-angle-z-input"),ja=$("#c-x-input"),ka=$("#c-y-input"),la=$("#c-z-input"),Ja=$("#power-input");L=[xa,ya,za,ja,ka,la,Ja];for(let b=0;7>b;b++)L[b].addEventListener("input",Ma);L=$("#randomize-rotation-button");L.style.opacity=1;L.addEventListener("click",function(b=!0){R||(E=t,F=u,G=v,S=2*Math.random()-1-E,T=2*Math.random()-1-F,U=2*Math.random()-1-G,xa.value=Math.round(1E6*(E+S))/1E6,ya.value=Math.round(1E6*(F+T))/1E6,za.value=Math.round(1E6*(G+U))/1E6,
h[0]=c[0],h[1]=c[1],h[2]=c[2],q[0]=0,q[1]=0,q[2]=0,V=w,da=0,Z=z,ca=0,b?sa():(t=E+S,u=F+T,v=G+U))});L=$("#randomize-c-button");L.style.opacity=1;L.addEventListener("click",function(b=!0){R||(E=t,F=u,G=v,U=T=S=0,h[0]=c[0],h[1]=c[1],h[2]=c[2],q[0]=1.5*Math.random()-.75-h[0],q[1]=1.5*Math.random()-.75-h[1],q[2]=1.5*Math.random()-.75-h[2],ja.value=Math.round(1E6*(h[0]+q[0]))/1E6,ka.value=Math.round(1E6*(h[1]+q[1]))/1E6,la.value=Math.round(1E6*(h[2]+q[2]))/1E6,V=w,da=0,Z=z,ca=0,b?sa():(c[0]=h[0]+q[0],c[1]=
h[1]+q[1],c[2]=h[2]+q[2]))});let na=$("#switch-bulb-button");na.style.opacity=1;na.addEventListener("click",function(){R||(Page.Animate.changeOpacity(na,0,Site.opacityAnimationTime),setTimeout(()=>{na.textContent=0===V?"Switch to Mandelbulb":"Switch to Juliabulb";Page.Load.TextButtons.equalize();Page.Animate.changeOpacity(na,1,Site.opacityAnimationTime)},Site.opacityAnimationTime),0===w?(a.gl.uniform3fv(a.uniforms.c,c),O||a.gl.uniform1i(a.uniforms.drawSphere,1),setTimeout(()=>{Page.Animate.changeOpacity(Y,
1,Site.opacityAnimationTime)},Site.opacityAnimationTime)):(O=!0,a.gl.uniform1i(a.uniforms.drawSphere,0),Page.Animate.changeOpacity(Y,0,Site.opacityAnimationTime)),V=w,da=1-2*V,Z=z,ca=0,E=t,F=u,G=v,U=T=S=0,h[0]=c[0],h[1]=c[1],h[2]=c[2],q[0]=0,q[1]=0,q[2]=0,sa())});let Y=$("#switch-movement-button");Y.style.opacity=0;Y.addEventListener("click",function(){O=!O;Page.Animate.changeOpacity(Y,0,Site.opacityAnimationTime);setTimeout(()=>{Y.textContent=O?"Change Juliabulb":"Move Camera";Page.Load.TextButtons.equalize();
Page.Animate.changeOpacity(Y,1,Site.opacityAnimationTime)},Site.opacityAnimationTime);O?a.gl.uniform1i(a.uniforms.drawSphere,0):a.gl.uniform1i(a.uniforms.drawSphere,1)});Page.Load.TextButtons.equalize();ma();C>=D?(a.gl.uniform1f(a.uniforms.aspectRatioX,C/D),a.gl.uniform1f(a.uniforms.aspectRatioY,1)):(a.gl.uniform1f(a.uniforms.aspectRatioX,1),a.gl.uniform1f(a.uniforms.aspectRatioY,C/D));a.gl.uniform1i(a.uniforms.imageSize,Q);a.gl.uniform3fv(a.uniforms.cameraPos,f);a.gl.uniform3fv(a.uniforms.imagePlaneCenterPos,
wa);a.gl.uniform3fv(a.uniforms.lightPos,[0,0,5]);a.gl.uniform3fv(a.uniforms.forwardVec,m);a.gl.uniform3fv(a.uniforms.rightVec,n);a.gl.uniform3fv(a.uniforms.upVec,J);a.gl.uniform1f(a.uniforms.focalLength,p);a.gl.uniform1i(a.uniforms.drawSphere,0);a.gl.uniform1f(a.uniforms.power,8);a.gl.uniform3fv(a.uniforms.c,c);a.gl.uniform1f(a.uniforms.juliaProportion,0);a.gl.uniformMatrix3fv(a.uniforms.rotationMatrix,!1,[1,0,0,0,1,0,0,0,1]);a.gl.uniform1i(a.uniforms.maxMarches,ta);a.gl.uniform1f(a.uniforms.stepFactor,
1);a.gl.uniform1i(a.uniforms.maxIterations,qa);window.requestAnimationFrame(B);Page.show();document.documentElement.addEventListener("keydown",Fa);Page.temporaryHandlers.keydown.push(Fa);document.documentElement.addEventListener("keyup",Ga);Page.temporaryHandlers.keydown.push(Ga)}();
