import{changeOpacity,opacityAnimationTime}from"/scripts/src/animation.min.mjs";import{Applet}from"/scripts/src/applets.min.mjs";import{addTemporaryWorker}from"/scripts/src/main.min.mjs";import{siteSettings}from"/scripts/src/settings.min.mjs";import{Wilson}from"/scripts/wilson.min.mjs";class CalcudokuGenerator extends Applet{gridSize=null;grid=[];cages=[];cagesByLocation=[];animateNextDraw=!1;webWorker=null;constructor(canvas){super(canvas);this.wilson=new Wilson(canvas,{renderer:"cpu",canvasWidth:500,canvasHeight:500})}async run({gridSize,maxCageSize}){1==this.canvas.style.opacity&&await changeOpacity(this.canvas,0),this.gridSize=gridSize,this.maxCageSize=maxCageSize;for(let i=0;i<this.gridSize;i++){this.cagesByLocation.push([]);for(let j=0;j<this.gridSize;j++)this.cagesByLocation[i].push(0)}gridSize=setTimeout(()=>{var canvasSize=200*this.gridSize+9;this.wilson.changeCanvasSize(canvasSize,canvasSize),this.wilson.ctx.clearRect(0,0,canvasSize,canvasSize)},opacityAnimationTime),this.timeoutIds.push(gridSize),this.webWorker=addTemporaryWorker("/applets/calcudoku-generator/scripts/worker.js"),this.animateNextDraw=!0,this.webWorker.onmessage=e=>{this.grid=e.data[0],this.cages=e.data[1],this.cagesByLocation=e.data[2],this.drawGrid(!1),this.animateNextDraw&&(this.animateNextDraw=!1,changeOpacity(this.canvas,1))},maxCageSize=setTimeout(()=>{this.webWorker.postMessage([this.gridSize,this.maxCageSize])},opacityAnimationTime);this.timeoutIds.push(maxCageSize)}drawGrid(printMode){var canvasSize=200*this.gridSize+9;printMode?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,canvasSize,canvasSize),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,canvasSize,canvasSize),siteSettings.darkTheme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let i=0;i<=this.gridSize;i++)this.wilson.ctx.fillRect(200*i+4,0,2,9+canvasSize),this.wilson.ctx.fillRect(0,200*i+4,9+canvasSize,2);for(let i=0;i<this.gridSize;i++)for(let j=0;j<this.gridSize;j++)0!==i&&this.cagesByLocation[i-1][j]===this.cagesByLocation[i][j]||this.wilson.ctx.fillRect(200*j,200*i,210,10),i!==this.gridSize-1&&this.cagesByLocation[i+1][j]===this.cagesByLocation[i][j]||this.wilson.ctx.fillRect(200*j,200*(i+1),210,10),0!==j&&this.cagesByLocation[i][j-1]===this.cagesByLocation[i][j]||this.wilson.ctx.fillRect(200*j,200*i,10,210),j!==this.gridSize-1&&this.cagesByLocation[i][j+1]===this.cagesByLocation[i][j]||this.wilson.ctx.fillRect(200*(j+1),200*i,10,210);for(let i=0;i<this.cages.length;i++){let topLeftCell=[this.gridSize,this.gridSize];for(let j=0;j<this.cages[i][2].length;j++){var row=this.cages[i][2][j][0],col=this.cages[i][2][j][1];(row<topLeftCell[0]||row===topLeftCell[0]&&col<topLeftCell[1])&&(topLeftCell=[row,col])}let label="",fontSize=(label="+"===this.cages[i][0]?this.cages[i][1]+"+":"x"===this.cages[i][0]?this.cages[i][1]+"×":"-"===this.cages[i][0]?this.cages[i][1]+"–":":"===this.cages[i][0]?this.cages[i][1]+":":this.cages[i][1]+"",null);fontSize=label.length<=6?(this.wilson.ctx.font="50px sans-serif",50):(this.wilson.ctx.font=300/label.length+"px sans-serif",300/label.length),this.wilson.ctx.fillText(label,200*topLeftCell[1]+15,200*topLeftCell[0]+fontSize+5)}}}export{CalcudokuGenerator};