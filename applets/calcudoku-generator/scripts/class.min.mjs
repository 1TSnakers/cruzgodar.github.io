import{Applet}from"/scripts/src/applets.min.mjs";class CalcudokuGenerator extends Applet{gridSize=null;grid=[];cages=[];cagesByLocation=[];animateNextDraw=!1;webWorker=null;constructor(i){super(i);this.wilson=new Wilson(i,{renderer:"cpu",canvasWidth:500,canvasHeight:500})}async run(i,t){1==this.canvas.style.opacity&&await changeOpacity(this.canvas,0,Site.opacityAnimationTime),this.gridSize=i,this.maxCageSize=t;for(let t=0;t<this.gridSize;t++){this.cagesByLocation.push([]);for(let i=0;i<this.gridSize;i++)this.cagesByLocation[t].push(0)}i=setTimeout(()=>{var i=200*this.gridSize+9;this.wilson.changeCanvasSize(i,i),this.wilson.ctx.clearRect(0,0,i,i)},Site.opacityAnimationTime);this.timeoutIds.push(i);try{this.webWorker.terminate()}catch(i){}this.webWorker=new Worker("/applets/calcudoku-generator/scripts/worker.min.js"),this.workers.push(this.webWorker),this.animateNextDraw=!0,this.webWorker.onmessage=i=>{this.grid=i.data[0],this.cages=i.data[1],this.cagesByLocation=i.data[2],this.drawGrid(!1),this.animateNextDraw&&(this.animateNextDraw=!1,changeOpacity(this.canvas,1,Site.opacityAnimationTime))};t=setTimeout(()=>{this.webWorker.postMessage([this.gridSize,this.maxCageSize])},Site.opacityAnimationTime);this.timeoutIds.push(t)}drawGrid(i){var t=200*this.gridSize+9;i?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,t,t),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,t,t),1===Site.Settings.urlVars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let i=0;i<=this.gridSize;i++)this.wilson.ctx.fillRect(200*i+4,0,2,9+t),this.wilson.ctx.fillRect(0,200*i+4,9+t,2);for(let t=0;t<this.gridSize;t++)for(let i=0;i<this.gridSize;i++)0!==t&&this.cagesByLocation[t-1][i]===this.cagesByLocation[t][i]||this.wilson.ctx.fillRect(200*i,200*t,210,10),t!==this.gridSize-1&&this.cagesByLocation[t+1][i]===this.cagesByLocation[t][i]||this.wilson.ctx.fillRect(200*i,200*(t+1),210,10),0!==i&&this.cagesByLocation[t][i-1]===this.cagesByLocation[t][i]||this.wilson.ctx.fillRect(200*i,200*t,10,210),i!==this.gridSize-1&&this.cagesByLocation[t][i+1]===this.cagesByLocation[t][i]||this.wilson.ctx.fillRect(200*(i+1),200*t,10,210);for(let e=0;e<this.cages.length;e++){let t=[this.gridSize,this.gridSize];for(let i=0;i<this.cages[e][2].length;i++){var a=this.cages[e][2][i][0],c=this.cages[e][2][i][1];(a<t[0]||a===t[0]&&c<t[1])&&(t=[a,c])}let i="",s=(i="+"===this.cages[e][0]?this.cages[e][1]+"+":"x"===this.cages[e][0]?this.cages[e][1]+"×":"-"===this.cages[e][0]?this.cages[e][1]+"–":":"===this.cages[e][0]?this.cages[e][1]+"꞉":this.cages[e][1]+"",null);s=i.length<=6?(this.wilson.ctx.font="50px sans-serif",50):(this.wilson.ctx.font=300/i.length+"px sans-serif",300/i.length),this.wilson.ctx.fillText(i,200*t[1]+15,200*t[0]+s+5)}}}export{CalcudokuGenerator};