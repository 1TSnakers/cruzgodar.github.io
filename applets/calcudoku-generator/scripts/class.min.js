"use strict";class CalcudokuGenerator extends Applet{grid_size=null;grid=[];cages=[];cages_by_location=[];old_cages_by_location=[];animate_next_draw=!1;web_worker=null;constructor(t){super(t);let i={renderer:"cpu",canvas_width:500,canvas_height:500};this.wilson=new Wilson(t,i),Site.scripts_loaded.lodash||Site.load_script("/scripts/lodash.min.js").then(()=>{Site.scripts_loaded.lodash=!0}).catch(t=>{console.error("Could not load Lodash")})}async run(t,i){1==this.canvas.style.opacity&&await Page.Animate.change_opacity(this.canvas,0,Site.opacity_animation_time),this.grid_size=t,this.max_cage_size=i;for(let s=0;s<this.grid_size;s++){this.cages_by_location.push([]);for(let e=0;e<this.grid_size;e++)this.cages_by_location[s].push(0)}let a=setTimeout(()=>{let t=200*this.grid_size+9;this.wilson.change_canvas_size(t,t),this.wilson.ctx.clearRect(0,0,t,t)},Site.opacity_animation_time);this.timeout_ids.push(a);try{this.web_worker.terminate()}catch(c){}this.web_worker=new Worker(`/applets/calcudoku-generator/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.web_worker),this.animate_next_draw=!0,this.web_worker.onmessage=t=>{this.grid=t.data[0],this.cages=t.data[1],this.old_cages_by_location=_.cloneDeep(this.cages_by_location),this.cages_by_location=t.data[2],this.draw_grid(!1),this.animate_next_draw&&(this.animate_next_draw=!1,Page.Animate.change_opacity(this.canvas,1,Site.opacity_animation_time))};let l=setTimeout(()=>{this.web_worker.postMessage([this.grid_size,this.max_cage_size])},Site.opacity_animation_time);this.timeout_ids.push(l)}draw_grid(t){let i=200*this.grid_size+9;t?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,i,i),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,i,i),1===Site.Settings.url_vars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let s=0;s<=this.grid_size;s++)this.wilson.ctx.fillRect(200*s+4,0,2,i+9),this.wilson.ctx.fillRect(0,200*s+4,i+9,2);for(let e=0;e<this.grid_size;e++)for(let a=0;a<this.grid_size;a++)(0===e||this.cages_by_location[e-1][a]!==this.cages_by_location[e][a])&&this.wilson.ctx.fillRect(200*a,200*e,210,10),(e===this.grid_size-1||this.cages_by_location[e+1][a]!==this.cages_by_location[e][a])&&this.wilson.ctx.fillRect(200*a,200*(e+1),210,10),(0===a||this.cages_by_location[e][a-1]!==this.cages_by_location[e][a])&&this.wilson.ctx.fillRect(200*a,200*e,10,210),(a===this.grid_size-1||this.cages_by_location[e][a+1]!==this.cages_by_location[e][a])&&this.wilson.ctx.fillRect(200*(a+1),200*e,10,210);for(let c=0;c<this.cages.length;c++){let l=[this.grid_size,this.grid_size];for(let h=0;h<this.cages[c][2].length;h++){let o=this.cages[c][2][h][0],n=this.cages[c][2][h][1];o<l[0]?l=[o,n]:o===l[0]&&n<l[1]&&(l=[o,n])}let $="";$="+"===this.cages[c][0]?this.cages[c][1]+"+":"x"===this.cages[c][0]?this.cages[c][1]+"\xd7":"-"===this.cages[c][0]?this.cages[c][1]+"–":":"===this.cages[c][0]?this.cages[c][1]+"꞉":this.cages[c][1]+"";let r=null;$.length<=6?(this.wilson.ctx.font="50px sans-serif",r=50):(this.wilson.ctx.font=300/$.length+"px sans-serif",r=300/$.length),this.wilson.ctx.fillText($,200*l[1]+15,200*l[0]+r+5)}}}