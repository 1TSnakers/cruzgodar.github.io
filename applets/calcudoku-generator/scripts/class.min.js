class CalcudokuGenerator extends Applet{gridSize=null;grid=[];cages=[];cagesByLocation=[];animateNextDraw=!1;webWorker=null;constructor(a){super(a);this.wilson=new Wilson(a,{renderer:"cpu",canvasWidth:500,canvasHeight:500})}async run(a,b){1==this.canvas.style.opacity&&await Page.Animate.changeOpacity(this.canvas,0,Site.opacityAnimationTime);this.gridSize=a;this.maxCageSize=b;for(a=0;a<this.gridSize;a++)for(this.cagesByLocation.push([]),b=0;b<this.gridSize;b++)this.cagesByLocation[a].push(0);a=setTimeout(()=>
{const c=200*this.gridSize+9;this.wilson.changeCanvasSize(c,c);this.wilson.ctx.clearRect(0,0,c,c)},Site.opacityAnimationTime);this.timeoutIds.push(a);try{this.webWorker.terminate()}catch(c){}this.webWorker=new Worker(`/applets/calcudoku-generator/scripts/worker.${DEBUG?"":"min."}js`);this.workers.push(this.webWorker);this.animateNextDraw=!0;this.webWorker.onmessage=c=>{this.grid=c.data[0];this.cages=c.data[1];this.cagesByLocation=c.data[2];this.drawGrid(!1);this.animateNextDraw&&(this.animateNextDraw=
!1,Page.Animate.changeOpacity(this.canvas,1,Site.opacityAnimationTime))};a=setTimeout(()=>{this.webWorker.postMessage([this.gridSize,this.maxCageSize])},Site.opacityAnimationTime);this.timeoutIds.push(a)}drawGrid(a){var b=200*this.gridSize+9;a?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,b,b),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,b,b),this.wilson.ctx.fillStyle=1===Site.Settings.urlVars.theme?"rgb(192, 192, 192)":"rgb(64, 64, 64)");
for(a=0;a<=this.gridSize;a++)this.wilson.ctx.fillRect(200*a+4,0,2,b+9),this.wilson.ctx.fillRect(0,200*a+4,b+9,2);for(b=0;b<this.gridSize;b++)for(a=0;a<this.gridSize;a++)0!==b&&this.cagesByLocation[b-1][a]===this.cagesByLocation[b][a]||this.wilson.ctx.fillRect(200*a,200*b,210,10),b!==this.gridSize-1&&this.cagesByLocation[b+1][a]===this.cagesByLocation[b][a]||this.wilson.ctx.fillRect(200*a,200*(b+1),210,10),0!==a&&this.cagesByLocation[b][a-1]===this.cagesByLocation[b][a]||this.wilson.ctx.fillRect(200*
a,200*b,10,210),a!==this.gridSize-1&&this.cagesByLocation[b][a+1]===this.cagesByLocation[b][a]||this.wilson.ctx.fillRect(200*(a+1),200*b,10,210);for(b=0;b<this.cages.length;b++){a=[this.gridSize,this.gridSize];for(var c=0;c<this.cages[b][2].length;c++){var d=this.cages[b][2][c][0];const e=this.cages[b][2][c][1];d<a[0]?a=[d,e]:d===a[0]&&e<a[1]&&(a=[d,e])}c="+"===this.cages[b][0]?this.cages[b][1]+"+":"x"===this.cages[b][0]?this.cages[b][1]+"\u00d7":"-"===this.cages[b][0]?this.cages[b][1]+"\u2013":":"===
this.cages[b][0]?this.cages[b][1]+"\ua789":this.cages[b][1]+"";6>=c.length?(this.wilson.ctx.font="50px sans-serif",d=50):(this.wilson.ctx.font=300/c.length+"px sans-serif",d=300/c.length);this.wilson.ctx.fillText(c,200*a[1]+15,200*a[0]+d+5)}}};
