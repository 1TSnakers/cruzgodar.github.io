"use strict";class CalcudokuGenerator extends Applet{gridSize=null;grid=[];cages=[];cagesByLocation=[];animateNextDraw=!1;webWorker=null;constructor(i){super(i);let t={renderer:"cpu",canvasWidth:500,canvasHeight:500};this.wilson=new Wilson(i,t)}async run(i,t){1==this.canvas.style.opacity&&await Page.Animate.changeOpacity(this.canvas,0,Site.opacityAnimationTime),this.gridSize=i,this.maxCageSize=t;for(let s=0;s<this.gridSize;s++){this.cagesByLocation.push([]);for(let e=0;e<this.gridSize;e++)this.cagesByLocation[s].push(0)}let a=setTimeout(()=>{let i=200*this.gridSize+9;this.wilson.changeCanvasSize(i,i),this.wilson.ctx.clearRect(0,0,i,i)},Site.opacityAnimationTime);this.timeoutIds.push(a);try{this.webWorker.terminate()}catch(c){}this.webWorker=new Worker(`/applets/calcudoku-generator/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.webWorker),this.animateNextDraw=!0,this.webWorker.onmessage=i=>{this.grid=i.data[0],this.cages=i.data[1],this.cagesByLocation=i.data[2],this.drawGrid(!1),this.animateNextDraw&&(this.animateNextDraw=!1,Page.Animate.changeOpacity(this.canvas,1,Site.opacityAnimationTime))};let h=setTimeout(()=>{this.webWorker.postMessage([this.gridSize,this.maxCageSize])},Site.opacityAnimationTime);this.timeoutIds.push(h)}drawGrid(i){let t=200*this.gridSize+9;i?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,t,t),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,t,t),1===Site.Settings.urlVars.theme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let s=0;s<=this.gridSize;s++)this.wilson.ctx.fillRect(200*s+4,0,2,t+9),this.wilson.ctx.fillRect(0,200*s+4,t+9,2);for(let e=0;e<this.gridSize;e++)for(let a=0;a<this.gridSize;a++)(0===e||this.cagesByLocation[e-1][a]!==this.cagesByLocation[e][a])&&this.wilson.ctx.fillRect(200*a,200*e,210,10),(e===this.gridSize-1||this.cagesByLocation[e+1][a]!==this.cagesByLocation[e][a])&&this.wilson.ctx.fillRect(200*a,200*(e+1),210,10),(0===a||this.cagesByLocation[e][a-1]!==this.cagesByLocation[e][a])&&this.wilson.ctx.fillRect(200*a,200*e,10,210),(a===this.gridSize-1||this.cagesByLocation[e][a+1]!==this.cagesByLocation[e][a])&&this.wilson.ctx.fillRect(200*(a+1),200*e,10,210);for(let c=0;c<this.cages.length;c++){let h=[this.gridSize,this.gridSize];for(let l=0;l<this.cages[c][2].length;l++){let $=this.cages[c][2][l][0],n=this.cages[c][2][l][1];$<h[0]?h=[$,n]:$===h[0]&&n<h[1]&&(h=[$,n])}let o="";o="+"===this.cages[c][0]?this.cages[c][1]+"+":"x"===this.cages[c][0]?this.cages[c][1]+"\xd7":"-"===this.cages[c][0]?this.cages[c][1]+"–":":"===this.cages[c][0]?this.cages[c][1]+"꞉":this.cages[c][1]+"";let r=null;o.length<=6?(this.wilson.ctx.font="50px sans-serif",r=50):(this.wilson.ctx.font=300/o.length+"px sans-serif",r=300/o.length),this.wilson.ctx.fillText(o,200*h[1]+15,200*h[0]+r+5)}}}