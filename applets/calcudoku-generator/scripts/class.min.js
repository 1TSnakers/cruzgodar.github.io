import{Applet}from"../../../scripts/applets/applet.min.js";import{changeOpacity,opacityAnimationTime}from"/scripts/src/animation.min.js";import{addTemporaryWorker}from"/scripts/src/main.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{Wilson}from"/scripts/wilson.min.js";class CalcudokuGenerator extends Applet{gridSize=null;grid=[];cages=[];cagesByLocation=[];animateNextDraw=!1;webWorker=null;constructor({canvas}){super(canvas);this.wilson=new Wilson(canvas,{renderer:"cpu",canvasWidth:500,canvasHeight:500})}async run({gridSize,maxCageSize}){1==this.canvas.style.opacity&&await changeOpacity(this.canvas,0),this.gridSize=gridSize,this.maxCageSize=maxCageSize;for(let t=0;t<this.gridSize;t++){this.cagesByLocation.push([]);for(let i=0;i<this.gridSize;i++)this.cagesByLocation[t].push(0)}var i=setTimeout(()=>{var i=200*this.gridSize+9;this.wilson.changeCanvasSize(i,i),this.wilson.ctx.clearRect(0,0,i,i)},opacityAnimationTime),i=(this.timeoutIds.push(i),this.webWorker=addTemporaryWorker("/applets/calcudoku-generator/scripts/worker.js"),this.animateNextDraw=!0,this.webWorker.onmessage=e=>{this.grid=e.data[0],this.cages=e.data[1],this.cagesByLocation=e.data[2],this.drawGrid(!1),this.animateNextDraw&&(this.animateNextDraw=!1,changeOpacity(this.canvas,1))},setTimeout(()=>{this.webWorker.postMessage([this.gridSize,this.maxCageSize])},opacityAnimationTime));this.timeoutIds.push(i)}drawGrid(printMode){var i=200*this.gridSize+9;printMode?(this.wilson.ctx.fillStyle="rgb(255, 255, 255)",this.wilson.ctx.fillRect(0,0,i,i),this.wilson.ctx.fillStyle="rgb(0, 0, 0)"):(this.wilson.ctx.clearRect(0,0,i,i),siteSettings.darkTheme?this.wilson.ctx.fillStyle="rgb(192, 192, 192)":this.wilson.ctx.fillStyle="rgb(64, 64, 64)");for(let t=0;t<=this.gridSize;t++)this.wilson.ctx.fillRect(200*t+4,0,2,9+i),this.wilson.ctx.fillRect(0,200*t+4,9+i,2);for(let s=0;s<this.gridSize;s++)for(let i=0;i<this.gridSize;i++)0!==s&&this.cagesByLocation[s-1][i]===this.cagesByLocation[s][i]||this.wilson.ctx.fillRect(200*i,200*s,210,10),s!==this.gridSize-1&&this.cagesByLocation[s+1][i]===this.cagesByLocation[s][i]||this.wilson.ctx.fillRect(200*i,200*(s+1),210,10),0!==i&&this.cagesByLocation[s][i-1]===this.cagesByLocation[s][i]||this.wilson.ctx.fillRect(200*i,200*s,10,210),i!==this.gridSize-1&&this.cagesByLocation[s][i+1]===this.cagesByLocation[s][i]||this.wilson.ctx.fillRect(200*(i+1),200*s,10,210);for(let r=0;r<this.cages.length;r++){let i=[this.gridSize,this.gridSize];for(let e=0;e<this.cages[r][2].length;e++){var a=this.cages[r][2][e][0],c=this.cages[r][2][e][1];(a<i[0]||a===i[0]&&c<i[1])&&(i=[a,c])}let t="",s=(t="+"===this.cages[r][0]?this.cages[r][1]+"+":"x"===this.cages[r][0]?this.cages[r][1]+"×":"-"===this.cages[r][0]?this.cages[r][1]+"–":":"===this.cages[r][0]?this.cages[r][1]+":":this.cages[r][1]+"",null);s=t.length<=6?(this.wilson.ctx.font="50px sans-serif",50):(this.wilson.ctx.font=300/t.length+"px sans-serif",300/t.length),this.wilson.ctx.fillText(t,200*i[1]+15,200*i[0]+s+5)}}}export{CalcudokuGenerator};