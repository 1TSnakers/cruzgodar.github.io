import{Applet}from"/scripts/src/applets.min.min.min.mjs";import{aspectRatio}from"/scripts/src/layout.min.min.min.mjs";class BinaryTree extends Applet{root=[];branchPoints=[];numPreviewIterations=5;webWorker=null;constructor(t){super(t);var s={renderer:"cpu",canvasWidth:2e3,canvasHeight:2e3,useDraggables:!0,draggablesMousedownCallback:this.onGrabDraggable.bind(this),draggablesTouchstartCallback:this.onGrabDraggable.bind(this),draggablesMousemoveCallback:this.onDragDraggable.bind(this),draggablesTouchmoveCallback:this.onDragDraggable.bind(this),draggablesMouseupCallback:this.onReleaseDraggable.bind(this),draggablesTouchendCallback:this.onReleaseDraggable.bind(this),useFullscreen:!0,trueFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png",switchFullscreenCallback:()=>this.changeAspectRatio()};this.wilson=new Wilson(t,s),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight),this.initBranchMarkers()}preview(t,s){this.root=t,this.branchPoints=s,this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight);let i=[Math.atan2(this.branchPoints[0][0]-this.root[0],this.branchPoints[0][1]-this.root[1]),Math.atan2(this.branchPoints[1][0]-this.root[0],this.branchPoints[1][1]-this.root[1])];var e=(i[0]-i[1])/2,a=[Math.sqrt((this.branchPoints[0][0]-this.root[0])*(this.branchPoints[0][0]-this.root[0])+(this.branchPoints[0][1]-this.root[1])*(this.branchPoints[0][1]-this.root[1])),Math.sqrt((this.branchPoints[1][0]-this.root[0])*(this.branchPoints[1][0]-this.root[0])+(this.branchPoints[1][1]-this.root[1])*(this.branchPoints[1][1]-this.root[1]))];let o=[this.root],n=1;for(let t=0;t<this.numPreviewIterations;t++){var r=[],h=[],l=(this.wilson.ctx.lineWidth=20*n+1,139*Math.sqrt(n)),c=69*Math.sqrt(n)+128*(1-Math.sqrt(n)),b=19*Math.sqrt(n);this.wilson.ctx.strokeStyle=`rgb(${l}, ${c}, ${b})`;for(let t=0;t<o.length;t++){var w=o[t][1],g=o[t][0],d=o[t][1]+a[0]*n*Math.cos(i[2*t]),p=o[t][0]+a[0]*n*Math.sin(i[2*t]);this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(w,g),this.wilson.ctx.lineTo(d,p),this.wilson.ctx.stroke(),r.push([p,d]),h.push(i[2*t]-e),h.push(i[2*t]+e),w=o[t][1],g=o[t][0],d=o[t][1]+a[1]*n*Math.cos(i[2*t+1]),p=o[t][0]+a[1]*n*Math.sin(i[2*t+1]),this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(w,g),this.wilson.ctx.lineTo(d,p),this.wilson.ctx.stroke(),r.push([p,d]),h.push(i[2*t+1]-e),h.push(i[2*t+1]+e)}o=r,i=h,n*=.675}}animate(t,s){this.root=t,this.branchPoints=s;try{this.webWorker.terminate()}catch(t){}this.webWorker=new Worker("/applets/binary-trees/scripts/worker.min.js"),this.workers.push(this.webWorker),this.webWorker.onmessage=t=>{var s;"done"===t.data[0]?(s=setTimeout(()=>{Page.setElementStyles(".wilson-draggable","opacity",1)},500),this.timeoutIds.push(s)):(this.wilson.ctx.strokeStyle=t.data[4],this.wilson.ctx.lineWidth=t.data[5],this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(t.data[0],t.data[1]),this.wilson.ctx.lineTo(t.data[2],t.data[3]),this.wilson.ctx.stroke())},this.webWorker.postMessage([this.root,this.branchPoints])}initBranchMarkers(){this.wilson.draggables.add(-1/7,-1/3),this.wilson.draggables.add(1/7,-1/3),this.root=this.wilson.utils.interpolate.worldToCanvas(0,-.8),this.branchPoints[0]=this.wilson.utils.interpolate.worldToCanvas(-1/7,-1/3),this.branchPoints[1]=this.wilson.utils.interpolate.worldToCanvas(1/7,-1/3),this.preview(this.root,this.branchPoints)}onGrabDraggable(t,s,i,e){try{this.webWorker.terminate()}catch(t){}Page.setElementStyles(".wilson-draggable","opacity",1),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight),this.preview(this.root,this.branchPoints)}onDragDraggable(t,s,i,e){this.branchPoints[t]=this.wilson.utils.interpolate.worldToCanvas(s,i),this.preview(this.root,this.branchPoints)}onReleaseDraggable(t,s,i,e){document.body.style.WebkitUserSelect="",Page.setElementStyles(".wilson-draggable","opacity",0);let a=0;const o=this,n=setInterval(()=>{var t=a/37;o.wilson.ctx.fillStyle=`rgba(0, 0, 0, ${t})`,o.wilson.ctx.fillRect(0,0,o.wilson.canvasWidth,o.wilson.canvasHeight),a++},8);this.refreshIds.push(n);var r=setTimeout(()=>{clearInterval(n),o.wilson.ctx.fillStyle="rgb(0, 0, 0)",o.wilson.ctx.fillRect(0,0,o.wilson.canvasWidth,o.wilson.canvasHeight),o.animate(o.root,o.branchPoints)},Site.opacityAnimationTime);this.timeoutIds.push(r)}changeAspectRatio(){try{this.webWorker.terminate()}catch(t){}Page.setElementStyles(".wilson-draggable","opacity",1),this.wilson.fullscreen.currentlyFullscreen?1<=aspectRatio?this.wilson.changeCanvasSize(2e3,2e3/aspectRatio):this.wilson.changeCanvasSize(2e3*aspectRatio,2e3):this.wilson.changeCanvasSize(2e3,2e3),this.wilson.draggables.recalculateLocations(),this.root=this.wilson.utils.interpolate.worldToCanvas(0,-.8),this.branchPoints[0]=this.wilson.utils.interpolate.worldToCanvas(...this.wilson.draggables.worldCoordinates[0]),this.branchPoints[1]=this.wilson.utils.interpolate.worldToCanvas(...this.wilson.draggables.worldCoordinates[1]),this.preview(this.root,this.branchPoints)}}export{BinaryTree};