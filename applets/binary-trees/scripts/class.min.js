import{Applet}from"../../../scripts/applets/applet.min.js";import{opacityAnimationTime}from"/scripts/src/animation.min.js";import{convertColor}from"/scripts/src/browser.min.js";import{$$,addTemporaryInterval,addTemporaryWorker}from"/scripts/src/main.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{WilsonCPU}from"/scripts/wilson.min.js";class BinaryTrees extends Applet{resolution=3e3;root=[];branchPoints=[];numPreviewIterations=5;webWorker;constructor({canvas}){super(canvas);var t={canvasWidth:this.resolution,reduceMotion:siteSettings.reduceMotion,onResizeCanvas:this.drawFrame.bind(this),draggableOptions:{draggables:{branch0:[-1/7,-1/3],branch1:[1/7,-1/3]},callbacks:{ondrag:this.onDragDraggable.bind(this),onrelease:this.onReleaseDraggable.bind(this)}},fullscreenOptions:{fillScreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"}};this.wilson=new WilsonCPU(canvas,t),this.wilson.ctx.fillStyle=convertColor(0,0,0),this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight),this.root=this.wilson.interpolateWorldToCanvas([0,-.8]),this.branchPoints[0]=this.wilson.interpolateWorldToCanvas(this.wilson.draggables.branch0.location),this.branchPoints[1]=this.wilson.interpolateWorldToCanvas(this.wilson.draggables.branch1.location)}preview(){this.wilson.ctx.fillStyle=convertColor(0,0,0),this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight);let s=[Math.atan2(this.branchPoints[0][0]-this.root[0],this.branchPoints[0][1]-this.root[1]),Math.atan2(this.branchPoints[1][0]-this.root[0],this.branchPoints[1][1]-this.root[1])];var i=(s[0]-s[1])/2,o=[Math.sqrt((this.branchPoints[0][0]-this.root[0])*(this.branchPoints[0][0]-this.root[0])+(this.branchPoints[0][1]-this.root[1])*(this.branchPoints[0][1]-this.root[1])),Math.sqrt((this.branchPoints[1][0]-this.root[0])*(this.branchPoints[1][0]-this.root[0])+(this.branchPoints[1][1]-this.root[1])*(this.branchPoints[1][1]-this.root[1]))];let e=[this.root],n=1;for(let t=0;t<this.numPreviewIterations;t++){var a=[],r=[],l=(this.wilson.ctx.lineWidth=20*n+1,139*Math.sqrt(n)),h=69*Math.sqrt(n)+128*(1-Math.sqrt(n)),c=19*Math.sqrt(n);this.wilson.ctx.strokeStyle=convertColor(l,h,c);for(let t=0;t<e.length;t++){var w=e[t][1],b=e[t][0],p=e[t][1]+o[0]*n*Math.cos(s[2*t]),d=e[t][0]+o[0]*n*Math.sin(s[2*t]);this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(w,b),this.wilson.ctx.lineTo(p,d),this.wilson.ctx.stroke(),a.push([d,p]),r.push(s[2*t]-i),r.push(s[2*t]+i),w=e[t][1],b=e[t][0],p=e[t][1]+o[1]*n*Math.cos(s[2*t+1]),d=e[t][0]+o[1]*n*Math.sin(s[2*t+1]),this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(w,b),this.wilson.ctx.lineTo(p,d),this.wilson.ctx.stroke(),a.push([d,p]),r.push(s[2*t+1]-i),r.push(s[2*t+1]+i)}e=a,s=r,n*=.675}}animate(root,branchPoints){this.root=root,this.branchPoints=branchPoints,this.webWorker=addTemporaryWorker("/applets/binary-trees/scripts/worker.js"),this.webWorker.onmessage=e=>{var t;"done"===e.data[0]?(t=setTimeout(()=>{$$(".wilson-draggable").forEach(element=>element.style.opacity=1)},500),this.timeoutIds.push(t)):(this.wilson.ctx.strokeStyle=convertColor(...e.data[4]),this.wilson.ctx.lineWidth=e.data[5],this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(e.data[0],e.data[1]),this.wilson.ctx.lineTo(e.data[2],e.data[3]),this.wilson.ctx.stroke())},this.webWorker.postMessage([this.root,this.branchPoints])}initBranchMarkers(){this.wilson.draggables.add(-1/7,-1/3),this.wilson.draggables.add(1/7,-1/3),this.root=this.wilson.utils.interpolate.worldToCanvas(0,-.8),this.branchPoints[0]=this.wilson.utils.interpolate.worldToCanvas(-1/7,-1/3),this.branchPoints[1]=this.wilson.utils.interpolate.worldToCanvas(1/7,-1/3),this.preview(this.root,this.branchPoints)}onGrabDraggable(){this.webWorker?.terminate&&this.webWorker.terminate(),$$(".wilson-draggable").forEach(element=>element.style.opacity=1),this.wilson.ctx.fillStyle=convertColor(0,0,0),this.wilson.ctx.fillRect(0,0,this.wilson.canvasWidth,this.wilson.canvasHeight),this.preview(this.root,this.branchPoints)}onDragDraggable(activeDraggable,x,y){this.branchPoints[activeDraggable]=this.wilson.utils.interpolate.worldToCanvas(x,y),this.preview(this.root,this.branchPoints)}onReleaseDraggable(){document.body.style.WebkitUserSelect="",$$(".wilson-draggable").forEach(element=>element.style.opacity=0);let s=0;const i=this;const t=addTemporaryInterval({callback:()=>{var t=s/37;i.wilson.ctx.fillStyle=convertColor(0,0,0,t),i.wilson.ctx.fillRect(0,0,i.wilson.canvasWidth,i.wilson.canvasHeight),s++},delay:8});var o=setTimeout(()=>{clearInterval(t),i.wilson.ctx.fillStyle=convertColor(0,0,0),i.wilson.ctx.fillRect(0,0,i.wilson.canvasWidth,i.wilson.canvasHeight),i.animate(i.root,i.branchPoints)},opacityAnimationTime);this.timeoutIds.push(o)}onResizeCanvas(){this.webWorker?.terminate&&this.webWorker.terminate(),this.wilson.draggables.branch0.element.style.opacity=1,this.wilson.draggables.branch1.element.style.opacity=1,this.root=this.wilson.interpolateWorldToCanvas([0,-.8]),this.branchPoints[0]=this.wilson.interpolateWorldToCanvas(this.wilson.draggables.branch0.location),this.branchPoints[1]=this.wilson.interpolateWorldToCanvas(this.wilson.draggables.branch1.location),this.preview()}}export{BinaryTrees};