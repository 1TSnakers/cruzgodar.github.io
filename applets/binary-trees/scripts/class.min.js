"use strict";class BinaryTree extends Applet{root=[];branch_points=[];num_preview_iterations=5;web_worker=null;constructor(t){super(t);let s={renderer:"cpu",canvas_width:2e3,canvas_height:2e3,use_draggables:!0,draggables_mousedown_callback:this.on_grab_draggable.bind(this),draggables_touchstart_callback:this.on_grab_draggable.bind(this),draggables_mousemove_callback:this.on_drag_draggable.bind(this),draggables_touchmove_callback:this.on_drag_draggable.bind(this),draggables_mouseup_callback:this.on_release_draggable.bind(this),draggables_touchend_callback:this.on_release_draggable.bind(this),use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:this.change_aspect_ratio.bind(this)};this.wilson=new Wilson(t,s),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvas_width,this.wilson.canvas_height),this.init_branch_markers()}preview(t,s){this.root=t,this.branch_points=s,this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvas_width,this.wilson.canvas_height);let i=[Math.atan2(this.branch_points[0][0]-this.root[0],this.branch_points[0][1]-this.root[1]),Math.atan2(this.branch_points[1][0]-this.root[0],this.branch_points[1][1]-this.root[1])],e=(i[0]-i[1])/2,o=[Math.sqrt((this.branch_points[0][0]-this.root[0])*(this.branch_points[0][0]-this.root[0])+(this.branch_points[0][1]-this.root[1])*(this.branch_points[0][1]-this.root[1])),Math.sqrt((this.branch_points[1][0]-this.root[0])*(this.branch_points[1][0]-this.root[0])+(this.branch_points[1][1]-this.root[1])*(this.branch_points[1][1]-this.root[1]))],a=[this.root],n=1;for(let l=0;l<this.num_preview_iterations;l++){let r=[],h=[];this.wilson.ctx.lineWidth=20*n+1;let c=139*Math.sqrt(n),w=69*Math.sqrt(n)+(1-Math.sqrt(n))*128,$=19*Math.sqrt(n);this.wilson.ctx.strokeStyle=`rgb(${c}, ${w}, ${$})`;for(let b=0;b<a.length;b++){let g=a[b][1],d=a[b][0],p=a[b][1]+o[0]*n*Math.cos(i[2*b]),u=a[b][0]+o[0]*n*Math.sin(i[2*b]);this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(g,d),this.wilson.ctx.lineTo(p,u),this.wilson.ctx.stroke(),r.push([u,p]),h.push(i[2*b]-e),h.push(i[2*b]+e),g=a[b][1],d=a[b][0],p=a[b][1]+o[1]*n*Math.cos(i[2*b+1]),u=a[b][0]+o[1]*n*Math.sin(i[2*b+1]),this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(g,d),this.wilson.ctx.lineTo(p,u),this.wilson.ctx.stroke(),r.push([u,p]),h.push(i[2*b+1]-e),h.push(i[2*b+1]+e)}a=r,i=h,n*=.675}}animate(t,s){this.root=t,this.branch_points=s;try{this.web_worker.terminate()}catch(i){}this.web_worker=new Worker(`/applets/binary-trees/scripts/worker.${DEBUG?"":"min."}js`),this.workers.push(this.web_worker),this.web_worker.onmessage=t=>{if("done"===t.data[0]){let s=setTimeout(()=>{Page.set_element_styles(".wilson-draggable","opacity",1)},500);this.timeout_ids.push(s);return}this.wilson.ctx.strokeStyle=t.data[4],this.wilson.ctx.lineWidth=t.data[5],this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(t.data[0],t.data[1]),this.wilson.ctx.lineTo(t.data[2],t.data[3]),this.wilson.ctx.stroke()},this.web_worker.postMessage([this.root,this.branch_points])}init_branch_markers(){this.wilson.draggables.add(-1/7,-1/3),this.wilson.draggables.add(1/7,-1/3),this.root=this.wilson.utils.interpolate.world_to_canvas(0,-.8),this.branch_points[0]=this.wilson.utils.interpolate.world_to_canvas(-1/7,-1/3),this.branch_points[1]=this.wilson.utils.interpolate.world_to_canvas(1/7,-1/3),this.preview(this.root,this.branch_points)}on_grab_draggable(t,s,i,e){try{this.web_worker.terminate()}catch(o){}Page.set_element_styles(".wilson-draggable","opacity",1),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.wilson.canvas_width,this.wilson.canvas_height),this.preview(this.root,this.branch_points)}on_drag_draggable(t,s,i,e){this.branch_points[t]=this.wilson.utils.interpolate.world_to_canvas(s,i),this.preview(this.root,this.branch_points)}on_release_draggable(t,s,i,e){document.body.style.WebkitUserSelect="",Page.set_element_styles(".wilson-draggable","opacity",0);let o=0,a=this,n=setInterval(()=>{let t=o/37;a.wilson.ctx.fillStyle=`rgba(0, 0, 0, ${t})`,a.wilson.ctx.fillRect(0,0,a.wilson.canvas_width,a.wilson.canvas_height),o++},8);this.refresh_ids.push(n);let l=setTimeout(()=>{clearInterval(n),a.wilson.ctx.fillStyle="rgb(0, 0, 0)",a.wilson.ctx.fillRect(0,0,a.wilson.canvas_width,a.wilson.canvas_height),a.animate(a.root,a.branch_points)},Site.opacity_animation_time);this.timeout_ids.push(l)}change_aspect_ratio(){try{this.web_worker.terminate()}catch(t){}Page.set_element_styles(".wilson-draggable","opacity",1),this.wilson.fullscreen.currently_fullscreen?Page.Layout.aspect_ratio>=1?this.wilson.change_canvas_size(2e3,2e3/Page.Layout.aspect_ratio):this.wilson.change_canvas_size(2e3*Page.Layout.aspect_ratio,2e3):this.wilson.change_canvas_size(2e3,2e3),this.wilson.draggables.recalculate_locations(),this.root=this.wilson.utils.interpolate.world_to_canvas(0,-.8),this.branch_points[0]=this.wilson.utils.interpolate.world_to_canvas(...this.wilson.draggables.world_coordinates[0]),this.branch_points[1]=this.wilson.utils.interpolate.world_to_canvas(...this.wilson.draggables.world_coordinates[1]),this.preview(this.root,this.branch_points)}}