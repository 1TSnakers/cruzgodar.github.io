!async function(){"use strict";await Site.load_glsl();let e=null,r=null,t="cadd(cpow(z, 2.0), c)",n=0,o=1,i=200,a=1,l=0,c=[],s=0,u=0,d=500,$=0,m=0,w=0,f=0,h=0,g=0,p=0,v=0,_=-1,b=Page.element.querySelector("#code-textarea");b.value="cadd(cpow(z, 2.0), c)",b.addEventListener("keydown",e=>{13===e.keyCode&&(e.preventDefault(),S())});let y=Page.element.querySelector("#resolution-input");y.addEventListener("input",()=>{d=parseInt(y.value||500),e.change_canvas_size(d,d)});let z=Page.element.querySelector("#exposure-input");z.addEventListener("input",()=>{a=parseFloat(z.value||1)});let x=Page.element.querySelector("#num-iterations-input");x.addEventListener("input",()=>{i=parseInt(x.value||200)});Page.element.querySelector("#download-button").addEventListener("click",()=>{e.download_frame("a-generalized-julia-set.png")});Page.element.querySelector("#generate-button").addEventListener("click",S);let k=Page.element.querySelector("#switch-julia-mode-button");k.style.opacity=1,k.addEventListener("click",()=>{Page.Animate.change_opacity(k,0,Site.opacity_animation_time),setTimeout(()=>{2===n?k.textContent="Return to Mandelbrot Set":0===n&&(k.textContent="Pick Julia Set",Page.Animate.change_opacity(k,1,Site.opacity_animation_time))},Site.opacity_animation_time),0===n?(n=2,s=0,u=0,g=0,p=0,v=0,w=0,f=0,h=0,c=[],window.requestAnimationFrame(D)):1===n&&(n=0,e.world_center_x=0,e.world_center_y=0,e.world_width=4,e.world_height=4,l=0,c=[],window.requestAnimationFrame(D))});let q=Page.element.querySelector("#canvas-location"),F={none:"",mandelbrot:"cadd(cpow(z, 2.0), c)","var-exp":"cadd(cpow(z, 4.0), c)",trig:"csin(cmul(z, c))","burning-ship":"cadd(cpow(vec2(abs(z.x), -abs(z.y)), 2.0), c)","rational-map":"cadd(csub(cpow(z, 2.0), cmul(.05, cpow(z, -2.0))), c)","mandelbrot-dust":"cadd(csub(cpow(z, 2.0), vec2(0.0, cmul(.05, cpow(z, -2.0).y))), c)"},A=Page.element.querySelector("#example-selector-dropdown");function S(){t=b.value||"cadd(cpow(z, 2.0), c)";let o=`
   precision highp float;
   
   varying vec2 uv;
   
   uniform int julia_mode;
   
   uniform float aspect_ratio;
   
   uniform float world_center_x;
   uniform float world_center_y;
   uniform float world_size;
   
   uniform float a;
   uniform float b;
   uniform float exposure;
   uniform int num_iterations;
   uniform float brightness_scale;
   
   
   
   ${Site.get_glsl_bundle(t)}
   
   
   
   void main(void)
   {
    vec2 z;
    
    if (aspect_ratio >= 1.0)
    {
     z = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);
    }
    
    else
    {
     z = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);
    }
    
    vec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));
    float brightness = exp(-length(z));
    
    
    
    if (julia_mode == 0)
    {
     vec2 c = z;
     
     for (int iteration = 0; iteration < 3001; iteration++)
     {
      if (iteration == num_iterations)
      {
       gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
       return;
      }
      
      if (length(z) >= 4.0)
      {
       break;
      }
      
      z = ${t};
      
      brightness += exp(-length(z));
     }
     
     
     gl_FragColor = vec4(brightness / brightness_scale * exposure * color, 1.0);
    }
    
    
    
    else if (julia_mode == 1)
    {
     vec2 c = vec2(a, b);
     
     for (int iteration = 0; iteration < 3001; iteration++)
     {
      if (iteration == num_iterations)
      {
       gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
       return;
      }
      
      if (length(z) >= 4.0)
      {
       break;
      }
      
      z = ${t};
      
      brightness += exp(-length(z));
     }
     
     
     gl_FragColor = vec4(brightness / brightness_scale * exposure * color, 1.0);
    }
    
    
    
    else
    {
     vec2 c = z;
     
     bool broken = false;
     
     for (int iteration = 0; iteration < 3001; iteration++)
     {
      if (iteration == num_iterations)
      {
       gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
       
       broken = true;
       
       break;
      }
      
      if (length(z) >= 4.0)
      {
       break;
      }
      
      z = ${t};
      
      brightness += exp(-length(z));
     }
     
     
     
     if (!broken)
     {
      gl_FragColor = vec4(.5 * brightness / brightness_scale * exposure * color, 1.0);
     }
     
     
     
     z = vec2(uv.x * aspect_ratio * 2.0, uv.y * 2.0);
     color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));
     brightness = exp(-length(z));
     
     broken = false;
     
     c = vec2(a, b);
     
     for (int iteration = 0; iteration < 3001; iteration++)
     {
      if (iteration == num_iterations)
      {
       gl_FragColor.xyz /= 4.0;
       
       broken = true;
       
       break;
      }
      
      if (length(z) >= 4.0)
      {
       break;
      }
      
      z = ${t};
      
      brightness += exp(-length(z));
     }
     
     if (!broken)
     {
      gl_FragColor += vec4(brightness / brightness_scale * exposure * color, 0.0);
     }
    }
   }
  `;try{e.output_canvas_container.parentNode.remove(),r.output_canvas_container.parentNode.remove(),q.insertAdjacentHTML("beforebegin",`
    <div>
     <canvas id="output-canvas" class="output-canvas"></canvas>
     <canvas id="hidden-canvas" class="hidden-canvas"></canvas>
    </div>
   `)}catch(i){}(e=new Wilson(Page.element.querySelector("#output-canvas"),{renderer:"gpu",shader:o,canvas_width:500,canvas_height:500,world_width:4,world_height:4,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:J,mousedown_callback:C,touchstart_callback:C,mousemove_callback:L,mousedrag_callback:j,touchmove_callback:j,mouseup_callback:E,touchend_callback:E,wheel_callback:H,pinch_callback:M})).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),(r=new Wilson(Page.element.querySelector("#hidden-canvas"),{renderer:"gpu",shader:o,canvas_width:100,canvas_height:100})).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),n=0,l=0,c=[],e.gl.uniform1f(e.uniforms.aspect_ratio,1),r.gl.uniform1f(r.uniforms.aspect_ratio,1),window.requestAnimationFrame(D)}function C(r,t,o){g=0,p=0,v=0,w=0,f=0,h=0,2===n&&"mousedown"===o.type&&(n=1,e.world_center_x=0,e.world_center_y=0,e.world_width=4,e.world_height=4,l=0,c=[],Page.Animate.change_opacity(k,1,Site.opacity_animation_time),window.requestAnimationFrame(D))}function j(r,t,o,i,a){2===n&&"touchmove"===a.type?(s=r,u=t):(e.world_center_x-=o,e.world_center_y-=i,w=-o/e.world_width,f=-i/e.world_height,e.world_center_x=Math.min(Math.max(e.world_center_x,-2),2),e.world_center_y=Math.min(Math.max(e.world_center_y,-2),2)),window.requestAnimationFrame(D)}function L(e,r,t,o,i){2===n&&"mousemove"===i.type&&(s=e,u=r,window.requestAnimationFrame(D))}function E(r,t,o){2===n&&"touchend"===o.type?(n=1,e.world_center_x=0,e.world_center_y=0,e.world_width=4,e.world_height=4,l=0,c=[],Page.Animate.change_opacity(k,1,Site.opacity_animation_time),window.requestAnimationFrame(D)):(Math.sqrt(w*w+f*f)>=.0025&&(g=w,p=f),Math.abs(h)>=.01&&(v=h)),window.requestAnimationFrame(D)}function H(e,r,t,n){$=e,m=r,.3>Math.abs(t/100)?(l+=t/100,l=Math.min(l,1)):v+=.05*Math.sign(t),N()}function M(r,t,i,a){2!==n&&(o>=1?(l-=i/e.world_width*10,h=-i/e.world_width*10):(l-=i/e.world_height*10,h=-i/e.world_height*10),l=Math.min(l,1),$=r,m=t,N())}function N(){if(o>=1){let r=e.input.get_zoomed_world_center($,m,4*Math.pow(2,l)*o,4*Math.pow(2,l));e.world_width=4*Math.pow(2,l)*o,e.world_height=4*Math.pow(2,l),e.world_center_x=r[0],e.world_center_y=r[1]}else{let t=e.input.get_zoomed_world_center($,m,4*Math.pow(2,l),4*Math.pow(2,l)/o);e.world_width=4*Math.pow(2,l),e.world_height=4*Math.pow(2,l)/o,e.world_center_x=t[0],e.world_center_y=t[1]}i=-(30*l)+200,window.requestAnimationFrame(D)}function D(t){let d=t-_;if(_=t,0===d)return;r.gl.uniform1i(r.uniforms.julia_mode,n),r.gl.uniform1f(r.uniforms.world_center_x,e.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,e.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(e.world_height,e.world_width)/2),r.gl.uniform1i(r.uniforms.num_iterations,i),r.gl.uniform1f(r.uniforms.exposure,1),r.gl.uniform1f(r.uniforms.a,s),r.gl.uniform1f(r.uniforms.b,u),r.gl.uniform1f(r.uniforms.brightness_scale,20*(Math.abs(l)+1)),r.render.draw_frame();let b=r.render.get_pixel_data(),y=Array(1e4);for(let z=0;z<1e4;z++)y[z]=b[4*z]+b[4*z+1]+b[4*z+2];y.sort((e,r)=>e-r);let x=(y[Math.floor(9600)]+y[Math.floor(9800)])/255*15*(Math.abs(l/2)+1);c.push(x);let k=c.length;k>10&&c.shift(),x=Math.max(c.reduce((e,r)=>e+r)/k,.5),e.gl.uniform1i(e.uniforms.julia_mode,n),e.gl.uniform1f(e.uniforms.aspect_ratio,o),e.gl.uniform1f(e.uniforms.world_center_x,e.world_center_x),e.gl.uniform1f(e.uniforms.world_center_y,e.world_center_y),e.gl.uniform1f(e.uniforms.world_size,Math.min(e.world_height,e.world_width)/2),e.gl.uniform1i(e.uniforms.num_iterations,i),e.gl.uniform1f(e.uniforms.exposure,a),e.gl.uniform1f(e.uniforms.a,s),e.gl.uniform1f(e.uniforms.b,u),e.gl.uniform1f(e.uniforms.brightness_scale,x),e.render.draw_frame(),d>=50&&(g=0,p=0,v=0,w=0,f=0,h=0),(0!==g||0!==p||0!==v)&&(e.world_center_x+=g*e.world_width,e.world_center_y+=p*e.world_height,e.world_center_x=Math.min(Math.max(e.world_center_x,-2),2),e.world_center_y=Math.min(Math.max(e.world_center_y,-2),2),25e-5>Math.sqrt((g*=.96)*g+(p*=.96)*p)&&(g=0,p=0),l+=v,l=Math.min(l,1),N($,m),.001>Math.abs(v*=.93)&&(v=0),window.requestAnimationFrame(D))}function J(){e.fullscreen.currently_fullscreen?(o=window.innerWidth/window.innerHeight)>=1?(e.change_canvas_size(d,Math.floor(d/o)),e.world_width=4*Math.pow(2,l)*o,e.world_height=4*Math.pow(2,l)):(e.change_canvas_size(Math.floor(d*o),d),e.world_width=4*Math.pow(2,l),e.world_height=4*Math.pow(2,l)/o):(o=1,e.change_canvas_size(d,d),e.world_width=4*Math.pow(2,l),e.world_height=4*Math.pow(2,l)),window.requestAnimationFrame(D)}A.addEventListener("input",()=>{"none"!==A.value&&(b.value=F[A.value],S())}),S(),Page.show(),window.addEventListener("resize",J),Page.temporary_handlers.resize.push(J)}();