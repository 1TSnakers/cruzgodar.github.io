!async function(){"use strict";await Site.load_glsl();let t=null,e=null,n="cadd(cpow(z, 2.0), c)",r=0,o=1,i=200,a=1,l=0,_=[],c=0,s=0,u=500,d=100,w=0,h=0,m=0,f=0,g=0,p=0,v=0,b=0;const y=.96,x=.0025,z=25e-5,M=.93,k=.01,q=.001;let F=-1,S=Page.element.querySelector("#code-textarea");S.value="cadd(cpow(z, 2.0), c)",S.addEventListener("keydown",t=>{13===t.keyCode&&(t.preventDefault(),E())});let A=Page.element.querySelector("#resolution-input");A.addEventListener("input",()=>{u=parseInt(A.value||500),t.change_canvas_size(u,u)});let P=Page.element.querySelector("#exposure-input");P.addEventListener("input",()=>{a=parseFloat(P.value||1)});let C=Page.element.querySelector("#num-iterations-input");C.addEventListener("input",()=>{i=parseInt(C.value||200)}),Page.element.querySelector("#download-button").addEventListener("click",()=>{t.download_frame("a-generalized-julia-set.png")}),Page.element.querySelector("#generate-button").addEventListener("click",E);let j=Page.element.querySelector("#switch-julia-mode-button");j.style.opacity=1,j.addEventListener("click",()=>{Page.Animate.change_opacity(j,0,Site.opacity_animation_time),setTimeout(()=>{2===r?j.textContent="Return to Mandelbrot Set":0===r&&(j.textContent="Pick Julia Set",Page.Animate.change_opacity(j,1,Site.opacity_animation_time))},Site.opacity_animation_time),0===r?(r=2,c=0,s=0,p=0,v=0,b=0,m=0,f=0,g=0,_=[],window.requestAnimationFrame(J)):1===r&&(r=0,t.world_center_x=0,t.world_center_y=0,t.world_width=4,t.world_height=4,l=0,_=[],window.requestAnimationFrame(J))});let L=Page.element.querySelector("#canvas-location");function E(){n=S.value||"cadd(cpow(z, 2.0), c)";let o=`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform int julia_mode;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float world_center_x;\n\t\t\tuniform float world_center_y;\n\t\t\tuniform float world_size;\n\t\t\t\n\t\t\tuniform float a;\n\t\t\tuniform float b;\n\t\t\tuniform float exposure;\n\t\t\tuniform int num_iterations;\n\t\t\tuniform float brightness_scale;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t${Site.get_glsl_bundle(n)}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z;\n\t\t\t\t\n\t\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (julia_mode == 0)\n\t\t\t\t{\n\t\t\t\t\tvec2 c = z;\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${n};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * exposure * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\telse if (julia_mode == 1)\n\t\t\t\t{\n\t\t\t\t\tvec2 c = vec2(a, b);\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${n};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * exposure * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvec2 c = z;\n\t\t\t\t\t\n\t\t\t\t\tbool broken = false;\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${n};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (!broken)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(.5 * brightness / brightness_scale * exposure * color, 1.0);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * 2.0, uv.y * 2.0);\n\t\t\t\t\tcolor = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\t\tbrightness = exp(-length(z));\n\t\t\t\t\t\n\t\t\t\t\tbroken = false;\n\t\t\t\t\t\n\t\t\t\t\tc = vec2(a, b);\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor.xyz /= 4.0;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${n};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!broken)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor += vec4(brightness / brightness_scale * exposure * color, 0.0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`,i={renderer:"gpu",shader:o,canvas_width:500,canvas_height:500,world_width:4,world_height:4,world_center_x:0,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:R,mousedown_callback:$,touchstart_callback:$,mousemove_callback:H,mousedrag_callback:W,touchmove_callback:W,mouseup_callback:I,touchend_callback:I,wheel_callback:N,pinch_callback:T},a={renderer:"gpu",shader:o,canvas_width:100,canvas_height:100};try{t.output_canvas_container.parentNode.remove(),e.output_canvas_container.parentNode.remove(),L.insertAdjacentHTML("beforebegin",'\n\t\t\t\t<div>\n\t\t\t\t\t<canvas id="output-canvas" class="output-canvas"></canvas>\n\t\t\t\t\t<canvas id="hidden-canvas" class="hidden-canvas"></canvas>\n\t\t\t\t</div>\n\t\t\t')}catch(t){}(t=new Wilson(Page.element.querySelector("#output-canvas"),i)).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),(e=new Wilson(Page.element.querySelector("#hidden-canvas"),a)).render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","exposure","brightness_scale"]),r=0,l=0,_=[],t.gl.uniform1f(t.uniforms.aspect_ratio,1),e.gl.uniform1f(e.uniforms.aspect_ratio,1),window.requestAnimationFrame(J)}function $(e,n,o){p=0,v=0,b=0,m=0,f=0,g=0,2===r&&"mousedown"===o.type&&(r=1,t.world_center_x=0,t.world_center_y=0,t.world_width=4,t.world_height=4,l=0,_=[],Page.Animate.change_opacity(j,1,Site.opacity_animation_time),window.requestAnimationFrame(J))}function W(e,n,o,i,a){2===r&&"touchmove"===a.type?(c=e,s=n):(t.world_center_x-=o,t.world_center_y-=i,m=-o/t.world_width,f=-i/t.world_height,t.world_center_x=Math.min(Math.max(t.world_center_x,-2),2),t.world_center_y=Math.min(Math.max(t.world_center_y,-2),2)),window.requestAnimationFrame(J)}function H(t,e,n,o,i){2===r&&"mousemove"===i.type&&(c=t,s=e,window.requestAnimationFrame(J))}function I(e,n,o){2===r&&"touchend"===o.type?(r=1,t.world_center_x=0,t.world_center_y=0,t.world_width=4,t.world_height=4,l=0,_=[],Page.Animate.change_opacity(j,1,Site.opacity_animation_time),window.requestAnimationFrame(J)):(Math.sqrt(m*m+f*f)>=x&&(p=m,v=f),Math.abs(g)>=k&&(b=g)),window.requestAnimationFrame(J)}function N(t,e,n,r){w=t,h=e,Math.abs(n/100)<.3?(l+=n/100,l=Math.min(l,1)):b+=.05*Math.sign(n),D()}function T(e,n,i,a){2!==r&&(o>=1?(l-=i/t.world_width*10,g=-i/t.world_width*10):(l-=i/t.world_height*10,g=-i/t.world_height*10),l=Math.min(l,1),w=e,h=n,D())}function D(){if(o>=1){let e=t.input.get_zoomed_world_center(w,h,4*Math.pow(2,l)*o,4*Math.pow(2,l));t.world_width=4*Math.pow(2,l)*o,t.world_height=4*Math.pow(2,l),t.world_center_x=e[0],t.world_center_y=e[1]}else{let e=t.input.get_zoomed_world_center(w,h,4*Math.pow(2,l),4*Math.pow(2,l)/o);t.world_width=4*Math.pow(2,l),t.world_height=4*Math.pow(2,l)/o,t.world_center_x=e[0],t.world_center_y=e[1]}i=30*-l+200,window.requestAnimationFrame(J)}function J(n){let u=n-F;if(F=n,0===u)return;e.gl.uniform1i(e.uniforms.julia_mode,r),e.gl.uniform1f(e.uniforms.world_center_x,t.world_center_x),e.gl.uniform1f(e.uniforms.world_center_y,t.world_center_y),e.gl.uniform1f(e.uniforms.world_size,Math.min(t.world_height,t.world_width)/2),e.gl.uniform1i(e.uniforms.num_iterations,i),e.gl.uniform1f(e.uniforms.exposure,1),e.gl.uniform1f(e.uniforms.a,c),e.gl.uniform1f(e.uniforms.b,s),e.gl.uniform1f(e.uniforms.brightness_scale,20*(Math.abs(l)+1)),e.render.draw_frame();let w=e.render.get_pixel_data(),h=new Array(d*d);for(let t=0;t<d*d;t++)h[t]=w[4*t]+w[4*t+1]+w[4*t+2];h.sort((t,e)=>t-e);let x=(h[Math.floor(d*d*.96)]+h[Math.floor(d*d*.98)])/255*15*(Math.abs(l/2)+1);_.push(x);let k=_.length;k>10&&_.shift(),x=Math.max(_.reduce((t,e)=>t+e)/k,.5),t.gl.uniform1i(t.uniforms.julia_mode,r),t.gl.uniform1f(t.uniforms.aspect_ratio,o),t.gl.uniform1f(t.uniforms.world_center_x,t.world_center_x),t.gl.uniform1f(t.uniforms.world_center_y,t.world_center_y),t.gl.uniform1f(t.uniforms.world_size,Math.min(t.world_height,t.world_width)/2),t.gl.uniform1i(t.uniforms.num_iterations,i),t.gl.uniform1f(t.uniforms.exposure,a),t.gl.uniform1f(t.uniforms.a,c),t.gl.uniform1f(t.uniforms.b,s),t.gl.uniform1f(t.uniforms.brightness_scale,x),t.render.draw_frame(),u>=50&&(p=0,v=0,b=0,m=0,f=0,g=0),0===p&&0===v&&0===b||(t.world_center_x+=p*t.world_width,t.world_center_y+=v*t.world_height,t.world_center_x=Math.min(Math.max(t.world_center_x,-2),2),t.world_center_y=Math.min(Math.max(t.world_center_y,-2),2),p*=y,v*=y,Math.sqrt(p*p+v*v)<z&&(p=0,v=0),l+=b,l=Math.min(l,1),D(),b*=M,Math.abs(b)<q&&(b=0),window.requestAnimationFrame(J))}function R(){t.fullscreen.currently_fullscreen?(o=window.innerWidth/window.innerHeight)>=1?(t.change_canvas_size(u,Math.floor(u/o)),t.world_width=4*Math.pow(2,l)*o,t.world_height=4*Math.pow(2,l)):(t.change_canvas_size(Math.floor(u*o),u),t.world_width=4*Math.pow(2,l),t.world_height=4*Math.pow(2,l)/o):(o=1,t.change_canvas_size(u,u),t.world_width=4*Math.pow(2,l),t.world_height=4*Math.pow(2,l)),window.requestAnimationFrame(J)}E(),Page.show(),window.addEventListener("resize",R),Page.temporary_handlers.resize.push(R)}();