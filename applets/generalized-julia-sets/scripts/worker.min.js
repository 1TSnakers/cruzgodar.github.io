"use strict";onmessage=async function(e){importScripts("/scripts/complex.min.js");let t=e.data[0],a=e.data[1],o=e.data[2],i=e.data[3];code_string=e.data[4],box_size=e.data[5],exposure=e.data[6],escape_radius=e.data[7],custom_iteration_function=create_custom_iteration_function(code_string),await draw_julia_set(t,a,o,i)};let image=[],custom_iteration_function=null,code_string="",box_size=4,exposure=1,escape_radius=100;function draw_julia_set(e,t,a,o){return new Promise(function(i,s){image=[];for(let e=0;e<a;e++)image[e]=[];let n=Math.floor(a/10);for(let i=0;i<a;i++)julia_row(i,e,t,a,o),i%n==0&&postMessage(["progress",i/n*10]);postMessage(["progress",100]);let r=image.flat().sort(function(e,t){return e-t}),u=r[Math.round(r.length*(1-exposure/2e3))-1];for(let e=0;e<a;e++)image[e]=image[e].map(e=>e/u*255);postMessage([image]),i()})}function julia_row(e,t,a,o,i){let s=new Complex([t,a]);for(let t=0;t<o;t++){let a=new Complex([(t-o/2)/o*box_size,-(e-o/2)/o*box_size]),n=Math.exp(-a.abs()),r=0;for(r=0;r<i&&(a=custom_iteration_function(a,s),n+=Math.exp(-a.abs()),!(a.abs()>escape_radius));r++);r===i&&(n=0),image[e][t]=n}}function create_custom_iteration_function(e){return new Function("z","c",`return ${e}`)}