!function(){"use strict";let e=0,t=0,o=0,r=0,n=100,u=500,l=25,c=50,a=200,s=[],d=[],i=!1,m="",p=null,y=4,f=5,g=100,b=null,S=null;1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)")),!1===scripts_loaded.complexjs&&load_script("/scripts/complex.min.js").then(function(){scripts_loaded.complexjs=!0}).catch(function(e){console.error("Could not load ComplexJS")}),document.querySelector("#generate-button-1").addEventListener("click",h);let q=document.querySelectorAll("#code-input, #box-size-input, #exposure-input, #escape-radius-input");for(let e=0;e<q.length;e++)q[e].addEventListener("keydown",function(e){13===e.keyCode&&h()});document.querySelector("#generate-button-2").addEventListener("click",x),q=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<q.length;e++)q[e].addEventListener("keydown",function(e){13===e.keyCode&&x()});function h(){y=parseFloat(document.querySelector("#box-size-input").value||4),f=parseFloat(document.querySelector("#exposure-input").value||5),g=parseFloat(document.querySelector("#escape-radius-input").value||100),m=document.querySelector("#code-input").value||"z.pow(2).add(c)",p=function(e){return new Function("z","c",`return ${e}`)}(m),function(e,t){d=[];for(let t=0;t<e;t++)d[t]=[];let o=null;document.querySelector("#mandelbrot-set").setAttribute("width",e),document.querySelector("#mandelbrot-set").setAttribute("height",e),o=document.querySelector("#mandelbrot-set").getContext("2d",{alpha:!1});for(let o=0;o<e;o++)v(o,e,t);let r=d.flat().sort(function(e,t){return e-t}),n=r[Math.round(r.length*(1-f/200))-1];for(let t=0;t<e;t++)d[t]=d[t].map(e=>e/n*255);let u=o.getImageData(0,0,e,e),l=u.data;for(let t=0;t<e;t++)for(let o=0;o<e;o++){let r=d[t][o],n=4*t*e+4*o;l[n]=r/3,l[n+1]=r/3,l[n+2]=r,l[n+3]=255}o.putImageData(u,0,0)}(500,50)}function v(e,t,o){for(let r=0;r<t;r++){let n=(r-t/2)/t*y,u=-(e-t/2)/t*y,l=new Complex([n,u]),c=new Complex([n,u]),a=Math.exp(-l.abs()),s=0;for(s=0;s<o&&(l=p(l,c),a+=Math.exp(-l.abs()),!(l.abs()>g));s++);s===o&&(a=0),d[e][r]=a}}function w(e,t,o,r){d=[];for(let e=0;e<o;e++)d[e]=[];let u=null;document.querySelector("#julia-set").setAttribute("width",o),document.querySelector("#julia-set").setAttribute("height",o),u=document.querySelector("#julia-set").getContext("2d",{alpha:!1});for(let n=0;n<o;n++)C(n,e,t,o,r);let l=d.flat().sort(function(e,t){return e-t}),c=0;if(o===n){s.push(l[Math.round(l.length*(1-f/200))-1]),s.length>10&&s.shift(),c=0;for(let e=0;e<s.length;e++)c+=s[e];c/=s.length}else c=l[Math.round(l.length*(1-f/2e3))-1];for(let e=0;e<o;e++)d[e]=d[e].map(e=>e/c*255);let a=u.getImageData(0,0,o,o),i=a.data;for(let e=0;e<o;e++)for(let t=0;t<o;t++){let r=d[e][t],n=4*e*o+4*t;i[n]=r/3,i[n+1]=r/3,i[n+2]=r,i[n+3]=255}u.putImageData(a,0,0)}function C(e,t,o,r,n){let u=new Complex([t,o]);for(let t=0;t<r;t++){let o=new Complex([(t-r/2)/r*y,-(e-r/2)/r*y]),l=Math.exp(-o.abs()),c=0;for(c=0;c<n&&(o=p(o,u),l+=Math.exp(-o.abs()),!(o.abs()>g));c++);c===n&&(l=0),d[e][t]=l}}function x(){let o=parseFloat(document.querySelector("#a-input").value)||0,r=parseFloat(document.querySelector("#b-input").value)||1,n=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#output-canvas").setAttribute("width",n),document.querySelector("#output-canvas").setAttribute("height",n),b=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),e=o,t=r,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{S.terminate()}catch(e){}S=DEBUG?new Worker("/applets/generalized-julia-sets/scripts/worker.js"):new Worker("/applets/generalized-julia-sets/scripts/worker.min.js"),temporary_web_workers.push(S),S.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let t=b.getImageData(0,0,n,n),o=t.data;for(let t=0;t<n;t++)for(let r=0;r<n;r++){let u=e.data[0][t][r],l=4*t*n+4*r;o[l]=u/3,o[l+1]=u/3,o[l+2]=u,o[l+3]=255}b.putImageData(t,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),S.postMessage([o,r,n,a,m,y,f,g])}function j(){o=document.querySelector("#julia-set").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth}document.querySelector("#download-button").addEventListener("click",function(){let o=document.createElement("a");o.download=t<0?e+" - "+-t+"i.png":e+" + "+t+"i.png";o.href=document.querySelector("#output-canvas").toDataURL(),o.click(),o.remove()}),o=document.querySelector("#julia-set").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",j),temporary_handlers.resize.push(j),setTimeout(j,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===i){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,u=(t/o-.5)*y,c=((o-r)/o-.5)*y;w(u,c,n,l)}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,n=(t/o-.5)*y,l=((o-r)/o-.5)*y;w(n,l,u,c),document.querySelector("#a-input").value=Math.round(1e6*n)/1e6,document.querySelector("#b-input").value=Math.round(1e6*l)/1e6,i=!0}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){i=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let u=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,c=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=u,t=c;let a=(u/o-.5)*y,s=((o-c)/o-.5)*y;w(a,s,n,l)},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(r){r.preventDefault();let n=(e/o-.5)*y,l=((o-t)/o-.5)*y;w(n,l,u,c),document.querySelector("#a-input").value=Math.round(1e6*n)/1e6,document.querySelector("#b-input").value=Math.round(1e6*l)/1e6},!1)}()}();