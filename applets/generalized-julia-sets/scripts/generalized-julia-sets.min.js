!function(){"use strict";let t="cadd(cmul(z, z), c)",e=0,n=0,r=1e3,o=100,c=5,u=0,a=0,i=1e3,l=100,s=200,d=4,m=100,f=!1,v=!1,z=!1,g=!0,p=document.querySelector("#julia-set").getContext("webgl");document.querySelector("#julia-set").setAttribute("width",i),document.querySelector("#julia-set").setAttribute("height",i),1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)")),document.querySelector("#generate-button-1").addEventListener("click",S);let w=document.querySelectorAll("#code-input, #box-size-input, #exposure-input, #escape-radius-input");for(let t=0;t<w.length;t++)w[t].addEventListener("keydown",function(t){13===t.keyCode&&S()});document.querySelector("#generate-button-2").addEventListener("click",_),w=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let t=0;t<w.length;t++)w[t].addEventListener("keydown",function(t){13===t.keyCode&&_()});document.querySelector("#download-button").addEventListener("click",function(){let t=document.createElement("a");t.download=n<0?e+" - "+-n+"i.png":e+" + "+n+"i.png";t.href=document.querySelector("#output-canvas").toDataURL(),t.click(),t.remove()}),u=document.querySelector("#julia-set").offsetWidth,a=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",A),temporary_handlers.resize.push(A),setTimeout(A,1e3),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){a=document.querySelector("#output-canvas").offsetWidth},set_up_canvas_resizer();const y="\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t";let h=null;function b(e=!1){let n=q(p,p.VERTEX_SHADER,y),o=q(p,p.FRAGMENT_SHADER,function(e=!1){let n="vec2 c = uniform_c";return e&&(n="vec2 c = z"),`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform vec2 uniform_c;\n\t\t\t\n\t\t\tuniform float brightness_scale;\n\t\t\tuniform float box_size_halved;\n\t\t\tuniform float escape_radius;\n\t\t\tuniform int num_iterations;\n\t\t\t\n\t\t\tconst vec2 i = vec2(0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat cabs(vec2 z)\n\t\t\t{\n\t\t\t\treturn length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cabs(float z)\n\t\t\t{\n\t\t\t\treturn abs(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat carg(vec2 z)\n\t\t\t{\n\t\t\t\tif (z.x == 0.0)\n\t\t\t\t{\n\t\t\t\t\tif (z.y >= 0.0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 1.57079632;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn -1.57079632;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn atan(z.y, z.x);\n\t\t\t}\n\t\t\t\n\t\t\tfloat carg(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn 3.14159265;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns the conjugate of z.\n\t\t\tvec2 cconj(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(z.x, -z.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cconj(float z)\n\t\t\t{\n\t\t\t\treturn z;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / |z|.\n\t\t\tvec2 csign(vec2 z)\n\t\t\t{\n\t\t\t\tif (length(z) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csign(float z)\n\t\t\t{\n\t\t\t\treturn sign(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z + w.\n\t\t\tvec2 cadd(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x + w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z + w.x, w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cadd(float z, float w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z - w.\n\t\t\tvec2 csub(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x - w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z - w.x, -w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csub(float z, float w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z * w.\n\t\t\tvec2 cmul(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x * w.x - z.y * w.y, z.x * w.y + z.y * w.x);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tfloat cmul(float z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / w.\n\t\t\tvec2 cdiv(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z.x * w.x + z.y * w.y, -z.x * w.y + z.y * w.x) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z * w.x, -z * w.y) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cdiv(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^w.\n\t\t\tvec2 cpow(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat exparg = exp(-w.y * arg);\n\t\t\t\tfloat magexp = pow(magnitude, w.x / 2.0);\n\t\t\t\tfloat logmag = log(magnitude) * w.y / 2.0;\n\t\t\t\t\n\t\t\t\tfloat p1 = exparg * cos(w.x * arg);\n\t\t\t\tfloat p2 = exparg * sin(w.x * arg);\n\t\t\t\t\n\t\t\t\tfloat q1 = magexp * cos(logmag);\n\t\t\t\tfloat q2 = magexp * sin(logmag);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * q1 - p2 * q2, q1 * p2 + p1 * q2);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(vec2 z, float w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat magexp = pow(magnitude, w / 2.0);\n\t\t\t\t\n\t\t\t\tfloat p1 = cos(w * arg);\n\t\t\t\tfloat p2 = sin(w * arg);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * magexp, p2 * magexp);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat zlog = log(z);\n\t\t\t\tfloat zexp = exp(w.x * zlog);\n\t\t\t\t\n\t\t\t\treturn vec2(zexp * cos(w.y * zlog), zexp * sin(w.y * zlog));\n\t\t\t}\n\t\t\t\n\t\t\tfloat cpow(float z, float w)\n\t\t\t{\n\t\t\t\treturn pow(z, w);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^^w.\n\t\t\tvec2 ctet(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = cpow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctet(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfloat prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = pow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sqrt(z).\n\t\t\tvec2 csqrt(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(z, .5);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csqrt(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(sqrt(z), 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(0.0, sqrt(-z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns e^z.\n\t\t\tvec2 cexp(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(2.7182818, z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cexp(float z)\n\t\t\t{\n\t\t\t\treturn exp(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns log(z).\n\t\t\tvec2 clog(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(.5 * log(z.x * z.x + z.y * z.y), carg(z));\n\t\t\t}\n\t\t\t\n\t\t\tfloat clog(float z)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn log(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sin(z).\n\t\t\tvec2 csin(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) - cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat csin(float z)\n\t\t\t{\n\t\t\t\treturn sin(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns cos(z).\n\t\t\tvec2 ccos(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) + cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat ccos(float z)\n\t\t\t{\n\t\t\t\treturn cos(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns tan(z).\n\t\t\tvec2 ctan(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 2.0)));\n\t\t\t\t\n\t\t\t\treturn cdiv(cmul(vec2(0.0, -1.0), vec2(-1.0, 0.0) + temp), vec2(1.0, 0.0) + temp);\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctan(float z)\n\t\t\t{\n\t\t\t\treturn tan(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z = vec2(uv.x * box_size_halved, uv.y * box_size_halved);\n\t\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\t\n\t\t\t\t${n};\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 201; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= escape_radius)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = ${t};\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(.333 * brightness / brightness_scale, brightness * .333 / brightness_scale, brightness / brightness_scale, 1.0);\n\t\t\t}\n\t\t`}(e));h=p.createProgram(),p.attachShader(h,n),p.attachShader(h,o),p.linkProgram(h),p.getProgramParameter(h,p.LINK_STATUS)||(console.log(`Couldn't link shader program: ${p.getShaderInfoLog(shader)}`),p.deleteProgram(h)),p.useProgram(h);let c=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,c),p.bufferData(p.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),p.STATIC_DRAW),h.position_attribute=p.getAttribLocation(h,"position"),p.enableVertexAttribArray(h.position_attribute),p.vertexAttribPointer(h.position_attribute,3,p.FLOAT,!1,0,0),h.c_uniform=p.getUniformLocation(h,"uniform_c"),h.num_iterations_uniform=p.getUniformLocation(h,"num_iterations"),h.box_size_halved_uniform=p.getUniformLocation(h,"box_size_halved"),h.escape_radius_uniform=p.getUniformLocation(h,"escape_radius"),h.brightness_scale_uniform=p.getUniformLocation(h,"brightness_scale"),p.viewport(0,0,r,r)}function q(t,e,n){let r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(r)),r}function x(){p.uniform2f(h.c_uniform,e,n),p.uniform1i(h.num_iterations_uniform,o),p.uniform1f(h.box_size_halved_uniform,d/2),p.uniform1f(h.escape_radius_uniform,m),p.uniform1f(h.brightness_scale_uniform,c),p.drawArrays(p.TRIANGLE_STRIP,0,4);let t=new Uint8Array(r*r*4);p.readPixels(0,0,r,r,p.RGBA,p.UNSIGNED_BYTE,t);let u=0;for(let e=0;e<r*r;e++){255===t[4*e+2]&&u++}let a=!1;u<10*r&&c>.25?(c-=.25,a=!0):u>15*r&&(c+=.25,a=!0),v?a?window.requestAnimationFrame(x):v=!1:z?(z=!1,window.requestAnimationFrame(x)):g=!0}function S(){d=parseFloat(document.querySelector("#box-size-input").value||4),m=parseFloat(document.querySelector("#escape-radius-input").value||100),t=document.querySelector("#code-input").value||"cadd(cpow(z, 2.0), c)",document.querySelector("#julia-set").remove();let e=document.createElement("canvas");e.id="julia-set",e.classList.add("no-floating-footer"),e.setAttribute("width",i),e.setAttribute("height",i),document.querySelector("#mandelbrot-set").setAttribute("width",i),document.querySelector("#mandelbrot-set").setAttribute("height",i),p=e.getContext("webgl"),document.querySelector("#container").appendChild(e),c=5,b(!0),v=!1,x(),document.querySelector("#mandelbrot-set").getContext("2d").drawImage(e,0,0),document.querySelector("#julia-set").remove(),(e=document.createElement("canvas")).id="julia-set",e.classList.add("no-floating-footer"),e.setAttribute("width",i),e.setAttribute("height",i),p=e.getContext("webgl"),document.querySelector("#container").appendChild(e),c=5,b()}function _(){e=parseFloat(document.querySelector("#a-input").value||0),n=parseFloat(document.querySelector("#b-input").value||1),r=parseFloat(document.querySelector("#dim-input").value)||1e3,document.querySelector("#julia-set").setAttribute("width",r),document.querySelector("#julia-set").setAttribute("height",r),p.viewport(0,0,r,r),o=s,document.querySelector("#output-canvas").setAttribute("width",r),document.querySelector("#output-canvas").setAttribute("height",r),x(),document.querySelector("#output-canvas").getContext("2d").drawImage(document.querySelector("#julia-set"),0,0)}function A(){u=document.querySelector("#julia-set").offsetWidth,a=document.querySelector("#output-canvas").offsetWidth}load_script("/scripts/gl-matrix.min.js").then(function(){setTimeout(function(){S(),document.querySelector("#mandelbrot-set").addEventListener("mouseenter",function(t){f=!1,document.querySelector("#julia-set").setAttribute("width",i),document.querySelector("#julia-set").setAttribute("height",i),p.viewport(0,0,i,i),r=i,o=l}),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(t){if(!1===f){let r=t.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,o=t.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=(r/u-.5)*d,n=((u-o)/u-.5)*d,z=!0,g&&(g=!1,window.requestAnimationFrame(x))}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(t){v=!0,window.requestAnimationFrame(x),f=!0,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*n)/1e6}),function(){let t=0,c=0;document.querySelector("#mandelbrot-set").addEventListener("touchstart",function(t){t.preventDefault(),document.querySelector("#julia-set").setAttribute("width",i),document.querySelector("#julia-set").setAttribute("height",i),p.viewport(0,0,i,i),r=i,o=l},!1),document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let o=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,a=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;t=o,c=a,e=(o/u-.5)*d,n=((u-a)/u-.5)*d,z=!0,g&&(g=!1,window.requestAnimationFrame(x))},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(t){t.preventDefault(),v=!0,window.requestAnimationFrame(x),document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*n)/1e6},!1)}()},500)})}();