!function(){"use strict";let t=document.querySelector("#output-canvas").getContext("webgl"),n=document.querySelector("#output-canvas").offsetWidth,e=document.querySelector("#output-canvas").offsetHeight,o=Math.min(n,e),r=!1,a=!1,u=0,c=null,i=0,l=0,s=0,m=!1,f=0,d=0,v="cadd(cmul(z, z), c)",p=0,z=0,g=0,w=0,h=4,_=0,y=13,b=100,x=1,q=500,S=500,A=500,R=200;document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",A),document.querySelector("#generate-button").addEventListener("click",j);let F=document.querySelectorAll("#code-input, #exposure-input, #escape-radius-input");for(let t=0;t<F.length;t++)F[t].addEventListener("keydown",function(t){13===t.keyCode&&j()});document.querySelector("#resolution-input").addEventListener("input",function(){(q=parseInt(document.querySelector("#resolution-input").value||500))<200&&(q=200);q>2e3&&(q=2e3);canvas_is_fullscreen&&(aspect_ratio>=1?(S=q,A=Math.floor(q/aspect_ratio)):(S=Math.floor(q*aspect_ratio),A=q));document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",A),t.viewport(0,0,S,A),window.requestAnimationFrame(k)}),document.querySelector("#exposure-input").addEventListener("input",function(){x=parseFloat(document.querySelector("#exposure-input").value||1),r||(r=!0,a=!0,u=0,window.requestAnimationFrame(k))}),document.querySelector("#escape-radius-input").addEventListener("input",function(){b=parseFloat(document.querySelector("#escape-radius-input").value||1),r||(r=!0,a=!0,u=0,window.requestAnimationFrame(k))}),document.querySelector("#generate-high-res-image-button").addEventListener("click",function(){let n=q;q=parseInt(document.querySelector("#high-res-dim-input").value||2e3),R+=50,document.querySelector("#output-canvas").setAttribute("width",q),document.querySelector("#output-canvas").setAttribute("height",q),t.viewport(0,0,q,q),k();let e=document.createElement("a");e.download="a-mandelbrot-zoom.png",e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove(),q=n,R-=50,document.querySelector("#output-canvas").setAttribute("width",q),document.querySelector("#output-canvas").setAttribute("height",q),t.viewport(0,0,q,q),k()}),document.querySelector("#switch-julia-mode-button").addEventListener("click",function(){document.querySelector("#switch-julia-mode-button").style.opacity=0,setTimeout(function(){2===d?document.querySelector("#switch-julia-mode-button").textContent="Return to Mandelbrot Set":0===d&&(document.querySelector("#switch-julia-mode-button").textContent="Pick Julia Set",document.querySelector("#switch-julia-mode-button").style.opacity=1,equalize_text_buttons())},300),0===d?(d=2,g=0,w=0):1===d&&(d=0,p=0,z=0,h=4,_=0,y=13),a=!0,r||(r=!0,window.requestAnimationFrame(k))}),window.addEventListener("resize",X),setTimeout(X,500),setTimeout(j,500);const L="\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t";let E=null;function C(){let n=M(t,t.VERTEX_SHADER,L),e=M(t,t.FRAGMENT_SHADER,`\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float aspect_ratio;\n\t\t\t\n\t\t\tuniform float a;\n\t\t\tuniform float b;\n\t\t\t\n\t\t\tuniform float center_x;\n\t\t\tuniform float center_y;\n\t\t\t\n\t\t\tuniform float brightness_scale;\n\t\t\tuniform float box_size_halved;\n\t\t\tuniform float escape_radius;\n\t\t\tuniform int num_iterations;\n\t\t\t\n\t\t\tuniform int julia_mode;\n\t\t\t\n\t\t\tconst vec2 i = vec2(0.0, 1.0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat cabs(vec2 z)\n\t\t\t{\n\t\t\t\treturn length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cabs(float z)\n\t\t\t{\n\t\t\t\treturn abs(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns |z|.\n\t\t\tfloat carg(vec2 z)\n\t\t\t{\n\t\t\t\tif (z.x == 0.0)\n\t\t\t\t{\n\t\t\t\t\tif (z.y >= 0.0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 1.57079632;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn -1.57079632;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn atan(z.y, z.x);\n\t\t\t}\n\t\t\t\n\t\t\tfloat carg(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn 3.14159265;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns the conjugate of z.\n\t\t\tvec2 cconj(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(z.x, -z.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cconj(float z)\n\t\t\t{\n\t\t\t\treturn z;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / |z|.\n\t\t\tvec2 csign(vec2 z)\n\t\t\t{\n\t\t\t\tif (length(z) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / length(z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csign(float z)\n\t\t\t{\n\t\t\t\treturn sign(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z + w.\n\t\t\tvec2 cadd(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x + w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cadd(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z + w.x, w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cadd(float z, float w)\n\t\t\t{\n\t\t\t\treturn z + w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z - w.\n\t\t\tvec2 csub(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x - w, z.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csub(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z - w.x, -w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat csub(float z, float w)\n\t\t\t{\n\t\t\t\treturn z - w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z * w.\n\t\t\tvec2 cmul(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\treturn vec2(z.x * w.x - z.y * w.y, z.x * w.y + z.y * w.x);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(vec2 z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cmul(float z, vec2 w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\tfloat cmul(float z, float w)\n\t\t\t{\n\t\t\t\treturn z * w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z / w.\n\t\t\tvec2 cdiv(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z.x * w.x + z.y * w.y, -z.x * w.y + z.y * w.x) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cdiv(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (length(w) == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(z * w.x, -z * w.y) / (w.x * w.x + w.y * w.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cdiv(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn z / w;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^w.\n\t\t\tvec2 cpow(vec2 z, vec2 w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat exparg = exp(-w.y * arg);\n\t\t\t\tfloat magexp = pow(magnitude, w.x / 2.0);\n\t\t\t\tfloat logmag = log(magnitude) * w.y / 2.0;\n\t\t\t\t\n\t\t\t\tfloat p1 = exparg * cos(w.x * arg);\n\t\t\t\tfloat p2 = exparg * sin(w.x * arg);\n\t\t\t\t\n\t\t\t\tfloat q1 = magexp * cos(logmag);\n\t\t\t\tfloat q2 = magexp * sin(logmag);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * q1 - p2 * q2, q1 * p2 + p1 * q2);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(vec2 z, float w)\n\t\t\t{\n\t\t\t\tfloat arg = carg(z);\n\t\t\t\tfloat magnitude = z.x * z.x + z.y * z.y;\n\t\t\t\t\n\t\t\t\tfloat magexp = pow(magnitude, w / 2.0);\n\t\t\t\t\n\t\t\t\tfloat p1 = cos(w * arg);\n\t\t\t\tfloat p2 = sin(w * arg);\n\t\t\t\t\n\t\t\t\treturn vec2(p1 * magexp, p2 * magexp);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 cpow(float z, vec2 w)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(0.0, 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfloat zlog = log(z);\n\t\t\t\tfloat zexp = exp(w.x * zlog);\n\t\t\t\t\n\t\t\t\treturn vec2(zexp * cos(w.y * zlog), zexp * sin(w.y * zlog));\n\t\t\t}\n\t\t\t\n\t\t\tfloat cpow(float z, float w)\n\t\t\t{\n\t\t\t\treturn pow(z, w);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns z^^w.\n\t\t\tvec2 ctet(vec2 z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(1.0, 0.0);\n\t\t\t\t}\n\t\t\t\n\t\t\t\t\n\t\t\t\tvec2 prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = cpow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctet(float z, float w)\n\t\t\t{\n\t\t\t\tif (w == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tfloat prod = z;\n\t\t\t\t\n\t\t\t\tfor (int i = 1; i < 10000; i++)\n\t\t\t\t{\n\t\t\t\t\tif (float(i) >= w)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn prod;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tprod = pow(prod, z);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn prod;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sqrt(z).\n\t\t\tvec2 csqrt(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(z, .5);\n\t\t\t}\n\t\t\t\n\t\t\tvec2 csqrt(float z)\n\t\t\t{\n\t\t\t\tif (z >= 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn vec2(sqrt(z), 0.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn vec2(0.0, sqrt(-z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns e^z.\n\t\t\tvec2 cexp(vec2 z)\n\t\t\t{\n\t\t\t\treturn cpow(2.7182818, z);\n\t\t\t}\n\t\t\t\n\t\t\tfloat cexp(float z)\n\t\t\t{\n\t\t\t\treturn exp(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns log(z).\n\t\t\tvec2 clog(vec2 z)\n\t\t\t{\n\t\t\t\treturn vec2(.5 * log(z.x * z.x + z.y * z.y), carg(z));\n\t\t\t}\n\t\t\t\n\t\t\tfloat clog(float z)\n\t\t\t{\n\t\t\t\tif (z == 0.0)\n\t\t\t\t{\n\t\t\t\t\treturn 0.0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn log(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns sin(z).\n\t\t\tvec2 csin(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) - cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat csin(float z)\n\t\t\t{\n\t\t\t\treturn sin(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns cos(z).\n\t\t\tvec2 ccos(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 1.0))) + cexp(cmul(z, vec2(0.0, -1.0)));\n\t\t\t\t\n\t\t\t\treturn cmul(temp, vec2(0.0, -0.5));\n\t\t\t}\n\t\t\t\n\t\t\tfloat ccos(float z)\n\t\t\t{\n\t\t\t\treturn cos(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//Returns tan(z).\n\t\t\tvec2 ctan(vec2 z)\n\t\t\t{\n\t\t\t\tvec2 temp = cexp(cmul(z, vec2(0.0, 2.0)));\n\t\t\t\t\n\t\t\t\treturn cdiv(cmul(vec2(0.0, -1.0), vec2(-1.0, 0.0) + temp), vec2(1.0, 0.0) + temp);\n\t\t\t}\n\t\t\t\n\t\t\tfloat ctan(float z)\n\t\t\t{\n\t\t\t\treturn tan(z);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tvec2 z = vec2(uv.x * aspect_ratio * box_size_halved + center_x, uv.y * box_size_halved + center_y);\n\t\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (julia_mode == 0)\n\t\t\t\t{\n\t\t\t\t\tvec2 c = z;\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= escape_radius)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${v};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\telse if (julia_mode == 1)\n\t\t\t\t{\n\t\t\t\t\tvec2 c = vec2(a, b);\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= escape_radius)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${v};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvec2 c = z;\n\t\t\t\t\t\n\t\t\t\t\tbool broken = false;\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= escape_radius)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${v};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (!broken)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(.5 * brightness / brightness_scale * color, 1.0);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(uv.x * aspect_ratio * 2.0, uv.y * 2.0);\n\t\t\t\t\tcolor = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\t\tbrightness = exp(-length(z));\n\t\t\t\t\t\n\t\t\t\t\tbroken = false;\n\t\t\t\t\t\n\t\t\t\t\tc = vec2(a, b);\n\t\t\t\t\t\n\t\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor.xyz /= 4.0;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (length(z) >= escape_radius)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tz = ${v};\n\t\t\t\t\t\t\n\t\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!broken)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor += vec4(brightness / brightness_scale * color, 0.0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`);E=t.createProgram(),t.attachShader(E,n),t.attachShader(E,e),t.linkProgram(E),t.getProgramParameter(E,t.LINK_STATUS)||(console.log(`Couldn't link shader program: ${t.getShaderInfoLog(shader)}`),t.deleteProgram(E)),t.useProgram(E);let o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),t.STATIC_DRAW),E.position_attribute=t.getAttribLocation(E,"position"),t.enableVertexAttribArray(E.position_attribute),t.vertexAttribPointer(E.position_attribute,3,t.FLOAT,!1,0,0),E.aspect_ratio_uniform=t.getUniformLocation(E,"aspect_ratio"),E.box_size_halved_uniform=t.getUniformLocation(E,"box_size_halved"),E.center_x_uniform=t.getUniformLocation(E,"center_x"),E.center_y_uniform=t.getUniformLocation(E,"center_y"),E.a_uniform=t.getUniformLocation(E,"a"),E.b_uniform=t.getUniformLocation(E,"b"),E.brightness_scale_uniform=t.getUniformLocation(E,"brightness_scale"),E.escape_radius_uniform=t.getUniformLocation(E,"escape_radius"),E.num_iterations_uniform=t.getUniformLocation(E,"num_iterations"),E.julia_mode_uniform=t.getUniformLocation(E,"julia_mode"),t.viewport(0,0,S,A),window.requestAnimationFrame(k)}function M(t,n,e){let o=t.createShader(n);return t.shaderSource(o,e),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function k(){r=!1,t.uniform1f(E.aspect_ratio_uniform,S/A),t.uniform1f(E.box_size_halved_uniform,h/2),t.uniform1f(E.center_x_uniform,p),t.uniform1f(E.center_y_uniform,z),t.uniform1f(E.a_uniform,g),t.uniform1f(E.b_uniform,w),t.uniform1f(E.escape_radius_uniform,b),t.uniform1f(E.brightness_scale_uniform,y),t.uniform1i(E.num_iterations_uniform,R),t.uniform1i(E.julia_mode_uniform,d),t.drawArrays(t.TRIANGLE_STRIP,0,4);let n=new Uint8Array(S*A*4);t.readPixels(0,0,S,A,t.RGBA,t.UNSIGNED_BYTE,n);let e=0;for(let t=0;t<S*A;t++)255!==n[4*t]&&255!==n[4*t+1]&&255!==n[4*t+2]||e++;let o=!1,c=p*p+z*z+2;0!==d&&(c=g*g+w*w+2),e<2*q*x&&1!==u&&y>1/c*Math.sqrt(x)?(y-=.5/c*Math.sqrt(x),a&&(y-=.5/c*Math.sqrt(x),u=-1),o=!0):e>4*q*x&&-1!==u&&(y+=.5/c*Math.sqrt(x),a&&(y+=.5/c*Math.sqrt(x),u=1),o=!0),a?o?window.requestAnimationFrame(k):(u=0,a=!1):r&&window.requestAnimationFrame(k)}function j(){b=parseFloat(document.querySelector("#escape-radius-input").value||100),x=parseFloat(document.querySelector("#exposure-input").value||1),v=document.querySelector("#code-input").value||"cadd(cpow(z, 2.0), c)",document.querySelector("#output-canvas").remove();let r=document.createElement("canvas");r.id="output-canvas",r.classList.add("no-floating-footer"),r.setAttribute("width",S),r.setAttribute("height",A),t=r.getContext("webgl"),document.querySelector("#container").appendChild(r),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){canvas_is_fullscreen?aspect_ratio>=1?(S=q,A=Math.floor(q/aspect_ratio)):(S=Math.floor(q*aspect_ratio),A=q):(S=q,A=q),n=document.querySelector("#output-canvas").offsetWidth,e=document.querySelector("#output-canvas").offsetHeight,o=Math.min(n,e),document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",A),t.viewport(0,0,S,A),X(),window.requestAnimationFrame(k)},applet_canvas_true_fullscreen=!0,set_up_canvas_resizer(),0!==d&&(document.querySelector("#switch-julia-mode-button").style.opacity=0,setTimeout(function(){document.querySelector("#switch-julia-mode-button").textContent="Pick Julia Set",equalize_text_buttons(),document.querySelector("#switch-julia-mode-button").style.opacity=1},300)),y=13,d=0,C(),a=!0,k(),document.querySelector("#output-canvas").addEventListener("mousedown",T),document.documentElement.addEventListener("mousemove",P),temporary_handlers.mousemove.push(P),document.documentElement.addEventListener("mouseup",U),temporary_handlers.mouseup.push(U),document.querySelector("#output-canvas").addEventListener("touchstart",B),document.querySelector("#output-canvas").addEventListener("touchmove",Y),document.querySelector("#output-canvas").addEventListener("touchend",D),window.addEventListener("wheel",I,{passive:!1}),temporary_handlers.wheel.push(I)}function T(t){t.preventDefault(),i=t.clientX,l=t.clientY,2!==d?m=!0:(d=1,p=0,z=0,h=4,_=0,a=!0,equalize_text_buttons(),document.querySelector("#switch-julia-mode-button").style.opacity=1),r||(r=!0,a=!0,u=0,window.requestAnimationFrame(k))}function P(t){let o=t.clientX,u=t.clientY,c=o-i,s=u-l;if(i=o,l=u,document.elementFromPoint(i,l)===document.querySelector("#output-canvas"))if(2!==d)m&&(t.preventDefault(),p-=c/e*h,z+=s/e*h,r||(r=!0,a=!1,window.requestAnimationFrame(k)));else{t.preventDefault();let o=i-document.querySelector("#output-canvas").getBoundingClientRect().left,u=l-document.querySelector("#output-canvas").getBoundingClientRect().top;g=(o/n-.5)*h+p,w=((e-u)/e-.5)*h+z,r||(r=!0,a=!1,window.requestAnimationFrame(k))}}function U(t){r=m=!1}function B(t){i=t.touches[0].clientX,l=t.touches[0].clientY,m=!0,r||(r=!0,a=!1,window.requestAnimationFrame(k))}function Y(t){if(t.preventDefault(),a)return;let o=t.touches[0].clientX,u=t.touches[0].clientY;if(t.touches.length>=2){f=10;let o=t.touches[0].clientX-t.touches[1].clientX,r=t.touches[0].clientY-t.touches[1].clientY,a=Math.sqrt(o*o+r*r),u=a-s;if(s=a,Math.abs(u)>20)return;let c=document.querySelector("#output-canvas").getBoundingClientRect(),i=((t.touches[0].clientX+t.touches[1].clientX)/2-c.left)/n,l=((t.touches[0].clientY+t.touches[1].clientY)/2-c.top)/e,m=(i*h-h/2)*S/A+p,d=h/2-l*h+z,v=u/2;_+v>=-100&&(_+=v,h=4/Math.pow(1.02,_),R=Math.max(3*_+200,200)),p=m-(i*h-h/2)*S/A,z=d-(h/2-l*h)}else--f<0&&(f=0);let c=o-i,m=u-l;if(!f||!(Math.abs(c)>50||Math.abs(m)>50)){if(i=o,l=u,2!==d)p-=c/e*h,z+=m/e*h;else{let t=i-document.querySelector("#output-canvas").getBoundingClientRect().left,o=l-document.querySelector("#output-canvas").getBoundingClientRect().top;g=(t/n-.5)*h+p,w=((e-o)/e-.5)*h+z}r||(r=!0,a=!1,window.requestAnimationFrame(k))}}function D(t){0===t.touches.length&&(r=!1,2===d&&(d=1,p=0,z=0,h=4,_=0,equalize_text_buttons(),document.querySelector("#switch-julia-mode-button").style.opacity=1)),a=!0,u=0,setTimeout(function(){r||window.requestAnimationFrame(k)},200)}function I(t){if("output-canvas"===document.elementFromPoint(i,l).id){t.preventDefault(),(_-=10*Math.sign(t.deltaY))<-100&&(_=-100,y=13);let o=document.querySelector("#output-canvas").getBoundingClientRect(),r=(i-o.left)/n,s=(l-o.top)/e,m=(r*h-h/2)*S/A+p,f=h/2-s*h+z;h=4/Math.pow(1.02,_),R=Math.max(3*_+200,200),p=m-(r*h-h/2)*S/A,z=f-(h/2-s*h),window.requestAnimationFrame(k);try{clearTimeout(c)}catch(t){}c=setTimeout(function(){a=!0,u=0,window.requestAnimationFrame(k)},500)}}function X(){n=document.querySelector("#output-canvas").offsetWidth,e=document.querySelector("#output-canvas").offsetHeight,o=Math.min(n,e)}}();