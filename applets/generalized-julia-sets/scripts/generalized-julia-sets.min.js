!function(){"use strict";let e=0,t=0,o=0,r=0,n=0,u=0,l=0,a=0,c=0,s=[],d=[],i=!1,m=!1,p=!0,y="",f=j("z"),g=4,q=5,S=100,b=null,h=null;1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)")),!1===scripts_loaded.complexjs&&load_script("/scripts/complex.min.js").then((function(){scripts_loaded.complexjs=!0})).catch((function(e){console.error("Could not load ComplexJS")})),document.querySelector("#generate-button-1").addEventListener("click",w);let v=document.querySelectorAll("#code-input, #box-size-input, #exposure-input, #escape-radius-input");for(let e=0;e<v.length;e++)v[e].addEventListener("keydown",(function(e){13===e.keyCode&&w()}));document.querySelector("#generate-button-2").addEventListener("click",k),v=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<v.length;e++)v[e].addEventListener("keydown",(function(e){13===e.keyCode&&k()}));function w(){g=parseFloat(document.querySelector("#box-size-input").value||4),q=parseFloat(document.querySelector("#exposure-input").value||5),S=parseFloat(document.querySelector("#escape-radius-input").value||100),y=document.querySelector("#code-input").value||"z.pow(2).add(c)",f=j(y),function(e,t){d=[];for(let t=0;t<e;t++)d[t]=[];let o=null;document.querySelector("#mandelbrot-set").setAttribute("width",e),document.querySelector("#mandelbrot-set").setAttribute("height",e),o=document.querySelector("#mandelbrot-set").getContext("2d",{alpha:!1});for(let o=0;o<e;o++)C(o,e,t);let r=d.flat().sort((function(e,t){return e-t})),n=r[Math.round(r.length*(1-q/200))-1];for(let t=0;t<e;t++)d[t]=d[t].map((e=>e/n*255));let u=o.getImageData(0,0,e,e),l=u.data;for(let t=0;t<e;t++)for(let o=0;o<e;o++){let r=d[t][o],n=4*t*e+4*o;l[n]=r/3,l[n+1]=r/3,l[n+2]=r,l[n+3]=255}o.putImageData(u,0,0)}(500,50)}function C(e,t,o){for(let r=0;r<t;r++){let n=(r-t/2)/t*g,u=-(e-t/2)/t*g,l=new Complex([n,u]),a=new Complex([n,u]),c=Math.exp(-l.abs()),s=0;for(s=0;s<o&&(l=f(l,a),c+=Math.exp(-l.abs()),!(l.abs()>S));s++);s===o&&(c=0),d[e][r]=c}}function x(){if(e===n&&t===u&&r===l)return void(p=!0);d=[];for(let e=0;e<r;e++)d[e]=[];let a=null;document.querySelector("#julia-set").setAttribute("width",r),document.querySelector("#julia-set").setAttribute("height",r),a=document.querySelector("#julia-set").getContext("2d",{alpha:!1});for(let n=0;n<r;n++)_(n,e,t,r,o);let c=d.flat().sort((function(e,t){return e-t})),i=0;if(100===r){s.push(c[Math.round(c.length*(1-q/200))-1]),s.length>10&&s.shift(),i=0;for(let e=0;e<s.length;e++)i+=s[e];i/=s.length}else i=c[Math.round(c.length*(1-q/2e3))-1];for(let e=0;e<r;e++)d[e]=d[e].map((e=>e/i*255));let y=a.getImageData(0,0,r,r),f=y.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=d[e][t],n=4*e*r+4*t;f[n]=o/3,f[n+1]=o/3,f[n+2]=o,f[n+3]=255}a.putImageData(y,0,0),m?(m=!1,n=e,u=t,l=r,window.requestAnimationFrame(x)):p=!0}function _(e,t,o,r,n){let u=new Complex([t,o]);for(let t=0;t<r;t++){let o=new Complex([(t-r/2)/r*g,-(e-r/2)/r*g]),l=Math.exp(-o.abs()),a=0;for(a=0;a<n&&(o=f(o,u),l+=Math.exp(-o.abs()),!(o.abs()>S));a++);a===n&&(l=0),d[e][t]=l}}function j(e){return new Function("z","c","return "+e)}function k(){let e=parseFloat(document.querySelector("#a-input").value)||0,t=parseFloat(document.querySelector("#b-input").value)||1,o=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#output-canvas").setAttribute("width",o),document.querySelector("#output-canvas").setAttribute("height",o),b=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),n=e,u=t,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{h.terminate()}catch(e){}h=DEBUG?new Worker("/applets/generalized-julia-sets/scripts/worker.js"):new Worker("/applets/generalized-julia-sets/scripts/worker.min.js"),temporary_web_workers.push(h),h.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout((function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout((function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0}),300)}),600);else{let t=b.getImageData(0,0,o,o),r=t.data;for(let t=0;t<o;t++)for(let n=0;n<o;n++){let u=e.data[0][t][n],l=4*t*o+4*n;r[l]=u/3,r[l+1]=u/3,r[l+2]=u,r[l+3]=255}b.putImageData(t,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout((function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0}),300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout((function(){document.querySelector("#progress-bar").style.opacity=1}),600),h.postMessage([e,t,o,200,y,g,q,S])}function A(){a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth}document.querySelector("#download-button").addEventListener("click",(function(){let e=document.createElement("a");e.download=u<0?n+" - "+-u+"i.png":n+" + "+u+"i.png";e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove()})),a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",A),temporary_handlers.resize.push(A),setTimeout(A,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",(function(n){if(!1===i){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=(u/a-.5)*g,t=((a-l)/a-.5)*g,r=100,o=25,m=!0,p&&(p=!1,window.requestAnimationFrame(x))}})),document.querySelector("#mandelbrot-set").addEventListener("click",(function(n){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=(u/a-.5)*g,t=((a-l)/a-.5)*g,r=500,o=50,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,i=!0,m=!0,p&&(p=!1,window.requestAnimationFrame(x))})),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",(function(e){i=!1})),function(){let n=0,u=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",(function(l){l.preventDefault();let c=l.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,s=l.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;n=c,u=s,e=(c/a-.5)*g,t=((a-s)/a-.5)*g,r=100,o=25,m=!0,p&&(p=!1,window.requestAnimationFrame(x))}),!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",(function(l){l.preventDefault(),e=(n/a-.5)*g,t=((a-u)/a-.5)*g,r=500,o=50,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,m=!0,p&&(p=!1,window.requestAnimationFrame(x))}),!1)}(),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){c=document.querySelector("#output-canvas").offsetWidth},set_up_canvas_resizer()}();