!function(){"use strict";let e=0,t=0,o=0,r=0,n=0,u=0,l=0,a=0,c=0,s=100,d=500,i=25,m=50,p=200,y=[],f=[],g=!1,q=!1,b=!0,S="",h=F("z"),v=4,w=5,C=100,x=null,j=null;1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)")),!1===scripts_loaded.complexjs&&load_script("/scripts/complex.min.js").then(function(){scripts_loaded.complexjs=!0}).catch(function(e){console.error("Could not load ComplexJS")}),document.querySelector("#generate-button-1").addEventListener("click",A);let k=document.querySelectorAll("#code-input, #box-size-input, #exposure-input, #escape-radius-input");for(let e=0;e<k.length;e++)k[e].addEventListener("keydown",function(e){13===e.keyCode&&A()});document.querySelector("#generate-button-2").addEventListener("click",B),k=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<k.length;e++)k[e].addEventListener("keydown",function(e){13===e.keyCode&&B()});function A(){v=parseFloat(document.querySelector("#box-size-input").value||4),w=parseFloat(document.querySelector("#exposure-input").value||5),C=parseFloat(document.querySelector("#escape-radius-input").value||100),S=document.querySelector("#code-input").value||"z.pow(2).add(c)",h=F(S),function(e,t){f=[];for(let t=0;t<e;t++)f[t]=[];let o=null;document.querySelector("#mandelbrot-set").setAttribute("width",e),document.querySelector("#mandelbrot-set").setAttribute("height",e),o=document.querySelector("#mandelbrot-set").getContext("2d",{alpha:!1});for(let o=0;o<e;o++)E(o,e,t);let r=f.flat().sort(function(e,t){return e-t}),n=r[Math.round(r.length*(1-w/200))-1];for(let t=0;t<e;t++)f[t]=f[t].map(e=>e/n*255);let u=o.getImageData(0,0,e,e),l=u.data;for(let t=0;t<e;t++)for(let o=0;o<e;o++){let r=f[t][o],n=4*t*e+4*o;l[n]=r/3,l[n+1]=r/3,l[n+2]=r,l[n+3]=255}o.putImageData(u,0,0)}(500,50)}function E(e,t,o){for(let r=0;r<t;r++){let n=(r-t/2)/t*v,u=-(e-t/2)/t*v,l=new Complex([n,u]),a=new Complex([n,u]),c=Math.exp(-l.abs()),s=0;for(s=0;s<o&&(l=h(l,a),c+=Math.exp(-l.abs()),!(l.abs()>C));s++);s===o&&(c=0),f[e][r]=c}}function L(){if(e===n&&t===u&&r===l)return void(b=!0);f=[];for(let e=0;e<r;e++)f[e]=[];let a=null;document.querySelector("#julia-set").setAttribute("width",r),document.querySelector("#julia-set").setAttribute("height",r),a=document.querySelector("#julia-set").getContext("2d",{alpha:!1});for(let n=0;n<r;n++)M(n,e,t,r,o);let c=f.flat().sort(function(e,t){return e-t}),d=0;if(r===s){y.push(c[Math.round(c.length*(1-w/200))-1]),y.length>10&&y.shift(),d=0;for(let e=0;e<y.length;e++)d+=y[e];d/=y.length}else d=c[Math.round(c.length*(1-w/2e3))-1];for(let e=0;e<r;e++)f[e]=f[e].map(e=>e/d*255);let i=a.getImageData(0,0,r,r),m=i.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=f[e][t],n=4*e*r+4*t;m[n]=o/3,m[n+1]=o/3,m[n+2]=o,m[n+3]=255}a.putImageData(i,0,0),q?(q=!1,n=e,u=t,l=r,window.requestAnimationFrame(L)):b=!0}function M(e,t,o,r,n){let u=new Complex([t,o]);for(let t=0;t<r;t++){let o=new Complex([(t-r/2)/r*v,-(e-r/2)/r*v]),l=Math.exp(-o.abs()),a=0;for(a=0;a<n&&(o=h(o,u),l+=Math.exp(-o.abs()),!(o.abs()>C));a++);a===n&&(l=0),f[e][t]=l}}function F(e){return new Function("z","c",`return ${e}`)}function B(){let e=parseFloat(document.querySelector("#a-input").value)||0,t=parseFloat(document.querySelector("#b-input").value)||1,o=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#output-canvas").setAttribute("width",o),document.querySelector("#output-canvas").setAttribute("height",o),x=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),n=e,u=t,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{j.terminate()}catch(e){}j=DEBUG?new Worker("/applets/generalized-julia-sets/scripts/worker.js"):new Worker("/applets/generalized-julia-sets/scripts/worker.min.js"),temporary_web_workers.push(j),j.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let t=x.getImageData(0,0,o,o),r=t.data;for(let t=0;t<o;t++)for(let n=0;n<o;n++){let u=e.data[0][t][n],l=4*t*o+4*n;r[l]=u/3,r[l+1]=u/3,r[l+2]=u,r[l+3]=255}x.putImageData(t,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),j.postMessage([e,t,o,p,S,v,w,C])}function D(){a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth}document.querySelector("#download-button").addEventListener("click",function(){let e=document.createElement("a");e.download=u<0?n+" - "+-u+"i.png":n+" + "+u+"i.png";e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove()}),a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",D),temporary_handlers.resize.push(D),setTimeout(D,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(n){if(!1===g){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=(u/a-.5)*v,t=((a-l)/a-.5)*v,r=s,o=i,q=!0,b&&(b=!1,window.requestAnimationFrame(L))}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(n){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=(u/a-.5)*v,t=((a-l)/a-.5)*v,r=d,o=m,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,g=!0,q=!0,b&&(b=!1,window.requestAnimationFrame(L))}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){g=!1}),function(){let n=0,u=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(l){l.preventDefault();let c=l.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,d=l.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;n=c,u=d,e=(c/a-.5)*v,t=((a-d)/a-.5)*v,r=s,o=i,q=!0,b&&(b=!1,window.requestAnimationFrame(L))},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(l){l.preventDefault(),e=(n/a-.5)*v,t=((a-u)/a-.5)*v,r=d,o=m,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,q=!0,b&&(b=!1,window.requestAnimationFrame(L))},!1)}()}();