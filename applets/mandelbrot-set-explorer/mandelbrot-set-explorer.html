<div style="height: 5vh"></div>

<noscript>
	<p class="body-text" style="text-align: center">JavaScript is required to use this site and many others. Consider enabling it.</p>
</noscript>



<header>
	<div class="logo" data-aos="fade-in" id="trigger-section-1">
		<a href="/home.html">
			<img src="/graphics/general-icons/logo.png" alt="Logo" onclick="redirect('/home.html')"></img>
		</a>
	</div>

	<div style="height: 2vh"></div>

	<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-1">
		<h1 class="heading-text">Mandelbrot Set Explorer</h1>
	</div>
</header>



<div style="height: 5vh"></div>



<main>
	<section>
		<div data-aos="fade-up" data-aos-delay="200">
			<p class="body-text center-if-needed">
				<span id="instructions">Hover over the Mandelbrot set to view that area up close, and click to generate a higher-resolution image. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</a>.</span>
			</p>
		</div>
		
		<br>
		
		<div data-aos="fade-up" data-aos-delay="300">
			<p class="body-text center-if-needed">
				<span>This applet can run slowly on older hardware, especially in comparison to the <a href="/applets/julia-set-explorer/julia-set-explorer.html" onclick="redirect('/applets/julia-set-explorer/julia-set-explorer.html')">Julia set explorer</a>. Care has been taken to optimize the program, but be warned that some locations can take a long time to generate.</span>
			</p>
		</div>
		
		<div style="height: 10vh"></div>
		
		
		
		<div id="container" data-aos="fade-up" data-aos-delay="400" data-aos-anchor="#trigger-section-1">
			<img id="mandelbrot-set" class="check-webp" src="" alt="The Mandelbrot Set"></img>
			<canvas id="mandelbrot-zoom"></canvas>
		</div>
	</section>
	
	
	
	<div style="height: 15vh"></div>
	
	
	
	<section>
		<div data-aos="fade-up" id="trigger-section-2">
			<h2 class="section-text">Higher Resolution</h2>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-2">
			<p class="body-text">Enter values of \(x\) and \(y\), along with an image size in pixels, to generate an image of the Mandelbrot set around \(x + yi\). The values are filed in automatically when a high-resolution preview is created above, but custom values can be used. Image sizes larger than 1000 are not recommended.</p>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div style="width: 70vw; margin: 0 auto; display: flex; justify-content: space-between">
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="200" data-aos-anchor="#trigger-section-2">
				<input id="x-input" class="text-box" type="text" style="width: 100%">
				<label for="x-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(x\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-2">
				<input id="y-input" class="text-box" type="text" style="width: 100%">
				<label for=y-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(y\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="400" data-aos-anchor="#trigger-section-2">
				<input id="dim-input" class="text-box" type="text" style="width: 100%">
				<label for="dim-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">Image Size</p>
				</label>
			</div>
		</div>	
		
		<div style="height: 5vh"></div>
		
		<div style="display: flex; justify-content: center; width: 70vw; margin: 0 auto" data-aos="zoom-out" data-aos-delay="1000" data-aos-anchor="#trigger-section-2">
			<button class="text-button" type="button" id="generate-button">Generate</button>
		</div>
		
		<div style="height: 10vh"></div>
		
		<canvas id="high-res-mandelbrot-zoom" data-aos="fade-in" data-aos-delay="1600" data-aos-anchor="#trigger-section-2"></canvas>
		
		<div id="download-location" style="height: 10vh"></div>
	</section>
</main>



<footer>
	<div id="spawn-footer"></div>
</footer>



<script>
	if (typeof current_url == "undefined")
	{
		window.location.replace("/index.html?page=" + encodeURIComponent(window.location.pathname));
	}
	
	
	
	page_settings = 
	{
		"title": "Mandelbrot Set Explorer",
		
		"banner_page": false,
		"writing_page": false,
		"math_page": true,
		"comments": false,
		
		"manual_banner": false,
		"manual_dark_theme": false,
		
		"no_footer": false,
		"footer_exclusion": "",
		"footer_from_nonstandard_color": false
	};
	
	on_page_load();
	
	
	
	!function()
	{
		let small_canvas_size = 0;
		let large_canvas_size = 0;
		
		let small_mandelbrot_zoom_size = 50;
		let max_large_mandelbrot_zoom_size = 500;
		
		let small_mandelbrot_zoom_iterations = 50;
		let large_mandelbrot_zoom_iterations = 100;
		let full_res_mandelbrot_zoom_iterations = 100;
		
		let image = [];
		
		let persist_image = false;
		
		let ctx = null;
		
		
		
		add_style(`
			#container
			{
				display: flex;
				justify-content: space-between;
				width: 70vw;
				margin-left: 15vw;
			}
			
			#mandelbrot-set, #mandelbrot-zoom
			{
				width: 30vw;
				height: 30vw;
			}
			
			#high-res-mandelbrot-zoom
			{
				width: 90vmin;
				height: 90vmin;
				margin-left: calc((100vw - (90vmin + 8px)) / 2);
			}
			
			#mandelbrot-set, #mandelbrot-zoom, #high-res-mandelbrot-zoom
			{
				border: 2px solid rgb(127, 127, 127);
				-webkit-border-radius: 15px;
				border-radius: 15px;
				padding: 2px;
			}
			
			
			
			@media screen and (max-aspect-ratio: 9/16), (max-width: 700px)
			{
				#container:not(.layout-override)
				{
					flex-direction: column;
					margin-left: calc((100vw - (70vw + 8px)) / 2);
				}
				
				#mandelbrot-set:not(.layout-override), #mandelbrot-zoom:not(.layout-override)
				{
					width: 70vw;
					height: 70vw;
				}
				
				#mandelbrot-set
				{
					margin-bottom: 5vw;
				}
			}
		`, true);
		
		
		
		if (scripts_loaded["mathjs"] == false)
		{
			load_script("https://unpkg.com/mathjs@5.9.0/dist/math.min.js")
			
			.then(function()
			{
				scripts_loaded["mathjs"] == true;
			})
			
			.catch(function(error)
			{
				console.error("Could not load MathJS");
			});
		}
		
		
		
		if (url_vars["contrast"] == 1)
		{
			if (url_vars["theme"] == 1)
			{
				document.querySelector("#mandelbrot-set").style.borderColor = "rgb(192, 192, 192)";
				document.querySelector("#mandelbrot-zoom").style.borderColor = "rgb(192, 192, 192)";
				document.querySelector("#high-res-mandelbrot-zoom").style.borderColor = "rgb(192, 192, 192)";
			}
			
			else
			{
				document.querySelector("#mandelbrot-set").style.borderColor = "rgb(64, 64, 64)";
				document.querySelector("#mandelbrot-zoom").style.borderColor = "rgb(64, 64, 64)";
				document.querySelector("#high-res-mandelbrot-zoom").style.borderColor = "rgb(64, 64, 64)";
			}
		}
		
		
		
		document.querySelector("#generate-button").addEventListener("click", draw_high_res_mandelbrot_zoom);
		
		
		
		//Only get the width of the Mandelbrot set has finished loading in order to get the correct value.
		small_canvas_size = document.querySelector("#mandelbrot-zoom").offsetWidth;
		large_canvas_size = document.querySelector("#high-res-mandelbrot-zoom").offsetWidth;
		
		window.addEventListener("resize", mandelbrot_zoom_resize);
		temporary_handlers["resize"].push(mandelbrot_zoom_resize);
		
		
		
		//As the user scrolls around the image, make tiny Julia set previews.
		if (!hasTouch())
		{
			document.querySelector("#mandelbrot-set").addEventListener("mousemove", function(e)
			{
				if (persist_image == false)
				{
					let mouse_x = e.clientX - document.querySelector("#mandelbrot-set").getBoundingClientRect().left;
					let mouse_y = e.clientY - document.querySelector("#mandelbrot-set").getBoundingClientRect().top;
					
					let center_x = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
					let center_y = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
					
					draw_mandelbrot_zoom(center_x, center_y, small_mandelbrot_zoom_size, small_mandelbrot_zoom_iterations, false);
				}
			});
			
			//On a click, make a much larger image.
			document.querySelector("#mandelbrot-set").addEventListener("click", function(e)
			{
				let mouse_x = e.clientX - document.querySelector("#mandelbrot-set").getBoundingClientRect().left;
				let mouse_y = e.clientY - document.querySelector("#mandelbrot-set").getBoundingClientRect().top;
				
				let center_x = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
				let center_y = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
				
				draw_mandelbrot_zoom(center_x, center_y, Math.min(small_canvas_size, max_large_mandelbrot_zoom_size), large_mandelbrot_zoom_iterations, false);
				
				document.querySelector("#x-input").value = Math.round(1000000 * center_x) / 1000000;
				document.querySelector("#y-input").value = Math.round(1000000 * center_y) / 1000000;
				document.querySelector("#dim-input").value = 1000;
				
				persist_image = true;
			});
			
			document.querySelector("#mandelbrot-set").addEventListener("mouseleave", function(e)
			{
				persist_image = false;
			});
		}
		
		
		
		//Handle touchscreens.
		else
		{
			let last_touch_x = 0;
			let last_touch_y = 0;
			
			
			
			document.querySelector("#instructions").innerHTML = `Drag along the Mandelbrot set to view that area up close, and release to generate a higher-resolution image. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</a>.`;
			
			document.querySelector("#mandelbrot-set").addEventListener("touchmove", function(e)
			{
				e.preventDefault();
					
				let touch_x = e.touches[0].clientX - document.querySelector("#mandelbrot-set").getBoundingClientRect().left;
				let touch_y = e.touches[0].clientY - document.querySelector("#mandelbrot-set").getBoundingClientRect().top;
				
				last_touch_x = touch_x;
				last_touch_y = touch_y;
				
				let center_x = ((touch_x / small_canvas_size) - .5) * 3 - .75;
				let center_y = (((small_canvas_size - touch_y) / small_canvas_size) - .5) * 3;
				
				draw_mandelbrot_zoom(center_x, center_y, small_mandelbrot_zoom_size, small_mandelbrot_zoom_iterations, false);
			}, false);
			
			document.querySelector("#mandelbrot-set").addEventListener("touchend", function(e)
			{
				e.preventDefault();
				
				let center_x = ((last_touch_x / small_canvas_size) - .5) * 3 - .75;
				let center_y = (((small_canvas_size - last_touch_y) / small_canvas_size) - .5) * 3;
				
				draw_mandelbrot_zoom(center_x, center_y, Math.min(small_canvas_size, max_large_mandelbrot_zoom_size), large_mandelbrot_zoom_iterations, false);
				
				document.querySelector("#x-input").value = Math.round(1000000 * center_x) / 1000000;
				document.querySelector("#y-input").value = Math.round(1000000 * center_y) / 1000000;
				document.querySelector("#dim-input").value = 1000;
			}, false);
		}
		
		
		
		function draw_high_res_mandelbrot_zoom()
		{
			let center_x = parseFloat(document.querySelector("#x-input").value) || 0;
			let center_y  = parseFloat(document.querySelector("#y-input").value) || 0;
			let dim = parseFloat(document.querySelector("#dim-input").value) || 1000;
			
			draw_mandelbrot_zoom(center_x, center_y, dim, full_res_mandelbrot_zoom_iterations, true);
		}
		
		
		
		function draw_mandelbrot_zoom(center_x, center_y, mandelbrot_zoom_size, num_iters, download)
		{
			let x = 0, y = 0;
			let z = 0;
			
			image = [];
			
			for (let i = 0; i < mandelbrot_zoom_size; i++)
			{
				image[i] = [];
			}
			
			
			
			let ctx = null;
			let canvas_size = 0;
			
			if (download == false)
			{
				document.querySelector("#mandelbrot-zoom").setAttribute("width", mandelbrot_zoom_size);
				document.querySelector("#mandelbrot-zoom").setAttribute("height", mandelbrot_zoom_size);
				
				ctx = document.querySelector("#mandelbrot-zoom").getContext("2d");
				canvas_size = small_canvas_size;
			}
			
			else
			{
				document.querySelector("#high-res-mandelbrot-zoom").setAttribute("width", mandelbrot_zoom_size);
				document.querySelector("#high-res-mandelbrot-zoom").setAttribute("height", mandelbrot_zoom_size);
				
				ctx = document.querySelector("#high-res-mandelbrot-zoom").getContext("2d");
				canvas_size = large_canvas_size;
			}
			
			
			
			//Generate initial value map.
			for (let i = 0; i < mandelbrot_zoom_size; i++)
			{
				mandelbrot_zoom_row(i, center_x, center_y, mandelbrot_zoom_size, num_iters)
			}
			
			
			
			//Find the max brightness, throwing out the very top values to avoid almost-black images with a few specks of color.
			let brightness_array = image.flat().sort(function(a, b) {return a - b});
			
			//We throw out more if the image is just being scrolled around, since then it's critical that we don't have bright flashes of color.
			let max_brightness = 0;
			
			if (mandelbrot_zoom_size == small_mandelbrot_zoom_size)
			{
				max_brightness = brightness_array[Math.round(brightness_array.length * .995) - 1];
			}
			
			else
			{
				max_brightness = brightness_array[Math.round(brightness_array.length * .9999) - 1];
			}
			
			for (let i = 0; i < mandelbrot_zoom_size; i++)
			{
				for (let j = 0; j < mandelbrot_zoom_size; j++)
				{
					image[i][j] = (image[i][j] / max_brightness) * 255;
					ctx.fillStyle = "rgb(" + 0 + "," + image[i][j] + "," + image[i][j] + ")";
					ctx.fillRect(j, i, 1, 1);
				}
			}
			
			ctx.scale(canvas_size / mandelbrot_zoom_size, canvas_size / mandelbrot_zoom_size);
			
			
			
			if (download)
			{
				try {document.querySelector("#download-button").style.opacity = 0;}
				catch(ex) {}
				
				setTimeout(function()
				{
					try {document.querySelector("#download-button").remove();}
					catch(ex) {}
					
					let image_data = document.querySelector("#high-res-mandelbrot-zoom").toDataURL();
					let filename = math.complex(center_x, center_y).format({precision: 6});
					
					document.querySelector("#download-location").insertAdjacentHTML("afterend", `
						<div id="download-button" class="animated-opacity" style="display: flex; justify-content: center; opacity: 0; width: 70vw; margin: 0 auto">
							<a href="${image_data}" download="${filename}.png" class="real-link">
								<button class="text-button" type="button" onclick="">Download Image</button>
							</a>
						</div>
					`);
					
					document.querySelector("#download-button").style.opacity = 1;
				}, 300);
			}
		}
		
		
		
		function mandelbrot_zoom_row(i, center_x, center_y, mandelbrot_zoom_size, num_iters)
		{
			for (let j = 0; j < mandelbrot_zoom_size; j++)
			{	
				let x = ((j - mandelbrot_zoom_size/2) / mandelbrot_zoom_size) * .25 + center_x;
				let y = (-(i - mandelbrot_zoom_size/2) / mandelbrot_zoom_size) * .25 + center_y;
				
				let z = math.complex(x, y);
				let c = z;
				
				let brightness = math.exp(-math.abs(z));
				
				let k = 0;
				
				for (k = 0; k < num_iters; k++)
				{
					z = math.add(math.multiply(z, z), c);
					
					brightness += math.exp(-math.abs(z));
					
					if (math.abs(z) > 2)
					{
						break;
					}
				}
				
				if (k == num_iters)
				{
					brightness = 0;
				}
				
				
				
				image[i][j] = brightness;
			}
		}
		
		
		
		function mandelbrot_zoom_resize()
		{
			small_canvas_size = document.querySelector("#mandelbrot-zoom").offsetWidth;
			large_canvas_size = document.querySelector("#high-res-mandelbrot-zoom").offsetWidth;
		}
	}()
</script>