"use strict";onmessage=async function(e){new_zoom_level=e.data[4],await draw_mandelbrot_zoom(...e.data.slice(0,4))};let image=[],new_zoom_level=null;function draw_mandelbrot_zoom(e,o,t,a){return new Promise(function(r,l){image=[];for(let e=0;e<t;e++)image[e]=[];let n=Math.floor(t/20);for(let r=0;r<t;r++)mandelbrot_zoom_row(r,e,o,t,a),r%n==0&&postMessage(["progress",r/n*10]);postMessage(["progress",100]);let m=image.flat().sort(function(e,o){return e-o}),s=m[Math.round(.9999*m.length)-1];for(let e=0;e<t;e++)image[e]=image[e].map(e=>e/s*255);postMessage([image]),r()})}function mandelbrot_zoom_row(e,o,t,a,r){for(let l=0;l<a;l++){let n=(l-a/2)/a*new_zoom_level+o,m=-(e-a/2)/a*new_zoom_level+t,s=n,i=m,_=Math.exp(-Math.sqrt(n*n+m*m)),g=0;for(g=0;g<r;g++){let e=2*n*m+i;if(n=n*n-m*m+s,m=e,_+=Math.exp(-Math.sqrt(n*n+m*m)),n*n+m*m>4)break}g===r&&(_=0),image[e][l]=_}}