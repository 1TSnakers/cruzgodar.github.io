!function(){"use strict";let e=null,t=null,o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth,n=100,l=500,u=50,c=100,a=-.75,d=0,s=0,m=0,i=3,y=.6,p=[],g=!1,b=0,f=0,q=[],h=!1;function S(t,o,r,s){q=[];for(let e=0;e<r;e++)q[e]=[];!0===g&&(i/=5,y/=5,c+=150,u+=150,a=b,d=f,g=!1);document.querySelector("#mandelbrot-zoom").setAttribute("width",r),document.querySelector("#mandelbrot-zoom").setAttribute("height",r),e=document.querySelector("#mandelbrot-zoom").getContext("2d",{alpha:!1});for(let e=0;e<r;e++)v(e,t,o,r,s);let m=q.flat().sort(function(e,t){return e-t}),h=0;if(r===n){p.push(m[Math.round(.999*m.length)-1]),p.length>10&&p.shift(),h=0;for(let e=0;e<p.length;e++)h+=p[e];h/=p.length}else h=m[Math.round(.9999*m.length)-1];for(let e=0;e<r;e++)q[e]=q[e].map(e=>e/h*255);let S=e.getImageData(0,0,r,r),w=S.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=q[e][t],n=4*e*r+4*t;w[n]=0,w[n+1]=o,w[n+2]=o,w[n+3]=255}if(e.putImageData(S,0,0),r===l){let e=document.querySelector("#mandelbrot-set").getAttribute("width");document.querySelector("#mandelbrot-set").getContext("2d",{alpha:!1}).drawImage(document.querySelector("#mandelbrot-zoom"),0,0,e,e),g=!0,b=t,f=o}}function v(e,t,o,r,n){for(let l=0;l<r;l++){let u=(l-r/2)/r*y+t,c=-(e-r/2)/r*y+o,a=u,d=c,s=Math.exp(-Math.sqrt(u*u+c*c)),m=0;for(m=0;m<n;m++){let e=2*u*c+d;if(u=u*u-c*c+a,c=e,s+=Math.exp(-Math.sqrt(u*u+c*c)),u*u+c*c>4)break}m===n&&(s=0),q[e][l]=s}}function w(){let o=parseInt(document.querySelector("#dim-input").value||1e3);document.querySelector("#output-canvas").setAttribute("width",o),document.querySelector("#output-canvas").setAttribute("height",o),e=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{t.terminate()}catch(e){}t=DEBUG?new Worker("/applets/mandelbrot-set-explorer/scripts/worker.js"):new Worker("/applets/mandelbrot-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(t),t.onmessage=function(t){if("progress"===t.data[0])document.querySelector("#progress-bar span").style.width=t.data[1]+"%",100===t.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let r=e.getImageData(0,0,o,o),n=r.data;for(let e=0;e<o;e++)for(let r=0;r<o;r++){let l=t.data[0][e][r],u=4*e*o+4*r;n[u]=0,n[u+1]=l,n[u+2]=l,n[u+3]=255}e.putImageData(r,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),t.postMessage([s,m,o,c,y])}function C(){o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth}!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to view that area up close, and release to generate a higher-resolution image.")}(),function(){document.querySelector("#mandelbrot-set").setAttribute("width",o),document.querySelector("#mandelbrot-set").setAttribute("height",o);let e=document.querySelector("#mandelbrot-set").getContext("2d",{alpha:!1}),t=new Image;t.src="/applets/mandelbrot-set-explorer/graphics/mandelbrot-set.png",t.onload=function(){e.drawImage(t,0,0,o,o)}}(),document.querySelector("#generate-button").addEventListener("click",w),document.querySelector("#dim-input").addEventListener("keydown",function(e){13===e.keyCode&&w()}),document.querySelector("#download-button").addEventListener("click",function(){let e=document.createElement("a");e.download=m<0?s+" - "+-m+"i.png":s+" + "+m+"i.png";e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove()}),window.addEventListener("resize",C),temporary_handlers.resize.push(C),setTimeout(C,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===h){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,l=(t/o-.5)*i+a,c=((o-r)/o-.5)*i+d;S(l,c,n,u)}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,n=(t/o-.5)*i+a,u=((o-r)/o-.5)*i+d;S(n,u,l,c),s=n,m=u,h=!0}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){h=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let l=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,c=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=l,t=c;let s=(l/o-.5)*i+a,m=((o-c)/o-.5)*i+d;S(s,m,n,u)},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(r){r.preventDefault();let n=(e/o-.5)*i+a,u=((o-t)/o-.5)*i+d;S(n,u,l,c),s=n,m=u},!1)}()}();