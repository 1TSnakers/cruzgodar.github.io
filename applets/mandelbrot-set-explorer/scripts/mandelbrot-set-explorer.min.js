!function(){"use strict";let e=null,t=null,o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth,n=100,u=500,l=50,c=100,a=-.75,d=0,s=0,m=0,i=3,y=.6,g=[],p=!1,b=0,f=0,q=[],S=!1;function h(t,o,r,s){q=[];for(let e=0;e<r;e++)q[e]=[];!0===p&&(i/=5,y/=5,c+=150,l+=150,a=b,d=f,p=!1);document.querySelector("#mandelbrot-zoom").setAttribute("width",r),document.querySelector("#mandelbrot-zoom").setAttribute("height",r),e=document.querySelector("#mandelbrot-zoom").getContext("2d");for(let e=0;e<r;e++)v(e,t,o,r,s);let m=q.flat().sort(function(e,t){return e-t}),S=0;if(r===n){g.push(m[Math.round(.999*m.length)-1]),g.length>10&&g.shift(),S=0;for(let e=0;e<g.length;e++)S+=g[e];S/=g.length}else S=m[Math.round(.9999*m.length)-1];for(let e=0;e<r;e++)q[e]=q[e].map(e=>e/S*255);let h=e.getImageData(0,0,r,r),w=h.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=q[e][t],n=4*e*r+4*t;w[n]=0,w[n+1]=o,w[n+2]=o,w[n+3]=255}if(e.putImageData(h,0,0),r===u){let e=document.querySelector("#mandelbrot-set").getAttribute("width");document.querySelector("#mandelbrot-set").getContext("2d").drawImage(document.querySelector("#mandelbrot-zoom"),0,0,e,e),p=!0,b=t,f=o}}function v(e,t,o,r,n){for(let u=0;u<r;u++){let l=(u-r/2)/r*y+t,c=-(e-r/2)/r*y+o,a=l,d=c,s=Math.exp(-Math.sqrt(l*l+c*c)),m=0;for(m=0;m<n;m++){let e=2*l*c+d;if(l=l*l-c*c+a,c=e,s+=Math.exp(-Math.sqrt(l*l+c*c)),l*l+c*c>4)break}m===n&&(s=0),q[e][u]=s}}function w(){let e=document.createElement("a");e.download=m<0?s+" - "+-m+"i.png":s+" + "+m+"i.png",e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove()}function C(){let o=parseInt(document.querySelector("#dim-input").value||1e3);document.querySelector("#output-canvas").setAttribute("width",o),document.querySelector("#output-canvas").setAttribute("height",o),e=document.querySelector("#output-canvas").getContext("2d"),document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{t.terminate()}catch(e){}t=DEBUG?new Worker("/applets/mandelbrot-set-explorer/scripts/worker.js"):new Worker("/applets/mandelbrot-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(t),t.onmessage=function(t){if("progress"===t.data[0])document.querySelector("#progress-bar span").style.width=t.data[1]+"%",100===t.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let r=e.getImageData(0,0,o,o),n=r.data;for(let e=0;e<o;e++)for(let r=0;r<o;r++){let u=t.data[0][e][r],l=4*e*o+4*r;n[l]=0,n[l+1]=u,n[l+2]=u,n[l+3]=255}e.putImageData(r,0,0),w(),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),t.postMessage([s,m,o,c,y])}function k(){o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#output-canvas").offsetWidth}!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to view that area up close, and release to generate a higher-resolution image.")}(),function(){document.querySelector("#mandelbrot-set").setAttribute("width",o),document.querySelector("#mandelbrot-set").setAttribute("height",o);let e=document.querySelector("#mandelbrot-set").getContext("2d"),t=new Image;t.src="/applets/mandelbrot-set-explorer/graphics/mandelbrot-set.png",t.onload=function(){e.drawImage(t,0,0,o,o)}}(),document.querySelector("#generate-button").addEventListener("click",C),document.querySelector("#dim-input").addEventListener("keydown",function(e){13===e.keyCode&&C()}),document.querySelector("#download-button").addEventListener("click",w),window.addEventListener("resize",k),temporary_handlers.resize.push(k),setTimeout(k,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===S){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,u=(t/o-.5)*i+a,c=((o-r)/o-.5)*i+d;h(u,c,n,l)}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,n=(t/o-.5)*i+a,l=((o-r)/o-.5)*i+d;h(n,l,u,c),s=n,m=l,S=!0}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){S=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let u=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,c=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=u,t=c;let s=(u/o-.5)*i+a,m=((o-c)/o-.5)*i+d;h(s,m,n,l)},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(r){r.preventDefault();let n=(e/o-.5)*i+a,l=((o-t)/o-.5)*i+d;h(n,l,u,c),s=n,m=l},!1)}()}();