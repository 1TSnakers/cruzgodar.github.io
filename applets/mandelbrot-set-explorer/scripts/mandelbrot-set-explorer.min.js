!function(){"use strict";let t=document.querySelector("#output-canvas").getContext("webgl"),e=document.querySelector("#output-canvas").offsetWidth,n=!1,o=!1,r=0,i=null,u=0,a=0,c=0,s=!1,l=0,m=-.75,d=0,h=3,f=0,v=25,_=500,p=50;document.querySelector("#output-canvas").setAttribute("width",_),document.querySelector("#output-canvas").setAttribute("height",_),document.querySelector("#image-size-input").addEventListener("input",(function(){_=parseInt(document.querySelector("#image-size-input").value||500),_<200&&(_=200);_>2e3&&(_=2e3);document.querySelector("#output-canvas").setAttribute("width",_),document.querySelector("#output-canvas").setAttribute("height",_),t.viewport(0,0,_,_),window.requestAnimationFrame(S)})),document.querySelector("#generate-high-res-image-button").addEventListener("click",(function(){let e=_;_=parseInt(document.querySelector("#high-res-dim-input").value||2e3),p+=50,document.querySelector("#output-canvas").setAttribute("width",_),document.querySelector("#output-canvas").setAttribute("height",_),t.viewport(0,0,_,_),S();let n=document.createElement("a");n.download="a-mandelbrot-zoom.png",n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove(),_=e,p-=50,document.querySelector("#output-canvas").setAttribute("width",_),document.querySelector("#output-canvas").setAttribute("height",_),t.viewport(0,0,_,_),S()})),window.addEventListener("resize",F),setTimeout(F,500),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){e=document.querySelector("#output-canvas").offsetWidth},set_up_canvas_resizer(),document.querySelector("#output-canvas").addEventListener("mousedown",w),document.documentElement.addEventListener("mousemove",A),temporary_handlers.mousemove.push(A),document.documentElement.addEventListener("mouseup",q),temporary_handlers.mouseup.push(q),document.querySelector("#output-canvas").addEventListener("touchstart",z),document.querySelector("#output-canvas").addEventListener("touchmove",x),document.querySelector("#output-canvas").addEventListener("touchend",E),window.addEventListener("wheel",L,{passive:!1}),temporary_handlers.wheel.push(L);let g=null;function y(){let e=b(t,t.VERTEX_SHADER,"\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t"),n=b(t,t.FRAGMENT_SHADER,"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float box_size_halved;\n\t\tuniform float center_x;\n\t\tuniform float center_y;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * box_size_halved + center_x, uv.y * box_size_halved + center_y);\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\tfloat a = z.x;\n\t\t\tfloat b = z.y;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (length(z) >= 2.0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + a, 2.0 * z.x * z.y + b);\n\t\t\t\t\n\t\t\t\tbrightness += exp(-length(z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, brightness / brightness_scale, brightness / brightness_scale, 1.0);\n\t\t}\n\t");g=t.createProgram(),t.attachShader(g,e),t.attachShader(g,n),t.linkProgram(g),t.getProgramParameter(g,t.LINK_STATUS)||(console.log(`Couldn't link shader program: ${t.getShaderInfoLog(shader)}`),t.deleteProgram(g)),t.useProgram(g);let o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),t.STATIC_DRAW),g.position_attribute=t.getAttribLocation(g,"position"),t.enableVertexAttribArray(g.position_attribute),t.vertexAttribPointer(g.position_attribute,3,t.FLOAT,!1,0,0),g.box_size_halved_uniform=t.getUniformLocation(g,"box_size_halved"),g.center_x_uniform=t.getUniformLocation(g,"center_x"),g.center_y_uniform=t.getUniformLocation(g,"center_y"),g.brightness_scale_uniform=t.getUniformLocation(g,"brightness_scale"),g.num_iterations_uniform=t.getUniformLocation(g,"num_iterations"),t.viewport(0,0,_,_),window.requestAnimationFrame(S)}function b(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function S(){t.uniform1f(g.box_size_halved_uniform,h/2),t.uniform1f(g.center_x_uniform,m),t.uniform1f(g.center_y_uniform,d),t.uniform1f(g.brightness_scale_uniform,v),t.uniform1i(g.num_iterations_uniform,p),t.drawArrays(t.TRIANGLE_STRIP,0,4);let e=new Uint8Array(_*_*4);t.readPixels(0,0,_,_,t.RGBA,t.UNSIGNED_BYTE,e);let i=0;for(let t=0;t<_*_;t++){255===e[4*t+1]&&i++}let u=!1;i<.1*_&&1!==r?(v-=2,o&&(r=-1),u=!0):i>.2*_&&-1!==r&&(v+=2,o&&(r=1),u=!0),o?u?window.requestAnimationFrame(S):(r=0,o=!1):n&&window.requestAnimationFrame(S)}function w(t){t.preventDefault(),u=t.clientX,a=t.clientY,s=!0,n||o||(n=!0,window.requestAnimationFrame(S))}function A(t){let n=t.clientX,o=t.clientY,r=n-u,i=o-a;u=n,a=o,s&&(t.preventDefault(),m-=r/e*h,d+=i/e*h)}function q(t){s=!1,n=s}function z(t){u=t.touches[0].clientX,a=t.touches[0].clientY,s=!0,n||(n=!0,o=!1,window.requestAnimationFrame(S))}function x(t){if(t.preventDefault(),o)return;let n=t.touches[0].clientX,r=t.touches[0].clientY;if(t.touches.length>=2){l=10;let n=t.touches[0].clientX-t.touches[1].clientX,o=t.touches[0].clientY-t.touches[1].clientY,r=Math.sqrt(n*n+o*o),i=r-c;if(c=r,Math.abs(i)>20)return;let u=document.querySelector("#output-canvas").getBoundingClientRect(),a=((t.touches[0].clientX+t.touches[1].clientX)/2-u.left)/e,s=((t.touches[0].clientY+t.touches[1].clientY)/2-u.top)/e,_=a*h-h/2+m,g=h/2-s*h+d,y=i/2;f+y>=0&&(f+=y,h=3/Math.pow(1.02,f),p=3*f+50),f<1&&(v=25),m=_-(a*h-h/2),d=g-(h/2-s*h)}else l--,l<0&&(l=0);let i=n-u,s=r-a;l&&(Math.abs(i)>50||Math.abs(s)>50)||(m-=i/e*h,d+=s/e*h,u=n,a=r)}function E(t){0===t.touches.length&&(n=!1),setTimeout((function(){n||o||(o=!0,window.requestAnimationFrame(S))}),500)}function L(t){if("output-canvas"===document.elementFromPoint(u,a).id){t.preventDefault(),f-=t.deltaY/10,f<1&&(f=1,v=25);let n=document.querySelector("#output-canvas").getBoundingClientRect(),c=(u-n.left)/e,s=(a-n.top)/e,l=c*h-h/2+m,_=h/2-s*h+d;h=3/Math.pow(1.02,f),p=3*f+50,m=l-(c*h-h/2),d=_-(h/2-s*h),window.requestAnimationFrame(S);try{clearTimeout(i)}catch(t){}i=setTimeout((function(){o=!0,r=0,window.requestAnimationFrame(S)}),500)}}function F(){e=document.querySelector("#output-canvas").offsetWidth}load_script("/scripts/gl-matrix.min.js").then((function(){setTimeout(y,500)}))}();