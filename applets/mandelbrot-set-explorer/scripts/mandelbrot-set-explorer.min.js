!function(){"use strict";let t=document.querySelector("#output-canvas").getContext("webgl"),e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n),r=!1,i=!1,a=0,u=null,c=0,s=0,l=0,m=!1,d=0,f=-.75,h=0,_=3,v=0,p=13,g=500,y=500,b=500,S=50;document.querySelector("#output-canvas").setAttribute("width",y),document.querySelector("#output-canvas").setAttribute("height",b),document.querySelector("#image-size-input").addEventListener("input",function(){(g=parseInt(document.querySelector("#image-size-input").value||500))<200&&(g=200);g>2e3&&(g=2e3);canvas_is_fullscreen&&(aspect_ratio>=1?(y=g,b=Math.floor(g/aspect_ratio)):(y=Math.floor(g*aspect_ratio),b=g));document.querySelector("#output-canvas").setAttribute("width",y),document.querySelector("#output-canvas").setAttribute("height",b),t.viewport(0,0,y,b),window.requestAnimationFrame(x)}),document.querySelector("#generate-high-res-image-button").addEventListener("click",function(){let e=g;g=parseInt(document.querySelector("#high-res-dim-input").value||2e3),S+=50,document.querySelector("#output-canvas").setAttribute("width",g),document.querySelector("#output-canvas").setAttribute("height",g),t.viewport(0,0,g,g),x();let n=document.createElement("a");n.download="a-mandelbrot-zoom.png",n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove(),g=e,S-=50,document.querySelector("#output-canvas").setAttribute("width",g),document.querySelector("#output-canvas").setAttribute("height",g),t.viewport(0,0,g,g),x()}),window.addEventListener("resize",U),setTimeout(U,500),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){canvas_is_fullscreen?aspect_ratio>=1?(y=g,b=Math.floor(g/aspect_ratio)):(y=Math.floor(g*aspect_ratio),b=g):(y=g,b=g),e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n),document.querySelector("#output-canvas").setAttribute("width",y),document.querySelector("#output-canvas").setAttribute("height",b),t.viewport(0,0,y,b),U(),window.requestAnimationFrame(x)},applet_canvas_true_fullscreen=!0,set_up_canvas_resizer(),document.querySelector("#output-canvas").addEventListener("mousedown",E),document.documentElement.addEventListener("mousemove",L),temporary_handlers.mousemove.push(L),document.documentElement.addEventListener("mouseup",F),temporary_handlers.mouseup.push(F),document.querySelector("#output-canvas").addEventListener("touchstart",R),document.querySelector("#output-canvas").addEventListener("touchmove",T),document.querySelector("#output-canvas").addEventListener("touchend",M),window.addEventListener("wheel",P,{passive:!1}),temporary_handlers.wheel.push(P),setTimeout(function(){let e=z(t,t.VERTEX_SHADER,w),n=z(t,t.FRAGMENT_SHADER,q);A=t.createProgram(),t.attachShader(A,e),t.attachShader(A,n),t.linkProgram(A),t.getProgramParameter(A,t.LINK_STATUS)||(console.log(`Couldn't link shader program: ${t.getShaderInfoLog(shader)}`),t.deleteProgram(A));t.useProgram(A);let o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),t.STATIC_DRAW),A.position_attribute=t.getAttribLocation(A,"position"),t.enableVertexAttribArray(A.position_attribute),t.vertexAttribPointer(A.position_attribute,3,t.FLOAT,!1,0,0),A.aspect_ratio_uniform=t.getUniformLocation(A,"aspect_ratio"),A.box_size_halved_uniform=t.getUniformLocation(A,"box_size_halved"),A.center_x_uniform=t.getUniformLocation(A,"center_x"),A.center_y_uniform=t.getUniformLocation(A,"center_y"),A.brightness_scale_uniform=t.getUniformLocation(A,"brightness_scale"),A.num_iterations_uniform=t.getUniformLocation(A,"num_iterations"),t.viewport(0,0,y,b),window.requestAnimationFrame(x)},500);const w="\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t",q="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float box_size_halved;\n\t\tuniform float center_x;\n\t\tuniform float center_y;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * aspect_ratio * box_size_halved + center_x, uv.y * box_size_halved + center_y);\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\tfloat a = z.x;\n\t\t\tfloat b = z.y;\n\t\t\t\n\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (length(z) >= 2.0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + a, 2.0 * z.x * z.y + b);\n\t\t\t\t\n\t\t\t\tbrightness += exp(-length(z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t}\n\t";let A=null;function z(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function x(){t.uniform1f(A.aspect_ratio_uniform,y/b),t.uniform1f(A.box_size_halved_uniform,_/2),t.uniform1f(A.center_x_uniform,f),t.uniform1f(A.center_y_uniform,h),t.uniform1f(A.brightness_scale_uniform,p),t.uniform1i(A.num_iterations_uniform,S),t.drawArrays(t.TRIANGLE_STRIP,0,4);let e=new Uint8Array(y*b*4);t.readPixels(0,0,y,b,t.RGBA,t.UNSIGNED_BYTE,e);let n=0;for(let t=0;t<y*b;t++)255!==e[4*t]&&255!==e[4*t+1]&&255!==e[4*t+2]||n++;let o=!1;n<1.5*g&&1!==a?(p-=2,i&&(p-=4,a=-1),o=!0):n>2*g&&-1!==a&&(p+=2,i&&(p+=4,a=1),o=!0),i?o?window.requestAnimationFrame(x):(a=0,i=!1):r&&window.requestAnimationFrame(x)}function E(t){t.preventDefault(),c=t.clientX,s=t.clientY,m=!0,r||i||(r=!0,window.requestAnimationFrame(x))}function L(t){let e=t.clientX,o=t.clientY,r=e-c,i=o-s;c=e,s=o,m&&(t.preventDefault(),f-=r/n*_,h+=i/n*_)}function F(t){r=m=!1}function R(t){c=t.touches[0].clientX,s=t.touches[0].clientY,m=!0,r||(r=!0,i=!1,window.requestAnimationFrame(x))}function T(t){if(t.preventDefault(),i)return;let o=t.touches[0].clientX,r=t.touches[0].clientY;if(t.touches.length>=2){d=10;let o=t.touches[0].clientX-t.touches[1].clientX,r=t.touches[0].clientY-t.touches[1].clientY,i=Math.sqrt(o*o+r*r),a=i-l;if(l=i,Math.abs(a)>20)return;let u=document.querySelector("#output-canvas").getBoundingClientRect(),c=((t.touches[0].clientX+t.touches[1].clientX)/2-u.left)/e,s=((t.touches[0].clientY+t.touches[1].clientY)/2-u.top)/n,m=(c*_-_/2)*y/b+f,g=_/2-s*_+h,w=a/2;v+w>=0&&(v+=w,_=3/Math.pow(1.02,v),S=3*v+50),v<1&&(p=13),f=m-(c*_-_/2)*y/b,h=g-(_/2-s*_)}else--d<0&&(d=0);let a=o-c,u=r-s;d&&(Math.abs(a)>50||Math.abs(u)>50)||(f-=a/n*_,h+=u/n*_,c=o,s=r)}function M(t){0===t.touches.length&&(r=!1),setTimeout(function(){r||i||(i=!0,window.requestAnimationFrame(x))},500)}function P(t){if("output-canvas"===document.elementFromPoint(c,s).id){t.preventDefault(),(v-=10*Math.sign(t.deltaY))<1&&(v=1,p=13);let o=document.querySelector("#output-canvas").getBoundingClientRect(),r=(c-o.left)/e,l=(s-o.top)/n,m=(r*_-_/2)*y/b+f,d=_/2-l*_+h;_=3/Math.pow(1.02,v),S=3*v+50,f=m-(r*_-_/2)*y/b,h=d-(_/2-l*_),window.requestAnimationFrame(x);try{clearTimeout(u)}catch(t){}u=setTimeout(function(){i=!0,a=0,window.requestAnimationFrame(x)},500)}}function U(){e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n)}}();