!function(){"use strict";let t=document.querySelector("#output-canvas").getContext("webgl"),e=document.querySelector("#output-canvas").offsetWidth,n=!1,o=0,r=0,i=!1,u=!1,a=!1,c=-.75,s=0,l=3,d=0,m=25,f=500,h=50;document.querySelector("#output-canvas").setAttribute("width",f),document.querySelector("#output-canvas").setAttribute("height",f),document.querySelector("#image-size-input").addEventListener("input",(function(){f=parseInt(document.querySelector("#image-size-input").value||500),f<200&&(f=200);f>2e3&&(f=2e3);document.querySelector("#output-canvas").setAttribute("width",f),document.querySelector("#output-canvas").setAttribute("height",f),t.viewport(0,0,f,f),window.requestAnimationFrame(p)})),document.querySelector("#generate-high-res-image-button").addEventListener("click",(function(){let e=f;f=parseInt(document.querySelector("#high-res-dim-input").value||2e3),h+=50,document.querySelector("#output-canvas").setAttribute("width",f),document.querySelector("#output-canvas").setAttribute("height",f),t.viewport(0,0,f,f),p();let n=document.createElement("a");n.download="a-mandelbrot-zoom.png",n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove(),f=e,h-=50,document.querySelector("#output-canvas").setAttribute("width",f),document.querySelector("#output-canvas").setAttribute("height",f),t.viewport(0,0,f,f),p()})),window.addEventListener("resize",y),setTimeout(y,500),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){e=document.querySelector("#output-canvas").offsetWidth},set_up_canvas_resizer(),document.querySelector("#output-canvas").addEventListener("mousedown",(function(t){t.preventDefault(),o=t.clientX,r=t.clientY,i=!0,n||(n=!0,window.requestAnimationFrame(p))})),document.querySelector("#output-canvas").addEventListener("mousemove",(function(t){if(i){t.preventDefault();let n=t.clientX,i=t.clientY;c-=(n-o)/e*l,s+=(i-r)/e*l,o=n,r=i}})),document.documentElement.addEventListener("mouseup",(function(t){i=!1,n=i||u||a})),document.querySelector("#output-canvas").addEventListener("touchstart",(function(t){o=t.touches[0].clientX,r=t.touches[0].clientY,i=!0,2===t.touches.length?(u=!0,a=!1):3===t.touches.length&&(u=!1,a=!0),n||(n=!0,window.requestAnimationFrame(p))})),document.querySelector("#output-canvas").addEventListener("touchmove",(function(t){t.preventDefault();let n=t.touches[0].clientX,i=t.touches[0].clientY,u=n-o,a=i-r;Math.abs(u)>100||Math.abs(a)>100||(c-=u/e*l,s+=a/e*l,o=n,r=i)})),document.querySelector("#output-canvas").addEventListener("touchend",(function(t){2===t.touches.length?(u=!0,a=!1):3===t.touches.length?(u=!1,a=!0):(u=!1,a=!1,0===t.touches.length&&(n=!1))})),document.documentElement.addEventListener("keydown",(function(t){87===t.keyCode?(u=!0,a=!1,n||(n=!0,window.requestAnimationFrame(p))):83===t.keyCode&&(u=!1,a=!0,n||(n=!0,window.requestAnimationFrame(p)))})),document.documentElement.addEventListener("keyup",(function(t){(87===t.keyCode||83===t.keyCode)&&(u=!1,a=!1,n=i||u||a)}));let v=null;function _(){let e=g(t,t.VERTEX_SHADER,"\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t"),n=g(t,t.FRAGMENT_SHADER,"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float box_size_halved;\n\t\tuniform float center_x;\n\t\tuniform float center_y;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * box_size_halved + center_x, uv.y * box_size_halved + center_y);\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\tfloat a = z.x;\n\t\t\tfloat b = z.y;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (length(z) >= 2.0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + a, 2.0 * z.x * z.y + b);\n\t\t\t\t\n\t\t\t\tbrightness += exp(-length(z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, brightness / brightness_scale, brightness / brightness_scale, 1.0);\n\t\t}\n\t");v=t.createProgram(),t.attachShader(v,e),t.attachShader(v,n),t.linkProgram(v),t.getProgramParameter(v,t.LINK_STATUS)||(console.log(`Couldn't link shader program: ${t.getShaderInfoLog(shader)}`),t.deleteProgram(v)),t.useProgram(v);let o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),t.STATIC_DRAW),v.position_attribute=t.getAttribLocation(v,"position"),t.enableVertexAttribArray(v.position_attribute),t.vertexAttribPointer(v.position_attribute,3,t.FLOAT,!1,0,0),v.box_size_halved_uniform=t.getUniformLocation(v,"box_size_halved"),v.center_x_uniform=t.getUniformLocation(v,"center_x"),v.center_y_uniform=t.getUniformLocation(v,"center_y"),v.brightness_scale_uniform=t.getUniformLocation(v,"brightness_scale"),v.num_iterations_uniform=t.getUniformLocation(v,"num_iterations"),t.viewport(0,0,f,f),window.requestAnimationFrame(p)}function g(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function p(){t.uniform1f(v.box_size_halved_uniform,l/2),t.uniform1f(v.center_x_uniform,c),t.uniform1f(v.center_y_uniform,s),t.uniform1f(v.brightness_scale_uniform,m),t.uniform1i(v.num_iterations_uniform,h),t.drawArrays(t.TRIANGLE_STRIP,0,4);let e=new Uint8Array(f*f*4);t.readPixels(0,0,f,f,t.RGBA,t.UNSIGNED_BYTE,e);let o=0;for(let t=0;t<f*f;t++){255===e[4*t+1]&&o++}o<.1*f?m-=2:o>.2*f&&(m+=2),n&&(u?(l/=1.02,d++,h=3*d+50):a&&d>1&&(l*=1.02,d--,h=3*d+50),window.requestAnimationFrame(p))}function y(){e=document.querySelector("#output-canvas").offsetWidth}load_script("/scripts/gl-matrix.min.js").then((function(){setTimeout(_,500)}))}();