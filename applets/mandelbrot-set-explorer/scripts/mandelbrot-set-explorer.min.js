!function(){"use strict";let e=null,t=null,o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#high-res-mandelbrot-zoom").offsetWidth,n=100,l=500,u=50,c=100,d=-.75,a=0,s=0,m=0,i=3,g=.6,y=[],b=!1,h=0,p=0,f=[],q=!1;function S(t,o,r,s){f=[];for(let e=0;e<r;e++)f[e]=[];!0===b&&(i/=5,g/=5,c+=150,u+=150,d=h,a=p,b=!1);document.querySelector("#mandelbrot-zoom").setAttribute("width",r),document.querySelector("#mandelbrot-zoom").setAttribute("height",r),e=document.querySelector("#mandelbrot-zoom").getContext("2d");for(let e=0;e<r;e++)v(e,t,o,r,s);let m=f.flat().sort(function(e,t){return e-t}),q=0;if(r===n){y.push(m[Math.round(.999*m.length)-1]),y.length>10&&y.shift(),q=0;for(let e=0;e<y.length;e++)q+=y[e];q/=y.length}else q=m[Math.round(.9999*m.length)-1];for(let e=0;e<r;e++)f[e]=f[e].map(e=>e/q*255);let S=e.getImageData(0,0,r,r),w=S.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=f[e][t],n=4*e*r+4*t;w[n]=0,w[n+1]=o,w[n+2]=o,w[n+3]=255}if(e.putImageData(S,0,0),r===l){let e=document.querySelector("#mandelbrot-set").getAttribute("width");document.querySelector("#mandelbrot-set").getContext("2d").drawImage(document.querySelector("#mandelbrot-zoom"),0,0,e,e),b=!0,h=t,p=o}}function v(e,t,o,r,n){for(let l=0;l<r;l++){let u=(l-r/2)/r*g+t,c=-(e-r/2)/r*g+o,d=u,a=c,s=Math.exp(-Math.sqrt(u*u+c*c)),m=0;for(m=0;m<n;m++){let e=2*u*c+a;if(u=u*u-c*c+d,c=e,s+=Math.exp(-Math.sqrt(u*u+c*c)),u*u+c*c>4)break}m===n&&(s=0),f[e][l]=s}}function w(){let e=document.createElement("a");e.download=m<0?s+" - "+-m+"i.png":s+" + "+m+"i.png",e.href=document.querySelector("#high-res-mandelbrot-zoom").toDataURL(),e.click(),e.remove()}function z(){let o=parseInt(document.querySelector("#dim-input").value||1e3);document.querySelector("#high-res-mandelbrot-zoom").setAttribute("width",o),document.querySelector("#high-res-mandelbrot-zoom").setAttribute("height",o),e=document.querySelector("#high-res-mandelbrot-zoom").getContext("2d"),document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{t.terminate()}catch(e){}t=DEBUG?new Worker("/applets/mandelbrot-set-explorer/scripts/worker.js"):new Worker("/applets/mandelbrot-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(t),t.onmessage=function(t){if("progress"===t.data[0])document.querySelector("#progress-bar span").style.width=t.data[1]+"%",100===t.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let r=e.getImageData(0,0,o,o),n=r.data;for(let e=0;e<o;e++)for(let r=0;r<o;r++){let l=t.data[0][e][r],u=4*e*o+4*r;n[u]=0,n[u+1]=l,n[u+2]=l,n[u+3]=255}e.putImageData(r,0,0),w(),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),t.postMessage([s,m,o,c,g])}function C(){o=document.querySelector("#mandelbrot-zoom").offsetWidth,r=document.querySelector("#high-res-mandelbrot-zoom").offsetWidth}!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(192, 192, 192)",document.querySelector("#high-res-mandelbrot-zoom").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#mandelbrot-zoom").style.borderColor="rgb(64, 64, 64)",document.querySelector("#high-res-mandelbrot-zoom").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to view that area up close, and release to generate a higher-resolution image.")}(),function(){document.querySelector("#mandelbrot-set").setAttribute("width",o),document.querySelector("#mandelbrot-set").setAttribute("height",o);let e=document.querySelector("#mandelbrot-set").getContext("2d"),t=new Image;t.src="/applets/mandelbrot-set-explorer/graphics/mandelbrot-set.png",t.onload=function(){e.drawImage(t,0,0,o,o)}}(),document.querySelector("#generate-button").addEventListener("click",z),document.querySelector("#dim-input").addEventListener("keydown",function(e){13===e.keyCode&&z()}),document.querySelector("#download-button").addEventListener("click",w),window.addEventListener("resize",C),temporary_handlers.resize.push(C),setTimeout(C,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===q){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,l=(t/o-.5)*i+d,c=((o-r)/o-.5)*i+a;S(l,c,n,u)}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,n=(t/o-.5)*i+d,u=((o-r)/o-.5)*i+a;S(n,u,l,c),s=n,m=u,q=!0}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){q=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let l=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,c=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=l,t=c;let s=(l/o-.5)*i+d,m=((o-c)/o-.5)*i+a;S(s,m,n,u)},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(r){r.preventDefault();let n=(e/o-.5)*i+d,u=((o-t)/o-.5)*i+a;S(n,u,l,c),s=n,m=u},!1)}()}();