<div style="height: 5vh"></div>

<noscript>
	<p class="body-text" style="text-align: center">JavaScript is required to use this site and many others. Consider enabling it.</p>
</noscript>



<header>
	<div class="logo" data-aos="fade-in" id="trigger-section-1">
		<a href="/home.html">
			<img src="/graphics/general-icons/logo.png" alt="Logo" onclick="redirect('/home.html')"></img>
		</a>
	</div>

	<div style="height: 2vh"></div>

	<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-1">
		<h1 class="heading-text">Julia Set Explorer</h1>
	</div>
</header>



<div style="height: 5vh"></div>



<main>
	<section>
		<div data-aos="fade-up" data-aos-delay="200">
			<p class="body-text center-if-needed">
				<span id="instructions">Hover over the Mandelbrot set to preview the corresponding Julia set, and click to generate a higher-resolution preview. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</a>.</span>
			</p>
		</div>
		
		<div style="height: 10vh"></div>
		
		
		
		<div id="container" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-1">
			<img id="mandelbrot-set" class="check-webp" src="" alt="The Mandelbrot Set"></img>
			<canvas id="julia-set"></canvas>
		</div>
	</section>
	
	
	
	<div style="height: 15vh"></div>
	
	
	
	<section>
		<div data-aos="fade-up" id="trigger-section-2">
			<h2 class="section-text">Higher Resolution</h2>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-2">
			<p class="body-text">Enter values of \(a\) and \(b\), along with an image size in pixels, to generate a image of the Julia set for \(c = a + bi\). The values are filed in automatically when a high-resolution preview is created above, but custom values can be used. Image sizes larger than 2000 are not recommended.</p>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div style="width: 70vw; margin: 0 auto; display: flex; justify-content: space-between">
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="200" data-aos-anchor="#trigger-section-2">
				<input id="a-input" class="text-box" type="text" style="width: 100%">
				<label for="a-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(a\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-2">
				<input id="b-input" class="text-box" type="text" style="width: 100%">
				<label for="b-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(b\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="400" data-aos-anchor="#trigger-section-2">
				<input id="dim-input" class="text-box" type="text" style="width: 100%">
				<label for="dim-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">Image Size</p>
				</label>
			</div>
		</div>	
		
		<div style="height: 5vh"></div>
		
		<div style="display: flex; justify-content: center; width: 70vw; margin: 0 auto" data-aos="zoom-out" data-aos-delay="1000" data-aos-anchor="#trigger-section-2">
			<button class="text-button" type="button" id="generate-button">Generate</button>
		</div>
		
		<div style="height: 10vh"></div>
		
		<canvas id="high-res-julia-set" data-aos="fade-in" data-aos-delay="1600" data-aos-anchor="#trigger-section-2"></canvas>
		
		<div id="download-location" style="height: 10vh"></div>
	</section>
</main>



<footer>
	<div id="spawn-footer"></div>
</footer>



<script>
	page_settings = 
	{
		"title": "Julia Set Explorer",
		
		"banner_page": false,
		"writing_page": false,
		"math_page": true,
		"comments": false,
		
		"manual_banner": false,
		"manual_dark_theme": false,
		
		"no_footer": false,
		"footer_exclusion": "",
		"footer_from_nonstandard_color": false
	};
	
	on_page_load();
	
	
	
	!function()
	{
		let small_canvas_size = 0;
		let large_canvas_size = 0;
		
		let persist_image = false;
		
		let ctx = null;
		
		
		
		add_style(`
			#container
			{
				display: flex;
				justify-content: space-between;
				width: 70vw;
				margin-left: 15vw;
			}
			
			#mandelbrot-set, #julia-set
			{
				width: 30vw;
				height: 30vw;
			}
			
			#high-res-julia-set
			{
				width: 90vmin;
				height: 90vmin;
				margin-left: calc((100vw - (90vmin + 8px)) / 2);
			}
			
			#mandelbrot-set, #julia-set, #high-res-julia-set
			{
				border: 2px solid rgb(127, 127, 127);
				-webkit-border-radius: 15px;
				border-radius: 15px;
				padding: 2px;
			}
			
			
			
			@media screen and (max-aspect-ratio: 10/16), (max-width: 800px)
			{
				#container
				{
					flex-direction: column;
					margin-left: calc((100vw - (70vw + 8px)) / 2);
				}
				
				#mandelbrot-set, #julia-set
				{
					width: 70vw;
					height: 70vw;
				}
				
				#mandelbrot-set
				{
					margin-bottom: 5vw;
				}
			}
		`, true);
		
		
		
		if (scripts_loaded["mathjs"] == false)
		{
			load_script("https://unpkg.com/mathjs@5.9.0/dist/math.min.js")
			
			.then(function()
			{
				scripts_loaded["mathjs"] == true;
			})
			
			.catch(function(error)
			{
				console.error("Could not load MathJS");
			});
		}
		
		
		
		if (url_vars["contrast"] == 1)
		{
			if (url_vars["theme"] == 1)
			{
				document.querySelector("#mandelbrot-set").style.borderColor = "rgb(192, 192, 192)";
				document.querySelector("#julia-set").style.borderColor = "rgb(192, 192, 192)";
				document.querySelector("#high-res-julia-set").style.borderColor = "rgb(192, 192, 192)";
			}
			
			else
			{
				document.querySelector("#mandelbrot-set").style.borderColor = "rgb(64, 64, 64)";
				document.querySelector("#julia-set").style.borderColor = "rgb(64, 64, 64)";
				document.querySelector("#high-res-julia-set").style.borderColor = "rgb(64, 64, 64)";
			}
		}
		
		
		
		document.querySelector("#generate-button").addEventListener("click", draw_high_res_julia);
		
		
		
		//Only get the width of the Mandelbrot set has finished loading in order to get the correct value.
		small_canvas_size = document.querySelector("#julia-set").offsetWidth;
		large_canvas_size = document.querySelector("#high-res-julia-set").offsetWidth;
		
		
		
		//As the user scrolls around the image, make tiny Julia set previews.
		if (!hasTouch())
		{
			document.querySelector("#mandelbrot-set").addEventListener("mousemove", function(e)
			{
				if (persist_image == false)
				{
					let mouse_x = e.pageX - document.querySelector("#mandelbrot-set").offsetLeft;
					let mouse_y = e.pageY - document.querySelector("#mandelbrot-set").offsetTop;
					
					let a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
					let b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
					
					draw_julia_set(a, b, 100, 25, false);
				}
			});
			
			//On a click, make a much larger image.
			document.querySelector("#mandelbrot-set").addEventListener("click", function(e)
			{
				let mouse_x = e.pageX - document.querySelector("#mandelbrot-set").offsetLeft;
				let mouse_y = e.pageY - document.querySelector("#mandelbrot-set").offsetTop;
				
				let a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
				let b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
				
				draw_julia_set(a, b, 500, 100, false);
				
				document.querySelector("#a-input").value = Math.round(1000000 * a) / 1000000;
				document.querySelector("#b-input").value = Math.round(1000000 * b) / 1000000;
				document.querySelector("#dim-input").value = 1000;
				
				persist_image = true;
			});
			
			document.querySelector("#mandelbrot-set").addEventListener("mouseleave", function(e)
			{
				persist_image = false;
			});
		}
		
		
		
		//Handle touchscreens.
		else
		{
			document.querySelector("#instructions").innerHTML = `Drag along the Mandelbrot set to preview the corresponding Julia set, and release to generate a higher-resolution image. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</a>.`;
			
			document.querySelector("#mandelbrot-set").addEventListener("touchmove", function(e)
			{
				e.preventDefault();
					
				let mouse_x = e.pageX - document.querySelector("#mandelbrot-set").offsetLeft;
				let mouse_y = e.pageY - document.querySelector("#mandelbrot-set").offsetTop;
				
				let a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
				let b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
				
				draw_julia_set(a, b, 100, 25, false);
			}, false);
			
			document.querySelector("#mandelbrot-set").addEventListener("touchend", function(e)
			{
				e.preventDefault();
				
				let mouse_x = e.pageX - document.querySelector("#mandelbrot-set").offsetLeft;
				let mouse_y = e.pageY - document.querySelector("#mandelbrot-set").offsetTop;
				
				let a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
				let b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
				
				draw_julia_set(a, b, 500, 100, false);
				
				document.querySelector("#a-input").value = Math.round(1000000 * a) / 1000000;
				document.querySelector("#b-input").value = Math.round(1000000 * b) / 1000000;
				document.querySelector("#dim-input").value = 1000;
			}, false);
		}
		
		
		
		function draw_high_res_julia()
		{
			let a = parseFloat(document.querySelector("#a-input").value) || 0;
			let b = parseFloat(document.querySelector("#b-input").value) || 0;
			let dim = parseFloat(document.querySelector("#dim-input").value) || 1000;
			
			draw_julia_set(a, b, dim, 100, true);
		}
		
		
		
		function draw_julia_set(a, b, julia_size, num_iters, download)
		{
			let x = 0, y = 0;
			let z = 0, c = math.complex(a, b);
			
			let brightness, max_brightness = 0;
			let image = [];
			
			for (let i = 0; i < julia_size; i++)
			{
				image[i] = [];
			}
			
			
			
			let ctx = null;
			let canvas_size = 0;
			
			if (download == false)
			{
				document.querySelector("#julia-set").setAttribute("width", julia_size);
				document.querySelector("#julia-set").setAttribute("height", julia_size);
				
				ctx = document.querySelector("#julia-set").getContext("2d");
				canvas_size = small_canvas_size;
			}
			
			else
			{
				document.querySelector("#high-res-julia-set").setAttribute("width", julia_size);
				document.querySelector("#high-res-julia-set").setAttribute("height", julia_size);
				
				ctx = document.querySelector("#high-res-julia-set").getContext("2d");
				canvas_size = large_canvas_size;
			}
			
			
			
			//Generate initial value map.
			for (let i = 0; i < julia_size / 2; i++)
			{
				for (let j = 0; j < julia_size; j++)
				{
					x = ((j - julia_size/2) / julia_size) * 4;
					y = (-(i - julia_size/2) / julia_size) * 4;
					
					z = math.complex(x, y);
					
					brightness = math.exp(-math.abs(z));
					
					for (var k = 0; k < num_iters; k++)
					{
						z = math.add(math.multiply(z, z), c);
						
						brightness += math.exp(-math.abs(z));
						
						if (math.abs(z) > 2)
						{
							break;
						}
					}
					
					if (k == num_iters)
					{
						brightness = 0;
					}
					
					
					
					//Reflect the top half about the origin to get the bottom half.
					image[i][j] = brightness;
					image[julia_size - i - 1][julia_size - j - 1] = brightness;
				}
			}
			
			
			
			//Find the max brightness, throwing out the very top values to avoid almost-black images with a few specks of color.
			let brightness_array = image.flat().sort(function(a, b) {return a - b});
			
			//We throw out more if the image is just being scrolled around, since then it's critical that we don't have bright flashes of color.
			if (julia_size == 100)
			{
				max_brightness = brightness_array[Math.round(brightness_array.length * .9965)];
			}
			
			else
			{
				max_brightness = brightness_array[Math.round(brightness_array.length * .9999)];
			}
			
			for (let i = 0; i < julia_size; i++)
			{
				for (let j = 0; j < julia_size; j++)
				{
					image[i][j] = (image[i][j] / max_brightness) * 255;
					ctx.fillStyle = "rgb(" + 0 + "," + image[i][j] + "," + image[i][j] + ")";
					ctx.fillRect(j, i, 1, 1);
				}
			}
			
			ctx.scale(canvas_size / julia_size, canvas_size / julia_size);
			
			
			
			if (download)
			{
				try {document.querySelector("#download-button").style.opacity = 0;}
				catch(ex) {}
				
				setTimeout(function()
				{
					try {document.querySelector("#download-button").remove();}
					catch(ex) {}
					
					let image_data = document.querySelector("#high-res-julia-set").toDataURL();
					let filename = c.format({precision: 6});
					
					document.querySelector("#download-location").insertAdjacentHTML("afterend", `
						<div id="download-button" class="animated-opacity" style="display: flex; justify-content: center; opacity: 0; width: 70vw; margin: 0 auto">
							<a href="${image_data}" download="${filename}.png" class="real-link">
								<button class="text-button" type="button" onclick="">Download Image</button>
							</a>
						</div>
					`);
					
					document.querySelector("#download-button").style.opacity = 1;
				}, 300);
			}
		}
	}()
</script>