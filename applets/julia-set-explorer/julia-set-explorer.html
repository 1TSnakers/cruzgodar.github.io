<!DOCTYPE html>
<html lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135923635-1"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	
	gtag('config', 'UA-135923635-1');
</script>

<script src="/scripts/settings-head.js"></script>

<title>Julia Set Explorer</title>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest?v=NmPPnmeW24">
<link rel="mask-icon" href="/safari-pinned-tab.svg?v=NmPPnmeW24" color="#5bbad5">
<link rel="shortcut icon" href="/favicon.ico?v=NmPPnmeW24">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png?v=NmPPnmeW24">

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<link rel="stylesheet" type="text/css" href="/style/aos.css">

<link rel="stylesheet" type="text/css" href="/style/base-style.css">

<!-- MathJax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

<style>

.row:after
{
	content: "";
	display: table;
	clear: both;
}

#mandelbrot-set, #julia-set
{
	width: 30vw;
	height: 30vw;
}

#mandelbrot-set
{
	margin-left: 15vw;
}

#julia-set
{
	margin-left: 10vw;
}

#high-res-julia-set
{
	width: 90vmin;
	height: 90vmin;
	margin-left: calc((100vw - 90vmin) / 2);
}



@media screen and (max-aspect-ratio: 10/16), (max-width: 800px)
{	
	#mandelbrot-set, #julia-set
	{
		width: 50vw;
		height: 50vw;
		margin-left: 25vw;
	}
	
	#mandelbrot-set
	{
		margin-bottom: 5vw;
	}
}
</style>

</head>



<body>
	<div style="height: 5vh"></div>
	
	<noscript>
		<div class="body-text" style="text-align: center">JavaScript is required to use this site and many others. Consider enabling it.</div>
	</noscript>

	<div class="logo" data-aos="fade-in" id="trigger-section-1">
		<img class="link" onclick="redirect('/index.html')" src="/graphics/general-icons/logo.png" alt="Logo"></img>
	</div>

	<div style="height: 2vh"></div>

	<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-1">
		<div class="heading-text">Julia Set Explorer</div>
	</div>
	
	<div style="height: 5vh"></div>
	
	<div data-aos="fade-up" data-aos-delay="200">
		<div id="instructions" class="body-text">Hover over the Mandelbrot set to preview the corresponding Julia set. Click to generate a higher-resolution preview. For more information on Mandelbrot and Julia sets, have a look at <span class="link" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</span>.</div>
	</div>
	
	<div style="height: 10vh"></div>
	
	
	
	<div id="container" class="row" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-1">
		<img id="mandelbrot-set" class="check-webp" src="" alt="The Mandelbrot Set"></img>
		<canvas id="julia-set"></canvas>
	</div>
	
	<div style="height: 15vh"></div>
	
	
	
	<div data-aos="fade-up" id="trigger-section-2">
		<div class="section-text">Higher Resolution</div>
	</div>
	
	<div style="height: 5vh"></div>
	
	<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-2">
		<div class="body-text">Enter values of \(a\) and \(b\), along with an image size in pixels, to generate a image of the Julia set for \(c = a + bi\). The values are filed in automatically when a high-resolution preview is created above, but custom values can be used. Image sizes larger than 2000 are not recommended.</div>
	</div>
	
	<div style="height: 5vh"></div>
	
	<div style="width: 70vw; margin: 0 auto; display: flex; justify-content: space-between">
		<div style="width: 20vw" data-aos="fade-up" data-aos-delay="200" data-aos-anchor="#trigger-section-2">
			<input id="a-input" class="text-box" type="text" style="width: 100%">
			<div class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(a\)</div>
		</div>
		
		<div style="width: 20vw" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-2">
			<input id="b-input" class="text-box" type="text" style="width: 100%">
			<div class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(b\)</div>
		</div>
		
		<div style="width: 20vw" data-aos="fade-up" data-aos-delay="400" data-aos-anchor="#trigger-section-2">
			<input id="dim-input" class="text-box" type="text" style="width: 100%">
			<div class="body-text" style="width: 100%; margin-left: 0px; text-align: center">Image Size</div>
		</div>
	</div>	
	
	<div style="height: 5vh"></div>
	
	<div style="display: flex; justify-content: center; width: 70vw; margin: 0 auto" data-aos="zoom-out" data-aos-delay="1000" data-aos-anchor="#trigger-section-2">
		<div class="text-button" onclick="draw_high_res_julia()">Generate</div>
	</div>
	
	<div style="height: 10vh"></div>
	
	<canvas id="high-res-julia-set"></canvas>
	
	<div id="download-location" style="height: 10vh"></div>
	
	
	
	<div id="spawn-footer"></div>
	
	

	<!-- jQuery -->
	<script src="/scripts/jquery.js"></script>
	
	<!-- Animate on scroll library -->
	<script src="/scripts/aos.js"></script>
	
	<!-- Mathjs library -->
	<script src="https://unpkg.com/mathjs@5.9.0/dist/math.min.js"></script>
	
	<script src="/scripts/base-script.js"></script>
	
	<script>
		var small_canvas_size;
		var large_canvas_size;
		
		var persist_image = false;
		
		var ctx;
		
		$(function()
		{
			var refresh_id_1 = setInterval(function()
			{
				if (typeof insert_footer != "undefined" && $.isFunction(insert_footer))
				{
					insert_footer("applets");
					clearInterval(refresh_id_1);
				}
			}, 50);
			
			
			
			//Only get the width of the Mandelbrot set has finished loading in order to get the correct value
			var refresh_id_2 = setInterval(function()
			{
				if (supports_webp != null)
				{
					clearInterval(refresh_id_2);
					
					small_canvas_size = $("#mandelbrot-set").width();
					large_canvas_size = $("#high-res-julia-set").width();
				}
			}, 50);
			
			
			
			//As the user scrolls around the image, make tiny Julia set previews.
			var refresh_id_3 = setInterval(function()
			{
				if (typeof hasTouch != "undefined" && $.isFunction(hasTouch))
				{
					clearInterval(refresh_id_3);
					
					if (!hasTouch())
					{
						$("#mandelbrot-set").mousemove(function(e)
						{
							var parentOffset = $(this).offset();
							var mouse_x = e.pageX - parentOffset.left;
							var mouse_y = e.pageY - parentOffset.top;
							
							if (persist_image == false)
							{
								var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
								var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
								
								draw_julia_set(a, b, 100, 25, false);
							}
						});
						
						//On a click, make a much larger image.
						$("#mandelbrot-set").click(function(e)
						{
							var parentOffset = $("#mandelbrot-set").offset();
							var mouse_x = e.pageX - parentOffset.left;
							var mouse_y = e.pageY - parentOffset.top;
							
							var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
							var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
							
							draw_julia_set(a, b, 500, 100, false);
							
							$("#a-input").val(Math.round(1000000 * a) / 1000000);
							$("#b-input").val(Math.round(1000000 * b) / 1000000);
							$("#dim-input").val(1000);
							
							persist_image = true;
						});
						
						$("#mandelbrot-set").mouseleave(function(e)
						{
							persist_image = false;
						});
					}
					
					//Handle touchscreens.
					else
					{
						$("#instructions").html('Drag along the Mandelbrot set to preview the corresponding Julia set. Release to generate a higher-resolution image. For more information on Mandelbrot and Julia sets, have a look at <span class="link" onclick="redirect(\'/blog/4/a-taste-of-chaos.html\')">this blog post</span>.');
						
						document.getElementById("mandelbrot-set").addEventListener("touchmove", function(e)
						{
							e.preventDefault();
							
							var parentOffset = $("#mandelbrot-set").offset();
							var mouse_x = e.pageX - parentOffset.left;
							var mouse_y = e.pageY - parentOffset.top;
							
							var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
							var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
							
							draw_julia_set(a, b, 100, 25, false);
						}, false);
						
						document.getElementById("mandelbrot-set").addEventListener("touchend", function(e)
						{
							e.preventDefault();
							
							var parentOffset = $("#mandelbrot-set").offset();
							var mouse_x = e.pageX - parentOffset.left;
							var mouse_y = e.pageY - parentOffset.top;
							
							var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
							var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
							
							draw_julia_set(a, b, 500, 100, false);
							
							$("#a-input").val(Math.round(1000000 * a) / 1000000);
							$("#b-input").val(Math.round(1000000 * b) / 1000000);
							$("#dim-input").val(1000);
						}, false);
					}
				}
			}, 50);
		});
		
		
		
		function draw_high_res_julia()
		{
			var a = parseFloat($("#a-input").val()) || 0;
			var b = parseFloat($("#b-input").val()) || 0;
			var dim = parseFloat($("#dim-input").val()) || 1000;
			
			draw_julia_set(a, b, dim, 100, true);
		}
		
		
		
		function draw_julia_set(a, b, julia_size, num_iters, download)
		{
			var i, j, k;
			
			var x, y;
			var z, c;
			
			var brightness, max_brightness = 0;
			var image = [];
			
			for (i = 0; i < julia_size; i++)
			{
				image[i] = [];
			}
			
			c = math.complex(a, b);
			
			
			
			var ctx;
			var canvas_size;
			
			if (download == false)
			{
				$("#julia-set").attr({width: julia_size, height: julia_size});
				ctx = document.getElementById("julia-set").getContext("2d");
				canvas_size = small_canvas_size;
			}
			
			else
			{
				$("#high-res-julia-set").attr({width: julia_size, height: julia_size});
				ctx = document.getElementById("high-res-julia-set").getContext("2d");
				canvas_size = large_canvas_size;
			}
			
			
			
			//Generate initial value map.
			for (i = 0; i < julia_size / 2; i++)
			{
				for (j = 0; j < julia_size; j++)
				{
					x = ((j - julia_size/2) / julia_size) * 4;
					y = (-(i - julia_size/2) / julia_size) * 4;
					
					z = math.complex(x, y);
					
					brightness = math.exp(-math.abs(z));
					
					for (k = 0; k < num_iters; k++)
					{
						z = math.add(math.multiply(z, z), c);
						
						brightness += math.exp(-math.abs(z));
						
						if (math.abs(z) > 2)
						{
							break;
						}
					}
					
					if (k == num_iters)
					{
						brightness = 0;
					}
					
					
					
					//Reflect the top half about the origin to get the bottom half.
					image[i][j] = brightness;
					image[julia_size - i - 1][julia_size - j - 1] = brightness;
				}
			}
			
			
			
			//Find the max brightness, throwing out the top 1% of values to avoid almost-black images with a few specks of color.
			var brightness_array = image.flat().sort(function(a, b) {return a - b});
			max_brightness = brightness_array[Math.round(brightness_array.length * .9999)];
			
			for (i = 0; i < julia_size; i++)
			{
				for (j = 0; j < julia_size; j++)
				{
					image[i][j] = (image[i][j] / max_brightness) * 255;
					ctx.fillStyle = "rgb(" + 0 + "," + image[i][j] + "," + image[i][j] + ")";
					ctx.fillRect(j, i, 1, 1);
				}
			}
			
			ctx.scale(canvas_size / julia_size, canvas_size / julia_size);
			
			
			
			if (download == true)
			{
				$("#download-button").animate({opacity: 0}, 300, "swing");
				
				setTimeout(function()
				{
					$("#download-button").remove();
					
					$("#download-location").after(`
						<div id="download-button" style="display: flex; justify-content: center; opacity: 0; width: 70vw; margin: 0 auto">
							<a href=${document.getElementById("high-res-julia-set").toDataURL()} download="${c.format({precision: 6})}.png">
								<div class="text-button">Download Image</div>
							</a>
						</div>
					`);
					
					$("#download-button").animate({opacity: 1}, 300, "swing");
				}, 300);
			}
		}
	</script>

</body>
</html>