<div style="height: 5vh"></div>

<noscript>
	<p class="body-text" style="text-align: center">JavaScript is required to use this site and many others. Consider enabling it.</p>
</noscript>



<header>
	<div class="logo" data-aos="fade-in" id="trigger-section-1">
		<a href="/index.html">
			<img src="/graphics/general-icons/logo.png" alt="Logo" onclick="redirect('/index.html')"></img>
		</a>
	</div>

	<div style="height: 2vh"></div>

	<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-1">
		<h1 class="heading-text">Julia Set Explorer</h1>
	</div>
</header>



<div style="height: 5vh"></div>



<main>
	<section>
		<div data-aos="fade-up" data-aos-delay="200">
			<p id="instructions" class="body-text">Hover over the Mandelbrot set to preview the corresponding Julia set. Click to generate a higher-resolution preview. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</a>.</p>
		</div>
		
		<div style="height: 10vh"></div>
		
		
		
		<div id="container" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-1">
			<img id="mandelbrot-set" class="check-webp" src="" alt="The Mandelbrot Set"></img>
			<canvas id="julia-set"></canvas>
		</div>
	</section>
	
	
	
	<div style="height: 15vh"></div>
	
	
	
	<section>
		<div data-aos="fade-up" id="trigger-section-2">
			<h2 class="section-text">Higher Resolution</h2>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div data-aos="fade-up" data-aos-delay="100" data-aos-anchor="#trigger-section-2">
			<p class="body-text">Enter values of \(a\) and \(b\), along with an image size in pixels, to generate a image of the Julia set for \(c = a + bi\). The values are filed in automatically when a high-resolution preview is created above, but custom values can be used. Image sizes larger than 2000 are not recommended.</p>
		</div>
		
		<div style="height: 5vh"></div>
		
		<div style="width: 70vw; margin: 0 auto; display: flex; justify-content: space-between">
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="200" data-aos-anchor="#trigger-section-2">
				<input id="a-input" class="text-box" type="text" style="width: 100%">
				<label for="a-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(a\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="300" data-aos-anchor="#trigger-section-2">
				<input id="b-input" class="text-box" type="text" style="width: 100%">
				<label for="b-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">\(b\)</p>
				</label>
			</div>
			
			<div style="width: 20vw" data-aos="fade-up" data-aos-delay="400" data-aos-anchor="#trigger-section-2">
				<input id="dim-input" class="text-box" type="text" style="width: 100%">
				<label for="dim-input">
					<p class="body-text" style="width: 100%; margin-left: 0px; text-align: center">Image Size</p>
				</label>
			</div>
		</div>	
		
		<div style="height: 5vh"></div>
		
		<div style="display: flex; justify-content: center; width: 70vw; margin: 0 auto" data-aos="zoom-out" data-aos-delay="1000" data-aos-anchor="#trigger-section-2">
			<button class="text-button" type="button" onclick="draw_high_res_julia()">Generate</button>
		</div>
		
		<div style="height: 10vh"></div>
		
		<canvas id="high-res-julia-set" data-aos="fade-in" data-aos-delay="1600" data-aos-anchor="#trigger-section-2"></canvas>
		
		<div id="download-location" style="height: 10vh"></div>
	</section>
</main>



<footer>
	<div id="spawn-footer"></div>
</footer>



<script>
	page_settings = 
	{
		"title": "Julia Set Explorer",
		
		"banner_page": false,
		"writing_page": false,
		
		"manual_banner": false,
		"manual_dark_theme": false,
		
		"no_footer": false,
		"footer_exclusion": "",
		"footer_from_nonstandard_color": false
	};
	
	page_settings_done = true;
	
	
	
	var small_canvas_size;
	var large_canvas_size;
	
	var persist_image = false;
	
	var ctx;
	
	$(function()
	{
		$("head").append(`
			<style>
				#container
				{
					display: flex;
					justify-content: space-between;
					width: 70vw;
					margin-left: 15vw;
				}
				
				#mandelbrot-set, #julia-set
				{
					width: 30vw;
					height: 30vw;
				}
				
				#high-res-julia-set
				{
					width: 90vmin;
					height: 90vmin;
					margin-left: calc((100vw - (90vmin + 8px)) / 2);
				}
				
				#mandelbrot-set, #julia-set, #high-res-julia-set
				{
					border: 2px solid rgb(127, 127, 127);
					-webkit-border-radius: 15px;
					border-radius: 15px;
					padding: 2px;
				}
				
				@media screen and (max-aspect-ratio: 10/16), (max-width: 800px)
				{
					#container
					{
						flex-direction: column;
						margin-left: calc((100vw - (70vw + 8px)) / 2);
					}
					
					#mandelbrot-set, #julia-set
					{
						width: 70vw;
						height: 70vw;
					}
					
					#mandelbrot-set
					{
						margin-bottom: 5vw;
					}
				}
			</style>
		`);
		
		
		
		$.getScript("https://unpkg.com/mathjs@5.9.0/dist/math.min.js");
		
		$.getScript("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML");
		
		
		
		if (url_vars["contrast"] == 1)
		{
			if (url_vars["theme"] == 1)
			{
				$("#mandelbrot-set, #julia-set, #high-res-julia-set").css("border-color", "rgb(192, 192, 192)");
			}
			
			else
			{
				$("#mandelbrot-set, #julia-set, #high-res-julia-set").css("border-color", "rgb(64, 64, 64)");
			}
		}
		
		
		
		//Only get the width of the Mandelbrot set has finished loading in order to get the correct value
		var refresh_id_1 = setInterval(function()
		{
			if (supports_webp != null)
			{
				clearInterval(refresh_id_1);
				
				small_canvas_size = $("#julia-set").width();
				large_canvas_size = $("#high-res-julia-set").width();
			}
		}, 50);
		
		
		
		//As the user scrolls around the image, make tiny Julia set previews.
		var refresh_id_2 = setInterval(function()
		{
			if (typeof hasTouch != "undefined" && $.isFunction(hasTouch))
			{
				clearInterval(refresh_id_2);
				
				if (!hasTouch())
				{
					$("#mandelbrot-set").mousemove(function(e)
					{
						var parentOffset = $(this).offset();
						var mouse_x = e.pageX - parentOffset.left;
						var mouse_y = e.pageY - parentOffset.top;
						
						if (persist_image == false)
						{
							var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
							var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
							
							draw_julia_set(a, b, 100, 25, false);
						}
					});
					
					//On a click, make a much larger image.
					$("#mandelbrot-set").click(function(e)
					{
						var parentOffset = $("#mandelbrot-set").offset();
						var mouse_x = e.pageX - parentOffset.left;
						var mouse_y = e.pageY - parentOffset.top;
						
						var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
						var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
						
						draw_julia_set(a, b, 500, 100, false);
						
						$("#a-input").val(Math.round(1000000 * a) / 1000000);
						$("#b-input").val(Math.round(1000000 * b) / 1000000);
						$("#dim-input").val(1000);
						
						persist_image = true;
					});
					
					$("#mandelbrot-set").mouseleave(function(e)
					{
						persist_image = false;
					});
				}
				
				//Handle touchscreens.
				else
				{
					$("#instructions").html(`Drag along the Mandelbrot set to preview the corresponding Julia set. Release to generate a higher-resolution image. For more information on Mandelbrot and Julia sets, have a look at <a href="/blog/4/a-taste-of-chaos.html" onclick="redirect('/blog/4/a-taste-of-chaos.html')">this blog post</span>.`);
					
					document.getElementById("mandelbrot-set").addEventListener("touchmove", function(e)
					{
						e.preventDefault();
						
						var parentOffset = $("#mandelbrot-set").offset();
						var mouse_x = e.pageX - parentOffset.left;
						var mouse_y = e.pageY - parentOffset.top;
						
						var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
						var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
						
						draw_julia_set(a, b, 100, 25, false);
					}, false);
					
					document.getElementById("mandelbrot-set").addEventListener("touchend", function(e)
					{
						e.preventDefault();
						
						var parentOffset = $("#mandelbrot-set").offset();
						var mouse_x = e.pageX - parentOffset.left;
						var mouse_y = e.pageY - parentOffset.top;
						
						var a = ((mouse_x / small_canvas_size) - .5) * 3 - .75;
						var b = (((small_canvas_size - mouse_y) / small_canvas_size) - .5) * 3;
						
						draw_julia_set(a, b, 500, 100, false);
						
						$("#a-input").val(Math.round(1000000 * a) / 1000000);
						$("#b-input").val(Math.round(1000000 * b) / 1000000);
						$("#dim-input").val(1000);
					}, false);
				}
			}
		}, 50);
	});
	
	
	
	function draw_high_res_julia()
	{
		var a = parseFloat($("#a-input").val()) || 0;
		var b = parseFloat($("#b-input").val()) || 0;
		var dim = parseFloat($("#dim-input").val()) || 1000;
		
		draw_julia_set(a, b, dim, 100, true);
	}
	
	
	
	function draw_julia_set(a, b, julia_size, num_iters, download)
	{
		var i, j, k;
		
		var x, y;
		var z, c;
		
		var brightness, max_brightness = 0;
		var image = [];
		
		for (i = 0; i < julia_size; i++)
		{
			image[i] = [];
		}
		
		c = math.complex(a, b);
		
		
		
		var ctx;
		var canvas_size;
		
		if (download == false)
		{
			$("#julia-set").attr({width: julia_size, height: julia_size});
			ctx = document.getElementById("julia-set").getContext("2d");
			canvas_size = small_canvas_size;
		}
		
		else
		{
			$("#high-res-julia-set").attr({width: julia_size, height: julia_size});
			ctx = document.getElementById("high-res-julia-set").getContext("2d");
			canvas_size = large_canvas_size;
		}
		
		
		
		//Generate initial value map.
		for (i = 0; i < julia_size / 2; i++)
		{
			for (j = 0; j < julia_size; j++)
			{
				x = ((j - julia_size/2) / julia_size) * 4;
				y = (-(i - julia_size/2) / julia_size) * 4;
				
				z = math.complex(x, y);
				
				brightness = math.exp(-math.abs(z));
				
				for (k = 0; k < num_iters; k++)
				{
					z = math.add(math.multiply(z, z), c);
					
					brightness += math.exp(-math.abs(z));
					
					if (math.abs(z) > 2)
					{
						break;
					}
				}
				
				if (k == num_iters)
				{
					brightness = 0;
				}
				
				
				
				//Reflect the top half about the origin to get the bottom half.
				image[i][j] = brightness;
				image[julia_size - i - 1][julia_size - j - 1] = brightness;
			}
		}
		
		
		
		//Find the max brightness, throwing out the top 1% of values to avoid almost-black images with a few specks of color.
		var brightness_array = image.flat().sort(function(a, b) {return a - b});
		
		//We throw out more if the image is just being scrolled around, since then it's critical that we don't have bright flashes of color.
		if (julia_size == 100)
		{
			max_brightness = brightness_array[Math.round(brightness_array.length * .9965)];
		}
		
		else
		{
			max_brightness = brightness_array[Math.round(brightness_array.length * .9999)];
		}
		
		for (i = 0; i < julia_size; i++)
		{
			for (j = 0; j < julia_size; j++)
			{
				image[i][j] = (image[i][j] / max_brightness) * 255;
				ctx.fillStyle = "rgb(" + 0 + "," + image[i][j] + "," + image[i][j] + ")";
				ctx.fillRect(j, i, 1, 1);
			}
		}
		
		ctx.scale(canvas_size / julia_size, canvas_size / julia_size);
		
		
		
		if (download)
		{
			$("#download-button").animate({opacity: 0}, 300, "swing");
			
			setTimeout(function()
			{
				$("#download-button").remove();
				
				var image_data = document.getElementById("high-res-julia-set").toDataURL();
				var filename = c.format({precision: 6});
				
				$("#download-location").after(`
					<div id="download-button" style="display: flex; justify-content: center; opacity: 0; width: 70vw; margin: 0 auto">
						<a href="${image_data}" download="${filename}.png" class="real-link">
							<button class="text-button" type="button" onclick="">Download Image</button>
						</a>
					</div>
				`);
				
				$("#download-button").animate({opacity: 1}, 300, "swing");
			}, 300);
		}
	}
</script>