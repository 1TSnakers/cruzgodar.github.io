!function(){"use strict";let t="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform int julia_mode;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float world_center_x;\n\t\tuniform float world_center_y;\n\t\tuniform float world_size;\n\t\t\n\t\tuniform float a;\n\t\tuniform float b;\n\t\tuniform int num_iterations;\n\t\tuniform float brightness_scale;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z;\n\t\t\t\n\t\t\tif (aspect_ratio >= 1.0)\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * aspect_ratio * world_size + world_center_x, uv.y * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tz = vec2(uv.x * world_size + world_center_x, uv.y / aspect_ratio * world_size + world_center_y);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tif (julia_mode == 0)\n\t\t\t{\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\telse if (julia_mode == 1)\n\t\t\t{\n\t\t\t\tvec2 c = vec2(a, b);\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tbool broken = false;\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (!broken)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(.5 * brightness / brightness_scale * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tz = vec2(uv.x * aspect_ratio * 2.0, uv.y * 2.0);\n\t\t\t\tcolor = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\tbrightness = exp(-length(z));\n\t\t\t\t\n\t\t\t\tbroken = false;\n\t\t\t\t\n\t\t\t\tc = vec2(a, b);\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor.xyz /= 4.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!broken)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor += vec4(brightness / brightness_scale * color, 0.0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t",n={renderer:"gpu",shader:t,canvas_width:1e3,canvas_height:1e3,world_width:4,world_height:4,world_center_x:-.75,world_center_y:0,use_fullscreen:!0,true_fullscreen:!0,use_fullscreen_button:!0,enter_fullscreen_button_icon_path:"/graphics/general-icons/enter-fullscreen.png",exit_fullscreen_button_icon_path:"/graphics/general-icons/exit-fullscreen.png",switch_fullscreen_callback:H,mousedown_callback:C,touchstart_callback:C,mousemove_callback:function(t,n,e,r,o){2===i&&"mousemove"===o.type&&(s=t,d=n,window.requestAnimationFrame(W))},mousedrag_callback:j,touchmove_callback:j,mouseup_callback:E,touchend_callback:E,wheel_callback:function(t,n,e,r){u=t,m=n,Math.abs(e/100)<.3?(_+=e/100,_=Math.min(_,1)):y+=.05*Math.sign(e);L()},pinch_callback:function(t,n,e,o){if(2===i)return;a>=1?(_-=e/r.world_width*10,z=-e/r.world_width*10):(_-=e/r.world_height*10,z=-e/r.world_height*10);_=Math.min(_,1),u=t,m=n,L()}},e={renderer:"gpu",shader:t,canvas_width:100,canvas_height:100},r=new Wilson(Page.element.querySelector("#output-canvas"),n);r.render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","brightness_scale"]);let o=new Wilson(Page.element.querySelector("#hidden-canvas"),e);o.render.init_uniforms(["julia_mode","aspect_ratio","world_center_x","world_center_y","world_size","a","b","num_iterations","brightness_scale"]);let i=0,a=1,l=100,_=0,c=[],s=0,d=1,h=1e3,w=100,u=0,m=0,f=0,g=0,z=0,p=0,b=0,y=0;const x=.96,v=.0025,M=25e-5,k=.93,F=.01,q=.001;let A=-1,P=Page.element.querySelector("#resolution-input");P.addEventListener("input",()=>{h=parseInt(P.value||1e3),r.change_canvas_size(h,h)}),Page.element.querySelector("#download-button").addEventListener("click",()=>{r.download_frame("a-julia-set.png")});let S=Page.element.querySelector("#switch-julia-mode-button");function C(t,n,e){p=0,b=0,y=0,f=0,g=0,z=0,2===i&&"mousedown"===e.type&&(i=1,r.world_center_x=0,r.world_center_y=0,r.world_width=4,r.world_height=4,_=0,c=[],Page.Animate.change_opacity(S,1,Site.opacity_animation_time),window.requestAnimationFrame(W))}function j(t,n,e,o,a){2===i&&"touchmove"===a.type?(s=t,d=n):(r.world_center_x-=e,r.world_center_y-=o,f=-e/r.world_width,g=-o/r.world_height,r.world_center_x=Math.min(Math.max(r.world_center_x,-2),2),r.world_center_y=Math.min(Math.max(r.world_center_y,-2),2)),window.requestAnimationFrame(W)}function E(t,n,e){2===i&&"touchend"===e.type?(i=1,r.world_center_x=0,r.world_center_y=0,r.world_width=4,r.world_height=4,_=0,c=[],Page.Animate.change_opacity(S,1,Site.opacity_animation_time),window.requestAnimationFrame(W)):(Math.sqrt(f*f+g*g)>=v&&(p=f,b=g),Math.abs(z)>=F&&(y=z)),window.requestAnimationFrame(W)}function L(){if(a>=1){let t=r.input.get_zoomed_world_center(u,m,4*Math.pow(2,_)*a,4*Math.pow(2,_));r.world_width=4*Math.pow(2,_)*a,r.world_height=4*Math.pow(2,_),r.world_center_x=t[0],r.world_center_y=t[1]}else{let t=r.input.get_zoomed_world_center(u,m,4*Math.pow(2,_),4*Math.pow(2,_)/a);r.world_width=4*Math.pow(2,_),r.world_height=4*Math.pow(2,_)/a,r.world_center_x=t[0],r.world_center_y=t[1]}l=30*-_+200,window.requestAnimationFrame(W)}function W(t){let n=t-A;if(A=t,0===n)return;o.gl.uniform1i(o.uniforms.julia_mode,i),o.gl.uniform1f(o.uniforms.world_center_x,r.world_center_x),o.gl.uniform1f(o.uniforms.world_center_y,r.world_center_y),o.gl.uniform1f(o.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),o.gl.uniform1i(o.uniforms.num_iterations,l),o.gl.uniform1f(o.uniforms.a,s),o.gl.uniform1f(o.uniforms.b,d),o.gl.uniform1f(o.uniforms.brightness_scale,20*(Math.abs(_)+1)),o.render.draw_frame();let e=o.render.get_pixel_data(),h=new Array(w*w);for(let t=0;t<w*w;t++)h[t]=e[4*t]+e[4*t+1]+e[4*t+2];h.sort((t,n)=>t-n);let u=(h[Math.floor(w*w*.96)]+h[Math.floor(w*w*.98)])/255*15*(Math.abs(_/2)+1);c.push(u);let m=c.length;m>10&&c.shift(),u=Math.max(c.reduce((t,n)=>t+n)/m,.5),r.gl.uniform1i(r.uniforms.julia_mode,i),r.gl.uniform1f(r.uniforms.aspect_ratio,a),r.gl.uniform1f(r.uniforms.world_center_x,r.world_center_x),r.gl.uniform1f(r.uniforms.world_center_y,r.world_center_y),r.gl.uniform1f(r.uniforms.world_size,Math.min(r.world_height,r.world_width)/2),r.gl.uniform1i(r.uniforms.num_iterations,l),r.gl.uniform1f(r.uniforms.a,s),r.gl.uniform1f(r.uniforms.b,d),r.gl.uniform1f(r.uniforms.brightness_scale,u),r.render.draw_frame(),n>=50&&(p=0,b=0,y=0,f=0,g=0,z=0),0===p&&0===b&&0===y||(r.world_center_x+=p*r.world_width,r.world_center_y+=b*r.world_height,r.world_center_x=Math.min(Math.max(r.world_center_x,-2),2),r.world_center_y=Math.min(Math.max(r.world_center_y,-2),2),p*=x,b*=x,Math.sqrt(p*p+b*b)<M&&(p=0,b=0),_+=y,_=Math.min(_,1),L(),y*=k,Math.abs(y)<q&&(y=0),window.requestAnimationFrame(W))}function H(){r.fullscreen.currently_fullscreen?(a=window.innerWidth/window.innerHeight)>=1?(r.change_canvas_size(h,Math.floor(h/a)),r.world_width=4*Math.pow(2,_)*a,r.world_height=4*Math.pow(2,_)):(r.change_canvas_size(Math.floor(h*a),h),r.world_width=4*Math.pow(2,_),r.world_height=4*Math.pow(2,_)/a):(a=1,r.change_canvas_size(h,h),r.world_width=4*Math.pow(2,_),r.world_height=4*Math.pow(2,_)),window.requestAnimationFrame(W)}S.style.opacity=1,S.addEventListener("click",()=>{Page.Animate.change_opacity(S,0,Site.opacity_animation_time),setTimeout(()=>{2===i?S.textContent="Return to Mandelbrot Set":0===i&&(S.textContent="Pick Julia Set",Page.Animate.change_opacity(S,1,Site.opacity_animation_time))},Site.opacity_animation_time),0===i?(i=2,s=0,d=0,p=0,b=0,y=0,f=0,g=0,z=0,c=[],window.requestAnimationFrame(W)):1===i&&(i=0,r.world_center_x=-.75,r.world_center_y=0,r.world_width=4,r.world_height=4,_=0,c=[],window.requestAnimationFrame(W))}),r.gl.uniform1f(r.uniforms.aspect_ratio,1),o.gl.uniform1f(o.uniforms.aspect_ratio,1),window.requestAnimationFrame(W),Page.show(),window.addEventListener("resize",H),Page.temporary_handlers.resize.push(H)}();