!function(){"use strict";let e=0,t=0,r=0,o=0,n=0,u=0,l=0,a=0,c=0,s=100,i=500,d=25,m=50,p=200,y=[],g=[],q=!1,f=!1,S=!0,h=null,b=null;!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to preview the corresponding Julia set, and release to generate a higher-resolution image.")}(),document.querySelector("#generate-button").addEventListener("click",C);let v=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<v.length;e++)v[e].addEventListener("keydown",function(e){13===e.keyCode&&C()});function w(){if(e===n&&t===u&&o===l)return void(S=!0);g=[];for(let e=0;e<o;e++)g[e]=[];let a=null;document.querySelector("#julia-set").setAttribute("width",o),document.querySelector("#julia-set").setAttribute("height",o),a=document.querySelector("#julia-set").getContext("2d",{alpha:!1});for(let n=0;n<o/2;n++)M(n,e,t,o,r);let c=g.flat().sort(function(e,t){return e-t}),i=0;if(o===s){y.push(c[Math.round(.999*c.length)-1]),y.length>10&&y.shift(),i=0;for(let e=0;e<y.length;e++)i+=y[e];i/=y.length}else i=c[Math.round(.9999*c.length)-1];for(let e=0;e<o;e++)g[e]=g[e].map(e=>e/i*255);let d=a.getImageData(0,0,o,o),m=d.data;for(let e=0;e<o;e++)for(let t=0;t<o;t++){let r=g[e][t],n=4*e*o+4*t;m[n]=0,m[n+1]=r,m[n+2]=r,m[n+3]=255}a.putImageData(d,0,0),f?(f=!1,n=e,u=t,l=o,window.requestAnimationFrame(w)):S=!0}function M(e,t,r,o,n){for(let u=0;u<o+1;u++){let l=(u-o/2)/o*4,a=-(e-o/2)/o*4,c=Math.exp(-Math.sqrt(l*l+a*a)),s=0;for(s=0;s<n;s++){let e=2*l*a+r;if(l=l*l-a*a+t,a=e,c+=Math.exp(-Math.sqrt(l*l+a*a)),l*l+a*a>4)break}s===n&&(c=0),g[e][u]=c,g[o-e-1][o-u]=c}}function C(){let e=parseFloat(document.querySelector("#a-input").value)||0,t=parseFloat(document.querySelector("#b-input").value)||1,r=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#output-canvas").setAttribute("width",r),document.querySelector("#output-canvas").setAttribute("height",r),h=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),n=e,u=t,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{b.terminate()}catch(e){}b=DEBUG?new Worker("/applets/julia-set-explorer/scripts/worker.js"):new Worker("/applets/julia-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(b),b.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let t=h.getImageData(0,0,r,r),o=t.data;for(let t=0;t<r;t++)for(let n=0;n<r;n++){let u=e.data[0][t][n],l=4*t*r+4*n;o[l]=0,o[l+1]=u,o[l+2]=u,o[l+3]=255}h.putImageData(t,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),b.postMessage([e,t,r,p])}function j(){a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth}document.querySelector("#download-button").addEventListener("click",function(){let e=document.createElement("a");e.download=u<0?n+" - "+-u+"i.png":n+" + "+u+"i.png";e.href=document.querySelector("#output-canvas").toDataURL(),e.click(),e.remove()}),a=document.querySelector("#julia-set").offsetWidth,c=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",j),temporary_handlers.resize.push(j),setTimeout(j,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(n){if(!1===q){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=3*(u/a-.5)-.75,t=3*((a-l)/a-.5),o=s,r=d,f=!0,S&&(S=!1,window.requestAnimationFrame(w))}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(n){let u=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=3*(u/a-.5)-.75,t=3*((a-l)/a-.5),o=i,r=m,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,q=!0,f=!0,S&&(S=!1,window.requestAnimationFrame(w))}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){q=!1}),function(){let n=0,u=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(l){l.preventDefault();let c=l.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,i=l.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;n=c,u=i,e=3*(c/a-.5)-.75,t=3*((a-i)/a-.5),o=s,r=d,f=!0,S&&(S=!1,window.requestAnimationFrame(w))},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(l){l.preventDefault(),e=3*(n/a-.5)-.75,t=3*((a-u)/a-.5),o=i,r=m,document.querySelector("#a-input").value=Math.round(1e6*e)/1e6,document.querySelector("#b-input").value=Math.round(1e6*t)/1e6,f=!0,S&&(S=!1,window.requestAnimationFrame(w))},!1)}()}();