!function(){"use strict";let t=0,e=0,n=1e3,o=100,r=10,u=0,i=0,a=1e3,c=200,l=200,s=!1,d=!1,m=!1,f=0,b=!1,v=!0,g=document.querySelector("#julia-set").getContext("webgl");document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)")),document.querySelector("#generate-button").addEventListener("click",A);let h=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let t=0;t<h.length;t++)h[t].addEventListener("keydown",function(t){13===t.keyCode&&A()});document.querySelector("#download-button").addEventListener("click",function(){let n=document.createElement("a");n.download=e<0?t+" - "+-e+"i.png":t+" + "+e+"i.png";n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove()}),u=document.querySelector("#julia-set").offsetWidth,i=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",w),temporary_handlers.resize.push(w),setTimeout(w,1e3),applet_canvases_to_resize=[document.querySelector("#output-canvas")],applet_canvas_resize_callback=function(){i=document.querySelector("#output-canvas").offsetWidth},applet_canvas_true_fullscreen=!1,set_up_canvas_resizer(),setTimeout(function(){let r=_(g,g.VERTEX_SHADER,y),i=_(g,g.FRAGMENT_SHADER,S);p=g.createProgram(),g.attachShader(p,r),g.attachShader(p,i),g.linkProgram(p),g.getProgramParameter(p,g.LINK_STATUS)||(console.log(`Couldn't link shader program: ${g.getShaderInfoLog(shader)}`),g.deleteProgram(p));g.useProgram(p);let l=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,l),g.bufferData(g.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),g.STATIC_DRAW),p.position_attribute=g.getAttribLocation(p,"position"),g.enableVertexAttribArray(p.position_attribute),g.vertexAttribPointer(p.position_attribute,3,g.FLOAT,!1,0,0),p.a_uniform=g.getUniformLocation(p,"a"),p.b_uniform=g.getUniformLocation(p,"b"),p.num_iterations_uniform=g.getUniformLocation(p,"num_iterations"),p.brightness_scale_uniform=g.getUniformLocation(p,"brightness_scale"),g.viewport(0,0,n,n),document.querySelector("#mandelbrot-set").addEventListener("mouseenter",function(t){s=!1,document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),g.viewport(0,0,a,a),n=a,o=c}),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(n){if(!1===s){let o=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;t=3*(o/u-.5)-.75,e=3*((u-r)/u-.5),b=!0,v&&(v=!1,window.requestAnimationFrame(q))}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(n){m=!0,window.requestAnimationFrame(q),s=!0,document.querySelector("#a-input").value=Math.round(1e6*t)/1e6,document.querySelector("#b-input").value=Math.round(1e6*e)/1e6}),function(){let r=0,i=0;document.querySelector("#mandelbrot-set").addEventListener("touchstart",function(t){t.preventDefault(),document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),g.viewport(0,0,a,a),n=a,o=c},!1),document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(n){n.preventDefault();let o=n.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,a=n.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;r=o,i=a,t=3*(o/u-.5)-.75,e=3*((u-a)/u-.5),b=!0,v&&(v=!1,window.requestAnimationFrame(q))},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(n){n.preventDefault(),m=!0,window.requestAnimationFrame(q),document.querySelector("#a-input").value=Math.round(1e6*t)/1e6,document.querySelector("#b-input").value=Math.round(1e6*e)/1e6},!1)}()},500);const y="\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t",S="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tconst float box_size_halved = 2.0;\n\t\tuniform float a;\n\t\tuniform float b;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * box_size_halved, uv.y * box_size_halved);\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 201; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (length(z) >= 2.0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + a, 2.0 * z.x * z.y + b);\n\t\t\t\t\n\t\t\t\tbrightness += exp(-length(z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t}\n\t";let p=null;function _(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function q(){g.uniform1f(p.a_uniform,t),g.uniform1f(p.b_uniform,e),g.uniform1i(p.num_iterations_uniform,o),g.uniform1f(p.brightness_scale_uniform,r),g.drawArrays(g.TRIANGLE_STRIP,0,4);let u=new Uint8Array(n*n*4);g.readPixels(0,0,n,n,g.RGBA,g.UNSIGNED_BYTE,u);let i=0;for(let t=0;t<n*n;t++)255!==u[4*t]&&255!==u[4*t+1]&&255!==u[4*t+2]||i++;let a=!1;i<1.5*n&&1!==f?(r-=.5,m&&(f=-1),a=!0):i>2*n&&-1!==f&&(r+=.5,m&&(f=1),a=!0),m?a?window.requestAnimationFrame(q):(f=0,m=!1,d&&(n=parseFloat(document.querySelector("#dim-input").value)||1e3,document.querySelector("#julia-set").setAttribute("width",n),document.querySelector("#julia-set").setAttribute("height",n),g.viewport(0,0,n,n),o=l,document.querySelector("#output-canvas").setAttribute("width",n),document.querySelector("#output-canvas").setAttribute("height",n),q(),document.querySelector("#output-canvas").getContext("2d").drawImage(document.querySelector("#julia-set"),0,0),d=!1)):b?(b=!1,window.requestAnimationFrame(q)):v=!0}function A(){t=parseFloat(document.querySelector("#a-input").value||0),e=parseFloat(document.querySelector("#b-input").value||1),d=!0,m=!0,b=!0,v&&(v=!1,window.requestAnimationFrame(q))}function w(){u=document.querySelector("#julia-set").offsetWidth,i=document.querySelector("#output-canvas").offsetWidth}}();