!function(){"use strict";let e=0,t=0,r=0,o=0,n=100,u=500,l=25,c=50,s=200,a=[],i=[],d=!1,m=null,y=null;!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#high-res-julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#high-res-julia-set").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to preview the corresponding Julia set, and release to generate a higher-resolution image.")}(),document.querySelector("#generate-button").addEventListener("click",f);let g=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<g.length;e++)g[e].addEventListener("keydown",function(e){13===e.keyCode&&f()});function p(e,t,r,o){i=[];for(let e=0;e<r;e++)i[e]=[];let u=null;document.querySelector("#julia-set").setAttribute("width",r),document.querySelector("#julia-set").setAttribute("height",r),u=document.querySelector("#julia-set").getContext("2d");for(let n=0;n<r/2;n++)h(n,e,t,r,o);let l=i.flat().sort(function(e,t){return e-t}),c=0;if(r===n){a.push(l[Math.round(.999*l.length)-1]),a.length>10&&a.shift(),c=0;for(let e=0;e<a.length;e++)c+=a[e];c/=a.length}else c=l[Math.round(.9999*l.length)-1];for(let e=0;e<r;e++)i[e]=i[e].map(e=>e/c*255);let s=u.getImageData(0,0,r,r),d=s.data;for(let e=0;e<r;e++)for(let t=0;t<r;t++){let o=i[e][t],n=4*e*r+4*t;d[n]=0,d[n+1]=o,d[n+2]=o,d[n+3]=255}u.putImageData(s,0,0)}function h(e,t,r,o,n){for(let u=0;u<o+1;u++){let l=(u-o/2)/o*4,c=-(e-o/2)/o*4,s=Math.exp(-Math.sqrt(l*l+c*c)),a=0;for(a=0;a<n;a++){let e=2*l*c+r;if(l=l*l-c*c+t,c=e,s+=Math.exp(-Math.sqrt(l*l+c*c)),l*l+c*c>4)break}a===n&&(s=0),i[e][u]=s,i[o-e-1][o-u]=s}}function q(){let r=document.createElement("a");r.download=t<0?e+" - "+-t+"i.png":e+" + "+t+"i.png",r.href=document.querySelector("#high-res-julia-set").toDataURL(),r.click(),r.remove()}function f(){let r=parseFloat(document.querySelector("#a-input").value)||0,o=parseFloat(document.querySelector("#b-input").value)||1,n=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#high-res-julia-set").setAttribute("width",n),document.querySelector("#high-res-julia-set").setAttribute("height",n),m=document.querySelector("#high-res-julia-set").getContext("2d"),e=r,t=o,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{y.terminate()}catch(e){}y=DEBUG?new Worker("/applets/julia-set-explorer/scripts/worker.js"):new Worker("/applets/julia-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(y),y.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let t=m.getImageData(0,0,n,n),r=t.data;for(let t=0;t<n;t++)for(let o=0;o<n;o++){let u=e.data[0][t][o],l=4*t*n+4*o;r[l]=0,r[l+1]=u,r[l+2]=u,r[l+3]=255}m.putImageData(t,0,0),q(),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),y.postMessage([r,o,n,s])}function S(){r=document.querySelector("#julia-set").offsetWidth,o=document.querySelector("#high-res-julia-set").offsetWidth}document.querySelector("#download-button").addEventListener("click",q),r=document.querySelector("#julia-set").offsetWidth,o=document.querySelector("#high-res-julia-set").offsetWidth,window.addEventListener("resize",S),temporary_handlers.resize.push(S),setTimeout(S,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===d){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,o=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,u=3*(t/r-.5)-.75,c=3*((r-o)/r-.5);p(u,c,n,l)}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,o=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top,n=3*(t/r-.5)-.75,l=3*((r-o)/r-.5);p(n,l,u,c),document.querySelector("#a-input").value=Math.round(1e6*n)/1e6,document.querySelector("#b-input").value=Math.round(1e6*l)/1e6,d=!0}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){d=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(o){o.preventDefault();let u=o.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,c=o.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=u,t=c;let s=3*(u/r-.5)-.75,a=3*((r-c)/r-.5);p(s,a,n,l)},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(o){o.preventDefault();let n=3*(e/r-.5)-.75,l=3*((r-t)/r-.5);p(n,l,u,c),document.querySelector("#a-input").value=Math.round(1e6*n)/1e6,document.querySelector("#b-input").value=Math.round(1e6*l)/1e6},!1)}()}();