!function(){"use strict";let e=0,t=0,r=0,o=0,n=0,u=100,l=500,a=25,c=50,s=200,i=0,d=0,m=a,p=u,y=[],g=[],q=!1,f=!1,S=!0,h=null,b=null;!function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Drag along the Mandelbrot set to preview the corresponding Julia set, and release to generate a higher-resolution image.")}(),document.querySelector("#generate-button").addEventListener("click",j);let v=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let e=0;e<v.length;e++)v[e].addEventListener("keydown",function(e){13===e.keyCode&&j()});function w(){if(i===e&&d===t&&p===r)return void(S=!0);p!==r&&C();for(let e=0;e<p/2;e++)M(e,i,d,p,m);let o=g.flat().sort(function(e,t){return e-t}),n=0;if(p===u){y.push(o[Math.round(.999*o.length)-1]),y.length>10&&y.shift(),n=0;for(let e=0;e<y.length;e++)n+=y[e];n/=y.length}else n=o[Math.round(.9999*o.length)-1];for(let e=0;e<p;e++)g[e]=g[e].map(e=>e/n*255);let l=h.getImageData(0,0,p,p),a=l.data;for(let e=0;e<p;e++)for(let t=0;t<p;t++){let r=g[e][t],o=4*e*p+4*t;a[o]=0,a[o+1]=r,a[o+2]=r,a[o+3]=255}h.putImageData(l,0,0),e=i,t=d,r=p,f?(f=!1,window.requestAnimationFrame(w)):S=!0}function M(e,t,r,o,n){for(let u=0;u<o+1;u++){let l=(u-o/2)/o*4,a=-(e-o/2)/o*4,c=Math.exp(-Math.sqrt(l*l+a*a)),s=0;for(s=0;s<n;s++){let e=2*l*a+r;if(l=l*l-a*a+t,a=e,c+=Math.exp(-Math.sqrt(l*l+a*a)),l*l+a*a>4)break}s===n&&(c=0),g[e][u]=c,g[o-e-1][o-u]=c}}function C(){g=[];for(let e=0;e<p;e++)g[e]=[];document.querySelector("#julia-set").setAttribute("width",p),document.querySelector("#julia-set").setAttribute("height",p),h=document.querySelector("#julia-set").getContext("2d",{alpha:!1})}function j(){let r=parseFloat(document.querySelector("#a-input").value)||0,o=parseFloat(document.querySelector("#b-input").value)||1,n=parseFloat(document.querySelector("#dim-input").value)||1e3;document.querySelector("#output-canvas").setAttribute("width",n),document.querySelector("#output-canvas").setAttribute("height",n),h=document.querySelector("#output-canvas").getContext("2d",{alpha:!1}),e=r,t=o,document.querySelector("#progress-bar span").insertAdjacentHTML("afterend","<span></span>"),document.querySelector("#progress-bar span").remove();try{b.terminate()}catch(e){}b=DEBUG?new Worker("/applets/julia-set-explorer/scripts/worker.js"):new Worker("/applets/julia-set-explorer/scripts/worker.min.js"),temporary_web_workers.push(b),b.onmessage=function(e){if("progress"===e.data[0])document.querySelector("#progress-bar span").style.width=e.data[1]+"%",100===e.data[1]&&setTimeout(function(){document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)},600);else{let t=h.getImageData(0,0,n,n),r=t.data;for(let t=0;t<n;t++)for(let o=0;o<n;o++){let u=e.data[0][t][o],l=4*t*n+4*o;r[l]=0,r[l+1]=u,r[l+2]=u,r[l+3]=255}h.putImageData(t,0,0),document.querySelector("#progress-bar").style.opacity=0,setTimeout(function(){document.querySelector("#progress-bar").style.marginTop=0,document.querySelector("#progress-bar").style.marginBottom=0},300)}},document.querySelector("#progress-bar span").style.width=0,document.querySelector("#progress-bar").style.marginTop="5vh",document.querySelector("#progress-bar").style.marginBottom="5vh",setTimeout(function(){document.querySelector("#progress-bar").style.opacity=1},600),b.postMessage([r,o,n,s])}function k(){o=document.querySelector("#julia-set").offsetWidth,n=document.querySelector("#output-canvas").offsetWidth}document.querySelector("#download-button").addEventListener("click",function(){let r=document.createElement("a");r.download=t<0?e+" - "+-t+"i.png":e+" + "+t+"i.png";r.href=document.querySelector("#output-canvas").toDataURL(),r.click(),r.remove()}),o=document.querySelector("#julia-set").offsetWidth,n=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",k),temporary_handlers.resize.push(k),setTimeout(k,1e3),document.querySelector("#mandelbrot-set").addEventListener("mousemove",function(e){if(!1===q){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;i=3*(t/o-.5)-.75,d=3*((o-r)/o-.5),p=u,m=a,f=!0,S&&(S=!1,window.requestAnimationFrame(w))}}),document.querySelector("#mandelbrot-set").addEventListener("click",function(e){let t=e.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=e.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;i=3*(t/o-.5)-.75,d=3*((o-r)/o-.5),p=l,m=c,document.querySelector("#a-input").value=Math.round(1e6*i)/1e6,document.querySelector("#b-input").value=Math.round(1e6*d)/1e6,q=!0,C(),f=!0,S&&(S=!1,window.requestAnimationFrame(w))}),document.querySelector("#mandelbrot-set").addEventListener("mouseleave",function(e){q=!1}),function(){let e=0,t=0;document.querySelector("#mandelbrot-set").addEventListener("touchmove",function(r){r.preventDefault();let n=r.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,l=r.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;e=n,t=l,i=3*(n/o-.5)-.75,d=3*((o-l)/o-.5),p=u,m=a,f=!0,S&&(S=!1,window.requestAnimationFrame(w))},!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",function(r){r.preventDefault(),i=3*(e/o-.5)-.75,d=3*((o-t)/o-.5),p=l,m=c,document.querySelector("#a-input").value=Math.round(1e6*i)/1e6,document.querySelector("#b-input").value=Math.round(1e6*d)/1e6,C(),f=!0,S&&(S=!1,window.requestAnimationFrame(w))},!1)}(),C()}();