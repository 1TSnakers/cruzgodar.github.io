!function(){"use strict";let t=0,e=0,n=1e3,o=100,r=10,i=0,u=0,a=1e3,l=!1,c=!1,s=!1,d=!0,m=document.querySelector("#julia-set").getContext("webgl");document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),function(){1===url_vars.contrast&&(1===url_vars.theme?(document.querySelector("#mandelbrot-set").style.borderColor="rgb(192, 192, 192)",document.querySelector("#julia-set").style.borderColor="rgb(192, 192, 192)"):(document.querySelector("#mandelbrot-set").style.borderColor="rgb(64, 64, 64)",document.querySelector("#julia-set").style.borderColor="rgb(64, 64, 64)"));currently_touch_device&&(document.querySelector("#instructions").innerHTML="Just drag along the Mandelbrot set to see the corresponding Julia set.")}(),document.querySelector("#generate-button").addEventListener("click",v);let f=document.querySelectorAll("#a-input, #b-input, #dim-input");for(let t=0;t<f.length;t++)f[t].addEventListener("keydown",(function(t){13===t.keyCode&&v()}));document.querySelector("#download-button").addEventListener("click",(function(){let n=document.createElement("a");n.download=e<0?t+" - "+-e+"i.png":t+" + "+e+"i.png";n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove()})),i=document.querySelector("#julia-set").offsetWidth,u=document.querySelector("#output-canvas").offsetWidth,window.addEventListener("resize",S),temporary_handlers.resize.push(S),setTimeout(S,1e3);let g=null;function h(){let t=b(m,m.VERTEX_SHADER,"\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t"),e=b(m,m.FRAGMENT_SHADER,"\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tconst float box_size_halved = 2.0;\n\t\tuniform float a;\n\t\tuniform float b;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * box_size_halved, uv.y * box_size_halved);\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tfor (int iteration = 0; iteration < 201; iteration++)\n\t\t\t{\n\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (length(z) >= 2.0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + a, 2.0 * z.x * z.y + b);\n\t\t\t\t\n\t\t\t\tbrightness += exp(-length(z));\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tgl_FragColor = vec4(0.0, brightness / brightness_scale, brightness / brightness_scale, 1.0);\n\t\t}\n\t");g=m.createProgram(),m.attachShader(g,t),m.attachShader(g,e),m.linkProgram(g),m.getProgramParameter(g,m.LINK_STATUS)||(console.log("Couldn't link shader program: "+m.getShaderInfoLog(shader)),m.deleteProgram(g)),m.useProgram(g);let o=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,o),m.bufferData(m.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),m.STATIC_DRAW),g.position_attribute=m.getAttribLocation(g,"position"),m.enableVertexAttribArray(g.position_attribute),m.vertexAttribPointer(g.position_attribute,3,m.FLOAT,!1,0,0),g.a_uniform=m.getUniformLocation(g,"a"),g.b_uniform=m.getUniformLocation(g,"b"),g.num_iterations_uniform=m.getUniformLocation(g,"num_iterations"),g.brightness_scale_uniform=m.getUniformLocation(g,"brightness_scale"),m.viewport(0,0,n,n)}function b(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log("Couldn't load shader: "+t.getProgramInfoLog(shaderProgram)),t.deleteShader(o)),o}function y(){m.uniform1f(g.a_uniform,t),m.uniform1f(g.b_uniform,e),m.uniform1i(g.num_iterations_uniform,o),m.uniform1f(g.brightness_scale_uniform,r),m.drawArrays(m.TRIANGLE_STRIP,0,4);let i=new Uint8Array(n*n*4);m.readPixels(0,0,n,n,m.RGBA,m.UNSIGNED_BYTE,i);let u=0;for(let t=0;t<n*n;t++){255===i[4*t+1]&&u++}let a=!1;u<.1*n?(r-=.5,a=!0):u>.2*n&&(r+=.5,a=!0),c?a?window.requestAnimationFrame(y):c=!1:s?(s=!1,window.requestAnimationFrame(y)):d=!0}function v(){t=parseFloat(document.querySelector("#a-input").value||0),e=parseFloat(document.querySelector("#b-input").value||1),n=parseFloat(document.querySelector("#dim-input").value)||1e3,document.querySelector("#julia-set").setAttribute("width",n),document.querySelector("#julia-set").setAttribute("height",n),m.viewport(0,0,n,n),o=200,document.querySelector("#output-canvas").setAttribute("width",n),document.querySelector("#output-canvas").setAttribute("height",n),y(),document.querySelector("#output-canvas").getContext("2d").drawImage(document.querySelector("#julia-set"),0,0)}function S(){i=document.querySelector("#julia-set").offsetWidth,u=document.querySelector("#output-canvas").offsetWidth}load_script("/scripts/gl-matrix.min.js").then((function(){setTimeout(h,500)})),document.querySelector("#mandelbrot-set").addEventListener("mouseenter",(function(t){l=!1,document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),m.viewport(0,0,a,a),n=a,o=100})),document.querySelector("#mandelbrot-set").addEventListener("mousemove",(function(n){if(!1===l){let o=n.clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,r=n.clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;t=3*(o/i-.5)-.75,e=3*((i-r)/i-.5),s=!0,d&&(d=!1,window.requestAnimationFrame(y))}})),document.querySelector("#mandelbrot-set").addEventListener("click",(function(n){c=!0,window.requestAnimationFrame(y),l=!0,document.querySelector("#a-input").value=Math.round(1e6*t)/1e6,document.querySelector("#b-input").value=Math.round(1e6*e)/1e6})),function(){let r=0,u=0;document.querySelector("#mandelbrot-set").addEventListener("touchstart",(function(t){t.preventDefault(),document.querySelector("#julia-set").setAttribute("width",a),document.querySelector("#julia-set").setAttribute("height",a),m.viewport(0,0,a,a),n=a,o=100}),!1),document.querySelector("#mandelbrot-set").addEventListener("touchmove",(function(n){n.preventDefault();let o=n.touches[0].clientX-document.querySelector("#mandelbrot-set").getBoundingClientRect().left,a=n.touches[0].clientY-document.querySelector("#mandelbrot-set").getBoundingClientRect().top;r=o,u=a,t=3*(o/i-.5)-.75,e=3*((i-a)/i-.5),s=!0,d&&(d=!1,window.requestAnimationFrame(y))}),!1),document.querySelector("#mandelbrot-set").addEventListener("touchend",(function(n){n.preventDefault(),c=!0,window.requestAnimationFrame(y),document.querySelector("#a-input").value=Math.round(1e6*t)/1e6,document.querySelector("#b-input").value=Math.round(1e6*e)/1e6}),!1)}()}();