!function(){"use strict";let t=document.querySelector("#output-canvas").getContext("webgl"),e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n),r=!1,i=!1,a=0,u=null,c=0,s=0,l=0,m=!1,d=0,f=0,h=-.75,g=0,v=0,p=0,_=3,y=0,b=13,z=500,S=500,w=500,q=200;document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",w),document.querySelector("#image-size-input").addEventListener("input",function(){(z=parseInt(document.querySelector("#image-size-input").value||500))<200&&(z=200);z>2e3&&(z=2e3);Page.Applets.Canvases.is_fullscreen&&(Page.Layout.aspect_ratio>=1?(S=z,w=Math.floor(z/Page.Layout.aspect_ratio)):(S=Math.floor(z*Page.Layout.aspect_ratio),w=z));document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",w),t.viewport(0,0,S,w),window.requestAnimationFrame(F)}),document.querySelector("#generate-high-res-image-button").addEventListener("click",function(){let e=z;z=parseInt(document.querySelector("#high-res-dim-input").value||2e3),q+=50,document.querySelector("#output-canvas").setAttribute("width",z),document.querySelector("#output-canvas").setAttribute("height",z),t.viewport(0,0,z,z),F();let n=document.createElement("a");n.download="a-mandelbrot-zoom.png",n.href=document.querySelector("#output-canvas").toDataURL(),n.click(),n.remove(),z=e,q-=50,document.querySelector("#output-canvas").setAttribute("width",z),document.querySelector("#output-canvas").setAttribute("height",z),t.viewport(0,0,z,z),F()}),document.querySelector("#switch-julia-mode-button").addEventListener("click",function(){document.querySelector("#switch-julia-mode-button").style.opacity=0,setTimeout(function(){2===f?document.querySelector("#switch-julia-mode-button").textContent="Return to Mandelbrot Set":0===f&&(document.querySelector("#switch-julia-mode-button").textContent="Pick Julia Set",document.querySelector("#switch-julia-mode-button").style.opacity=1)},300),0===f?(f=2,v=0,p=0):1===f&&(f=0,h=-.75,g=0,_=3,y=0,b=13),i=!0,r||(r=!0,window.requestAnimationFrame(F))}),window.addEventListener("resize",j),setTimeout(j,500),Page.Applets.Canvases.to_resize=[document.querySelector("#output-canvas")],Page.Applets.Canvases.resize_callback=function(){Page.Applets.Canvases.is_fullscreen?Page.Layout.aspect_ratio>=1?(S=z,w=Math.floor(z/Page.Layout.aspect_ratio)):(S=Math.floor(z*Page.Layout.aspect_ratio),w=z):(S=z,w=z),e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n),document.querySelector("#output-canvas").setAttribute("width",S),document.querySelector("#output-canvas").setAttribute("height",w),t.viewport(0,0,S,w),j(),window.requestAnimationFrame(F)},Page.Applets.Canvases.true_fullscreen=!0,Page.Applets.Canvases.set_up_resizer(),document.querySelector("#output-canvas").addEventListener("mousedown",C),document.documentElement.addEventListener("mousemove",E),Page.temporary_handlers.mousemove.push(E),document.documentElement.addEventListener("mouseup",R),Page.temporary_handlers.mouseup.push(R),document.querySelector("#output-canvas").addEventListener("touchstart",k),document.querySelector("#output-canvas").addEventListener("touchmove",T),document.querySelector("#output-canvas").addEventListener("touchend",M),window.addEventListener("wheel",U,{passive:!1}),Page.temporary_handlers.wheel.push(U),setTimeout(function(){let e=P(t,t.VERTEX_SHADER,A),n=P(t,t.FRAGMENT_SHADER,x);L=t.createProgram(),t.attachShader(L,e),t.attachShader(L,n),t.linkProgram(L),t.getProgramParameter(L,t.LINK_STATUS)||(console.log(`Couldn't link shader program: ${t.getShaderInfoLog(shader)}`),t.deleteProgram(L));t.useProgram(L);let o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),t.STATIC_DRAW),L.position_attribute=t.getAttribLocation(L,"position"),t.enableVertexAttribArray(L.position_attribute),t.vertexAttribPointer(L.position_attribute,3,t.FLOAT,!1,0,0),L.aspect_ratio_uniform=t.getUniformLocation(L,"aspect_ratio"),L.box_size_halved_uniform=t.getUniformLocation(L,"box_size_halved"),L.center_x_uniform=t.getUniformLocation(L,"center_x"),L.center_y_uniform=t.getUniformLocation(L,"center_y"),L.a_uniform=t.getUniformLocation(L,"a"),L.b_uniform=t.getUniformLocation(L,"b"),L.brightness_scale_uniform=t.getUniformLocation(L,"brightness_scale"),L.num_iterations_uniform=t.getUniformLocation(L,"num_iterations"),L.julia_mode_uniform=t.getUniformLocation(L,"julia_mode"),t.viewport(0,0,S,w),window.requestAnimationFrame(F)},500);const A="\n\t\tattribute vec3 position;\n\t\tvarying vec2 uv;\n\n\t\tvoid main(void)\n\t\t{\n\t\t\tgl_Position = vec4(position, 1.0);\n\n\t\t\t//Interpolate quad coordinates in the fragment shader.\n\t\t\tuv = position.xy;\n\t\t}\n\t",x="\n\t\tprecision highp float;\n\t\t\n\t\tvarying vec2 uv;\n\t\t\n\t\tuniform float aspect_ratio;\n\t\t\n\t\tuniform float box_size_halved;\n\t\tuniform float a;\n\t\tuniform float b;\n\t\tuniform float center_x;\n\t\tuniform float center_y;\n\t\tuniform float brightness_scale;\n\t\tuniform int num_iterations;\n\t\t\n\t\tuniform int julia_mode;\n\t\t\n\t\t\n\t\t\n\t\tvoid main(void)\n\t\t{\n\t\t\tvec2 z = vec2(uv.x * aspect_ratio * box_size_halved + center_x, uv.y * box_size_halved + center_y);\n\t\t\tvec3 color = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\tfloat brightness = exp(-length(z));\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tif (julia_mode == 0)\n\t\t\t{\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\telse if (julia_mode == 1)\n\t\t\t{\n\t\t\t\tvec2 c = vec2(a, b);\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(brightness / brightness_scale * color, 1.0);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tvec2 c = z;\n\t\t\t\t\n\t\t\t\tbool broken = false;\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (!broken)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor = vec4(.5 * brightness / brightness_scale * color, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tz = vec2(uv.x * aspect_ratio * 2.0, uv.y * 2.0);\n\t\t\t\tcolor = normalize(vec3(abs(z.x + z.y) / 2.0, abs(z.x) / 2.0, abs(z.y) / 2.0) + .1 / length(z) * vec3(1.0, 1.0, 1.0));\n\t\t\t\tbrightness = exp(-length(z));\n\t\t\t\t\n\t\t\t\tbroken = false;\n\t\t\t\t\n\t\t\t\tc = vec2(a, b);\n\t\t\t\t\n\t\t\t\tfor (int iteration = 0; iteration < 3001; iteration++)\n\t\t\t\t{\n\t\t\t\t\tif (iteration == num_iterations)\n\t\t\t\t\t{\n\t\t\t\t\t\tgl_FragColor.xyz /= 4.0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (length(z) >= 4.0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tz = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;\n\t\t\t\t\t\n\t\t\t\t\tbrightness += exp(-length(z));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!broken)\n\t\t\t\t{\n\t\t\t\t\tgl_FragColor += vec4(brightness / brightness_scale * color, 0.0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t";let L=null;function P(t,e,n){let o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.log(`Couldn't load shader: ${t.getProgramInfoLog(shaderProgram)}`),t.deleteShader(o)),o}function F(){r=!1,t.uniform1f(L.aspect_ratio_uniform,S/w),t.uniform1f(L.box_size_halved_uniform,_/2),t.uniform1f(L.center_x_uniform,h),t.uniform1f(L.center_y_uniform,g),t.uniform1f(L.a_uniform,v),t.uniform1f(L.b_uniform,p),t.uniform1f(L.brightness_scale_uniform,b),t.uniform1i(L.num_iterations_uniform,q),t.uniform1i(L.julia_mode_uniform,f),t.drawArrays(t.TRIANGLE_STRIP,0,4);let e=new Uint8Array(S*w*4);t.readPixels(0,0,S,w,t.RGBA,t.UNSIGNED_BYTE,e);let n=0;for(let t=0;t<S*w;t++)255!==e[4*t]&&255!==e[4*t+1]&&255!==e[4*t+2]||n++;let o=!1,u=h*h+g*g+2;0!==f&&(u=v*v+p*p+2),n<2*z&&1!==a&&b>1/u?(b-=.5/u,i&&(b-=.5/u,a=-1),o=!0):n>4*z&&-1!==a&&(b+=.5/u,i&&(b+=.5/u,a=1),o=!0),i?o?window.requestAnimationFrame(F):(a=0,i=!1):r&&window.requestAnimationFrame(F)}function C(t){t.preventDefault(),c=t.clientX,s=t.clientY,2!==f?m=!0:(f=1,h=0,g=0,_=4,y=0,i=!0,document.querySelector("#switch-julia-mode-button").style.opacity=1),r||(r=!0,i=!0,window.requestAnimationFrame(F))}function E(t){let o=t.clientX,a=t.clientY,u=o-c,l=a-s;if(c=o,s=a,document.elementFromPoint(c,s)===document.querySelector("#output-canvas"))if(2!==f)m&&(t.preventDefault(),h-=u/n*_,g+=l/n*_,r||(r=!0,i=!1,window.requestAnimationFrame(F)));else{t.preventDefault();let o=c-document.querySelector("#output-canvas").getBoundingClientRect().left,a=s-document.querySelector("#output-canvas").getBoundingClientRect().top;v=(o/e-.5)*_+h,p=((n-a)/n-.5)*_+g,r||(r=!0,i=!1,window.requestAnimationFrame(F))}}function R(t){r=m=!1}function k(t){c=t.touches[0].clientX,s=t.touches[0].clientY,m=!0,r||(r=!0,i=!1,window.requestAnimationFrame(F))}function T(t){if(t.preventDefault(),i)return;let o=t.touches[0].clientX,a=t.touches[0].clientY;if(t.touches.length>=2){d=10;let o=t.touches[0].clientX-t.touches[1].clientX,r=t.touches[0].clientY-t.touches[1].clientY,i=Math.sqrt(o*o+r*r),a=i-l;if(l=i,Math.abs(a)>20)return;let u=document.querySelector("#output-canvas").getBoundingClientRect(),c=((t.touches[0].clientX+t.touches[1].clientX)/2-u.left)/e,s=((t.touches[0].clientY+t.touches[1].clientY)/2-u.top)/n,m=(c*_-_/2)*S/w+h,f=_/2-s*_+g,v=a/2;y+v>=0&&(y+=v,_=3/Math.pow(1.02,y),q=3*y+200),h=m-(c*_-_/2)*S/w,g=f-(_/2-s*_)}else--d<0&&(d=0);let u=o-c,m=a-s;if(!d||!(Math.abs(u)>50||Math.abs(m)>50)){if(c=o,s=a,2!==f)h-=u/n*_,g+=m/n*_;else{let t=c-document.querySelector("#output-canvas").getBoundingClientRect().left,o=s-document.querySelector("#output-canvas").getBoundingClientRect().top;v=(t/e-.5)*_+h,p=((n-o)/n-.5)*_+g}r||(r=!0,i=!1,window.requestAnimationFrame(F))}}function M(t){0===t.touches.length&&(r=!1,2===f&&(f=1,h=0,g=0,_=4,y=0,document.querySelector("#switch-julia-mode-button").style.opacity=1)),i=!0,setTimeout(function(){r||window.requestAnimationFrame(F)},200)}function U(t){if("output-canvas"===document.elementFromPoint(c,s).id){t.preventDefault(),(y-=10*Math.sign(t.deltaY))<1&&(y=1,b=13);let o=document.querySelector("#output-canvas").getBoundingClientRect(),r=(c-o.left)/e,l=(s-o.top)/n,m=(r*_-_/2)*S/w+h,d=_/2-l*_+g;_=3/Math.pow(1.02,y),q=3*y+200,h=m-(r*_-_/2)*S/w,g=d-(_/2-l*_),window.requestAnimationFrame(F);try{clearTimeout(u)}catch(t){}u=setTimeout(function(){i=!0,a=0,window.requestAnimationFrame(F)},500)}}function j(){e=document.querySelector("#output-canvas").offsetWidth,n=document.querySelector("#output-canvas").offsetHeight,o=Math.min(e,n)}}();