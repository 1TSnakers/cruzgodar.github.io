"use strict";onmessage=async function(r){grid_size=r.data[0],K=r.data[1],await draw_kicked_rotator()};let grid_size=null,K=null,image=[],unvisited_points=[],current_orbit=[],current_row=null,current_col=null,current_p=null,current_theta=null;const max_repetitions=50,orbit_separation=4;function draw_kicked_rotator(){image=[],unvisited_points=[];for(let r=0;r<grid_size;r++){image.push([]);for(let t=0;t<grid_size;t++)image[r].push(0),unvisited_points.push(grid_size*r+t)}const r=Math.floor(grid_size/2);for(let t=1;t<grid_size/2;t+=orbit_separation+1){let e=6/7*t/(grid_size/2),i=Math.floor(Math.random()*(2*orbit_separation+1))-orbit_separation,n=calculate_orbit(Math.floor(grid_size/2+t),r+i,e);if(postMessage([current_orbit,e]),n<.45){for(let r=0;r<current_orbit.length;r++)current_orbit[r][0]=grid_size-current_orbit[r][0],current_orbit[r][1]=grid_size-current_orbit[r][1];postMessage([current_orbit,e])}}}function calculate_orbit(r,t,e){let i=0;if(current_orbit=[],current_row=r,current_col=t,-1===unvisited_points.indexOf(grid_size*current_row+current_col))return;current_p=(1-current_row/grid_size)*(2*Math.PI),current_theta=current_col/grid_size*(2*Math.PI);let n=0;for(;;){let r=unvisited_points.indexOf(grid_size*current_row+current_col);if(-1!==r)unvisited_points.splice(r,1),current_orbit.push([current_row,current_col]),current_row<grid_size/2&&i++,n=0;else if(++n===max_repetitions)break;for(current_p+=K*Math.sin(current_theta),current_theta+=current_p;current_p>=2*Math.PI;)current_p-=2*Math.PI;for(;current_theta>=2*Math.PI;)current_theta-=2*Math.PI;for(;current_p<0;)current_p+=2*Math.PI;for(;current_theta<0;)current_theta+=2*Math.PI;current_row=Math.floor((1-current_p/(2*Math.PI))*grid_size),current_col=Math.floor(current_theta/(2*Math.PI)*grid_size)}return i/current_orbit.length}