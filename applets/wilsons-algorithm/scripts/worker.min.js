onmessage=async function(e){grid_size=e.data[0],await draw_wilson_graph(grid_size),await color_graph(grid_size),postMessage(["done"])};let grid_size=null,edges_in_tree=[],vertices_not_in_tree=[],new_vertices=[],current_row=null,current_column=null;function draw_wilson_graph(e){return new Promise(async function(r,t){edges_in_tree=[],vertices_not_in_tree=[];for(let r=0;r<e;r++)for(let t=0;t<e;t++)vertices_not_in_tree[e*r+t]=[r,t];let n=Math.floor(Math.random()*vertices_not_in_tree.length);for(vertices_not_in_tree.splice(n,1);vertices_not_in_tree.length>0;)await wilson_step(e);r()})}function wilson_step(e){return new Promise(async function(e,r){new_vertices=[];let t=Math.floor(Math.random()*vertices_not_in_tree.length);new_vertices.push(vertices_not_in_tree[t]),current_row=new_vertices[0][0],current_column=new_vertices[0][1],random_walk();for(let e=0;e<new_vertices.length-1;e++)await draw_line(new_vertices[e][0],new_vertices[e][1],new_vertices[e+1][0],new_vertices[e+1][1],"rgb(255, 255, 255)",8);for(let e=0;e<new_vertices.length-1;e++){let r=vertex_in_array(new_vertices[e],vertices_not_in_tree);vertices_not_in_tree.splice(r,1),edges_in_tree.push([new_vertices[e],new_vertices[e+1]])}e()})}function random_walk(){for(;-1!=vertex_in_array([current_row,current_column],vertices_not_in_tree);){let e=[],r=(e=0==current_row&&0==current_column?[1,2]:current_row==grid_size-1&&0==current_column?[0,1]:0==current_row&&current_column==grid_size-1?[2,3]:current_row==grid_size-1&&current_column==grid_size-1?[0,3]:0==current_row?[1,2,3]:current_row==grid_size-1?[0,1,3]:0==current_column?[0,1,2]:current_column==grid_size-1?[0,2,3]:[0,1,2,3])[Math.floor(Math.random()*e.length)];0==r?current_row--:1==r?current_column++:2==r?current_row++:current_column--;let t=vertex_in_array([current_row,current_column],new_vertices);-1!=t?(current_row=new_vertices[t][0],current_column=new_vertices[t][1],new_vertices=new_vertices.slice(0,t+1)):new_vertices.push([current_row,current_column])}}function color_graph(e){return new Promise(async function(r,t){let n=[];for(let r=0;r<e;r++){n[r]=[];for(let t=0;t<e;t++)n[r][t]=[]}for(let e=0;e<edges_in_tree.length;e++){let r=edges_in_tree[e][0][0],t=edges_in_tree[e][0][1],_=edges_in_tree[e][1][0],o=edges_in_tree[e][1][1];r==_?(n[r][Math.min(t,o)].includes(1)||n[r][Math.min(t,o)].push(1),n[_][Math.max(t,o)].includes(3)||n[_][Math.max(t,o)].push(3)):(n[Math.min(r,_)][t].includes(2)||n[Math.min(r,_)][t].push(2),n[Math.max(r,_)][t].includes(0)||n[Math.max(r,_)][o].push(0))}let _=[],o=[];o=e%2==1?[[Math.floor(e/2),Math.floor(e/2),0]]:[[Math.floor(e/2)-1,Math.floor(e/2)-1,0],[Math.floor(e/2)-1,Math.floor(e/2),0],[Math.floor(e/2),Math.floor(e/2)-1,0],[Math.floor(e/2),Math.floor(e/2),0]];let i=[];for(let r=0;r<e;r++){i[r]=[];for(let t=0;t<e;t++)i[r][t]=-1}for(;o.length>0;){let e=o.length;for(let r=0;r<e;r++){let e=o[r][0],t=o[r][1],s=o[r][2];i[e][t]=s,n[e][t].includes(0)&&-1==i[e-1][t]&&(o.push([e-1,t,s+1]),_.push([[e,t],[e-1,t],s])),n[e][t].includes(1)&&-1==i[e][t+1]&&(o.push([e,t+1,s+1]),_.push([[e,t],[e,t+1],s])),n[e][t].includes(2)&&-1==i[e+1][t]&&(o.push([e+1,t,s+1]),_.push([[e,t],[e+1,t],s])),n[e][t].includes(3)&&-1==i[e][t-1]&&(o.push([e,t-1,s+1]),_.push([[e,t],[e,t-1],s]))}o.splice(0,e)}_.sort((e,r)=>e[2]-r[2]);let s=7*_[_.length-1][2]/6,c=[0],l=0;for(let e=0;e<_.length;e++)_[e][2]>l&&(c.push(e),l++);c.push(_.length);for(let e=0;e<c.length;e++){for(j=c[e];j<c[e+1]-1;j++){let e=HSVtoRGB(_[j][2]/s,1,1);draw_line(_[j][0][0],_[j][0][1],_[j][1][0],_[j][1][1],`rgb(${e[0]}, ${e[1]}, ${e[2]})`,0)}let r=HSVtoRGB(_[j][2]/s,1,1);await draw_line(_[j][0][0],_[j][0][1],_[j][1][0],_[j][1][1],`rgb(${r[0]}, ${r[1]}, ${r[2]})`,24)}r()})}function draw_line(e,r,t,n,_,o){return new Promise(function(i,s){if(r==n){let n=r,o=Math.min(e,t);postMessage([2*n+1,2*o+1,1,3,_])}else{let t=Math.min(r,n);postMessage([2*t+1,2*e+1,3,1,_])}setTimeout(i,o)})}function vertex_in_array(e,r){for(let t=0;t<r.length;t++)if(r[t][0]==e[0]&&r[t][1]==e[1])return t;return-1}function HSVtoRGB(e,r,t){let n,_,o,i,s,c,l,u;switch(c=t*(1-r),l=t*(1-(s=6*e-(i=Math.floor(6*e)))*r),u=t*(1-(1-s)*r),i%6){case 0:n=t,_=u,o=c;break;case 1:n=l,_=t,o=c;break;case 2:n=c,_=t,o=u;break;case 3:n=c,_=l,o=t;break;case 4:n=u,_=c,o=t;break;case 5:n=t,_=c,o=l}return[Math.round(255*n),Math.round(255*_),Math.round(255*o)]}