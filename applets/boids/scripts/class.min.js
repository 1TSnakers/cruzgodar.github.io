import{AnimationFrameApplet}from"/scripts/applets/animationFrameApplet.min.js";import{hsvToRgb}from"/scripts/applets/applet.min.js";import{WilsonCPU}from"/scripts/wilson.min.js";class Boids extends AnimationFrameApplet{resolution=2e3;numBoids=500;boids=[];boidSize=.01;constructor({canvas}){super(canvas);var i={canvasWidth:this.resolution,fullscreenOptions:{useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"}};this.wilson=new WilsonCPU(canvas,i),this.run({})}run({resolution=2e3,numBoids=500,minVelocity=8e-4,maxVelocity=.005}){if(this.resolution=resolution,this.numBoids=numBoids,this.minVelocity=minVelocity,this.maxVelocity=maxVelocity,this.wilson.resizeCanvas({width:this.resolution}),this.boids.length>this.numBoids)this.boids.splice(this.numBoids,this.boids.length-this.numBoids);else if(this.boids.length<this.numBoids)for(let i=this.boids.length;i<this.numBoids;i++){var s=this.minVelocity+Math.random()*(this.maxVelocity-this.minVelocity),t=2*Math.random()*Math.PI;this.boids.push({x:(Math.random()-.5)*this.wilson.worldWidth,y:(Math.random()-.5)*this.wilson.worldHeight,vx:Math.cos(t)*s,vy:Math.sin(t)*s})}this.resume()}drawFrame(){this.updateBoids(),this.wilson.ctx.fillStyle="rgb(0, 0, 0)",this.wilson.ctx.fillRect(0,0,this.resolution,this.resolution);for(let a=0;a<this.numBoids;a++){var i=this.boids[a],s=i.x,t=i.y,o=Math.atan2(i.vy,i.vx),i=Math.sqrt(i.vx*i.vx+i.vy*i.vy),i=hsvToRgb(o/(2*Math.PI)+.5,i/this.maxVelocity,1),i=(this.wilson.ctx.fillStyle=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,o+2*Math.PI/3),n=o+4*Math.PI/3,l=s+2*Math.cos(o)*this.boidSize,o=t+2*Math.sin(o)*this.boidSize,e=s+Math.cos(i)*this.boidSize,i=t+Math.sin(i)*this.boidSize,h=s+Math.cos(n)*this.boidSize,n=t+Math.sin(n)*this.boidSize;this.wilson.ctx.beginPath(),this.wilson.ctx.moveTo(...this.wilson.interpolateWorldToCanvas([l,o])),this.wilson.ctx.lineTo(...this.wilson.interpolateWorldToCanvas([e,i])),this.wilson.ctx.lineTo(...this.wilson.interpolateWorldToCanvas([s,t])),this.wilson.ctx.lineTo(...this.wilson.interpolateWorldToCanvas([h,n])),this.wilson.ctx.closePath(),this.wilson.ctx.fill()}this.needNewFrame=!0}updateBoids(){console.log(this.boids[0].vx,this.boids[0].vy);for(let s=0;s<this.numBoids;s++){var i=this.boids[s];i.x+=i.vx,i.y+=i.vy,i.x<-this.wilson.worldWidth/2?i.x+=this.wilson.worldWidth:i.x>this.wilson.worldWidth/2&&(i.x-=this.wilson.worldWidth),i.y<-this.wilson.worldHeight/2?i.y+=this.wilson.worldHeight:i.y>this.wilson.worldHeight/2&&(i.y-=this.wilson.worldHeight)}}}export{Boids};