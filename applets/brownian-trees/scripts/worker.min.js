"use strict";onmessage=async function(r){gridSize=r.data[0],await drawBrownianTree()};let gridSize=null,margin=null,brownianTreeGraph=[],color=[],currentBrightness=255,progressThreshhold=5,currentRow=null,currentCol=null,spawnRadius=null;const directions=[[-1,0],[0,1],[1,0],[0,-1]];function drawBrownianTree(){return new Promise(function(r,e){brownianTreeGraph=[],color=[];for(let o=0;o<gridSize;o++){brownianTreeGraph[o]=[],color[o]=[];for(let n=0;n<gridSize;n++)brownianTreeGraph[o][n]=0,color[o][n]=[0,0,0]}for(brownianTreeGraph[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=1,color[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=[255,255,255],postMessage([2,Math.floor(gridSize/2),Math.floor(gridSize/2),"rgb(255, 255, 255)"]),margin=10,spawnRadius=5;gridSize-2*spawnRadius>2*margin;){let i=2*Math.random()*Math.PI;for(currentRow=Math.floor(spawnRadius*Math.cos(i)+gridSize/2),currentCol=Math.floor(spawnRadius*Math.sin(i)+gridSize/2);;){let t=[];currentRow>gridSize/2-spawnRadius&&t.push(0),currentCol<gridSize/2+spawnRadius&&t.push(1),currentRow<gridSize/2+spawnRadius&&t.push(2),currentCol>gridSize/2-spawnRadius&&t.push(3);let s=t[Math.floor(Math.random()*t.length)],u=currentRow+directions[s][0],a=currentCol+directions[s][1];if(1===brownianTreeGraph[u][a]){brownianTreeGraph[currentRow][currentCol]=1;let c=(Math.atan2(currentCol-Math.floor(gridSize/2),Math.floor(gridSize/2)-currentRow)+Math.PI)/(2*Math.PI),l=HSVtoRGB(c,1,1);if(color[currentRow][currentCol]=[.9925*color[u][a][0]+.0075*l[0],.9925*color[u][a][1]+.0075*l[1],.9925*color[u][a][2]+.0075*l[2]],postMessage([2,currentCol,currentRow,`rgb(${currentBrightness/255*color[currentRow][currentCol][0]}, ${currentBrightness/255*color[currentRow][currentCol][1]}, ${currentBrightness/255*color[currentRow][currentCol][2]})`]),spawnRadius*spawnRadius-(currentRow-gridSize/2)*(currentRow-gridSize/2)-(currentCol-gridSize/2)*(currentCol-gridSize/2)<=5){currentBrightness=Math.floor(255*(gridSize/2-10-++spawnRadius)/(gridSize/2-10));let d=100*Math.pow((255-currentBrightness)/255,2.71);d>progressThreshhold&&(postMessage([0,progressThreshhold]),progressThreshhold+=5)}break}currentRow=u,currentCol=a}}postMessage([0,100]),setTimeout(()=>{postMessage([1])},500),r()})}function HSVtoRGB(r,e,o){let n,i,t,s,u,a,c,l;switch(s=Math.floor(6*r),u=6*r-s,a=o*(1-e),c=o*(1-u*e),l=o*(1-(1-u)*e),s%6){case 0:n=o,i=l,t=a;break;case 1:n=c,i=o,t=a;break;case 2:n=a,i=o,t=l;break;case 3:n=a,i=c,t=o;break;case 4:n=l,i=a,t=o;break;case 5:n=o,i=a,t=c}return[Math.round(255*n),Math.round(255*i),Math.round(255*t)]}