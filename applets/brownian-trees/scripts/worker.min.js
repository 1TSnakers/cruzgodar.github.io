"use strict";onmessage=async function(r){grid_size=r.data[0],await draw_brownian_tree()};let grid_size=null,margin=null,brownian_tree_graph=[],color=[],current_brightness=255,progress_threshhold=5,current_row=null,current_col=null,spawn_radius=null;const directions=[[-1,0],[0,1],[1,0],[0,-1]];function draw_brownian_tree(){return new Promise(function(r,e){brownian_tree_graph=[],color=[];for(let r=0;r<grid_size;r++){brownian_tree_graph[r]=[],color[r]=[];for(let e=0;e<grid_size;e++)brownian_tree_graph[r][e]=0,color[r][e]=[0,0,0]}for(brownian_tree_graph[Math.floor(grid_size/2)][Math.floor(grid_size/2)]=1,color[Math.floor(grid_size/2)][Math.floor(grid_size/2)]=[255,255,255],postMessage([Math.floor(grid_size/2),Math.floor(grid_size/2),"rgb(255, 255, 255)"]),margin=10,spawn_radius=5;grid_size-2*spawn_radius>2*margin;){let r=2*Math.random()*Math.PI;for(current_row=Math.floor(spawn_radius*Math.cos(r)+grid_size/2),current_col=Math.floor(spawn_radius*Math.sin(r)+grid_size/2);;){let r=[];current_row>grid_size/2-spawn_radius&&r.push(0),current_col<grid_size/2+spawn_radius&&r.push(1),current_row<grid_size/2+spawn_radius&&r.push(2),current_col>grid_size/2-spawn_radius&&r.push(3);let e=r[Math.floor(Math.random()*r.length)],o=current_row+directions[e][0],s=current_col+directions[e][1];if(1===brownian_tree_graph[o][s]){brownian_tree_graph[current_row][current_col]=1;let r=HSVtoRGB((Math.atan2(current_col-Math.floor(grid_size/2),Math.floor(grid_size/2)-current_row)+Math.PI)/(2*Math.PI),1,1);if(color[current_row][current_col]=[.9925*color[o][s][0]+.0075*r[0],.9925*color[o][s][1]+.0075*r[1],.9925*color[o][s][2]+.0075*r[2]],postMessage([current_col,current_row,`rgb(${current_brightness/255*color[current_row][current_col][0]}, ${current_brightness/255*color[current_row][current_col][1]}, ${current_brightness/255*color[current_row][current_col][2]})`]),spawn_radius*spawn_radius-(current_row-grid_size/2)*(current_row-grid_size/2)-(current_col-grid_size/2)*(current_col-grid_size/2)<=5){spawn_radius++,current_brightness=Math.floor(255*(grid_size/2-10-spawn_radius)/(grid_size/2-10)),100*Math.pow((255-current_brightness)/255,2.71)>progress_threshhold&&(postMessage(["progress",progress_threshhold]),progress_threshhold+=5)}break}current_row=o,current_col=s}}postMessage(["progress",100]),setTimeout(function(){postMessage(["done"])},500),r()})}function HSVtoRGB(r,e,o){let s,t,n,i,a,_,c,u;switch(_=o*(1-e),c=o*(1-(a=6*r-(i=Math.floor(6*r)))*e),u=o*(1-(1-a)*e),i%6){case 0:s=o,t=u,n=_;break;case 1:s=c,t=o,n=_;break;case 2:s=_,t=o,n=u;break;case 3:s=_,t=c,n=o;break;case 4:s=u,t=_,n=o;break;case 5:s=o,t=_,n=c}return[Math.round(255*s),Math.round(255*t),Math.round(255*n)]}