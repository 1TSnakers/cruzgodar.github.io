"use strict";let gridSize=null,margin=null,brownianTreeGraph=[],color=[],currentBrightness=255,progressThreshhold=5,currentRow=null,currentCol=null,spawnRadius=null;const directions=[[-1,0],[0,1],[1,0],[0,-1]];function drawBrownianTree(){brownianTreeGraph=[],color=[];for(let e=0;e<gridSize;e++){brownianTreeGraph[e]=[],color[e]=[];for(let r=0;r<gridSize;r++)brownianTreeGraph[e][r]=0,color[e][r]=[0,0,0]}for(brownianTreeGraph[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=1,color[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=[255,255,255],postMessage([2,Math.floor(gridSize/2),Math.floor(gridSize/2),"rgb(255, 255, 255)"]),margin=10,spawnRadius=5;gridSize-2*spawnRadius>2*margin;){var r=2*Math.random()*Math.PI;for(currentRow=Math.floor(spawnRadius*Math.cos(r)+gridSize/2),currentCol=Math.floor(spawnRadius*Math.sin(r)+gridSize/2);;){var e=[],e=(currentRow>gridSize/2-spawnRadius&&e.push(0),currentCol<gridSize/2+spawnRadius&&e.push(1),currentRow<gridSize/2+spawnRadius&&e.push(2),currentCol>gridSize/2-spawnRadius&&e.push(3),e[Math.floor(Math.random()*e.length)]),o=currentRow+directions[e][0],e=currentCol+directions[e][1];if(1===brownianTreeGraph[o][e]){brownianTreeGraph[currentRow][currentCol]=1;var a=HSVtoRGB((Math.atan2(currentCol-Math.floor(gridSize/2),Math.floor(gridSize/2)-currentRow)+Math.PI)/(2*Math.PI),1,1);color[currentRow][currentCol]=[.9925*color[o][e][0]+.0075*a[0],.9925*color[o][e][1]+.0075*a[1],.9925*color[o][e][2]+.0075*a[2]],postMessage([2,currentCol,currentRow,`rgb(${currentBrightness/255*color[currentRow][currentCol][0]}, ${currentBrightness/255*color[currentRow][currentCol][1]}, ${currentBrightness/255*color[currentRow][currentCol][2]})`]),spawnRadius*spawnRadius-(currentRow-gridSize/2)*(currentRow-gridSize/2)-(currentCol-gridSize/2)*(currentCol-gridSize/2)<=5&&(spawnRadius++,currentBrightness=Math.floor(255*(gridSize/2-10-spawnRadius)/(gridSize/2-10)),100*Math.pow((255-currentBrightness)/255,2.71)>progressThreshhold)&&(postMessage([0,progressThreshhold]),progressThreshhold+=5);break}currentRow=o,currentCol=e}}postMessage([0,100]),setTimeout(()=>{postMessage([1])},500)}function HSVtoRGB(r,e,o){let a,n,i;var t=Math.floor(6*r),r=6*r-t,s=o*(1-e),u=o*(1-r*e),c=o*(1-(1-r)*e);switch(t%6){case 0:a=o,n=c,i=s;break;case 1:a=u,n=o,i=s;break;case 2:a=s,n=o,i=c;break;case 3:a=s,n=u,i=o;break;case 4:a=c,n=s,i=o;break;case 5:a=o,n=s,i=u}return[Math.round(255*a),Math.round(255*n),Math.round(255*i)]}onmessage=r=>{gridSize=r.data[0],drawBrownianTree()};