"use strict";onmessage=async function(r){gridSize=r.data[0],await drawBrownianTree()};let gridSize=null,margin=null,brownianTreeGraph=[],color=[],currentBrightness=255,progressThreshhold=5,currentRow=null,currentCol=null,spawnRadius=null;const directions=[[-1,0],[0,1],[1,0],[0,-1]];function drawBrownianTree(){return new Promise(function(r,e){brownianTreeGraph=[],color=[];for(let e=0;e<gridSize;e++){brownianTreeGraph[e]=[],color[e]=[];for(let r=0;r<gridSize;r++)brownianTreeGraph[e][r]=0,color[e][r]=[0,0,0]}for(brownianTreeGraph[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=1,color[Math.floor(gridSize/2)][Math.floor(gridSize/2)]=[255,255,255],postMessage([2,Math.floor(gridSize/2),Math.floor(gridSize/2),"rgb(255, 255, 255)"]),margin=10,spawnRadius=5;gridSize-2*spawnRadius>2*margin;){var o=2*Math.random()*Math.PI;for(currentRow=Math.floor(spawnRadius*Math.cos(o)+gridSize/2),currentCol=Math.floor(spawnRadius*Math.sin(o)+gridSize/2);;){var n=[],n=(currentRow>gridSize/2-spawnRadius&&n.push(0),currentCol<gridSize/2+spawnRadius&&n.push(1),currentRow<gridSize/2+spawnRadius&&n.push(2),currentCol>gridSize/2-spawnRadius&&n.push(3),n[Math.floor(Math.random()*n.length)]),a=currentRow+directions[n][0],n=currentCol+directions[n][1];if(1===brownianTreeGraph[a][n]){brownianTreeGraph[currentRow][currentCol]=1;var i=HSVtoRGB((Math.atan2(currentCol-Math.floor(gridSize/2),Math.floor(gridSize/2)-currentRow)+Math.PI)/(2*Math.PI),1,1);color[currentRow][currentCol]=[.9925*color[a][n][0]+.0075*i[0],.9925*color[a][n][1]+.0075*i[1],.9925*color[a][n][2]+.0075*i[2]],postMessage([2,currentCol,currentRow,`rgb(${currentBrightness/255*color[currentRow][currentCol][0]}, ${currentBrightness/255*color[currentRow][currentCol][1]}, ${currentBrightness/255*color[currentRow][currentCol][2]})`]),spawnRadius*spawnRadius-(currentRow-gridSize/2)*(currentRow-gridSize/2)-(currentCol-gridSize/2)*(currentCol-gridSize/2)<=5&&(spawnRadius++,currentBrightness=Math.floor(255*(gridSize/2-10-spawnRadius)/(gridSize/2-10)),100*Math.pow((255-currentBrightness)/255,2.71)>progressThreshhold)&&(postMessage([0,progressThreshhold]),progressThreshhold+=5);break}currentRow=a,currentCol=n}}postMessage([0,100]),setTimeout(()=>{postMessage([1])},500),r()})}function HSVtoRGB(r,e,o){let n,a,i,t,s,u,c,l;switch(u=o*(1-e),c=o*(1-(s=6*r-(t=Math.floor(6*r)))*e),l=o*(1-(1-s)*e),t%6){case 0:n=o,a=l,i=u;break;case 1:n=c,a=o,i=u;break;case 2:n=u,a=o,i=l;break;case 3:n=u,a=c,i=o;break;case 4:n=l,a=u,i=o;break;case 5:n=o,a=u,i=c}return[Math.round(255*n),Math.round(255*a),Math.round(255*i)]}