"use strict";class SortingAlgorithm extends Applet{resolution=2e3;dataLength=null;data=[];brightness=[];maxBrightness=40;currentGenerator=null;minFrequency=30;maxFrequency=600;doPlaySound=!0;lastTimestamp=-1;timeElapsed=0;algorithms={bubble:this.bubbleSort,insertion:this.insertionSort,selection:this.selectionSort,heap:this.heapsort,merge:this.mergeSort,quick:this.quicksort,shell:this.shellsort,patience:this.patienceSort,cycle:this.cycleSort,"msd-radix":this.msdRadixSort,"lsd-radix":this.lsdRadixSort,gravity:this.gravitySort};generators=[this.shuffleArray,null,this.verifyArray];currentGeneratorIndex=0;numReads=0;numWrites=0;inFrameOperations=0;operationsPerFrame=1;updateReadsAndWrites=!1;numReadsElement=null;numWritesElement=null;changingSound=!1;audioNodes=[];constructor(t,i,e){super(t),this.numReadsElement=i,this.numWritesElement=e;let s=`
   precision highp float;
   
   varying vec2 uv;
   
   uniform float dataLength;
   
   const float circleSize = .8;
   
   uniform sampler2D uTexture;
   
   
   
   vec3 hsv2rgb(vec3 c)
   {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
   }
   
   
   
   void main(void)
   {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    
    if (length(uv) <= circleSize)
    {
     float sample = mod(atan(uv.y, uv.x) / 6.283, 1.0);
     
     vec4 output1 = texture2D(uTexture, vec2(floor(sample * dataLength) / dataLength, .5));
     vec4 output2 = texture2D(uTexture, vec2(mod(floor(sample * dataLength + 1.0) / dataLength, 1.0), .5));
     
     float brightness = mix(output1.z, output2.z, fract(sample * dataLength));
     
     float h1 = (output1.x * 256.0 + output1.y) / dataLength * 255.0;
     float h2 = (output2.x * 256.0 + output2.y) / dataLength * 255.0;
     
     if (abs(h1 - h2) > .5)
     {
      if (h1 > h2)
      {
       h1 -= 1.0;
      }
      
      else
      {
       h2 -= 1.0;
      }
     }
     
     
     
     float h = mix(h1, h2, fract(sample * dataLength));
     
     float s = clamp((length(uv) / circleSize - .03) * (1.0 - brightness), 0.0, 1.0);
     
     float v = clamp((1.0 - length(uv) / circleSize) * 100.0, 0.0, 1.0);
     
     gl_FragColor = vec4(hsv2rgb(vec3(h, s, v)), 1.0);
    }
   }
  `,a={renderer:"gpu",shader:s,canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson($("#output-canvas"),a),this.wilson.render.initUniforms(["dataLength"]);let h=this.wilson.gl.createTexture();this.wilson.gl.bindTexture(this.wilson.gl.TEXTURE_2D,h),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MAG_FILTER,this.wilson.gl.NEAREST),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MIN_FILTER,this.wilson.gl.NEAREST),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_S,this.wilson.gl.CLAMP_TO_EDGE),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_T,this.wilson.gl.CLAMP_TO_EDGE),this.wilson.gl.disable(this.wilson.gl.DEPTH_TEST)}run(t,i,e,s){this.resolution=t,this.generators=[this.shuffleArray.bind(this),this.algorithms[i].bind(this),this.verifyArray.bind(this)],this.currentGeneratorIndex=0;let a=this.dataLength;this.dataLength=e,this.doPlaySound=s;try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}catch(h){}if(this.wilson.changeCanvasSize(this.resolution,this.resolution),this.dataLength!==a){this.data=Array(this.dataLength),this.brightness=Array(this.dataLength);for(let o=0;o<this.dataLength;o++)this.data[o]=o,this.brightness[o]=0;this.wilson.gl.uniform1f(this.wilson.uniforms.dataLength,this.dataLength)}this.numReads=0,this.numWrites=0,this.inFrameOperations=0,this.updateReadsAndWrites=!1;try{this.numReadsElement.textContent="0",this.numWritesElement.textContent="0"}catch(r){}this.audioNodes=[],this.createAudioNodes(),this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0),this.currentGenerator=this.generators[0](),window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(t){if(this.timeElapsed=t-this.lastTimestamp,this.lastTimestamp=t,0===this.timeElapsed)return;let i=new Uint8Array(4*this.dataLength);for(let e=0;e<this.dataLength;e++)i[4*e]=Math.floor(this.data[e]/256),i[4*e+1]=this.data[e]%256,i[4*e+2]=Math.floor(this.brightness[e]/this.maxBrightness*256);if(this.wilson.gl.texImage2D(this.wilson.gl.TEXTURE_2D,0,this.wilson.gl.RGBA,this.dataLength,1,0,this.wilson.gl.RGBA,this.wilson.gl.UNSIGNED_BYTE,i),this.wilson.render.drawFrame(),this.decreaseBrightness(),this.updateReadsAndWrites)try{this.numReadsElement.textContent=this.numReads,this.numWritesElement.textContent=this.numWrites}catch(s){}if(this.changingSound||this.currentGenerator.next(),this.animationPaused)try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}catch(a){}else window.requestAnimationFrame(this.drawFrame.bind(this))}createAudioNodes(){if(this.doPlaySound)for(let t=0;t<this.generators.length;t++){let i=new AudioContext,e=i.createOscillator();e.type="sine",e.frequency.value=50;let s=i.createGain();e.connect(s),s.connect(i.destination),this.audioNodes.push([i,e,s])}}readFromPosition(){this.numReads++}writeToPosition(t,i=!0,e=!0){return i&&(this.brightness[t]=this.maxBrightness-1),this.numWrites++,this.inFrameOperations++,this.inFrameOperations>=this.operationsPerFrame&&(this.inFrameOperations=0,e&&this.playSound(t),!0)}playSound(t){this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].frequency.linearRampToValueAtTime((this.maxFrequency-this.minFrequency)*this.data[t]/this.dataLength+this.minFrequency,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}decreaseBrightness(){for(let t=0;t<this.dataLength;t++)this.brightness[t]=Math.max(this.brightness[t]-1,0)}advanceGenerator(){this.changingSound=!0,this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3),this.currentGeneratorIndex++,this.currentGeneratorIndex<this.generators.length&&setTimeout(()=>{this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0),this.currentGenerator=this.generators[this.currentGeneratorIndex](),this.changingSound=!1},1e3)}*shuffleArray(){this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let t=0;t<this.dataLength-1;t++){let i=Math.floor(Math.random()*(this.dataLength-t-1))+t,e=this.data[t];this.data[t]=this.data[i],this.data[i]=e,this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield)}this.numReads=0,this.numWrites=0,this.updateReadsAndWrites=!0,this.advanceGenerator()}*verifyArray(){this.updateReadsAndWrites=!1,this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let t=0;t<this.dataLength;t++)this.writeToPosition(t)&&(yield);this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}*bubbleSort(){for(this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/2500);;){let t=!0;for(let i=0;i<this.dataLength-1;i++)if(this.readFromPosition(i),this.readFromPosition(i+1),this.data[i]>this.data[i+1]){t=!1;let e=this.data[i];this.data[i]=this.data[i+1],this.data[i+1]=e,this.writeToPosition(i)&&(yield),this.writeToPosition(i+1)&&(yield)}if(t)break}this.advanceGenerator()}*insertionSort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/5e3);for(let t=1;t<this.dataLength;t++)if(this.readFromPosition(t),this.readFromPosition(t-1),this.data[t]<this.data[t-1]){for(let i=0;i<t;i++)if(this.readFromPosition(i),this.readFromPosition(t),this.data[i]>this.data[t]){let e=this.data[t];for(let s=t;s>i;s--)this.data[s]=this.data[s-1],this.writeToPosition(s)&&(yield);this.data[i]=e,this.writeToPosition(i)&&(yield)}}this.advanceGenerator()}*selectionSort(){this.operationsPerFrame=Math.ceil(this.dataLength/1e3);for(let t=0;t<this.dataLength;t++){let i=-1,e=this.dataLength;for(let s=t;s<this.dataLength;s++)this.readFromPosition(s),this.readFromPosition(e),this.data[s]<e&&(e=this.data[s],i=s);let a=this.data[t];this.data[t]=e,this.data[i]=a,this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield)}this.advanceGenerator()}*heapsort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/500);for(let t=1;t<this.dataLength;t++){let i=t,e=0;for(;0!==i;)if(e=Math.floor((i-1)/2),this.readFromPosition(i),this.readFromPosition(e),this.data[i]>this.data[e]){let s=this.data[i];this.data[i]=this.data[e],this.data[e]=s,this.writeToPosition(i)&&(yield),this.writeToPosition(e)&&(yield),i=e}else break}for(let a=this.dataLength-1;a>=0;a--){let h=this.data[0];this.data[0]=this.data[a],this.data[a]=h,this.writeToPosition(0)&&(yield),this.writeToPosition(a)&&(yield);let o=0,r=0,n=0,d=0;for(;n=(r=2*o+1)+1,!(r>=a);)if(n>=a?d=r:(this.readFromPosition(r),this.readFromPosition(n),d=this.data[r]>this.data[n]?r:n),this.readFromPosition(o),this.readFromPosition(d),this.data[o]<this.data[d]){let l=this.data[o];this.data[o]=this.data[d],this.data[d]=l,this.writeToPosition(o)&&(yield),this.writeToPosition(d)&&(yield),o=d}else break}this.advanceGenerator()}*mergeSort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/450);let t=Array(this.dataLength),i=1;for(;;){for(let e=0;e<this.dataLength;e+=2*i){let s=0,a=i,h=0;for(;;)if(a+e>=this.dataLength||a>=2*i){if(s>=i||e+s>=this.dataLength)break;t[h]=this.data[e+s],this.writeToPosition(e+s)&&(yield),s++,h++}else s>=i||e+s>=this.dataLength?(t[h]=this.data[e+a],this.writeToPosition(e+a)&&(yield),a++,h++):(this.readFromPosition(e+s),this.readFromPosition(e+a),this.data[e+s]<this.data[e+a]?(t[h]=this.data[e+s],this.writeToPosition(e+s)&&(yield),s++,h++):(t[h]=this.data[e+a],this.writeToPosition(e+a)&&(yield),a++,h++));for(let o=0;o<2*i&&!(e+o>=this.dataLength);o++)this.data[e+o]=t[o],this.writeToPosition(e+o)&&(yield)}if((i*=2)>=this.dataLength)break}this.advanceGenerator()}*quicksort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/2250);let t=Array(this.dataLength);t[0]=0,t[1]=this.dataLength-1;let i=Array(this.dataLength),e=1,s=0;for(;e>0;){for(let a=0;a<e;a++){let h=this.data[Math.floor((t[2*a]+t[2*a+1])/2)];this.readFromPosition(Math.floor((t[2*a]+t[2*a+1])/2));let o=t[2*a]-1,r=t[2*a+1]+1;for(;;){do o++,this.readFromPosition(o);while(this.data[o]<h);this.readFromPosition(o);do r--,this.readFromPosition(r);while(this.data[r]>h);if(this.readFromPosition(r),o>=r)break;let n=this.data[o];this.data[o]=this.data[r],this.data[r]=n,this.writeToPosition(o)&&(yield),this.writeToPosition(r)&&(yield)}r>t[2*a]&&(i[2*s]=t[2*a],i[2*s+1]=r,s++),t[2*a+1]>r+1&&(i[2*s]=r+1,i[2*s+1]=t[2*a+1],s++)}e=s,s=0;for(let d=0;d<2*e;d++)t[d]=i[d]}this.advanceGenerator()}*shellsort(){this.operationsPerFrame=Math.ceil(this.dataLength/100);let t=[],i=2.2436091,e=1;for(;;){let s=Math.ceil((Math.pow(i,e)-1)/(i-1));if(s>=this.dataLength)break;t.unshift(s),e++}for(let a=0;a<t.length;a++){let h=t[a];for(let o=h;o<this.dataLength;o++){let r=this.data[o];this.readFromPosition(o);let n=o;for(;n>=h&&this.data[n-h]>r;n-=h)this.data[n]=this.data[n-h],this.writeToPosition(n)&&(yield);this.data[n]=r,this.writeToPosition(n)&&(yield)}}this.advanceGenerator()}*patienceSort(){this.operationsPerFrame=Math.ceil(this.dataLength/1e3);let t=[[this.data[0]]];for(let i=1;i<this.dataLength;i++){let e=!1;this.readFromPosition(i);for(let s=0;s<t.length;s++)if(t[s][t[s].length-1]>=this.data[i]){t[s].push(this.data[i]),e=!0;break}e||t.push([this.data[i]]),this.writeToPosition(i)&&(yield)}for(let a=0;a<this.dataLength;a++){let h=0,o=1/0;this.readFromPosition(a);for(let r=0;r<t.length;r++)t[r][t[r].length-1]<o&&(h=r,o=t[r][t[r].length-1]);this.data[a]=t[h].pop(),this.writeToPosition(a)&&(yield)}this.advanceGenerator()}*cycleSort(){this.operationsPerFrame=Math.ceil(this.dataLength/2e3);let t=Array(this.dataLength);for(let i=0;i<this.dataLength;i++)t[i]=!1;for(let e=0;e<this.dataLength;e++){if(t[e])continue;this.readFromPosition(e);let s=this.data[e],a=s,h=0;do{h=0;for(let o=0;o<this.dataLength;o++)this.readFromPosition(o),this.data[o]<s&&h++;s>a&&h--;let r=this.data[h];this.data[h]=s,s=r,this.writeToPosition(h)&&(yield),t[h]=!0}while(h!==e)}this.advanceGenerator()}*msdRadixSort(){let t=0,i=1/Math.log(2);for(let e=0;e<this.dataLength;e++){this.readFromPosition(e);t=Math.max(t,Math.log(this.data[e])*i)}t=Math.round(t),this.operationsPerFrame=Math.ceil(this.dataLength*t/650);let s=Array(this.dataLength);s[0]=0,s[1]=this.dataLength-1;let a=Array(this.dataLength),h=1,o=0,r=Array(this.dataLength),n=Math.pow(2,t-1);for(let d=0;d<t;d++){for(let l=0;l<h;l++){let g=s[2*l],u=s[2*l+1];for(let m=s[2*l];m<=s[2*l+1];m++){this.readFromPosition(m);0==Math.floor(this.data[m]/n)%2?(r[g]=this.data[m],this.writeToPosition(g)&&(yield),g++):(r[u]=this.data[m],this.writeToPosition(u)&&(yield),u--)}for(let c=s[2*l];c<=s[2*l+1];c++)this.data[c]=r[c],this.writeToPosition(c)&&(yield);g--,u++,g>s[2*l]&&(a[2*o]=s[2*l],a[2*o+1]=g,o++),s[2*l+1]>u&&(a[2*o]=u,a[2*o+1]=s[2*l+1],o++)}h=o,o=0;for(let _=0;_<2*h;_++)s[_]=a[_];n/=2}this.advanceGenerator()}*lsdRadixSort(){let t=0,i=1/Math.log(2);for(let e=0;e<this.dataLength;e++){this.readFromPosition(e);t=Math.max(t,Math.log(this.data[e])*i)}t=Math.round(t),this.operationsPerFrame=Math.ceil(this.dataLength*t/650);let s=Array(this.dataLength),a=1;for(let h=0;h<t;h++){let o=0,r=this.dataLength-1;for(let n=0;n<this.dataLength;n++){this.readFromPosition(n);0==Math.floor(this.data[n]/a)%2?(s[o]=this.data[n],this.writeToPosition(o)&&(yield),o++):(s[r]=this.data[n],this.writeToPosition(r)&&(yield),r--)}o--,r++;for(let d=0;d<=o;d++)this.data[d]=s[d],this.writeToPosition(d)&&(yield);for(let l=0;l<this.dataLength-r;l++)this.data[r+l]=s[this.dataLength-1-l],this.writeToPosition(r+l)&&(yield);a*=2}this.advanceGenerator()}*gravitySort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/1e6);let t=Array(this.dataLength);for(let i=0;i<this.dataLength;i++){t[i]=Array(this.dataLength);for(let e=0;e<this.dataLength;e++)t[i][e]=!1}let s=0,a=0;for(let h=0;h<this.dataLength;h++){this.readFromPosition(h);let o=this.data[h];for(let r=0;r<o;r++)t[h][r]=!0;o-h>a&&(a=o-h,s=h)}for(let n=0;n<this.dataLength;n++){for(let d=this.dataLength-1;d>=0;d--)if(t[d][n]){let l=d;do l++;while(l<this.dataLength&&!t[l][n]);l--,t[d][n]=!1,t[l][n]=!0,this.data[d]--,this.data[l]++,this.writeToPosition(d,!1,!1),this.writeToPosition(l,!1,!1)}this.writeToPosition(s,!1,!0)&&(yield),this.numWrites--,this.inFrameOperations--}this.advanceGenerator()}}