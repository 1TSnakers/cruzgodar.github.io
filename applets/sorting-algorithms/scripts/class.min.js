class SortingAlgorithm extends Applet{resolution=2E3;dataLength=null;data=[];brightness=[];maxBrightness=40;currentGenerator=null;minFrequency=30;maxFrequency=600;doPlaySound=!0;lastTimestamp=-1;timeElapsed=0;algorithms={bubble:this.bubbleSort,insertion:this.insertionSort,selection:this.selectionSort,heap:this.heapsort,merge:this.mergeSort,quick:this.quicksort,shell:this.shellsort,cycle:this.cycleSort,"msd-radix":this.msdRadixSort,"lsd-radix":this.lsdRadixSort,gravity:this.gravitySort};generators=[this.shuffleArray,
null,this.verifyArray];currentGeneratorIndex=0;numReads=0;numWrites=0;inFrameOperations=0;operationsPerFrame=1;updateReadsAndWrites=!1;numReadsElement=null;numWritesElement=null;changingSound=!1;audioNodes=[];constructor(a,b,c){super(a);this.numReadsElement=b;this.numWritesElement=c;a={renderer:"gpu",shader:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tvarying vec2 uv;\n\t\t\t\n\t\t\tuniform float dataLength;\n\t\t\t\n\t\t\tconst float circleSize = .8;\n\t\t\t\n\t\t\tuniform sampler2D uTexture;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvec3 hsv2rgb(vec3 c)\n\t\t\t{\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tvoid main(void)\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\tif (length(uv) <= circleSize)\n\t\t\t\t{\n\t\t\t\t\tfloat sample = mod(atan(uv.y, uv.x) / 6.283, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tvec4 output1 = texture2D(uTexture, vec2(floor(sample * dataLength) / dataLength, .5));\n\t\t\t\t\tvec4 output2 = texture2D(uTexture, vec2(mod(floor(sample * dataLength + 1.0) / dataLength, 1.0), .5));\n\t\t\t\t\t\n\t\t\t\t\tfloat brightness = mix(output1.z, output2.z, fract(sample * dataLength));\n\t\t\t\t\t\n\t\t\t\t\tfloat h1 = (output1.x * 256.0 + output1.y) / dataLength * 255.0;\n\t\t\t\t\tfloat h2 = (output2.x * 256.0 + output2.y) / dataLength * 255.0;\n\t\t\t\t\t\n\t\t\t\t\tif (abs(h1 - h2) > .5)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (h1 > h2)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\th1 -= 1.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\th2 -= 1.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tfloat h = mix(h1, h2, fract(sample * dataLength));\n\t\t\t\t\t\n\t\t\t\t\tfloat s = clamp((length(uv) / circleSize - .03) * (1.0 - brightness), 0.0, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tfloat v = clamp((1.0 - length(uv) / circleSize) * 100.0, 0.0, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(hsv2rgb(vec3(h, s, v)), 1.0);\n\t\t\t\t}\n\t\t\t}\n\t\t",
canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"};this.wilson=new Wilson($("#output-canvas"),a);this.wilson.render.initUniforms(["dataLength"]);a=this.wilson.gl.createTexture();this.wilson.gl.bindTexture(this.wilson.gl.TEXTURE_2D,a);this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MAG_FILTER,
this.wilson.gl.NEAREST);this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MIN_FILTER,this.wilson.gl.NEAREST);this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_S,this.wilson.gl.CLAMP_TO_EDGE);this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_T,this.wilson.gl.CLAMP_TO_EDGE);this.wilson.gl.disable(this.wilson.gl.DEPTH_TEST)}run(a,b,c,d){this.resolution=a;this.generators=[this.shuffleArray.bind(this),this.algorithms[b].bind(this),
this.verifyArray.bind(this)];this.currentGeneratorIndex=0;a=this.dataLength;this.dataLength=c;this.doPlaySound=d;try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1E-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1E3)}catch(e){}this.wilson.changeCanvasSize(this.resolution,this.resolution);if(this.dataLength!==a){this.data=Array(this.dataLength);this.brightness=Array(this.dataLength);for(c=0;c<this.dataLength;c++)this.data[c]=c,this.brightness[c]=
0;this.wilson.gl.uniform1f(this.wilson.uniforms.dataLength,this.dataLength)}this.inFrameOperations=this.numWrites=this.numReads=0;this.updateReadsAndWrites=!1;try{this.numReadsElement.textContent="0",this.numWritesElement.textContent="0"}catch(e){}this.audioNodes=[];this.createAudioNodes();this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0);this.currentGenerator=this.generators[0]();window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(a){this.timeElapsed=a-this.lastTimestamp;
this.lastTimestamp=a;if(0!==this.timeElapsed){a=new Uint8Array(4*this.dataLength);for(let b=0;b<this.dataLength;b++)a[4*b]=Math.floor(this.data[b]/256),a[4*b+1]=this.data[b]%256,a[4*b+2]=Math.floor(this.brightness[b]/this.maxBrightness*256);this.wilson.gl.texImage2D(this.wilson.gl.TEXTURE_2D,0,this.wilson.gl.RGBA,this.dataLength,1,0,this.wilson.gl.RGBA,this.wilson.gl.UNSIGNED_BYTE,a);this.wilson.render.drawFrame();this.decreaseBrightness();if(this.updateReadsAndWrites)try{this.numReadsElement.textContent=
this.numReads,this.numWritesElement.textContent=this.numWrites}catch(b){}this.changingSound||this.currentGenerator.next();if(this.animationPaused)try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1E-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1E3)}catch(b){}else window.requestAnimationFrame(this.drawFrame.bind(this))}}createAudioNodes(){if(this.doPlaySound)for(let a=0;a<this.generators.length;a++){const b=new AudioContext,c=b.createOscillator();
c.type="sine";c.frequency.value=50;const d=b.createGain();c.connect(d);d.connect(b.destination);this.audioNodes.push([b,c,d])}}readFromPosition(){this.numReads++}writeToPosition(a,b=!0,c=!0){b&&(this.brightness[a]=this.maxBrightness-1);this.numWrites++;this.inFrameOperations++;return this.inFrameOperations>=this.operationsPerFrame?(this.inFrameOperations=0,c&&this.playSound(a),!0):!1}playSound(a){this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].frequency.linearRampToValueAtTime((this.maxFrequency-
this.minFrequency)*this.data[a]/this.dataLength+this.minFrequency,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1E3)}decreaseBrightness(){for(let a=0;a<this.dataLength;a++)this.brightness[a]=Math.max(this.brightness[a]-1,0)}advanceGenerator(){this.changingSound=!0;this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1E-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1E3);this.currentGeneratorIndex++;
this.currentGeneratorIndex<this.generators.length&&setTimeout(()=>{this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0);this.currentGenerator=this.generators[this.currentGeneratorIndex]();this.changingSound=!1},1E3)}*shuffleArray(){this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let a=0;a<this.dataLength-1;a++){let b=Math.floor(Math.random()*(this.dataLength-a-1))+a,c=this.data[a];this.data[a]=this.data[b];this.data[b]=c;this.writeToPosition(a)&&(yield);this.writeToPosition(b)&&
(yield)}this.numWrites=this.numReads=0;this.updateReadsAndWrites=!0;this.advanceGenerator()}*verifyArray(){this.updateReadsAndWrites=!1;this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let a=0;a<this.dataLength;a++)this.writeToPosition(a)&&(yield),a!==this.dataLength-1&&this.data[a]>this.data[a+1]&&console.log("Not sorted!",this.data);this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1E-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+
this.timeElapsed/1E3)}*bubbleSort(){for(this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/2500);;){let a=!0;for(let b=0;b<this.dataLength-1;b++)if(this.readFromPosition(b),this.readFromPosition(b+1),this.data[b]>this.data[b+1]){a=!1;let c=this.data[b];this.data[b]=this.data[b+1];this.data[b+1]=c;this.writeToPosition(b)&&(yield);this.writeToPosition(b+1)&&(yield)}if(a)break}this.advanceGenerator()}*insertionSort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/5E3);
for(let a=1;a<this.dataLength;a++)if(this.readFromPosition(a),this.readFromPosition(a-1),this.data[a]<this.data[a-1])for(let b=0;b<a;b++)if(this.readFromPosition(b),this.readFromPosition(a),this.data[b]>this.data[a]){let c=this.data[a];for(let d=a;d>b;d--)this.data[d]=this.data[d-1],this.writeToPosition(d)&&(yield);this.data[b]=c;this.writeToPosition(b)&&(yield)}this.advanceGenerator()}*selectionSort(){this.operationsPerFrame=Math.ceil(this.dataLength/1E3);for(let b=0;b<this.dataLength;b++){let c=
-1,d=this.dataLength;for(var a=b;a<this.dataLength;a++)this.readFromPosition(a),this.readFromPosition(d),this.data[a]<d&&(d=this.data[a],c=a);a=this.data[b];this.data[b]=d;this.data[c]=a;this.writeToPosition(b)&&(yield);this.writeToPosition(c)&&(yield)}this.advanceGenerator()}*heapsort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/500);for(var a=1;a<this.dataLength;a++)for(var b=a,c=void 0;0!==b;)if(c=Math.floor((b-1)/2),this.readFromPosition(b),this.readFromPosition(c),
this.data[b]>this.data[c]){var d=this.data[b];this.data[b]=this.data[c];this.data[c]=d;this.writeToPosition(b)&&(yield);this.writeToPosition(c)&&(yield);b=c}else break;for(a=this.dataLength-1;0<=a;a--)for(b=this.data[0],this.data[0]=this.data[a],this.data[a]=b,this.writeToPosition(0)&&(yield),this.writeToPosition(a)&&(yield),b=0;;){c=2*b+1;d=c+1;if(c>=a)break;else d>=a||(this.readFromPosition(c),this.readFromPosition(d),c=this.data[c]>this.data[d]?c:d);this.readFromPosition(b);this.readFromPosition(c);
if(this.data[b]<this.data[c])d=this.data[b],this.data[b]=this.data[c],this.data[c]=d,this.writeToPosition(b)&&(yield),this.writeToPosition(c)&&(yield),b=c;else break}this.advanceGenerator()}*mergeSort(a=0,b=this.dataLength){if(2===b-a){if(this.readFromPosition(a),this.readFromPosition(b-1),this.data[a]>this.data[b-1]){this.writeToPosition(a)&&(yield);this.writeToPosition(b-1)&&(yield);var c=this.data[a];this.data[a]=this.data[b-1];this.data[b-1]=c}}else if(!(1>=b-a)){this.operationsPerFrame=Math.ceil(this.dataLength*
Math.log(this.dataLength)/200);c=a+Math.floor((b-a)/2);for(yield*this.mergeSort(c,b);;){if(c===a+1){for(c=a;c<b-1&&this.data[c]>this.data[c+1];){this.readFromPosition(c);this.readFromPosition(c+1);this.writeToPosition(c)&&(yield);this.writeToPosition(c+1)&&(yield);var d=this.data[c];this.data[c]=this.data[c+1];this.data[c+1]=d;c++}break}d=a+Math.floor((c-a)/2);yield*this.mergeSort(a,d);var e=a;let h=d,f=c;for(;h!==f;)if(h!==e&&(f===b||this.data[e]<this.data[f])){this.readFromPosition(e);this.readFromPosition(h);
this.writeToPosition(e)&&(yield);this.writeToPosition(h)&&(yield);var g=this.data[e];this.data[e]=this.data[h];this.data[h]=g;e++;h++}else if(f<b&&this.data[f]<=this.data[e])this.readFromPosition(f),this.readFromPosition(h),this.writeToPosition(f)&&(yield),this.writeToPosition(h)&&(yield),g=this.data[f],this.data[f]=this.data[h],this.data[h]=g,f++,h++;else break;c=a+(c-d);for(d=h-1;d>c&&this.data[d-1]>this.data[d];)this.readFromPosition(d),this.readFromPosition(d-1),this.writeToPosition(d)&&(yield),
this.writeToPosition(d-1)&&(yield),e=this.data[d],this.data[d]=this.data[d-1],this.data[d-1]=e,d--;for(;d<b-1&&this.data[d+1]<this.data[d];)this.readFromPosition(d),this.readFromPosition(d+1),this.writeToPosition(d)&&(yield),this.writeToPosition(d+1)&&(yield),e=this.data[d],this.data[d]=this.data[d+1],this.data[d+1]=e,d++;if(c===a)break}0===a&&b===this.dataLength&&this.advanceGenerator()}}*quicksort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/2250);let a=Array(this.dataLength);
a[0]=0;a[1]=this.dataLength-1;let b=Array(this.dataLength),c=1,d=0;for(;0<c;){for(var e=0;e<c;e++){let g=this.data[Math.floor((a[2*e]+a[2*e+1])/2)];this.readFromPosition(Math.floor((a[2*e]+a[2*e+1])/2));let h=a[2*e]-1,f=a[2*e+1]+1;for(;;){do h++,this.readFromPosition(h);while(this.data[h]<g);this.readFromPosition(h);do f--,this.readFromPosition(f);while(this.data[f]>g);this.readFromPosition(f);if(h>=f)break;let k=this.data[h];this.data[h]=this.data[f];this.data[f]=k;this.writeToPosition(h)&&(yield);
this.writeToPosition(f)&&(yield)}f>a[2*e]&&(b[2*d]=a[2*e],b[2*d+1]=f,d++);a[2*e+1]>f+1&&(b[2*d]=f+1,b[2*d+1]=a[2*e+1],d++)}c=d;d=0;for(e=0;e<2*c;e++)a[e]=b[e]}this.advanceGenerator()}*shellsort(){this.operationsPerFrame=Math.ceil(this.dataLength/100);let a=[];for(var b=1;;){var c=Math.ceil((Math.pow(2.2436091,b)-1)/1.2436091);if(c>=this.dataLength)break;a.unshift(c);b++}for(b=0;b<a.length;b++){c=a[b];for(let d=c;d<this.dataLength;d++){const e=this.data[d];this.readFromPosition(d);let g=d;for(;g>=
c&&this.data[g-c]>e;g-=c)this.data[g]=this.data[g-c],this.writeToPosition(g)&&(yield);this.data[g]=e;this.writeToPosition(g)&&(yield)}}this.advanceGenerator()}*cycleSort(){this.operationsPerFrame=Math.ceil(this.dataLength/2E3);let a=Array(this.dataLength);for(var b=0;b<this.dataLength;b++)a[b]=!1;for(b=0;b<this.dataLength;b++){if(a[b])continue;this.readFromPosition(b);let d=this.data[b],e=d,g;do{g=0;for(var c=0;c<this.dataLength;c++)this.readFromPosition(c),this.data[c]<d&&g++;d>e&&g--;c=this.data[g];
this.data[g]=d;d=c;this.writeToPosition(g)&&(yield);a[g]=!0}while(g!==b)}this.advanceGenerator()}*msdRadixSort(){let a=0;var b=1/Math.log(2);for(var c=0;c<this.dataLength;c++)this.readFromPosition(c),a=Math.max(a,Math.log(this.data[c])*b);a=Math.round(a);this.operationsPerFrame=Math.ceil(this.dataLength*a/650);b=Array(this.dataLength);b[0]=0;b[1]=this.dataLength-1;c=Array(this.dataLength);let d=1,e=0,g=Array(this.dataLength),h=Math.pow(2,a-1);for(let n=0;n<a;n++){for(var f=0;f<d;f++){let l=b[2*f],
m=b[2*f+1];for(var k=b[2*f];k<=b[2*f+1];k++)this.readFromPosition(k),0===Math.floor(this.data[k]/h)%2?(g[l]=this.data[k],this.writeToPosition(l)&&(yield),l++):(g[m]=this.data[k],this.writeToPosition(m)&&(yield),m--);for(k=b[2*f];k<=b[2*f+1];k++)this.data[k]=g[k],this.writeToPosition(k)&&(yield);l--;m++;l>b[2*f]&&(c[2*e]=b[2*f],c[2*e+1]=l,e++);b[2*f+1]>m&&(c[2*e]=m,c[2*e+1]=b[2*f+1],e++)}d=e;e=0;for(f=0;f<2*d;f++)b[f]=c[f];h/=2}this.advanceGenerator()}*lsdRadixSort(){let a=0;var b=1/Math.log(2);for(var c=
0;c<this.dataLength;c++)this.readFromPosition(c),a=Math.max(a,Math.log(this.data[c])*b);a=Math.round(a);this.operationsPerFrame=Math.ceil(this.dataLength*a/650);b=Array(this.dataLength);c=1;for(let g=0;g<a;g++){var d=0;let h=this.dataLength-1;for(var e=0;e<this.dataLength;e++)this.readFromPosition(e),0===Math.floor(this.data[e]/c)%2?(b[d]=this.data[e],this.writeToPosition(d)&&(yield),d++):(b[h]=this.data[e],this.writeToPosition(h)&&(yield),h--);d--;h++;for(e=0;e<=d;e++)this.data[e]=b[e],this.writeToPosition(e)&&
(yield);for(d=0;d<this.dataLength-h;d++)this.data[h+d]=b[this.dataLength-1-d],this.writeToPosition(h+d)&&(yield);c*=2}this.advanceGenerator()}*gravitySort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/1E6);let a=Array(this.dataLength);for(var b=0;b<this.dataLength;b++){a[b]=Array(this.dataLength);for(var c=0;c<this.dataLength;c++)a[b][c]=!1}c=b=0;for(var d=0;d<this.dataLength;d++){this.readFromPosition(d);var e=this.data[d];for(let g=0;g<e;g++)a[d][g]=!0;e-d>c&&(c=e-d,b=d)}for(c=
0;c<this.dataLength;c++){for(d=this.dataLength-1;0<=d;d--)if(a[d][c]){e=d;do e++;while(e<this.dataLength&&!a[e][c]);e--;a[d][c]=!1;a[e][c]=!0;this.data[d]--;this.data[e]++;this.writeToPosition(d,!1,!1);this.writeToPosition(e,!1,!1)}this.writeToPosition(b,!1,!0)&&(yield);this.numWrites--;this.inFrameOperations--}this.advanceGenerator()}};
