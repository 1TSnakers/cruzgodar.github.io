import{Applet}from"/scripts/src/applets.min.min.min.mjs";class SortingAlgorithm extends Applet{resolution=2e3;dataLength=null;data=[];brightness=[];maxBrightness=40;currentGenerator=null;minFrequency=30;maxFrequency=600;doPlaySound=!0;lastTimestamp=-1;timeElapsed=0;algorithms={bubble:this.bubbleSort,insertion:this.insertionSort,selection:this.selectionSort,heap:this.heapsort,merge:this.mergeSort,quick:this.quicksort,shell:this.shellsort,cycle:this.cycleSort,"msd-radix":this.msdRadixSort,"lsd-radix":this.lsdRadixSort,gravity:this.gravitySort};generators=[this.shuffleArray,null,this.verifyArray];currentGeneratorIndex=0;numReads=0;numWrites=0;inFrameOperations=0;operationsPerFrame=1;updateReadsAndWrites=!1;numReadsElement=null;numWritesElement=null;changingSound=!1;audioNodes=[];constructor(t,i,e){super(t),this.numReadsElement=i,this.numWritesElement=e;t={renderer:"gpu",shader:`
			precision highp float;
			
			varying vec2 uv;
			
			uniform float dataLength;
			
			const float circleSize = .8;
			
			uniform sampler2D uTexture;
			
			
			
			vec3 hsv2rgb(vec3 c)
			{
				vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
				vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
				return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
			}
			
			
			
			void main(void)
			{
				gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
				
				if (length(uv) <= circleSize)
				{
					float sample = mod(atan(uv.y, uv.x) / 6.283, 1.0);
					
					vec4 output1 = texture2D(uTexture, vec2(floor(sample * dataLength) / dataLength, .5));
					vec4 output2 = texture2D(uTexture, vec2(mod(floor(sample * dataLength + 1.0) / dataLength, 1.0), .5));
					
					float brightness = mix(output1.z, output2.z, fract(sample * dataLength));
					
					float h1 = (output1.x * 256.0 + output1.y) / dataLength * 255.0;
					float h2 = (output2.x * 256.0 + output2.y) / dataLength * 255.0;
					
					if (abs(h1 - h2) > .5)
					{
						if (h1 > h2)
						{
							h1 -= 1.0;
						}
						
						else
						{
							h2 -= 1.0;
						}
					}
					
					
					
					float h = mix(h1, h2, fract(sample * dataLength));
					
					float s = clamp((length(uv) / circleSize - .03) * (1.0 - brightness), 0.0, 1.0);
					
					float v = clamp((1.0 - length(uv) / circleSize) * 100.0, 0.0, 1.0);
					
					gl_FragColor = vec4(hsv2rgb(vec3(h, s, v)), 1.0);
				}
			}
		`,canvasWidth:this.resolution,canvasHeight:this.resolution,useFullscreen:!0,useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"},this.wilson=new Wilson($("#output-canvas"),t),this.wilson.render.initUniforms(["dataLength"]),i=this.wilson.gl.createTexture();this.wilson.gl.bindTexture(this.wilson.gl.TEXTURE_2D,i),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MAG_FILTER,this.wilson.gl.NEAREST),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_MIN_FILTER,this.wilson.gl.NEAREST),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_S,this.wilson.gl.CLAMP_TO_EDGE),this.wilson.gl.texParameteri(this.wilson.gl.TEXTURE_2D,this.wilson.gl.TEXTURE_WRAP_T,this.wilson.gl.CLAMP_TO_EDGE),this.wilson.gl.disable(this.wilson.gl.DEPTH_TEST)}run(t,i,e,a){this.resolution=t,this.generators=[this.shuffleArray.bind(this),this.algorithms[i].bind(this),this.verifyArray.bind(this)],this.currentGeneratorIndex=0;t=this.dataLength;this.dataLength=e,this.doPlaySound=a;try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}catch(t){}if(this.wilson.changeCanvasSize(this.resolution,this.resolution),this.dataLength!==t){this.data=new Array(this.dataLength),this.brightness=new Array(this.dataLength);for(let t=0;t<this.dataLength;t++)this.data[t]=t,this.brightness[t]=0;this.wilson.gl.uniform1f(this.wilson.uniforms.dataLength,this.dataLength)}this.numReads=0,this.numWrites=0,this.inFrameOperations=0,this.updateReadsAndWrites=!1;try{this.numReadsElement.textContent="0",this.numWritesElement.textContent="0"}catch(t){}this.audioNodes=[],this.createAudioNodes(),this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0),this.currentGenerator=this.generators[0](),window.requestAnimationFrame(this.drawFrame.bind(this))}drawFrame(t){if(this.timeElapsed=t-this.lastTimestamp,this.lastTimestamp=t,0!==this.timeElapsed){var i=new Uint8Array(4*this.dataLength);for(let t=0;t<this.dataLength;t++)i[4*t]=Math.floor(this.data[t]/256),i[4*t+1]=this.data[t]%256,i[4*t+2]=Math.floor(this.brightness[t]/this.maxBrightness*256);if(this.wilson.gl.texImage2D(this.wilson.gl.TEXTURE_2D,0,this.wilson.gl.RGBA,this.dataLength,1,0,this.wilson.gl.RGBA,this.wilson.gl.UNSIGNED_BYTE,i),this.wilson.render.drawFrame(),this.decreaseBrightness(),this.updateReadsAndWrites)try{this.numReadsElement.textContent=this.numReads,this.numWritesElement.textContent=this.numWrites}catch(t){}if(this.changingSound||this.currentGenerator.next(),this.animationPaused)try{this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}catch(t){}else window.requestAnimationFrame(this.drawFrame.bind(this))}}createAudioNodes(){if(this.doPlaySound)for(let t=0;t<this.generators.length;t++){var i=new AudioContext,e=i.createOscillator(),a=(e.type="sine",e.frequency.value=50,i.createGain());e.connect(a),a.connect(i.destination),this.audioNodes.push([i,e,a])}}readFromPosition(){this.numReads++}writeToPosition(t,i=!0,e=!0){return i&&(this.brightness[t]=this.maxBrightness-1),this.numWrites++,this.inFrameOperations++,this.inFrameOperations>=this.operationsPerFrame&&(this.inFrameOperations=0,e&&this.playSound(t),!0)}playSound(t){this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].frequency.linearRampToValueAtTime((this.maxFrequency-this.minFrequency)*this.data[t]/this.dataLength+this.minFrequency,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}decreaseBrightness(){for(let t=0;t<this.dataLength;t++)this.brightness[t]=Math.max(this.brightness[t]-1,0)}advanceGenerator(){this.changingSound=!0,this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3),this.currentGeneratorIndex++,this.currentGeneratorIndex<this.generators.length&&setTimeout(()=>{this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][1].start(0),this.currentGenerator=this.generators[this.currentGeneratorIndex](),this.changingSound=!1},1e3)}*shuffleArray(){this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let t=0;t<this.dataLength-1;t++){var i=Math.floor(Math.random()*(this.dataLength-t-1))+t,e=this.data[t];this.data[t]=this.data[i],this.data[i]=e,this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield)}this.numReads=0,this.numWrites=0,this.updateReadsAndWrites=!0,this.advanceGenerator()}*verifyArray(){this.updateReadsAndWrites=!1,this.operationsPerFrame=Math.ceil(this.dataLength/60);for(let t=0;t<this.dataLength;t++)this.writeToPosition(t)&&(yield),t!==this.dataLength-1&&this.data[t]>this.data[t+1]&&console.log("Not sorted!",this.data);this.doPlaySound&&this.audioNodes[this.currentGeneratorIndex][2].gain.linearRampToValueAtTime(1e-4,this.audioNodes[this.currentGeneratorIndex][0].currentTime+this.timeElapsed/1e3)}*bubbleSort(){for(this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/2500);;){let i=!0;for(let t=0;t<this.dataLength-1;t++){var e;this.readFromPosition(t),this.readFromPosition(t+1),this.data[t]>this.data[t+1]&&(i=!1,e=this.data[t],this.data[t]=this.data[t+1],this.data[t+1]=e,this.writeToPosition(t)&&(yield),this.writeToPosition(t+1))&&(yield)}if(i)break}this.advanceGenerator()}*insertionSort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/5e3);for(let e=1;e<this.dataLength;e++)if(this.readFromPosition(e),this.readFromPosition(e-1),this.data[e]<this.data[e-1])for(let i=0;i<e;i++)if(this.readFromPosition(i),this.readFromPosition(e),this.data[i]>this.data[e]){var t=this.data[e];for(let t=e;t>i;t--)this.data[t]=this.data[t-1],this.writeToPosition(t)&&(yield);this.data[i]=t,this.writeToPosition(i)&&(yield)}this.advanceGenerator()}*selectionSort(){this.operationsPerFrame=Math.ceil(this.dataLength/1e3);for(let a=0;a<this.dataLength;a++){let i=-1,e=this.dataLength;for(let t=a;t<this.dataLength;t++)this.readFromPosition(t),this.readFromPosition(e),this.data[t]<e&&(e=this.data[t],i=t);var t=this.data[a];this.data[a]=e,this.data[i]=t,this.writeToPosition(a)&&(yield),this.writeToPosition(i)&&(yield)}this.advanceGenerator()}*heapsort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/500);for(let i=1;i<this.dataLength;i++){let t=i;for(var e;0!==t&&(e=Math.floor((t-1)/2),this.readFromPosition(t),this.readFromPosition(e),this.data[t]>this.data[e]);){var a=this.data[t];this.data[t]=this.data[e],this.data[e]=a,this.writeToPosition(t)&&(yield),this.writeToPosition(e)&&(yield),t=e}}for(let e=this.dataLength-1;0<=e;e--){var s=this.data[0];this.data[0]=this.data[e],this.data[e]=s,this.writeToPosition(0)&&(yield),this.writeToPosition(e)&&(yield);let t=0;var r;let i=0;for(;;){if(r=1+(h=2*t+1),h>=e)break;if(i=r>=e||(this.readFromPosition(h),this.readFromPosition(r),this.data[h]>this.data[r])?h:r,this.readFromPosition(t),this.readFromPosition(i),!(this.data[t]<this.data[i]))break;var h=this.data[t];this.data[t]=this.data[i],this.data[i]=h,this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield),t=i}}this.advanceGenerator()}*mergeSort(r=0,h=this.dataLength){var t;if(h-r==2)this.readFromPosition(r),this.readFromPosition(h-1),this.data[r]>this.data[h-1]&&(this.writeToPosition(r)&&(yield),this.writeToPosition(h-1)&&(yield),t=this.data[r],this.data[r]=this.data[h-1],this.data[h-1]=t);else if(!(h-r<=1)){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/200);let s=r+Math.floor((h-r)/2);for(yield*this.mergeSort(s,h);;){if(s===r+1){let t=r;for(;t<h-1&&this.data[t]>this.data[t+1];){this.readFromPosition(t),this.readFromPosition(t+1),this.writeToPosition(t)&&(yield),this.writeToPosition(t+1)&&(yield);var o=this.data[t];this.data[t]=this.data[t+1],this.data[t+1]=o,t++}break}var n=r+Math.floor((s-r)/2);yield*this.mergeSort(r,n);let t=r,i=n,e=s;for(;;){if(i===e)break;if(i!==t&&(e===h||this.data[t]<this.data[e])){this.readFromPosition(t),this.readFromPosition(i),this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield);var d=this.data[t];this.data[t]=this.data[i],this.data[i]=d,t++}else{if(!(e<h&&this.data[e]<=this.data[t]))break;this.readFromPosition(e),this.readFromPosition(i),this.writeToPosition(e)&&(yield),this.writeToPosition(i)&&(yield);d=this.data[e];this.data[e]=this.data[i],this.data[i]=d,e++}i++}s=r+(s-n);let a=i-1;for(;a>s&&this.data[a-1]>this.data[a];){this.readFromPosition(a),this.readFromPosition(a-1),this.writeToPosition(a)&&(yield),this.writeToPosition(a-1)&&(yield);var l=this.data[a];this.data[a]=this.data[a-1],this.data[a-1]=l,a--}for(;a<h-1&&this.data[a+1]<this.data[a];){this.readFromPosition(a),this.readFromPosition(a+1),this.writeToPosition(a)&&(yield),this.writeToPosition(a+1)&&(yield);var g=this.data[a];this.data[a]=this.data[a+1],this.data[a+1]=g,a++}if(s===r)break}0===r&&h===this.dataLength&&this.advanceGenerator()}}*quicksort(){this.operationsPerFrame=Math.ceil(this.dataLength*Math.log(this.dataLength)/2250);var a=new Array(this.dataLength),s=(a[0]=0,a[1]=this.dataLength-1,new Array(this.dataLength));let i=1,r=0;for(;0<i;){for(let e=0;e<i;e++){var h=this.data[Math.floor((a[2*e]+a[2*e+1])/2)];this.readFromPosition(Math.floor((a[2*e]+a[2*e+1])/2));let t=a[2*e]-1,i=a[2*e+1]+1;for(;;){for(;t++,this.readFromPosition(t),this.data[t]<h;);for(this.readFromPosition(t);i--,this.readFromPosition(i),this.data[i]>h;);if(this.readFromPosition(i),t>=i)break;var o=this.data[t];this.data[t]=this.data[i],this.data[i]=o,this.writeToPosition(t)&&(yield),this.writeToPosition(i)&&(yield)}i>a[2*e]&&(s[2*r]=a[2*e],s[2*r+1]=i,r++),a[2*e+1]>i+1&&(s[2*r]=i+1,s[2*r+1]=a[2*e+1],r++)}i=r;for(let t=r=0;t<2*i;t++)a[t]=s[t]}this.advanceGenerator()}*shellsort(){this.operationsPerFrame=Math.ceil(this.dataLength/100);var i=[],t=2.2436091;let e=1;for(;;){var a=Math.ceil((Math.pow(t,e)-1)/(t-1));if(a>=this.dataLength)break;i.unshift(a),e++}for(let t=0;t<i.length;t++){var s=i[t];for(let i=s;i<this.dataLength;i++){var r=this.data[i];this.readFromPosition(i);let t=i;for(;t>=s&&this.data[t-s]>r;t-=s)this.data[t]=this.data[t-s],this.writeToPosition(t)&&(yield);this.data[t]=r,this.writeToPosition(t)&&(yield)}}this.advanceGenerator()}*cycleSort(){this.operationsPerFrame=Math.ceil(this.dataLength/2e3);var a=new Array(this.dataLength);for(let t=0;t<this.dataLength;t++)a[t]=!1;for(let t=0;t<this.dataLength;t++)if(!a[t]){this.readFromPosition(t);let i=this.data[t];var s=i;let e=0;do{for(let t=e=0;t<this.dataLength;t++)this.readFromPosition(t),this.data[t]<i&&e++;i>s&&e--;var r=this.data[e];this.data[e]=i,i=r,this.writeToPosition(e)&&(yield),a[e]=!0}while(e!==t)}this.advanceGenerator()}*msdRadixSort(){let i=0;var e=1/Math.log(2);for(let t=0;t<this.dataLength;t++){this.readFromPosition(t);var a=Math.log(this.data[t])*e;i=Math.max(i,a)}i=Math.round(i),this.operationsPerFrame=Math.ceil(this.dataLength*i/650);var s=new Array(this.dataLength),r=(s[0]=0,s[1]=this.dataLength-1,new Array(this.dataLength));let h=1,o=0;var n=new Array(this.dataLength);let d=Math.pow(2,i-1);for(let t=0;t<i;t++){for(let a=0;a<h;a++){let i=s[2*a],e=s[2*a+1];for(let t=s[2*a];t<=s[2*a+1];t++)this.readFromPosition(t),0==Math.floor(this.data[t]/d)%2?(n[i]=this.data[t],this.writeToPosition(i)&&(yield),i++):(n[e]=this.data[t],this.writeToPosition(e)&&(yield),e--);for(let t=s[2*a];t<=s[2*a+1];t++)this.data[t]=n[t],this.writeToPosition(t)&&(yield);i--,e++,i>s[2*a]&&(r[2*o]=s[2*a],r[2*o+1]=i,o++),s[2*a+1]>e&&(r[2*o]=e,r[2*o+1]=s[2*a+1],o++)}h=o;for(let t=o=0;t<2*h;t++)s[t]=r[t];d/=2}this.advanceGenerator()}*lsdRadixSort(){let i=0;var e=1/Math.log(2);for(let t=0;t<this.dataLength;t++){this.readFromPosition(t);var a=Math.log(this.data[t])*e;i=Math.max(i,a)}i=Math.round(i),this.operationsPerFrame=Math.ceil(this.dataLength*i/650);var s=new Array(this.dataLength);let r=1;for(let t=0;t<i;t++){let i=0,e=this.dataLength-1;for(let t=0;t<this.dataLength;t++)this.readFromPosition(t),0==Math.floor(this.data[t]/r)%2?(s[i]=this.data[t],this.writeToPosition(i)&&(yield),i++):(s[e]=this.data[t],this.writeToPosition(e)&&(yield),e--);i--,e++;for(let t=0;t<=i;t++)this.data[t]=s[t],this.writeToPosition(t)&&(yield);for(let t=0;t<this.dataLength-e;t++)this.data[e+t]=s[this.dataLength-1-t],this.writeToPosition(e+t)&&(yield);r*=2}this.advanceGenerator()}*gravitySort(){this.operationsPerFrame=Math.ceil(this.dataLength*this.dataLength/1e6);var a=new Array(this.dataLength);for(let i=0;i<this.dataLength;i++){a[i]=new Array(this.dataLength);for(let t=0;t<this.dataLength;t++)a[i][t]=!1}let t=0,e=0;for(let i=0;i<this.dataLength;i++){this.readFromPosition(i);var s=this.data[i];for(let t=0;t<s;t++)a[i][t]=!0;s-i>e&&(e=s-i,t=i)}for(let e=0;e<this.dataLength;e++){for(let i=this.dataLength-1;0<=i;i--)if(a[i][e]){let t=i;for(;++t<this.dataLength&&!a[t][e];);t--,a[i][e]=!1,a[t][e]=!0,this.data[i]--,this.data[t]++,this.writeToPosition(i,!1,!1),this.writeToPosition(t,!1,!1)}this.writeToPosition(t,!1,!0)&&(yield),this.numWrites--,this.inFrameOperations--}this.advanceGenerator()}}export{SortingAlgorithm};